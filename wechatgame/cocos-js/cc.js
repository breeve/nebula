System.register([],(function(t,e){"use strict";return{execute:function(){function n(t){var e,n;return e=(t>65535)<<4,e|=n=((t>>>=e)>255)<<3,e|=n=((t>>>=n)>15)<<2,(e|=n=((t>>>=n)>3)<<1)|(t>>>=n)>>1}function i(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24}function r(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}function a(t){return--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)}t({BitMask:ae,CCClass:en,CacheMode:void 0,DebugMode:void 0,ECollider2DType:void 0,EJoint2DType:void 0,EPhysics2DDrawFlags:void 0,ERaycast2DType:void 0,ERigidBody2DType:void 0,Enum:se,Eventify:nh,ExtrapolationMode:void 0,HorizontalTextAlignment:void 0,InstanceMaterialType:void 0,KeyCode:void 0,NodeEventType:void 0,NodeSpace:void 0,Overflow:void 0,Physics2DManifoldType:void 0,PhysicsGroup:void 0,PipelineEventType:void 0,QuatInterpolationMode:void 0,RealInterpolationMode:void 0,SystemEventType:void 0,TangentWeightMode:void 0,TransformBit:void 0,VerticalTextAlignment:void 0,WorldNode3DToLocalNodeUI:cw,WorldNode3DToWorldNodeUI:lw,absMax:wn,absMaxComponent:En,approx:hn,assert:b,assertID:L,bezier:Xf,bezierByTime:ud,ccenum:he,clamp:un,clamp01:_n,color:Rn,computeRatioByType:WQ,createDefaultPipeline:cO,debug:C,deserialize:$u,earcut:dW,enumerableProps:In,equals:ln,error:A,errorID:O,find:rR,fragmentText:WF,getBaselineOffset:function(){return 0},getEnglishWordPartAtFirst:HF,getEnglishWordPartAtLast:jF,getError:F,getPathFromRoot:function(t,e){for(var n=t,i="";null!==n&&n!==e;)i=n.name+"/"+i,n=n.parent;return i.slice(0,-1)},getSerializationMetadata:function(t){return t[Oc]},getWorldTransformUntilRoot:o4,instantiate:m_,inverseLerp:Tn,isDisplayStats:V,isEnglishWordPartAtFirst:function(t){return VF.test(t)},isEnglishWordPartAtLast:function(t){return FF.test(t)},isUnicodeCJK:zF,isUnicodeSpace:kF,isValid:gl,lerp:fn,log:x,logID:P,markAsWarning:void 0,mat4:Jn,murmurhash2_32_gc:ba,nextPow2:An,pingPong:Cn,pseudoRandom:yn,pseudoRandomRange:xn,pseudoRandomRangeInt:Sn,quat:Wn,randomRange:vn,randomRangeInt:gn,rect:si,removeProperty:void 0,repeat:bn,replaceProperty:void 0,safeMeasureText:UF,sampleAnimationCurve:jQ,setDefaultLogTimes:function(t){t>0&&(X=t)},setDisplayStats:z,size:ai,toDegree:pn,toRadian:dn,tween:Cmt,tweenUtil:Tmt,v2:ti,v3:Bn,v4:ni,warn:S,warnID:R});var o=new Array(256);!function(t){for(var e=0;e<256;++e){var n=e,i=e,r=7;for(n>>>=1;n;n>>>=1)i<<=1,i|=1&n,--r;t[e]=i<<r&255}}(o);var s=Object.freeze({__proto__:null,INT_BITS:32,INT_MAX:2147483647,INT_MIN:-2147483648,sign:function(t){return(t>0)-(t<0)},abs:function(t){var e=t>>31;return(t^e)-e},min:function(t,e){return e^(t^e)&-(t<e)},max:function(t,e){return t^(t^e)&-(t<e)},isPow2:function(t){return!(t&t-1||!t)},log2:n,log10:function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},popCount:i,countTrailingZeros:r,nextPow2:a,prevPow2:function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},parity:function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1},reverse:function(t){return o[255&t]<<24|o[t>>>8&255]<<16|o[t>>>16&255]<<8|o[t>>>24&255]},interleave2:function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},deinterleave2:function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},interleave3:function(t,e,n){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(n=1227133513&((n=3272356035&((n=251719695&((n=4278190335&((n&=1023)|n<<16))|n<<8))|n<<4))|n<<2))<<2},deinterleave3:function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},nextCombination:function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>r(t)+1}});t("bits",s);const c=!0;var l="undefined"==typeof window?global:window,h=t("cclegacy",{_global:l});h.internal={},l.CC_BUILD=!0,l.CC_TEST=!1,l.CC_EDITOR=false,l.CC_PREVIEW=!1,l.CC_DEV=!1,l.CC_DEBUG=!1,l.CC_JSB=!1,l.CC_BYTEDANCE=!1,l.CC_WECHAT=c,l.CC_ALIPAY=!1,l.CC_XIAOMI=!1,l.CC_BAIDU=!1,l.CC_COCOSPLAY=!1,l.CC_HUAWEI=!1,l.CC_OPPO=!1,l.CC_VIVO=!1,l.CC_MINIGAME=!0,l.CC_RUNTIME_BASED=!1,l.CC_SUPPORT_JIT=!1;var u=t("VERSION","3.5.2");l.CocosEngine=h.ENGINE_VERSION=u,l.cc=h;var _="https://github.com/cocos-creator/engine/blob/develop/EngineErrorMap.md",f=null,d=console.log.bind(console),p=d,m=d,v=function(t,e){if(!t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];console.log("ASSERT: "+y.apply(void 0,[e].concat(i)))}},g=d;function y(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return h.js.formatStr.apply(null,[t].concat(n))}function x(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return d.apply(void 0,[t].concat(n))}function S(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return p.apply(void 0,[t].concat(n))}function A(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return m.apply(void 0,[t].concat(n))}function b(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return v.apply(void 0,[t,e].concat(i))}function C(){return g.apply(void 0,arguments)}function T(t){if(d=p=m=v=g=function(){},t!==N.NONE){if(t>N.ERROR){var e=function(t){if(h.game.canvas){if(!f){var e=document.createElement("Div");e.setAttribute("id","logInfoDiv"),e.setAttribute("width","200"),e.setAttribute("height",h.game.canvas.height);var n=e.style;n.zIndex="99999",n.position="absolute",n.top=n.left="0",(f=document.createElement("textarea")).setAttribute("rows","20"),f.setAttribute("cols","30"),f.setAttribute("disabled","true");var i=f.style;i.backgroundColor="transparent",i.borderBottom="1px solid #cccccc",i.borderTopWidth=i.borderLeftWidth=i.borderRightWidth="0px",i.borderTopStyle=i.borderLeftStyle=i.borderRightStyle="none",i.padding="0px",i.margin="0px",e.appendChild(f),h.game.canvas.parentNode.appendChild(e)}f.value=f.value+t+"\r\n",f.scrollTop=f.scrollHeight}};m=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e("ERROR :  "+y.apply(void 0,[t].concat(i)))},v=function(t,n){if(!t){for(var i=arguments.length,r=new Array(i>2?i-2:0),a=2;a<i;a++)r[a-2]=arguments[a];e("ASSERT: "+y.apply(void 0,[n].concat(r)))}},t!==N.ERROR_FOR_WEB_PAGE&&(p=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e("WARN :  "+y.apply(void 0,[t].concat(i)))}),t===N.INFO_FOR_WEB_PAGE&&(d=function(t){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e(y.apply(void 0,[t].concat(i)))})}else console&&(console.error||(console.error=console.log),console.warn||(console.warn=console.log),m=console.error.bind?console.error.bind(console):function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return console.error.apply(console,[t].concat(n))},v=function(t,e){if(!t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];var a=y.apply(void 0,[e].concat(i));throw new Error(a)}});if(t!==N.ERROR&&(p=console.warn.bind?console.warn.bind(console):function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return console.warn.apply(console,[t].concat(n))}),t<=N.INFO&&(d=console.log.bind?console.log.bind(console):function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return console.log.apply(console,[t].concat(n))}),t<=N.VERBOSE&&"function"==typeof console.debug){var n=console.debug.bind(console);g=function(){return n.apply(void 0,arguments)}}}}function E(t){A(t.stack||t)}function w(t){return function(e){for(var n=t+" "+e+", please go to "+_+"#"+e+" to see details.",i=arguments.length,r=new Array(i>1?i-1:0),a=1;a<i;a++)r[a-1]=arguments[a];return 0===r.length?n:n+" Arguments: "+r.join(", ")}}var I=w("Log");function P(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];x(I.apply(void 0,[t].concat(n)))}var D=w("Warning");function R(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];S(D.apply(void 0,[t].concat(n)))}var M=w("Error");function O(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];A(M.apply(void 0,[t].concat(n)))}var N,B=w("Assert");function L(t,e){if(!t){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];b(!1,B.apply(void 0,[e].concat(i)))}}function F(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];return M.apply(void 0,[t].concat(n))}function V(){return!!h.profiler&&h.profiler.isShowingStats()}function z(t){h.profiler&&(t?h.profiler.showStats():h.profiler.hideStats(),h.game.config.showFPS=!!t)}!function(t){t[t.NONE=0]="NONE",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.INFO_FOR_WEB_PAGE=5]="INFO_FOR_WEB_PAGE",t[t.WARN_FOR_WEB_PAGE=6]="WARN_FOR_WEB_PAGE",t[t.ERROR_FOR_WEB_PAGE=7]="ERROR_FOR_WEB_PAGE"}(N||(N=t("DebugMode",{})));var k,U,G,H,j,W,q=Object.freeze({__proto__:null,log:x,warn:S,error:A,assert:b,debug:C,_resetDebugSetting:T,_throw:E,logID:P,warnID:R,errorID:O,assertID:L,get DebugMode(){return N},getError:F,isDisplayStats:V,setDisplayStats:z}),X=10,Y=0,K=new Map;function J(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function Q(t,e,n){return e&&J(t.prototype,e),n&&J(t,n),t}function Z(){return(Z=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(t[i]=n[i])}return t}).apply(this,arguments)}function $(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,et(t,e)}function tt(t){return(tt=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function et(t,e){return(et=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function nt(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function it(t,e,n){return(it=nt()?Reflect.construct:function(t,e,n){var i=[null];i.push.apply(i,e);var r=new(Function.bind.apply(t,i));return n&&et(r,n.prototype),r}).apply(null,arguments)}function rt(t){var e="function"==typeof Map?new Map:void 0;return(rt=function(t){if(null===t||(n=t,-1===Function.toString.call(n).indexOf("[native code]")))return t;var n;if("function"!=typeof t)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(t))return e.get(t);e.set(t,i)}function i(){return it(t,arguments,tt(this).constructor)}return i.prototype=Object.create(t.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),et(i,t)})(t)}function at(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function ot(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,i=new Array(e);n<e;n++)i[n]=t[n];return i}function st(t,e){var n;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(n=function(t,e){if(t){if("string"==typeof t)return ot(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ot(t,e):void 0}}(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var i=0;return function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=t[Symbol.iterator]()).next.bind(n)}function ct(t,e,n,i){n&&Object.defineProperty(t,e,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(i):void 0})}function lt(t,e,n,i,r){var a={};return Object.keys(i).forEach((function(t){a[t]=i[t]})),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=n.slice().reverse().reduce((function(n,i){return i(t,e,n)||n}),a),r&&void 0!==a.initializer&&(a.value=a.initializer?a.initializer.call(r):void 0,a.initializer=void 0),void 0===a.initializer&&(Object.defineProperty(t,e,a),a=null),a}H=function(t,e,n,i,r,a,o){var s=K.get(a);s&&s.logTimes>s.count&&(r("'%s' is deprecated, please use '%s' instead. "+o,t+"."+e,n+"."+i),s.count++)},k=t("replaceProperty",(function(t,e,n){null!=t&&n.forEach((function(n){var i=Y++;K.set(i,{id:i,count:0,logTimes:void 0!==n.logTimes?n.logTimes:X});var r=null!=n.target?n.target:t,a=null!=n.newName?n.newName:n.name,o=null!=n.targetName?n.targetName:e,s=r===t,c=n.suggest?"("+n.suggest+")":"";if(null!=n.customFunction)t[n.name]=function(){var t;return H(e,n.name,o,a,S,i,c),(t=n.customFunction).call.apply(t,[this].concat(Array.prototype.slice.call(arguments)))};else if(null!=n.customSetter||null!=n.customGetter){var l=null!=n.customSetter,h=null!=n.customGetter;l&&h?Object.defineProperty(t,n.name,{get:function(){return H(e,n.name,o,a,S,i,c),n.customGetter.call(this)},set:function(t){H(e,n.name,o,a,S,i,c),n.customSetter.call(this,t)},enumerable:!1}):l?Object.defineProperty(t,n.name,{set:function(t){H(e,n.name,o,a,S,i,c),n.customSetter.call(this,t)},enumerable:!1}):h&&Object.defineProperty(t,n.name,{get:function(){return H(e,n.name,o,a,S,i,c),n.customGetter.call(this)},enumerable:!1})}else Object.defineProperty(t,n.name,{get:function(){return H(e,n.name,o,a,S,i,c),s?this[a]:r[a]},set:function(t){H(e,n.name,o,a,S,i,c),s?this[a]=t:r[a]=t},enumerable:!1})}))})),W=function(t,e,n,i,r){var a=K.get(i);a&&a.logTimes>a.count&&(n("'%s' has been removed. "+r,t+"."+e),a.count++)},U=t("removeProperty",(function(t,e,n){null!=t&&n.forEach((function(n){var i=Y++;K.set(i,{id:i,count:0,logTimes:void 0!==n.logTimes?n.logTimes:X});var r=n.suggest?"("+n.suggest+")":"";Object.defineProperty(t,n.name,{get:function(){return W(e,n.name,A,i,r)},set:function(){W(e,n.name,A,i,r)},enumerable:!1})}))})),j=function(t,e,n,i,r){var a=K.get(i);a&&a.logTimes>a.count&&(n("'%s' is deprecated. "+r,t+"."+e),a.count++)},G=t("markAsWarning",(function(t,e,n){null!=t&&n.forEach((function(n){var i=n.name,r=Object.getOwnPropertyDescriptor(t,i);if(r&&r.configurable){var a=Y++;K.set(a,{id:a,count:0,logTimes:void 0!==n.logTimes?n.logTimes:X});var o=n.suggest?"("+n.suggest+")":"";if(void 0!==r.value)if("function"==typeof r.value){var s=r.value;t[i]=function(){return j(e,i,S,a,o),s.call.apply(s,[this].concat(Array.prototype.slice.call(arguments)))}}else{var c=r.value;Object.defineProperty(t,i,{configurable:!0,get:function(){return j(e,i,S,a,o),c}}),r.writable&&Object.defineProperty(t,i,{set:function(t){j(e,i,S,a,o),c=t}})}else!function(e,n,i,r,a,o){if(e.get){var s=e.get;e.get=function(){return j(n,i,r,a,o),s.call(this)}}if(e.set){var c=e.set;e.set=function(t){j(n,i,r,a,o),c.call(this,t)}}Object.defineProperty(t,i,e)}(r,e,i,S,a,o);Object.defineProperty(t,i,{enumerable:!1})}}))}));var ht=function(){function t(t){this.i=0,this.array=t}var e=t.prototype;return e.remove=function(t){var e=this.array.indexOf(t);e>=0&&this.removeAt(e)},e.removeAt=function(t){this.array.splice(t,1),t<=this.i&&--this.i},e.fastRemove=function(t){var e=this.array.indexOf(t);e>=0&&this.fastRemoveAt(e)},e.fastRemoveAt=function(t){var e=this.array;e[t]=e[e.length-1],--e.length,t<=this.i&&--this.i},e.push=function(t){this.array.push(t)},Q(t,[{key:"length",get:function(){return this.array.length},set:function(t){this.array.length=t,this.i>=t&&(this.i=t-1)}}]),t}();function ut(t,e){t.splice(e,1)}function _t(t,e){var n=t.length;e<0||e>=n||(t[e]=t[n-1],t.length=n-1)}function ft(t,e){var n=t.indexOf(e);return n>=0&&(ut(t,n),!0)}function dt(t,e){var n=t.findIndex(e);if(n>=0){var i=t[n];return ut(t,n),i}}function pt(t,e){return t.indexOf(e)>=0}var mt=Object.freeze({__proto__:null,removeAt:ut,fastRemoveAt:_t,remove:ft,fastRemove:function(t,e){var n=t.indexOf(e);n>=0&&(t[n]=t[t.length-1],--t.length)},removeIf:dt,verifyType:function(t,e){if(t&&t.length>0)for(var n,i=st(t);!(n=i()).done;)if(!(n.value instanceof e))return P(1300),!1;return!0},removeArray:function(t,e){for(var n=0,i=e.length;n<i;n++)ft(t,e[n])},appendObjectsAt:function(t,e,n){return t.splice.apply(t,[n,0].concat(e)),t},contains:pt,copy:function(t){for(var e=t.length,n=new Array(e),i=0;i<e;i+=1)n[i]=t[i];return n},MutableForwardIterator:ht}),vt=function(){function t(t){this.id=void 0,this.prefix=void 0,this.id=0|998*Math.random(),this.prefix=t?t+".":""}return t.prototype.getNewId=function(){return this.prefix+ ++this.id},t}();vt.global=new vt("global");var gt=new vt("TmpCId."),yt="undefined"==typeof Symbol?"__aliases__":Symbol("[[Aliases]]"),xt="__cid__";function St(t){return"number"==typeof t||t instanceof Number}function At(t){return"string"==typeof t||t instanceof String}function bt(t){for(var e in t)return!1;return!0}var Ct,Tt=(Ct={value:void 0,enumerable:!1,writable:!1,configurable:!0},function(t,e,n,i,r){Ct.value=n,Ct.writable=i,Ct.enumerable=r,Object.defineProperty(t,e,Ct),Ct.value=void 0}),Et=function(){var t={get:void 0,set:void 0,enumerable:!1};return function(e,n,i,r,a,o){void 0===a&&(a=!1),void 0===o&&(o=!1),"boolean"==typeof r&&(a=r,r=void 0),t.get=i,t.set=r,t.enumerable=a,t.configurable=o,Object.defineProperty(e,n,t),t.get=void 0,t.set=void 0}}(),wt=function(){var t={get:void 0,enumerable:!1,configurable:!1};return function(e,n,i,r,a){t.get=i,t.enumerable=r,t.configurable=a,Object.defineProperty(e,n,t),t.get=void 0}}(),It=function(){var t={set:void 0,enumerable:!1,configurable:!1};return function(e,n,i,r,a){t.set=i,t.enumerable=r,t.configurable=a,Object.defineProperty(e,n,t),t.set=void 0}}();function Pt(t){var e=Object.create(null);return t&&(e["."]=1,e["/"]=1,delete e["."],delete e["/"]),e}function Dt(t){if("function"==typeof t){var e=t.prototype;if(e&&e.hasOwnProperty("__classname__")&&e.__classname__)return e.__classname__;var n="";if(t.name&&(n=t.name),t.toString){var i,r=t.toString();(i="["===r.charAt(0)?/\[\w+\s*(\w+)\]/.exec(r):/function\s*(\w+)/.exec(r))&&2===i.length&&(n=i[1])}return"Object"!==n?n:""}return t&&t.constructor?Dt(t.constructor):""}function Rt(t,e,n,i){var r=/([^.]+)$/,a=r.exec(e)[0],o=r.exec(n)[0];function s(){return this[o]}i?Et(t,a,s,(function(t){this[o]=t})):wt(t,a,s)}function Mt(t,e,n,i){for(var r in n)Rt(t,e+"."+r,n[r],i)}var Ot=/(%d)|(%s)/,Nt=/%s/;function Bt(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];if(0===arguments.length)return"";if(0===n.length)return""+t;var r="string"==typeof t&&Ot.test(t);if(r)for(var a,o=st(n);!(a=o()).done;){var s=a.value,c="number"==typeof s?Ot:Nt;if(c.test(t)){var l=""+s;t=t.replace(c,l)}else t+=" "+s}else for(var h,u=st(n);!(h=u()).done;){var _=h.value;t+=" "+_}return t}function Lt(){for(var t=arguments.length-1,e=new Array(t),n=0;n<t;++n)e[n]=arguments[n+1];return e}function Ft(t,e){for(;t;){var n=Object.getOwnPropertyDescriptor(t,e);if(n)return n;t=Object.getPrototypeOf(t)}return null}function Vt(t,e,n){var i=Ft(e,t);i&&Object.defineProperty(n,t,i)}function zt(t){t=t||{};for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(var r=0,a=n;r<a.length;r++){var o=a[r];if(o){if("object"!=typeof o){O(5402,o);continue}for(var s in o)s in t||Vt(s,o,t)}}return t}function kt(t){t=t||{};for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];for(var r=0,a=n;r<a.length;r++){var o=a[r];if(o){if("object"!=typeof o){O(5403,o);continue}for(var s in o)Vt(s,o,t)}}return t}function Ut(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t.prototype=Object.create(e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),t}function Gt(t){var e=t.prototype,n=e&&Object.getPrototypeOf(e);return n&&n.constructor}function Ht(t,e){if(t&&e){if("function"!=typeof t)return!1;if("function"!=typeof e)return!1;if(t===e)return!0;for(;;){if(!(t=Gt(t)))return!1;if(t===e)return!0}}return!1}function jt(t){for(var e=0,n=Object.keys(t);e<n.length;e++)delete t[n[e]]}var Wt=Pt(!0),qt=Pt(!0);function Xt(t,e){return function(n,i){if(i.prototype.hasOwnProperty(t)&&delete e[i.prototype[t]],Tt(i.prototype,t,n),n){var r=e[n];r&&r!==i?A("A Class already exists with the same "+t+' : "'+n+'".'):e[n]=i}}}var Yt=Xt("__cid__",Wt),Kt=Xt("__classname__",qt);function Jt(t,e){if(Kt(t,e),!e.prototype.hasOwnProperty(xt)){var n=t||gt.getNewId();n&&Yt(n,e)}}function Qt(t,e){var n=qt[e],i=Wt[e],r=!0;if(n&&n!==t&&(A('"'+e+'" has already been set as name or alias of another class.'),r=!1),i&&i!==t&&(A('"'+e+'" has already been set as id or alias of another class.'),r=!1),r){var a=t[yt];a||(a=[],t[yt]=a),a.push(e),qt[e]=t,Wt[e]=t}}function Zt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];for(var i=0,r=e;i<r.length;i++){var a=r[i],o=a.prototype,s=o.__cid__;s&&delete Wt[s];var c=o.__classname__;c&&delete qt[c];var l=o[yt];if(l)for(var h=0;h<l.length;++h){var u=l[h];delete qt[u],delete Wt[u]}}}function $t(t){return Wt[t]}function te(t){return qt[t]}function ee(t,e){if(e=void 0===e||e,"function"==typeof t&&t.prototype.hasOwnProperty(xt))return t.prototype.__cid__;if(t&&t.constructor){var n=t.constructor.prototype;if(n&&n.hasOwnProperty(xt))return t.__cid__}return""}var ne=function(){var t=e.prototype;function e(t,e){this.count=void 0,this._pool=void 0,this._cleanup=void 0;var n=void 0===e?t:e,i=void 0===e?null:t;this.count=0,this._pool=new Array(n),this._cleanup=i}return t.get=function(){return this._get()},t._get=function(){if(this.count>0){--this.count;var t=this._pool[this.count];return this._pool[this.count]=null,t}return null},t.put=function(t){var e=this._pool;if(this.count<e.length){if(this._cleanup&&!1===this._cleanup(t))return;e[this.count]=t,++this.count}},t.resize=function(t){t>=0&&(this._pool.length=t,this.count>t&&(this.count=t))},e}(),ie=mt,re={IDGenerator:vt,Pool:ne,array:mt,isNumber:St,isString:At,isEmptyObject:bt,getPropertyDescriptor:Ft,addon:zt,mixin:kt,extend:Ut,getSuper:Gt,isChildClassOf:Ht,clear:jt,value:Tt,getset:Et,get:wt,set:It,unregisterClass:Zt,getClassName:Dt,setClassName:Jt,setClassAlias:Qt,getClassByName:te,get _registeredClassNames(){return Z({},qt)},set _registeredClassNames(t){jt(qt),Object.assign(qt,t)},get _registeredClassIds(){return Z({},Wt)},set _registeredClassIds(t){jt(Wt),Object.assign(Wt,t)},_getClassId:ee,_setClassId:Yt,_getClassById:$t,obsolete:Rt,obsoletes:Mt,formatStr:Bt,shiftArguments:Lt,createMap:Pt};function ae(t){if("__bitmask__"in t)return t;Tt(t,"__bitmask__",null,!0);for(var e=-1,n=Object.keys(t),i=0;i<n.length;i++){var r=n[i],a=t[r];if(-1===a)a=++e,t[r]=a;else if("number"==typeof a)e=a;else if("string"==typeof a&&Number.isInteger(parseFloat(r)))continue;var o=""+a;r!==o&&Tt(t,o,r)}return t}function oe(t,e){e>=0&&t.length,t.length}function se(t){return"__enums__"in t?t:(Tt(t,"__enums__",null,!0),se.update(t))}function ce(t){t.hasOwnProperty("__enums__")}function le(t){ce(t);var e=t.__enums__||[];for(var n in e.length=0,t){var i=t[n];Number.isInteger(i)&&e.push({name:n,value:i})}return e.sort((function(t,e){return t.value-e.value})),t.__enums__=e,e}function he(t){"__enums__"in t||Tt(t,"__enums__",null,!0)}h.js=re,t("js",Object.freeze({__proto__:null,array:ie,js:re,IDGenerator:vt,Pool:ne,isNumber:St,isString:At,isEmptyObject:bt,value:Tt,getset:Et,get:wt,set:It,createMap:Pt,getClassName:Dt,obsolete:Rt,obsoletes:Mt,formatStr:Bt,shiftArguments:Lt,getPropertyDescriptor:Ft,addon:zt,mixin:kt,extend:Ut,getSuper:Gt,isChildClassOf:Ht,clear:jt,_idToClass:Wt,_nameToClass:qt,_setClassId:Yt,setClassName:Jt,setClassAlias:Qt,unregisterClass:Zt,_getClassById:$t,getClassByName:te,_getClassId:ee})),ae.isBitMask=function(t){return t&&t.hasOwnProperty("__bitmask__")},ae.getList=function(t){if(t.__bitmask__)return t.__bitmask__;var e=t.__bitmask__=[];for(var n in t){var i=t[n];Number.isInteger(i)&&e.push({name:n,value:i})}return e.sort((function(t,e){return t.value-e.value})),e},h.BitMask=ae,se.update=function(t){for(var e=-1,n=Object.keys(t),i=0;i<n.length;i++){var r=n[i],a=t[r];if(-1===a)a=++e,t[r]=a;else if("number"==typeof a)e=a;else if("string"==typeof a&&Number.isInteger(parseFloat(r)))continue;var o=""+a;r!==o&&Tt(t,o,r)}return Array.isArray(t.__enums__)&&le(t),t},se||(se=t("Enum",{})),se.isEnum=function(t){return t&&t.hasOwnProperty("__enums__")},se.getList=function(t){return ce(t),t.__enums__?t.__enums__:le(t)},h.Enum=se;var ue=t("ValueType",function(){function t(){}var e=t.prototype;return e.clone=function(){return O(100,Dt(this)+".clone"),this},e.equals=function(){return!1},e.set=function(){O(100,Dt(this)+".set")},e.toString=function(){return""},t}());Jt("cc.ValueType",ue),h.ValueType=ue;var _e=t("macro",{SUPPORT_TEXTURE_FORMATS:[".astc",".pkm",".pvr",".webp",".jpg",".jpeg",".bmp",".png"],KEY:{none:0,back:6,menu:18,backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,pause:19,capslock:20,escape:27,space:32,pageup:33,pagedown:34,end:35,home:36,left:37,up:38,right:39,down:40,select:41,insert:45,Delete:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,a:65,b:66,c:67,d:68,e:69,f:70,g:71,h:72,i:73,j:74,k:75,l:76,m:77,n:78,o:79,p:80,q:81,r:82,s:83,t:84,u:85,v:86,w:87,x:88,y:89,z:90,num0:96,num1:97,num2:98,num3:99,num4:100,num5:101,num6:102,num7:103,num8:104,num9:105,"*":106,"+":107,"-":109,numdel:110,"/":111,f1:112,f2:113,f3:114,f4:115,f5:116,f6:117,f7:118,f8:119,f9:120,f10:121,f11:122,f12:123,numlock:144,scrolllock:145,";":186,semicolon:186,equal:187,"=":187,",":188,comma:188,dash:189,".":190,period:190,forwardslash:191,grave:192,"[":219,openbracket:219,backslash:220,"]":221,closebracket:221,quote:222,dpadLeft:1e3,dpadRight:1001,dpadUp:1003,dpadDown:1004,dpadCenter:1005},RAD:Math.PI/180,DEG:180/Math.PI,REPEAT_FOREVER:Number.MAX_VALUE-1,FLT_EPSILON:1.192092896e-7,ORIENTATION_PORTRAIT:1,ORIENTATION_LANDSCAPE:2,ORIENTATION_AUTO:3,ENABLE_TILEDMAP_CULLING:!0,TOUCH_TIMEOUT:5e3,ENABLE_TRANSPARENT_CANVAS:!1,ENABLE_WEBGL_ANTIALIAS:!0,ENABLE_ANTIALIAS_FXAA:!1,ENABLE_BLOOM:!1,CLEANUP_IMAGE_CACHE:!1,ENABLE_MULTI_TOUCH:!0,MAX_LABEL_CANVAS_POOL_SIZE:20,ENABLE_WEBGL_HIGHP_STRUCT_VALUES:!1,BATCHER2D_MEM_INCREMENT:144});h.macro=_e;for(var fe=/^(?:cc|dragonBones|sp|ccsg)\..+/,de=new Array(123),pe=0;pe<123;++pe)de[pe]=64;for(var me=0;me<64;++me)de["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(me)]=me;var ve=de;function ge(t,e,n){function i(t,e,n,i){var r=Object.getOwnPropertyDescriptor(t,e);if(r)r.get&&(t[n]=r.get),r.set&&i&&(t[i]=r.set);else{var a=t[n];Et(t,e,a,t[i])}}for(var r,a=t.prototype,o=0;o<e.length;o++){var s=(r=e[o])[0].toUpperCase()+r.slice(1);i(a,r,"get"+s,"set"+s)}for(r in n){var c=n[r];i(a,r,c[0],c[1])}}function ye(t,e,n,i){var r=t[e];r?Array.isArray(r)?i?(r.push(r[0]),r[0]=n):r.push(n):t[e]=i?[n,r]:[r,n]:t[e]=n}function xe(t,e){if("function"==typeof t.contains)return t.contains(e);if("function"==typeof t.compareDocumentPosition)return!!(16&t.compareDocumentPosition(e));var n=e.parentNode;if(n)do{if(n===t)return!0;n=n.parentNode}while(null!==n);return!1}function Se(t){return"object"==typeof window&&"function"==typeof Node?t instanceof Node:t&&"object"==typeof t&&"number"==typeof t.nodeType&&"string"==typeof t.nodeName}function Ae(t,e,n){t&&setTimeout((function(){t(e,n)}),0)}function be(t){return!(!t||t.constructor!==Object)&&bt(t)}function Ce(t,e,n){if(e>n){var i=e;e=n,n=i}return t<e?e:t<n?t:n}function Te(t){return t*_e.RAD}function Ee(t){return t*_e.DEG}h.misc={BUILTIN_CLASSID_RE:fe,BASE64_VALUES:ve,propertyDefine:ge,pushToMap:ye,contains:xe,isDomNode:Se,callInNextTick:Ae,isPlainEmptyObj_DEV:be,clampf:Ce,degreesToRadians:Te,radiansToDegrees:Ee},t("misc",Object.freeze({__proto__:null,BUILTIN_CLASSID_RE:fe,BASE64_VALUES:ve,propertyDefine:ge,pushToMap:ye,contains:xe,isDomNode:Se,callInNextTick:Ae,tryCatchFunctor_EDITOR:function(t){return Function("target","try {\n  target."+t+"();\n}\ncatch (e) {\n  cc._throw(e);\n}")},isPlainEmptyObj_DEV:be,clampf:Ce,degreesToRadians:Te,radiansToDegrees:Ee}));var we="$_$";function Ie(t,e){var n=e?Object.create(e):{};return Tt(t,"__attrs__",n),n}function Pe(t){if("function"!=typeof t)return Ie(t,Re(t.constructor));for(var e,n=h.Class.getInheritanceChain(t),i=n.length-1;i>=0;i--){var r=n[i];r.hasOwnProperty("__attrs__")&&r.__attrs__||Ie(r,(e=n[i+1])&&e.__attrs__)}return Ie(t,(e=n[0])&&e.__attrs__),t.__attrs__}function De(t,e){var n=Re(t),i=e+we,r={};for(var a in n)a.startsWith(i)&&(r[a.slice(i.length)]=n[a]);return r}function Re(t){return t.hasOwnProperty("__attrs__")&&t.__attrs__||Pe(t)}function Me(t,e,n,i){Re(t)[e+we+n]=i}var Oe=function(){function t(t,e){this.name=void 0,this.default=void 0,this.name=t,this.default=e}return t.prototype.toString=function(){return this.name},t}(),Ne=t("CCInteger",new Oe("Integer",0));h.Integer=Ne,h.CCInteger=Ne;var Be=t("CCFloat",new Oe("Float",0));h.Float=Be,h.CCFloat=Be;var Le=t("CCBoolean",new Oe("Boolean",!1));h.Boolean=Le,h.CCBoolean=Le;var Fe=t("CCString",new Oe("String",""));function Ve(t,e){return function(n,i){var r='"'+Dt(n)+"."+i+'"',a=De(n,i),o=a.type;if(o===Ne||o===Be?o="Number":o!==Fe&&o!==Le||(o=""+o),o===t){if(a.hasOwnProperty("default")){var s=a.default;if(void 0!==s&&!Array.isArray(s)&&!be(s)){var c=typeof s,l=t.toLowerCase();if(c===l)if("object"===l){if(!s||s instanceof a.ctor)return;R(3605,r,Dt(a.ctor))}else"Number"!==t&&R(3606,e,r,t);else{if("function"===c)return;t===Fe.default&&null==s?R(3607,r):R(3611,e,r,c)}delete a.type}}}else R(3604,r)}}h.String=Fe,h.CCString=Fe;var ze=Object.freeze({__proto__:null,DELIMETER:we,createAttrsSingle:Ie,createAttrs:Pe,attr:De,getClassAttrs:Re,setClassAttr:Me,PrimitiveType:Oe,CCInteger:Ne,CCFloat:Be,CCBoolean:Le,CCString:Fe,getTypeChecker_ET:Ve,getObjTypeChecker_ET:function(t){return function(e,n){Ve("Object","type")(e,n);var i=Re(e)[n+we+"default"],r=h.Class.getDefault(i);if(!Array.isArray(r)&&Ht(t,h.ValueType)){var a=Dt(t),o=Bt('No need to specify the "type" of "%s.%s" because %s is a child class of ValueType.',Dt(e),n,a);i?x(o):R(3612,o,a,Dt(e),n,a)}}}}),ke={default:{},serializable:{},editorOnly:{},formerlySerializedAs:{}};function Ue(t,e,n,i){if(!t.get&&!t.set&&t.hasOwnProperty("default")){var r="_N$"+e;t.get=function(){return this[r]},t.set=function(t){var e=this[r];this[r]=t,n.call(this,e)};var a={};for(var o in i[r]=a,ke){var s=ke[o];t.hasOwnProperty(o)&&(a[o]=t[o],s.canUsedInGet||delete t[o])}}}function Ge(t,e,n,i){if(Array.isArray(e)){if(!(e.length>0))return O(5508,n,i);t.type=e=e[0]}"function"==typeof e&&(e===String?t.type=h.String:e===Boolean?t.type=h.Boolean:e===Number&&(t.type=h.Float))}function He(t,e,n){var i=t?{_short:!0}:{_short:!0,default:e};return n&&(i.type=n),i}function je(t,e){if(!t||t.constructor!==Object){if(Array.isArray(t)&&t.length>0)return He(e,[],t);if("function"==typeof t){var n=t;return He(e,Ht(n,h.ValueType)?new n:null,n)}return He(e,t instanceof Oe?t.default:t)}return null}var We,qe=[];function Xe(){return qe[qe.length-1]}h._RF={push:function(t,e,n,i){void 0===n&&(n=e,e=""),qe.push({uuid:e,script:n,module:t,exports:t.exports,beh:null,importMeta:i})},pop:function(){var t=qe.pop(),e=t.module,n=e.exports;if(n===t.exports){for(var i in n)return;e.exports=n=t.cls}},peek:Xe},function(t){t[t.STANDALONE=1]="STANDALONE",t[t.IMPLICIT_VISIBLE=2]="IMPLICIT_VISIBLE",t[t.IMPLICIT_SERIALIZABLE=4]="IMPLICIT_SERIALIZABLE"}(We||(We={}));var Ye=we,Ke={datas:null,push:function(t){if(this.datas)this.datas.push(t);else{this.datas=[t];var e=this;setTimeout((function(){e.init()}),0)}},init:function(){var t=this.datas;if(t){for(var e=0;e<t.length;++e){var n=t[e],i=n.cls,r=n.props;"function"==typeof r&&(r=r());var a=Dt(i);r?tn(i,a,r,i.$super,n.mixins):O(3633,a)}this.datas=null}}};function Je(t,e,n,i){!function(t,e){!function(t,e){t.indexOf(e)<0&&t.push(e)}(t.__props__,e)}(t,n),an(t,i,e,n)}function Qe(t,e,n,i){var r=i.get;i.set,r&&(an(t,i,e,n),Me(t,n,"serializable",!1))}function Ze(t){return"function"==typeof t?t():t}function $e(t,e,n){for(var i in e)t.hasOwnProperty(i)||n&&!n(i)||Object.defineProperty(t,i,Ft(e,i))}function tn(t,e,n,i,r){if(t.__props__=[],i&&i.__props__&&(t.__props__=i.__props__.slice()),r)for(var a=0;a<r.length;++a){var o=r[a];o.__props__&&(t.__props__=t.__props__.concat(o.__props__.filter((function(e){return t.__props__.indexOf(e)<0}))))}if(n)for(var s in function(t,e){for(var n in t){var i=t[n],r=je(i,!1);if(r&&(i=t[n]=r),i){var a=i.notify;a&&Ue(i,n,a,t),"type"in i&&Ge(i,i.type,e,n)}}}(n,e),n){var c=n[s];c.get||c.set?Qe(t,e,s,c):Je(t,e,s,c)}var l=Re(t);t.__values__=t.__props__.filter((function(t){return!1!==l[t+Ye+"serializable"]}))}function en(t){var e=t.name,n=t.extends,i=t.mixins,r=function(t,e,n,i){var r=h.Component,a=Xe();if(a&&Ht(e,r)){if(Ht(a.cls,r))return O(3615),null;t=t||a.script}var o=function(t,e,n,i){var r=i.ctor,a=[r],o=r;Tt(o,"__ctors__",a.length>0?a:null,!0);var s=o.prototype;if(e&&(o.$super=e),n){for(var c=n.length-1;c>=0;c--){var l=n[c];$e(s,l.prototype),en._isCCClass(l)&&$e(Re(o),Re(l))}s.constructor=o}return Jt(t,o),o}(t,e,n,i);if(a)if(Ht(e,r)){var s=a.uuid;s&&Yt(s,o),a.cls=o}else Ht(a.cls,r)||(a.cls=o);return o}(e,n,i,t);e||(e=h.js.getClassName(r)),r._sealed=!0,n&&(n._sealed=!1);var a=t.properties;"function"==typeof a||n&&null===n.__props__||i&&i.some((function(t){return null===t.__props__}))?(Ke.push({cls:r,props:a,mixins:i}),r.__props__=r.__values__=null):tn(r,e,a,n,t.mixins);var o=t.editor;return o&&Ht(n,h.Component)&&h.Component._registerEditorProps(r,o),r}function nn(t){var e;return null==t||null===(e=t.hasOwnProperty)||void 0===e?void 0:e.call(t,"__values__")}en._isCCClass=function(t){var e;return null==t||null===(e=t.hasOwnProperty)||void 0===e?void 0:e.call(t,"__ctors__")},en.fastDefine=function(t,e,n){Jt(t,e);for(var i=e.__props__=e.__values__=Object.keys(n),r=Re(e),a=0;a<i.length;a++){var o=i[a];r[o+Ye+"visible"]=!1,r[o+Ye+"default"]=n[o]}},en.Attr=ze,en.attr=De,en.getInheritanceChain=function(t){for(var e=[];t=Gt(t);)t!==Object&&e.push(t);return e};var rn={Integer:"Number",Float:"Number",Boolean:"Boolean",String:"String"};function an(t,e,n,i){var r=null,a="";function o(){return a=i+Ye,r=Re(t)}"type"in e&&void 0===e.type&&R(3660,i,n);var s=e.type;s&&(rn[s]?(r||o())[a+"type"]=s:"Object"===s||("object"==typeof s?se.isEnum(s)?((r||o())[a+"type"]="Enum",r[a+"enumList"]=se.getList(s)):ae.isBitMask(s)&&((r||o())[a+"type"]="BitMask",r[a+"bitmaskList"]=ae.getList(s)):"function"==typeof s&&((r||o())[a+"type"]="Object",r[a+"ctor"]=s))),"default"in e&&((r||o())[a+"default"]=e.default);var c,l=function(t,n){if(t in e){var i=e[t];typeof i===n&&((r||o())[a+t]=i)}};e.editorOnly&&((r||o())[a+"editorOnly"]=!0),e.__internalFlags&We.STANDALONE?c=!0===e.serializable||0!=(e.__internalFlags&We.IMPLICIT_SERIALIZABLE):!1===e.serializable&&(c=!1),void 0!==c&&((r||o())[a+"serializable"]=c),l("formerlySerializedAs","string");var h=e.range;h&&Array.isArray(h)&&h.length>=2&&((r||o())[a+"min"]=h[0],r[a+"max"]=h[1],h.length>2&&(r[a+"step"]=h[2])),l("min","number"),l("max","number"),l("step","number")}en.isArray=function(t){return t=Ze(t),Array.isArray(t)},en.getDefault=Ze,en.escapeForJS=function(t){return JSON.stringify(t).replace(/\u2028/g,"\\u2028").replace(/\u2029/g,"\\u2029")},en.IDENTIFIER_RE=/^[A-Za-z_$][0-9A-Za-z_$]*$/,en.getNewValueTypeCode=!1,h.Class=en;var on=Math.PI/180,sn=180/Math.PI,cn=t("EPSILON",1e-6);function ln(t,e){return Math.abs(t-e)<=cn*Math.max(1,Math.abs(t),Math.abs(e))}function hn(t,e,n){return n=n||cn,Math.abs(t-e)<=n}function un(t,e,n){if(e>n){var i=e;e=n,n=i}return t<e?e:t>n?n:t}function _n(t){return t<0?0:t>1?1:t}function fn(t,e,n){return t+(e-t)*n}function dn(t){return t*on}function pn(t){return t*sn}var mn=t("random",Math.random);function vn(t,e){return Math.random()*(e-t)+t}function gn(t,e){return Math.floor(vn(t,e))}function yn(t){return(t=(9301*t+49297)%233280)/233280}function xn(t,e,n){return yn(t)*(n-e)+e}function Sn(t,e,n){return Math.floor(xn(t,e,n))}function An(t){return--t,t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,t|=t>>16,++t}function bn(t,e){return t-Math.floor(t/e)*e}function Cn(t,e){return t=bn(t,2*e),e-Math.abs(t-e)}function Tn(t,e,n){return(n-t)/(e-t)}function En(t){return Math.abs(t.x)>Math.abs(t.y)?Math.abs(t.x)>Math.abs(t.z)?t.x:t.z:Math.abs(t.y)>Math.abs(t.z)?t.y:t.z}function wn(t,e){return Math.abs(t)>Math.abs(e)?t:e}function In(t,e){e.forEach((function(e){Object.defineProperty(t,e,{enumerable:!0})}))}var Pn=1/255,Dn=t("Color",function(t){function e(e,n,i,r){var a;return(a=t.call(this)||this)._val=0,"string"==typeof e?a.fromHEX(e):void 0!==n?a.set(e,n,i,r):a.set(e),a}$(e,t),e.clone=function(t){var n=new e;return t._val?n._val=t._val:n._val=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,n},e.copy=function(t,e){return t.r=e.r,t.g=e.g,t.b=e.b,t.a=e.a,t},e.set=function(t,e,n,i,r){return t.r=e,t.g=n,t.b=i,t.a=r,t},e.fromHEX=function(t,e){e=0===e.indexOf("#")?e.substring(1):e,t.r=parseInt(e.substr(0,2),16)||0,t.g=parseInt(e.substr(2,2),16)||0,t.b=parseInt(e.substr(4,2),16)||0;var n=parseInt(e.substr(6,2),16);return t.a=Number.isNaN(n)?255:n,t._val=(t.a<<24>>>0)+(t.b<<16)+(t.g<<8)+t.r,t},e.add=function(t,e,n){return t.r=e.r+n.r,t.g=e.g+n.g,t.b=e.b+n.b,t.a=e.a+n.a,t},e.subtract=function(t,e,n){return t.r=e.r-n.r,t.g=e.g-n.g,t.b=e.b-n.b,t.a=e.a-n.a,t},e.multiply=function(t,e,n){return t.r=e.r*n.r,t.g=e.g*n.g,t.b=e.b*n.b,t.a=e.a*n.a,t},e.divide=function(t,e,n){return t.r=e.r/n.r,t.g=e.g/n.g,t.b=e.b/n.b,t.a=e.a/n.a,t},e.scale=function(t,e,n){return t.r=e.r*n,t.g=e.g*n,t.b=e.b*n,t.a=e.a*n,t},e.lerp=function(t,e,n,i){var r=e.r,a=e.g,o=e.b,s=e.a;return r+=(n.r-r)*i,a+=(n.g-a)*i,o+=(n.b-o)*i,s+=(n.a-s)*i,t._val=Math.floor((s<<24>>>0)+(o<<16)+(a<<8)+r),t},e.toArray=function(t,n,i){void 0===i&&(i=0);var r=n instanceof e||n.a>1?1/255:1;return t[i+0]=n.r*r,t[i+1]=n.g*r,t[i+2]=n.b*r,t[i+3]=n.a*r,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),e.r=255*t[n+0],e.g=255*t[n+1],e.b=255*t[n+2],e.a=255*t[n+3],e},e.strictEquals=function(t,e){return t.r===e.r&&t.g===e.g&&t.b===e.b&&t.a===e.a},e.equals=function(t,e,n){return void 0===n&&(n=cn),Math.abs(t.r-e.r)<=n*Math.max(1,Math.abs(t.r),Math.abs(e.r))&&Math.abs(t.g-e.g)<=n*Math.max(1,Math.abs(t.g),Math.abs(e.g))&&Math.abs(t.b-e.b)<=n*Math.max(1,Math.abs(t.b),Math.abs(e.b))&&Math.abs(t.a-e.a)<=n*Math.max(1,Math.abs(t.a),Math.abs(e.a))},e.hex=function(t){return(255*t.r<<24|255*t.g<<16|255*t.b<<8|255*t.a)>>>0};var n=e.prototype;return n.clone=function(){var t=new e;return t._val=this._val,t},n.equals=function(t){return t&&this._val===t._val},n.lerp=function(t,e){var n=this.r,i=this.g,r=this.b,a=this.a;return n+=(t.r-n)*e,i+=(t.g-i)*e,r+=(t.b-r)*e,a+=(t.a-a)*e,this._val=Math.floor((a<<24>>>0)+(r<<16)+(i<<8)+n),this},n.toString=function(){return"rgba("+this.r.toFixed()+", "+this.g.toFixed()+", "+this.b.toFixed()+", "+this.a.toFixed()+")"},n.toCSS=function(t){return void 0===t&&(t="rgba"),"rgba"===t?"rgba("+this.r+","+this.g+","+this.b+","+(this.a*Pn).toFixed(2)+")":"rgb"===t?"rgb("+this.r+","+this.g+","+this.b+")":"#"+this.toHEX(t)},n.fromHEX=function(t){t=0===t.indexOf("#")?t.substring(1):t;var e=parseInt(t.substr(0,2),16)||0,n=parseInt(t.substr(2,2),16)||0,i=parseInt(t.substr(4,2),16)||0,r=parseInt(t.substr(6,2),16);return r=Number.isNaN(r)?255:r,this._val=(r<<24>>>0)+(i<<16)+(n<<8)+(0|e),this},n.toHEX=function(t){void 0===t&&(t="#rrggbb");var e="0",n=[(this.r<16?e:"")+this.r.toString(16),(this.g<16?e:"")+this.g.toString(16),(this.b<16?e:"")+this.b.toString(16)];return"#rgb"===t?(n[0]=n[0][0],n[1]=n[1][0],n[2]=n[2][0]):"#rrggbbaa"===t&&n.push((this.a<16?e:"")+this.a.toString(16)),n.join("")},n.toRGBValue=function(){return 16777215&this._val},n.fromHSV=function(t,e,n){var i=0,r=0,a=0;if(0===e)i=r=a=n;else if(0===n)i=r=a=0;else{1===t&&(t=0),t*=6;var o=Math.floor(t),s=t-o,c=n*(1-e),l=n*(1-e*s),h=n*(1-e*(1-s));switch(o){case 0:i=n,r=h,a=c;break;case 1:i=l,r=n,a=c;break;case 2:i=c,r=n,a=h;break;case 3:i=c,r=l,a=n;break;case 4:i=h,r=c,a=n;break;case 5:i=n,r=c,a=l}}return i*=255,r*=255,a*=255,this._val=(this.a<<24>>>0)+(a<<16)+(r<<8)+(0|i),this},n.toHSV=function(){var t=this.r*Pn,e=this.g*Pn,n=this.b*Pn,i={h:0,s:0,v:0},r=Math.max(t,e,n),a=Math.min(t,e,n),o=0;return i.v=r,i.s=r?(r-a)/r:0,i.s?(o=r-a,i.h=t===r?(e-n)/o:e===r?2+(n-t)/o:4+(t-e)/o,i.h/=6,i.h<0&&(i.h+=1)):i.h=0,i},n.set=function(t,e,n,i){return"object"==typeof t?null!=t._val?this._val=t._val:(e=t.g||0,n=t.b||0,i="number"==typeof t.a?t.a:255,t=t.r||0,this._val=(i<<24>>>0)+(n<<16)+(e<<8)+(0|t)):(t=t||0,e=e||0,n=n||0,i="number"==typeof i?i:255,this._val=(i<<24>>>0)+(n<<16)+(e<<8)+(0|t)),this},n.multiply=function(t){var e=(255&this._val)*t.r>>8,n=(65280&this._val)*t.g>>8,i=(16711680&this._val)*t.b>>8,r=((4278190080&this._val)>>>8)*t.a;return this._val=4278190080&r|16711680&i|65280&n|255&e,this},n._set_r_unsafe=function(t){return this._val=(4294967040&this._val|t)>>>0,this},n._set_g_unsafe=function(t){return this._val=(4294902015&this._val|t<<8)>>>0,this},n._set_b_unsafe=function(t){return this._val=(4278255615&this._val|t<<16)>>>0,this},n._set_a_unsafe=function(t){return this._val=(16777215&this._val|t<<24)>>>0,this},Q(e,[{key:"r",get:function(){return 255&this._val},set:function(t){t=~~un(t,0,255),this._val=(4294967040&this._val|t)>>>0}},{key:"g",get:function(){return(65280&this._val)>>8},set:function(t){t=~~un(t,0,255),this._val=(4294902015&this._val|t<<8)>>>0}},{key:"b",get:function(){return(16711680&this._val)>>16},set:function(t){t=~~un(t,0,255),this._val=(4278255615&this._val|t<<16)>>>0}},{key:"a",get:function(){return(4278190080&this._val)>>>24},set:function(t){t=~~un(t,0,255),this._val=(16777215&this._val|t<<24)>>>0}},{key:"x",get:function(){return this.r*Pn},set:function(t){this.r=255*t}},{key:"y",get:function(){return this.g*Pn},set:function(t){this.g=255*t}},{key:"z",get:function(){return this.b*Pn},set:function(t){this.b=255*t}},{key:"w",get:function(){return this.a*Pn},set:function(t){this.a=255*t}}]),e}(ue));function Rn(t,e,n,i){return new Dn(t,e,n,i)}Dn.WHITE=Object.freeze(new Dn(255,255,255,255)),Dn.GRAY=Object.freeze(new Dn(127,127,127,255)),Dn.BLACK=Object.freeze(new Dn(0,0,0,255)),Dn.TRANSPARENT=Object.freeze(new Dn(0,0,0,0)),Dn.RED=Object.freeze(new Dn(255,0,0,255)),Dn.GREEN=Object.freeze(new Dn(0,255,0,255)),Dn.BLUE=Object.freeze(new Dn(0,0,255,255)),Dn.CYAN=Object.freeze(new Dn(0,255,255,255)),Dn.MAGENTA=Object.freeze(new Dn(255,0,255,255)),Dn.YELLOW=Object.freeze(new Dn(255,255,0,255)),en.fastDefine("cc.Color",Dn,{r:0,g:0,b:0,a:255}),h.Color=Dn,h.color=Rn;var Mn=t("Vec3",function(t){function e(e,n,i){var r;return r=t.call(this)||this,e&&"object"==typeof e?(r.x=e.x,r.y=e.y,r.z=e.z):(r.x=e||0,r.y=n||0,r.z=i||0),r}$(e,t),e.zero=function(t){return t.x=0,t.y=0,t.z=0,t},e.clone=function(t){return new e(t.x,t.y,t.z)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t},e.set=function(t,e,n,i){return t.x=e,t.y=n,t.z=i,t},e.add=function(t,e,n){return t.x=e.x+n.x,t.y=e.y+n.y,t.z=e.z+n.z,t},e.subtract=function(t,e,n){return t.x=e.x-n.x,t.y=e.y-n.y,t.z=e.z-n.z,t},e.multiply=function(t,e,n){return t.x=e.x*n.x,t.y=e.y*n.y,t.z=e.z*n.z,t},e.divide=function(t,e,n){return t.x=e.x/n.x,t.y=e.y/n.y,t.z=e.z/n.z,t},e.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t},e.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t},e.min=function(t,e,n){return t.x=Math.min(e.x,n.x),t.y=Math.min(e.y,n.y),t.z=Math.min(e.z,n.z),t},e.max=function(t,e,n){return t.x=Math.max(e.x,n.x),t.y=Math.max(e.y,n.y),t.z=Math.max(e.z,n.z),t},e.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t},e.multiplyScalar=function(t,e,n){return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t},e.scaleAndAdd=function(t,e,n,i){return t.x=e.x+n.x*i,t.y=e.y+n.y*i,t.z=e.z+n.z*i,t},e.distance=function(t,e){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z;return Math.sqrt(n*n+i*i+r*r)},e.squaredDistance=function(t,e){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z;return n*n+i*i+r*r},e.len=function(t){var e=t.x,n=t.y,i=t.z;return Math.sqrt(e*e+n*n+i*i)},e.lengthSqr=function(t){var e=t.x,n=t.y,i=t.z;return e*e+n*n+i*i},e.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t},e.invert=function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t},e.invertSafe=function(t,e){var n=e.x,i=e.y,r=e.z;return Math.abs(n)<cn?t.x=0:t.x=1/n,Math.abs(i)<cn?t.y=0:t.y=1/i,Math.abs(r)<cn?t.z=0:t.z=1/r,t},e.normalize=function(t,e){var n=e.x,i=e.y,r=e.z,a=n*n+i*i+r*r;return a>0&&(a=1/Math.sqrt(a),t.x=n*a,t.y=i*a,t.z=r*a),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},e.cross=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=n.x,s=n.y,c=n.z;return t.x=r*c-a*s,t.y=a*o-i*c,t.z=i*s-r*o,t},e.lerp=function(t,e,n,i){return t.x=e.x+i*(n.x-e.x),t.y=e.y+i*(n.y-e.y),t.z=e.z+i*(n.z-e.z),t},e.random=function(t,e){e=e||1;var n=2*mn()*Math.PI,i=2*mn()-1,r=Math.sqrt(1-i*i);return t.x=r*Math.cos(n)*e,t.y=r*Math.sin(n)*e,t.z=i*e,t},e.transformMat4=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=n.m03*i+n.m07*r+n.m11*a+n.m15;return o=o?Math.abs(1/o):1,t.x=(n.m00*i+n.m04*r+n.m08*a+n.m12)*o,t.y=(n.m01*i+n.m05*r+n.m09*a+n.m13)*o,t.z=(n.m02*i+n.m06*r+n.m10*a+n.m14)*o,t},e.transformMat4Normal=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=n.m03*i+n.m07*r+n.m11*a;return o=o?Math.abs(1/o):1,t.x=(n.m00*i+n.m04*r+n.m08*a)*o,t.y=(n.m01*i+n.m05*r+n.m09*a)*o,t.z=(n.m02*i+n.m06*r+n.m10*a)*o,t},e.transformMat3=function(t,e,n){var i=e.x,r=e.y,a=e.z;return t.x=i*n.m00+r*n.m03+a*n.m06,t.y=i*n.m01+r*n.m04+a*n.m07,t.z=i*n.m02+r*n.m05+a*n.m08,t},e.transformAffine=function(t,e,n){var i=e.x,r=e.y,a=e.z;return t.x=n.m00*i+n.m04*r+n.m08*a+n.m12,t.y=n.m01*i+n.m05*r+n.m09*a+n.m13,t.z=n.m02*i+n.m06*r+n.m10*a+n.m14,t},e.transformQuat=function(t,e,n){var i=n.w*e.x+n.y*e.z-n.z*e.y,r=n.w*e.y+n.z*e.x-n.x*e.z,a=n.w*e.z+n.x*e.y-n.y*e.x,o=-n.x*e.x-n.y*e.y-n.z*e.z;return t.x=i*n.w+o*-n.x+r*-n.z-a*-n.y,t.y=r*n.w+o*-n.y+a*-n.x-i*-n.z,t.z=a*n.w+o*-n.z+i*-n.y-r*-n.x,t},e.transformRTS=function(t,e,n,i,r){var a=e.x*r.x,o=e.y*r.y,s=e.z*r.z,c=n.w*a+n.y*s-n.z*o,l=n.w*o+n.z*a-n.x*s,h=n.w*s+n.x*o-n.y*a,u=-n.x*a-n.y*o-n.z*s;return t.x=c*n.w+u*-n.x+l*-n.z-h*-n.y+i.x,t.y=l*n.w+u*-n.y+h*-n.x-c*-n.z+i.y,t.z=h*n.w+u*-n.z+c*-n.y-l*-n.x+i.z,t},e.transformInverseRTS=function(t,e,n,i,r){var a=e.x-i.x,o=e.y-i.y,s=e.z-i.z,c=n.w*a-n.y*s+n.z*o,l=n.w*o-n.z*a+n.x*s,h=n.w*s-n.x*o+n.y*a,u=n.x*a+n.y*o+n.z*s;return t.x=(c*n.w+u*n.x+l*n.z-h*n.y)/r.x,t.y=(l*n.w+u*n.y+h*n.x-c*n.z)/r.y,t.z=(h*n.w+u*n.z+c*n.y-l*n.x)/r.z,t},e.rotateX=function(t,e,n,i){var r=e.x-n.x,a=e.y-n.y,o=e.z-n.z,s=Math.cos(i),c=Math.sin(i),l=r,h=a*s-o*c,u=a*c+o*s;return t.x=l+n.x,t.y=h+n.y,t.z=u+n.z,t},e.rotateY=function(t,e,n,i){var r=e.x-n.x,a=e.y-n.y,o=e.z-n.z,s=Math.cos(i),c=Math.sin(i),l=o*c+r*s,h=a,u=o*s-r*c;return t.x=l+n.x,t.y=h+n.y,t.z=u+n.z,t},e.rotateZ=function(t,e,n,i){var r=e.x-n.x,a=e.y-n.y,o=e.z-n.z,s=Math.cos(i),c=Math.sin(i),l=r*s-a*c,h=r*c+a*s,u=o;return t.x=l+n.x,t.y=h+n.y,t.z=u+n.z,t},e.toArray=function(t,e,n){return void 0===n&&(n=0),t[n+0]=e.x,t[n+1]=e.y,t[n+2]=e.z,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),t.x=e[n+0],t.y=e[n+1],t.z=e[n+2],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z},e.equals=function(t,e,n){void 0===n&&(n=cn);var i=t.x,r=t.y,a=t.z,o=e.x,s=e.y,c=e.z;return Math.abs(i-o)<=n*Math.max(1,Math.abs(i),Math.abs(o))&&Math.abs(r-s)<=n*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(a-c)<=n*Math.max(1,Math.abs(a),Math.abs(c))},e.angle=function(t,n){e.normalize(On,t),e.normalize(Nn,n);var i=e.dot(On,Nn);return i>1?0:i<-1?Math.PI:Math.acos(i)},e.projectOnPlane=function(t,n,i){return e.subtract(t,n,e.project(t,n,i))},e.project=function(t,n,i){var r=e.lengthSqr(i);return r<1e-6?e.set(t,0,0,0):e.multiplyScalar(t,i,e.dot(n,i)/r)};var n=e.prototype;return n.clone=function(){return new e(this.x,this.y,this.z)},n.set=function(t,e,n){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t||0,this.y=e||0,this.z=n||0),this},n.equals=function(t,e){return void 0===e&&(e=cn),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))},n.equals3f=function(t,e,n,i){return void 0===i&&(i=cn),Math.abs(this.x-t)<=i*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=i*Math.max(1,Math.abs(this.y),Math.abs(e))&&Math.abs(this.z-n)<=i*Math.max(1,Math.abs(this.z),Math.abs(n))},n.strictEquals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z},n.strictEquals3f=function(t,e,n){return this.x===t&&this.y===e&&this.z===n},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+")"},n.lerp=function(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this.z+=e*(t.z-this.z),this},n.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},n.add3f=function(t,e,n){return this.x+=t,this.y+=e,this.z+=n,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},n.subtract3f=function(t,e,n){return this.x-=t,this.y-=e,this.z-=n,this},n.multiplyScalar=function(t){return"object"==typeof t&&console.warn("should use Vec3.multiply for vector * vector operation"),this.x*=t,this.y*=t,this.z*=t,this},n.multiply=function(t){return"object"!=typeof t&&console.warn("should use Vec3.scale for vector * scalar operation"),this.x*=t.x,this.y*=t.y,this.z*=t.z,this},n.multiply3f=function(t,e,n){return this.x*=t,this.y*=e,this.z*=n,this},n.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this},n.divide3f=function(t,e,n){return this.x/=t,this.y/=e,this.z/=n,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},n.clampf=function(t,e){return this.x=un(this.x,t.x,e.x),this.y=un(this.y,t.y,e.y),this.z=un(this.z,t.z,e.z),this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z},n.cross=function(t){var e=this.x,n=this.y,i=this.z,r=t.x,a=t.y,o=t.z;return this.x=n*o-i*a,this.y=i*r-e*o,this.z=e*a-n*r,this},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z},n.normalize=function(){var t=this.x,e=this.y,n=this.z,i=t*t+e*e+n*n;return i>0&&(i=1/Math.sqrt(i),this.x=t*i,this.y=e*i,this.z=n*i),this},n.transformMat4=function(t){var e=this.x,n=this.y,i=this.z,r=t.m03*e+t.m07*n+t.m11*i+t.m15;return r=r?1/r:1,this.x=(t.m00*e+t.m04*n+t.m08*i+t.m12)*r,this.y=(t.m01*e+t.m05*n+t.m09*i+t.m13)*r,this.z=(t.m02*e+t.m06*n+t.m10*i+t.m14)*r,this},e}(ue));Mn.UNIT_X=Object.freeze(new Mn(1,0,0)),Mn.UNIT_Y=Object.freeze(new Mn(0,1,0)),Mn.UNIT_Z=Object.freeze(new Mn(0,0,1)),Mn.RIGHT=Object.freeze(new Mn(1,0,0)),Mn.UP=Object.freeze(new Mn(0,1,0)),Mn.FORWARD=Object.freeze(new Mn(0,0,-1)),Mn.ZERO=Object.freeze(new Mn(0,0,0)),Mn.ONE=Object.freeze(new Mn(1,1,1)),Mn.NEG_ONE=Object.freeze(new Mn(-1,-1,-1));var On=new Mn,Nn=new Mn;function Bn(t,e,n){return new Mn(t,e,n)}en.fastDefine("cc.Vec3",Mn,{x:0,y:0,z:0}),h.Vec3=Mn,h.v3=Bn;var Ln=t("Mat3",function(t){function e(e,n,i,r,a,o,s,c,l){var h;return void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=1),h=t.call(this)||this,"object"==typeof e?(h.m00=e.m00,h.m01=e.m01,h.m02=e.m02,h.m03=e.m03,h.m04=e.m04,h.m05=e.m05,h.m06=e.m06,h.m07=e.m07,h.m08=e.m08):(h.m00=e,h.m01=n,h.m02=i,h.m03=r,h.m04=a,h.m05=o,h.m06=s,h.m07=c,h.m08=l),h}$(e,t),e.clone=function(t){return new e(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08)},e.copy=function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t},e.set=function(t,e,n,i,r,a,o,s,c,l){return t.m00=e,t.m01=n,t.m02=i,t.m03=r,t.m04=a,t.m05=o,t.m06=s,t.m07=c,t.m08=l,t},e.identity=function(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},e.transpose=function(t,e){if(t===e){var n=e.m01,i=e.m02,r=e.m05;t.m01=e.m03,t.m02=e.m06,t.m03=n,t.m05=e.m07,t.m06=i,t.m07=r}else t.m00=e.m00,t.m01=e.m03,t.m02=e.m06,t.m03=e.m01,t.m04=e.m04,t.m05=e.m07,t.m06=e.m02,t.m07=e.m05,t.m08=e.m08;return t},e.invert=function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,o=e.m04,s=e.m05,c=e.m06,l=e.m07,h=e.m08,u=h*o-s*l,_=-h*a+s*c,f=l*a-o*c,d=n*u+i*_+r*f;return 0===d?(t.m00=0,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=0,t.m06=0,t.m07=0,t.m08=0,t):(d=1/d,t.m00=u*d,t.m01=(-h*i+r*l)*d,t.m02=(s*i-r*o)*d,t.m03=_*d,t.m04=(h*n-r*c)*d,t.m05=(-s*n+r*a)*d,t.m06=f*d,t.m07=(-l*n+i*c)*d,t.m08=(o*n-i*a)*d,t)},e.determinant=function(t){var e=t.m00,n=t.m01,i=t.m02,r=t.m03,a=t.m04,o=t.m05,s=t.m06,c=t.m07,l=t.m08;return e*(l*a-o*c)+n*(-l*r+o*s)+i*(c*r-a*s)},e.multiply=function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,c=e.m05,l=e.m06,h=e.m07,u=e.m08,_=n.m00,f=n.m01,d=n.m02,p=n.m03,m=n.m04,v=n.m05,g=n.m06,y=n.m07,x=n.m08;return t.m00=_*i+f*o+d*l,t.m01=_*r+f*s+d*h,t.m02=_*a+f*c+d*u,t.m03=p*i+m*o+v*l,t.m04=p*r+m*s+v*h,t.m05=p*a+m*c+v*u,t.m06=g*i+y*o+x*l,t.m07=g*r+y*s+x*h,t.m08=g*a+y*c+x*u,t},e.multiplyMat4=function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,c=e.m05,l=e.m06,h=e.m07,u=e.m08,_=n.m00,f=n.m01,d=n.m02,p=n.m04,m=n.m05,v=n.m06,g=n.m08,y=n.m09,x=n.m10;return t.m00=_*i+f*o+d*l,t.m01=_*r+f*s+d*h,t.m02=_*a+f*c+d*u,t.m03=p*i+m*o+v*l,t.m04=p*r+m*s+v*h,t.m05=p*a+m*c+v*u,t.m06=g*i+y*o+x*l,t.m07=g*r+y*s+x*h,t.m08=g*a+y*c+x*u,t},e.transform=function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,c=e.m05,l=e.m06,h=e.m07,u=e.m08,_=n.x,f=n.y;return t.m00=i,t.m01=r,t.m02=a,t.m03=o,t.m04=s,t.m05=c,t.m06=_*i+f*o+l,t.m07=_*r+f*s+h,t.m08=_*a+f*c+u,t},e.scale=function(t,e,n){var i=n.x,r=n.y;return t.m00=i*e.m00,t.m01=i*e.m01,t.m02=i*e.m02,t.m03=r*e.m03,t.m04=r*e.m04,t.m05=r*e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t},e.rotate=function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,c=e.m05,l=e.m06,h=e.m07,u=e.m08,_=Math.sin(n),f=Math.cos(n);return t.m00=f*i+_*o,t.m01=f*r+_*s,t.m02=f*a+_*c,t.m03=f*o-_*i,t.m04=f*s-_*r,t.m05=f*c-_*a,t.m06=l,t.m07=h,t.m08=u,t},e.fromMat4=function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m04,t.m04=e.m05,t.m05=e.m06,t.m06=e.m08,t.m07=e.m09,t.m08=e.m10,t},e.fromViewUp=function(t,n,i){return Mn.lengthSqr(n)<cn*cn?(e.identity(t),t):(i=i||Mn.UNIT_Y,Mn.normalize(Fn,Mn.cross(Fn,i,n)),Mn.lengthSqr(Fn)<cn*cn?(e.identity(t),t):(Mn.cross(Vn,n,Fn),e.set(t,Fn.x,Fn.y,Fn.z,Vn.x,Vn.y,Vn.z,n.x,n.y,n.z),t))},e.fromTranslation=function(t,e){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=1,t.m05=0,t.m06=e.x,t.m07=e.y,t.m08=1,t},e.fromScaling=function(t,e){return t.m00=e.x,t.m01=0,t.m02=0,t.m03=0,t.m04=e.y,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},e.fromRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t.m00=i,t.m01=n,t.m02=0,t.m03=-n,t.m04=i,t.m05=0,t.m06=0,t.m07=0,t.m08=1,t},e.fromQuat=function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w,o=n+n,s=i+i,c=r+r,l=n*o,h=i*o,u=i*s,_=r*o,f=r*s,d=r*c,p=a*o,m=a*s,v=a*c;return t.m00=1-u-d,t.m03=h-v,t.m06=_+m,t.m01=h+v,t.m04=1-l-d,t.m07=f-p,t.m02=_-m,t.m05=f+p,t.m08=1-l-u,t},e.inverseTransposeMat4=function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,o=e.m04,s=e.m05,c=e.m06,l=e.m07,h=e.m08,u=e.m09,_=e.m10,f=e.m11,d=e.m12,p=e.m13,m=e.m14,v=e.m15,g=n*s-i*o,y=n*c-r*o,x=n*l-a*o,S=i*c-r*s,A=i*l-a*s,b=r*l-a*c,C=h*p-u*d,T=h*m-_*d,E=h*v-f*d,w=u*m-_*p,I=u*v-f*p,P=_*v-f*m,D=g*P-y*I+x*w+S*E-A*T+b*C;return D?(D=1/D,t.m00=(s*P-c*I+l*w)*D,t.m01=(c*E-o*P-l*T)*D,t.m02=(o*I-s*E+l*C)*D,t.m03=(r*I-i*P-a*w)*D,t.m04=(n*P-r*E+a*T)*D,t.m05=(i*E-n*I-a*C)*D,t.m06=(p*b-m*A+v*S)*D,t.m07=(m*x-d*b-v*y)*D,t.m08=(d*A-p*x+v*g)*D,t):null},e.toArray=function(t,e,n){return void 0===n&&(n=0),t[n+0]=e.m00,t[n+1]=e.m01,t[n+2]=e.m02,t[n+3]=e.m03,t[n+4]=e.m04,t[n+5]=e.m05,t[n+6]=e.m06,t[n+7]=e.m07,t[n+8]=e.m08,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),t.m00=e[n+0],t.m01=e[n+1],t.m02=e[n+2],t.m03=e[n+3],t.m04=e[n+4],t.m05=e[n+5],t.m06=e[n+6],t.m07=e[n+7],t.m08=e[n+8],t},e.add=function(t,e,n){return t.m00=e.m00+n.m00,t.m01=e.m01+n.m01,t.m02=e.m02+n.m02,t.m03=e.m03+n.m03,t.m04=e.m04+n.m04,t.m05=e.m05+n.m05,t.m06=e.m06+n.m06,t.m07=e.m07+n.m07,t.m08=e.m08+n.m08,t},e.subtract=function(t,e,n){return t.m00=e.m00-n.m00,t.m01=e.m01-n.m01,t.m02=e.m02-n.m02,t.m03=e.m03-n.m03,t.m04=e.m04-n.m04,t.m05=e.m05-n.m05,t.m06=e.m06-n.m06,t.m07=e.m07-n.m07,t.m08=e.m08-n.m08,t},e.multiplyScalar=function(t,e,n){return t.m00=e.m00*n,t.m01=e.m01*n,t.m02=e.m02*n,t.m03=e.m03*n,t.m04=e.m04*n,t.m05=e.m05*n,t.m06=e.m06*n,t.m07=e.m07*n,t.m08=e.m08*n,t},e.multiplyScalarAndAdd=function(t,e,n,i){return t.m00=n.m00*i+e.m00,t.m01=n.m01*i+e.m01,t.m02=n.m02*i+e.m02,t.m03=n.m03*i+e.m03,t.m04=n.m04*i+e.m04,t.m05=n.m05*i+e.m05,t.m06=n.m06*i+e.m06,t.m07=n.m07*i+e.m07,t.m08=n.m08*i+e.m08,t},e.strictEquals=function(t,e){return t.m00===e.m00&&t.m01===e.m01&&t.m02===e.m02&&t.m03===e.m03&&t.m04===e.m04&&t.m05===e.m05&&t.m06===e.m06&&t.m07===e.m07&&t.m08===e.m08},e.equals=function(t,e,n){return void 0===n&&(n=cn),Math.abs(t.m00-e.m00)<=n*Math.max(1,Math.abs(t.m00),Math.abs(e.m00))&&Math.abs(t.m01-e.m01)<=n*Math.max(1,Math.abs(t.m01),Math.abs(e.m01))&&Math.abs(t.m02-e.m02)<=n*Math.max(1,Math.abs(t.m02),Math.abs(e.m02))&&Math.abs(t.m03-e.m03)<=n*Math.max(1,Math.abs(t.m03),Math.abs(e.m03))&&Math.abs(t.m04-e.m04)<=n*Math.max(1,Math.abs(t.m04),Math.abs(e.m04))&&Math.abs(t.m05-e.m05)<=n*Math.max(1,Math.abs(t.m05),Math.abs(e.m05))&&Math.abs(t.m06-e.m06)<=n*Math.max(1,Math.abs(t.m06),Math.abs(e.m06))&&Math.abs(t.m07-e.m07)<=n*Math.max(1,Math.abs(t.m07),Math.abs(e.m07))&&Math.abs(t.m08-e.m08)<=n*Math.max(1,Math.abs(t.m08),Math.abs(e.m08))};var n=e.prototype;return n.clone=function(){var t=this;return new e(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08)},n.set=function(t,e,n,i,r,a,o,s,c){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=1),"object"==typeof t?(this.m00=t.m00,this.m01=t.m01,this.m02=t.m02,this.m03=t.m03,this.m04=t.m04,this.m05=t.m05,this.m06=t.m06,this.m07=t.m07,this.m08=t.m08):(this.m00=t,this.m01=e,this.m02=n,this.m03=i,this.m04=r,this.m05=a,this.m06=o,this.m07=s,this.m08=c),this},n.equals=function(t,e){return void 0===e&&(e=cn),Math.abs(this.m00-t.m00)<=e*Math.max(1,Math.abs(this.m00),Math.abs(t.m00))&&Math.abs(this.m01-t.m01)<=e*Math.max(1,Math.abs(this.m01),Math.abs(t.m01))&&Math.abs(this.m02-t.m02)<=e*Math.max(1,Math.abs(this.m02),Math.abs(t.m02))&&Math.abs(this.m03-t.m03)<=e*Math.max(1,Math.abs(this.m03),Math.abs(t.m03))&&Math.abs(this.m04-t.m04)<=e*Math.max(1,Math.abs(this.m04),Math.abs(t.m04))&&Math.abs(this.m05-t.m05)<=e*Math.max(1,Math.abs(this.m05),Math.abs(t.m05))&&Math.abs(this.m06-t.m06)<=e*Math.max(1,Math.abs(this.m06),Math.abs(t.m06))&&Math.abs(this.m07-t.m07)<=e*Math.max(1,Math.abs(this.m07),Math.abs(t.m07))&&Math.abs(this.m08-t.m08)<=e*Math.max(1,Math.abs(this.m08),Math.abs(t.m08))},n.strictEquals=function(t){return this.m00===t.m00&&this.m01===t.m01&&this.m02===t.m02&&this.m03===t.m03&&this.m04===t.m04&&this.m05===t.m05&&this.m06===t.m06&&this.m07===t.m07&&this.m08===t.m08},n.toString=function(){var t=this;return"[\n"+t.m00+", "+t.m01+", "+t.m02+",\n"+t.m03+",\n"+t.m04+", "+t.m05+",\n"+t.m06+", "+t.m07+",\n"+t.m08+"\n]"},n.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=1,this.m05=0,this.m06=0,this.m07=0,this.m08=1,this},n.transpose=function(){var t=this.m01,e=this.m02,n=this.m05;return this.m01=this.m03,this.m02=this.m06,this.m03=t,this.m05=this.m07,this.m06=e,this.m07=n,this},n.invert=function(){var t=this.m00,e=this.m01,n=this.m02,i=this.m03,r=this.m04,a=this.m05,o=this.m06,s=this.m07,c=this.m08,l=c*r-a*s,h=-c*i+a*o,u=s*i-r*o,_=t*l+e*h+n*u;return 0===_?(this.set(0,0,0,0,0,0,0,0,0),this):(_=1/_,this.m00=l*_,this.m01=(-c*e+n*s)*_,this.m02=(a*e-n*r)*_,this.m03=h*_,this.m04=(c*t-n*o)*_,this.m05=(-a*t+n*i)*_,this.m06=u*_,this.m07=(-s*t+e*o)*_,this.m08=(r*t-e*i)*_,this)},n.determinant=function(){var t=this.m00,e=this.m01,n=this.m02,i=this.m03,r=this.m04,a=this.m05,o=this.m06,s=this.m07,c=this.m08;return t*(c*r-a*s)+e*(-c*i+a*o)+n*(s*i-r*o)},n.add=function(t){return this.m00+=t.m00,this.m01+=t.m01,this.m02+=t.m02,this.m03+=t.m03,this.m04+=t.m04,this.m05+=t.m05,this.m06+=t.m06,this.m07+=t.m07,this.m08+=t.m08,this},n.subtract=function(t){return this.m00-=t.m00,this.m01-=t.m01,this.m02-=t.m02,this.m03-=t.m03,this.m04-=t.m04,this.m05-=t.m05,this.m06-=t.m06,this.m07-=t.m07,this.m08-=t.m08,this},n.multiply=function(t){var e=this.m00,n=this.m01,i=this.m02,r=this.m03,a=this.m04,o=this.m05,s=this.m06,c=this.m07,l=this.m08,h=t.m00,u=t.m01,_=t.m02,f=t.m03,d=t.m04,p=t.m05,m=t.m06,v=t.m07,g=t.m08;return this.m00=h*e+u*r+_*s,this.m01=h*n+u*a+_*c,this.m02=h*i+u*o+_*l,this.m03=f*e+d*r+p*s,this.m04=f*n+d*a+p*c,this.m05=f*i+d*o+p*l,this.m06=m*e+v*r+g*s,this.m07=m*n+v*a+g*c,this.m08=m*i+v*o+g*l,this},n.multiplyScalar=function(t){return this.m00*=t,this.m01*=t,this.m02*=t,this.m03*=t,this.m04*=t,this.m05*=t,this.m06*=t,this.m07*=t,this.m08*=t,this},n.scale=function(t){var e=t.x,n=t.y;return this.m00=e*this.m00,this.m01=e*this.m01,this.m02=e*this.m02,this.m03=n*this.m03,this.m04=n*this.m04,this.m05=n*this.m05,this.m06=this.m06,this.m07=this.m07,this.m08=this.m08,this},n.rotate=function(t){var e=this.m00,n=this.m01,i=this.m02,r=this.m03,a=this.m04,o=this.m05,s=this.m06,c=this.m07,l=this.m08,h=Math.sin(t),u=Math.cos(t);return this.m00=u*e+h*r,this.m01=u*n+h*a,this.m02=u*i+h*o,this.m03=u*r-h*e,this.m04=u*a-h*n,this.m05=u*o-h*i,this.m06=s,this.m07=c,this.m08=l,this},n.fromQuat=function(t){var e=t.x,n=t.y,i=t.z,r=t.w,a=e+e,o=n+n,s=i+i,c=e*a,l=n*a,h=n*o,u=i*a,_=i*o,f=i*s,d=r*a,p=r*o,m=r*s;return this.m00=1-h-f,this.m03=l-m,this.m06=u+p,this.m01=l+m,this.m04=1-c-f,this.m07=_-d,this.m02=u-p,this.m05=_+d,this.m08=1-c-h,this},e}(ue));Ln.IDENTITY=Object.freeze(new Ln);var Fn=new Mn,Vn=new Mn;en.fastDefine("cc.Mat3",Ln,{m00:1,m01:0,m02:0,m03:0,m04:1,m05:0,m06:0,m07:0,m08:1}),h.Mat3=Ln;var zn=t("Quat",function(t){function e(e,n,i,r){var a;return a=t.call(this)||this,e&&"object"==typeof e?(a.x=e.x,a.y=e.y,a.z=e.z,a.w=e.w):(a.x=e||0,a.y=n||0,a.z=i||0,a.w=null!=r?r:1),a}$(e,t),e.clone=function(t){return new e(t.x,t.y,t.z,t.w)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t},e.set=function(t,e,n,i,r){return t.x=e,t.y=n,t.z=i,t.w=r,t},e.identity=function(t){return t.x=0,t.y=0,t.z=0,t.w=1,t},e.rotationTo=function(t,n,i){var r=Mn.dot(n,i);return r<-.999999?(Mn.cross(Gn,Mn.UNIT_X,n),Gn.length()<1e-6&&Mn.cross(Gn,Mn.UNIT_Y,n),Mn.normalize(Gn,Gn),e.fromAxisAngle(t,Gn,Math.PI),t):r>.999999?(t.x=0,t.y=0,t.z=0,t.w=1,t):(Mn.cross(Gn,n,i),t.x=Gn.x,t.y=Gn.y,t.z=Gn.z,t.w=1+r,e.normalize(t,t))},e.getAxisAngle=function(t,e){var n=2*Math.acos(e.w),i=Math.sin(n/2);return 0!==i?(t.x=e.x/i,t.y=e.y/i,t.z=e.z/i):(t.x=1,t.y=0,t.z=0),n},e.multiply=function(t,e,n){var i=e.x*n.w+e.w*n.x+e.y*n.z-e.z*n.y,r=e.y*n.w+e.w*n.y+e.z*n.x-e.x*n.z,a=e.z*n.w+e.w*n.z+e.x*n.y-e.y*n.x,o=e.w*n.w-e.x*n.x-e.y*n.y-e.z*n.z;return t.x=i,t.y=r,t.z=a,t.w=o,t},e.multiplyScalar=function(t,e,n){return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t.w=e.w*n,t},e.scaleAndAdd=function(t,e,n,i){return t.x=e.x+n.x*i,t.y=e.y+n.y*i,t.z=e.z+n.z*i,t.w=e.w+n.w*i,t},e.rotateX=function(t,e,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),a=e.x,o=e.y,s=e.z,c=e.w;return t.x=a*r+c*i,t.y=o*r+s*i,t.z=s*r-o*i,t.w=c*r-a*i,t},e.rotateY=function(t,e,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),a=e.x,o=e.y,s=e.z,c=e.w;return t.x=a*r-s*i,t.y=o*r+c*i,t.z=s*r+a*i,t.w=c*r-o*i,t},e.rotateZ=function(t,e,n){n*=.5;var i=Math.sin(n),r=Math.cos(n),a=e.x,o=e.y,s=e.z,c=e.w;return t.x=a*r+o*i,t.y=o*r-a*i,t.z=s*r+c*i,t.w=c*r-s*i,t},e.rotateAround=function(t,n,i,r){return e.invert(kn,n),Mn.transformQuat(Gn,i,kn),e.fromAxisAngle(kn,Gn,r),e.multiply(t,n,kn),t},e.rotateAroundLocal=function(t,n,i,r){return e.fromAxisAngle(kn,i,r),e.multiply(t,n,kn),t},e.calculateW=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=Math.sqrt(Math.abs(1-e.x*e.x-e.y*e.y-e.z*e.z)),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},e.lerp=function(t,e,n,i){return t.x=e.x+i*(n.x-e.x),t.y=e.y+i*(n.y-e.y),t.z=e.z+i*(n.z-e.z),t.w=e.w+i*(n.w-e.w),t},e.slerp=function(t,e,n,i){var r=0,a=0,o=n.x,s=n.y,c=n.z,l=n.w,h=e.x*n.x+e.y*n.y+e.z*n.z+e.w*n.w;if(h<0&&(h=-h,o=-o,s=-s,c=-c,l=-l),1-h>1e-6){var u=Math.acos(h),_=Math.sin(u);r=Math.sin((1-i)*u)/_,a=Math.sin(i*u)/_}else r=1-i,a=i;return t.x=r*e.x+a*o,t.y=r*e.y+a*s,t.z=r*e.z+a*c,t.w=r*e.w+a*l,t},e.sqlerp=function(t,n,i,r,a,o){return e.slerp(kn,n,a,o),e.slerp(Un,i,r,o),e.slerp(t,kn,Un,2*o*(1-o)),t},e.invert=function(t,e){var n=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w,i=n?1/n:0;return t.x=-e.x*i,t.y=-e.y*i,t.z=-e.z*i,t.w=e.w*i,t},e.conjugate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=e.w,t},e.len=function(t){return Math.sqrt(t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w)},e.lengthSqr=function(t){return t.x*t.x+t.y*t.y+t.z*t.z+t.w*t.w},e.normalize=function(t,e){var n=e.x*e.x+e.y*e.y+e.z*e.z+e.w*e.w;return n>0&&(n=1/Math.sqrt(n),t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t.w=e.w*n),t},e.fromAxes=function(t,n,i,r){return Ln.set(Hn,n.x,n.y,n.z,i.x,i.y,i.z,r.x,r.y,r.z),e.normalize(t,e.fromMat3(t,Hn))},e.fromViewUp=function(t,n,i){return Ln.fromViewUp(Hn,n,i),e.normalize(t,e.fromMat3(t,Hn))},e.fromAxisAngle=function(t,e,n){n*=.5;var i=Math.sin(n);return t.x=i*e.x,t.y=i*e.y,t.z=i*e.z,t.w=Math.cos(n),t},e.fromMat3=function(t,e){var n=e.m00,i=e.m03,r=e.m06,a=e.m01,o=e.m04,s=e.m07,c=e.m02,l=e.m05,h=e.m08,u=n+o+h;if(u>0){var _=.5/Math.sqrt(u+1);t.w=.25/_,t.x=(l-s)*_,t.y=(r-c)*_,t.z=(a-i)*_}else if(n>o&&n>h){var f=2*Math.sqrt(1+n-o-h);t.w=(l-s)/f,t.x=.25*f,t.y=(i+a)/f,t.z=(r+c)/f}else if(o>h){var d=2*Math.sqrt(1+o-n-h);t.w=(r-c)/d,t.x=(i+a)/d,t.y=.25*d,t.z=(s+l)/d}else{var p=2*Math.sqrt(1+h-n-o);t.w=(a-i)/p,t.x=(r+c)/p,t.y=(s+l)/p,t.z=.25*p}return t},e.fromEuler=function(t,e,n,i){e*=jn,n*=jn,i*=jn;var r=Math.sin(e),a=Math.cos(e),o=Math.sin(n),s=Math.cos(n),c=Math.sin(i),l=Math.cos(i);return t.x=r*s*l+a*o*c,t.y=a*o*l+r*s*c,t.z=a*s*c-r*o*l,t.w=a*s*l-r*o*c,t},e.fromAngleZ=function(t,e){return e*=jn,t.x=t.y=0,t.z=Math.sin(e),t.w=Math.cos(e),t},e.toAxisX=function(t,e){var n=2*e.y,i=2*e.z;return t.x=1-n*e.y-i*e.z,t.y=n*e.x+i*e.w,t.z=i*e.x+n*e.w,t},e.toAxisY=function(t,e){var n=2*e.x,i=2*e.y,r=2*e.z;return t.x=i*e.x-r*e.w,t.y=1-n*e.x-r*e.z,t.z=r*e.y+n*e.w,t},e.toAxisZ=function(t,e){var n=2*e.x,i=2*e.y,r=2*e.z;return t.x=r*e.x-i*e.w,t.y=r*e.y-n*e.w,t.z=1-n*e.x-i*e.y,t},e.toEuler=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=e.w,s=0,c=0,l=0,h=i*r+a*o;if(h>.499999)s=0,c=pn(2*Math.atan2(i,o)),l=90;else if(h<-.499999)s=0,c=-pn(2*Math.atan2(i,o)),l=-90;else{var u=i*i,_=r*r,f=a*a;s=pn(Math.atan2(2*i*o-2*r*a,1-2*u-2*f)),c=pn(Math.atan2(2*r*o-2*i*a,1-2*_-2*f)),l=pn(Math.asin(2*h)),n&&(s=-180*Math.sign(s+1e-6)+s,c=-180*Math.sign(c+1e-6)+c,l=180*Math.sign(l+1e-6)-l)}return t.x=s,t.y=c,t.z=l,t},e.toArray=function(t,e,n){return void 0===n&&(n=0),t[n+0]=e.x,t[n+1]=e.y,t[n+2]=e.z,t[n+3]=e.w,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),t.x=e[n+0],t.y=e[n+1],t.z=e[n+2],t.w=e[n+3],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},e.equals=function(t,e,n){return void 0===n&&(n=cn),Math.abs(t.x-e.x)<=n*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=n*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=n*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=n*Math.max(1,Math.abs(t.w),Math.abs(e.w))};var n=e.prototype;return n.clone=function(){return new e(this.x,this.y,this.z,this.w)},n.set=function(t,e,n,i){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=n||0,this.w=null!=i?i:1),this},n.equals=function(t,e){return void 0===e&&(e=cn),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))&&Math.abs(this.w-t.w)<=e*Math.max(1,Math.abs(this.w),Math.abs(t.w))},n.strictEquals=function(t){return t&&this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},n.getEulerAngles=function(t){return e.toEuler(t,this)},n.lerp=function(t,e){return this.x+=e*(t.x-this.x),this.y+=e*(t.y-this.y),this.z+=e*(t.z-this.z),this.w+=e*(t.w-this.w),this},n.slerp=function(t,n){return e.slerp(this,this,t,n)},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},e}(ue));zn.IDENTITY=Object.freeze(new zn);var kn=new zn,Un=new zn,Gn=new Mn,Hn=new Ln,jn=.5*Math.PI/180;function Wn(t,e,n,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),new zn(t,e,n,i)}en.fastDefine("cc.Quat",zn,{x:0,y:0,z:0,w:1}),h.Quat=zn,h.quat=Wn;var qn=Object.freeze([Object.freeze([1,0,0,1]),Object.freeze([0,1,-1,0]),Object.freeze([-1,0,0,-1]),Object.freeze([0,-1,1,0])]),Xn=t("Mat4",function(t){function e(e,n,i,r,a,o,s,c,l,h,u,_,f,d,p,m){var v;return void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===h&&(h=0),void 0===u&&(u=1),void 0===_&&(_=0),void 0===f&&(f=0),void 0===d&&(d=0),void 0===p&&(p=0),void 0===m&&(m=1),(v=t.call(this)||this).m00=void 0,v.m01=void 0,v.m02=void 0,v.m03=void 0,v.m04=void 0,v.m05=void 0,v.m06=void 0,v.m07=void 0,v.m08=void 0,v.m09=void 0,v.m10=void 0,v.m11=void 0,v.m12=void 0,v.m13=void 0,v.m14=void 0,v.m15=void 0,"object"==typeof e?(v.m00=e.m00,v.m01=e.m01,v.m02=e.m02,v.m03=e.m03,v.m04=e.m04,v.m05=e.m05,v.m06=e.m06,v.m07=e.m07,v.m08=e.m08,v.m09=e.m09,v.m10=e.m10,v.m11=e.m11,v.m12=e.m12,v.m13=e.m13,v.m14=e.m14,v.m15=e.m15):(v.m00=e,v.m01=n,v.m02=i,v.m03=r,v.m04=a,v.m05=o,v.m06=s,v.m07=c,v.m08=l,v.m09=h,v.m10=u,v.m11=_,v.m12=f,v.m13=d,v.m14=p,v.m15=m),v}$(e,t),e.clone=function(t){return new e(t.m00,t.m01,t.m02,t.m03,t.m04,t.m05,t.m06,t.m07,t.m08,t.m09,t.m10,t.m11,t.m12,t.m13,t.m14,t.m15)},e.copy=function(t,e){return t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15,t},e.set=function(t,e,n,i,r,a,o,s,c,l,h,u,_,f,d,p,m){return t.m00=e,t.m01=n,t.m02=i,t.m03=r,t.m04=a,t.m05=o,t.m06=s,t.m07=c,t.m08=l,t.m09=h,t.m10=u,t.m11=_,t.m12=f,t.m13=d,t.m14=p,t.m15=m,t},e.identity=function(t){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.transpose=function(t,e){if(t===e){var n=e.m01,i=e.m02,r=e.m03,a=e.m06,o=e.m07,s=e.m11;t.m01=e.m04,t.m02=e.m08,t.m03=e.m12,t.m04=n,t.m06=e.m09,t.m07=e.m13,t.m08=i,t.m09=a,t.m11=e.m14,t.m12=r,t.m13=o,t.m14=s}else t.m00=e.m00,t.m01=e.m04,t.m02=e.m08,t.m03=e.m12,t.m04=e.m01,t.m05=e.m05,t.m06=e.m09,t.m07=e.m13,t.m08=e.m02,t.m09=e.m06,t.m10=e.m10,t.m11=e.m14,t.m12=e.m03,t.m13=e.m07,t.m14=e.m11,t.m15=e.m15;return t},e.invert=function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,o=e.m04,s=e.m05,c=e.m06,l=e.m07,h=e.m08,u=e.m09,_=e.m10,f=e.m11,d=e.m12,p=e.m13,m=e.m14,v=e.m15,g=n*s-i*o,y=n*c-r*o,x=n*l-a*o,S=i*c-r*s,A=i*l-a*s,b=r*l-a*c,C=h*p-u*d,T=h*m-_*d,E=h*v-f*d,w=u*m-_*p,I=u*v-f*p,P=_*v-f*m,D=g*P-y*I+x*w+S*E-A*T+b*C;return 0===D?(t.m00=0,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=0,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=0,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=0,t):(D=1/D,t.m00=(s*P-c*I+l*w)*D,t.m01=(r*I-i*P-a*w)*D,t.m02=(p*b-m*A+v*S)*D,t.m03=(_*A-u*b-f*S)*D,t.m04=(c*E-o*P-l*T)*D,t.m05=(n*P-r*E+a*T)*D,t.m06=(m*x-d*b-v*y)*D,t.m07=(h*b-_*x+f*y)*D,t.m08=(o*I-s*E+l*C)*D,t.m09=(i*E-n*I-a*C)*D,t.m10=(d*A-p*x+v*g)*D,t.m11=(u*x-h*A-f*g)*D,t.m12=(s*T-o*w-c*C)*D,t.m13=(n*w-i*T+r*C)*D,t.m14=(p*y-d*S-m*g)*D,t.m15=(h*S-u*y+_*g)*D,t)},e.determinant=function(t){var e=t.m00,n=t.m01,i=t.m02,r=t.m03,a=t.m04,o=t.m05,s=t.m06,c=t.m07,l=t.m08,h=t.m09,u=t.m10,_=t.m11,f=t.m12,d=t.m13,p=t.m14,m=t.m15;return(e*o-n*a)*(u*m-_*p)-(e*s-i*a)*(h*m-_*d)+(e*c-r*a)*(h*p-u*d)+(n*s-i*o)*(l*m-_*f)-(n*c-r*o)*(l*p-u*f)+(i*c-r*s)*(l*d-h*f)},e.multiply=function(t,e,n){var i=e.m00,r=e.m01,a=e.m02,o=e.m03,s=e.m04,c=e.m05,l=e.m06,h=e.m07,u=e.m08,_=e.m09,f=e.m10,d=e.m11,p=e.m12,m=e.m13,v=e.m14,g=e.m15,y=n.m00,x=n.m01,S=n.m02,A=n.m03;return t.m00=y*i+x*s+S*u+A*p,t.m01=y*r+x*c+S*_+A*m,t.m02=y*a+x*l+S*f+A*v,t.m03=y*o+x*h+S*d+A*g,y=n.m04,x=n.m05,S=n.m06,A=n.m07,t.m04=y*i+x*s+S*u+A*p,t.m05=y*r+x*c+S*_+A*m,t.m06=y*a+x*l+S*f+A*v,t.m07=y*o+x*h+S*d+A*g,y=n.m08,x=n.m09,S=n.m10,A=n.m11,t.m08=y*i+x*s+S*u+A*p,t.m09=y*r+x*c+S*_+A*m,t.m10=y*a+x*l+S*f+A*v,t.m11=y*o+x*h+S*d+A*g,y=n.m12,x=n.m13,S=n.m14,A=n.m15,t.m12=y*i+x*s+S*u+A*p,t.m13=y*r+x*c+S*_+A*m,t.m14=y*a+x*l+S*f+A*v,t.m15=y*o+x*h+S*d+A*g,t},e.transform=function(t,e,n){var i=n.x,r=n.y,a=n.z;if(e===t)t.m12=e.m00*i+e.m04*r+e.m08*a+e.m12,t.m13=e.m01*i+e.m05*r+e.m09*a+e.m13,t.m14=e.m02*i+e.m06*r+e.m10*a+e.m14,t.m15=e.m03*i+e.m07*r+e.m11*a+e.m15;else{var o=e.m00,s=e.m01,c=e.m02,l=e.m03,h=e.m04,u=e.m05,_=e.m06,f=e.m07,d=e.m08,p=e.m09,m=e.m10,v=e.m11;e.m12,e.m13,e.m14,e.m15,t.m00=o,t.m01=s,t.m02=c,t.m03=l,t.m04=h,t.m05=u,t.m06=_,t.m07=f,t.m08=d,t.m09=p,t.m10=m,t.m11=v,t.m12=o*i+h*r+d*a+e.m12,t.m13=s*i+u*r+p*a+e.m13,t.m14=c*i+_*r+m*a+e.m14,t.m15=l*i+f*r+v*a+e.m15}return t},e.translate=function(t,e,n){return console.warn("function changed"),e===t?(t.m12+=n.x,t.m13+=n.y,t.m14+=n.z):(t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12+=n.x,t.m13+=n.y,t.m14+=n.z,t.m15=e.m15),t},e.scale=function(t,e,n){var i=n.x,r=n.y,a=n.z;return t.m00=e.m00*i,t.m01=e.m01*i,t.m02=e.m02*i,t.m03=e.m03*i,t.m04=e.m04*r,t.m05=e.m05*r,t.m06=e.m06*r,t.m07=e.m07*r,t.m08=e.m08*a,t.m09=e.m09*a,t.m10=e.m10*a,t.m11=e.m11*a,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15,t},e.rotate=function(t,e,n,i){var r=i.x,a=i.y,o=i.z,s=Math.sqrt(r*r+a*a+o*o);if(Math.abs(s)<cn)return null;r*=s=1/s,a*=s,o*=s;var c=Math.sin(n),l=Math.cos(n),h=1-l,u=e.m00,_=e.m01,f=e.m02,d=e.m03,p=e.m04,m=e.m05,v=e.m06,g=e.m07,y=e.m08,x=e.m09,S=e.m10,A=e.m11,b=r*r*h+l,C=a*r*h+o*c,T=o*r*h-a*c,E=r*a*h-o*c,w=a*a*h+l,I=o*a*h+r*c,P=r*o*h+a*c,D=a*o*h-r*c,R=o*o*h+l;return t.m00=u*b+p*C+y*T,t.m01=_*b+m*C+x*T,t.m02=f*b+v*C+S*T,t.m03=d*b+g*C+A*T,t.m04=u*E+p*w+y*I,t.m05=_*E+m*w+x*I,t.m06=f*E+v*w+S*I,t.m07=d*E+g*w+A*I,t.m08=u*P+p*D+y*R,t.m09=_*P+m*D+x*R,t.m10=f*P+v*D+S*R,t.m11=d*P+g*D+A*R,e!==t&&(t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t},e.rotateX=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e.m04,o=e.m05,s=e.m06,c=e.m07,l=e.m08,h=e.m09,u=e.m10,_=e.m11;return e!==t&&(t.m00=e.m00,t.m01=e.m01,t.m02=e.m02,t.m03=e.m03,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m04=a*r+l*i,t.m05=o*r+h*i,t.m06=s*r+u*i,t.m07=c*r+_*i,t.m08=l*r-a*i,t.m09=h*r-o*i,t.m10=u*r-s*i,t.m11=_*r-c*i,t},e.rotateY=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e.m00,o=e.m01,s=e.m02,c=e.m03,l=e.m08,h=e.m09,u=e.m10,_=e.m11;return e!==t&&(t.m04=e.m04,t.m05=e.m05,t.m06=e.m06,t.m07=e.m07,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m00=a*r-l*i,t.m01=o*r-h*i,t.m02=s*r-u*i,t.m03=c*r-_*i,t.m08=a*i+l*r,t.m09=o*i+h*r,t.m10=s*i+u*r,t.m11=c*i+_*r,t},e.rotateZ=function(t,e,n){var i=Math.sin(n),r=Math.cos(n),a=e.m00,o=e.m01,s=e.m02,c=e.m03,l=e.m04,h=e.m05,u=e.m06,_=e.m07;return e!==t&&(t.m08=e.m08,t.m09=e.m09,t.m10=e.m10,t.m11=e.m11,t.m12=e.m12,t.m13=e.m13,t.m14=e.m14,t.m15=e.m15),t.m00=a*r+l*i,t.m01=o*r+h*i,t.m02=s*r+u*i,t.m03=c*r+_*i,t.m04=l*r-a*i,t.m05=h*r-o*i,t.m06=u*r-s*i,t.m07=_*r-c*i,t},e.fromTranslation=function(t,e){return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=e.x,t.m13=e.y,t.m14=e.z,t.m15=1,t},e.fromScaling=function(t,e){return t.m00=e.x,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=e.y,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=e.z,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromRotation=function(t,e,n){var i=n.x,r=n.y,a=n.z,o=Math.sqrt(i*i+r*r+a*a);if(Math.abs(o)<cn)return null;i*=o=1/o,r*=o,a*=o;var s=Math.sin(e),c=Math.cos(e),l=1-c;return t.m00=i*i*l+c,t.m01=r*i*l+a*s,t.m02=a*i*l-r*s,t.m03=0,t.m04=i*r*l-a*s,t.m05=r*r*l+c,t.m06=a*r*l+i*s,t.m07=0,t.m08=i*a*l+r*s,t.m09=r*a*l-i*s,t.m10=a*a*l+c,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromXRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t.m00=1,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=i,t.m06=n,t.m07=0,t.m08=0,t.m09=-n,t.m10=i,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromYRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t.m00=i,t.m01=0,t.m02=-n,t.m03=0,t.m04=0,t.m05=1,t.m06=0,t.m07=0,t.m08=n,t.m09=0,t.m10=i,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromZRotation=function(t,e){var n=Math.sin(e),i=Math.cos(e);return t.m00=i,t.m01=n,t.m02=0,t.m03=0,t.m04=-n,t.m05=i,t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=1,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.fromRT=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=e.w,s=i+i,c=r+r,l=a+a,h=i*s,u=i*c,_=i*l,f=r*c,d=r*l,p=a*l,m=o*s,v=o*c,g=o*l;return t.m00=1-(f+p),t.m01=u+g,t.m02=_-v,t.m03=0,t.m04=u-g,t.m05=1-(h+p),t.m06=d+m,t.m07=0,t.m08=_+v,t.m09=d-m,t.m10=1-(h+f),t.m11=0,t.m12=n.x,t.m13=n.y,t.m14=n.z,t.m15=1,t},e.getTranslation=function(t,e){return t.x=e.m12,t.y=e.m13,t.z=e.m14,t},e.getScaling=function(t,e){var n=Kn.m00=e.m00,i=Kn.m01=e.m01,r=Kn.m02=e.m02,a=Kn.m03=e.m04,o=Kn.m04=e.m05,s=Kn.m05=e.m06,c=Kn.m06=e.m08,l=Kn.m07=e.m09,h=Kn.m08=e.m10;return t.x=Math.sqrt(n*n+i*i+r*r),t.y=Math.sqrt(a*a+o*o+s*s),t.z=Math.sqrt(c*c+l*l+h*h),Ln.determinant(Kn)<0&&(t.x*=-1),t},e.getRotation=function(t,e){var n=e.m00+e.m05+e.m10,i=0;return n>0?(i=2*Math.sqrt(n+1),t.w=.25*i,t.x=(e.m06-e.m09)/i,t.y=(e.m08-e.m02)/i,t.z=(e.m01-e.m04)/i):e.m00>e.m05&&e.m00>e.m10?(i=2*Math.sqrt(1+e.m00-e.m05-e.m10),t.w=(e.m06-e.m09)/i,t.x=.25*i,t.y=(e.m01+e.m04)/i,t.z=(e.m08+e.m02)/i):e.m05>e.m10?(i=2*Math.sqrt(1+e.m05-e.m00-e.m10),t.w=(e.m08-e.m02)/i,t.x=(e.m01+e.m04)/i,t.y=.25*i,t.z=(e.m06+e.m09)/i):(i=2*Math.sqrt(1+e.m10-e.m00-e.m05),t.w=(e.m01-e.m04)/i,t.x=(e.m08+e.m02)/i,t.y=(e.m06+e.m09)/i,t.z=.25*i),t},e.toRTS=function(t,e,n,i){i.x=Mn.set(Yn,t.m00,t.m01,t.m02).length(),Kn.m00=t.m00/i.x,Kn.m01=t.m01/i.x,Kn.m02=t.m02/i.x,i.y=Mn.set(Yn,t.m04,t.m05,t.m06).length(),Kn.m03=t.m04/i.y,Kn.m04=t.m05/i.y,Kn.m05=t.m06/i.y,i.z=Mn.set(Yn,t.m08,t.m09,t.m10).length(),Kn.m06=t.m08/i.z,Kn.m07=t.m09/i.z,Kn.m08=t.m10/i.z,Ln.determinant(Kn)<0&&(i.x*=-1,Kn.m00*=-1,Kn.m01*=-1,Kn.m02*=-1),zn.fromMat3(e,Kn),Mn.set(n,t.m12,t.m13,t.m14)},e.fromRTS=function(t,e,n,i){var r=e.x,a=e.y,o=e.z,s=e.w,c=r+r,l=a+a,h=o+o,u=r*c,_=r*l,f=r*h,d=a*l,p=a*h,m=o*h,v=s*c,g=s*l,y=s*h,x=i.x,S=i.y,A=i.z;return t.m00=(1-(d+m))*x,t.m01=(_+y)*x,t.m02=(f-g)*x,t.m03=0,t.m04=(_-y)*S,t.m05=(1-(u+m))*S,t.m06=(p+v)*S,t.m07=0,t.m08=(f+g)*A,t.m09=(p-v)*A,t.m10=(1-(u+d))*A,t.m11=0,t.m12=n.x,t.m13=n.y,t.m14=n.z,t.m15=1,t},e.fromRTSOrigin=function(t,e,n,i,r){var a=e.x,o=e.y,s=e.z,c=e.w,l=a+a,h=o+o,u=s+s,_=a*l,f=a*h,d=a*u,p=o*h,m=o*u,v=s*u,g=c*l,y=c*h,x=c*u,S=i.x,A=i.y,b=i.z,C=r.x,T=r.y,E=r.z;return t.m00=(1-(p+v))*S,t.m01=(f+x)*S,t.m02=(d-y)*S,t.m03=0,t.m04=(f-x)*A,t.m05=(1-(_+v))*A,t.m06=(m+g)*A,t.m07=0,t.m08=(d+y)*b,t.m09=(m-g)*b,t.m10=(1-(_+p))*b,t.m11=0,t.m12=n.x+C-(t.m00*C+t.m04*T+t.m08*E),t.m13=n.y+T-(t.m01*C+t.m05*T+t.m09*E),t.m14=n.z+E-(t.m02*C+t.m06*T+t.m10*E),t.m15=1,t},e.fromQuat=function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w,o=n+n,s=i+i,c=r+r,l=n*o,h=i*o,u=i*s,_=r*o,f=r*s,d=r*c,p=a*o,m=a*s,v=a*c;return t.m00=1-u-d,t.m01=h+v,t.m02=_-m,t.m03=0,t.m04=h-v,t.m05=1-l-d,t.m06=f+p,t.m07=0,t.m08=_+m,t.m09=f-p,t.m10=1-l-u,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t},e.frustum=function(t,e,n,i,r,a,o){var s=1/(n-e),c=1/(r-i),l=1/(a-o);return t.m00=2*a*s,t.m01=0,t.m02=0,t.m03=0,t.m04=0,t.m05=2*a*c,t.m06=0,t.m07=0,t.m08=(n+e)*s,t.m09=(r+i)*c,t.m10=(o+a)*l,t.m11=-1,t.m12=0,t.m13=0,t.m14=o*a*2*l,t.m15=0,t},e.perspective=function(t,e,n,i,r,a,o,s,c){void 0===a&&(a=!0),void 0===o&&(o=-1),void 0===s&&(s=1),void 0===c&&(c=0);var l=1/Math.tan(e/2),h=1/(i-r),u=a?l/n:l,_=(a?l:l*n)*s,f=qn[c];return t.m00=u*f[0],t.m01=u*f[1],t.m02=0,t.m03=0,t.m04=_*f[2],t.m05=_*f[3],t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=(r-o*i)*h,t.m11=-1,t.m12=0,t.m13=0,t.m14=r*i*h*(1-o),t.m15=0,t},e.ortho=function(t,e,n,i,r,a,o,s,c,l){void 0===s&&(s=-1),void 0===c&&(c=1),void 0===l&&(l=0);var h=1/(e-n),u=1/(i-r)*c,_=1/(a-o),f=-2*h,d=-2*u,p=(e+n)*h,m=(r+i)*u,v=qn[l];return t.m00=f*v[0],t.m01=f*v[1],t.m02=0,t.m03=0,t.m04=d*v[2],t.m05=d*v[3],t.m06=0,t.m07=0,t.m08=0,t.m09=0,t.m10=_*(1-s),t.m11=0,t.m12=p*v[0]+m*v[2],t.m13=p*v[1]+m*v[3],t.m14=(a-s*o)*_,t.m15=1,t},e.lookAt=function(t,e,n,i){var r=e.x,a=e.y,o=e.z,s=i.x,c=i.y,l=i.z,h=r-n.x,u=a-n.y,_=o-n.z,f=1/Math.sqrt(h*h+u*u+_*_),d=c*(_*=f)-l*(u*=f),p=l*(h*=f)-s*_,m=s*u-c*h,v=u*(m*=f=1/Math.sqrt(d*d+p*p+m*m))-_*(p*=f),g=_*(d*=f)-h*m,y=h*p-u*d;return t.m00=d,t.m01=v,t.m02=h,t.m03=0,t.m04=p,t.m05=g,t.m06=u,t.m07=0,t.m08=m,t.m09=y,t.m10=_,t.m11=0,t.m12=-(d*r+p*a+m*o),t.m13=-(v*r+g*a+y*o),t.m14=-(h*r+u*a+_*o),t.m15=1,t},e.inverseTranspose=function(t,e){var n=e.m00,i=e.m01,r=e.m02,a=e.m03,o=e.m04,s=e.m05,c=e.m06,l=e.m07,h=e.m08,u=e.m09,_=e.m10,f=e.m11,d=e.m12,p=e.m13,m=e.m14,v=e.m15,g=n*s-i*o,y=n*c-r*o,x=n*l-a*o,S=i*c-r*s,A=i*l-a*s,b=r*l-a*c,C=h*p-u*d,T=h*m-_*d,E=h*v-f*d,w=u*m-_*p,I=u*v-f*p,P=_*v-f*m,D=g*P-y*I+x*w+S*E-A*T+b*C;return D?(D=1/D,t.m00=(s*P-c*I+l*w)*D,t.m01=(c*E-o*P-l*T)*D,t.m02=(o*I-s*E+l*C)*D,t.m03=0,t.m04=(r*I-i*P-a*w)*D,t.m05=(n*P-r*E+a*T)*D,t.m06=(i*E-n*I-a*C)*D,t.m07=0,t.m08=(p*b-m*A+v*S)*D,t.m09=(m*x-d*b-v*y)*D,t.m10=(d*A-p*x+v*g)*D,t.m11=0,t.m12=0,t.m13=0,t.m14=0,t.m15=1,t):null},e.toArray=function(t,e,n){return void 0===n&&(n=0),t[n+0]=e.m00,t[n+1]=e.m01,t[n+2]=e.m02,t[n+3]=e.m03,t[n+4]=e.m04,t[n+5]=e.m05,t[n+6]=e.m06,t[n+7]=e.m07,t[n+8]=e.m08,t[n+9]=e.m09,t[n+10]=e.m10,t[n+11]=e.m11,t[n+12]=e.m12,t[n+13]=e.m13,t[n+14]=e.m14,t[n+15]=e.m15,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),t.m00=e[n+0],t.m01=e[n+1],t.m02=e[n+2],t.m03=e[n+3],t.m04=e[n+4],t.m05=e[n+5],t.m06=e[n+6],t.m07=e[n+7],t.m08=e[n+8],t.m09=e[n+9],t.m10=e[n+10],t.m11=e[n+11],t.m12=e[n+12],t.m13=e[n+13],t.m14=e[n+14],t.m15=e[n+15],t},e.add=function(t,e,n){return t.m00=e.m00+n.m00,t.m01=e.m01+n.m01,t.m02=e.m02+n.m02,t.m03=e.m03+n.m03,t.m04=e.m04+n.m04,t.m05=e.m05+n.m05,t.m06=e.m06+n.m06,t.m07=e.m07+n.m07,t.m08=e.m08+n.m08,t.m09=e.m09+n.m09,t.m10=e.m10+n.m10,t.m11=e.m11+n.m11,t.m12=e.m12+n.m12,t.m13=e.m13+n.m13,t.m14=e.m14+n.m14,t.m15=e.m15+n.m15,t},e.subtract=function(t,e,n){return t.m00=e.m00-n.m00,t.m01=e.m01-n.m01,t.m02=e.m02-n.m02,t.m03=e.m03-n.m03,t.m04=e.m04-n.m04,t.m05=e.m05-n.m05,t.m06=e.m06-n.m06,t.m07=e.m07-n.m07,t.m08=e.m08-n.m08,t.m09=e.m09-n.m09,t.m10=e.m10-n.m10,t.m11=e.m11-n.m11,t.m12=e.m12-n.m12,t.m13=e.m13-n.m13,t.m14=e.m14-n.m14,t.m15=e.m15-n.m15,t},e.multiplyScalar=function(t,e,n){return t.m00=e.m00*n,t.m01=e.m01*n,t.m02=e.m02*n,t.m03=e.m03*n,t.m04=e.m04*n,t.m05=e.m05*n,t.m06=e.m06*n,t.m07=e.m07*n,t.m08=e.m08*n,t.m09=e.m09*n,t.m10=e.m10*n,t.m11=e.m11*n,t.m12=e.m12*n,t.m13=e.m13*n,t.m14=e.m14*n,t.m15=e.m15*n,t},e.multiplyScalarAndAdd=function(t,e,n,i){return t.m00=e.m00+n.m00*i,t.m01=e.m01+n.m01*i,t.m02=e.m02+n.m02*i,t.m03=e.m03+n.m03*i,t.m04=e.m04+n.m04*i,t.m05=e.m05+n.m05*i,t.m06=e.m06+n.m06*i,t.m07=e.m07+n.m07*i,t.m08=e.m08+n.m08*i,t.m09=e.m09+n.m09*i,t.m10=e.m10+n.m10*i,t.m11=e.m11+n.m11*i,t.m12=e.m12+n.m12*i,t.m13=e.m13+n.m13*i,t.m14=e.m14+n.m14*i,t.m15=e.m15+n.m15*i,t},e.strictEquals=function(t,e){return t.m00===e.m00&&t.m01===e.m01&&t.m02===e.m02&&t.m03===e.m03&&t.m04===e.m04&&t.m05===e.m05&&t.m06===e.m06&&t.m07===e.m07&&t.m08===e.m08&&t.m09===e.m09&&t.m10===e.m10&&t.m11===e.m11&&t.m12===e.m12&&t.m13===e.m13&&t.m14===e.m14&&t.m15===e.m15},e.equals=function(t,e,n){return void 0===n&&(n=cn),Math.abs(t.m00-e.m00)<=n*Math.max(1,Math.abs(t.m00),Math.abs(e.m00))&&Math.abs(t.m01-e.m01)<=n*Math.max(1,Math.abs(t.m01),Math.abs(e.m01))&&Math.abs(t.m02-e.m02)<=n*Math.max(1,Math.abs(t.m02),Math.abs(e.m02))&&Math.abs(t.m03-e.m03)<=n*Math.max(1,Math.abs(t.m03),Math.abs(e.m03))&&Math.abs(t.m04-e.m04)<=n*Math.max(1,Math.abs(t.m04),Math.abs(e.m04))&&Math.abs(t.m05-e.m05)<=n*Math.max(1,Math.abs(t.m05),Math.abs(e.m05))&&Math.abs(t.m06-e.m06)<=n*Math.max(1,Math.abs(t.m06),Math.abs(e.m06))&&Math.abs(t.m07-e.m07)<=n*Math.max(1,Math.abs(t.m07),Math.abs(e.m07))&&Math.abs(t.m08-e.m08)<=n*Math.max(1,Math.abs(t.m08),Math.abs(e.m08))&&Math.abs(t.m09-e.m09)<=n*Math.max(1,Math.abs(t.m09),Math.abs(e.m09))&&Math.abs(t.m10-e.m10)<=n*Math.max(1,Math.abs(t.m10),Math.abs(e.m10))&&Math.abs(t.m11-e.m11)<=n*Math.max(1,Math.abs(t.m11),Math.abs(e.m11))&&Math.abs(t.m12-e.m12)<=n*Math.max(1,Math.abs(t.m12),Math.abs(e.m12))&&Math.abs(t.m13-e.m13)<=n*Math.max(1,Math.abs(t.m13),Math.abs(e.m13))&&Math.abs(t.m14-e.m14)<=n*Math.max(1,Math.abs(t.m14),Math.abs(e.m14))&&Math.abs(t.m15-e.m15)<=n*Math.max(1,Math.abs(t.m15),Math.abs(e.m15))};var n=e.prototype;return n.clone=function(){return new e(this.m00,this.m01,this.m02,this.m03,this.m04,this.m05,this.m06,this.m07,this.m08,this.m09,this.m10,this.m11,this.m12,this.m13,this.m14,this.m15)},n.set=function(t,e,n,i,r,a,o,s,c,l,h,u,_,f,d,p){return void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===h&&(h=1),void 0===u&&(u=0),void 0===_&&(_=0),void 0===f&&(f=0),void 0===d&&(d=0),void 0===p&&(p=1),"object"==typeof t?(this.m01=t.m01,this.m02=t.m02,this.m03=t.m03,this.m04=t.m04,this.m05=t.m05,this.m06=t.m06,this.m07=t.m07,this.m08=t.m08,this.m09=t.m09,this.m10=t.m10,this.m11=t.m11,this.m12=t.m12,this.m13=t.m13,this.m14=t.m14,this.m15=t.m15,this.m00=t.m00):(this.m01=e,this.m02=n,this.m03=i,this.m04=r,this.m05=a,this.m06=o,this.m07=s,this.m08=c,this.m09=l,this.m10=h,this.m11=u,this.m12=_,this.m13=f,this.m14=d,this.m15=p,this.m00=t),this},n.equals=function(t,e){return void 0===e&&(e=cn),Math.abs(this.m00-t.m00)<=e*Math.max(1,Math.abs(this.m00),Math.abs(t.m00))&&Math.abs(this.m01-t.m01)<=e*Math.max(1,Math.abs(this.m01),Math.abs(t.m01))&&Math.abs(this.m02-t.m02)<=e*Math.max(1,Math.abs(this.m02),Math.abs(t.m02))&&Math.abs(this.m03-t.m03)<=e*Math.max(1,Math.abs(this.m03),Math.abs(t.m03))&&Math.abs(this.m04-t.m04)<=e*Math.max(1,Math.abs(this.m04),Math.abs(t.m04))&&Math.abs(this.m05-t.m05)<=e*Math.max(1,Math.abs(this.m05),Math.abs(t.m05))&&Math.abs(this.m06-t.m06)<=e*Math.max(1,Math.abs(this.m06),Math.abs(t.m06))&&Math.abs(this.m07-t.m07)<=e*Math.max(1,Math.abs(this.m07),Math.abs(t.m07))&&Math.abs(this.m08-t.m08)<=e*Math.max(1,Math.abs(this.m08),Math.abs(t.m08))&&Math.abs(this.m09-t.m09)<=e*Math.max(1,Math.abs(this.m09),Math.abs(t.m09))&&Math.abs(this.m10-t.m10)<=e*Math.max(1,Math.abs(this.m10),Math.abs(t.m10))&&Math.abs(this.m11-t.m11)<=e*Math.max(1,Math.abs(this.m11),Math.abs(t.m11))&&Math.abs(this.m12-t.m12)<=e*Math.max(1,Math.abs(this.m12),Math.abs(t.m12))&&Math.abs(this.m13-t.m13)<=e*Math.max(1,Math.abs(this.m13),Math.abs(t.m13))&&Math.abs(this.m14-t.m14)<=e*Math.max(1,Math.abs(this.m14),Math.abs(t.m14))&&Math.abs(this.m15-t.m15)<=e*Math.max(1,Math.abs(this.m15),Math.abs(t.m15))},n.strictEquals=function(t){return this.m00===t.m00&&this.m01===t.m01&&this.m02===t.m02&&this.m03===t.m03&&this.m04===t.m04&&this.m05===t.m05&&this.m06===t.m06&&this.m07===t.m07&&this.m08===t.m08&&this.m09===t.m09&&this.m10===t.m10&&this.m11===t.m11&&this.m12===t.m12&&this.m13===t.m13&&this.m14===t.m14&&this.m15===t.m15},n.toString=function(){return"[\n"+this.m00+", "+this.m01+", "+this.m02+", "+this.m03+",\n"+this.m04+", "+this.m05+", "+this.m06+", "+this.m07+",\n"+this.m08+", "+this.m09+", "+this.m10+", "+this.m11+",\n"+this.m12+", "+this.m13+", "+this.m14+", "+this.m15+"\n]"},n.identity=function(){return this.m00=1,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=1,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=1,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},n.zero=function(){return this.m00=0,this.m01=0,this.m02=0,this.m03=0,this.m04=0,this.m05=0,this.m06=0,this.m07=0,this.m08=0,this.m09=0,this.m10=0,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=0,this},n.transpose=function(){var t=this.m01,e=this.m02,n=this.m03,i=this.m06,r=this.m07,a=this.m11;return this.m01=this.m04,this.m02=this.m08,this.m03=this.m12,this.m04=t,this.m06=this.m09,this.m07=this.m13,this.m08=e,this.m09=i,this.m11=this.m14,this.m12=n,this.m13=r,this.m14=a,this},n.invert=function(){var t=this.m00,e=this.m01,n=this.m02,i=this.m03,r=this.m04,a=this.m05,o=this.m06,s=this.m07,c=this.m08,l=this.m09,h=this.m10,u=this.m11,_=this.m12,f=this.m13,d=this.m14,p=this.m15,m=t*a-e*r,v=t*o-n*r,g=t*s-i*r,y=e*o-n*a,x=e*s-i*a,S=n*s-i*o,A=c*f-l*_,b=c*d-h*_,C=c*p-u*_,T=l*d-h*f,E=l*p-u*f,w=h*p-u*d,I=m*w-v*E+g*T+y*C-x*b+S*A;return 0===I?(this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),this):(I=1/I,this.m00=(a*w-o*E+s*T)*I,this.m01=(n*E-e*w-i*T)*I,this.m02=(f*S-d*x+p*y)*I,this.m03=(h*x-l*S-u*y)*I,this.m04=(o*C-r*w-s*b)*I,this.m05=(t*w-n*C+i*b)*I,this.m06=(d*g-_*S-p*v)*I,this.m07=(c*S-h*g+u*v)*I,this.m08=(r*E-a*C+s*A)*I,this.m09=(e*C-t*E-i*A)*I,this.m10=(_*x-f*g+p*m)*I,this.m11=(l*g-c*x-u*m)*I,this.m12=(a*b-r*T-o*A)*I,this.m13=(t*T-e*b+n*A)*I,this.m14=(f*v-_*y-d*m)*I,this.m15=(c*y-l*v+h*m)*I,this)},n.determinant=function(){var t=this.m00,e=this.m01,n=this.m02,i=this.m03,r=this.m04,a=this.m05,o=this.m06,s=this.m07,c=this.m08,l=this.m09,h=this.m10,u=this.m11,_=this.m12,f=this.m13,d=this.m14,p=this.m15;return(t*a-e*r)*(h*p-u*d)-(t*o-n*r)*(l*p-u*f)+(t*s-i*r)*(l*d-h*f)+(e*o-n*a)*(c*p-u*_)-(e*s-i*a)*(c*d-h*_)+(n*s-i*o)*(c*f-l*_)},n.add=function(t){return this.m00+=t.m00,this.m01+=t.m01,this.m02+=t.m02,this.m03+=t.m03,this.m04+=t.m04,this.m05+=t.m05,this.m06+=t.m06,this.m07+=t.m07,this.m08+=t.m08,this.m09+=t.m09,this.m10+=t.m10,this.m11+=t.m11,this.m12+=t.m12,this.m13+=t.m13,this.m14+=t.m14,this.m15+=t.m15,this},n.subtract=function(t){return this.m00-=t.m00,this.m01-=t.m01,this.m02-=t.m02,this.m03-=t.m03,this.m04-=t.m04,this.m05-=t.m05,this.m06-=t.m06,this.m07-=t.m07,this.m08-=t.m08,this.m09-=t.m09,this.m10-=t.m10,this.m11-=t.m11,this.m12-=t.m12,this.m13-=t.m13,this.m14-=t.m14,this.m15-=t.m15,this},n.multiply=function(t){var e=this.m00,n=this.m01,i=this.m02,r=this.m03,a=this.m04,o=this.m05,s=this.m06,c=this.m07,l=this.m08,h=this.m09,u=this.m10,_=this.m11,f=this.m12,d=this.m13,p=this.m14,m=this.m15,v=t.m00,g=t.m01,y=t.m02,x=t.m03;return this.m00=v*e+g*a+y*l+x*f,this.m01=v*n+g*o+y*h+x*d,this.m02=v*i+g*s+y*u+x*p,this.m03=v*r+g*c+y*_+x*m,v=t.m04,g=t.m05,y=t.m06,x=t.m07,this.m04=v*e+g*a+y*l+x*f,this.m05=v*n+g*o+y*h+x*d,this.m06=v*i+g*s+y*u+x*p,this.m07=v*r+g*c+y*_+x*m,v=t.m08,g=t.m09,y=t.m10,x=t.m11,this.m08=v*e+g*a+y*l+x*f,this.m09=v*n+g*o+y*h+x*d,this.m10=v*i+g*s+y*u+x*p,this.m11=v*r+g*c+y*_+x*m,v=t.m12,g=t.m13,y=t.m14,x=t.m15,this.m12=v*e+g*a+y*l+x*f,this.m13=v*n+g*o+y*h+x*d,this.m14=v*i+g*s+y*u+x*p,this.m15=v*r+g*c+y*_+x*m,this},n.multiplyScalar=function(t){return this.m00*=t,this.m01*=t,this.m02*=t,this.m03*=t,this.m04*=t,this.m05*=t,this.m06*=t,this.m07*=t,this.m08*=t,this.m09*=t,this.m10*=t,this.m11*=t,this.m12*=t,this.m13*=t,this.m14*=t,this.m15*=t,this},n.translate=function(t){return console.warn("function changed"),this.m12+=t.x,this.m13+=t.y,this.m14+=t.z,this},n.scale=function(t){var e=t.x,n=t.y,i=t.z;return this.m00*=e,this.m01*=e,this.m02*=e,this.m03*=e,this.m04*=n,this.m05*=n,this.m06*=n,this.m07*=n,this.m08*=i,this.m09*=i,this.m10*=i,this.m11*=i,this},n.rotate=function(t,e){var n=e.x,i=e.y,r=e.z,a=Math.sqrt(n*n+i*i+r*r);if(Math.abs(a)<cn)return null;n*=a=1/a,i*=a,r*=a;var o=Math.sin(t),s=Math.cos(t),c=1-s,l=this.m00,h=this.m01,u=this.m02,_=this.m03,f=this.m04,d=this.m05,p=this.m06,m=this.m07,v=this.m08,g=this.m09,y=this.m10,x=this.m11,S=n*n*c+s,A=i*n*c+r*o,b=r*n*c-i*o,C=n*i*c-r*o,T=i*i*c+s,E=r*i*c+n*o,w=n*r*c+i*o,I=i*r*c-n*o,P=r*r*c+s;return this.m00=l*S+f*A+v*b,this.m01=h*S+d*A+g*b,this.m02=u*S+p*A+y*b,this.m03=_*S+m*A+x*b,this.m04=l*C+f*T+v*E,this.m05=h*C+d*T+g*E,this.m06=u*C+p*T+y*E,this.m07=_*C+m*T+x*E,this.m08=l*w+f*I+v*P,this.m09=h*w+d*I+g*P,this.m10=u*w+p*I+y*P,this.m11=_*w+m*I+x*P,this},n.getTranslation=function(t){return t.x=this.m12,t.y=this.m13,t.z=this.m14,t},n.getScale=function(t){var e=Kn.m00=this.m00,n=Kn.m01=this.m01,i=Kn.m02=this.m02,r=Kn.m03=this.m04,a=Kn.m04=this.m05,o=Kn.m05=this.m06,s=Kn.m06=this.m08,c=Kn.m07=this.m09,l=Kn.m08=this.m10;return t.x=Math.sqrt(e*e+n*n+i*i),t.y=Math.sqrt(r*r+a*a+o*o),t.z=Math.sqrt(s*s+c*c+l*l),Ln.determinant(Kn)<0&&(t.x*=-1),t},n.getRotation=function(t){var e=this.m00+this.m05+this.m10,n=0;return e>0?(n=2*Math.sqrt(e+1),t.w=.25*n,t.x=(this.m06-this.m09)/n,t.y=(this.m08-this.m02)/n,t.z=(this.m01-this.m04)/n):this.m00>this.m05&&this.m00>this.m10?(n=2*Math.sqrt(1+this.m00-this.m05-this.m10),t.w=(this.m06-this.m09)/n,t.x=.25*n,t.y=(this.m01+this.m04)/n,t.z=(this.m08+this.m02)/n):this.m05>this.m10?(n=2*Math.sqrt(1+this.m05-this.m00-this.m10),t.w=(this.m08-this.m02)/n,t.x=(this.m01+this.m04)/n,t.y=.25*n,t.z=(this.m06+this.m09)/n):(n=2*Math.sqrt(1+this.m10-this.m00-this.m05),t.w=(this.m01-this.m04)/n,t.x=(this.m08+this.m02)/n,t.y=(this.m06+this.m09)/n,t.z=.25*n),t},n.fromRTS=function(t,e,n){var i=t.x,r=t.y,a=t.z,o=t.w,s=i+i,c=r+r,l=a+a,h=i*s,u=i*c,_=i*l,f=r*c,d=r*l,p=a*l,m=o*s,v=o*c,g=o*l,y=n.x,x=n.y,S=n.z;return this.m00=(1-(f+p))*y,this.m01=(u+g)*y,this.m02=(_-v)*y,this.m03=0,this.m04=(u-g)*x,this.m05=(1-(h+p))*x,this.m06=(d+m)*x,this.m07=0,this.m08=(_+v)*S,this.m09=(d-m)*S,this.m10=(1-(h+f))*S,this.m11=0,this.m12=e.x,this.m13=e.y,this.m14=e.z,this.m15=1,this},n.fromQuat=function(t){var e=t.x,n=t.y,i=t.z,r=t.w,a=e+e,o=n+n,s=i+i,c=e*a,l=n*a,h=n*o,u=i*a,_=i*o,f=i*s,d=r*a,p=r*o,m=r*s;return this.m00=1-h-f,this.m01=l+m,this.m02=u-p,this.m03=0,this.m04=l-m,this.m05=1-c-f,this.m06=_+d,this.m07=0,this.m08=u+p,this.m09=_-d,this.m10=1-c-h,this.m11=0,this.m12=0,this.m13=0,this.m14=0,this.m15=1,this},e}(ue));Xn.IDENTITY=Object.freeze(new Xn);var Yn=new Mn,Kn=new Ln;function Jn(t,e,n,i,r,a,o,s,c,l,h,u,_,f,d,p){return new Xn(t,e,n,i,r,a,o,s,c,l,h,u,_,f,d,p)}en.fastDefine("cc.Mat4",Xn,{m00:1,m01:0,m02:0,m03:0,m04:0,m05:1,m06:0,m07:0,m08:0,m09:0,m10:1,m11:0,m12:0,m13:0,m14:0,m15:1}),h.Mat4=Xn,h.mat4=Jn;var Qn=t("Vec2",function(t){function e(e,n){var i;return i=t.call(this)||this,e&&"object"==typeof e?(i.x=e.x,i.y=e.y):(i.x=e||0,i.y=n||0),i}$(e,t),e.clone=function(t){return new e(t.x,t.y)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t},e.set=function(t,e,n){return t.x=e,t.y=n,t},e.add=function(t,e,n){return t.x=e.x+n.x,t.y=e.y+n.y,t},e.subtract=function(t,e,n){return t.x=e.x-n.x,t.y=e.y-n.y,t},e.multiply=function(t,e,n){return t.x=e.x*n.x,t.y=e.y*n.y,t},e.divide=function(t,e,n){return t.x=e.x/n.x,t.y=e.y/n.y,t},e.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t},e.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t},e.min=function(t,e,n){return t.x=Math.min(e.x,n.x),t.y=Math.min(e.y,n.y),t},e.max=function(t,e,n){return t.x=Math.max(e.x,n.x),t.y=Math.max(e.y,n.y),t},e.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t},e.multiplyScalar=function(t,e,n){return t.x=e.x*n,t.y=e.y*n,t},e.scaleAndAdd=function(t,e,n,i){return t.x=e.x+n.x*i,t.y=e.y+n.y*i,t},e.distance=function(t,e){var n=e.x-t.x,i=e.y-t.y;return Math.sqrt(n*n+i*i)},e.squaredDistance=function(t,e){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i},e.len=function(t){var e=t.x,n=t.y;return Math.sqrt(e*e+n*n)},e.lengthSqr=function(t){var e=t.x,n=t.y;return e*e+n*n},e.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t},e.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t},e.inverseSafe=function(t,e){var n=e.x,i=e.y;return Math.abs(n)<cn?t.x=0:t.x=1/n,Math.abs(i)<cn?t.y=0:t.y=1/i,t},e.normalize=function(t,e){var n=e.x,i=e.y,r=n*n+i*i;return r>0&&(r=1/Math.sqrt(r),t.x=n*r,t.y=i*r),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y},e.cross=function(t,e,n){return t instanceof Mn?(t.x=t.y=0,t.z=e.x*n.y-e.y*n.x,t):t.x*e.y-t.y*e.x},e.lerp=function(t,e,n,i){var r=e.x,a=e.y;return t.x=r+i*(n.x-r),t.y=a+i*(n.y-a),t},e.random=function(t,e){e=e||1;var n=2*mn()*Math.PI;return t.x=Math.cos(n)*e,t.y=Math.sin(n)*e,t},e.transformMat3=function(t,e,n){var i=e.x,r=e.y;return t.x=n.m00*i+n.m03*r+n.m06,t.y=n.m01*i+n.m04*r+n.m07,t},e.transformMat4=function(t,e,n){var i=e.x,r=e.y;return t.x=n.m00*i+n.m04*r+n.m12,t.y=n.m01*i+n.m05*r+n.m13,t},e.str=function(t){return"Vec2("+t.x+", "+t.y+")"},e.toArray=function(t,e,n){return void 0===n&&(n=0),t[n+0]=e.x,t[n+1]=e.y,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),t.x=e[n+0],t.y=e[n+1],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y},e.equals=function(t,e,n){return void 0===n&&(n=cn),Math.abs(t.x-e.x)<=n*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=n*Math.max(1,Math.abs(t.y),Math.abs(e.y))},e.angle=function(t,n){e.normalize(Zn,t),e.normalize($n,n);var i=e.dot(Zn,$n);return i>1?0:i<-1?Math.PI:Math.acos(i)};var n=e.prototype;return n.clone=function(){return new e(this.x,this.y)},n.set=function(t,e){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t||0,this.y=e||0),this},n.equals=function(t,e){return void 0===e&&(e=cn),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))},n.equals2f=function(t,e,n){return void 0===n&&(n=cn),Math.abs(this.x-t)<=n*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=n*Math.max(1,Math.abs(this.y),Math.abs(e))},n.strictEquals=function(t){return t&&this.x===t.x&&this.y===t.y},n.strictEquals2f=function(t,e){return this.x===t&&this.y===e},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+")"},n.lerp=function(t,e){var n=this.x,i=this.y;return this.x=n+e*(t.x-n),this.y=i+e*(t.y-i),this},n.clampf=function(t,e){return this.x=un(this.x,t.x,e.x),this.y=un(this.y,t.y,e.y),this},n.add=function(t){return this.x+=t.x,this.y+=t.y,this},n.add2f=function(t,e){return this.x+=t,this.y+=e,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this},n.subtract2f=function(t,e){return this.x-=t,this.y-=e,this},n.multiplyScalar=function(t){return"object"==typeof t&&console.warn("should use Vec2.multiply for vector * vector operation"),this.x*=t,this.y*=t,this},n.multiply=function(t){return"object"!=typeof t&&console.warn("should use Vec2.scale for vector * scalar operation"),this.x*=t.x,this.y*=t.y,this},n.multiply2f=function(t,e){return this.x*=t,this.y*=e,this},n.divide=function(t){return this.x/=t.x,this.y/=t.y,this},n.divide2f=function(t,e){return this.x/=t,this.y/=e,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this},n.dot=function(t){return this.x*t.x+this.y*t.y},n.cross=function(t){return this.x*t.y-this.y*t.x},n.length=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},n.lengthSqr=function(){return this.x*this.x+this.y*this.y},n.normalize=function(){var t=this.x,e=this.y,n=t*t+e*e;return n>0&&(n=1/Math.sqrt(n),this.x*=n,this.y*=n),this},n.angle=function(t){var e=this.lengthSqr(),n=t.lengthSqr();if(0===e||0===n)return console.warn("Can't get angle between zero vector"),0;var i=this.dot(t)/Math.sqrt(e*n);return i=un(i,-1,1),Math.acos(i)},n.signAngle=function(t){var e=this.angle(t);return this.cross(t)<0?-e:e},n.rotate=function(t){var e=this.x,n=this.y,i=Math.sin(t),r=Math.cos(t);return this.x=r*e-i*n,this.y=i*e+r*n,this},n.project=function(t){var e=this.dot(t)/t.dot(t);return this.x=t.x*e,this.y=t.y*e,this},n.transformMat4=function(t){var e=this.x,n=this.y;return this.x=t.m00*e+t.m04*n+t.m12,this.y=t.m01*e+t.m05*n+t.m13,this},e}(ue));Qn.ZERO=Object.freeze(new Qn(0,0)),Qn.ONE=Object.freeze(new Qn(1,1)),Qn.NEG_ONE=Object.freeze(new Qn(-1,-1)),Qn.UNIT_X=Object.freeze(new Qn(1,0)),Qn.UNIT_Y=Object.freeze(new Qn(0,1));var Zn=new Qn,$n=new Qn;function ti(t,e){return new Qn(t,e)}en.fastDefine("cc.Vec2",Qn,{x:0,y:0}),h.Vec2=Qn,h.v2=ti;var ei=t("Vec4",function(t){function e(e,n,i,r){var a;return a=t.call(this)||this,e&&"object"==typeof e?(a.x=e.x,a.y=e.y,a.z=e.z,a.w=e.w):(a.x=e||0,a.y=n||0,a.z=i||0,a.w=r||0),a}$(e,t),e.clone=function(t){return new e(t.x,t.y,t.z,t.w)},e.copy=function(t,e){return t.x=e.x,t.y=e.y,t.z=e.z,t.w=e.w,t},e.set=function(t,e,n,i,r){return t.x=e,t.y=n,t.z=i,t.w=r,t},e.add=function(t,e,n){return t.x=e.x+n.x,t.y=e.y+n.y,t.z=e.z+n.z,t.w=e.w+n.w,t},e.subtract=function(t,e,n){return t.x=e.x-n.x,t.y=e.y-n.y,t.z=e.z-n.z,t.w=e.w-n.w,t},e.multiply=function(t,e,n){return t.x=e.x*n.x,t.y=e.y*n.y,t.z=e.z*n.z,t.w=e.w*n.w,t},e.divide=function(t,e,n){return t.x=e.x/n.x,t.y=e.y/n.y,t.z=e.z/n.z,t.w=e.w/n.w,t},e.ceil=function(t,e){return t.x=Math.ceil(e.x),t.y=Math.ceil(e.y),t.z=Math.ceil(e.z),t.w=Math.ceil(e.w),t},e.floor=function(t,e){return t.x=Math.floor(e.x),t.y=Math.floor(e.y),t.z=Math.floor(e.z),t.w=Math.floor(e.w),t},e.min=function(t,e,n){return t.x=Math.min(e.x,n.x),t.y=Math.min(e.y,n.y),t.z=Math.min(e.z,n.z),t.w=Math.min(e.w,n.w),t},e.max=function(t,e,n){return t.x=Math.max(e.x,n.x),t.y=Math.max(e.y,n.y),t.z=Math.max(e.z,n.z),t.w=Math.max(e.w,n.w),t},e.round=function(t,e){return t.x=Math.round(e.x),t.y=Math.round(e.y),t.z=Math.round(e.z),t.w=Math.round(e.w),t},e.multiplyScalar=function(t,e,n){return t.x=e.x*n,t.y=e.y*n,t.z=e.z*n,t.w=e.w*n,t},e.scaleAndAdd=function(t,e,n,i){return t.x=e.x+n.x*i,t.y=e.y+n.y*i,t.z=e.z+n.z*i,t.w=e.w+n.w*i,t},e.distance=function(t,e){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z,a=e.w-t.w;return Math.sqrt(n*n+i*i+r*r+a*a)},e.squaredDistance=function(t,e){var n=e.x-t.x,i=e.y-t.y,r=e.z-t.z,a=e.w-t.w;return n*n+i*i+r*r+a*a},e.len=function(t){var e=t.x,n=t.y,i=t.z,r=t.w;return Math.sqrt(e*e+n*n+i*i+r*r)},e.lengthSqr=function(t){var e=t.x,n=t.y,i=t.z,r=t.w;return e*e+n*n+i*i+r*r},e.negate=function(t,e){return t.x=-e.x,t.y=-e.y,t.z=-e.z,t.w=-e.w,t},e.inverse=function(t,e){return t.x=1/e.x,t.y=1/e.y,t.z=1/e.z,t.w=1/e.w,t},e.inverseSafe=function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w;return Math.abs(n)<cn?t.x=0:t.x=1/n,Math.abs(i)<cn?t.y=0:t.y=1/i,Math.abs(r)<cn?t.z=0:t.z=1/r,Math.abs(a)<cn?t.w=0:t.w=1/a,t},e.normalize=function(t,e){var n=e.x,i=e.y,r=e.z,a=e.w,o=n*n+i*i+r*r+a*a;return o>0&&(o=1/Math.sqrt(o),t.x=n*o,t.y=i*o,t.z=r*o,t.w=a*o),t},e.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},e.lerp=function(t,e,n,i){return t.x=e.x+i*(n.x-e.x),t.y=e.y+i*(n.y-e.y),t.z=e.z+i*(n.z-e.z),t.w=e.w+i*(n.w-e.w),t},e.random=function(t,e){e=e||1;var n=2*mn()*Math.PI,i=2*mn()-1,r=Math.sqrt(1-i*i);return t.x=r*Math.cos(n)*e,t.y=r*Math.sin(n)*e,t.z=i*e,t.w=0,t},e.transformMat4=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=e.w;return t.x=n.m00*i+n.m04*r+n.m08*a+n.m12*o,t.y=n.m01*i+n.m05*r+n.m09*a+n.m13*o,t.z=n.m02*i+n.m06*r+n.m10*a+n.m14*o,t.w=n.m03*i+n.m07*r+n.m11*a+n.m15*o,t},e.transformAffine=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=e.w;return t.x=n.m00*i+n.m04*r+n.m08*a+n.m12*o,t.y=n.m01*i+n.m05*r+n.m09*a+n.m13*o,t.z=n.m02*i+n.m06*r+n.m10*a+n.m14*o,t.w=e.w,t},e.transformQuat=function(t,e,n){var i=e.x,r=e.y,a=e.z,o=n.x,s=n.y,c=n.z,l=n.w,h=l*i+s*a-c*r,u=l*r+c*i-o*a,_=l*a+o*r-s*i,f=-o*i-s*r-c*a;return t.x=h*l+f*-o+u*-c-_*-s,t.y=u*l+f*-s+_*-o-h*-c,t.z=_*l+f*-c+h*-s-u*-o,t.w=e.w,t},e.toArray=function(t,e,n){return void 0===n&&(n=0),t[n+0]=e.x,t[n+1]=e.y,t[n+2]=e.z,t[n+3]=e.w,t},e.fromArray=function(t,e,n){return void 0===n&&(n=0),t.x=e[n+0],t.y=e[n+1],t.z=e[n+2],t.w=e[n+3],t},e.strictEquals=function(t,e){return t.x===e.x&&t.y===e.y&&t.z===e.z&&t.w===e.w},e.equals=function(t,e,n){return void 0===n&&(n=cn),Math.abs(t.x-e.x)<=n*Math.max(1,Math.abs(t.x),Math.abs(e.x))&&Math.abs(t.y-e.y)<=n*Math.max(1,Math.abs(t.y),Math.abs(e.y))&&Math.abs(t.z-e.z)<=n*Math.max(1,Math.abs(t.z),Math.abs(e.z))&&Math.abs(t.w-e.w)<=n*Math.max(1,Math.abs(t.w),Math.abs(e.w))};var n=e.prototype;return n.clone=function(){return new e(this.x,this.y,this.z,this.w)},n.set=function(t,e,n,i){return t&&"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w):(this.x=t||0,this.y=e||0,this.z=n||0,this.w=i||0),this},n.equals=function(t,e){return void 0===e&&(e=cn),Math.abs(this.x-t.x)<=e*Math.max(1,Math.abs(this.x),Math.abs(t.x))&&Math.abs(this.y-t.y)<=e*Math.max(1,Math.abs(this.y),Math.abs(t.y))&&Math.abs(this.z-t.z)<=e*Math.max(1,Math.abs(this.z),Math.abs(t.z))&&Math.abs(this.w-t.w)<=e*Math.max(1,Math.abs(this.w),Math.abs(t.w))},n.equals4f=function(t,e,n,i,r){return void 0===r&&(r=cn),Math.abs(this.x-t)<=r*Math.max(1,Math.abs(this.x),Math.abs(t))&&Math.abs(this.y-e)<=r*Math.max(1,Math.abs(this.y),Math.abs(e))&&Math.abs(this.z-n)<=r*Math.max(1,Math.abs(this.z),Math.abs(n))&&Math.abs(this.w-i)<=r*Math.max(1,Math.abs(this.w),Math.abs(i))},n.strictEquals=function(t){return this.x===t.x&&this.y===t.y&&this.z===t.z&&this.w===t.w},n.strictEquals4f=function(t,e,n,i){return this.x===t&&this.y===e&&this.z===n&&this.w===i},n.lerp=function(t,e){var n=this.x,i=this.y,r=this.z,a=this.w;return this.x=n+e*(t.x-n),this.y=i+e*(t.y-i),this.z=r+e*(t.z-r),this.w=a+e*(t.w-a),this},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.z.toFixed(2)+", "+this.w.toFixed(2)+")"},n.clampf=function(t,e){return this.x=un(this.x,t.x,e.x),this.y=un(this.y,t.y,e.y),this.z=un(this.z,t.z,e.z),this.w=un(this.w,t.w,e.w),this},n.add=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this.w+=t.w,this},n.add4f=function(t,e,n,i){return this.x+=t,this.y+=e,this.z+=n,this.w+=i,this},n.subtract=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this.w-=t.w,this},n.subtract4f=function(t,e,n,i){return this.x-=t,this.y-=e,this.z-=n,this.w-=i,this},n.multiplyScalar=function(t){return"object"==typeof t&&console.warn("should use Vec4.multiply for vector * vector operation"),this.x*=t,this.y*=t,this.z*=t,this.w*=t,this},n.multiply=function(t){return"object"!=typeof t&&console.warn("should use Vec4.scale for vector * scalar operation"),this.x*=t.x,this.y*=t.y,this.z*=t.z,this.w*=t.w,this},n.multiply4f=function(t,e,n,i){return this.x*=t,this.y*=e,this.z*=n,this.w*=i,this},n.divide=function(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this.w/=t.w,this},n.divide4f=function(t,e,n,i){return this.x/=t,this.y/=e,this.z/=n,this.w/=i,this},n.negative=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},n.dot=function(t){return this.x*t.x+this.y*t.y+this.z*t.z+this.w*t.w},n.cross=function(t){var e=this.x,n=this.y,i=this.z,r=t.x,a=t.y,o=t.z;return this.x=n*o-i*a,this.y=i*r-e*o,this.z=e*a-n*r,this},n.length=function(){var t=this.x,e=this.y,n=this.z,i=this.w;return Math.sqrt(t*t+e*e+n*n+i*i)},n.lengthSqr=function(){var t=this.x,e=this.y,n=this.z,i=this.w;return t*t+e*e+n*n+i*i},n.normalize=function(){var t=this.x,e=this.y,n=this.z,i=this.w,r=t*t+e*e+n*n+i*i;return r>0&&(r=1/Math.sqrt(r),this.x=t*r,this.y=e*r,this.z=n*r,this.w=i*r),this},n.transformMat4=function(t){var e=this.x,n=this.y,i=this.z,r=this.w;return this.x=t.m00*e+t.m04*n+t.m08*i+t.m12*r,this.y=t.m01*e+t.m05*n+t.m09*i+t.m13*r,this.z=t.m02*e+t.m06*n+t.m10*i+t.m14*r,this.w=t.m03*e+t.m07*n+t.m11*i+t.m15*r,this},e}(ue));function ni(t,e,n,i){return new ei(t,e,n,i)}ei.ZERO=Object.freeze(new ei(0,0,0,0)),ei.ONE=Object.freeze(new ei(1,1,1,1)),ei.NEG_ONE=Object.freeze(new ei(-1,-1,-1,-1)),en.fastDefine("cc.Vec4",ei,{x:0,y:0,z:0,w:0}),h.Vec4=ei,h.v4=ni,k(Qn,"Vec2",[{name:"sub",newName:"subtract",target:Qn,targetName:"Vec2"},{name:"mul",newName:"multiply",target:Qn,targetName:"Vec2"},{name:"div",newName:"divide",target:Qn,targetName:"Vec2"},{name:"dist",newName:"distance",target:Qn,targetName:"Vec2"},{name:"sqrDist",newName:"squaredDistance",target:Qn,targetName:"Vec2"},{name:"mag",newName:"len",target:Qn,targetName:"Vec2"},{name:"sqrMag",newName:"lengthSqr",target:Qn,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:Qn,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:Qn,targetName:"Vec2"}]),k(Qn.prototype,"Vec2",[{name:"mag",newName:"length",target:Qn.prototype,targetName:"Vec2"},{name:"magSqr",newName:"lengthSqr",target:Qn.prototype,targetName:"Vec2"},{name:"scale",newName:"multiplyScalar",target:Qn.prototype,targetName:"Vec2"},{name:"exactEquals",newName:"strictEquals",target:Qn.prototype,targetName:"Vec2"}]),k(Mn,"Vec3",[{name:"sub",newName:"subtract",target:Mn,targetName:"Vec3"},{name:"mul",newName:"multiply",target:Mn,targetName:"Vec3"},{name:"div",newName:"divide",target:Mn,targetName:"Vec3"},{name:"dist",newName:"distance",target:Mn,targetName:"Vec3"},{name:"sqrDist",newName:"squaredDistance",target:Mn,targetName:"Vec3"},{name:"mag",newName:"len",target:Mn,targetName:"Vec3"},{name:"sqrMag",newName:"lengthSqr",target:Mn,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:Mn,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:Mn,targetName:"Vec3"}]),k(Mn.prototype,"Vec3",[{name:"mag",newName:"length",target:Mn.prototype,targetName:"Vec3"},{name:"magSqr",newName:"lengthSqr",target:Mn.prototype,targetName:"Vec3"},{name:"scale",newName:"multiplyScalar",target:Mn.prototype,targetName:"Vec3"},{name:"exactEquals",newName:"strictEquals",target:Mn.prototype,targetName:"Vec3"}]),k(ei,"Vec4",[{name:"sub",newName:"subtract",target:ei,targetName:"Vec4"},{name:"mul",newName:"multiply",target:ei,targetName:"Vec4"},{name:"div",newName:"divide",target:ei,targetName:"Vec4"},{name:"dist",newName:"distance",target:ei,targetName:"Vec4"},{name:"sqrDist",newName:"squaredDistance",target:ei,targetName:"Vec4"},{name:"mag",newName:"len",target:ei,targetName:"Vec4"},{name:"sqrMag",newName:"lengthSqr",target:ei,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:ei,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:ei,targetName:"Vec4"}]),k(ei.prototype,"Vec4",[{name:"mag",newName:"length",target:ei.prototype,targetName:"Vec4"},{name:"magSqr",newName:"lengthSqr",target:ei.prototype,targetName:"Vec4"},{name:"scale",newName:"multiplyScalar",target:ei.prototype,targetName:"Vec4"},{name:"exactEquals",newName:"strictEquals",target:ei.prototype,targetName:"Vec4"}]),k(zn,"Quat",[{name:"mag",newName:"len",target:zn,targetName:"Quat"},{name:"mul",newName:"multiply",target:zn,targetName:"Quat"},{name:"sqrMag",newName:"lengthSqr",target:zn,targetName:"Quat"},{name:"scale",newName:"multiplyScalar",target:zn,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:zn,targetName:"Quat"}]),k(zn.prototype,"Quat",[{name:"scale",newName:"multiplyScalar",target:zn.prototype,targetName:"Quat"},{name:"exactEquals",newName:"strictEquals",target:zn.prototype,targetName:"Quat"}]),k(Dn,"Color",[{name:"sub",newName:"subtract",target:Dn,targetName:"Color"},{name:"mul",newName:"multiply",target:Dn,targetName:"Color"},{name:"div",newName:"divide",target:Dn,targetName:"Color"},{name:"exactEquals",newName:"strictEquals",target:Dn,targetName:"Color"},{name:"fromHex",newName:"fromHEX",customFunction:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e[1].toString(16);return h.Color.fromHEX(e[0],i)}}]),k(Ln,"Mat3",[{name:"sub",newName:"subtract",target:Ln,targetName:"Mat3"},{name:"mul",newName:"multiply",target:Ln,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:Ln,targetName:"Mat3"},{name:"transfrom",newName:"transform",target:Ln,targetName:"Mat3"}]),k(Ln.prototype,"Mat3",[{name:"sub",newName:"subtract",target:Ln.prototype,targetName:"Mat3"},{name:"mul",newName:"multiply",target:Ln.prototype,targetName:"Mat3"},{name:"mulScalar",newName:"multiplyScalar",target:Ln.prototype,targetName:"Mat3"},{name:"exactEquals",newName:"strictEquals",target:Ln.prototype,targetName:"Mat3"}]),k(Xn,"Mat4",[{name:"sub",newName:"subtract",target:Xn,targetName:"Mat4"},{name:"mul",newName:"multiply",target:Xn,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:Xn,targetName:"Mat4"}]),k(Xn.prototype,"Mat4",[{name:"sub",newName:"subtract",target:Xn.prototype,targetName:"Mat4"},{name:"mul",newName:"multiply",target:Xn.prototype,targetName:"Mat4"},{name:"mulScalar",newName:"multiplyScalar",target:Xn.prototype,targetName:"Mat4"},{name:"exactEquals",newName:"strictEquals",target:Xn.prototype,targetName:"Mat4"}]);var ii=t("AffineTransform",function(){function t(t,e,n,i,r,a){void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===a&&(a=0),this.a=t,this.b=e,this.c=n,this.d=i,this.tx=r,this.ty=a}return t.identity=function(){return new t},t.clone=function(e){return new t(e.a,e.b,e.c,e.d,e.tx,e.ty)},t.concat=function(t,e,n){var i=e.a,r=e.b,a=e.c,o=e.d,s=e.tx,c=e.ty;t.a=i*n.a+r*n.c,t.b=i*n.b+r*n.d,t.c=a*n.a+o*n.c,t.d=a*n.b+o*n.d,t.tx=s*n.a+c*n.c+n.tx,t.ty=s*n.b+c*n.d+n.ty},t.invert=function(t,e){var n=1/(e.a*e.d-e.b*e.c);t.a=n*e.d,t.b=-n*e.b,t.c=-n*e.c,t.d=n*e.a,t.tx=n*(e.c*e.ty-e.d*e.tx),t.ty=n*(e.b*e.tx-e.a*e.ty)},t.fromMat4=function(t,e){t.a=e.m00,t.b=e.m01,t.c=e.m04,t.d=e.m05,t.tx=e.m12,t.ty=e.m13},t.transformVec2=function(t,e,n,i){var r,a;i?(r=e,a=n):(i=n,r=e.x,a=e.y),t.x=i.a*r+i.c*a+i.tx,t.y=i.b*r+i.d*a+i.ty},t.transformSize=function(t,e,n){t.width=n.a*e.width+n.c*e.height,t.height=n.b*e.width+n.d*e.height},t.transformRect=function(t,e,n){var i=e.x+e.width,r=e.y+e.height,a=n.a*e.x+n.c*e.y+n.tx,o=n.b*e.x+n.d*e.y+n.ty,s=n.a*i+n.c*e.y+n.tx,c=n.b*i+n.d*e.y+n.ty,l=n.a*e.x+n.c*r+n.tx,h=n.b*e.x+n.d*r+n.ty,u=n.a*i+n.c*r+n.tx,_=n.b*i+n.d*r+n.ty,f=Math.min(a,s,l,u),d=Math.max(a,s,l,u),p=Math.min(o,c,h,_),m=Math.max(o,c,h,_);t.x=f,t.y=p,t.width=d-f,t.height=m-p},t.transformObb=function(t,e,n,i,r,a){var o=a.a*r.x+a.c*r.y+a.tx,s=a.b*r.x+a.d*r.y+a.ty,c=a.a*r.width,l=a.b*r.width,h=a.c*r.height,u=a.d*r.height;e.x=o,e.y=s,n.x=c+o,n.y=l+s,t.x=h+o,t.y=u+s,i.x=c+h+o,i.y=l+u+s},t}());h.AffineTransform=ii;var ri=t("Size",function(t){function e(e,n){var i;return i=t.call(this)||this,e&&"object"==typeof e?(i.width=e.width,i.height=e.height):(i.width=e||0,i.height=n||0),i}$(e,t),e.lerp=function(t,e,n,i){return t.width=e.width+(n.width-e.width)*i,t.height=e.height+(n.height-e.height)*i,t};var n=e.prototype;return n.clone=function(){return new e(this.width,this.height)},n.set=function(t,e){return t&&"object"==typeof t?(this.height=t.height,this.width=t.width):(this.width=t||0,this.height=e||0),this},n.equals=function(t){return this.width===t.width&&this.height===t.height},n.lerp=function(t,e){return this.width+=(t.width-this.width)*e,this.height+=(t.height-this.height)*e,this},n.toString=function(){return"("+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},Q(e,[{key:"x",get:function(){return this.width},set:function(t){this.width=t}},{key:"y",get:function(){return this.height},set:function(t){this.height=t}}]),e}(ue));function ai(t,e){return void 0===t&&(t=0),void 0===e&&(e=0),new ri(t,e)}ri.ZERO=Object.freeze(new ri(0,0)),ri.ONE=Object.freeze(new ri(1,1)),en.fastDefine("cc.Size",ri,{width:0,height:0}),h.size=ai,h.Size=ri;var oi=t("Rect",function(t){function e(e,n,i,r){var a;return a=t.call(this)||this,e&&"object"==typeof e?(a.y=e.y,a.width=e.width,a.height=e.height,a.x=e.x):(a.x=e||0,a.y=n||0,a.width=i||0,a.height=r||0),a}$(e,t),e.fromMinMax=function(t,e,n){var i=Math.min(e.x,n.x),r=Math.min(e.y,n.y),a=Math.max(e.x,n.x),o=Math.max(e.y,n.y);return t.x=i,t.y=r,t.width=a-i,t.height=o-r,t},e.lerp=function(t,e,n,i){var r=e.x,a=e.y,o=e.width,s=e.height;return t.x=r+(n.x-r)*i,t.y=a+(n.y-a)*i,t.width=o+(n.width-o)*i,t.height=s+(n.height-s)*i,t},e.intersection=function(t,e,n){var i=e.x,r=e.y,a=e.x+e.width,o=e.y+e.height,s=n.x,c=n.y,l=n.x+n.width,h=n.y+n.height;return t.x=Math.max(i,s),t.y=Math.max(r,c),t.width=Math.min(a,l)-t.x,t.height=Math.min(o,h)-t.y,t},e.union=function(t,e,n){var i=e.x,r=e.y,a=e.width,o=e.height,s=n.x,c=n.y,l=n.width,h=n.height;return t.x=Math.min(i,s),t.y=Math.min(r,c),t.width=Math.max(i+a,s+l)-t.x,t.height=Math.max(r+o,c+h)-t.y,t};var n=e.prototype;return n.clone=function(){return new e(this.x,this.y,this.width,this.height)},n.set=function(t,e,n,i){return t&&"object"==typeof t?(this.y=t.y,this.width=t.width,this.height=t.height,this.x=t.x):(this.x=t||0,this.y=e||0,this.width=n||0,this.height=i||0),this},n.equals=function(t){return this.x===t.x&&this.y===t.y&&this.width===t.width&&this.height===t.height},n.lerp=function(t,e){var n=this.x,i=this.y,r=this.width,a=this.height;return this.x=n+(t.x-n)*e,this.y=i+(t.y-i)*e,this.width=r+(t.width-r)*e,this.height=a+(t.height-a)*e,this},n.toString=function(){return"("+this.x.toFixed(2)+", "+this.y.toFixed(2)+", "+this.width.toFixed(2)+", "+this.height.toFixed(2)+")"},n.intersects=function(t){var e=this.x+this.width,n=this.y+this.height,i=t.x+t.width,r=t.y+t.height;return!(e<t.x||i<this.x||n<t.y||r<this.y)},n.contains=function(t){return this.x<=t.x&&this.x+this.width>=t.x&&this.y<=t.y&&this.y+this.height>=t.y},n.containsRect=function(t){return this.x<=t.x&&this.x+this.width>=t.x+t.width&&this.y<=t.y&&this.y+this.height>=t.y+t.height},n.transformMat4=function(t){var e=this.x,n=this.y,i=e+this.width,r=n+this.height,a=t.m00*e+t.m04*n+t.m12,o=t.m01*e+t.m05*n+t.m13,s=t.m00*i+t.m04*n+t.m12,c=t.m01*i+t.m05*n+t.m13,l=t.m00*e+t.m04*r+t.m12,h=t.m01*e+t.m05*r+t.m13,u=t.m00*i+t.m04*r+t.m12,_=t.m01*i+t.m05*r+t.m13,f=Math.min(a,s,l,u),d=Math.max(a,s,l,u),p=Math.min(o,c,h,_),m=Math.max(o,c,h,_);return this.x=f,this.y=p,this.width=d-f,this.height=m-p,this},n.transformMat4ToPoints=function(t,e,n,i,r){var a=this.x,o=this.y,s=a+this.width,c=o+this.height;e.x=t.m00*a+t.m04*o+t.m12,e.y=t.m01*a+t.m05*o+t.m13,r.x=t.m00*s+t.m04*o+t.m12,r.y=t.m01*s+t.m05*o+t.m13,n.x=t.m00*a+t.m04*c+t.m12,n.y=t.m01*a+t.m05*c+t.m13,i.x=t.m00*s+t.m04*c+t.m12,i.y=t.m01*s+t.m05*c+t.m13},Q(e,[{key:"xMin",get:function(){return this.x},set:function(t){this.width+=this.x-t,this.x=t}},{key:"yMin",get:function(){return this.y},set:function(t){this.height+=this.y-t,this.y=t}},{key:"xMax",get:function(){return this.x+this.width},set:function(t){this.width=t-this.x}},{key:"yMax",get:function(){return this.y+this.height},set:function(t){this.height=t-this.y}},{key:"center",get:function(){return new Qn(this.x+.5*this.width,this.y+.5*this.height)},set:function(t){this.x=t.x-.5*this.width,this.y=t.y-.5*this.height}},{key:"origin",get:function(){return new Qn(this.x,this.y)},set:function(t){this.x=t.x,this.y=t.y}},{key:"size",get:function(){return new ri(this.width,this.height)},set:function(t){this.width=t.width,this.height=t.height}},{key:"z",get:function(){return this.width},set:function(t){this.width=t}},{key:"w",get:function(){return this.height},set:function(t){this.height=t}}]),e}(ue));function si(t,e,n,i){return void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),new oi(t,e,n,i)}en.fastDefine("cc.Rect",oi,{x:0,y:0,width:0,height:0}),h.Rect=oi,h.rect=si;var ci=t("MATH_FLOAT_ARRAY",Float64Array),li=t("MathBase",function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e.createFloatArray=function(t){return new ci(t)},Q(e,[{key:"array",get:function(){return this._array}}]),e}(ue)),hi=Object.freeze({__proto__:null,bits:s,Vec2:Qn,v2:ti,Vec3:Mn,v3:Bn,Vec4:ei,v4:ni,Quat:zn,quat:Wn,Mat3:Ln,Mat4:Xn,mat4:Jn,AffineTransform:ii,Size:ri,size:ai,Rect:oi,rect:si,Color:Dn,color:Rn,EPSILON:cn,equals:ln,approx:hn,clamp:un,clamp01:_n,lerp:fn,toRadian:dn,toDegree:pn,random:mn,randomRange:vn,randomRangeInt:gn,pseudoRandom:yn,pseudoRandomRange:xn,pseudoRandomRangeInt:Sn,nextPow2:An,repeat:bn,pingPong:Cn,inverseLerp:Tn,absMaxComponent:En,absMax:wn,enumerableProps:In,MATH_FLOAT_ARRAY:ci,MathBase:li});t("math",hi);var ui,_i,fi,di,pi,mi,vi,gi,yi,xi,Si,Ai,bi,Ci,Ti,Ei,wi,Ii,Pi,Di,Ri,Mi,Oi,Ni,Bi,Li,Fi,Vi,zi,ki,Ui,Gi,Hi,ji,Wi,qi,Xi,Yi,Ki,Ji,Qi,Zi,$i=new(function(){function t(){this._finalizationRegistry=null,this._gcObjects=new WeakMap}var e=t.prototype;return e.registerGCObject=function(t){return t},e.init=function(){},e.finalizationRegistryCallback=function(t){var e=this._gcObjects.get(t);e&&(this._gcObjects.delete(t),e.destroy()),this._finalizationRegistry.unregister(t)},e.destroy=function(){},t}()),tr=function(){function t(){return $i.registerGCObject(this)}return t.prototype.destroy=function(){},t}(),er=function(t,e,n){for(var i=0;i<e.length;++i)t.length<=i&&t.push(new n),t[i].copy(e[i]);t.length=e.length};!function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.SWAPCHAIN=1]="SWAPCHAIN",t[t.BUFFER=2]="BUFFER",t[t.TEXTURE=3]="TEXTURE",t[t.RENDER_PASS=4]="RENDER_PASS",t[t.FRAMEBUFFER=5]="FRAMEBUFFER",t[t.SAMPLER=6]="SAMPLER",t[t.SHADER=7]="SHADER",t[t.DESCRIPTOR_SET_LAYOUT=8]="DESCRIPTOR_SET_LAYOUT",t[t.PIPELINE_LAYOUT=9]="PIPELINE_LAYOUT",t[t.PIPELINE_STATE=10]="PIPELINE_STATE",t[t.DESCRIPTOR_SET=11]="DESCRIPTOR_SET",t[t.INPUT_ASSEMBLER=12]="INPUT_ASSEMBLER",t[t.COMMAND_BUFFER=13]="COMMAND_BUFFER",t[t.QUEUE=14]="QUEUE",t[t.QUERY_POOL=15]="QUERY_POOL",t[t.GLOBAL_BARRIER=16]="GLOBAL_BARRIER",t[t.TEXTURE_BARRIER=17]="TEXTURE_BARRIER",t[t.BUFFER_BARRIER=18]="BUFFER_BARRIER",t[t.COUNT=19]="COUNT"}(ui||(ui={})),function(t){t[t.UNREADY=0]="UNREADY",t[t.FAILED=1]="FAILED",t[t.SUCCESS=2]="SUCCESS"}(_i||(_i={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.GLES2=1]="GLES2",t[t.GLES3=2]="GLES3",t[t.METAL=3]="METAL",t[t.VULKAN=4]="VULKAN",t[t.NVN=5]="NVN",t[t.WEBGL=6]="WEBGL",t[t.WEBGL2=7]="WEBGL2",t[t.WEBGPU=8]="WEBGPU"}(fi||(fi={})),function(t){t[t.IDENTITY=0]="IDENTITY",t[t.ROTATE_90=1]="ROTATE_90",t[t.ROTATE_180=2]="ROTATE_180",t[t.ROTATE_270=3]="ROTATE_270"}(di||(di={})),function(t){t[t.ELEMENT_INDEX_UINT=0]="ELEMENT_INDEX_UINT",t[t.INSTANCED_ARRAYS=1]="INSTANCED_ARRAYS",t[t.MULTIPLE_RENDER_TARGETS=2]="MULTIPLE_RENDER_TARGETS",t[t.BLEND_MINMAX=3]="BLEND_MINMAX",t[t.COMPUTE_SHADER=4]="COMPUTE_SHADER",t[t.INPUT_ATTACHMENT_BENEFIT=5]="INPUT_ATTACHMENT_BENEFIT",t[t.COUNT=6]="COUNT"}(pi||(pi={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.A8=1]="A8",t[t.L8=2]="L8",t[t.LA8=3]="LA8",t[t.R8=4]="R8",t[t.R8SN=5]="R8SN",t[t.R8UI=6]="R8UI",t[t.R8I=7]="R8I",t[t.R16F=8]="R16F",t[t.R16UI=9]="R16UI",t[t.R16I=10]="R16I",t[t.R32F=11]="R32F",t[t.R32UI=12]="R32UI",t[t.R32I=13]="R32I",t[t.RG8=14]="RG8",t[t.RG8SN=15]="RG8SN",t[t.RG8UI=16]="RG8UI",t[t.RG8I=17]="RG8I",t[t.RG16F=18]="RG16F",t[t.RG16UI=19]="RG16UI",t[t.RG16I=20]="RG16I",t[t.RG32F=21]="RG32F",t[t.RG32UI=22]="RG32UI",t[t.RG32I=23]="RG32I",t[t.RGB8=24]="RGB8",t[t.SRGB8=25]="SRGB8",t[t.RGB8SN=26]="RGB8SN",t[t.RGB8UI=27]="RGB8UI",t[t.RGB8I=28]="RGB8I",t[t.RGB16F=29]="RGB16F",t[t.RGB16UI=30]="RGB16UI",t[t.RGB16I=31]="RGB16I",t[t.RGB32F=32]="RGB32F",t[t.RGB32UI=33]="RGB32UI",t[t.RGB32I=34]="RGB32I",t[t.RGBA8=35]="RGBA8",t[t.BGRA8=36]="BGRA8",t[t.SRGB8_A8=37]="SRGB8_A8",t[t.RGBA8SN=38]="RGBA8SN",t[t.RGBA8UI=39]="RGBA8UI",t[t.RGBA8I=40]="RGBA8I",t[t.RGBA16F=41]="RGBA16F",t[t.RGBA16UI=42]="RGBA16UI",t[t.RGBA16I=43]="RGBA16I",t[t.RGBA32F=44]="RGBA32F",t[t.RGBA32UI=45]="RGBA32UI",t[t.RGBA32I=46]="RGBA32I",t[t.R5G6B5=47]="R5G6B5",t[t.R11G11B10F=48]="R11G11B10F",t[t.RGB5A1=49]="RGB5A1",t[t.RGBA4=50]="RGBA4",t[t.RGB10A2=51]="RGB10A2",t[t.RGB10A2UI=52]="RGB10A2UI",t[t.RGB9E5=53]="RGB9E5",t[t.DEPTH=54]="DEPTH",t[t.DEPTH_STENCIL=55]="DEPTH_STENCIL",t[t.BC1=56]="BC1",t[t.BC1_ALPHA=57]="BC1_ALPHA",t[t.BC1_SRGB=58]="BC1_SRGB",t[t.BC1_SRGB_ALPHA=59]="BC1_SRGB_ALPHA",t[t.BC2=60]="BC2",t[t.BC2_SRGB=61]="BC2_SRGB",t[t.BC3=62]="BC3",t[t.BC3_SRGB=63]="BC3_SRGB",t[t.BC4=64]="BC4",t[t.BC4_SNORM=65]="BC4_SNORM",t[t.BC5=66]="BC5",t[t.BC5_SNORM=67]="BC5_SNORM",t[t.BC6H_UF16=68]="BC6H_UF16",t[t.BC6H_SF16=69]="BC6H_SF16",t[t.BC7=70]="BC7",t[t.BC7_SRGB=71]="BC7_SRGB",t[t.ETC_RGB8=72]="ETC_RGB8",t[t.ETC2_RGB8=73]="ETC2_RGB8",t[t.ETC2_SRGB8=74]="ETC2_SRGB8",t[t.ETC2_RGB8_A1=75]="ETC2_RGB8_A1",t[t.ETC2_SRGB8_A1=76]="ETC2_SRGB8_A1",t[t.ETC2_RGBA8=77]="ETC2_RGBA8",t[t.ETC2_SRGB8_A8=78]="ETC2_SRGB8_A8",t[t.EAC_R11=79]="EAC_R11",t[t.EAC_R11SN=80]="EAC_R11SN",t[t.EAC_RG11=81]="EAC_RG11",t[t.EAC_RG11SN=82]="EAC_RG11SN",t[t.PVRTC_RGB2=83]="PVRTC_RGB2",t[t.PVRTC_RGBA2=84]="PVRTC_RGBA2",t[t.PVRTC_RGB4=85]="PVRTC_RGB4",t[t.PVRTC_RGBA4=86]="PVRTC_RGBA4",t[t.PVRTC2_2BPP=87]="PVRTC2_2BPP",t[t.PVRTC2_4BPP=88]="PVRTC2_4BPP",t[t.ASTC_RGBA_4X4=89]="ASTC_RGBA_4X4",t[t.ASTC_RGBA_5X4=90]="ASTC_RGBA_5X4",t[t.ASTC_RGBA_5X5=91]="ASTC_RGBA_5X5",t[t.ASTC_RGBA_6X5=92]="ASTC_RGBA_6X5",t[t.ASTC_RGBA_6X6=93]="ASTC_RGBA_6X6",t[t.ASTC_RGBA_8X5=94]="ASTC_RGBA_8X5",t[t.ASTC_RGBA_8X6=95]="ASTC_RGBA_8X6",t[t.ASTC_RGBA_8X8=96]="ASTC_RGBA_8X8",t[t.ASTC_RGBA_10X5=97]="ASTC_RGBA_10X5",t[t.ASTC_RGBA_10X6=98]="ASTC_RGBA_10X6",t[t.ASTC_RGBA_10X8=99]="ASTC_RGBA_10X8",t[t.ASTC_RGBA_10X10=100]="ASTC_RGBA_10X10",t[t.ASTC_RGBA_12X10=101]="ASTC_RGBA_12X10",t[t.ASTC_RGBA_12X12=102]="ASTC_RGBA_12X12",t[t.ASTC_SRGBA_4X4=103]="ASTC_SRGBA_4X4",t[t.ASTC_SRGBA_5X4=104]="ASTC_SRGBA_5X4",t[t.ASTC_SRGBA_5X5=105]="ASTC_SRGBA_5X5",t[t.ASTC_SRGBA_6X5=106]="ASTC_SRGBA_6X5",t[t.ASTC_SRGBA_6X6=107]="ASTC_SRGBA_6X6",t[t.ASTC_SRGBA_8X5=108]="ASTC_SRGBA_8X5",t[t.ASTC_SRGBA_8X6=109]="ASTC_SRGBA_8X6",t[t.ASTC_SRGBA_8X8=110]="ASTC_SRGBA_8X8",t[t.ASTC_SRGBA_10X5=111]="ASTC_SRGBA_10X5",t[t.ASTC_SRGBA_10X6=112]="ASTC_SRGBA_10X6",t[t.ASTC_SRGBA_10X8=113]="ASTC_SRGBA_10X8",t[t.ASTC_SRGBA_10X10=114]="ASTC_SRGBA_10X10",t[t.ASTC_SRGBA_12X10=115]="ASTC_SRGBA_12X10",t[t.ASTC_SRGBA_12X12=116]="ASTC_SRGBA_12X12",t[t.COUNT=117]="COUNT"}(mi||(mi={})),function(t){t[t.NONE=0]="NONE",t[t.UNORM=1]="UNORM",t[t.SNORM=2]="SNORM",t[t.UINT=3]="UINT",t[t.INT=4]="INT",t[t.UFLOAT=5]="UFLOAT",t[t.FLOAT=6]="FLOAT"}(vi||(vi={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.BOOL=1]="BOOL",t[t.BOOL2=2]="BOOL2",t[t.BOOL3=3]="BOOL3",t[t.BOOL4=4]="BOOL4",t[t.INT=5]="INT",t[t.INT2=6]="INT2",t[t.INT3=7]="INT3",t[t.INT4=8]="INT4",t[t.UINT=9]="UINT",t[t.UINT2=10]="UINT2",t[t.UINT3=11]="UINT3",t[t.UINT4=12]="UINT4",t[t.FLOAT=13]="FLOAT",t[t.FLOAT2=14]="FLOAT2",t[t.FLOAT3=15]="FLOAT3",t[t.FLOAT4=16]="FLOAT4",t[t.MAT2=17]="MAT2",t[t.MAT2X3=18]="MAT2X3",t[t.MAT2X4=19]="MAT2X4",t[t.MAT3X2=20]="MAT3X2",t[t.MAT3=21]="MAT3",t[t.MAT3X4=22]="MAT3X4",t[t.MAT4X2=23]="MAT4X2",t[t.MAT4X3=24]="MAT4X3",t[t.MAT4=25]="MAT4",t[t.SAMPLER1D=26]="SAMPLER1D",t[t.SAMPLER1D_ARRAY=27]="SAMPLER1D_ARRAY",t[t.SAMPLER2D=28]="SAMPLER2D",t[t.SAMPLER2D_ARRAY=29]="SAMPLER2D_ARRAY",t[t.SAMPLER3D=30]="SAMPLER3D",t[t.SAMPLER_CUBE=31]="SAMPLER_CUBE",t[t.SAMPLER=32]="SAMPLER",t[t.TEXTURE1D=33]="TEXTURE1D",t[t.TEXTURE1D_ARRAY=34]="TEXTURE1D_ARRAY",t[t.TEXTURE2D=35]="TEXTURE2D",t[t.TEXTURE2D_ARRAY=36]="TEXTURE2D_ARRAY",t[t.TEXTURE3D=37]="TEXTURE3D",t[t.TEXTURE_CUBE=38]="TEXTURE_CUBE",t[t.IMAGE1D=39]="IMAGE1D",t[t.IMAGE1D_ARRAY=40]="IMAGE1D_ARRAY",t[t.IMAGE2D=41]="IMAGE2D",t[t.IMAGE2D_ARRAY=42]="IMAGE2D_ARRAY",t[t.IMAGE3D=43]="IMAGE3D",t[t.IMAGE_CUBE=44]="IMAGE_CUBE",t[t.SUBPASS_INPUT=45]="SUBPASS_INPUT",t[t.COUNT=46]="COUNT"}(gi||(gi={})),function(t){t[t.NONE=0]="NONE",t[t.TRANSFER_SRC=1]="TRANSFER_SRC",t[t.TRANSFER_DST=2]="TRANSFER_DST",t[t.INDEX=4]="INDEX",t[t.VERTEX=8]="VERTEX",t[t.UNIFORM=16]="UNIFORM",t[t.STORAGE=32]="STORAGE",t[t.INDIRECT=64]="INDIRECT"}(yi||(yi={})),function(t){t[t.NONE=0]="NONE"}(xi||(xi={})),function(t){t[t.NONE=0]="NONE",t[t.READ_ONLY=1]="READ_ONLY",t[t.WRITE_ONLY=2]="WRITE_ONLY",t[t.READ_WRITE=3]="READ_WRITE"}(Si||(Si={})),function(t){t[t.NONE=0]="NONE",t[t.DEVICE=1]="DEVICE",t[t.HOST=2]="HOST"}(Ai||(Ai={})),function(t){t[t.TEX1D=0]="TEX1D",t[t.TEX2D=1]="TEX2D",t[t.TEX3D=2]="TEX3D",t[t.CUBE=3]="CUBE",t[t.TEX1D_ARRAY=4]="TEX1D_ARRAY",t[t.TEX2D_ARRAY=5]="TEX2D_ARRAY"}(bi||(bi={})),function(t){t[t.NONE=0]="NONE",t[t.TRANSFER_SRC=1]="TRANSFER_SRC",t[t.TRANSFER_DST=2]="TRANSFER_DST",t[t.SAMPLED=4]="SAMPLED",t[t.STORAGE=8]="STORAGE",t[t.COLOR_ATTACHMENT=16]="COLOR_ATTACHMENT",t[t.DEPTH_STENCIL_ATTACHMENT=32]="DEPTH_STENCIL_ATTACHMENT",t[t.INPUT_ATTACHMENT=64]="INPUT_ATTACHMENT"}(Ci||(Ci={})),function(t){t[t.NONE=0]="NONE",t[t.GEN_MIPMAP=1]="GEN_MIPMAP",t[t.GENERAL_LAYOUT=2]="GENERAL_LAYOUT"}(Ti||(Ti={})),function(t){t[t.NONE=0]="NONE",t[t.RENDER_TARGET=1]="RENDER_TARGET",t[t.SAMPLED_TEXTURE=2]="SAMPLED_TEXTURE",t[t.LINEAR_FILTER=4]="LINEAR_FILTER",t[t.STORAGE_TEXTURE=8]="STORAGE_TEXTURE",t[t.VERTEX_ATTRIBUTE=16]="VERTEX_ATTRIBUTE"}(Ei||(Ei={})),function(t){t[t.ONE=0]="ONE",t[t.MULTIPLE_PERFORMANCE=1]="MULTIPLE_PERFORMANCE",t[t.MULTIPLE_BALANCE=2]="MULTIPLE_BALANCE",t[t.MULTIPLE_QUALITY=3]="MULTIPLE_QUALITY"}(wi||(wi={})),function(t){t[t.OFF=0]="OFF",t[t.ON=1]="ON",t[t.RELAXED=2]="RELAXED",t[t.MAILBOX=3]="MAILBOX",t[t.HALF=4]="HALF"}(Ii||(Ii={})),function(t){t[t.NONE=0]="NONE",t[t.POINT=1]="POINT",t[t.LINEAR=2]="LINEAR",t[t.ANISOTROPIC=3]="ANISOTROPIC"}(Pi||(Pi={})),function(t){t[t.WRAP=0]="WRAP",t[t.MIRROR=1]="MIRROR",t[t.CLAMP=2]="CLAMP",t[t.BORDER=3]="BORDER"}(Di||(Di={})),function(t){t[t.NEVER=0]="NEVER",t[t.LESS=1]="LESS",t[t.EQUAL=2]="EQUAL",t[t.LESS_EQUAL=3]="LESS_EQUAL",t[t.GREATER=4]="GREATER",t[t.NOT_EQUAL=5]="NOT_EQUAL",t[t.GREATER_EQUAL=6]="GREATER_EQUAL",t[t.ALWAYS=7]="ALWAYS"}(Ri||(Ri={})),function(t){t[t.ZERO=0]="ZERO",t[t.KEEP=1]="KEEP",t[t.REPLACE=2]="REPLACE",t[t.INCR=3]="INCR",t[t.DECR=4]="DECR",t[t.INVERT=5]="INVERT",t[t.INCR_WRAP=6]="INCR_WRAP",t[t.DECR_WRAP=7]="DECR_WRAP"}(Mi||(Mi={})),function(t){t[t.ZERO=0]="ZERO",t[t.ONE=1]="ONE",t[t.SRC_ALPHA=2]="SRC_ALPHA",t[t.DST_ALPHA=3]="DST_ALPHA",t[t.ONE_MINUS_SRC_ALPHA=4]="ONE_MINUS_SRC_ALPHA",t[t.ONE_MINUS_DST_ALPHA=5]="ONE_MINUS_DST_ALPHA",t[t.SRC_COLOR=6]="SRC_COLOR",t[t.DST_COLOR=7]="DST_COLOR",t[t.ONE_MINUS_SRC_COLOR=8]="ONE_MINUS_SRC_COLOR",t[t.ONE_MINUS_DST_COLOR=9]="ONE_MINUS_DST_COLOR",t[t.SRC_ALPHA_SATURATE=10]="SRC_ALPHA_SATURATE",t[t.CONSTANT_COLOR=11]="CONSTANT_COLOR",t[t.ONE_MINUS_CONSTANT_COLOR=12]="ONE_MINUS_CONSTANT_COLOR",t[t.CONSTANT_ALPHA=13]="CONSTANT_ALPHA",t[t.ONE_MINUS_CONSTANT_ALPHA=14]="ONE_MINUS_CONSTANT_ALPHA"}(Oi||(Oi={})),function(t){t[t.ADD=0]="ADD",t[t.SUB=1]="SUB",t[t.REV_SUB=2]="REV_SUB",t[t.MIN=3]="MIN",t[t.MAX=4]="MAX"}(Ni||(Ni={})),function(t){t[t.NONE=0]="NONE",t[t.R=1]="R",t[t.G=2]="G",t[t.B=4]="B",t[t.A=8]="A",t[t.ALL=15]="ALL"}(Bi||(Bi={})),function(t){t[t.NONE=0]="NONE",t[t.VERTEX=1]="VERTEX",t[t.CONTROL=2]="CONTROL",t[t.EVALUATION=4]="EVALUATION",t[t.GEOMETRY=8]="GEOMETRY",t[t.FRAGMENT=16]="FRAGMENT",t[t.COMPUTE=32]="COMPUTE",t[t.ALL=63]="ALL"}(Li||(Li={})),function(t){t[t.LOAD=0]="LOAD",t[t.CLEAR=1]="CLEAR",t[t.DISCARD=2]="DISCARD"}(Fi||(Fi={})),function(t){t[t.STORE=0]="STORE",t[t.DISCARD=1]="DISCARD"}(Vi||(Vi={})),function(t){t[t.NONE=0]="NONE",t[t.INDIRECT_BUFFER=1]="INDIRECT_BUFFER",t[t.INDEX_BUFFER=2]="INDEX_BUFFER",t[t.VERTEX_BUFFER=4]="VERTEX_BUFFER",t[t.VERTEX_SHADER_READ_UNIFORM_BUFFER=8]="VERTEX_SHADER_READ_UNIFORM_BUFFER",t[t.VERTEX_SHADER_READ_TEXTURE=16]="VERTEX_SHADER_READ_TEXTURE",t[t.VERTEX_SHADER_READ_OTHER=32]="VERTEX_SHADER_READ_OTHER",t[t.FRAGMENT_SHADER_READ_UNIFORM_BUFFER=64]="FRAGMENT_SHADER_READ_UNIFORM_BUFFER",t[t.FRAGMENT_SHADER_READ_TEXTURE=128]="FRAGMENT_SHADER_READ_TEXTURE",t[t.FRAGMENT_SHADER_READ_COLOR_INPUT_ATTACHMENT=256]="FRAGMENT_SHADER_READ_COLOR_INPUT_ATTACHMENT",t[t.FRAGMENT_SHADER_READ_DEPTH_STENCIL_INPUT_ATTACHMENT=512]="FRAGMENT_SHADER_READ_DEPTH_STENCIL_INPUT_ATTACHMENT",t[t.FRAGMENT_SHADER_READ_OTHER=1024]="FRAGMENT_SHADER_READ_OTHER",t[t.COLOR_ATTACHMENT_READ=2048]="COLOR_ATTACHMENT_READ",t[t.DEPTH_STENCIL_ATTACHMENT_READ=4096]="DEPTH_STENCIL_ATTACHMENT_READ",t[t.COMPUTE_SHADER_READ_UNIFORM_BUFFER=8192]="COMPUTE_SHADER_READ_UNIFORM_BUFFER",t[t.COMPUTE_SHADER_READ_TEXTURE=16384]="COMPUTE_SHADER_READ_TEXTURE",t[t.COMPUTE_SHADER_READ_OTHER=32768]="COMPUTE_SHADER_READ_OTHER",t[t.TRANSFER_READ=65536]="TRANSFER_READ",t[t.HOST_READ=131072]="HOST_READ",t[t.PRESENT=262144]="PRESENT",t[t.VERTEX_SHADER_WRITE=524288]="VERTEX_SHADER_WRITE",t[t.FRAGMENT_SHADER_WRITE=1048576]="FRAGMENT_SHADER_WRITE",t[t.COLOR_ATTACHMENT_WRITE=2097152]="COLOR_ATTACHMENT_WRITE",t[t.DEPTH_STENCIL_ATTACHMENT_WRITE=4194304]="DEPTH_STENCIL_ATTACHMENT_WRITE",t[t.COMPUTE_SHADER_WRITE=8388608]="COMPUTE_SHADER_WRITE",t[t.TRANSFER_WRITE=16777216]="TRANSFER_WRITE",t[t.HOST_PREINITIALIZED=33554432]="HOST_PREINITIALIZED",t[t.HOST_WRITE=67108864]="HOST_WRITE"}(zi||(zi={})),function(t){t[t.NONE=0]="NONE",t[t.SAMPLE_ZERO=1]="SAMPLE_ZERO",t[t.AVERAGE=2]="AVERAGE",t[t.MIN=3]="MIN",t[t.MAX=4]="MAX"}(ki||(ki={})),function(t){t[t.GRAPHICS=0]="GRAPHICS",t[t.COMPUTE=1]="COMPUTE",t[t.RAY_TRACING=2]="RAY_TRACING"}(Ui||(Ui={})),function(t){t[t.POINT_LIST=0]="POINT_LIST",t[t.LINE_LIST=1]="LINE_LIST",t[t.LINE_STRIP=2]="LINE_STRIP",t[t.LINE_LOOP=3]="LINE_LOOP",t[t.LINE_LIST_ADJACENCY=4]="LINE_LIST_ADJACENCY",t[t.LINE_STRIP_ADJACENCY=5]="LINE_STRIP_ADJACENCY",t[t.ISO_LINE_LIST=6]="ISO_LINE_LIST",t[t.TRIANGLE_LIST=7]="TRIANGLE_LIST",t[t.TRIANGLE_STRIP=8]="TRIANGLE_STRIP",t[t.TRIANGLE_FAN=9]="TRIANGLE_FAN",t[t.TRIANGLE_LIST_ADJACENCY=10]="TRIANGLE_LIST_ADJACENCY",t[t.TRIANGLE_STRIP_ADJACENCY=11]="TRIANGLE_STRIP_ADJACENCY",t[t.TRIANGLE_PATCH_ADJACENCY=12]="TRIANGLE_PATCH_ADJACENCY",t[t.QUAD_PATCH_LIST=13]="QUAD_PATCH_LIST"}(Gi||(Gi={})),function(t){t[t.FILL=0]="FILL",t[t.POINT=1]="POINT",t[t.LINE=2]="LINE"}(Hi||(Hi={})),function(t){t[t.GOURAND=0]="GOURAND",t[t.FLAT=1]="FLAT"}(ji||(ji={})),function(t){t[t.NONE=0]="NONE",t[t.FRONT=1]="FRONT",t[t.BACK=2]="BACK"}(Wi||(Wi={})),function(t){t[t.NONE=0]="NONE",t[t.LINE_WIDTH=1]="LINE_WIDTH",t[t.DEPTH_BIAS=2]="DEPTH_BIAS",t[t.BLEND_CONSTANTS=4]="BLEND_CONSTANTS",t[t.DEPTH_BOUNDS=8]="DEPTH_BOUNDS",t[t.STENCIL_WRITE_MASK=16]="STENCIL_WRITE_MASK",t[t.STENCIL_COMPARE_MASK=32]="STENCIL_COMPARE_MASK"}(qi||(qi={})),function(t){t[t.FRONT=1]="FRONT",t[t.BACK=2]="BACK",t[t.ALL=3]="ALL"}(Xi||(Xi={})),function(t){t[t.UNKNOWN=0]="UNKNOWN",t[t.UNIFORM_BUFFER=1]="UNIFORM_BUFFER",t[t.DYNAMIC_UNIFORM_BUFFER=2]="DYNAMIC_UNIFORM_BUFFER",t[t.STORAGE_BUFFER=4]="STORAGE_BUFFER",t[t.DYNAMIC_STORAGE_BUFFER=8]="DYNAMIC_STORAGE_BUFFER",t[t.SAMPLER_TEXTURE=16]="SAMPLER_TEXTURE",t[t.SAMPLER=32]="SAMPLER",t[t.TEXTURE=64]="TEXTURE",t[t.STORAGE_IMAGE=128]="STORAGE_IMAGE",t[t.INPUT_ATTACHMENT=256]="INPUT_ATTACHMENT"}(Yi||(Yi={})),function(t){t[t.GRAPHICS=0]="GRAPHICS",t[t.COMPUTE=1]="COMPUTE",t[t.TRANSFER=2]="TRANSFER"}(Ki||(Ki={})),function(t){t[t.OCCLUSION=0]="OCCLUSION",t[t.PIPELINE_STATISTICS=1]="PIPELINE_STATISTICS",t[t.TIMESTAMP=2]="TIMESTAMP"}(Ji||(Ji={})),function(t){t[t.PRIMARY=0]="PRIMARY",t[t.SECONDARY=1]="SECONDARY"}(Qi||(Qi={})),function(t){t[t.NONE=0]="NONE",t[t.COLOR=1]="COLOR",t[t.DEPTH=2]="DEPTH",t[t.STENCIL=4]="STENCIL",t[t.DEPTH_STENCIL=6]="DEPTH_STENCIL",t[t.ALL=7]="ALL"}(Zi||(Zi={}));var nr,ir=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=n}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t}(),rr=function(){function t(t,e,n,i,r,a,o,s,c,l,h,u,_,f,d,p,m,v,g,y,x,S){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===h&&(h=0),void 0===u&&(u=0),void 0===_&&(_=0),void 0===f&&(f=1),void 0===d&&(d=0),void 0===p&&(p=0),void 0===m&&(m=new ir),void 0===v&&(v=new ir),void 0===g&&(g=!1),void 0===y&&(y=-1),void 0===x&&(x=1),void 0===S&&(S=1),this.maxVertexAttributes=t,this.maxVertexUniformVectors=e,this.maxFragmentUniformVectors=n,this.maxTextureUnits=i,this.maxImageUnits=r,this.maxVertexTextureUnits=a,this.maxColorRenderTargets=o,this.maxShaderStorageBufferBindings=s,this.maxShaderStorageBlockSize=c,this.maxUniformBufferBindings=l,this.maxUniformBlockSize=h,this.maxTextureSize=u,this.maxCubeMapTextureSize=_,this.uboOffsetAlignment=f,this.maxComputeSharedMemorySize=d,this.maxComputeWorkGroupInvocations=p,this.maxComputeWorkGroupSize=m,this.maxComputeWorkGroupCount=v,this.supportQuery=g,this.clipSpaceMinZ=y,this.screenSpaceSignY=x,this.clipSpaceSignY=S}return t.prototype.copy=function(t){return this.maxVertexAttributes=t.maxVertexAttributes,this.maxVertexUniformVectors=t.maxVertexUniformVectors,this.maxFragmentUniformVectors=t.maxFragmentUniformVectors,this.maxTextureUnits=t.maxTextureUnits,this.maxImageUnits=t.maxImageUnits,this.maxVertexTextureUnits=t.maxVertexTextureUnits,this.maxColorRenderTargets=t.maxColorRenderTargets,this.maxShaderStorageBufferBindings=t.maxShaderStorageBufferBindings,this.maxShaderStorageBlockSize=t.maxShaderStorageBlockSize,this.maxUniformBufferBindings=t.maxUniformBufferBindings,this.maxUniformBlockSize=t.maxUniformBlockSize,this.maxTextureSize=t.maxTextureSize,this.maxCubeMapTextureSize=t.maxCubeMapTextureSize,this.uboOffsetAlignment=t.uboOffsetAlignment,this.maxComputeSharedMemorySize=t.maxComputeSharedMemorySize,this.maxComputeWorkGroupInvocations=t.maxComputeWorkGroupInvocations,this.maxComputeWorkGroupSize.copy(t.maxComputeWorkGroupSize),this.maxComputeWorkGroupCount.copy(t.maxComputeWorkGroupCount),this.supportQuery=t.supportQuery,this.clipSpaceMinZ=t.clipSpaceMinZ,this.screenSpaceSignY=t.screenSpaceSignY,this.clipSpaceSignY=t.clipSpaceSignY,this},t}(),ar=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.x=t,this.y=e,this.z=n}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},t}(),or=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=t,this.y=e,this.width=n,this.height=i}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this},t}(),sr=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=1),this.width=t,this.height=e,this.depth=n}return t.prototype.copy=function(t){return this.width=t.width,this.height=t.height,this.depth=t.depth,this},t}(),cr=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=1),this.mipLevel=t,this.baseArrayLayer=e,this.layerCount=n}return t.prototype.copy=function(t){return this.mipLevel=t.mipLevel,this.baseArrayLayer=t.baseArrayLayer,this.layerCount=t.layerCount,this},t}(),lr=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=1),this.baseMipLevel=t,this.levelCount=e,this.baseArrayLayer=n,this.layerCount=i}return t.prototype.copy=function(t){return this.baseMipLevel=t.baseMipLevel,this.levelCount=t.levelCount,this.baseArrayLayer=t.baseArrayLayer,this.layerCount=t.layerCount,this},t}(),hr=function(){function t(t,e,n,i,r){void 0===t&&(t=new cr),void 0===e&&(e=new ar),void 0===n&&(n=new cr),void 0===i&&(i=new ar),void 0===r&&(r=new sr),this.srcSubres=t,this.srcOffset=e,this.dstSubres=n,this.dstOffset=i,this.extent=r}return t.prototype.copy=function(t){return this.srcSubres.copy(t.srcSubres),this.srcOffset.copy(t.srcOffset),this.dstSubres.copy(t.dstSubres),this.dstOffset.copy(t.dstOffset),this.extent.copy(t.extent),this},t}(),ur=function(){function t(t,e,n,i,r,a){void 0===t&&(t=new cr),void 0===e&&(e=new ar),void 0===n&&(n=new sr),void 0===i&&(i=new cr),void 0===r&&(r=new ar),void 0===a&&(a=new sr),this.srcSubres=t,this.srcOffset=e,this.srcExtent=n,this.dstSubres=i,this.dstOffset=r,this.dstExtent=a}return t.prototype.copy=function(t){return this.srcSubres.copy(t.srcSubres),this.srcOffset.copy(t.srcOffset),this.srcExtent.copy(t.srcExtent),this.dstSubres.copy(t.dstSubres),this.dstOffset.copy(t.dstOffset),this.dstExtent.copy(t.dstExtent),this},t}(),_r=function(){function t(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=new ar),void 0===i&&(i=new sr),void 0===r&&(r=new cr),this.buffStride=t,this.buffTexHeight=e,this.texOffset=n,this.texExtent=i,this.texSubres=r}return t.prototype.copy=function(t){return this.buffStride=t.buffStride,this.buffTexHeight=t.buffTexHeight,this.texOffset.copy(t.texOffset),this.texExtent.copy(t.texExtent),this.texSubres.copy(t.texSubres),this},t}(),fr=function(){function t(t,e,n,i,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=1),this.left=t,this.top=e,this.width=n,this.height=i,this.minDepth=r,this.maxDepth=a}return t.prototype.copy=function(t){return this.left=t.left,this.top=t.top,this.width=t.width,this.height=t.height,this.minDepth=t.minDepth,this.maxDepth=t.maxDepth,this},t}(),dr=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=t,this.y=e,this.z=n,this.w=i}return t.prototype.copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this.w=t.w,this},t}(),pr=function(){function t(t,e,n,i,r,a,o,s){void 0===t&&(t=[0]),void 0===e&&(e=[0]),void 0===n&&(n=[0]),void 0===i&&(i=[0]),void 0===r&&(r=[0]),void 0===a&&(a=[0]),void 0===o&&(o=[0]),void 0===s&&(s=[0]),this.maxBlockCounts=t,this.maxSamplerTextureCounts=e,this.maxSamplerCounts=n,this.maxTextureCounts=i,this.maxBufferCounts=r,this.maxImageCounts=a,this.maxSubpassInputCounts=o,this.setIndices=s}return t.prototype.copy=function(t){return this.maxBlockCounts=t.maxBlockCounts.slice(),this.maxSamplerTextureCounts=t.maxSamplerTextureCounts.slice(),this.maxSamplerCounts=t.maxSamplerCounts.slice(),this.maxTextureCounts=t.maxTextureCounts.slice(),this.maxBufferCounts=t.maxBufferCounts.slice(),this.maxImageCounts=t.maxImageCounts.slice(),this.maxSubpassInputCounts=t.maxSubpassInputCounts.slice(),this.setIndices=t.setIndices.slice(),this},t}(),mr=function(){function t(t,e,n,i){void 0===t&&(t=null),void 0===e&&(e=Ii.ON),void 0===n&&(n=0),void 0===i&&(i=0),this.windowHandle=t,this.vsyncMode=e,this.width=n,this.height=i}return t.prototype.copy=function(t){return this.windowHandle=t.windowHandle,this.vsyncMode=t.vsyncMode,this.width=t.width,this.height=t.height,this},t}(),vr=function(){function t(t){void 0===t&&(t=new pr),this.bindingMappingInfo=t}return t.prototype.copy=function(t){return this.bindingMappingInfo.copy(t.bindingMappingInfo),this},t}(),gr=function(){function t(t,e,n,i,r){void 0===t&&(t=yi.NONE),void 0===e&&(e=Ai.NONE),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=xi.NONE),this.usage=t,this.memUsage=e,this.size=n,this.stride=i,this.flags=r}return t.prototype.copy=function(t){return this.usage=t.usage,this.memUsage=t.memUsage,this.size=t.size,this.stride=t.stride,this.flags=t.flags,this},t}(),yr=function(){function t(t,e,n){void 0===t&&(t=null),void 0===e&&(e=0),void 0===n&&(n=0),this.buffer=t,this.offset=e,this.range=n}return t.prototype.copy=function(t){return this.buffer=t.buffer,this.offset=t.offset,this.range=t.range,this},t}(),xr=function(){function t(t,e,n,i,r,a,o){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),this.vertexCount=t,this.firstVertex=e,this.indexCount=n,this.firstIndex=i,this.vertexOffset=r,this.instanceCount=a,this.firstInstance=o}return t.prototype.copy=function(t){return this.vertexCount=t.vertexCount,this.firstVertex=t.firstVertex,this.indexCount=t.indexCount,this.firstIndex=t.firstIndex,this.vertexOffset=t.vertexOffset,this.instanceCount=t.instanceCount,this.firstInstance=t.firstInstance,this},t}(),Sr=function(){function t(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=null),void 0===r&&(r=0),this.groupCountX=t,this.groupCountY=e,this.groupCountZ=n,this.indirectBuffer=i,this.indirectOffset=r}return t.prototype.copy=function(t){return this.groupCountX=t.groupCountX,this.groupCountY=t.groupCountY,this.groupCountZ=t.groupCountZ,this.indirectBuffer=t.indirectBuffer,this.indirectOffset=t.indirectOffset,this},t}(),Ar=function(){function t(t){void 0===t&&(t=[]),this.drawInfos=t}return t.prototype.copy=function(t){return er(this.drawInfos,t.drawInfos,xr),this},t}(),br=function(){function t(t,e,n,i,r,a,o,s,c,l,h){void 0===t&&(t=bi.TEX2D),void 0===e&&(e=Ci.NONE),void 0===n&&(n=mi.UNKNOWN),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=Ti.NONE),void 0===o&&(o=1),void 0===s&&(s=1),void 0===c&&(c=wi.ONE),void 0===l&&(l=1),void 0===h&&(h=0),this.type=t,this.usage=e,this.format=n,this.width=i,this.height=r,this.flags=a,this.layerCount=o,this.levelCount=s,this.samples=c,this.depth=l,this.externalRes=h}return t.prototype.copy=function(t){return this.type=t.type,this.usage=t.usage,this.format=t.format,this.width=t.width,this.height=t.height,this.flags=t.flags,this.layerCount=t.layerCount,this.levelCount=t.levelCount,this.samples=t.samples,this.depth=t.depth,this.externalRes=t.externalRes,this},t}(),Cr=function(){function t(t,e,n,i,r,a,o){void 0===t&&(t=null),void 0===e&&(e=bi.TEX2D),void 0===n&&(n=mi.UNKNOWN),void 0===i&&(i=0),void 0===r&&(r=1),void 0===a&&(a=0),void 0===o&&(o=1),this.texture=t,this.type=e,this.format=n,this.baseLevel=i,this.levelCount=r,this.baseLayer=a,this.layerCount=o}return t.prototype.copy=function(t){return this.texture=t.texture,this.type=t.type,this.format=t.format,this.baseLevel=t.baseLevel,this.levelCount=t.levelCount,this.baseLayer=t.baseLayer,this.layerCount=t.layerCount,this},t}(),Tr=function(){function t(t,e,n,i,r,a,o,s){void 0===t&&(t=Pi.LINEAR),void 0===e&&(e=Pi.LINEAR),void 0===n&&(n=Pi.NONE),void 0===i&&(i=Di.WRAP),void 0===r&&(r=Di.WRAP),void 0===a&&(a=Di.WRAP),void 0===o&&(o=0),void 0===s&&(s=Ri.ALWAYS),this.minFilter=t,this.magFilter=e,this.mipFilter=n,this.addressU=i,this.addressV=r,this.addressW=a,this.maxAnisotropy=o,this.cmpFunc=s}return t.prototype.copy=function(t){return this.minFilter=t.minFilter,this.magFilter=t.magFilter,this.mipFilter=t.mipFilter,this.addressU=t.addressU,this.addressV=t.addressV,this.addressW=t.addressW,this.maxAnisotropy=t.maxAnisotropy,this.cmpFunc=t.cmpFunc,this},t}(),Er=function(){function t(t,e,n){void 0===t&&(t=""),void 0===e&&(e=gi.UNKNOWN),void 0===n&&(n=0),this.name=t,this.type=e,this.count=n}return t.prototype.copy=function(t){return this.name=t.name,this.type=t.type,this.count=t.count,this},t}(),wr=function(){function t(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=[]),void 0===r&&(r=0),this.set=t,this.binding=e,this.name=n,this.members=i,this.count=r}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,er(this.members,t.members,Er),this.count=t.count,this},t}(),Ir=function(){function t(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=gi.UNKNOWN),void 0===r&&(r=0),this.set=t,this.binding=e,this.name=n,this.type=i,this.count=r}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.type=t.type,this.count=t.count,this},t}(),Pr=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=0),this.set=t,this.binding=e,this.name=n,this.count=i}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.count=t.count,this},t}(),Dr=function(){function t(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=gi.UNKNOWN),void 0===r&&(r=0),this.set=t,this.binding=e,this.name=n,this.type=i,this.count=r}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.type=t.type,this.count=t.count,this},t}(),Rr=function(){function t(t,e,n,i,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=gi.UNKNOWN),void 0===r&&(r=0),void 0===a&&(a=Si.READ_WRITE),this.set=t,this.binding=e,this.name=n,this.type=i,this.count=r,this.memoryAccess=a}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.type=t.type,this.count=t.count,this.memoryAccess=t.memoryAccess,this},t}(),Mr=function(){function t(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=0),void 0===r&&(r=Si.READ_WRITE),this.set=t,this.binding=e,this.name=n,this.count=i,this.memoryAccess=r}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.count=t.count,this.memoryAccess=t.memoryAccess,this},t}(),Or=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=""),void 0===i&&(i=0),this.set=t,this.binding=e,this.name=n,this.count=i}return t.prototype.copy=function(t){return this.set=t.set,this.binding=t.binding,this.name=t.name,this.count=t.count,this},t}(),Nr=function(){function t(t,e){void 0===t&&(t=Li.NONE),void 0===e&&(e=""),this.stage=t,this.source=e}return t.prototype.copy=function(t){return this.stage=t.stage,this.source=t.source,this},t}(),Br=function(){function t(t,e,n,i,r,a){void 0===t&&(t=""),void 0===e&&(e=mi.UNKNOWN),void 0===n&&(n=!1),void 0===i&&(i=0),void 0===r&&(r=!1),void 0===a&&(a=0),this.name=t,this.format=e,this.isNormalized=n,this.stream=i,this.isInstanced=r,this.location=a}return t.prototype.copy=function(t){return this.name=t.name,this.format=t.format,this.isNormalized=t.isNormalized,this.stream=t.stream,this.isInstanced=t.isInstanced,this.location=t.location,this},t}(),Lr=function(){function t(t,e,n,i,r,a,o,s,c,l){void 0===t&&(t=""),void 0===e&&(e=[]),void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===r&&(r=[]),void 0===a&&(a=[]),void 0===o&&(o=[]),void 0===s&&(s=[]),void 0===c&&(c=[]),void 0===l&&(l=[]),this.name=t,this.stages=e,this.attributes=n,this.blocks=i,this.buffers=r,this.samplerTextures=a,this.samplers=o,this.textures=s,this.images=c,this.subpassInputs=l}return t.prototype.copy=function(t){return this.name=t.name,er(this.stages,t.stages,Nr),er(this.attributes,t.attributes,Br),er(this.blocks,t.blocks,wr),er(this.buffers,t.buffers,Mr),er(this.samplerTextures,t.samplerTextures,Ir),er(this.samplers,t.samplers,Pr),er(this.textures,t.textures,Dr),er(this.images,t.images,Rr),er(this.subpassInputs,t.subpassInputs,Or),this},t}(),Fr=function(){function t(t,e,n,i){void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===n&&(n=null),void 0===i&&(i=null),this.attributes=t,this.vertexBuffers=e,this.indexBuffer=n,this.indirectBuffer=i}return t.prototype.copy=function(t){return er(this.attributes,t.attributes,Br),this.vertexBuffers=t.vertexBuffers.slice(),this.indexBuffer=t.indexBuffer,this.indirectBuffer=t.indirectBuffer,this},t}(),Vr=function(){function t(t,e,n,i,r,a){void 0===t&&(t=mi.UNKNOWN),void 0===e&&(e=wi.ONE),void 0===n&&(n=Fi.CLEAR),void 0===i&&(i=Vi.STORE),void 0===r&&(r=null),void 0===a&&(a=!1),this.format=t,this.sampleCount=e,this.loadOp=n,this.storeOp=i,this.barrier=r,this.isGeneralLayout=a}return t.prototype.copy=function(t){return this.format=t.format,this.sampleCount=t.sampleCount,this.loadOp=t.loadOp,this.storeOp=t.storeOp,this.barrier=t.barrier,this.isGeneralLayout=t.isGeneralLayout,this},t}(),zr=function(){function t(t,e,n,i,r,a,o,s){void 0===t&&(t=mi.UNKNOWN),void 0===e&&(e=wi.ONE),void 0===n&&(n=Fi.CLEAR),void 0===i&&(i=Vi.STORE),void 0===r&&(r=Fi.CLEAR),void 0===a&&(a=Vi.STORE),void 0===o&&(o=null),void 0===s&&(s=!1),this.format=t,this.sampleCount=e,this.depthLoadOp=n,this.depthStoreOp=i,this.stencilLoadOp=r,this.stencilStoreOp=a,this.barrier=o,this.isGeneralLayout=s}return t.prototype.copy=function(t){return this.format=t.format,this.sampleCount=t.sampleCount,this.depthLoadOp=t.depthLoadOp,this.depthStoreOp=t.depthStoreOp,this.stencilLoadOp=t.stencilLoadOp,this.stencilStoreOp=t.stencilStoreOp,this.barrier=t.barrier,this.isGeneralLayout=t.isGeneralLayout,this},t}(),kr=function(){function t(t,e,n,i,r,a,o,s){void 0===t&&(t=[]),void 0===e&&(e=[]),void 0===n&&(n=[]),void 0===i&&(i=[]),void 0===r&&(r=-1),void 0===a&&(a=-1),void 0===o&&(o=ki.NONE),void 0===s&&(s=ki.NONE),this.inputs=t,this.colors=e,this.resolves=n,this.preserves=i,this.depthStencil=r,this.depthStencilResolve=a,this.depthResolveMode=o,this.stencilResolveMode=s}return t.prototype.copy=function(t){return this.inputs=t.inputs.slice(),this.colors=t.colors.slice(),this.resolves=t.resolves.slice(),this.preserves=t.preserves.slice(),this.depthStencil=t.depthStencil,this.depthStencilResolve=t.depthStencilResolve,this.depthResolveMode=t.depthResolveMode,this.stencilResolveMode=t.stencilResolveMode,this},t}(),Ur=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=null),this.srcSubpass=t,this.dstSubpass=e,this.barrier=n}return t.prototype.copy=function(t){return this.srcSubpass=t.srcSubpass,this.dstSubpass=t.dstSubpass,this.barrier=t.barrier,this},t}(),Gr=function(){function t(t,e,n,i){void 0===t&&(t=[]),void 0===e&&(e=new zr),void 0===n&&(n=[]),void 0===i&&(i=[]),this.colorAttachments=t,this.depthStencilAttachment=e,this.subpasses=n,this.dependencies=i}return t.prototype.copy=function(t){return er(this.colorAttachments,t.colorAttachments,Vr),this.depthStencilAttachment.copy(t.depthStencilAttachment),er(this.subpasses,t.subpasses,kr),er(this.dependencies,t.dependencies,Ur),this},t}(),Hr=function(){function t(t,e){void 0===t&&(t=zi.NONE),void 0===e&&(e=zi.NONE),this.prevAccesses=t,this.nextAccesses=e}return t.prototype.copy=function(t){return this.prevAccesses=t.prevAccesses,this.nextAccesses=t.nextAccesses,this},t}(),jr=function(){function t(t,e,n,i,r){void 0===t&&(t=zi.NONE),void 0===e&&(e=zi.NONE),void 0===n&&(n=!1),void 0===i&&(i=null),void 0===r&&(r=null),this.prevAccesses=t,this.nextAccesses=e,this.discardContents=n,this.srcQueue=i,this.dstQueue=r}return t.prototype.copy=function(t){return this.prevAccesses=t.prevAccesses,this.nextAccesses=t.nextAccesses,this.discardContents=t.discardContents,this.srcQueue=t.srcQueue,this.dstQueue=t.dstQueue,this},t}(),Wr=function(){function t(t,e,n){void 0===t&&(t=null),void 0===e&&(e=[]),void 0===n&&(n=null),this.renderPass=t,this.colorTextures=e,this.depthStencilTexture=n}return t.prototype.copy=function(t){return this.renderPass=t.renderPass,this.colorTextures=t.colorTextures.slice(),this.depthStencilTexture=t.depthStencilTexture,this},t}(),qr=function(){function t(t,e,n,i,r){void 0===t&&(t=-1),void 0===e&&(e=Yi.UNKNOWN),void 0===n&&(n=0),void 0===i&&(i=Li.NONE),void 0===r&&(r=[]),this.binding=t,this.descriptorType=e,this.count=n,this.stageFlags=i,this.immutableSamplers=r}return t.prototype.copy=function(t){return this.binding=t.binding,this.descriptorType=t.descriptorType,this.count=t.count,this.stageFlags=t.stageFlags,this.immutableSamplers=t.immutableSamplers.slice(),this},t}(),Xr=function(){function t(t){void 0===t&&(t=[]),this.bindings=t}return t.prototype.copy=function(t){return er(this.bindings,t.bindings,qr),this},t}(),Yr=function(){function t(t){void 0===t&&(t=null),this.layout=t}return t.prototype.copy=function(t){return this.layout=t.layout,this},t}(),Kr=function(){function t(t){void 0===t&&(t=[]),this.setLayouts=t}return t.prototype.copy=function(t){return this.setLayouts=t.setLayouts.slice(),this},t}(),Jr=function(){function t(t){void 0===t&&(t=[]),this.attributes=t}return t.prototype.copy=function(t){return er(this.attributes,t.attributes,Br),this},t}(),Qr=function(){function t(t,e){void 0===t&&(t=null),void 0===e&&(e=Qi.PRIMARY),this.queue=t,this.type=e}return t.prototype.copy=function(t){return this.queue=t.queue,this.type=t.type,this},t}(),Zr=function(){function t(t){void 0===t&&(t=Ki.GRAPHICS),this.type=t}return t.prototype.copy=function(t){return this.type=t.type,this},t}(),$r=function(){function t(t,e,n){void 0===t&&(t=Ji.OCCLUSION),void 0===e&&(e=32767),void 0===n&&(n=!0),this.type=t,this.maxQueryObjects=e,this.forceWait=n}return t.prototype.copy=function(t){return this.type=t.type,this.maxQueryObjects=t.maxQueryObjects,this.forceWait=t.forceWait,this},t}(),ta=function(t,e,n,i,r,a,o,s){void 0===t&&(t=""),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=vi.NONE),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===o&&(o=!1),void 0===s&&(s=!1),this.name=t,this.size=e,this.count=n,this.type=i,this.hasAlpha=r,this.hasDepth=a,this.hasStencil=o,this.isCompressed=s},ea=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.bufferSize=t,this.textureSize=e}return t.prototype.copy=function(t){return this.bufferSize=t.bufferSize,this.textureSize=t.textureSize,this},t}(),na=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.writeMask=t,this.compareMask=e,this.reference=n}return t.prototype.copy=function(t){return this.writeMask=t.writeMask,this.compareMask=t.compareMask,this.reference=t.reference,this},t}(),ia=function(){function t(t,e,n,i,r,a,o,s,c,l,h){void 0===t&&(t=new fr),void 0===e&&(e=new or),void 0===n&&(n=new dr),void 0===i&&(i=1),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=new na),void 0===h&&(h=new na),this.viewport=t,this.scissor=e,this.blendConstant=n,this.lineWidth=i,this.depthBiasConstant=r,this.depthBiasClamp=a,this.depthBiasSlope=o,this.depthMinBounds=s,this.depthMaxBounds=c,this.stencilStatesFront=l,this.stencilStatesBack=h}return t.prototype.copy=function(t){return this.viewport.copy(t.viewport),this.scissor.copy(t.scissor),this.blendConstant.copy(t.blendConstant),this.lineWidth=t.lineWidth,this.depthBiasConstant=t.depthBiasConstant,this.depthBiasClamp=t.depthBiasClamp,this.depthBiasSlope=t.depthBiasSlope,this.depthMinBounds=t.depthMinBounds,this.depthMaxBounds=t.depthMaxBounds,this.stencilStatesFront.copy(t.stencilStatesFront),this.stencilStatesBack.copy(t.stencilStatesBack),this},t}(),ra=function(t){function e(n){var i;return(i=t.call(this)||this)._objectType=ui.UNKNOWN,i._objectID=0,i._typedID=0,i._objectType=n,i._objectID=e._idTable[ui.UNKNOWN]++,i._typedID=e._idTable[n]++,i}return $(e,t),Q(e,[{key:"objectType",get:function(){return this._objectType}},{key:"objectID",get:function(){return this._objectID}},{key:"typedID",get:function(){return this._typedID}}]),e}(tr);ra._idTable=Array(ui.COUNT).fill(65536),function(t){t.ATTR_POSITION="a_position",t.ATTR_NORMAL="a_normal",t.ATTR_TANGENT="a_tangent",t.ATTR_BITANGENT="a_bitangent",t.ATTR_WEIGHTS="a_weights",t.ATTR_JOINTS="a_joints",t.ATTR_COLOR="a_color",t.ATTR_COLOR1="a_color1",t.ATTR_COLOR2="a_color2",t.ATTR_TEX_COORD="a_texCoord",t.ATTR_TEX_COORD1="a_texCoord1",t.ATTR_TEX_COORD2="a_texCoord2",t.ATTR_TEX_COORD3="a_texCoord3",t.ATTR_TEX_COORD4="a_texCoord4",t.ATTR_TEX_COORD5="a_texCoord5",t.ATTR_TEX_COORD6="a_texCoord6",t.ATTR_TEX_COORD7="a_texCoord7",t.ATTR_TEX_COORD8="a_texCoord8",t.ATTR_BATCH_ID="a_batch_id",t.ATTR_BATCH_UV="a_batch_uv"}(nr||(nr={}));var aa=Object.freeze([new ta("UNKNOWN",0,0,vi.NONE,!1,!1,!1,!1),new ta("A8",1,1,vi.UNORM,!0,!1,!1,!1),new ta("L8",1,1,vi.UNORM,!1,!1,!1,!1),new ta("LA8",1,2,vi.UNORM,!0,!1,!1,!1),new ta("R8",1,1,vi.UNORM,!1,!1,!1,!1),new ta("R8SN",1,1,vi.SNORM,!1,!1,!1,!1),new ta("R8UI",1,1,vi.UINT,!1,!1,!1,!1),new ta("R8I",1,1,vi.INT,!1,!1,!1,!1),new ta("R16F",2,1,vi.FLOAT,!1,!1,!1,!1),new ta("R16UI",2,1,vi.UINT,!1,!1,!1,!1),new ta("R16I",2,1,vi.INT,!1,!1,!1,!1),new ta("R32F",4,1,vi.FLOAT,!1,!1,!1,!1),new ta("R32UI",4,1,vi.UINT,!1,!1,!1,!1),new ta("R32I",4,1,vi.INT,!1,!1,!1,!1),new ta("RG8",2,2,vi.UNORM,!1,!1,!1,!1),new ta("RG8SN",2,2,vi.SNORM,!1,!1,!1,!1),new ta("RG8UI",2,2,vi.UINT,!1,!1,!1,!1),new ta("RG8I",2,2,vi.INT,!1,!1,!1,!1),new ta("RG16F",4,2,vi.FLOAT,!1,!1,!1,!1),new ta("RG16UI",4,2,vi.UINT,!1,!1,!1,!1),new ta("RG16I",4,2,vi.INT,!1,!1,!1,!1),new ta("RG32F",8,2,vi.FLOAT,!1,!1,!1,!1),new ta("RG32UI",8,2,vi.UINT,!1,!1,!1,!1),new ta("RG32I",8,2,vi.INT,!1,!1,!1,!1),new ta("RGB8",3,3,vi.UNORM,!1,!1,!1,!1),new ta("SRGB8",3,3,vi.UNORM,!1,!1,!1,!1),new ta("RGB8SN",3,3,vi.SNORM,!1,!1,!1,!1),new ta("RGB8UI",3,3,vi.UINT,!1,!1,!1,!1),new ta("RGB8I",3,3,vi.INT,!1,!1,!1,!1),new ta("RGB16F",6,3,vi.FLOAT,!1,!1,!1,!1),new ta("RGB16UI",6,3,vi.UINT,!1,!1,!1,!1),new ta("RGB16I",6,3,vi.INT,!1,!1,!1,!1),new ta("RGB32F",12,3,vi.FLOAT,!1,!1,!1,!1),new ta("RGB32UI",12,3,vi.UINT,!1,!1,!1,!1),new ta("RGB32I",12,3,vi.INT,!1,!1,!1,!1),new ta("RGBA8",4,4,vi.UNORM,!0,!1,!1,!1),new ta("BGRA8",4,4,vi.UNORM,!0,!1,!1,!1),new ta("SRGB8_A8",4,4,vi.UNORM,!0,!1,!1,!1),new ta("RGBA8SN",4,4,vi.SNORM,!0,!1,!1,!1),new ta("RGBA8UI",4,4,vi.UINT,!0,!1,!1,!1),new ta("RGBA8I",4,4,vi.INT,!0,!1,!1,!1),new ta("RGBA16F",8,4,vi.FLOAT,!0,!1,!1,!1),new ta("RGBA16UI",8,4,vi.UINT,!0,!1,!1,!1),new ta("RGBA16I",8,4,vi.INT,!0,!1,!1,!1),new ta("RGBA32F",16,4,vi.FLOAT,!0,!1,!1,!1),new ta("RGBA32UI",16,4,vi.UINT,!0,!1,!1,!1),new ta("RGBA32I",16,4,vi.INT,!0,!1,!1,!1),new ta("R5G6B5",2,3,vi.UNORM,!1,!1,!1,!1),new ta("R11G11B10F",4,3,vi.FLOAT,!1,!1,!1,!1),new ta("RGB5A1",2,4,vi.UNORM,!0,!1,!1,!1),new ta("RGBA4",2,4,vi.UNORM,!0,!1,!1,!1),new ta("RGB10A2",2,4,vi.UNORM,!0,!1,!1,!1),new ta("RGB10A2UI",2,4,vi.UINT,!0,!1,!1,!1),new ta("RGB9E5",2,4,vi.FLOAT,!0,!1,!1,!1),new ta("DEPTH",4,1,vi.FLOAT,!1,!0,!1,!1),new ta("DEPTH_STENCIL",5,2,vi.FLOAT,!1,!0,!0,!1),new ta("BC1",1,3,vi.UNORM,!1,!1,!1,!0),new ta("BC1_ALPHA",1,4,vi.UNORM,!0,!1,!1,!0),new ta("BC1_SRGB",1,3,vi.UNORM,!1,!1,!1,!0),new ta("BC1_SRGB_ALPHA",1,4,vi.UNORM,!0,!1,!1,!0),new ta("BC2",1,4,vi.UNORM,!0,!1,!1,!0),new ta("BC2_SRGB",1,4,vi.UNORM,!0,!1,!1,!0),new ta("BC3",1,4,vi.UNORM,!0,!1,!1,!0),new ta("BC3_SRGB",1,4,vi.UNORM,!0,!1,!1,!0),new ta("BC4",1,1,vi.UNORM,!1,!1,!1,!0),new ta("BC4_SNORM",1,1,vi.SNORM,!1,!1,!1,!0),new ta("BC5",1,2,vi.UNORM,!1,!1,!1,!0),new ta("BC5_SNORM",1,2,vi.SNORM,!1,!1,!1,!0),new ta("BC6H_UF16",1,3,vi.UFLOAT,!1,!1,!1,!0),new ta("BC6H_SF16",1,3,vi.FLOAT,!1,!1,!1,!0),new ta("BC7",1,4,vi.UNORM,!0,!1,!1,!0),new ta("BC7_SRGB",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ETC_RGB8",1,3,vi.UNORM,!1,!1,!1,!0),new ta("ETC2_RGB8",1,3,vi.UNORM,!1,!1,!1,!0),new ta("ETC2_SRGB8",1,3,vi.UNORM,!1,!1,!1,!0),new ta("ETC2_RGB8_A1",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ETC2_SRGB8_A1",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ETC2_RGBA8",2,4,vi.UNORM,!0,!1,!1,!0),new ta("ETC2_SRGB8_A8",2,4,vi.UNORM,!0,!1,!1,!0),new ta("EAC_R11",1,1,vi.UNORM,!1,!1,!1,!0),new ta("EAC_R11SN",1,1,vi.SNORM,!1,!1,!1,!0),new ta("EAC_RG11",2,2,vi.UNORM,!1,!1,!1,!0),new ta("EAC_RG11SN",2,2,vi.SNORM,!1,!1,!1,!0),new ta("PVRTC_RGB2",2,3,vi.UNORM,!1,!1,!1,!0),new ta("PVRTC_RGBA2",2,4,vi.UNORM,!0,!1,!1,!0),new ta("PVRTC_RGB4",2,3,vi.UNORM,!1,!1,!1,!0),new ta("PVRTC_RGBA4",2,4,vi.UNORM,!0,!1,!1,!0),new ta("PVRTC2_2BPP",2,4,vi.UNORM,!0,!1,!1,!0),new ta("PVRTC2_4BPP",2,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_RGBA_4x4",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_RGBA_5x4",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_RGBA_5x5",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_RGBA_6x5",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_RGBA_6x6",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_RGBA_8x5",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_RGBA_8x6",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_RGBA_8x8",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_RGBA_10x5",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_RGBA_10x6",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_RGBA_10x8",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_RGBA_10x10",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_RGBA_12x10",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_RGBA_12x12",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_SRGBA_4x4",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_SRGBA_5x4",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_SRGBA_5x5",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_SRGBA_6x5",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_SRGBA_6x6",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_SRGBA_8x5",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_SRGBA_8x6",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_SRGBA_8x8",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_SRGBA_10x5",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_SRGBA_10x6",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_SRGBA_10x8",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_SRGBA_10x10",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_SRGBA_12x10",1,4,vi.UNORM,!0,!1,!1,!0),new ta("ASTC_SRGBA_12x12",1,4,vi.UNORM,!0,!1,!1,!0)]),oa=Yi.UNIFORM_BUFFER|Yi.DYNAMIC_UNIFORM_BUFFER|Yi.STORAGE_BUFFER|Yi.DYNAMIC_STORAGE_BUFFER,sa=Yi.SAMPLER_TEXTURE|Yi.SAMPLER|Yi.TEXTURE|Yi.STORAGE_IMAGE|Yi.INPUT_ATTACHMENT,ca=Yi.DYNAMIC_STORAGE_BUFFER|Yi.DYNAMIC_UNIFORM_BUFFER;function la(t){return t>0&&0==(t&t-1)}function ha(t,e,n,i){if(!aa[t].isCompressed)return e*n*i*aa[t].size;switch(t){case mi.BC1:case mi.BC1_ALPHA:case mi.BC1_SRGB:case mi.BC1_SRGB_ALPHA:return Math.ceil(e/4)*Math.ceil(n/4)*8*i;case mi.BC2:case mi.BC2_SRGB:case mi.BC3:case mi.BC3_SRGB:case mi.BC4:case mi.BC4_SNORM:case mi.BC6H_SF16:case mi.BC6H_UF16:case mi.BC7:case mi.BC7_SRGB:return Math.ceil(e/4)*Math.ceil(n/4)*16*i;case mi.BC5:case mi.BC5_SNORM:return Math.ceil(e/4)*Math.ceil(n/4)*32*i;case mi.ETC_RGB8:case mi.ETC2_RGB8:case mi.ETC2_SRGB8:case mi.ETC2_RGB8_A1:case mi.EAC_R11:case mi.EAC_R11SN:return Math.ceil(e/4)*Math.ceil(n/4)*8*i;case mi.ETC2_RGBA8:case mi.ETC2_SRGB8_A1:case mi.EAC_RG11:case mi.EAC_RG11SN:return Math.ceil(e/4)*Math.ceil(n/4)*16*i;case mi.PVRTC_RGB2:case mi.PVRTC_RGBA2:case mi.PVRTC2_2BPP:return Math.ceil(Math.max(e,16)*Math.max(n,8)/4)*i;case mi.PVRTC_RGB4:case mi.PVRTC_RGBA4:case mi.PVRTC2_4BPP:return Math.ceil(Math.max(e,8)*Math.max(n,8)/2)*i;case mi.ASTC_RGBA_4X4:case mi.ASTC_SRGBA_4X4:return Math.ceil(e/4)*Math.ceil(n/4)*16*i;case mi.ASTC_RGBA_5X4:case mi.ASTC_SRGBA_5X4:return Math.ceil(e/5)*Math.ceil(n/4)*16*i;case mi.ASTC_RGBA_5X5:case mi.ASTC_SRGBA_5X5:return Math.ceil(e/5)*Math.ceil(n/5)*16*i;case mi.ASTC_RGBA_6X5:case mi.ASTC_SRGBA_6X5:return Math.ceil(e/6)*Math.ceil(n/5)*16*i;case mi.ASTC_RGBA_6X6:case mi.ASTC_SRGBA_6X6:return Math.ceil(e/6)*Math.ceil(n/6)*16*i;case mi.ASTC_RGBA_8X5:case mi.ASTC_SRGBA_8X5:return Math.ceil(e/8)*Math.ceil(n/5)*16*i;case mi.ASTC_RGBA_8X6:case mi.ASTC_SRGBA_8X6:return Math.ceil(e/8)*Math.ceil(n/6)*16*i;case mi.ASTC_RGBA_8X8:case mi.ASTC_SRGBA_8X8:return Math.ceil(e/8)*Math.ceil(n/8)*16*i;case mi.ASTC_RGBA_10X5:case mi.ASTC_SRGBA_10X5:return Math.ceil(e/10)*Math.ceil(n/5)*16*i;case mi.ASTC_RGBA_10X6:case mi.ASTC_SRGBA_10X6:return Math.ceil(e/10)*Math.ceil(n/6)*16*i;case mi.ASTC_RGBA_10X8:case mi.ASTC_SRGBA_10X8:return Math.ceil(e/10)*Math.ceil(n/8)*16*i;case mi.ASTC_RGBA_10X10:case mi.ASTC_SRGBA_10X10:return Math.ceil(e/10)*Math.ceil(n/10)*16*i;case mi.ASTC_RGBA_12X10:case mi.ASTC_SRGBA_12X10:return Math.ceil(e/12)*Math.ceil(n/10)*16*i;case mi.ASTC_RGBA_12X12:case mi.ASTC_SRGBA_12X12:return Math.ceil(e/12)*Math.ceil(n/12)*16*i;default:return 0}}function ua(t,e,n,i,r){for(var a=0,o=0;o<r;++o)a+=ha(t,e,n,i),e=Math.max(e>>1,1),n=Math.max(n>>1,1);return a}var _a=[0,4,8,12,16,4,8,12,16,4,8,12,16,4,8,12,16,16,24,32,24,36,48,32,48,64,4,4,4,4,4,4];function fa(t){return _a[t]||0}function da(t){var e=t.size/t.count;switch(t.type){case vi.UNORM:case vi.UINT:switch(e){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array}break;case vi.SNORM:case vi.INT:switch(e){case 1:return Int8Array;case 2:return Int16Array;case 4:return Int32Array}break;case vi.FLOAT:return Float32Array}return Float32Array}var pa=Object.freeze({__proto__:null,get ObjectType(){return ui},get Status(){return _i},get API(){return fi},get SurfaceTransform(){return di},get Feature(){return pi},get Format(){return mi},get FormatType(){return vi},get Type(){return gi},get BufferUsageBit(){return yi},get BufferFlagBit(){return xi},get MemoryAccessBit(){return Si},get MemoryUsageBit(){return Ai},get TextureType(){return bi},get TextureUsageBit(){return Ci},get TextureFlagBit(){return Ti},get FormatFeatureBit(){return Ei},get SampleCount(){return wi},get VsyncMode(){return Ii},get Filter(){return Pi},get Address(){return Di},get ComparisonFunc(){return Ri},get StencilOp(){return Mi},get BlendFactor(){return Oi},get BlendOp(){return Ni},get ColorMask(){return Bi},get ShaderStageFlagBit(){return Li},get LoadOp(){return Fi},get StoreOp(){return Vi},get AccessFlagBit(){return zi},get ResolveMode(){return ki},get PipelineBindPoint(){return Ui},get PrimitiveMode(){return Gi},get PolygonMode(){return Hi},get ShadeModel(){return ji},get CullMode(){return Wi},get DynamicStateFlagBit(){return qi},get StencilFace(){return Xi},get DescriptorType(){return Yi},get QueueType(){return Ki},get QueryType(){return Ji},get CommandBufferType(){return Qi},get ClearFlagBit(){return Zi},Size:ir,DeviceCaps:rr,Offset:ar,Rect:or,Extent:sr,TextureSubresLayers:cr,TextureSubresRange:lr,TextureCopy:hr,TextureBlit:ur,BufferTextureCopy:_r,Viewport:fr,Color:dr,BindingMappingInfo:pr,SwapchainInfo:mr,DeviceInfo:vr,BufferInfo:gr,BufferViewInfo:yr,DrawInfo:xr,DispatchInfo:Sr,IndirectBuffer:Ar,TextureInfo:br,TextureViewInfo:Cr,SamplerInfo:Tr,Uniform:Er,UniformBlock:wr,UniformSamplerTexture:Ir,UniformSampler:Pr,UniformTexture:Dr,UniformStorageImage:Rr,UniformStorageBuffer:Mr,UniformInputAttachment:Or,ShaderStage:Nr,Attribute:Br,ShaderInfo:Lr,InputAssemblerInfo:Fr,ColorAttachment:Vr,DepthStencilAttachment:zr,SubpassInfo:kr,SubpassDependency:Ur,RenderPassInfo:Gr,GeneralBarrierInfo:Hr,TextureBarrierInfo:jr,FramebufferInfo:Wr,DescriptorSetLayoutBinding:qr,DescriptorSetLayoutInfo:Xr,DescriptorSetInfo:Yr,PipelineLayoutInfo:Kr,InputState:Jr,CommandBufferInfo:Qr,QueueInfo:Zr,QueryPoolInfo:$r,FormatInfo:ta,MemoryStatus:ea,DynamicStencilStates:na,DynamicStates:ia,GFXObject:ra,get AttributeName(){return nr},FormatInfos:aa,DESCRIPTOR_BUFFER_TYPE:oa,DESCRIPTOR_SAMPLER_TYPE:sa,DESCRIPTOR_DYNAMIC_TYPE:ca,DRAW_INFO_SIZE:28,IsPowerOf2:la,FormatSize:ha,FormatSurfaceSize:ua,GetTypeSize:fa,getTypedArrayConstructor:da}),ma=function(t){function e(){var e;return(e=t.call(this,ui.BUFFER)||this)._usage=yi.NONE,e._memUsage=Ai.NONE,e._size=0,e._stride=1,e._count=0,e._flags=xi.NONE,e._isBufferView=!1,e}return $(e,t),Q(e,[{key:"usage",get:function(){return this._usage}},{key:"memUsage",get:function(){return this._memUsage}},{key:"size",get:function(){return this._size}},{key:"stride",get:function(){return this._stride}},{key:"count",get:function(){return this._count}},{key:"flags",get:function(){return this._flags}}]),e}(ra),va=function(t){function e(){var e;return(e=t.call(this,ui.COMMAND_BUFFER)||this)._queue=null,e._type=Qi.PRIMARY,e._numDrawCalls=0,e._numInstances=0,e._numTris=0,e}return $(e,t),Q(e,[{key:"type",get:function(){return this._type}},{key:"queue",get:function(){return this._queue}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}}]),e}(ra),ga=function(){function t(){this._gfxAPI=fi.UNKNOWN,this._renderer="",this._vendor="",this._features=new Array(pi.COUNT),this._formatFeatures=new Array(mi.COUNT),this._queue=null,this._cmdBuff=null,this._numDrawCalls=0,this._numInstances=0,this._numTris=0,this._memoryStatus=new ea,this._caps=new rr,this._bindingMappingInfo=new pr,this._samplers=new Map,this._generalBarrierss=new Map,this._textureBarriers=new Map}var e=t.prototype;return e.hasFeature=function(t){return this._features[t]},e.getFormatFeatures=function(t){return this._formatFeatures[t]},Q(t,[{key:"gfxAPI",get:function(){return this._gfxAPI}},{key:"queue",get:function(){return this._queue}},{key:"commandBuffer",get:function(){return this._cmdBuff}},{key:"renderer",get:function(){return this._renderer}},{key:"vendor",get:function(){return this._vendor}},{key:"numDrawCalls",get:function(){return this._numDrawCalls}},{key:"numInstances",get:function(){return this._numInstances}},{key:"numTris",get:function(){return this._numTris}},{key:"memoryStatus",get:function(){return this._memoryStatus}},{key:"capabilities",get:function(){return this._caps}},{key:"bindingMappingInfo",get:function(){return this._bindingMappingInfo}}]),t}();ga.canvas=void 0;var ya=function(t){function e(){var e;return(e=t.call(this,ui.SWAPCHAIN)||this)._transform=di.IDENTITY,e._colorTexture=null,e._depthStencilTexture=null,e}return $(e,t),Q(e,[{key:"colorTexture",get:function(){return this._colorTexture}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}},{key:"surfaceTransform",get:function(){return this._transform}},{key:"width",get:function(){return this._colorTexture.width}},{key:"height",get:function(){return this._colorTexture.height}}]),e}(ra),xa=function(t){function e(){var e;return(e=t.call(this,ui.FRAMEBUFFER)||this)._renderPass=null,e._colorTextures=[],e._depthStencilTexture=null,e}return $(e,t),Q(e,[{key:"renderPass",get:function(){return this._renderPass}},{key:"colorTextures",get:function(){return this._colorTextures}},{key:"depthStencilTexture",get:function(){return this._depthStencilTexture}}]),e}(ra),Sa=String.prototype.charCodeAt;function Aa(t){return this[t]}function ba(t,e){for(var n=t.length,i=e^n,r=0,a="string"==typeof t?Sa:Aa;n>=4;){var o=255&a.call(t,r)|(255&a.call(t,++r))<<8|(255&a.call(t,++r))<<16|(255&a.call(t,++r))<<24;o=1540483477*(65535&o)+((1540483477*(o>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(o=1540483477*(65535&(o^=o>>>24))+((1540483477*(o>>>16)&65535)<<16)),n-=4,++r}switch(n){case 3:i^=(255&a.call(t,r+2))<<16;case 2:i^=(255&a.call(t,r+1))<<8;case 1:i=1540483477*(65535&(i^=255&a.call(t,r)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}var Ca=function(t){function e(){var e;return(e=t.call(this,ui.INPUT_ASSEMBLER)||this)._attributes=[],e._attributesHash=0,e._vertexBuffers=[],e._indexBuffer=null,e._indirectBuffer=null,e._drawInfo=new xr,e}$(e,t);var n=e.prototype;return n.getVertexBuffer=function(t){return void 0===t&&(t=0),t<this._vertexBuffers.length?this._vertexBuffers[t]:null},n.computeAttributesHash=function(){for(var t="attrs",e=0;e<this.attributes.length;++e){var n=this.attributes[e];t+=","+n.name+","+n.format+","+n.isNormalized+","+n.stream+","+n.isInstanced}return ba(t,666)},Q(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}},{key:"attributesHash",get:function(){return this._attributesHash}},{key:"vertexCount",get:function(){return this._drawInfo.vertexCount},set:function(t){this._drawInfo.vertexCount=t}},{key:"firstVertex",get:function(){return this._drawInfo.firstVertex},set:function(t){this._drawInfo.firstVertex=t}},{key:"indexCount",get:function(){return this._drawInfo.indexCount},set:function(t){this._drawInfo.indexCount=t}},{key:"firstIndex",get:function(){return this._drawInfo.firstIndex},set:function(t){this._drawInfo.firstIndex=t}},{key:"vertexOffset",get:function(){return this._drawInfo.vertexOffset},set:function(t){this._drawInfo.vertexOffset=t}},{key:"instanceCount",get:function(){return this._drawInfo.instanceCount},set:function(t){this._drawInfo.instanceCount=t}},{key:"firstInstance",get:function(){return this._drawInfo.firstInstance},set:function(t){this._drawInfo.firstInstance=t}},{key:"drawInfo",get:function(){return this._drawInfo}}]),e}(ra),Ta=function(t){function e(){var e;return(e=t.call(this,ui.DESCRIPTOR_SET)||this)._layout=null,e._buffers=[],e._textures=[],e._samplers=[],e._isDirty=!1,e}$(e,t);var n=e.prototype;return n.bindBuffer=function(t,e,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[t],r=this._layout.bindings[i];if(r&&r.descriptorType&oa){var a=this._layout.descriptorIndices[t];this._buffers[a+n]!==e&&(this._buffers[a+n]=e,this._isDirty=!0)}},n.bindSampler=function(t,e,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[t],r=this._layout.bindings[i];if(r&&r.descriptorType&sa){var a=this._layout.descriptorIndices[t];this._samplers[a+n]!==e&&(this._samplers[a+n]=e,this._isDirty=!0)}},n.bindTexture=function(t,e,n){void 0===n&&(n=0);var i=this._layout.bindingIndices[t],r=this._layout.bindings[i];if(r&&r.descriptorType&sa){var a=this._layout.descriptorIndices[t];this._textures[a+n]!==e&&(this._textures[a+n]=e,this._isDirty=!0)}},n.getBuffer=function(t,e){void 0===e&&(e=0);var n=this._layout.descriptorIndices[t];return this._buffers[n+e]},n.getSampler=function(t,e){void 0===e&&(e=0);var n=this._layout.descriptorIndices[t];return this._samplers[n+e]},n.getTexture=function(t,e){void 0===e&&(e=0);var n=this._layout.descriptorIndices[t];return this._textures[n+e]},Q(e,[{key:"layout",get:function(){return this._layout}}]),e}(ra),Ea=function(t){function e(){var e;return(e=t.call(this,ui.DESCRIPTOR_SET_LAYOUT)||this)._bindings=[],e._bindingIndices=[],e._descriptorIndices=[],e}return $(e,t),Q(e,[{key:"bindings",get:function(){return this._bindings}},{key:"bindingIndices",get:function(){return this._bindingIndices}},{key:"descriptorIndices",get:function(){return this._descriptorIndices}}]),e}(ra),wa=function(t){function e(){var e;return(e=t.call(this,ui.PIPELINE_LAYOUT)||this)._setLayouts=[],e}return $(e,t),Q(e,[{key:"setLayouts",get:function(){return this._setLayouts}}]),e}(ra),Ia=function(){function t(t,e,n,i,r,a,o,s,c,l,h,u){void 0===t&&(t=!1),void 0===e&&(e=Hi.FILL),void 0===n&&(n=ji.GOURAND),void 0===i&&(i=Wi.BACK),void 0===r&&(r=!0),void 0===a&&(a=!1),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=!0),void 0===h&&(h=!1),void 0===u&&(u=1),this.isDiscard=t,this.polygonMode=e,this.shadeModel=n,this.cullMode=i,this.isFrontFaceCCW=r,this.depthBiasEnabled=a,this.depthBias=o,this.depthBiasClamp=s,this.depthBiasSlop=c,this.isDepthClip=l,this.isMultisample=h,this.lineWidth=u}var e=t.prototype;return e.reset=function(){this.isDiscard=!1,this.polygonMode=Hi.FILL,this.shadeModel=ji.GOURAND,this.cullMode=Wi.BACK,this.isFrontFaceCCW=!0,this.depthBiasEnabled=!1,this.depthBias=0,this.depthBiasClamp=0,this.depthBiasSlop=0,this.isDepthClip=!0,this.isMultisample=!1,this.lineWidth=1},e.assign=function(t){Object.assign(this,t)},e.destroy=function(){},Q(t,[{key:"native",get:function(){return this}}]),t}(),Pa=function(){function t(t,e,n,i,r,a,o,s,c,l,h,u,_,f,d,p,m,v,g){void 0===t&&(t=!0),void 0===e&&(e=!0),void 0===n&&(n=Ri.LESS),void 0===i&&(i=!1),void 0===r&&(r=Ri.ALWAYS),void 0===a&&(a=65535),void 0===o&&(o=65535),void 0===s&&(s=Mi.KEEP),void 0===c&&(c=Mi.KEEP),void 0===l&&(l=Mi.KEEP),void 0===h&&(h=1),void 0===u&&(u=!1),void 0===_&&(_=Ri.ALWAYS),void 0===f&&(f=65535),void 0===d&&(d=65535),void 0===p&&(p=Mi.KEEP),void 0===m&&(m=Mi.KEEP),void 0===v&&(v=Mi.KEEP),void 0===g&&(g=1),this.depthTest=t,this.depthWrite=e,this.depthFunc=n,this.stencilTestFront=i,this.stencilFuncFront=r,this.stencilReadMaskFront=a,this.stencilWriteMaskFront=o,this.stencilFailOpFront=s,this.stencilZFailOpFront=c,this.stencilPassOpFront=l,this.stencilRefFront=h,this.stencilTestBack=u,this.stencilFuncBack=_,this.stencilReadMaskBack=f,this.stencilWriteMaskBack=d,this.stencilFailOpBack=p,this.stencilZFailOpBack=m,this.stencilPassOpBack=v,this.stencilRefBack=g}var e=t.prototype;return e.reset=function(){this.depthTest=!0,this.depthWrite=!0,this.depthFunc=Ri.LESS,this.stencilTestFront=!1,this.stencilFuncFront=Ri.ALWAYS,this.stencilReadMaskFront=65535,this.stencilWriteMaskFront=65535,this.stencilFailOpFront=Mi.KEEP,this.stencilZFailOpFront=Mi.KEEP,this.stencilPassOpFront=Mi.KEEP,this.stencilRefFront=1,this.stencilTestBack=!1,this.stencilFuncBack=Ri.ALWAYS,this.stencilReadMaskBack=65535,this.stencilWriteMaskBack=65535,this.stencilFailOpBack=Mi.KEEP,this.stencilZFailOpBack=Mi.KEEP,this.stencilPassOpBack=Mi.KEEP,this.stencilRefBack=1},e.assign=function(t){Object.assign(this,t)},e.destroy=function(){},Q(t,[{key:"native",get:function(){return this}}]),t}(),Da=function(){function t(t,e,n,i,r,a,o,s){void 0===t&&(t=!1),void 0===e&&(e=Oi.ONE),void 0===n&&(n=Oi.ZERO),void 0===i&&(i=Ni.ADD),void 0===r&&(r=Oi.ONE),void 0===a&&(a=Oi.ZERO),void 0===o&&(o=Ni.ADD),void 0===s&&(s=Bi.ALL),this.blend=t,this.blendSrc=e,this.blendDst=n,this.blendEq=i,this.blendSrcAlpha=r,this.blendDstAlpha=a,this.blendAlphaEq=o,this.blendColorMask=s}var e=t.prototype;return e.reset=function(){this.blend=!1,this.blendSrc=Oi.ONE,this.blendDst=Oi.ZERO,this.blendEq=Ni.ADD,this.blendSrcAlpha=Oi.ONE,this.blendDstAlpha=Oi.ZERO,this.blendAlphaEq=Ni.ADD,this.blendColorMask=Bi.ALL},e.assign=function(t){Object.assign(this,t)},e.destroy=function(){},t}(),Ra=function(){function t(t,e,n,i){void 0===t&&(t=!1),void 0===e&&(e=!1),void 0===n&&(n=new dr),void 0===i&&(i=[new Da]),this.isA2C=t,this.isIndepend=e,this.blendColor=n,this.targets=i}var e=t.prototype;return e.setTarget=function(t,e){var n=this.targets[t];n||(n=this.targets[t]=new Da),Object.assign(n,e)},e.reset=function(){this.isA2C=!1,this.isIndepend=!1,this.blendColor.x=0,this.blendColor.y=0,this.blendColor.z=0,this.blendColor.w=0,this.targets.length=1,this.targets[0].reset()},e.destroy=function(){},Q(t,[{key:"native",get:function(){return this}}]),t}(),Ma=function(t,e,n,i,r,a,o,s,c,l){void 0===t&&(t=null),void 0===e&&(e=null),void 0===n&&(n=null),void 0===i&&(i=new Jr),void 0===r&&(r=new Ia),void 0===a&&(a=new Pa),void 0===o&&(o=new Ra),void 0===s&&(s=Gi.TRIANGLE_LIST),void 0===c&&(c=qi.NONE),void 0===l&&(l=Ui.GRAPHICS),this.shader=t,this.pipelineLayout=e,this.renderPass=n,this.inputState=i,this.rasterizerState=r,this.depthStencilState=a,this.blendState=o,this.primitive=s,this.dynamicStates=c,this.bindPoint=l},Oa=function(t){function e(){var e;return(e=t.call(this,ui.PIPELINE_STATE)||this)._shader=null,e._pipelineLayout=null,e._primitive=Gi.TRIANGLE_LIST,e._is=null,e._rs=new Ia,e._dss=new Pa,e._bs=new Ra,e._dynamicStates=qi.NONE,e._renderPass=null,e}return $(e,t),Q(e,[{key:"shader",get:function(){return this._shader}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}},{key:"primitive",get:function(){return this._primitive}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"inputState",get:function(){return this._is}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"renderPass",get:function(){return this._renderPass}}]),e}(ra),Na=function(t){function e(){var e;return(e=t.call(this,ui.QUEUE)||this)._type=Ki.GRAPHICS,e}return $(e,t),Q(e,[{key:"type",get:function(){return this._type}}]),e}(ra),Ba=function(t){function e(){var e;return(e=t.call(this,ui.RENDER_PASS)||this)._colorInfos=[],e._depthStencilInfo=null,e._subpasses=[],e._hash=0,e}return $(e,t),e.prototype.computeHash=function(){var t="";if(this._subpasses.length)for(var e=0;e<this._subpasses.length;++e){var n=this._subpasses[e];if(n.inputs.length){t+="ia";for(var i=0;i<n.inputs.length;++i){var r=this._colorInfos[n.inputs[i]];t+=","+r.format+","+r.sampleCount}}if(n.colors.length){t+="ca";for(var a=0;a<n.inputs.length;++a){var o=this._colorInfos[n.inputs[a]];t+=","+o.format+","+o.sampleCount}}if(n.depthStencil>=0){var s=this._colorInfos[n.depthStencil];t+="ds,"+s.format+","+s.sampleCount}}else{t+="ca";for(var c=0;c<this._colorInfos.length;++c){var l=this._colorInfos[c];t+=","+l.format+","+l.sampleCount}var h=this._depthStencilInfo;h&&(t+="ds,"+h.format+","+h.sampleCount)}return ba(t,666)},Q(e,[{key:"colorAttachments",get:function(){return this._colorInfos}},{key:"depthStencilAttachment",get:function(){return this._depthStencilInfo}},{key:"subPasses",get:function(){return this._subpasses}},{key:"hash",get:function(){return this._hash}}]),e}(ra),La=function(t){function e(e,n){var i;return(i=t.call(this,ui.SAMPLER)||this)._info=new Tr,i._hash=0,i._info.copy(e),i._hash=n,i}return $(e,t),e.computeHash=function(t){var e=t.minFilter;return e|=t.magFilter<<2,e|=t.mipFilter<<4,e|=t.addressU<<6,e|=t.addressV<<8,e|=t.addressW<<10,(e|=t.maxAnisotropy<<12)|t.cmpFunc<<16},e.unpackFromHash=function(t){var e=new Tr;return e.minFilter=(3&t)>>0,e.magFilter=(3&t)>>2,e.mipFilter=(3&t)>>4,e.addressU=(3&t)>>6,e.addressV=(3&t)>>8,e.addressW=(3&t)>>10,e.maxAnisotropy=(15&t)>>12,e.cmpFunc=(7&t)>>16,e},Q(e,[{key:"info",get:function(){return this._info}},{key:"hash",get:function(){return this._hash}}]),e}(ra),Fa=function(t){function e(){var e;return(e=t.call(this,ui.SHADER)||this)._name="",e._stages=[],e._attributes=[],e._blocks=[],e._samplers=[],e}return $(e,t),Q(e,[{key:"name",get:function(){return this._name}},{key:"attributes",get:function(){return this._attributes}},{key:"blocks",get:function(){return this._blocks}},{key:"samplers",get:function(){return this._samplers}}]),e}(ra),Va=function(t){function e(){var e;return(e=t.call(this,ui.TEXTURE)||this)._info=new br,e._viewInfo=new Cr,e._isPowerOf2=!1,e._isTextureView=!1,e._size=0,e}return $(e,t),e.getLevelCount=function(t,e){return Math.floor(Math.log2(Math.max(t,e)))},Q(e,[{key:"type",get:function(){return this._info.type}},{key:"usage",get:function(){return this._info.usage}},{key:"format",get:function(){return this._info.format}},{key:"width",get:function(){return this._info.width}},{key:"height",get:function(){return this._info.height}},{key:"depth",get:function(){return this._info.depth}},{key:"layerCount",get:function(){return this._info.layerCount}},{key:"levelCount",get:function(){return this._info.levelCount}},{key:"samples",get:function(){return this._info.samples}},{key:"flags",get:function(){return this._info.flags}},{key:"size",get:function(){return this._size}},{key:"info",get:function(){return this._info}},{key:"viewInfo",get:function(){return this._viewInfo}},{key:"isTextureView",get:function(){return this._isTextureView}}]),e}(ra),za=function(t){function e(e,n){var i;return(i=t.call(this,ui.GLOBAL_BARRIER)||this)._info=new Hr,i._hash=0,i._info.copy(e),i._hash=n,i}return $(e,t),e.computeHash=function(t){return ba(t.prevAccesses+" "+t.nextAccesses,666)},Q(e,[{key:"info",get:function(){return this._info}},{key:"hash",get:function(){return this._hash}}]),e}(ra),ka=function(t){function e(e,n){var i;return(i=t.call(this,ui.TEXTURE_BARRIER)||this)._info=new jr,i._hash=0,i._info.copy(e),i._hash=n,i}return $(e,t),e.computeHash=function(t){var e=t.prevAccesses+" "+t.nextAccesses;return e+=t.discardContents,e+=t.srcQueue?t.srcQueue.type:0,ba(e+=t.dstQueue?t.dstQueue.type:0,666)},Q(e,[{key:"info",get:function(){return this._info}},{key:"hash",get:function(){return this._hash}}]),e}(ra),Ua={Device:ga,Swapchain:ya,Buffer:ma,Texture:Va,Sampler:La,Shader:Fa,InputAssembler:Ca,RenderPass:Ba,Framebuffer:xa,DescriptorSet:Ta,DescriptorSetLayout:Ea,PipelineLayout:wa,PipelineState:Oa,CommandBuffer:va,Queue:Na,GeneralBarrier:za,TextureBarrier:ka,RasterizerState:Ia,BlendState:Ra,BlendTarget:Da,DepthStencilState:Pa,PipelineStateInfo:Ma};Object.assign(Ua,pa),h.gfx=Ua;var Ga={GFXDevice:!0,GFXBuffer:!0,GFXTexture:!0,GFXSampler:!0,GFXShader:!0,GFXInputAssembler:!0,GFXRenderPass:!0,GFXFramebuffer:!0,GFXPipelineState:!0,GFXCommandBuffer:!0,GFXQueue:!0,GFXObjectType:!0,GFXObject:!1,GFXAttributeName:!0,GFXType:!0,GFXFormat:!0,GFXBufferUsageBit:!0,GFXMemoryUsageBit:!0,GFXBufferFlagBit:!0,GFXBufferAccessBit:"MemoryAccessBit",GFXPrimitiveMode:!0,GFXPolygonMode:!0,GFXShadeModel:!0,GFXCullMode:!0,GFXComparisonFunc:!0,GFXStencilOp:!0,GFXBlendOp:!0,GFXBlendFactor:!0,GFXColorMask:!0,GFXFilter:!0,GFXAddress:!0,GFXTextureType:!0,GFXTextureUsageBit:!0,GFXSampleCount:!0,GFXTextureFlagBit:!0,GFXShaderStageFlagBit:!0,GFXDescriptorType:!0,GFXCommandBufferType:!0,GFXLoadOp:!0,GFXStoreOp:!0,GFXPipelineBindPoint:!0,GFXDynamicStateFlagBit:!0,GFXStencilFace:!0,GFXQueueType:!0,GFXRect:!0,GFXViewport:!0,GFXColor:!0,GFXClearFlag:!0,GFXOffset:!0,GFXExtent:!0,GFXTextureSubres:"TextureSubresLayers",GFXTextureCopy:!0,GFXBufferTextureCopy:!0,GFXFormatType:!0,GFXFormatInfo:!0,GFXMemoryStatus:!0,GFXFormatInfos:!0,GFXFormatSize:!0,GFXFormatSurfaceSize:!0,GFXGetTypeSize:!0,getTypedArrayConstructor:!1};for(var Ha in Ga){var ja=Ga[Ha];!0===ja?ja=Ha.slice(3):!1===ja&&(ja=Ha),k(h,"cc",[{name:Ha,newName:ja,target:h.gfx,targetName:"cc.gfx"}])}U(h,"cc",[{name:"GFX_MAX_VERTEX_ATTRIBUTES"},{name:"GFX_MAX_TEXTURE_UNITS"},{name:"GFX_MAX_ATTACHMENTS"},{name:"GFX_MAX_BUFFER_BINDINGS"},{name:"GFXTextureLayout"}]),U(pi,"Feature",[{name:"COLOR_FLOAT",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.R32F) & FormatFeatureBit.RENDER_TARGET;"},{name:"COLOR_HALF_FLOAT",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.R16F) & FormatFeatureBit.RENDER_TARGET;"},{name:"TEXTURE_FLOAT",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = (device.getFormatFeatures(Format.R32F) & (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE)) === (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE);"},{name:"TEXTURE_HALF_FLOAT",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = (device.getFormatFeatures(Format.R16F) & (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE)) === (FormatFeatureBit.RENDER_TARGET | FormatFeatureBit.SAMPLED_TEXTURE);"},{name:"TEXTURE_FLOAT_LINEAR",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.R32F) & FormatFeatureBit.LINEAR_FILTER;"},{name:"TEXTURE_HALF_FLOAT_LINEAR",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.R16F) & FormatFeatureBit.LINEAR_FILTER;"},{name:"FORMAT_R11G11B10F",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.R11G11B10F) !== FormatFeatureBit.NONE;"},{name:"FORMAT_SRGB",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.SRGB8) !== FormatFeatureBit.NONE;"},{name:"FORMAT_ETC1",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.ETC_RGB8) !== FormatFeatureBit.NONE;"},{name:"FORMAT_ETC2",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.ETC2_RGB8) !== FormatFeatureBit.NONE;"},{name:"FORMAT_DXT",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.BC1) !== FormatFeatureBit.NONE;"},{name:"FORMAT_PVRTC",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.PVRTC_RGB2) !== FormatFeatureBit.NONE;"},{name:"FORMAT_ASTC",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.ASTC_RGBA_4x4) !== FormatFeatureBit.NONE;"},{name:"FORMAT_RGB8",suggest:"Please use device.getFormatFeatures() instead, like: \nlet isSupported = device.getFormatFeatures(Format.RGB8) !== FormatFeatureBit.NONE;"}]),U(Vr.prototype,"ColorAttachment",[{name:"beginAccesses",suggest:"Please assign to ColorAttachment.barrier instead"},{name:"endAccesses",suggest:"Please assign to ColorAttachment.barrier instead"}]),U(zr.prototype,"DepthStencilAttachment",[{name:"beginAccesses",suggest:"Please assign to DepthStencilAttachment.barrier instead"},{name:"endAccesses",suggest:"Please assign to DepthStencilAttachment.barrier instead"}]),k(ga.prototype,"Device",[{name:"getGlobalBarrier",newName:"getGeneralBarrier"}]),t("gfx",Object.freeze({__proto__:null,DescriptorSet:Ta,Buffer:ma,CommandBuffer:va,get ObjectType(){return ui},get Status(){return _i},get API(){return fi},get SurfaceTransform(){return di},get Feature(){return pi},get Format(){return mi},get FormatType(){return vi},get Type(){return gi},get BufferUsageBit(){return yi},get BufferFlagBit(){return xi},get MemoryAccessBit(){return Si},get MemoryUsageBit(){return Ai},get TextureType(){return bi},get TextureUsageBit(){return Ci},get TextureFlagBit(){return Ti},get FormatFeatureBit(){return Ei},get SampleCount(){return wi},get VsyncMode(){return Ii},get Filter(){return Pi},get Address(){return Di},get ComparisonFunc(){return Ri},get StencilOp(){return Mi},get BlendFactor(){return Oi},get BlendOp(){return Ni},get ColorMask(){return Bi},get ShaderStageFlagBit(){return Li},get LoadOp(){return Fi},get StoreOp(){return Vi},get AccessFlagBit(){return zi},get ResolveMode(){return ki},get PipelineBindPoint(){return Ui},get PrimitiveMode(){return Gi},get PolygonMode(){return Hi},get ShadeModel(){return ji},get CullMode(){return Wi},get DynamicStateFlagBit(){return qi},get StencilFace(){return Xi},get DescriptorType(){return Yi},get QueueType(){return Ki},get QueryType(){return Ji},get CommandBufferType(){return Qi},get ClearFlagBit(){return Zi},Size:ir,DeviceCaps:rr,Offset:ar,Rect:or,Extent:sr,TextureSubresLayers:cr,TextureSubresRange:lr,TextureCopy:hr,TextureBlit:ur,BufferTextureCopy:_r,Viewport:fr,Color:dr,BindingMappingInfo:pr,SwapchainInfo:mr,DeviceInfo:vr,BufferInfo:gr,BufferViewInfo:yr,DrawInfo:xr,DispatchInfo:Sr,IndirectBuffer:Ar,TextureInfo:br,TextureViewInfo:Cr,SamplerInfo:Tr,Uniform:Er,UniformBlock:wr,UniformSamplerTexture:Ir,UniformSampler:Pr,UniformTexture:Dr,UniformStorageImage:Rr,UniformStorageBuffer:Mr,UniformInputAttachment:Or,ShaderStage:Nr,Attribute:Br,ShaderInfo:Lr,InputAssemblerInfo:Fr,ColorAttachment:Vr,DepthStencilAttachment:zr,SubpassInfo:kr,SubpassDependency:Ur,RenderPassInfo:Gr,GeneralBarrierInfo:Hr,TextureBarrierInfo:jr,FramebufferInfo:Wr,DescriptorSetLayoutBinding:qr,DescriptorSetLayoutInfo:Xr,DescriptorSetInfo:Yr,PipelineLayoutInfo:Kr,InputState:Jr,CommandBufferInfo:Qr,QueueInfo:Zr,QueryPoolInfo:$r,FormatInfo:ta,MemoryStatus:ea,DynamicStencilStates:na,DynamicStates:ia,GFXObject:ra,get AttributeName(){return nr},FormatInfos:aa,DESCRIPTOR_BUFFER_TYPE:oa,DESCRIPTOR_SAMPLER_TYPE:sa,DESCRIPTOR_DYNAMIC_TYPE:ca,DRAW_INFO_SIZE:28,IsPowerOf2:la,FormatSize:ha,FormatSurfaceSize:ua,GetTypeSize:fa,getTypedArrayConstructor:da,Device:ga,Swapchain:ya,Framebuffer:xa,InputAssembler:Ca,DescriptorSetLayout:Ea,PipelineLayout:wa,RasterizerState:Ia,DepthStencilState:Pa,BlendTarget:Da,BlendState:Ra,PipelineStateInfo:Ma,PipelineState:Oa,Queue:Na,RenderPass:Ba,Sampler:La,Shader:Fa,Texture:Va,GeneralBarrier:za,TextureBarrier:ka}));var Wa=new Mn,qa=new Mn,Xa=new Mn,Ya=new Mn,Ka=new Mn,Ja=new Mn,Qa=new Array(3),Za=new Array(3);function $a(t,e){return Mn.dot(e.n,t)-e.d}function to(t,e,n){return Mn.copy(t,e),Mn.subtract(Ka,n.center,n.halfExtents),Mn.add(Ja,n.center,n.halfExtents),t.x=t.x<Ka.x?Ka.x:t.x,t.y=t.y<Ka.y?Ka.y:t.y,t.z=t.z<Ka.z?Ka.z:t.z,t.x=t.x>Ja.x?Ja.x:t.x,t.y=t.y>Ja.y?Ja.y:t.y,t.z=t.z>Ja.z?Ja.z:t.z,t}function eo(t,e,n){Mn.set(Wa,n.orientation.m00,n.orientation.m01,n.orientation.m02),Mn.set(qa,n.orientation.m03,n.orientation.m04,n.orientation.m05),Mn.set(Xa,n.orientation.m06,n.orientation.m07,n.orientation.m08),Qa[0]=Wa,Qa[1]=qa,Qa[2]=Xa,Za[0]=n.halfExtents.x,Za[1]=n.halfExtents.y,Za[2]=n.halfExtents.z,Mn.subtract(Ya,e,n.center),Mn.set(t,n.center.x,n.center.y,n.center.z);for(var i=0;i<3;i++){var r=Mn.dot(Ya,Qa[i]);r>Za[i]&&(r=Za[i]),r<-Za[i]&&(r=-Za[i]),t.x+=r*Qa[i].x,t.y+=r*Qa[i].y,t.z+=r*Qa[i].z}return t}var no=Object.freeze({__proto__:null,point_plane:$a,pt_point_plane:function(t,e,n){var i=$a(e,n);return Mn.subtract(t,e,Mn.multiplyScalar(t,n.n,i))},pt_point_aabb:to,pt_point_obb:eo,pt_point_line:function(t,e,n,i){Mn.subtract(Wa,n,i);var r=Wa,a=Mn.lengthSqr(r);if(0==a)Mn.copy(t,n);else{Mn.subtract(Wa,e,n);var o=Mn.dot(Wa,r)/a;o<0?Mn.copy(t,n):o>1?Mn.copy(t,i):Mn.scaleAndAdd(t,n,r,o)}}}),io={SHAPE_RAY:1,SHAPE_LINE:2,SHAPE_SPHERE:4,SHAPE_AABB:8,SHAPE_OBB:16,SHAPE_PLANE:32,SHAPE_TRIANGLE:64,SHAPE_FRUSTUM:128,SHAPE_FRUSTUM_ACCURATE:256,SHAPE_CAPSULE:512},ro=function(){function t(t,e,n,i,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=-1),this.s=void 0,this.e=void 0,this._type=void 0,this._type=io.SHAPE_LINE,this.s=new Mn(t,e,n),this.e=new Mn(i,r,a)}return t.create=function(e,n,i,r,a,o){return new t(e,n,i,r,a,o)},t.clone=function(e){return new t(e.s.x,e.s.y,e.s.z,e.e.x,e.e.y,e.e.z)},t.copy=function(t,e){return Mn.copy(t.s,e.s),Mn.copy(t.e,e.e),t},t.fromPoints=function(t,e,n){return Mn.copy(t.s,e),Mn.copy(t.e,n),t},t.set=function(t,e,n,i,r,a,o){return t.s.x=e,t.s.y=n,t.s.z=i,t.e.x=r,t.e.y=a,t.e.z=o,t},t.len=function(t){return Mn.distance(t.s,t.e)},t.prototype.length=function(){return Mn.distance(this.s,this.e)},Q(t,[{key:"type",get:function(){return this._type}}]),t}(),ao=function(){function t(t,e,n,i,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=-1),this.o=void 0,this.d=void 0,this._type=void 0,this._type=io.SHAPE_RAY,this.o=new Mn(t,e,n),this.d=new Mn(i,r,a)}return t.create=function(e,n,i,r,a,o){return void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=1),new t(e,n,i,r,a,o)},t.clone=function(e){return new t(e.o.x,e.o.y,e.o.z,e.d.x,e.d.y,e.d.z)},t.copy=function(t,e){return Mn.copy(t.o,e.o),Mn.copy(t.d,e.d),t},t.fromPoints=function(t,e,n){return Mn.copy(t.o,e),Mn.normalize(t.d,Mn.subtract(t.d,n,e)),t},t.set=function(t,e,n,i,r,a,o){return t.o.x=e,t.o.y=n,t.o.z=i,t.d.x=r,t.d.y=a,t.d.z=o,t},t.prototype.computeHit=function(t,e){Mn.normalize(t,this.d),Mn.scaleAndAdd(t,this.o,t,e)},Q(t,[{key:"type",get:function(){return this._type}}]),t}(),oo=new Mn,so=new Mn,co=new Mn,lo=new Mn;function ho(t){return Math.max(Math.max(t.x,t.y),t.z)}var uo,_o=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),this._center=new Mn(0,0,0),this._radius=0,this._type=void 0,this._type=io.SHAPE_SPHERE,this._center=new Mn(t,e,n),this._radius=i}t.create=function(e,n,i,r){return new t(e,n,i,r)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.radius)},t.copy=function(t,e){return Mn.copy(t.center,e.center),t.radius=e.radius,t},t.fromPoints=function(t,e,n){return Mn.multiplyScalar(t.center,Mn.add(oo,e,n),.5),t.radius=.5*Mn.subtract(oo,n,e).length(),t},t.set=function(t,e,n,i,r){return t.center.x=e,t.center.y=n,t.center.z=i,t.radius=r,t};var e=t.prototype;return e.destroy=function(){},e.clone=function(){return t.clone(this)},e.copy=function(e){return t.copy(this,e)},e.getBoundary=function(t,e){Mn.set(t,this.center.x-this.radius,this.center.y-this.radius,this.center.z-this.radius),Mn.set(e,this.center.x+this.radius,this.center.y+this.radius,this.center.z+this.radius)},e.transform=function(t,e,n,i,r){Mn.transformMat4(r.center,this.center,t),r.radius=this.radius*ho(i)},e.translateAndRotate=function(t,e,n){Mn.transformMat4(n.center,this.center,t)},e.setScale=function(t,e){e.radius=this.radius*ho(t)},e.mergePoint=function(t){this.radius<0&&(this.center.set(t),this.radius=0),Mn.subtract(so,t,this.center);var e=so.length();if(e>this.radius){var n=.5*(e-this.radius);this.radius+=n,Mn.multiplyScalar(so,so,n/e),Mn.add(this.center,this.center,so)}},e.mergePoints=function(t){var e=t.length;if(!(e<1)){this.radius=-1;for(var n=0;n<e;n++)this.mergePoint(t[n])}},e.mergeAABB=function(t){t.getBoundary(co,lo),this.mergePoint(co),this.mergePoint(lo)},Q(t,[{key:"center",get:function(){return this._center},set:function(t){this._center=t}},{key:"radius",get:function(){return this._radius},set:function(t){this._radius=t}},{key:"type",get:function(){return this._type}}]),t}(),fo=function(){function t(t,e,n,i,r,a,o,s,c){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=1),void 0===c&&(c=0),this.a=void 0,this.b=void 0,this.c=void 0,this._type=void 0,this._type=io.SHAPE_TRIANGLE,this.a=new Mn(t,e,n),this.b=new Mn(i,r,a),this.c=new Mn(o,s,c)}return t.create=function(e,n,i,r,a,o,s,c,l){return void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=1),new t(e,n,i,r,a,o,s,c,l)},t.clone=function(e){return new t(e.a.x,e.a.y,e.a.z,e.b.x,e.b.y,e.b.z,e.c.x,e.c.y,e.c.z)},t.copy=function(t,e){return Mn.copy(t.a,e.a),Mn.copy(t.b,e.b),Mn.copy(t.c,e.c),t},t.fromPoints=function(t,e,n,i){return Mn.copy(t.a,e),Mn.copy(t.b,n),Mn.copy(t.c,i),t},t.set=function(t,e,n,i,r,a,o,s,c,l){return t.a.x=e,t.a.y=n,t.a.z=i,t.b.x=r,t.b.y=a,t.b.z=o,t.c.x=s,t.c.y=c,t.c.z=l,t},Q(t,[{key:"type",get:function(){return this._type}}]),t}();!function(t){t[t.ALL=0]="ALL",t[t.CLOSEST=1]="CLOSEST",t[t.ANY=2]="ANY"}(uo||(uo={}));var po,mo,vo,go,yo,xo,So,Ao,bo=(po=new Mn(0,0,0),function(t,e){var n=Mn.dot(t.d,e.n);if(Math.abs(n)<Number.EPSILON)return 0;Mn.multiplyScalar(po,e.n,e.d);var i=Mn.dot(Mn.subtract(po,po,t.o),e.n)/n;return i<0?0:i}),Co=(mo=new Mn(0,0,0),vo=new Mn(0,0,0),go=new Mn(0,0,0),yo=new Mn(0,0,0),xo=new Mn(0,0,0),function(t,e,n){Mn.subtract(mo,e.b,e.a),Mn.subtract(vo,e.c,e.a),Mn.cross(go,t.d,vo);var i=Mn.dot(mo,go);if(i<Number.EPSILON&&(!n||i>-Number.EPSILON))return 0;var r=1/i;Mn.subtract(yo,t.o,e.a);var a=Mn.dot(yo,go)*r;if(a<0||a>1)return 0;Mn.cross(xo,yo,mo);var o=Mn.dot(t.d,xo)*r;if(o<0||a+o>1)return 0;var s=Mn.dot(vo,xo)*r;return s<0?0:s}),To=function(){var t=new Mn(0,0,0);return function(e,n){var i=n.radius,r=n.center,a=e.o,o=e.d,s=i*i;Mn.subtract(t,r,a);var c=t.lengthSqr(),l=Mn.dot(t,o),h=s-(c-l*l);if(h<0)return 0;var u=Math.sqrt(h),_=c<s?l+u:l-u;return _<0?0:_}}(),Eo=(So=new Mn,Ao=new Mn,function(t,e){return Mn.subtract(So,e.center,e.halfExtents),Mn.add(Ao,e.center,e.halfExtents),wo(t,So,Ao)});function wo(t,e,n){var i=t.o,r=t.d,a=1/r.x,o=1/r.y,s=1/r.z,c=(e.x-i.x)*a,l=(n.x-i.x)*a,h=(e.y-i.y)*o,u=(n.y-i.y)*o,_=(e.z-i.z)*s,f=(n.z-i.z)*s,d=Math.max(Math.max(Math.min(c,l),Math.min(h,u)),Math.min(_,f)),p=Math.min(Math.min(Math.max(c,l),Math.max(h,u)),Math.max(_,f));return p<0||d>p?0:d>0?d:p}var Io,Po,Do,Ro,Mo=function(){var t=new Mn,e=new Mn,n=new Mn,i=new Mn,r=new Mn,a=new Mn,o=new Mn,s=new Array(3),c=new Array(3),l=new Array(3),h=new Array(6);return function(u,_){s[0]=_.halfExtents.x,s[1]=_.halfExtents.y,s[2]=_.halfExtents.z,t=_.center,e=u.o,n=u.d,Mn.set(i,_.orientation.m00,_.orientation.m01,_.orientation.m02),Mn.set(r,_.orientation.m03,_.orientation.m04,_.orientation.m05),Mn.set(a,_.orientation.m06,_.orientation.m07,_.orientation.m08),Mn.subtract(o,t,e),c[0]=Mn.dot(i,n),c[1]=Mn.dot(r,n),c[2]=Mn.dot(a,n),l[0]=Mn.dot(i,o),l[1]=Mn.dot(r,o),l[2]=Mn.dot(a,o);for(var f=0;f<3;++f){if(0===c[f]){if(-l[f]-s[f]>0||-l[f]+s[f]<0)return 0;c[f]=1e-7}h[2*f+0]=(l[f]+s[f])/c[f],h[2*f+1]=(l[f]-s[f])/c[f]}var d=Math.max(Math.max(Math.min(h[0],h[1]),Math.min(h[2],h[3])),Math.min(h[4],h[5])),p=Math.min(Math.min(Math.max(h[0],h[1]),Math.max(h[2],h[3])),Math.max(h[4],h[5]));return p<0||d>p?0:d>0?d:p}}(),Oo=function(){var t=new Mn,e=new Mn,n=new Mn,i=new Mn,r=new Mn,a=new Mn,o=new Mn,s=new _o;return function(c,l){var h=l.radius*l.radius,u=Mn.normalize(t,c.d),_=l.ellipseCenter0,f=l.ellipseCenter1,d=Mn.subtract(e,f,_);if(d.equals(Mn.ZERO))return s.radius=l.radius,s.center.set(l.ellipseCenter0),vs.raySphere(c,s);var p=c.o,m=Mn.subtract(n,p,_),v=Mn.cross(i,u,d),g=v.lengthSqr();if(0===g){s.radius=l.radius;var y=Mn.subtract(r,f,p);return m.lengthSqr()<y.lengthSqr()?s.center.set(l.ellipseCenter0):s.center.set(l.ellipseCenter1),vs.raySphere(c,s)}var x=Mn.cross(r,m,d),S=d.lengthSqr(),A=2*Mn.dot(v,x),b=A*A-4*g*(x.lengthSqr()-h*S);if(b<0)return 0;var C=(-A-Math.sqrt(b))/(2*g);if(C<0){s.radius=l.radius;var T=Mn.subtract(a,f,p);return m.lengthSqr()<T.lengthSqr()?s.center.set(l.ellipseCenter0):s.center.set(l.ellipseCenter1),vs.raySphere(c,s)}var E=Mn.scaleAndAdd(a,c.o,u,C),w=Mn.subtract(o,E,_),I=Mn.dot(w,d)/S;return I>=0&&I<=1?C:I<0?(s.radius=l.radius,s.center.set(l.ellipseCenter0),vs.raySphere(c,s)):I>1?(s.radius=l.radius,s.center.set(l.ellipseCenter1),vs.raySphere(c,s)):0}}(),No=(Io=fo.create(),Po={distance:1/0,doubleSided:!1,mode:uo.ANY},Do=0,Ro=function(t,e,n,i,r,a){t===uo.CLOSEST?(Do>e||0===Do)&&(Do=e,a&&(0===a.length?a.push({distance:e,vertexIndex0:n/3,vertexIndex1:i/3,vertexIndex2:r/3}):(a[0].distance=e,a[0].vertexIndex0=n/3,a[0].vertexIndex1=i/3,a[0].vertexIndex2=r/3))):(Do=e,a&&a.push({distance:e,vertexIndex0:n/3,vertexIndex1:i/3,vertexIndex2:r/3}))},function(t,e,n){if(Do=0,0===e.geometricInfo.positions.length)return Do;var i=void 0===n?Po:n;if(wo(t,e.geometricInfo.boundingBox.min,e.geometricInfo.boundingBox.max)){var r=e.primitiveMode,a=e.geometricInfo;!function(t,e,n,i,r){if(n===Gi.TRIANGLE_LIST)for(var a=e.length,o=0;o<a;o+=3){var s=3*e[o],c=3*e[o+1],l=3*e[o+2];Mn.set(Io.a,t[s],t[s+1],t[s+2]),Mn.set(Io.b,t[c],t[c+1],t[c+2]),Mn.set(Io.c,t[l],t[l+1],t[l+2]);var h=vs.rayTriangle(i,Io,r.doubleSided);if(!(0===h||h>r.distance)&&(Ro(r.mode,h,s,c,l,r.result),r.mode===uo.ANY))return h}else if(n===Gi.TRIANGLE_STRIP)for(var u=e.length-2,_=0,f=0;f<u;f+=1){var d=3*e[f-_],p=3*e[f+_+1],m=3*e[f+2];Mn.set(Io.a,t[d],t[d+1],t[d+2]),Mn.set(Io.b,t[p],t[p+1],t[p+2]),Mn.set(Io.c,t[m],t[m+1],t[m+2]),_=~_;var v=vs.rayTriangle(i,Io,r.doubleSided);if(!(0===v||v>r.distance)&&(Ro(r.mode,v,d,p,m,r.result),r.mode===uo.ANY))return v}else if(n===Gi.TRIANGLE_FAN){var g=e.length-1,y=3*e[0];Mn.set(Io.a,t[y],t[y+1],t[y+2]);for(var x=1;x<g;x+=1){var S=3*e[x],A=3*e[x+1];Mn.set(Io.b,t[S],t[S+1],t[S+2]),Mn.set(Io.c,t[A],t[A+1],t[A+2]);var b=vs.rayTriangle(i,Io,r.doubleSided);if(!(0===b||b>r.distance)&&(Ro(r.mode,b,y,S,A,r.result),r.mode===uo.ANY))return b}}}(a.positions,a.indices,r,t,i)}return Do}),Bo=function(){var t=0,e={distance:1/0,doubleSided:!1,mode:uo.ANY};return function(n,i,r){t=0;var a=void 0===r?e:r,o=i.renderingSubMeshes.length,s=i.struct.minPosition,c=i.struct.maxPosition;if(s&&c&&!wo(n,s,c))return t;for(var l=0;l<o;l++){var h=i.renderingSubMeshes[l],u=No(n,h,a);if(u)if(a.mode===uo.CLOSEST)(0===t||t>u)&&(t=u,a.subIndices&&(a.subIndices[0]=l));else if(t=u,a.subIndices&&a.subIndices.push(l),a.mode===uo.ANY)return u}return t&&a.mode===uo.CLOSEST&&(a.result&&(a.result[0].distance=t,a.result.length=1),a.subIndices&&(a.subIndices.length=1)),t}}(),Lo=function(){var t=0,e={distance:1/0,doubleSided:!1,mode:uo.ANY},n=new ao,i=new Xn;return function(r,a,o){t=0;var s=void 0===o?e:o,c=a.worldBounds;if(c&&!Eo(r,c))return t;ao.copy(n,r),a.node&&(Xn.invert(i,a.node.getWorldMatrix(i)),Mn.transformMat4(n.o,r.o,i),Mn.transformMat4Normal(n.d,r.d,i));for(var l=a.subModels,h=0;h<l.length;h++){var u=l[h].subMesh,_=No(n,u,s);if(_)if(s.mode===uo.CLOSEST)(0===t||t>_)&&(t=_,s.subIndices&&(s.subIndices[0]=h));else if(t=_,s.subIndices&&s.subIndices.push(h),s.mode===uo.ANY)return _}return t&&s.mode===uo.CLOSEST&&(s.result&&(s.result[0].distance=t,s.result.length=1),s.subIndices&&(s.subIndices.length=1)),t}}(),Fo=function(){var t=new Mn(0,0,0);return function(e,n){Mn.subtract(t,e.e,e.s);var i=(n.d-Mn.dot(e.s,n.n))/Mn.dot(t,n.n);return i<0||i>1?0:i}}(),Vo=function(){var t=new Mn(0,0,0),e=new Mn(0,0,0),n=new Mn(0,0,0),i=new Mn(0,0,0),r=new Mn(0,0,0),a=new Mn(0,0,0);return function(o,s,c){Mn.subtract(t,s.b,s.a),Mn.subtract(e,s.c,s.a),Mn.subtract(n,o.s,o.e),Mn.cross(r,t,e);var l=Mn.dot(n,r);if(l<=0)return 0;Mn.subtract(i,o.s,s.a);var h=Mn.dot(i,r);if(h<0||h>l)return 0;Mn.cross(a,n,i);var u=Mn.dot(e,a);if(u<0||u>l)return 0;var _=-Mn.dot(t,a);if(_<0||u+_>l)return 0;if(c){var f=1/l,d=1-(u*=f)-(_*=f);Mn.set(c,s.a.x*d+s.b.x*u+s.c.x*_,s.a.y*d+s.b.y*u+s.c.y*_,s.a.z*d+s.b.z*u+s.c.z*_)}return 1}}(),zo=new ao;function ko(t,e){zo.o.set(t.s),Mn.subtract(zo.d,t.e,t.s),zo.d.normalize();var n=Eo(zo,e);return n<=t.length()?n:0}function Uo(t,e){zo.o.set(t.s),Mn.subtract(zo.d,t.e,t.s),zo.d.normalize();var n=Mo(zo,e);return n<=t.length()?n:0}function Go(t,e){zo.o.set(t.s),Mn.subtract(zo.d,t.e,t.s),zo.d.normalize();var n=To(zo,e);return n<=t.length()?n:0}var Ho,jo,Wo,qo,Xo=(Ho=new Mn,jo=new Mn,Wo=new Mn,qo=new Mn,function(t,e){return Mn.subtract(Ho,t.center,t.halfExtents),Mn.add(jo,t.center,t.halfExtents),Mn.subtract(Wo,e.center,e.halfExtents),Mn.add(qo,e.center,e.halfExtents),Ho.x<=qo.x&&jo.x>=Wo.x&&Ho.y<=qo.y&&jo.y>=Wo.y&&Ho.z<=qo.z&&jo.z>=Wo.z});function Yo(t,e,n,i,r,a){Mn.set(a[0],t.x+n.x*e.x+i.x*e.y+r.x*e.z,t.y+n.y*e.x+i.y*e.y+r.y*e.z,t.z+n.z*e.x+i.z*e.y+r.z*e.z),Mn.set(a[1],t.x-n.x*e.x+i.x*e.y+r.x*e.z,t.y-n.y*e.x+i.y*e.y+r.y*e.z,t.z-n.z*e.x+i.z*e.y+r.z*e.z),Mn.set(a[2],t.x+n.x*e.x-i.x*e.y+r.x*e.z,t.y+n.y*e.x-i.y*e.y+r.y*e.z,t.z+n.z*e.x-i.z*e.y+r.z*e.z),Mn.set(a[3],t.x+n.x*e.x+i.x*e.y-r.x*e.z,t.y+n.y*e.x+i.y*e.y-r.y*e.z,t.z+n.z*e.x+i.z*e.y-r.z*e.z),Mn.set(a[4],t.x-n.x*e.x-i.x*e.y-r.x*e.z,t.y-n.y*e.x-i.y*e.y-r.y*e.z,t.z-n.z*e.x-i.z*e.y-r.z*e.z),Mn.set(a[5],t.x+n.x*e.x-i.x*e.y-r.x*e.z,t.y+n.y*e.x-i.y*e.y-r.y*e.z,t.z+n.z*e.x-i.z*e.y-r.z*e.z),Mn.set(a[6],t.x-n.x*e.x+i.x*e.y-r.x*e.z,t.y-n.y*e.x+i.y*e.y-r.y*e.z,t.z-n.z*e.x+i.z*e.y-r.z*e.z),Mn.set(a[7],t.x-n.x*e.x-i.x*e.y+r.x*e.z,t.y-n.y*e.x-i.y*e.y+r.y*e.z,t.z-n.z*e.x-i.z*e.y+r.z*e.z)}function Ko(t,e){for(var n=Mn.dot(e,t[0]),i=n,r=1;r<8;++r){var a=Mn.dot(e,t[r]);n=a<n?a:n,i=a>i?a:i}return[n,i]}var Jo,Qo,Zo,$o=function(){for(var t=new Array(15),e=0;e<15;e++)t[e]=new Mn(0,0,0);for(var n=new Array(8),i=new Array(8),r=0;r<8;r++)n[r]=new Mn(0,0,0),i[r]=new Mn(0,0,0);var a=new Mn,o=new Mn;return function(e,r){Mn.set(t[0],1,0,0),Mn.set(t[1],0,1,0),Mn.set(t[2],0,0,1),Mn.set(t[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),Mn.set(t[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),Mn.set(t[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(var s=0;s<3;++s)Mn.cross(t[6+3*s],t[s],t[3]),Mn.cross(t[7+3*s],t[s],t[4]),Mn.cross(t[7+3*s],t[s],t[5]);Mn.subtract(a,e.center,e.halfExtents),Mn.add(o,e.center,e.halfExtents),function(t,e,n){Mn.set(n[0],t.x,e.y,e.z),Mn.set(n[1],t.x,e.y,t.z),Mn.set(n[2],t.x,t.y,e.z),Mn.set(n[3],t.x,t.y,t.z),Mn.set(n[4],e.x,e.y,e.z),Mn.set(n[5],e.x,e.y,t.z),Mn.set(n[6],e.x,t.y,e.z),Mn.set(n[7],e.x,t.y,t.z)}(a,o,n),Yo(r.center,r.halfExtents,t[3],t[4],t[5],i);for(var c=0;c<15;++c){var l=Ko(n,t[c]),h=Ko(i,t[c]);if(h[0]>l[1]||l[0]>h[1])return 0}return 1}}(),ts=function(t,e){var n=t.halfExtents.x*Math.abs(e.n.x)+t.halfExtents.y*Math.abs(e.n.y)+t.halfExtents.z*Math.abs(e.n.z),i=Mn.dot(e.n,t.center);return i+n<e.d?-1:i-n>e.d?0:1},es=function(t,e){for(var n=0;n<e.planes.length;n++)if(-1===ts(t,e.planes[n]))return 0;return 1},ns=function(){for(var t=new Array(8),e=0,n=0,i=0;i<t.length;i++)t[i]=new Mn(0,0,0);return function(i,r){for(var a=0,o=!1,s=0;s<r.planes.length;s++){if(-1===(a=ts(i,r.planes[s])))return 0;1===a&&(o=!0)}if(!o)return 1;for(var c=0;c<r.vertices.length;c++)Mn.subtract(t[c],r.vertices[c],i.center);e=0,n=0;for(var l=0;l<r.vertices.length;l++)t[l].x>i.halfExtents.x?e++:t[l].x<-i.halfExtents.x&&n++;if(e===r.vertices.length||n===r.vertices.length)return 0;e=0,n=0;for(var h=0;h<r.vertices.length;h++)t[h].y>i.halfExtents.y?e++:t[h].y<-i.halfExtents.y&&n++;if(e===r.vertices.length||n===r.vertices.length)return 0;e=0,n=0;for(var u=0;u<r.vertices.length;u++)t[u].z>i.halfExtents.z?e++:t[u].z<-i.halfExtents.z&&n++;return e===r.vertices.length||n===r.vertices.length?0:1}}(),is=(Jo=new Mn(0,0,0),Qo=new Ln,function(t,e){return Mn.subtract(Jo,e,t.center),Mn.transformMat3(Jo,Jo,Ln.transpose(Qo,t.orientation)),n=Jo,i=t.halfExtents,Math.abs(n.x)<i.x&&Math.abs(n.y)<i.y&&Math.abs(n.z)<i.z;var n,i}),rs=(Zo=function(t,e,n,i){return Math.abs(t.x*e+t.y*n+t.z*i)},function(t,e){var n=t.halfExtents.x*Zo(e.n,t.orientation.m00,t.orientation.m01,t.orientation.m02)+t.halfExtents.y*Zo(e.n,t.orientation.m03,t.orientation.m04,t.orientation.m05)+t.halfExtents.z*Zo(e.n,t.orientation.m06,t.orientation.m07,t.orientation.m08),i=Mn.dot(e.n,t.center);return i+n<e.d?-1:i-n>e.d?0:1}),as=function(t,e){for(var n=0;n<e.planes.length;n++)if(-1===rs(t,e.planes[n]))return 0;return 1},os=function(){for(var t=new Array(8),e=0,n=0,i=0,r=0;r<t.length;r++)t[r]=new Mn(0,0,0);var a=function(t,e,n,i){return t.x*e+t.y*n+t.z*i};return function(r,o){for(var s=0,c=!1,l=0;l<o.planes.length;l++){if(-1===(s=rs(r,o.planes[l])))return 0;1===s&&(c=!0)}if(!c)return 1;for(var h=0;h<o.vertices.length;h++)Mn.subtract(t[h],o.vertices[h],r.center);n=0,i=0;for(var u=0;u<o.vertices.length;u++)(e=a(t[u],r.orientation.m00,r.orientation.m01,r.orientation.m02))>r.halfExtents.x?n++:e<-r.halfExtents.x&&i++;if(n===o.vertices.length||i===o.vertices.length)return 0;n=0,i=0;for(var _=0;_<o.vertices.length;_++)(e=a(t[_],r.orientation.m03,r.orientation.m04,r.orientation.m05))>r.halfExtents.y?n++:e<-r.halfExtents.y&&i++;if(n===o.vertices.length||i===o.vertices.length)return 0;n=0,i=0;for(var f=0;f<o.vertices.length;f++)(e=a(t[f],r.orientation.m06,r.orientation.m07,r.orientation.m08))>r.halfExtents.z?n++:e<-r.halfExtents.z&&i++;return n===o.vertices.length||i===o.vertices.length?0:1}}(),ss=function(){for(var t=new Array(15),e=0;e<15;e++)t[e]=new Mn(0,0,0);for(var n=new Array(8),i=new Array(8),r=0;r<8;r++)n[r]=new Mn(0,0,0),i[r]=new Mn(0,0,0);return function(e,r){Mn.set(t[0],e.orientation.m00,e.orientation.m01,e.orientation.m02),Mn.set(t[1],e.orientation.m03,e.orientation.m04,e.orientation.m05),Mn.set(t[2],e.orientation.m06,e.orientation.m07,e.orientation.m08),Mn.set(t[3],r.orientation.m00,r.orientation.m01,r.orientation.m02),Mn.set(t[4],r.orientation.m03,r.orientation.m04,r.orientation.m05),Mn.set(t[5],r.orientation.m06,r.orientation.m07,r.orientation.m08);for(var a=0;a<3;++a)Mn.cross(t[6+3*a],t[a],t[3]),Mn.cross(t[7+3*a],t[a],t[4]),Mn.cross(t[8+3*a],t[a],t[5]);Yo(e.center,e.halfExtents,t[0],t[1],t[2],n),Yo(r.center,r.halfExtents,t[3],t[4],t[5],i);for(var o=0;o<15;++o){var s=Ko(n,t[o]),c=Ko(i,t[o]);if(c[0]>s[1]||s[0]>c[1])return 0}return 1}}(),cs=function(){for(var t=new _o,e=new Mn,n=new Mn,i=new Mn,r=new Array(8),a=0;a<8;a++)r[a]=new Mn;for(var o=new Array(8),s=0;s<8;s++)o[s]=new Mn;return function(a,s){if(0===Mn.squaredDistance(s.ellipseCenter0,s.ellipseCenter1))return t.radius=s.radius,t.center.set(s.ellipseCenter0),vs.sphereOBB(t,a);e.x=a.orientation.m00,e.y=a.orientation.m01,e.z=a.orientation.m02,n.x=a.orientation.m03,n.y=a.orientation.m04,n.z=a.orientation.m05,i.x=a.orientation.m06,i.y=a.orientation.m07,i.z=a.orientation.m08,Yo(a.center,a.halfExtents,e,n,i,r);var c=o,l=Mn.copy(c[0],e),h=Mn.copy(c[1],n),u=Mn.copy(c[2],i);Mn.subtract(c[3],s.center,a.center).normalize();var _=Mn.subtract(c[4],s.ellipseCenter0,s.ellipseCenter1);_.normalize(),Mn.cross(c[5],l,_),Mn.cross(c[6],h,_),Mn.cross(c[7],u,_);for(var f=0;f<8;++f){var d=Ko(r,c[f]),p=Mn.dot(c[f],s.ellipseCenter0),m=Mn.dot(c[f],s.ellipseCenter1),v=Math.max(p,m),g=Math.min(p,m)-s.radius,y=v+s.radius;if(g>d[1]||d[0]>y)return 0}return 1}}(),ls=function(t,e){var n=Mn.dot(e.n,t.center),i=t.radius*e.n.length();return n+i<e.d?-1:n-i>e.d?0:1},hs=function(t,e){for(var n=0;n<e.planes.length;n++)if(-1===ls(t,e.planes[n]))return 0;return 1},us=function(){var t=new Mn(0,0,0),e=[1,-1,1,-1,1,-1];return function(n,i){for(var r=0;r<6;r++){var a=i.planes[r],o=n.radius,s=n.center,c=a.n,l=a.d,h=Mn.dot(c,s);if(h+o<l)return 0;if(!(h-o>l)){Mn.add(t,s,Mn.multiplyScalar(t,c,o));for(var u=0;u<6;u++)if(u!==r&&u!==r+e[r]){var _=i.planes[u];if(Mn.dot(_.n,t)<_.d)return 0}}}return 1}}(),_s=function(t,e){var n=t.radius+e.radius;return Mn.squaredDistance(t.center,e.center)<n*n},fs=function(){var t=new Mn;return function(e,n){return to(t,e.center,n),Mn.squaredDistance(e.center,t)<e.radius*e.radius}}(),ds=function(){var t=new Mn;return function(e,n){return eo(t,e.center,n),Mn.squaredDistance(e.center,t)<e.radius*e.radius}}(),ps=function(){var t=new Mn,e=new Mn;return function(n,i){var r=n.radius+i.radius,a=r*r,o=Mn.squaredDistance(i.ellipseCenter0,i.ellipseCenter1);if(0===o)return Mn.squaredDistance(n.center,i.center)<a;Mn.subtract(t,n.center,i.ellipseCenter0),Mn.subtract(e,i.ellipseCenter1,i.ellipseCenter0);var s=Mn.dot(t,e)/o;return s<0?Mn.squaredDistance(n.center,i.ellipseCenter0)<a:s>1?Mn.squaredDistance(n.center,i.ellipseCenter1)<a:(Mn.scaleAndAdd(t,i.ellipseCenter0,e,s),Mn.squaredDistance(n.center,t)<a)}}(),ms=function(){var t=new Mn,e=new Mn,n=new Mn,i=new Mn,r=new Mn,a=new Mn;return function(o,s){var c,l,h=Mn.subtract(t,o.ellipseCenter1,o.ellipseCenter0),u=Mn.subtract(e,s.ellipseCenter1,s.ellipseCenter0),_=Mn.subtract(n,o.ellipseCenter0,s.ellipseCenter0),f=Mn.dot(h,h),d=Mn.dot(h,u),p=Mn.dot(u,u),m=Mn.dot(h,_),v=Mn.dot(u,_),g=f*p-d*d,y=g,x=g;g<cn?(c=0,y=1,l=v,x=p):(l=f*v-d*m,(c=d*v-p*m)<0?(c=0,l=v,x=p):c>y&&(c=y,l=v+d,x=p)),l<0?(l=0,-m<0?c=0:-m>f?c=y:(c=-m,y=f)):l>x&&(l=x,-m+d<0?c=0:-m+d>f?c=y:(c=-m+d,y=f));var S=Math.abs(c)<cn?0:c/y,A=Math.abs(l)<cn?0:l/x,b=i;b.set(_),b.add(Mn.multiplyScalar(r,h,S)),b.subtract(Mn.multiplyScalar(a,u,A));var C=o.radius+s.radius;return b.lengthSqr()<C*C}}(),vs={raySphere:To,rayAABB:Eo,rayOBB:Mo,rayPlane:bo,rayTriangle:Co,rayCapsule:Oo,raySubMesh:No,rayMesh:Bo,rayModel:Lo,lineSphere:Go,lineAABB:ko,lineOBB:Uo,linePlane:Fo,lineTriangle:Vo,sphereWithSphere:_s,sphereAABB:fs,sphereOBB:ds,spherePlane:ls,sphereFrustum:hs,sphereFrustumAccurate:us,sphereCapsule:ps,aabbWithAABB:Xo,aabbWithOBB:$o,aabbPlane:ts,aabbFrustum:es,aabbFrustumAccurate:ns,obbWithOBB:ss,obbPlane:rs,obbFrustum:as,obbFrustumAccurate:os,obbPoint:is,obbCapsule:cs,capsuleWithCapsule:ms,resolve:function(t,e,n){void 0===n&&(n=null);var i=t._type,r=e._type,a=this[i|r];return i<r?a(t,e,n):a(e,t,n)}};vs[io.SHAPE_RAY|io.SHAPE_SPHERE]=To,vs[io.SHAPE_RAY|io.SHAPE_AABB]=Eo,vs[io.SHAPE_RAY|io.SHAPE_OBB]=Mo,vs[io.SHAPE_RAY|io.SHAPE_PLANE]=bo,vs[io.SHAPE_RAY|io.SHAPE_TRIANGLE]=Co,vs[io.SHAPE_RAY|io.SHAPE_CAPSULE]=Oo,vs[io.SHAPE_LINE|io.SHAPE_SPHERE]=Go,vs[io.SHAPE_LINE|io.SHAPE_AABB]=ko,vs[io.SHAPE_LINE|io.SHAPE_OBB]=Uo,vs[io.SHAPE_LINE|io.SHAPE_PLANE]=Fo,vs[io.SHAPE_LINE|io.SHAPE_TRIANGLE]=Vo,vs[io.SHAPE_SPHERE]=_s,vs[io.SHAPE_SPHERE|io.SHAPE_AABB]=fs,vs[io.SHAPE_SPHERE|io.SHAPE_OBB]=ds,vs[io.SHAPE_SPHERE|io.SHAPE_PLANE]=ls,vs[io.SHAPE_SPHERE|io.SHAPE_FRUSTUM]=hs,vs[io.SHAPE_SPHERE|io.SHAPE_FRUSTUM_ACCURATE]=us,vs[io.SHAPE_SPHERE|io.SHAPE_CAPSULE]=ps,vs[io.SHAPE_AABB]=Xo,vs[io.SHAPE_AABB|io.SHAPE_OBB]=$o,vs[io.SHAPE_AABB|io.SHAPE_PLANE]=ts,vs[io.SHAPE_AABB|io.SHAPE_FRUSTUM]=es,vs[io.SHAPE_AABB|io.SHAPE_FRUSTUM_ACCURATE]=ns,vs[io.SHAPE_OBB]=ss,vs[io.SHAPE_OBB|io.SHAPE_PLANE]=rs,vs[io.SHAPE_OBB|io.SHAPE_FRUSTUM]=as,vs[io.SHAPE_OBB|io.SHAPE_FRUSTUM_ACCURATE]=os,vs[io.SHAPE_OBB|io.SHAPE_CAPSULE]=cs,vs[io.SHAPE_CAPSULE]=ms,k(ro.prototype,"line",[{name:"mag",newName:"len"},{name:"magnitude",newName:"len"}]),U(vs,"intersect",[{name:"line_quad"}]);var gs,ys,xs,Ss,As,bs,Cs,Ts=new Mn(0,0,0),Es=new Mn(0,0,0),ws=h.mat4(),Is=h.v4(),Ps=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=1),void 0===n&&(n=0),void 0===i&&(i=0),this.n=void 0,this.d=void 0,this._type=void 0,this._type=io.SHAPE_PLANE,this.n=new Mn(t,e,n),this.d=i}return t.create=function(e,n,i,r){return new t(e,n,i,r)},t.clone=function(e){return new t(e.n.x,e.n.y,e.n.z,e.d)},t.copy=function(t,e){return Mn.copy(t.n,e.n),t.d=e.d,t},t.fromPoints=function(t,e,n,i){return Mn.subtract(Ts,n,e),Mn.subtract(Es,i,e),Mn.normalize(t.n,Mn.cross(t.n,Ts,Es)),t.d=Mn.dot(t.n,e),t},t.set=function(t,e,n,i,r){return t.n.x=e,t.n.y=n,t.n.z=i,t.d=r,t},t.fromNormalAndPoint=function(t,e,n){return Mn.copy(t.n,e),t.d=Mn.dot(e,n),t},t.normalize=function(t,e){var n=e.n.length();return Mn.normalize(t.n,e.n),n>0&&(t.d=e.d/n),t},t.prototype.transform=function(t){Xn.invert(ws,t),Xn.transpose(ws,ws),ei.set(Is,this.n.x,this.n.y,this.n.z,this.d),ei.transformMat4(Is,Is,ws),Mn.set(this.n,Is.x,Is.y,Is.z),this.d=Is.w},Q(t,[{key:"type",get:function(){return this._type}},{key:"x",get:function(){return this.n.x},set:function(t){this.n.x=t}},{key:"y",get:function(){return this.n.y},set:function(t){this.n.y=t}},{key:"z",get:function(){return this.n.z},set:function(t){this.n.z=t}},{key:"w",get:function(){return this.d},set:function(t){this.d=t}}]),t}(),Ds=function(){function t(t,e,n){this._arrayBuffers=[],this._chunkSize=void 0,this._chunkSize=n*(1<<e)}return t.prototype.allocateNewChunk=function(){return new ArrayBuffer(this._chunkSize)},t}();!function(t){t[t.UINT32=0]="UINT32",t[t.FLOAT32=1]="FLOAT32",t[t.NEVER=2]="NEVER"}(Cs||(Cs={}));var Rs,Ms,Os=function(){function t(t,e,n,i,r){void 0===r&&(r=8),this._dataType=void 0,this._dataMembers=void 0,this._elementCount=void 0,this._entryBits=void 0,this._stride=void 0,this._entriesPerChunk=void 0,this._entryMask=void 0,this._chunkMask=void 0,this._poolFlag=void 0,this._arrayBuffers=[],this._freeLists=[],this._uint32BufferViews=[],this._float32BufferViews=[],this._hasUint32=!1,this._hasFloat32=!1,this._nativePool=void 0,this._elementCount=i.COUNT,this._entryBits=r,this._dataType=e,this._dataMembers=n,this._stride=4*this._elementCount,this._entriesPerChunk=1<<r,this._entryMask=this._entriesPerChunk-1,this._poolFlag=1<<30,this._chunkMask=~(this._entryMask|this._poolFlag),this._nativePool=new Ds(t,r,this._stride);var a=Cs.NEVER,o=!1,s=!1;for(var c in e){if(o=this._hasFloat32,(s=this._hasUint32)&&o)break;a=e[c],o||a!==Cs.FLOAT32?s||a!==Cs.UINT32||(this._hasUint32=!0):this._hasFloat32=!0}}var e=t.prototype;return e.alloc=function(){for(var t=0;t<this._freeLists.length;t++){var e=this._freeLists[t];if(e.length){var n=e[e.length-1];return e.length--,(t<<this._entryBits)+n+this._poolFlag}}for(var i=this._nativePool.allocateNewChunk(),r=[],a=[],o=[],s=this._hasFloat32,c=this._hasUint32,l=0;l<this._entriesPerChunk;l++)s&&r.push(new Float32Array(i,this._stride*l,this._elementCount)),c&&a.push(new Uint32Array(i,this._stride*l,this._elementCount)),l&&o.push(l);return c&&this._uint32BufferViews.push(a),s&&this._float32BufferViews.push(r),this._freeLists.push(o),this._arrayBuffers.push(i),(t<<this._entryBits)+this._poolFlag},e.getBuffer=function(t){var e=(this._chunkMask&t)>>this._entryBits,n=this._entryMask&t;return(this._hasFloat32?this._float32BufferViews:this._uint32BufferViews)[e][n]},e.getTypedArray=function(t,e){var n=(this._chunkMask&t)>>this._entryBits,i=this._entryMask&t,r=e,a=(this._dataType[e]===Cs.UINT32?this._uint32BufferViews:this._float32BufferViews)[n][i],o=this._dataMembers[e];return a.subarray(r,r+o)},e.free=function(t){var e=(this._chunkMask&t)>>this._entryBits,n=this._entryMask&t;(this._hasUint32?this._uint32BufferViews:this._float32BufferViews)[e][n].fill(0),this._freeLists[e].push(n)},t}();!function(t){t[t.NODE=0]="NODE",t[t.PASS=1]="PASS",t[t.AABB=2]="AABB"}(Rs||(Rs={})),function(t){t[t.DIRTY_FLAG=0]="DIRTY_FLAG",t[t.LAYER=1]="LAYER",t[t.WORLD_SCALE=2]="WORLD_SCALE",t[t.WORLD_POSITION=5]="WORLD_POSITION",t[t.WORLD_ROTATION=8]="WORLD_ROTATION",t[t.WORLD_MATRIX=12]="WORLD_MATRIX",t[t.LOCAL_SCALE=28]="LOCAL_SCALE",t[t.LOCAL_POSITION=31]="LOCAL_POSITION",t[t.LOCAL_ROTATION=34]="LOCAL_ROTATION",t[t.COUNT=38]="COUNT"}(Ms||(Ms={}));var Ns,Bs=((gs={})[Ms.DIRTY_FLAG]=Cs.UINT32,gs[Ms.LAYER]=Cs.UINT32,gs[Ms.WORLD_SCALE]=Cs.FLOAT32,gs[Ms.WORLD_POSITION]=Cs.FLOAT32,gs[Ms.WORLD_ROTATION]=Cs.FLOAT32,gs[Ms.WORLD_MATRIX]=Cs.FLOAT32,gs[Ms.LOCAL_SCALE]=Cs.FLOAT32,gs[Ms.LOCAL_POSITION]=Cs.FLOAT32,gs[Ms.LOCAL_ROTATION]=Cs.FLOAT32,gs[Ms.COUNT]=Cs.NEVER,gs),Ls=((ys={})[Ms.DIRTY_FLAG]=Ms.LAYER-Ms.DIRTY_FLAG,ys[Ms.LAYER]=Ms.WORLD_SCALE-Ms.LAYER,ys[Ms.WORLD_SCALE]=Ms.WORLD_POSITION-Ms.WORLD_SCALE,ys[Ms.WORLD_POSITION]=Ms.WORLD_ROTATION-Ms.WORLD_POSITION,ys[Ms.WORLD_ROTATION]=Ms.WORLD_MATRIX-Ms.WORLD_ROTATION,ys[Ms.WORLD_MATRIX]=Ms.LOCAL_SCALE-Ms.WORLD_MATRIX,ys[Ms.LOCAL_SCALE]=Ms.LOCAL_POSITION-Ms.LOCAL_SCALE,ys[Ms.LOCAL_POSITION]=Ms.LOCAL_ROTATION-Ms.LOCAL_POSITION,ys[Ms.LOCAL_ROTATION]=Ms.COUNT-Ms.LOCAL_ROTATION,ys[Ms.COUNT]=1,ys),Fs=new Os(Rs.NODE,Bs,Ls,Ms);!function(t){t[t.PRIORITY=0]="PRIORITY",t[t.STAGE=1]="STAGE",t[t.PHASE=2]="PHASE",t[t.PRIMITIVE=3]="PRIMITIVE",t[t.BATCHING_SCHEME=4]="BATCHING_SCHEME",t[t.DYNAMIC_STATE=5]="DYNAMIC_STATE",t[t.HASH=6]="HASH",t[t.COUNT=7]="COUNT"}(Ns||(Ns={}));var Vs,zs=((xs={})[Ns.PRIORITY]=Cs.UINT32,xs[Ns.STAGE]=Cs.UINT32,xs[Ns.PHASE]=Cs.UINT32,xs[Ns.PRIMITIVE]=Cs.UINT32,xs[Ns.BATCHING_SCHEME]=Cs.UINT32,xs[Ns.DYNAMIC_STATE]=Cs.UINT32,xs[Ns.HASH]=Cs.UINT32,xs[Ns.COUNT]=Cs.NEVER,xs),ks=((Ss={})[Ns.PRIORITY]=Ns.STAGE-Ns.PRIORITY,Ss[Ns.STAGE]=Ns.PHASE-Ns.STAGE,Ss[Ns.PHASE]=Ns.PRIMITIVE-Ns.PHASE,Ss[Ns.PRIMITIVE]=Ns.BATCHING_SCHEME-Ns.PRIMITIVE,Ss[Ns.BATCHING_SCHEME]=Ns.DYNAMIC_STATE-Ns.BATCHING_SCHEME,Ss[Ns.DYNAMIC_STATE]=Ns.HASH-Ns.DYNAMIC_STATE,Ss[Ns.HASH]=Ns.COUNT-Ns.HASH,Ss[Ns.COUNT]=1,Ss),Us=new Os(Rs.PASS,zs,ks,Ns);!function(t){t[t.CENTER=0]="CENTER",t[t.HALFEXTENTS=3]="HALFEXTENTS",t[t.COUNT=6]="COUNT"}(Vs||(Vs={}));var Gs=((As={})[Vs.CENTER]=Cs.FLOAT32,As[Vs.HALFEXTENTS]=Cs.FLOAT32,As[Vs.COUNT]=Cs.NEVER,As),Hs=((bs={})[Vs.CENTER]=Vs.HALFEXTENTS-Vs.CENTER,bs[Vs.HALFEXTENTS]=Vs.COUNT-Vs.HALFEXTENTS,bs[Vs.COUNT]=1,bs),js=new Os(Rs.AABB,Gs,Hs,Vs),Ws=new Mn,qs=new Mn,Xs=new Mn,Ys=new Mn,Ks=new Ln,Js=function(t,e,n){Ks.m00=Math.abs(n.m00),Ks.m01=Math.abs(n.m01),Ks.m02=Math.abs(n.m02),Ks.m03=Math.abs(n.m04),Ks.m04=Math.abs(n.m05),Ks.m05=Math.abs(n.m06),Ks.m06=Math.abs(n.m08),Ks.m07=Math.abs(n.m09),Ks.m08=Math.abs(n.m10),Mn.transformMat3(t,e,Ks)},Qs=function(){function t(t,e,n,i,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===a&&(a=1),this.center=void 0,this.halfExtents=void 0,this._type=void 0,this._aabbHandle=0,this._type=io.SHAPE_AABB,this.center=new Mn(t,e,n),this.halfExtents=new Mn(i,r,a)}t.create=function(e,n,i,r,a,o){return new t(e,n,i,r,a,o)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.halfExtents.x,e.halfExtents.y,e.halfExtents.z)},t.copy=function(t,e){return Mn.copy(t.center,e.center),Mn.copy(t.halfExtents,e.halfExtents),t},t.fromPoints=function(t,e,n){return Mn.add(Ws,n,e),Mn.subtract(qs,n,e),Mn.multiplyScalar(t.center,Ws,.5),Mn.multiplyScalar(t.halfExtents,qs,.5),t},t.set=function(t,e,n,i,r,a,o){return t.center.set(e,n,i),t.halfExtents.set(r,a,o),t},t.merge=function(e,n,i){return Mn.subtract(Ws,n.center,n.halfExtents),Mn.subtract(qs,i.center,i.halfExtents),Mn.add(Xs,n.center,n.halfExtents),Mn.add(Ys,i.center,i.halfExtents),Mn.max(Ys,Xs,Ys),Mn.min(Xs,Ws,qs),t.fromPoints(e,Xs,Ys)},t.toBoundingSphere=function(t,e){return t.center.set(e.center),t.radius=e.halfExtents.length(),t},t.transform=function(t,e,n){return Mn.transformMat4(t.center,e.center,n),Js(t.halfExtents,e.halfExtents,n),t};var e=t.prototype;return e.getBoundary=function(t,e){Mn.subtract(t,this.center,this.halfExtents),Mn.add(e,this.center,this.halfExtents)},e.transform=function(t,e,n,i,r){Mn.transformMat4(r.center,this.center,t),Js(r.halfExtents,this.halfExtents,t)},e.clone=function(){return t.clone(this)},e.copy=function(e){return t.copy(this,e)},e.mergePoint=function(t){this.getBoundary(Ws,qs),t.x<Ws.x&&(Ws.x=t.x),t.y<Ws.y&&(Ws.y=t.y),t.z<Ws.z&&(Ws.z=t.z),t.x>qs.x&&(qs.x=t.x),t.y>qs.y&&(qs.y=t.y),t.z>qs.z&&(qs.z=t.z),Mn.add(Xs,Ws,qs),this.center.set(Mn.multiplyScalar(Xs,Xs,.5)),this.halfExtents.set(qs.x-Xs.x,qs.y-Xs.y,qs.z-Xs.z)},e.mergePoints=function(t){if(!(t.length<1))for(var e=0;e<t.length;e++)this.mergePoint(t[e])},e.mergeFrustum=function(t){return this.mergePoints(t.vertices)},Q(t,[{key:"type",get:function(){return this._type}},{key:"native",get:function(){return this._nativeObj}}]),t}(),Zs=new Mn,$s=new Mn,tc=new Ln,ec=function(){function t(t,e,n,i,r,a,o,s,c,l,h,u,_,f,d){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=1),void 0===a&&(a=1),void 0===o&&(o=1),void 0===s&&(s=0),void 0===c&&(c=0),void 0===l&&(l=0),void 0===h&&(h=1),void 0===u&&(u=0),void 0===_&&(_=0),void 0===f&&(f=0),void 0===d&&(d=1),this.center=void 0,this.halfExtents=void 0,this.orientation=void 0,this._type=void 0,this._type=io.SHAPE_OBB,this.center=new Mn(t,e,n),this.halfExtents=new Mn(i,r,a),this.orientation=new Ln(o,s,c,l,h,u,_,f,d)}t.create=function(e,n,i,r,a,o,s,c,l,h,u,_,f,d,p){return new t(e,n,i,r,a,o,s,c,l,h,u,_,f,d,p)},t.clone=function(e){return new t(e.center.x,e.center.y,e.center.z,e.halfExtents.x,e.halfExtents.y,e.halfExtents.z,e.orientation.m00,e.orientation.m01,e.orientation.m02,e.orientation.m03,e.orientation.m04,e.orientation.m05,e.orientation.m06,e.orientation.m07,e.orientation.m08)},t.copy=function(t,e){return Mn.copy(t.center,e.center),Mn.copy(t.halfExtents,e.halfExtents),Ln.copy(t.orientation,e.orientation),t},t.fromPoints=function(t,e,n){return Mn.multiplyScalar(t.center,Mn.add(Zs,e,n),.5),Mn.multiplyScalar(t.halfExtents,Mn.subtract($s,n,e),.5),Ln.identity(t.orientation),t},t.set=function(t,e,n,i,r,a,o,s,c,l,h,u,_,f,d,p){return Mn.set(t.center,e,n,i),Mn.set(t.halfExtents,r,a,o),Ln.set(t.orientation,s,c,l,h,u,_,f,d,p),t};var e=t.prototype;return e.getBoundary=function(t,e){!function(t,e,n){tc.m00=Math.abs(n.m00),tc.m01=Math.abs(n.m01),tc.m02=Math.abs(n.m02),tc.m03=Math.abs(n.m03),tc.m04=Math.abs(n.m04),tc.m05=Math.abs(n.m05),tc.m06=Math.abs(n.m06),tc.m07=Math.abs(n.m07),tc.m08=Math.abs(n.m08),Mn.transformMat3(t,e,tc)}(Zs,this.halfExtents,this.orientation),Mn.subtract(t,this.center,Zs),Mn.add(e,this.center,Zs)},e.transform=function(t,e,n,i,r){Mn.transformMat4(r.center,this.center,t),Ln.fromQuat(r.orientation,n),Mn.multiply(r.halfExtents,this.halfExtents,i)},e.translateAndRotate=function(t,e,n){Mn.transformMat4(n.center,this.center,t),Ln.fromQuat(n.orientation,e)},e.setScale=function(t,e){Mn.multiply(e.halfExtents,this.halfExtents,t)},Q(t,[{key:"type",get:function(){return this._type}}]),t}(),nc=function(){function t(t,e,n){void 0===t&&(t=.5),void 0===e&&(e=.5),void 0===n&&(n=1),this._type=void 0,this.radius=void 0,this.halfHeight=void 0,this.axis=void 0,this.center=void 0,this.rotation=void 0,this.ellipseCenter0=void 0,this.ellipseCenter1=void 0,this._type=io.SHAPE_CAPSULE,this.radius=t,this.halfHeight=e,this.axis=n,this.center=new Mn,this.rotation=new zn,this.ellipseCenter0=new Mn(0,e,0),this.ellipseCenter1=new Mn(0,-e,0),this.updateCache()}var e=t.prototype;return e.transform=function(t,e,n,i,r){var a=i,o=En(a);r.radius=this.radius*Math.abs(o);var s=(this.halfHeight+this.radius)*Math.abs(a.y)-r.radius;s<0&&(s=0),r.halfHeight=s,Mn.transformMat4(r.center,this.center,t),zn.multiply(r.rotation,this.rotation,n),r.updateCache()},e.updateCache=function(){this.updateLocalCenter(),Mn.transformQuat(this.ellipseCenter0,this.ellipseCenter0,this.rotation),Mn.transformQuat(this.ellipseCenter1,this.ellipseCenter1,this.rotation),this.ellipseCenter0.add(this.center),this.ellipseCenter1.add(this.center)},e.updateLocalCenter=function(){var t=this.halfHeight;switch(this.axis){case 0:this.ellipseCenter0.set(t,0,0),this.ellipseCenter1.set(-t,0,0);break;case 1:this.ellipseCenter0.set(0,t,0),this.ellipseCenter1.set(0,-t,0);break;case 2:this.ellipseCenter0.set(0,0,t),this.ellipseCenter1.set(0,0,-t)}},Q(t,[{key:"type",get:function(){return this._type}}]),t}(),ic=new Array(8);ic[0]=new Mn(1,1,1),ic[1]=new Mn(-1,1,1),ic[2]=new Mn(-1,-1,1),ic[3]=new Mn(1,-1,1),ic[4]=new Mn(1,1,-1),ic[5]=new Mn(-1,1,-1),ic[6]=new Mn(-1,-1,-1),ic[7]=new Mn(1,-1,-1);var rc,ac,oc=new Mn,sc=new Mn,cc=new Mn,lc=function(){function t(){this.planes=void 0,this.vertices=void 0,this._type=void 0,this._type=io.SHAPE_FRUSTUM,this.planes=new Array(6);for(var t=0;t<6;++t)this.planes[t]=Ps.create(0,0,0,0);this.vertices=new Array(8);for(var e=0;e<8;++e)this.vertices[e]=new Mn}t.createFromAABB=function(t,e){var n=new Mn,i=new Mn;return Mn.subtract(n,e.center,e.halfExtents),Mn.add(i,e.center,e.halfExtents),t.vertices[0].set(n.x,i.y,n.z),t.vertices[1].set(i.x,i.y,n.z),t.vertices[2].set(i.x,n.y,n.z),t.vertices[3].set(n.x,n.y,n.z),t.vertices[4].set(n.x,i.y,i.z),t.vertices[5].set(i.x,i.y,i.z),t.vertices[6].set(i.x,n.y,i.z),t.vertices[7].set(n.x,n.y,i.z),t._type!==io.SHAPE_FRUSTUM_ACCURATE||t.updatePlanes(),t},t.split=function(t,e,n,i,r){var a=Math.tan(.5*e.fov),o=a*e.aspect;oc.set(i*o,i*a,i),sc.set(r*o,r*a,r);var s=t.vertices;return cc.set(oc.x,oc.y,oc.z),Mn.transformMat4(s[0],cc,n),cc.set(-oc.x,oc.y,oc.z),Mn.transformMat4(s[1],cc,n),cc.set(-oc.x,-oc.y,oc.z),Mn.transformMat4(s[2],cc,n),cc.set(oc.x,-oc.y,oc.z),Mn.transformMat4(s[3],cc,n),cc.set(sc.x,sc.y,sc.z),Mn.transformMat4(s[4],cc,n),cc.set(-sc.x,sc.y,sc.z),Mn.transformMat4(s[5],cc,n),cc.set(-sc.x,-sc.y,sc.z),Mn.transformMat4(s[6],cc,n),cc.set(sc.x,-sc.y,sc.z),Mn.transformMat4(s[7],cc,n),t.updatePlanes(),t},t.create=function(){return new t},t.clone=function(e){return t.copy(new t,e)},t.copy=function(t,e){t._type=e._type;for(var n=0;n<6;++n)Ps.copy(t.planes[n],e.planes[n]);for(var i=0;i<8;++i)Mn.copy(t.vertices[i],e.vertices[i]);return t};var e=t.prototype;return e.update=function(t,e){if(Mn.set(this.planes[0].n,t.m03+t.m00,t.m07+t.m04,t.m11+t.m08),this.planes[0].d=-(t.m15+t.m12),Mn.set(this.planes[1].n,t.m03-t.m00,t.m07-t.m04,t.m11-t.m08),this.planes[1].d=-(t.m15-t.m12),Mn.set(this.planes[2].n,t.m03+t.m01,t.m07+t.m05,t.m11+t.m09),this.planes[2].d=-(t.m15+t.m13),Mn.set(this.planes[3].n,t.m03-t.m01,t.m07-t.m05,t.m11-t.m09),this.planes[3].d=-(t.m15-t.m13),Mn.set(this.planes[4].n,t.m03+t.m02,t.m07+t.m06,t.m11+t.m10),this.planes[4].d=-(t.m15+t.m14),Mn.set(this.planes[5].n,t.m03-t.m02,t.m07-t.m06,t.m11-t.m10),this.planes[5].d=-(t.m15-t.m14),this._type===io.SHAPE_FRUSTUM_ACCURATE){for(var n=0;n<6;n++){var i=this.planes[n],r=1/i.n.length();Mn.multiplyScalar(i.n,i.n,r),i.d*=r}for(var a=0;a<8;a++)Mn.transformMat4(this.vertices[a],ic[a],e)}},e.transform=function(t){if(this._type===io.SHAPE_FRUSTUM_ACCURATE){for(var e=0;e<8;e++)Mn.transformMat4(this.vertices[e],this.vertices[e],t);this.updatePlanes()}},e.updatePlanes=function(){Ps.fromPoints(this.planes[0],this.vertices[1],this.vertices[6],this.vertices[5]),Ps.fromPoints(this.planes[1],this.vertices[3],this.vertices[4],this.vertices[7]),Ps.fromPoints(this.planes[2],this.vertices[6],this.vertices[3],this.vertices[7]),Ps.fromPoints(this.planes[3],this.vertices[0],this.vertices[5],this.vertices[4]),Ps.fromPoints(this.planes[4],this.vertices[2],this.vertices[0],this.vertices[3]),Ps.fromPoints(this.planes[5],this.vertices[7],this.vertices[5],this.vertices[6])},Q(t,[{key:"accurate",set:function(t){this._type=t?io.SHAPE_FRUSTUM_ACCURATE:io.SHAPE_FRUSTUM}},{key:"type",get:function(){return this._type}}]),t}();lc.createOrtho=function(t,e,n,i,r,a){var o=e/2,s=n/2;Mn.set(cc,o,s,-i),Mn.transformMat4(t.vertices[0],cc,a),Mn.set(cc,-o,s,-i),Mn.transformMat4(t.vertices[1],cc,a),Mn.set(cc,-o,-s,-i),Mn.transformMat4(t.vertices[2],cc,a),Mn.set(cc,o,-s,-i),Mn.transformMat4(t.vertices[3],cc,a),Mn.set(cc,o,s,-r),Mn.transformMat4(t.vertices[4],cc,a),Mn.set(cc,-o,s,-r),Mn.transformMat4(t.vertices[5],cc,a),Mn.set(cc,-o,-s,-r),Mn.transformMat4(t.vertices[6],cc,a),Mn.set(cc,o,-s,-r),Mn.transformMat4(t.vertices[7],cc,a),Ps.fromPoints(t.planes[0],t.vertices[1],t.vertices[6],t.vertices[5]),Ps.fromPoints(t.planes[1],t.vertices[3],t.vertices[4],t.vertices[7]),Ps.fromPoints(t.planes[2],t.vertices[6],t.vertices[3],t.vertices[7]),Ps.fromPoints(t.planes[3],t.vertices[0],t.vertices[5],t.vertices[4]),Ps.fromPoints(t.planes[4],t.vertices[2],t.vertices[0],t.vertices[3]),Ps.fromPoints(t.planes[5],t.vertices[7],t.vertices[5],t.vertices[6])},function(t){t[t.Default=0]="Default",t[t.Normal=1]="Normal",t[t.Loop=2]="Loop",t[t.ShouldWrap=4]="ShouldWrap",t[t.Clamp=8]="Clamp",t[t.PingPong=22]="PingPong",t[t.Reverse=36]="Reverse"}(rc||(rc={})),function(t){t[t.Default=rc.Default]="Default",t[t.Normal=rc.Normal]="Normal",t[t.Reverse=rc.Reverse]="Reverse",t[t.Loop=rc.Loop]="Loop",t[t.LoopReverse=rc.Loop|rc.Reverse]="LoopReverse",t[t.PingPong=rc.PingPong]="PingPong",t[t.PingPongReverse=rc.PingPong|rc.Reverse]="PingPongReverse"}(ac||(ac={})),he(ac);var hc,uc=function(){function t(t){this.ratio=0,this.time=0,this.direction=1,this.stopped=!0,this.iterations=0,this.frameIndex=void 0,t&&this.set(t)}return t.prototype.set=function(t){this.ratio=t.ratio,this.time=t.time,this.direction=t.direction,this.stopped=t.stopped,this.iterations=t.iterations,this.frameIndex=t.frameIndex},t}();function _c(t,e,n){void 0===n&&(n=1e-6);for(var i=0,r=t.length-1,a=r>>>1;i<=r;a=i+r>>>1){var o=t[a];if(o>e+n)r=a-1;else{if(!(o<e-n))return a;i=a+1}}return~i}hc=Symbol.iterator;var fc,dc,pc,mc=function(){function t(){this._times=[],this._values=[]}var e=t.prototype;return e[hc]=function(){var t=this,e=0;return{next:function(){if(e>=t._times.length)return{done:!0,value:void 0};var n=[t._times[e],t._values[e]];return++e,{done:!1,value:n}}}},e.keyframes=function(){return this},e.times=function(){return this._times},e.values=function(){return this._values},e.getKeyframeTime=function(t){return this._times[t]},e.getKeyframeValue=function(t){return this._values[t]},e.addKeyFrame=function(t,e){return this._insertNewKeyframe(t,e)},e.removeKeyframe=function(t){this._times.splice(t,1),this._values.splice(t,1)},e.indexOfKeyframe=function(t){return _c(this._times,t)},e.updateTime=function(t,e){var n=this._values[t];this.removeKeyframe(t),this._insertNewKeyframe(e,n)},e.assignSorted=function(t,e){if(void 0!==e)this.setKeyframes(t.slice(),e.slice());else{var n=Array.from(t);this.setKeyframes(n.map((function(t){return t[0]})),n.map((function(t){return t[1]})))}},e.clear=function(){this._times.length=0,this._values.length=0},e.searchKeyframe=function(t){return _c(this._times,t)},e.setKeyframes=function(t,e){t.length,e.length,function(t){t.every((function(t,e,n){return 0===e||t>n[e-1]||hn(t,n[e-1],1e-6)}))}(t),this._times=t,this._values=e},e._insertNewKeyframe=function(t,e){var n=this._times,i=this._values,r=n.length,a=_c(n,t);if(a>=0)return a;var o=~a;return 0===o?(n.unshift(t),i.unshift(e)):o===r?(n.push(t),i.push(e)):(n.splice(o-1,0,t),i.splice(o-1,0,e)),o},Q(t,[{key:"keyFramesCount",get:function(){return this._times.length}},{key:"rangeMin",get:function(){return this._times[0]}},{key:"rangeMax",get:function(){return this._times[this._values.length-1]}}]),t}();function vc(t){return t>-1e-9&&t<1e-9}en.fastDefine("cc.KeyframeCurve",mc,{_times:[],_values:[]}),function(t){t[t.LINEAR=0]="LINEAR",t[t.CONSTANT=1]="CONSTANT",t[t.CUBIC=2]="CUBIC"}(fc||(fc=t("RealInterpolationMode",{}))),function(t){t[t.LINEAR=0]="LINEAR",t[t.CLAMP=1]="CLAMP",t[t.LOOP=2]="LOOP",t[t.PING_PONG=3]="PING_PONG"}(dc||(dc=t("ExtrapolationMode",{}))),function(t){t[t.NONE=0]="NONE",t[t.LEFT=1]="LEFT",t[t.RIGHT=2]="RIGHT",t[t.BOTH=3]="BOTH"}(pc||(pc=t("TangentWeightMode",{})));var gc=function(){},yc=function(){return gc},xc=Sc((function(){}));function Sc(t){return function(e){return"function"==typeof e?t(e):function(n){return t(n,e)}}}function Ac(t){return function(e){return function(n){!function(t,e,n){var i=Cc(t);if(i){var r=Tc(i,"proto");Tc(r,"editor")[e]=n}}(n,t,e)}}}var bc="__ccclassCache__";function Cc(t){return Tc(t,bc)}function Tc(t,e){return t[e]||(t[e]={})}var Ec=Sc((function(t,e){var n=re.getSuper(t);n===Object&&(n=null);var i={name:e,extends:n,ctor:t},r=t[bc];if(r){var a=r.proto;a&&re.mixin(i,a),t[bc]=void 0}return en(i)})),wc=Ac("requireComponent"),Ic=Ac("executionOrder"),Pc=xc;function Dc(t,e,n){var i=null;function r(t,e,n){!function(t,e,n,i,r,a){var o,s=a&&(a.get||a.set);r&&(o=je(r,s));var c=re.mixin(e,o||r||{});s?(a.get&&(c.get=a.get),a.set&&(c.set=a.set)):Mc(t,c,n,i,a)}(function(t){return Cc(t.constructor)}(t),function(t,e){var n,i,r=Tc(Cc(t.constructor),"proto"),a=Tc(r,"properties");return null!==(i=a[n=e])&&void 0!==i?i:a[n]={}}(t,e),t.constructor,e,i,n)}return void 0===t?Dc({type:void 0}):void 0===e?(i=t,r):void r(t,e,n)}function Rc(t,e,n){var i,r,a=Cc(t.constructor),o=Tc(a,"proto"),s=Tc(o,"properties"),c=null!==(r=s[i=e])&&void 0!==r?r:s[i]={};return c.__internalFlags|=We.STANDALONE,n&&(n.get||n.set)?(n.get&&(c.get=n.get),n.set&&(c.set=n.set)):Mc(a,c,t.constructor,e,n),c}function Mc(t,e,n,i,r){if(r)r.initializer&&(e.default=function(t){var e;try{e=t()}catch(e){return t}return"object"!=typeof e||null===e?e:t}(r.initializer));else{var a=t.default||(t.default=function(t){var e;try{e=new t}catch(t){return{}}return e}(n));a.hasOwnProperty(i)&&(e.default=a[i])}}var Oc=Symbol("cc:SerializationMetadata"),Nc=function(t,e,n){Fc(Rc(t,e,n))};function Bc(t){return function(e,n,i){var r=Rc(e,n,i);r.formerlySerializedAs=t,Fc(r)}}var Lc=function(t,e,n){var i=Rc(t,e,n);i.editorOnly=!0,Fc(i)};function Fc(t){t.__internalFlags|=We.IMPLICIT_SERIALIZABLE}var Vc=gc,zc=xc,kc=yc,Uc=xc,Gc=yc,Hc=yc,jc=yc,Wc=gc,qc=yc,Xc=gc,Yc=yc,Kc=yc,Jc=yc,Qc=yc,Zc=yc,$c=yc,tl=gc,el=yc,nl=gc,il=gc,rl=cl(Ne),al=cl(Be),ol=cl(Le),sl=cl(Fe);function cl(t){return Dc({type:t})}var ll,hl=function(t,e,n){Rc(t,e,n).override=!0},ul=t("editorExtrasTag","__editorExtras__"),_l=function(){},fl=Object.freeze({__proto__:null,uniquelyReferenced:Vc,ccclass:Ec,property:Dc,requireComponent:wc,executionOrder:Ic,disallowMultiple:Pc,allowReplicated:function(t){en.Attr.setClassAttr(t,"replicated","visible",!0)},executeInEditMode:zc,menu:kc,playOnFocus:Uc,inspector:Gc,icon:Hc,help:jc,type:cl,integer:rl,float:al,boolean:ol,string:sl});t("_decorator",fl);var dl=1<<22,pl=[],ml=t("CCObject",function(){function t(t){void 0===t&&(t=""),this._objFlags=void 0,this._name=void 0,this._name=t,this._objFlags=0}t._deferredDestroy=function(){for(var t=pl.length,e=0;e<t;++e){var n=pl[e];1&n._objFlags||n._destroyImmediate()}t===pl.length?pl.length=0:pl.splice(0,t)};var e=t.prototype;return e.destroy=function(){return 1&this._objFlags?(R(5e3),!1):!(4&this._objFlags||(this._objFlags|=4,pl.push(this),0))},e._destruct=function(){var t=this.constructor,e=t.__destruct__;e||(e=function(t,e){var n,i=t instanceof h._BaseNode||t instanceof h.Component,r=i?"_id":null,a={};for(n in t)if(t.hasOwnProperty(n)){if(n===r)continue;switch(typeof t[n]){case"string":a[n]="";break;case"object":case"function":a[n]=null}}if(en._isCCClass(e))for(var o=h.Class.Attr.getClassAttrs(e),s=e.__props__,c=0;c<s.length;c++){var l=(n=s[c])+h.Class.Attr.DELIMETER+"default";if(l in o){if(i&&"_id"===n)continue;switch(typeof o[l]){case"string":a[n]="";break;case"object":case"function":a[n]=null;break;case"undefined":a[n]=void 0}}}return function(t){for(var e in a)t[e]=a[e]}}(this,t),Tt(t,"__destruct__",e,!0)),e(this)},e._destroyImmediate=function(){1&this._objFlags?O(5e3):(this._onPreDestroy&&this._onPreDestroy(),this._destruct(),this._objFlags|=1)},Q(t,[{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"hideFlags",get:function(){return this._objFlags&t.Flags.AllHideMasks},set:function(e){var n=e&t.Flags.AllHideMasks;this._objFlags=this._objFlags&~t.Flags.AllHideMasks|n}},{key:"replicated",get:function(){return!!(this._objFlags&dl)},set:function(t){t?this._objFlags|=dl:this._objFlags&=-4194305}},{key:"isValid",get:function(){return!(1&this._objFlags)}}]),t}()),vl=ml.prototype;function gl(t,e){return"object"==typeof t?!(!t||t._objFlags&(e?5:1)):void 0!==t}vl._deserialize=null,vl._onPreDestroy=null,en.fastDefine("cc.Object",ml,((ll={_name:"",_objFlags:0})[ul]={},ll)),en.Attr.setClassAttr(ml,ul,"editorOnly",!0),en.Attr.setClassAttr(ml,"replicated","visible",!1),Tt(ml,"Flags",{Destroyed:1,DontSave:8,EditorOnly:16,Dirty:32,DontDestroy:64,PersistentMask:-4192741,Destroying:128,Deactivating:256,LockedInEditor:512,HideInHierarchy:1024,AllHideMasks:1560,IsPreloadStarted:8192,IsOnLoadStarted:32768,IsOnLoadCalled:16384,IsOnEnableCalled:2048,IsStartCalled:65536,IsEditorOnEnableCalled:4096,IsPositionLocked:1<<21,IsRotationLocked:1<<17,IsScaleLocked:1<<18,IsAnchorLocked:1<<19,IsSizeLocked:1<<20}),h.isValid=gl,h.Object=ml;var yl=function(){function t(t){this._map=null,this._count=0,t?(this._map=t,this._count=Object.keys(t).length):(this._map=re.createMap(!0),this._count=0)}var e=t.prototype;return e.add=function(t,e){return t in this._map||this._count++,this._map[t]=e},e.get=function(t){return this._map[t]},e.has=function(t){return t in this._map},e.remove=function(t){var e=this._map[t];return t in this._map&&(delete this._map[t],this._count--),e},e.clear=function(){0!==this._count&&(this._map=re.createMap(!0),this._count=0)},e.forEach=function(t){for(var e in this._map)t(this._map[e],e)},e.find=function(t){for(var e in this._map)if(t(this._map[e],e))return this._map[e];return null},e.destroy=function(){this._map=null},Q(t,[{key:"count",get:function(){return this._count}}]),t}(),xl=function(){function t(e,n){this.id=t._pipelineId++,this.name="",this.pipes=[],this.name=e;for(var i=0,r=n.length;i<r;i++)this.pipes.push(n[i])}var e=t.prototype;return e.insert=function(t,e){return e>this.pipes.length?(R(4921),this):(this.pipes.splice(e,0,t),this)},e.append=function(t){return this.pipes.push(t),this},e.remove=function(t){return this.pipes.splice(t,1),this},e.sync=function(t){var e=this.pipes;if(0===e.length)return null;t.isFinish=!1;for(var n=0,i=e.length;n<i;){var r=(0,e[n])(t);if(r)return t.isFinish=!0,r;++n!==i&&(t.input=t.output,t.output=null)}return t.isFinish=!0,t.output},e.async=function(t){0!==this.pipes.length&&(t.isFinish=!1,this._flow(0,t))},e._flow=function(t,e){var n=this;(0,this.pipes[t])(e,(function(i){i?(e.isFinish=!0,e.dispatch("complete",i)):++t<n.pipes.length?(e.input=e.output,e.output=null,n._flow(t,e)):(e.isFinish=!0,e.dispatch("complete",i,e.output))}))},t}();xl._pipelineId=0,function(){function t(t){if(this._weakMap={},void 0===window.WeakRef)throw new Error("this platform does not support WeakRef!");if(t)for(var e in t)this._weakMap[e]=new WeakRef(t[e])}var e=t.prototype;e.add=function(t,e){return this._weakMap[t]=new WeakRef(e),e},e.has=function(t){return t in this._weakMap&&!!this._weakMap[t].deref()},e.get=function(t){return this._weakMap[t]&&this._weakMap[t].deref()},e.remove=function(t){var e=this._weakMap[t];return delete this._weakMap[t],e&&e.deref()},e.clear=function(){this._weakMap=re.createMap(!0)},e.forEach=function(t){for(var e in this._weakMap){var n=this.get(e);n&&t(n,e)}},e.find=function(t){for(var e in this._weakMap){var n=this.get(e);if(n&&t(n,e))return this._weakMap[e].deref()}return null},e.destroy=function(){this._weakMap={}},Q(t,[{key:"count",get:function(){return Object.values(this._weakMap).filter((function(t){return t.deref()})).length}}])}();var Sl,Al=new yl,bl=new yl,Cl=new yl,Tl=new yl,El=new xl("normal load",[]),wl=new xl("fetch",[]),Il=new xl("transform url",[]);!function(t){t.UUID="uuid",t.PATH="path",t.DIR="dir",t.URL="url",t.SCENE="scene"}(Sl||(Sl={}));var Pl,Dl={default:{priority:0},preload:{maxConcurrency:6,maxRequestsPerFrame:2,priority:-1},scene:{maxConcurrency:20,maxRequestsPerFrame:20,priority:1},bundle:{maxConcurrency:20,maxRequestsPerFrame:20,priority:2},remote:{maxRetryCount:4}};!function(t){t.RESOURCES="resources",t.MAIN="main",t.START_SCENE="start-scene"}(Pl||(Pl={}));var Rl=function(){function t(e){this.id=t._taskId++,this.onComplete=null,this.onProgress=null,this.onError=null,this.source=null,this.output=null,this.input=null,this.progress=null,this.options=null,this.isFinish=!0,this.set(e)}t.create=function(e){var n;return 0!==t._deadPool.length?(n=t._deadPool.pop()).set(e):n=new t(e),n};var e=t.prototype;return e.set=function(t){void 0===t&&(t=Object.create(null)),this.onComplete=t.onComplete||null,this.onProgress=t.onProgress||null,this.onError=t.onError||null,this.source=this.input=t.input,this.output=null,this.progress=t.progress,this.options=t.options||Object.create(null)},e.dispatch=function(t,e,n,i,r){switch(t){case"complete":this.onComplete&&this.onComplete(e,n);break;case"progress":this.onProgress&&this.onProgress(e,n,i,r);break;case"error":this.onError&&this.onError(e,n,i,r);break;default:var a="on"+t[0].toUpperCase()+t.substr(1);"function"==typeof this[a]&&this[a](e,n,i,r)}},e.recycle=function(){t._deadPool.length!==t.MAX_DEAD_NUM&&(this.onComplete=null,this.onProgress=null,this.onError=null,this.source=this.output=this.input=null,this.progress=null,this.options=null,t._deadPool.push(this))},t}();Rl.MAX_DEAD_NUM=500,Rl._taskId=0,Rl._deadPool=[];var Ml="0123456789abcdef".split(""),Ol=["","","",""],Nl=Ol.concat(Ol,"-",Ol,"-",Ol,"-",Ol,"-",Ol,Ol,Ol),Bl=Nl.map((function(t,e){return"-"===t?NaN:e})).filter(isFinite);function Ll(t){var e=t.split("@")[0];if(22!==e.length)return t;Nl[0]=t[0],Nl[1]=t[1];for(var n=2,i=2;n<22;n+=2){var r=ve[t.charCodeAt(n)],a=ve[t.charCodeAt(n+1)];Nl[Bl[i++]]=Ml[r>>2],Nl[Bl[i++]]=Ml[(3&r)<<2|a>>4],Nl[Bl[i++]]=Ml[15&a]}return t.replace(e,Nl.join(""))}var Fl=/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,}).*/;function Vl(t){var e=Fl.exec(t);return e?e[1]:""}function zl(t,e){(e=e||Object.create(null)).__isNative__=e.isNative,e.nativeExt&&(e.ext=e.nativeExt);var n=Tl.find((function(e){return!!e.getAssetInfo(t)}));return n&&(e.bundle=n.name),Gl(t,e)}function kl(t){return!!t&&(t instanceof h.SceneAsset||t instanceof h.Scene)}function Ul(t){return t&&(46===t.charCodeAt(0)&&47===t.charCodeAt(1)?t=t.slice(2):47===t.charCodeAt(0)&&(t=t.slice(1))),t}function Gl(t,e){var n=Rl.create({input:t,options:e}),i=[];try{for(var r,a=st(Il.sync(n));!(r=a()).done;){var o=r.value,s=o.url;o.recycle(),i.push(s)}}catch(t){for(var c,l=st(n.output);!(c=l()).done;)c.value.recycle();A(t.message,t.stack)}return n.recycle(),i.length>1?i:i[0]}var Hl=Object.freeze({__proto__:null,getUuidFromURL:Vl,getUrlWithUuid:zl,isScene:kl,normalize:Ul,transform:Gl,decodeUuid:Ll}),jl=new(function(){function t(){this._pools=[],this._lastShrinkPassed=0,this.shrinkTimeSpan=5}var e=t.prototype;return e.addContainer=function(t){-1===t._poolHandle&&(t._poolHandle=this._pools.length,this._pools.push(t))},e.removeContainer=function(t){-1!==t._poolHandle&&(this._pools[this._pools.length-1]._poolHandle=t._poolHandle,_t(this._pools,t._poolHandle),t._poolHandle=-1)},e.tryShrink=function(){for(var t=0;t<this._pools.length;t++)this._pools[t].tryShrink()},e.update=function(t){this._lastShrinkPassed+=t,this._lastShrinkPassed>this.shrinkTimeSpan&&(this.tryShrink(),this._lastShrinkPassed-=this.shrinkTimeSpan)},t}()),Wl=function(){function t(){this._poolHandle=-1,jl.addContainer(this)}return t.prototype.destroy=function(){jl.removeContainer(this)},t}(),ql=t("Pool",function(t){function e(e,n,i){var r;(r=t.call(this)||this)._ctor=void 0,r._elementsPerBatch=void 0,r._nextAvail=void 0,r._freepool=[],r._dtor=void 0,r._ctor=e,r._dtor=i||null,r._elementsPerBatch=Math.max(n,1),r._nextAvail=r._elementsPerBatch-1;for(var a=0;a<r._elementsPerBatch;++a)r._freepool.push(e());return r}$(e,t);var n=e.prototype;return n.alloc=function(){if(this._nextAvail<0){this._freepool.length=this._elementsPerBatch;for(var t=0;t<this._elementsPerBatch;t++)this._freepool[t]=this._ctor();this._nextAvail=this._elementsPerBatch-1}return this._freepool[this._nextAvail--]},n.free=function(t){this._freepool[++this._nextAvail]=t},n.freeArray=function(t){this._freepool.length=this._nextAvail+1,Array.prototype.push.apply(this._freepool,t),this._nextAvail+=t.length},n.tryShrink=function(){if(this._nextAvail>>1>this._elementsPerBatch){if(this._dtor)for(var t=this._nextAvail>>1;t<=this._nextAvail;t++)this._dtor(this._freepool[t]);this._freepool.length=this._nextAvail>>1,this._nextAvail=this._freepool.length-1}},n.destroy=function(){var e=arguments.length>0?arguments[0]:null;e&&R(14100);var n=e||this._dtor;if(n)for(var i=0;i<=this._nextAvail;i++)n(this._freepool[i]);this._freepool.length=0,this._nextAvail=-1,t.prototype.destroy.call(this)},e}(Wl)),Xl=t("RecyclePool",function(t){function e(e,n,i){var r;(r=t.call(this)||this)._fn=void 0,r._dtor=null,r._count=0,r._data=void 0,r._initSize=0,r._fn=e,r._dtor=i||null,r._data=new Array(n),r._initSize=n;for(var a=0;a<n;++a)r._data[a]=e();return r}$(e,t);var n=e.prototype;return n.reset=function(){this._count=0},n.resize=function(t){if(t>this._data.length)for(var e=this._data.length;e<t;++e)this._data[e]=this._fn()},n.add=function(){return this._count>=this._data.length&&this.resize(this._data.length<<1),this._data[this._count++]},n.destroy=function(){if(this._dtor)for(var e=0;e<this._data.length;e++)this._dtor(this._data[e]);this._data.length=0,this._count=0,t.prototype.destroy.call(this)},n.tryShrink=function(){if(this._data.length>>2>this._count){var t=Math.max(this._initSize,this._data.length>>1);if(this._dtor)for(var e=t;e<this._data.length;e++)this._dtor(this._data[e]);this._data.length=t}},n.removeAt=function(t){if(!(t>=this._count)){var e=this._count-1,n=this._data[t];this._data[t]=this._data[e],this._data[e]=n,this._count-=1}},Q(e,[{key:"length",get:function(){return this._count}},{key:"data",get:function(){return this._data}}]),e}(Wl)),Yl=t("CachedArray",function(t){function e(e,n){var i;return(i=t.call(this)||this).array=void 0,i.length=0,i._compareFn=void 0,i._initSize=0,i.array=new Array(e),i._initSize=e,i.length=0,i._compareFn=n,i}$(e,t);var n=e.prototype;return n.push=function(t){this.array[this.length++]=t},n.pop=function(){return this.array[--this.length]},n.get=function(t){return this.array[t]},n.clear=function(){this.length=0},n.destroy=function(){this.length=0,this.array.length=0,t.prototype.destroy.call(this)},n.tryShrink=function(){this.array.length>>2>this.length&&(this.array.length=Math.max(this._initSize,this.array.length>>1))},n.sort=function(){this.array.length=this.length,this.array.sort(this._compareFn)},n.concat=function(t){for(var e=0;e<t.length;++e)this.array[this.length++]=t[e]},n.fastRemove=function(t){if(!(t>=this.length||t<0)){var e=--this.length;this.array[t]=this.array[e]}},n.indexOf=function(t){for(var e=0,n=this.length;e<n;++e)if(this.array[e]===t)return e;return-1},e}(Wl));t("memop",Object.freeze({__proto__:null,Pool:ql,RecyclePool:Xl,CachedArray:Yl}));var Kl=ie.fastRemoveAt;function Jl(){}var Ql=function(){function t(){this.callback=Jl,this.target=void 0,this.once=!1}var e=t.prototype;return e.set=function(t,e,n){this.callback=t||Jl,this.target=e,this.once=!!n},e.reset=function(){this.target=void 0,this.callback=Jl,this.once=!1},e.check=function(){return!(this.target instanceof ml&&!gl(this.target,!0))},t}(),Zl=new ql((function(){return new Ql}),32),$l=function(){function t(){this.callbackInfos=[],this.isInvoking=!1,this.containCanceled=!1}var e=t.prototype;return e.removeByCallback=function(t){for(var e=0;e<this.callbackInfos.length;++e){var n=this.callbackInfos[e];n&&n.callback===t&&(n.reset(),Zl.free(n),Kl(this.callbackInfos,e),--e)}},e.removeByTarget=function(t){for(var e=0;e<this.callbackInfos.length;++e){var n=this.callbackInfos[e];n&&n.target===t&&(n.reset(),Zl.free(n),Kl(this.callbackInfos,e),--e)}},e.cancel=function(t){var e=this.callbackInfos[t];e&&(e.reset(),this.isInvoking?this.callbackInfos[t]=null:Kl(this.callbackInfos,t),Zl.free(e)),this.containCanceled=!0},e.cancelAll=function(){for(var t=0;t<this.callbackInfos.length;t++){var e=this.callbackInfos[t];e&&(e.reset(),Zl.free(e),this.callbackInfos[t]=null)}this.containCanceled=!0},e.purgeCanceled=function(){for(var t=this.callbackInfos.length-1;t>=0;--t)this.callbackInfos[t]||Kl(this.callbackInfos,t);this.containCanceled=!1},e.clear=function(){this.cancelAll(),this.callbackInfos.length=0,this.isInvoking=!1,this.containCanceled=!1},t}(),th=new ql((function(){return new $l}),16),eh=function(){function t(){this._callbackTable=Pt(!0),this._offCallback=void 0}var e=t.prototype;return e.on=function(t,e,n,i){if(!this.hasEventListener(t,e,n)){var r=this._callbackTable[t];r||(r=this._callbackTable[t]=th.alloc());var a=Zl.alloc();a.set(e,n,i),r.callbackInfos.push(a)}return e},e.hasEventListener=function(t,e,n){var i=this._callbackTable&&this._callbackTable[t];if(!i)return!1;var r=i.callbackInfos;if(!e){if(i.isInvoking){for(var a=0;a<r.length;++a)if(r[a])return!0;return!1}return r.length>0}for(var o=0;o<r.length;++o){var s=r[o];if(s&&s.check()&&s.callback===e&&s.target===n)return!0}return!1},e.removeAll=function(t){var e=typeof t;if("string"===e||"number"===e){var n=this._callbackTable&&this._callbackTable[t];n&&(n.isInvoking?n.cancelAll():(n.clear(),th.free(n),delete this._callbackTable[t]))}else if(t)for(var i in this._callbackTable){var r=this._callbackTable[i];if(r.isInvoking)for(var a=r.callbackInfos,o=0;o<a.length;++o){var s=a[o];s&&s.target===t&&r.cancel(o)}else r.removeByTarget(t)}},e.off=function(t,e,n){var i,r=this._callbackTable&&this._callbackTable[t];if(r){var a=r.callbackInfos;if(e)for(var o=0;o<a.length;++o){var s=a[o];if(s&&s.callback===e&&s.target===n){r.cancel(o);break}}else this.removeAll(t)}null===(i=this._offCallback)||void 0===i||i.call(this)},e.emit=function(t,e,n,i,r,a){var o=this._callbackTable&&this._callbackTable[t];if(o){var s=!o.isInvoking;o.isInvoking=!0;for(var c=o.callbackInfos,l=0,h=c.length;l<h;++l){var u=c[l];if(u){var _=u.callback,f=u.target;u.once&&this.off(t,_,f),u.check()?f?_.call(f,e,n,i,r,a):_(e,n,i,r,a):this.off(t,_,f)}}s&&(o.isInvoking=!1,o.containCanceled&&o.purgeCanceled())}},e.clear=function(){for(var t in this._callbackTable){var e=this._callbackTable[t];e&&(e.clear(),th.free(e),delete this._callbackTable[t])}},e._registerOffCallback=function(t){this._offCallback=t},t}();function nh(t){for(var e=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._callbackTable=Pt(!0),e}$(e,t);var n=e.prototype;return n.once=function(t,e,n){return this.on(t,e,n,!0)},n.targetOff=function(t){this.removeAll(t)},e}(t),n=eh.prototype,i=Object.getOwnPropertyNames(n).concat(Object.getOwnPropertySymbols(n)),r=0;r<i.length;++r){var a=i[r];if(!(a in e.prototype)){var o=Object.getOwnPropertyDescriptor(n,a);o&&Object.defineProperty(e.prototype,a,o)}}return e}var ih,rh,ah,oh,sh,ch,lh,hh,uh=t("EventTarget",nh((function(){})));h.EventTarget=uh,function(t){t[t.PORTRAIT=1]="PORTRAIT",t[t.PORTRAIT_UPSIDE_DOWN=2]="PORTRAIT_UPSIDE_DOWN",t[t.LANDSCAPE_LEFT=4]="LANDSCAPE_LEFT",t[t.LANDSCAPE_RIGHT=8]="LANDSCAPE_RIGHT",t[t.LANDSCAPE=12]="LANDSCAPE",t[t.AUTO=13]="AUTO"}(ih||(ih={}));var _h,fh,dh={};_h=dh,fh=wx,Object.keys(fh).forEach((function(t){"function"!=typeof fh[t]?_h[t]=fh[t]:_h[t]=fh[t].bind(fh)})),dh.wx={},dh.wx.onKeyDown=null===(rh=wx.onKeyDown)||void 0===rh?void 0:rh.bind(wx),dh.wx.onKeyUp=null===(ah=wx.onKeyUp)||void 0===ah?void 0:ah.bind(wx),dh.wx.onMouseDown=null===(oh=wx.onMouseDown)||void 0===oh?void 0:oh.bind(wx),dh.wx.onMouseMove=null===(sh=wx.onMouseMove)||void 0===sh?void 0:sh.bind(wx),dh.wx.onMouseUp=null===(ch=wx.onMouseUp)||void 0===ch?void 0:ch.bind(wx),dh.wx.onWheel=null===(lh=wx.onWheel)||void 0===lh?void 0:lh.bind(wx);var ph=wx.getSystemInfoSync();dh.testAndUpdateSystemInfoCache=function(t,e){var n=0,i=null;i=setInterval((function(){var e=wx.getSystemInfoSync();ph.screenWidth===e.screenWidth&&ph.screenHeight===e.screenHeight?++n>=t&&null!==i&&(clearInterval(i),i=null):n=0,ph=e}),e)},dh.testAndUpdateSystemInfoCache(10,500),null===(hh=dh.onWindowResize)||void 0===hh||hh.call(dh,(function(){ph=wx.getSystemInfoSync()})),dh.getSystemInfoSync=function(){return ph};var mh=dh.getSystemInfoSync();dh.isDevTool="devtools"===mh.platform,Object.defineProperty(dh,"isLandscape",{get:function(){var t=wx.getSystemInfoSync();return"string"==typeof t.deviceOrientation?t.deviceOrientation.startsWith("landscape"):t.screenWidth>t.screenHeight}});var vh,gh,yh,xh,Sh,Ah,bh,Ch,Th,Eh,wh,Ih=ih.LANDSCAPE_RIGHT;if("android"!==mh.platform.toLocaleLowerCase()&&wx.onDeviceOrientationChange((function(t){"landscape"===t.value?Ih=ih.LANDSCAPE_RIGHT:"landscapeReverse"===t.value&&(Ih=ih.LANDSCAPE_LEFT)})),Object.defineProperty(dh,"orientation",{get:function(){return dh.isLandscape?Ih:ih.PORTRAIT}}),dh.onAccelerometerChange=function(t){dh.offAccelerometerChange(),vh=function(e){var n=e.x,i=e.y;if(dh.isLandscape){var r=Ih===ih.LANDSCAPE_RIGHT?1:-1,a=n;n=-i*r,i=a*r}var o={x:n,y:i,z:e.z};t(o)}},dh.offAccelerometerChange=function(){vh&&(wx.offAccelerometerChange(vh),vh=void 0)},dh.startAccelerometer=function(t){vh&&wx.onAccelerometerChange(vh),wx.startAccelerometer(t)},dh.createInnerAudioContext=(gh=wx,yh={onPlay:!0,onPause:!0,onStop:!0,onSeek:!1},void 0===(xh=!0)&&(xh=!1),function(){var t=gh.createInnerAudioContext();if(yh.onPlay){var e=t.play,n=null;Object.defineProperty(t,"onPlay",{configurable:!0,value:function(t){n=t}}),Object.defineProperty(t,"play",{configurable:!0,value:function(){e.call(t),n&&(xh?setTimeout(n,0):n())}})}if(yh.onPause){var i=t.pause,r=null;Object.defineProperty(t,"onPause",{configurable:!0,value:function(t){r=t}}),Object.defineProperty(t,"pause",{configurable:!0,value:function(){i.call(t),r&&(xh?setTimeout(r,0):r())}})}if(yh.onStop){var a=t.stop,o=null;Object.defineProperty(t,"onStop",{configurable:!0,value:function(t){o=t}}),Object.defineProperty(t,"stop",{configurable:!0,value:function(){a.call(t),o&&(xh?setTimeout(o,0):o())}})}if(yh.onSeek){var s=t.seek,c=null;Object.defineProperty(t,"onSeeked",{configurable:!0,value:function(t){c=t}}),Object.defineProperty(t,"seek",{configurable:!0,value:function(e){s.call(t,e),c&&(xh?setTimeout(c,0):c())}})}return t}),dh.getSafeArea=function(){return wx.getSystemInfoSync().safeArea},"windows"===mh.platform&&function(t,e){var n=/\d+\.\d+\.\d+/;if(!n.test(t)||!n.test(e))return console.warn("wrong format of version when compare version"),0;for(var i=t.split(".").map((function(t){return Number.parseInt(t)})),r=e.split(".").map((function(t){return Number.parseInt(t)})),a=0;a<3;++a){var o=i[a],s=r[a];if(o!==s)return o-s}return 0}(mh.SDKVersion,"2.16.0")<0){var Ph=canvas;if(Ph){var Dh=Ph.getContext("webgl"),Rh=Dh.useProgram.bind(Dh);Dh.useProgram=function(t){t&&Rh(t)}}}!function(t){t.UNKNOWN="unknown",t.WECHAT="wechat",t.ANDROID="androidbrowser",t.IE="ie",t.EDGE="edge",t.QQ="qqbrowser",t.MOBILE_QQ="mqqbrowser",t.UC="ucbrowser",t.UCBS="ucbs",t.BROWSER_360="360browser",t.BAIDU_APP="baiduboxapp",t.BAIDU="baidubrowser",t.MAXTHON="maxthon",t.OPERA="opera",t.OUPENG="oupeng",t.MIUI="miuibrowser",t.FIREFOX="firefox",t.SAFARI="safari",t.CHROME="chrome",t.LIEBAO="liebao",t.QZONE="qzone",t.SOUGOU="sogou",t.HUAWEI="huawei"}(Sh||(Sh={})),function(t){t.UNKNOWN="unknown",t.ENGLISH="en",t.CHINESE="zh",t.FRENCH="fr",t.ITALIAN="it",t.GERMAN="de",t.SPANISH="es",t.DUTCH="du",t.RUSSIAN="ru",t.KOREAN="ko",t.JAPANESE="ja",t.HUNGARIAN="hu",t.PORTUGUESE="pt",t.ARABIC="ar",t.NORWEGIAN="no",t.POLISH="pl",t.TURKISH="tr",t.UKRAINIAN="uk",t.ROMANIAN="ro",t.BULGARIAN="bg"}(Ah||(Ah={})),function(t){t[t.NONE=0]="NONE",t[t.LAN=1]="LAN",t[t.WWAN=2]="WWAN"}(bh||(bh={})),function(t){t.UNKNOWN="Unknown",t.IOS="iOS",t.ANDROID="Android",t.WINDOWS="Windows",t.LINUX="Linux",t.OSX="OS X",t.OHOS="OHOS"}(Ch||(Ch={})),function(t){t.UNKNOWN="UNKNOWN",t.EDITOR_PAGE="EDITOR_PAGE",t.EDITOR_CORE="EDITOR_CORE",t.MOBILE_BROWSER="MOBILE_BROWSER",t.DESKTOP_BROWSER="DESKTOP_BROWSER",t.WIN32="WIN32",t.ANDROID="ANDROID",t.IOS="IOS",t.MACOS="MACOS",t.OHOS="OHOS",t.WECHAT_GAME="WECHAT_GAME",t.BAIDU_MINI_GAME="BAIDU_MINI_GAME",t.XIAOMI_QUICK_GAME="XIAOMI_QUICK_GAME",t.ALIPAY_MINI_GAME="ALIPAY_MINI_GAME",t.BYTEDANCE_MINI_GAME="BYTEDANCE_MINI_GAME",t.OPPO_MINI_GAME="OPPO_MINI_GAME",t.VIVO_MINI_GAME="VIVO_MINI_GAME",t.HUAWEI_QUICK_GAME="HUAWEI_QUICK_GAME",t.COCOSPLAY="COCOSPLAY",t.LINKSURE_MINI_GAME="LINKSURE_MINI_GAME",t.QTT_MINI_GAME="QTT_MINI_GAME"}(Th||(Th={})),function(t){t.WEBP="WEBP",t.IMAGE_BITMAP="IMAGE_BITMAP",t.WEB_VIEW="WEB_VIEW",t.VIDEO_PLAYER="VIDEO_PLAYER",t.SAFE_AREA="SAFE_AREA",t.INPUT_TOUCH="INPUT_TOUCH",t.EVENT_KEYBOARD="EVENT_KEYBOARD",t.EVENT_MOUSE="EVENT_MOUSE",t.EVENT_TOUCH="EVENT_TOUCH",t.EVENT_ACCELEROMETER="EVENT_ACCELEROMETER"}(Eh||(Eh={})),wh=Th.WECHAT_GAME;var Mh,Oh,Nh,Bh,Lh=new(function(t){function e(){var e,n;(n=t.call(this)||this).networkType=void 0,n.isNative=void 0,n.isBrowser=void 0,n.isMobile=void 0,n.isLittleEndian=void 0,n.platform=void 0,n.language=void 0,n.nativeLanguage=void 0,n.os=void 0,n.osVersion=void 0,n.osMainVersion=void 0,n.browserType=void 0,n.browserVersion=void 0,n._featureMap=void 0;var i,r=dh.getSystemInfoSync();n.networkType=bh.LAN,n.isNative=!1,n.isBrowser=!1,n.isLittleEndian=(i=new ArrayBuffer(2),new DataView(i).setInt16(0,256,!0),256===new Int16Array(i)[0]),n.nativeLanguage=r.language,n.language=r.language.substr(0,2);var a=r.platform.toLocaleLowerCase();n.os="android"===a?Ch.ANDROID:"ios"===a?Ch.IOS:"windows"===a?Ch.WINDOWS:Ch.UNKNOWN;var o=r.system.toLowerCase();"android p"===o&&(o="android p 9.0");var s=/[\d.]+/.exec(o);n.osVersion=s?s[0]:o,n.osMainVersion=parseInt(n.osVersion),n.platform=wh,n.isMobile=n.os!==Ch.WINDOWS,n.browserType=Sh.UNKNOWN,n.browserVersion="";var l,h=document.createElement("canvas");try{l=h.toDataURL("image/webp").startsWith("data:image/webp")}catch(t){l=!1}var u=n.os===Ch.WINDOWS&&!dh.isDevTool;return n._featureMap=((e={})[Eh.WEBP]=l,e[Eh.IMAGE_BITMAP]=!1,e[Eh.WEB_VIEW]=!1,e[Eh.VIDEO_PLAYER]=c,e[Eh.SAFE_AREA]=c,e[Eh.INPUT_TOUCH]=!u,e[Eh.EVENT_KEYBOARD]=u,e[Eh.EVENT_MOUSE]=u,e[Eh.EVENT_TOUCH]=!0,e[Eh.EVENT_ACCELEROMETER]=!u,e),n._registerEvent(),n}$(e,t);var n=e.prototype;return n._registerEvent=function(){var t=this;dh.onHide((function(){t.emit("hide")})),dh.onShow((function(){t.emit("show")}))},n.hasFeature=function(t){return this._featureMap[t]},n.getBatteryLevel=function(){return dh.getBatteryInfoSync().level/100},n.triggerGC=function(){dh.triggerGC()},n.openURL=function(){},n.now=function(){return Date.now?Date.now():+new Date},n.restartJSVM=function(){},n.close=function(){},e}(uh)),Fh=/(\.[^\.\/\?\\]*)(\?.*)?$/,Vh=/((.*)(\/|\\|\\\\))?(.*?\..*$)?/,zh=/[^\.\/]+\/\.\.\//;function kh(){for(var t="",e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];for(var r=0,a=n;r<a.length;r++){var o=a[r];t=(t+(""===t?"":"/")+o).replace(/(\/|\\\\)$/,"")}return t}function Uh(t){var e=Fh.exec(t);return e?e[1]:""}function Gh(t){if(t){var e=t.lastIndexOf(".");if(-1!==e)return t.substring(0,e)}return t}function Hh(t,e){var n=t.indexOf("?");n>0&&(t=t.substring(0,n));var i=/(\/|\\)([^\/\\]+)$/g.exec(t.replace(/(\/|\\)$/,""));if(!i)return t;var r=i[2];return e&&t.substring(t.length-e.length).toLowerCase()===e.toLowerCase()?r.substring(0,r.length-e.length):r}function jh(t){var e=Vh.exec(t);return e?e[2]:""}function Wh(t,e){e=e||"";var n=t.indexOf("?"),i="";return n>0&&(i=t.substring(n),t=t.substring(0,n)),(n=t.lastIndexOf("."))<0?t+e+i:t.substring(0,n)+e+i}function qh(t,e,n){if(0===e.indexOf("."))return Wh(t,e);var i=t.indexOf("?"),r="",a=n?Uh(t):"";return i>0&&(r=t.substring(i),t=t.substring(0,i)),i=(i=t.lastIndexOf("/"))<=0?0:i+1,t.substring(0,i)+e+a+r}function Xh(t){var e=t=String(t);do{e=t,t=t.replace(zh,"")}while(e.length!==t.length);return t}function Yh(t){return t.replace(/[\/\\]$/,"")}function Kh(){return Lh.os===Ch.WINDOWS?"\\":"/"}t("path",Object.freeze({__proto__:null,join:kh,extname:Uh,mainFileName:Gh,basename:Hh,dirname:jh,changeExtname:Wh,changeBasename:qh,_normalize:Xh,stripSep:Yh,getSeperator:Kh}));var Jh,Qh,Zh,$h=t("Asset",Ec("cc.Asset")((Bh=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).loaded=!0,ct(e,"_native",Nh,at(e)),e._nativeUrl="",e._file=null,e._ref=0,Object.defineProperty(at(e),"_uuid",{value:"",writable:!0}),e}$(e,t),e.deserialize=function(t){return h.deserialize(t)};var n=e.prototype;return n.toString=function(){return this.nativeUrl},n.serialize=function(){},n._setRawAsset=function(t,e){void 0===e&&(e=!0),this._native=!1!==e?t||"":"/"+t},n.addRef=function(){return this._ref++,this},n.decRef=function(t){return void 0===t&&(t=!0),this._ref>0&&this._ref--,t&&h.assetManager._releaseManager.tryRelease(this),this},n.onLoaded=function(){},n.initDefault=function(t){t&&(this._uuid=t),this.isDefault=!0},n.validate=function(){return!0},n.destroy=function(){return C(F(12101,this._uuid)),t.prototype.destroy.call(this)},Q(e,[{key:"nativeUrl",get:function(){if(!this._nativeUrl){if(!this._native)return"";var t=this._native;if(47===t.charCodeAt(0))return t.slice(1);46===t.charCodeAt(0)?this._nativeUrl=zl(this._uuid,{nativeExt:t,isNative:!0}):this._nativeUrl=zl(this._uuid,{__nativeName__:t,nativeExt:Uh(t),isNative:!0})}return this._nativeUrl}},{key:"_nativeAsset",get:function(){return this._file},set:function(t){this._file=t}},{key:"_nativeDep",get:function(){if(this._native)return{__isNative__:!0,uuid:this._uuid,ext:this._native}}},{key:"refCount",get:function(){return this._ref}}]),e}(nh(ml)),Nh=lt((Oh=Bh).prototype,"_native",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),lt(Oh.prototype,"_nativeAsset",[Dc],Object.getOwnPropertyDescriptor(Oh.prototype,"_nativeAsset"),Oh.prototype),Mh=Oh))||Mh);$h.prototype.createNode=null,h.Asset=$h;var tu=t("Script",Ec("cc.Script")(Jh=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e}($h))||Jh);h._Script=tu;var eu=t("JavaScript",Ec("cc.JavaScript")(Qh=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e}(tu))||Qh);h._JavaScript=eu;var nu,iu,ru,au,ou,su,cu,lu,hu,uu,_u,fu=t("TypeScript",Ec("cc.TypeScript")(Zh=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e}(tu))||Zh);h._TypeScript=fu;var du,pu,mu,vu,gu=new vt("Comp"),yu=ml.Flags.IsOnLoadCalled,xu=t("Component",(nu=Ec("cc.Component"),iu=Yc(),ru=cl(tu),au=Kc(),nu((_u=uu=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"node",cu,at(e)),ct(e,"_enabled",lu,at(e)),ct(e,"__prefab",hu,at(e)),e._sceneGetter=null,e._id=gu.getNewId(),e}$(e,t);var n=e.prototype;return n._getRenderScene=function(){return this._sceneGetter?this._sceneGetter():this.node.scene.renderScene},n.addComponent=function(t){return this.node.addComponent(t)},n.getComponent=function(t){return this.node.getComponent(t)},n.getComponents=function(t){return this.node.getComponents(t)},n.getComponentInChildren=function(t){return this.node.getComponentInChildren(t)},n.getComponentsInChildren=function(t){return this.node.getComponentsInChildren(t)},n.destroy=function(){return!!t.prototype.destroy.call(this)&&(this._enabled&&this.node.activeInHierarchy&&h.director._compScheduler.disableComp(this),!0)},n._onPreDestroy=function(){this.unscheduleAllCallbacks(),h.director._nodeActivator.destroyComp(this),this.node._removeComponent(this)},n._instantiate=function(t){return t||(t=h.instantiate._clone(this,this)),t&&(t.node=null),t},n.schedule=function(t,e,n,i){void 0===e&&(e=0),void 0===n&&(n=h.macro.REPEAT_FOREVER),void 0===i&&(i=0),L(t,1619),L((e=e||0)>=0,1620),n=Number.isNaN(n)?h.macro.REPEAT_FOREVER:n,i=i||0;var r=h.director.getScheduler(),a=r.isTargetPaused(this);r.schedule(t,this,e,n,i,a)},n.scheduleOnce=function(t,e){void 0===e&&(e=0),this.schedule(t,0,0,e)},n.unschedule=function(t){t&&h.director.getScheduler().unschedule(t,this)},n.unscheduleAllCallbacks=function(){h.director.getScheduler().unscheduleAllForTarget(this)},Q(e,[{key:"name",get:function(){if(this._name)return this._name;var t=Dt(this),e=t.lastIndexOf(".");return e>=0&&(t=t.slice(e+1)),this.node?this.node.name+"<"+t+">":t},set:function(t){this._name=t}},{key:"uuid",get:function(){return this._id}},{key:"__scriptAsset",get:function(){return null}},{key:"enabled",get:function(){return this._enabled},set:function(t){if(this._enabled!==t&&(this._enabled=t,this.node.activeInHierarchy)){var e=h.director._compScheduler;t?e.enableComp(this):e.disableComp(this)}}},{key:"enabledInHierarchy",get:function(){return this._enabled&&this.node&&this.node.activeInHierarchy}},{key:"_isOnLoadCalled",get:function(){return this._objFlags&yu}}]),e}(ml),uu.system=null,lt((su=_u).prototype,"__scriptAsset",[iu,ru,au,il],Object.getOwnPropertyDescriptor(su.prototype,"__scriptAsset"),su.prototype),cu=lt(su.prototype,"node",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lu=lt(su.prototype,"_enabled",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),hu=lt(su.prototype,"__prefab",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ou=su))||ou)),Su=xu.prototype;Su.update=null,Su.lateUpdate=null,Su.__preload=null,Su.onLoad=null,Su.start=null,Su.onEnable=null,Su.onDisable=null,Su.onDestroy=null,Su.onFocusInEditor=null,Su.onLostFocusInEditor=null,Su.resetInEditor=null,Su._getLocalBounds=null,Su.onRestore=null,xu._requireComponent=null,xu._executionOrder=0,Tt(xu,"_registerEditorProps",(function(t,e){var n=e.requireComponent;n&&(Array.isArray(n)&&(n=n.filter(Boolean)),t._requireComponent=n);var i=e.executionOrder;i&&"number"==typeof i&&(t._executionOrder=i)})),h.Component=xu;var Au=t("MissingScript",Ec("cc.MissingScript")(du=Gc()((vu=function(t){function e(){var e;return ct(e=t.call(this)||this,"_$erialized",mu,at(e)),e}return $(e,t),e.safeFindClass=function(t){var e=$t(t);if(e)return e;h.deserialize.reportMissingClass(t)},e.prototype.onLoad=function(){R(4600,this.node.name)},e}(xu),mu=lt((pu=vu).prototype,"_$erialized",[Nc,Lc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),du=pu))||du)||du);h._MissingScript=Au;try{var bu=Au.__values__;0!==bu.length&&"_$erialized"===bu[bu.length-1]||(A("The '_$erialized' prop in MissingScript is missing. Please contact jare."),A("    Error props: ['"+bu+"']"))}catch(Za){A("Error when checking MissingScript 5, "+Za)}var Cu=new(function(t){function e(){var e,n;return(e=t.call(this)||this).isFrameRotated=!1,e.handleResizeEvent=!0,e._cbToUpdateFrameBuffer=void 0,e._resolutionScale=1,e._isProportionalToFrame=!1,null===(n=dh.onWindowResize)||void 0===n||n.call(dh,(function(){e.emit("window-resize")})),e}$(e,t);var n=e.prototype;return n.init=function(t,e){this._cbToUpdateFrameBuffer=e,this._cbToUpdateFrameBuffer()},n.requestFullScreen=function(){return Promise.reject(new Error("request fullscreen is not supported on this platform."))},n.exitFullScreen=function(){return Promise.reject(new Error("exit fullscreen is not supported on this platform."))},Q(e,[{key:"supportFullScreen",get:function(){return!1}},{key:"isFullScreen",get:function(){return!1}},{key:"devicePixelRatio",get:function(){return dh.getSystemInfoSync().pixelRatio}},{key:"windowSize",get:function(){var t=dh.getSystemInfoSync(),e=this.devicePixelRatio,n=t.screenWidth,i=t.screenHeight;return new ri(n*e,i*e)},set:function(){R(1221)}},{key:"resolution",get:function(){var t=this.windowSize,e=this.resolutionScale;return new ri(t.width*e,t.height*e)}},{key:"resolutionScale",get:function(){return this._resolutionScale},set:function(t){var e;t!==this._resolutionScale&&(this._resolutionScale=t,null===(e=this._cbToUpdateFrameBuffer)||void 0===e||e.call(this))}},{key:"orientation",get:function(){return dh.orientation},set:function(){console.warn("Setting orientation is not supported yet.")}},{key:"safeAreaEdge",get:function(){var t=dh.getSafeArea(),e=this.windowSize,n=this.devicePixelRatio,i=t.top*n,r=e.height-t.bottom*n,a=t.left*n,o=e.width-t.right*n;return this.orientation===ih.PORTRAIT?i<r?i=r:r=i:a<o?a=o:o=a,{top:i,bottom:r,left:a,right:o}}},{key:"isProportionalToFrame",get:function(){return this._isProportionalToFrame},set:function(){}}]),e}(uh)),Tu=function(){function t(){}var e=t.prototype;return e._init=function(t){Cu.init(t,(function(){var t,e=h.director;(null===(t=e.root)||void 0===t?void 0:t.pipeline)?e.root.pipeline.pipelineSceneData.shadingScale=Cu.resolutionScale:R(1220)}))},e.fullScreen=function(){return Cu.isFullScreen},e.requestFullScreen=function(t,e,n){return arguments.length>0&&R(1400,"screen.requestFullScreen(element, onFullScreenChange?, onFullScreenError?)","screen.requestFullScreen(): Promise"),Cu.requestFullScreen().then((function(){null==e||e()})).catch((function(t){console.error(t),null==n||n()}))},e.exitFullScreen=function(){return Cu.exitFullScreen()},e.autoFullScreen=function(t,e){var n;null===(n=this.requestFullScreen(t,e))||void 0===n||n.catch((function(){}))},e.disableAutoFullScreen=function(){},Q(t,[{key:"devicePixelRatio",get:function(){return Cu.devicePixelRatio}},{key:"windowSize",get:function(){return Cu.windowSize},set:function(t){Cu.windowSize=t}},{key:"resolution",get:function(){return Cu.resolution}},{key:"supportsFullScreen",get:function(){return Cu.supportFullScreen}}]),t}(),Eu=t("screen",new Tu);h.screen=Eu;var wu=t("sys",{Feature:Eh,hasFeature:function(t){return Lh.hasFeature(t)},NetworkType:bh,Language:Ah,OS:Ch,Platform:Th,BrowserType:Sh,isNative:Lh.isNative,isBrowser:Lh.isBrowser,isMobile:Lh.isMobile,isLittleEndian:Lh.isLittleEndian,platform:Lh.platform,language:Lh.language,languageCode:Lh.nativeLanguage,os:Lh.os,osVersion:Lh.osVersion,osMainVersion:Lh.osMainVersion,browserType:Lh.browserType,browserVersion:Lh.browserVersion,windowPixelResolution:Eu.windowSize,capabilities:{canvas:!0,opengl:!0,webp:Lh.hasFeature(Eh.WEBP),imageBitmap:Lh.hasFeature(Eh.IMAGE_BITMAP),touches:Lh.hasFeature(Eh.INPUT_TOUCH),mouse:Lh.hasFeature(Eh.EVENT_MOUSE),keyboard:Lh.hasFeature(Eh.EVENT_KEYBOARD),accelerometer:Lh.hasFeature(Eh.EVENT_ACCELEROMETER)},localStorage:{},getNetworkType:function(){return Lh.networkType},getBatteryLevel:function(){return Lh.getBatteryLevel()},garbageCollect:function(){Lh.triggerGC()},isObjectValid:function(t){return null!=t},dump:function(){var t="";t+="isMobile : "+this.isMobile+"\r\n",t+="language : "+this.language+"\r\n",t+="browserType : "+this.browserType+"\r\n",t+="browserVersion : "+this.browserVersion+"\r\n",t+="capabilities : "+JSON.stringify(this.capabilities)+"\r\n",t+="os : "+this.os+"\r\n",t+="osVersion : "+this.osVersion+"\r\n",t+="platform : "+this.platform+"\r\n",x(t+="Using "+(h.game.renderType===h.game.RENDER_TYPE_WEBGL?"WEBGL":"CANVAS")+" renderer.\r\n")},openURL:function(t){Lh.openURL(t)},now:function(){return Lh.now()},restartVM:function(){Lh.restartJSVM()},getSafeAreaRect:function(){var t=h.view,e=Cu.safeAreaEdge,n=Cu.windowSize,i=new Qn(e.left,e.bottom),r=new Qn(n.width-e.right,n.height-e.top);t._convertToUISpace(i),t._convertToUISpace(r);var a=i.x,o=i.y,s=r.x-i.x,c=r.y-i.y;return new oi(a,o,s,c)}});!function(){try{var t=wu.localStorage=window.localStorage;t.setItem("storage",""),t.removeItem("storage"),t=null}catch(t){var e=function(){R(5200)};wu.localStorage={getItem:e,setItem:e,clear:e,removeItem:e}}var n;wu.__isWebIOS14OrIPadOS14Env=(wu.os===Ch.IOS||wu.os===Ch.OSX)&&(null===(n=GameGlobal)||void 0===n?void 0:n.isIOSHighPerformanceMode)&&/(OS 1[4-9])|(Version\/1[4-9])/.test(window.navigator.userAgent)}(),h.sys=wu;var Iu=t("serializeTag",Symbol("[[Serialize]]")),Pu=t("deserializeTag",Symbol("[[Deserialize]]")),Du=function(){function t(t,e){this._document=void 0,this._chunks=void 0,this._document=t,this._chunks=e}return Q(t,[{key:"document",get:function(){return this._document}},{key:"chunks",get:function(){return this._chunks}}]),t}();function Ru(t){var e=t;return{chunks:e.chunks,document:e.document}}function Mu(t){if(t.length<16)throw new Ou(F(13102));var e=new DataView(t.buffer,t.byteOffset,t.byteLength);if(1313817411!==e.getUint32(0,!0))throw new Ou(F(13100));var n=e.getUint32(4,!0);if(1!==n)throw new Ou(F(13101,n));if(e.getUint32(8,!0)!==e.byteLength)throw new Ou(F(13102));var i=12,r=e.getUint32(i,!0);i+=4;var a=new Uint8Array(e.buffer,i+e.byteOffset,r);i+=r;var o,s=function(t){if("undefined"!=typeof TextDecoder)return(new TextDecoder).decode(t);if("Buffer"in globalThis)return globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString();throw new Error(F(13104))}(a);try{o=JSON.parse(s)}catch(t){throw new Ou(t)}for(var c=[];i<e.byteLength;){i%8!=0&&(i+=8-i%8);var l=e.getUint32(i,!0);i+=4,c.push(new Uint8Array(e.buffer,i+e.byteOffset,l)),i+=l}if(i!==e.byteLength)throw new Ou(F(13102));return new Du(o,c)}var Ou=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e}(rt(Error));!function(){function t(){this._viewOrPaddings=[],this._length=0}var e=t.prototype;e.alignAs=function(t){if(0!==t){var e=this._length%t;if(0!==e){var n=t-e;return this._viewOrPaddings.push(n),this._length+=n,n}}return 0},e.append=function(t){var e=this._length;return this._viewOrPaddings.push(t),this._length+=t.byteLength,e},e.get=function(){var t=new Uint8Array(this._length),e=0;return this._viewOrPaddings.forEach((function(n){"number"==typeof n?e+=n:(t.set(new Uint8Array(n.buffer,n.byteOffset,n.byteLength),e),e+=n.byteLength)})),t},Q(t,[{key:"byteLength",get:function(){return this._length}}])}(),h.internal.parseCCONJson=Ru,h.internal.decodeCCONBinary=Mu,h.internal.CCON=Du;var Nu="$_$default",Bu="$_$formerlySerializedAs",Lu=function(t){function e(){return t.call(this,(function(t){t.clear()}),1)||this}return $(e,t),e.prototype.get=function(t,e,n,i,r){var a=this._get();return a?(a.reset(t,e,n,i,r),a):new Fu(t,e,n,i,r)},e}(ne),Fu=function(){function t(t,e,n,i){this.deserializedList=void 0,this.deserializedData=void 0,this._ignoreEditorOnly=void 0,this.result=t,this.customEnv=i,this.deserializedList=[],this.deserializedData=null,this._classFinder=e,this._reportMissingClass=n,this._onDereferenced=null==e?void 0:e.onDereferenced}var e=t.prototype;return e.reset=function(t,e,n,i){this.result=t,this.customEnv=i,this._classFinder=e,this._reportMissingClass=n,this._onDereferenced=null==e?void 0:e.onDereferenced},e.clear=function(){this.result=null,this.customEnv=null,this.deserializedList.length=0,this.deserializedData=null,this._classFinder=null,this._reportMissingClass=null,this._onDereferenced=null},e.deserialize=function(t){var e,n=!1;t instanceof Du?(n=!0,e=t.document,t.chunks.length>0&&(t.chunks.length,this._mainBinChunk=t.chunks[0])):e=t,this._serializedData=e,this._context={fromCCON:n};var i=Array.isArray(e)?e[0]:e;return this.deserializedData=this._deserializeObject(i,0),this._serializedData=void 0,this._mainBinChunk=void 0,this._context=void 0,this.deserializedData},e._deserializeObject=function(t,e,n,i){switch(t.__type__){case"TypedArray":return this._deserializeTypedArrayView(t);case"TypedArrayRef":return this._deserializeTypedArrayViewRef(t);default:return t.__type__?this._deserializeTypeTaggedObject(t,e,n,i):Array.isArray(t)?this._deserializeArray(t):this._deserializePlainObject(t)}},e._deserializeTypedArrayView=function(t){return globalThis[t.ctor].from(t.array)},e._deserializeTypedArrayViewRef=function(t){var e=t.offset,n=t.length,i=t.ctor;return new globalThis[i](this._mainBinChunk.buffer,this._mainBinChunk.byteOffset+e,n)},e._deserializeArray=function(t){for(var e,n=new Array(t.length),i=0;i<t.length;i++)"object"==typeof(e=t[i])&&e?this._deserializeAndAssignField(n,e,""+i)&&(n[i]=null):n[i]=e;return n},e._deserializePlainObject=function(t){var e={};return this._fillPlainObject(e,t),e},e._deserializeTypeTaggedObject=function(t,e,n,i){var r=this,a=t.__type__,o=this._classFinder(a,t,n,i);if(!o)return this._classFinder===$t&&this._reportMissingClass(a),null;var s=function(t){var n=new t;return e>=0&&(r.deserializedList[e]=n),n}(o);return this._deserializeInto(t,s,o),s},e._deserializeInto=function(t,e,n,i){void 0===i&&(i=!1),i||!e[Pu]?e._deserialize?e._deserialize(t.content,this):h.Class._isCCClass(n)?this._deserializeFireClass(e,t,n):this._deserializeFastDefinedObject(e,t,n):this._runCustomizedDeserialize(t,e,n)},e._runCustomizedDeserialize=function(t,e,n){var i=this,r={readProperty:function(e){var n=t[e];return"object"==typeof n&&n?i._deserializeObjectField(n):n},readThis:function(){i._deserializeInto(t,e,n,!0)},readSuper:function(){var r=Gt(n);r&&i._deserializeInto(t,e,r)}};e[Pu](r,this._context)},e._deserializeFireClass=function(t,e,n){var i;if(n.hasOwnProperty("__deserialize__"))i=n.__deserialize__;else{i=function(t,e){var n=fe.test(ee(e)),i=Ht(e,h._BaseNode)||Ht(e,h.Component),r=!1,a=[],o=a,s=[],c=s,l=[];return function(){var t=e.__values__;r="_$erialized"===t[t.length-1];for(var i=Re(e),u=0;u<t.length;u++){var _=t[u],f=_;i[_+Bu]&&(f=i[_+Bu]);var d=en.getDefault(i[_+Nu]),p=!1;if(n){var m=i[_+"$_$type"];if(void 0===d&&m)p=m instanceof Oe;else{var v=typeof d;p="string"===v||"number"===v||"boolean"===v}}n&&p?(f!==_&&o===a&&(o=a.slice()),a.push(_),o!==a&&o.push(f)):(f!==_&&c===s&&(c=s.slice()),s.push(_),c!==s&&c.push(f),l.push(d instanceof h.ValueType&&d.constructor))}}(),function(t,e,h){for(var u=0;u<a.length;++u){var _=h[o[u]];void 0!==_&&(e[a[u]]=_)}for(var f=0;f<s.length;++f){var d=s[f],p=h[c[f]];if(void 0!==p)if(n||"object"==typeof p){var m=l[f];m?n||p?t._deserializeFastDefinedObject(e[d],p,m):e[d]=null:p?t._deserializeAndAssignField(e,p,d):e[d]=null}else e[d]=p}i&&h._id&&(e._id=h._id),r&&(e._$erialized=JSON.parse(JSON.stringify(h)),t._fillPlainObject(e._$erialized,h))}}(0,n);try{if(n===Au){var r=n.__values__;0!==r.length&&"_$erialized"===r[r.length-1]||(A("The '_$erialized' prop of MissingScript is missing. Will force the raw data to be save."),A("    Error props: ['"+r+"']. Please contact jare."));var a=i;i=function(t,e,n,i){a(t,e,n,i),e._$erialized||A("Unable to stash previously serialized data. "+JSON.stringify(n))}}}catch(t){A("Error when checking MissingScript 6, "+t)}Tt(n,"__deserialize__",i,!0)}i(this,t,e,n)},e._deserializeAndAssignField=function(t,e,n){var i=e.__id__;if("number"==typeof i){var r=this.deserializedList[i];if(r)t[n]=r;else{var a,o=this._serializedData[i];t[n]=this._deserializeObject(o,i,void 0,n),null===(a=this._onDereferenced)||void 0===a||a.call(this,this.deserializedList,i,t,n)}}else{var s=e.__uuid__;if(s){var c=e.__expectedType__;this.result.push(t,n,s,c)}else t[n]=this._deserializeObject(e,-1)}return!1},e._deserializeObjectField=function(t){var e=t.__id__;if("number"==typeof e){var n=this.deserializedList[e];if(n)return n;var i=this._serializedData[e];return this._deserializeObject(i,e,void 0,void 0)}if(t.__uuid__)throw t.__expectedType__,new Error("Asset reference field serialization is currently not supported in custom serialization.");return this._deserializeObject(t,-1)},e._fillPlainObject=function(t,e){for(var n in e)if(e.hasOwnProperty(n)){var i=e[n];"object"!=typeof i?"__type__"!==n&&(t[n]=i):i?this._deserializeAndAssignField(t,i,n)&&(t[n]=null):t[n]=null}},e._deserializeFastDefinedObject=function(t,e,n){if(n===h.Vec2)return t.x=e.x||0,void(t.y=e.y||0);if(n===h.Vec3)return t.x=e.x||0,t.y=e.y||0,void(t.z=e.z||0);if(n!==h.Color){if(n===h.Size)return t.width=e.width||0,void(t.height=e.height||0);for(var i=Re(n),r=n.__values__,a=0;a<r.length;a++){var o=r[a],s=e[o];void 0!==s||e.hasOwnProperty(o)||(s=en.getDefault(i[o+Nu])),"object"!=typeof s?t[o]=s:s?this._deserializeAndAssignField(t,s,o):t[o]=null}}else{t.r=e.r||0,t.g=e.g||0,t.b=e.b||0;var c=e.a;t.a=void 0===c?255:c}},t}();Fu.pool=new Lu;var Vu=[Qn,Mn,ei,zn,Dn,ri,oi,Xn];function zu(t,e){t.x=e[1],t.y=e[2],t.z=e[3],t.w=e[4]}var ku=[function(t,e){t.x=e[1],t.y=e[2]},function(t,e){t.x=e[1],t.y=e[2],t.z=e[3]},zu,zu,function(t,e){t._val=e[1]},function(t,e){t.width=e[1],t.height=e[2]},function(t,e){t.x=e[1],t.y=e[2],t.width=e[3],t.height=e[4]},function(t,e){Xn.fromArray(t,e,1)}],Uu=t("Details",function(){function t(){this.uuidObjList=null,this.uuidPropList=null,this.uuidList=null,this.uuidTypeList=[]}var e=t.prototype;return e.init=function(t){t?(this.uuidObjList=t[8],this.uuidPropList=t[9],this.uuidList=t[10]):this.uuidList||(this.uuidList=[],this.uuidObjList=[],this.uuidPropList=[],this.uuidTypeList=[])},e.reset=function(){this.uuidList&&(this.uuidList.length=0,this.uuidObjList.length=0,this.uuidPropList.length=0,this.uuidTypeList.length=0)},e.push=function(t,e,n,i){this.uuidObjList.push(t),this.uuidPropList.push(e),this.uuidList.push(n),this.uuidTypeList.push(i||"")},t}());function Gu(t,e){for(var n=t[4][e[0]],i=n[0],r=new(0,i[0]),a=i[1],o=i[2],s=n[n.length-1],c=1;c<s;++c)r[a[n[c]]]=e[c];for(;c<e.length;++c){var l=a[n[c]],h=i[n[c]+o];(0,Yu[h])(t,r,l,e[c])}return r}function Hu(t,e,n){var i=new e;return i._deserialize?i._deserialize(n,t[0]):O(5303,Dt(e)),i}function ju(t,e,n,i){i>=0?e[n]=t[5][i]:t[7][3*~i]=e}function Wu(t){return function(e,n,i,r){n[i]=r;for(var a=0;a<r.length;++a)t(e,r,a,r[a])}}function qu(t,e,n,i){e[n]=null,t[8][i]=e}function Xu(t,e,n,i){e[n]=Gu(t,i)}Uu.pool=new ne((function(t){t.reset()}),5),Uu.pool.get=function(){return this._get()||new Uu};var Yu=new Array(13);function Ku(t,e,n){return t||n(e),Object}function Ju(t,e,n,i,r,a,o){var s=t(e);if(!s){if(r)return void(n[i]=function(e,n,i){return function(){var r=t(i)||Ku(a,i,o);return e[n]=r,new r}}(n,i,e));s=Ku(a,e,o)}n[i]=s}function Qu(t,e,n,i){for(var r=n||$t,a=t[3],o=0;o<a.length;++o){var s=a[o];"string"!=typeof s?Ju(r,s[0],s,0,e,n,i):Ju(r,s,a,o,e,n,i)}}function Zu(t){var e=t[4];if(e)for(var n=t[3],i=0;i<e.length;++i){var r=e[i];r[0]=n[r[0]]}}function $u(t,e,n){"string"==typeof t&&(t=JSON.parse(t));var i,r=!e;if(e=e||Uu.pool.get(),function(t){if(Array.isArray(t)){var e=t[0];return"number"==typeof e||e instanceof t_}return!1}(t)){e.init(t),n=n||{};var a,o=t[0],s=!1;if("object"==typeof o&&(s=o.preprocessed,o=o.version),o<1)throw new Error(F(5304,o));n._version=o,n.result=e,t[0]=n,s||(Qu(t,!1,n.classFinder,null!==(a=n.reportMissingClass)&&void 0!==a?a:$u.reportMissingClass),Zu(t)),h.game._isCloning=!0;var c=t[5],l=function(t){var e=t[5],n=t[6],i=0===n?0:n.length,r=e[e.length-1],a=e.length-i;"number"!=typeof r?r=0:(r<0&&(r=~r),--a);for(var o=0;o<a;++o)e[o]=Gu(t,e[o]);for(var s=t[3],c=0;c<i;++c,++o){var l=n[c],h=e[o];if(l>=0){var u=s[l];e[o]=Hu(t,u,h)}else(0,Yu[l=~l])(t,e,o,h)}return r}(t);h.game._isCloning=!1,t[7]&&function(t,e,n){for(var i=t.length-1,r=0,a=3*t[i];r<a;r+=3){var o=t[r],s=e[t[r+2]],c=t[r+1];c>=0?o[n[c]]=s:o[~c]=s}for(;r<i;r+=3){var l=e[t[r]],h=e[t[r+2]],u=t[r+1];u>=0?l[n[u]]=h:l[~u]=h}}(t[7],c,t[2]),function(t){for(var e=t[5],n=t[2],i=t[1],r=t[8],a=t[9],o=t[10],s=0;s<r.length;++s){var c=r[s];"number"==typeof c&&(r[s]=e[c]);var l=a[s];"number"==typeof l&&(l=l>=0?n[l]:~l,a[s]=l);var h=o[s];"number"==typeof h&&(o[s]=i[h])}}(t),i=c[l]}else i=function(t,e,n){var i,r=(n=n||{}).classFinder||$t,a=n.createAssetRefs||wu.platform===Th.EDITOR_CORE,o=n.customEnv,s=n.ignoreEditorOnly,c=null!==(i=n.reportMissingClass)&&void 0!==i?i:h.deserialize.reportMissingClass;e.init();var l=Fu.pool.get(e,r,c,o,s);h.game._isCloning=!0;var u=l.deserialize(t);return h.game._isCloning=!1,Fu.pool.put(l),a&&e.assignAssetsBy(EditorExtends.serialize.asAsset),u}(t,e,n);return r&&Uu.pool.put(e),i}Yu[0]=function(t,e,n,i){e[n]=i},Yu[1]=ju,Yu[2]=Wu(ju),Yu[3]=Wu(qu),Yu[4]=Xu,Yu[5]=function(t,e,n,i){ku[i[0]](e[n],i)},Yu[6]=qu,Yu[7]=function(t,e,n,i){e[n].set(i)},Yu[8]=function(t,e,n,i){var r=new Vu[i[0]];ku[i[0]](r,i),e[n]=r},Yu[9]=Wu(Xu),Yu[10]=function(t,e,n,i){var r=t[3][i[0]];e[n]=Hu(t,r,i[1])},Yu[11]=function(t,e,n,i){var r=i[0];e[n]=r;for(var a=1;a<i.length;a+=3){var o=i[a],s=i[a+1],c=i[a+2];(0,Yu[s])(t,r,o,c)}},Yu[12]=function(t,e,n,i){var r=i[0];e[n]=r;for(var a=0;a<r.length;++a){var o=r[a],s=i[a+1];0!==s&&(0,Yu[s])(t,r,a,o)}},$u.Details=Uu,$u.reportMissingClass=function(t){O(5302,t)};var t_=function(t){this.preprocessed=!0,this.version=t};function e_(t,e,n){return[1,0,0,[t],0,n?[e,-1]:[e],[0],0,[],[],[]]}h.deserialize=$u;var n_,i_,r_,a_,o_,s_,c_,l_,h_,u_,__,f_=ml.Flags.Destroyed,d_=ml.Flags.PersistentMask,p_=[];function m_(t){var e;if(t instanceof ml){if(t._instantiate)return h.game._isCloning=!0,e=t._instantiate(null,!0),h.game._isCloning=!1,e;if(t instanceof h.Asset)throw new TypeError(F(6903))}return h.game._isCloning=!0,e=v_(t),h.game._isCloning=!1,e}function v_(t,e){var n;g_(t,n=t._iN$t?t._iN$t:t.constructor?new(0,t.constructor):Object.create(null),e);for(var i=0,r=p_.length;i<r;++i)p_[i]._iN$t=null;return p_.length=0,n}function g_(t,e,n){re.value(t,"_iN$t",e,!0),p_.push(t);var i=t.constructor;if(nn(i))!function(t,e,n,i){for(var r=t.__values__,a=0;a<r.length;a++){var o=r[a],s=e[o];if("object"==typeof s&&s){var c=n[o];c instanceof ue&&c.constructor===s.constructor?c.set(s):n[o]=s._iN$t||y_(s,i)}else n[o]=s}}(i,t,e,n);else for(var r in t)if(t.hasOwnProperty(r)&&(95!==r.charCodeAt(0)||95!==r.charCodeAt(1)||"__type__"===r||"__prefab"===r)){var a=t[r];if("object"==typeof a&&a){if(a===e)continue;e[r]=a._iN$t||y_(a,n)}else e[r]=a}t instanceof ml&&(e._objFlags&=d_)}function y_(t,e){if(t instanceof ue)return t.clone();if(t instanceof h.Asset)return t;var n;if(ArrayBuffer.isView(t)){var i=t.length;n=new t.constructor(i),t._iN$t=n,p_.push(t);for(var r=0;r<i;++r)n[r]=t[r];return n}if(Array.isArray(t)){var a=t.length;n=new Array(a),t._iN$t=n,p_.push(t);for(var o=0;o<a;++o){var s=t[o];n[o]="object"==typeof s&&s?s._iN$t||y_(s,e):s}return n}if(t._objFlags&f_)return null;var c=t.constructor;if(nn(c)){if(e)if(e instanceof h.Component){if(t instanceof h._BaseNode||t instanceof h.Component)return t}else if(e instanceof h._BaseNode)if(t instanceof h._BaseNode){if(!t.isChildOf(e))return t}else if(t instanceof h.Component&&t.node&&!t.node.isChildOf(e))return t;n=new c}else if(c===Object)n={};else{if(c)return t;n=Object.create(null)}return g_(t,n,e),n}function x_(t,e){return(e<<3)+t}function S_(t){return b_[t]}function A_(t){switch(t){case u_.Uint8:return Uint8Array;case u_.Uint16:return Uint16Array;case u_.Uint32:return Uint32Array;case u_.Int8:return Int8Array;case u_.Int16:return Int16Array;case u_.Int32:return Int32Array;case u_.Float32:return Float32Array;case u_.Float64:return Float64Array}}m_._clone=v_,h.instantiate=m_,function(t){t[t.Uint8=0]="Uint8",t[t.Uint16=1]="Uint16",t[t.Uint32=2]="Uint32",t[t.Int8=3]="Int8",t[t.Int16=4]="Int16",t[t.Int32=5]="Int32",t[t.Float32=6]="Float32",t[t.Float64=7]="Float64"}(u_||(u_={})),function(t){t[t.Scalar=0]="Scalar",t[t.Vec2=1]="Vec2",t[t.Vec3=2]="Vec3",t[t.Vec4=3]="Vec4",t[t.Quat=4]="Quat",t[t.Mat4=5]="Mat4"}(__||(__={})),t("CompactValueTypeArray",Ec("cc.CompactValueTypeArray")((l_=c_=function(){function t(){ct(this,"_byteOffset",r_,this),ct(this,"_unitCount",a_,this),ct(this,"_unitElement",o_,this),ct(this,"_length",s_,this)}return t.lengthFor=function(t,e,n){return S_(e).requiredUnits*t.length*A_(n).BYTES_PER_ELEMENT},t.compress=function(e,n,i,r,a,o){for(var s=S_(n),c=A_(i),l=s.requiredUnits*e.length,h=new c(r,a,l),u=0;u<e.length;++u)s.compress(h,u,e[u]);var _=new t;return _._unitElement=x_(i,n),_._byteOffset=o,_._unitCount=l,_._length=e.length,_},t.prototype.decompress=function(t){for(var e,n={storageUnit:7&(e=this._unitElement),elementType:e>>3},i=n.storageUnit,r=S_(n.elementType),a=new(A_(i))(t,this._byteOffset,this._unitCount),o=new Array(this._length),s=0;s<this._length;++s)o[s]=r.decompress(a,s);return o},t}(),c_.StorageUnit=u_,c_.ElementType=__,r_=lt((i_=l_).prototype,"_byteOffset",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),a_=lt(i_.prototype,"_unitCount",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),o_=lt(i_.prototype,"_unitElement",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return x_(u_.Uint8,__.Scalar)}}),s_=lt(i_.prototype,"_length",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),n_=i_))||n_);var b_=((h_={})[__.Scalar]={requiredUnits:1,compress:function(t,e,n){t[e]=n},decompress:function(t,e){return t[e]}},h_[__.Vec2]={requiredUnits:2,compress:function(t,e,n){t[2*e]=n.x,t[2*e+1]=n.y},decompress:function(t,e){return new Mn(t[2*e],t[2*e+1])}},h_[__.Vec3]={requiredUnits:3,compress:function(t,e,n){t[3*e]=n.x,t[3*e+1]=n.y,t[3*e+2]=n.z},decompress:function(t,e){return new Mn(t[3*e],t[3*e+1],t[3*e+2])}},h_[__.Vec4]={requiredUnits:4,compress:function(t,e,n){t[4*e]=n.x,t[4*e+1]=n.y,t[4*e+2]=n.z,t[4*e+3]=n.w},decompress:function(t,e){return new ei(t[4*e],t[4*e+1],t[4*e+2],t[4*e+3])}},h_[__.Quat]={requiredUnits:4,compress:function(t,e,n){t[4*e]=n.x,t[4*e+1]=n.y,t[4*e+2]=n.z,t[4*e+3]=n.w},decompress:function(t,e){return new zn(t[4*e],t[4*e+1],t[4*e+2],t[4*e+3])}},h_[__.Mat4]={requiredUnits:16,compress:function(t,e,n){Xn.toArray(t,n,16*e)},decompress:function(t,e){return Xn.fromArray(new Xn,t,16*e)}},h_);function C_(){return 0}function T_(t){return t}function E_(t){return t*t}function w_(t){return t*(2-t)}function I_(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}function P_(t){return t*t*t}function D_(t){return--t*t*t+1}function R_(t){return(t*=2)<1?.5*t*t*t:.5*((t-=2)*t*t+2)}function M_(t){return t*t*t*t}function O_(t){return 1- --t*t*t*t}function N_(t){return(t*=2)<1?.5*t*t*t*t:-.5*((t-=2)*t*t*t-2)}function B_(t){return t*t*t*t*t}function L_(t){return--t*t*t*t*t+1}function F_(t){return(t*=2)<1?.5*t*t*t*t*t:.5*((t-=2)*t*t*t*t+2)}function V_(t){return 1===t?1:1-Math.cos(t*Math.PI/2)}function z_(t){return Math.sin(t*Math.PI/2)}function k_(t){return.5*(1-Math.cos(Math.PI*t))}function U_(t){return 0===t?0:Math.pow(1024,t-1)}function G_(t){return 1===t?1:1-Math.pow(2,-10*t)}function H_(t){return 0===t?0:1===t?1:(t*=2)<1?.5*Math.pow(1024,t-1):.5*(2-Math.pow(2,-10*(t-1)))}function j_(t){return 1-Math.sqrt(1-t*t)}function W_(t){return Math.sqrt(1- --t*t)}function q_(t){return(t*=2)<1?-.5*(Math.sqrt(1-t*t)-1):.5*(Math.sqrt(1-(t-=2)*t)+1)}function X_(t){var e,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=.4*Math.asin(1/n)/(2*Math.PI),-n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4))}function Y_(t){var e,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=.4*Math.asin(1/n)/(2*Math.PI),n*Math.pow(2,-10*t)*Math.sin(2*(t-e)*Math.PI/.4)+1)}function K_(t){var e,n=.1;return 0===t?0:1===t?1:(!n||n<1?(n=1,e=.1):e=.4*Math.asin(1/n)/(2*Math.PI),(t*=2)<1?n*Math.pow(2,10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*-.5:n*Math.pow(2,-10*(t-=1))*Math.sin(2*(t-e)*Math.PI/.4)*.5+1)}function J_(t){if(1===t)return 1;var e=1.70158;return t*t*((e+1)*t-e)}function Q_(t){if(0===t)return 0;var e=1.70158;return--t*t*((e+1)*t+e)+1}function Z_(t){var e=2.5949095;return(t*=2)<1?t*t*((e+1)*t-e)*.5:.5*((t-=2)*t*((e+1)*t+e)+2)}function $_(t){return 1-tf(1-t)}function tf(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}function ef(t){return t<.5?.5*$_(2*t):.5*tf(2*t-1)+.5}function nf(t){return t<=0?0:t>=1?1:t*t*(3-2*t)}function rf(t){return t<=0?0:t>=1?1:t*t*t*(t*(6*t-15)+10)}h._decorator=fl;var af=pf(E_,w_),of=pf(P_,D_),sf=pf(M_,O_),cf=pf(B_,L_),lf=pf(V_,z_),hf=pf(U_,G_),uf=pf(j_,W_),_f=pf(X_,Y_),ff=pf(J_,Q_),df=pf($_,tf);function pf(t,e){return function(n){return n<.5?e(2*n)/2:t(2*n-1)/2+.5}}var mf,vf,gf=Object.freeze({__proto__:null,constant:C_,linear:T_,quadIn:E_,quadOut:w_,quadInOut:I_,cubicIn:P_,cubicOut:D_,cubicInOut:R_,quartIn:M_,quartOut:O_,quartInOut:N_,quintIn:B_,quintOut:L_,quintInOut:F_,sineIn:V_,sineOut:z_,sineInOut:k_,expoIn:U_,expoOut:G_,expoInOut:H_,circIn:j_,circOut:W_,circInOut:q_,elasticIn:X_,elasticOut:Y_,elasticInOut:K_,backIn:J_,backOut:Q_,backInOut:Z_,bounceIn:$_,bounceOut:tf,bounceInOut:ef,smooth:nf,fade:rf,quadOutIn:af,cubicOutIn:of,quartOutIn:sf,quintOutIn:cf,sineOutIn:lf,expoOutIn:hf,circOutIn:uf,elasticOutIn:_f,backOutIn:ff,bounceOutIn:df});t("easing",gf),function(t){t[t.LINEAR=0]="LINEAR",t[t.CONSTANT=1]="CONSTANT",t[t.QUAD_IN=2]="QUAD_IN",t[t.QUAD_OUT=3]="QUAD_OUT",t[t.QUAD_IN_OUT=4]="QUAD_IN_OUT",t[t.QUAD_OUT_IN=5]="QUAD_OUT_IN",t[t.CUBIC_IN=6]="CUBIC_IN",t[t.CUBIC_OUT=7]="CUBIC_OUT",t[t.CUBIC_IN_OUT=8]="CUBIC_IN_OUT",t[t.CUBIC_OUT_IN=9]="CUBIC_OUT_IN",t[t.QUART_IN=10]="QUART_IN",t[t.QUART_OUT=11]="QUART_OUT",t[t.QUART_IN_OUT=12]="QUART_IN_OUT",t[t.QUART_OUT_IN=13]="QUART_OUT_IN",t[t.QUINT_IN=14]="QUINT_IN",t[t.QUINT_OUT=15]="QUINT_OUT",t[t.QUINT_IN_OUT=16]="QUINT_IN_OUT",t[t.QUINT_OUT_IN=17]="QUINT_OUT_IN",t[t.SINE_IN=18]="SINE_IN",t[t.SINE_OUT=19]="SINE_OUT",t[t.SINE_IN_OUT=20]="SINE_IN_OUT",t[t.SINE_OUT_IN=21]="SINE_OUT_IN",t[t.EXPO_IN=22]="EXPO_IN",t[t.EXPO_OUT=23]="EXPO_OUT",t[t.EXPO_IN_OUT=24]="EXPO_IN_OUT",t[t.EXPO_OUT_IN=25]="EXPO_OUT_IN",t[t.CIRC_IN=26]="CIRC_IN",t[t.CIRC_OUT=27]="CIRC_OUT",t[t.CIRC_IN_OUT=28]="CIRC_IN_OUT",t[t.CIRC_OUT_IN=29]="CIRC_OUT_IN",t[t.ELASTIC_IN=30]="ELASTIC_IN",t[t.ELASTIC_OUT=31]="ELASTIC_OUT",t[t.ELASTIC_IN_OUT=32]="ELASTIC_IN_OUT",t[t.ELASTIC_OUT_IN=33]="ELASTIC_OUT_IN",t[t.BACK_IN=34]="BACK_IN",t[t.BACK_OUT=35]="BACK_OUT",t[t.BACK_IN_OUT=36]="BACK_IN_OUT",t[t.BACK_OUT_IN=37]="BACK_OUT_IN",t[t.BOUNCE_IN=38]="BOUNCE_IN",t[t.BOUNCE_OUT=39]="BOUNCE_OUT",t[t.BOUNCE_IN_OUT=40]="BOUNCE_IN_OUT",t[t.BOUNCE_OUT_IN=41]="BOUNCE_OUT_IN",t[t.SMOOTH=42]="SMOOTH",t[t.FADE=43]="FADE"}(vf||(vf={}));var yf,xf=((mf={})[vf.CONSTANT]=C_,mf[vf.LINEAR]=T_,mf[vf.QUAD_IN]=E_,mf[vf.QUAD_OUT]=w_,mf[vf.QUAD_IN_OUT]=I_,mf[vf.QUAD_OUT_IN]=af,mf[vf.CUBIC_IN]=P_,mf[vf.CUBIC_OUT]=D_,mf[vf.CUBIC_IN_OUT]=R_,mf[vf.CUBIC_OUT_IN]=of,mf[vf.QUART_IN]=M_,mf[vf.QUART_OUT]=O_,mf[vf.QUART_IN_OUT]=N_,mf[vf.QUART_OUT_IN]=sf,mf[vf.QUINT_IN]=B_,mf[vf.QUINT_OUT]=L_,mf[vf.QUINT_IN_OUT]=F_,mf[vf.QUINT_OUT_IN]=cf,mf[vf.SINE_IN]=V_,mf[vf.SINE_OUT]=z_,mf[vf.SINE_IN_OUT]=k_,mf[vf.SINE_OUT_IN]=lf,mf[vf.EXPO_IN]=U_,mf[vf.EXPO_OUT]=G_,mf[vf.EXPO_IN_OUT]=H_,mf[vf.EXPO_OUT_IN]=hf,mf[vf.CIRC_IN]=j_,mf[vf.CIRC_OUT]=W_,mf[vf.CIRC_IN_OUT]=q_,mf[vf.CIRC_OUT_IN]=uf,mf[vf.ELASTIC_IN]=X_,mf[vf.ELASTIC_OUT]=Y_,mf[vf.ELASTIC_IN_OUT]=K_,mf[vf.ELASTIC_OUT_IN]=_f,mf[vf.BACK_IN]=J_,mf[vf.BACK_OUT]=Q_,mf[vf.BACK_IN_OUT]=Z_,mf[vf.BACK_OUT_IN]=ff,mf[vf.BOUNCE_IN]=$_,mf[vf.BOUNCE_OUT]=tf,mf[vf.BOUNCE_IN_OUT]=ef,mf[vf.BOUNCE_OUT_IN]=df,mf[vf.SMOOTH]=nf,mf[vf.FADE]=rf,mf);function Sf(t){return xf[t]}i(255),i(65280);var Af,bf,Cf,Tf=fc.LINEAR<<0|pc.NONE<<8|vf.LINEAR<<16,Ef=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).value=0,e.rightTangent=0,e.rightTangentWeight=0,e.leftTangent=0,e.leftTangentWeight=0,e._flags=Tf,e}return $(e,t),Q(e,[{key:"interpolationMode",get:function(){return(255&this._flags)>>0},set:function(t){this._flags&=-256,this._flags|=t<<0}},{key:"tangentWeightMode",get:function(){return(65280&this._flags)>>8},set:function(t){this._flags&=-65281,this._flags|=t<<8}},{key:"easingMethod",get:function(){return(16711680&this._flags)>>16},set:function(t){this._flags&=-16711681,this._flags|=t<<16}}]),e}(_l);function wf(t){var e=new Ef;if("number"==typeof t)e.value=t;else{var n=t.interpolationMode,i=t.tangentWeightMode,r=t.value,a=t.rightTangent,o=t.rightTangentWeight,s=t.leftTangent,c=t.leftTangentWeight,l=t.easingMethod,h=t[ul];e.value=null!=r?r:e.value,e.rightTangent=null!=a?a:e.rightTangent,e.rightTangentWeight=null!=o?o:e.rightTangentWeight,e.leftTangent=null!=s?s:e.leftTangent,e.leftTangentWeight=null!=c?c:e.leftTangentWeight,e.interpolationMode=null!=n?n:e.interpolationMode,e.tangentWeightMode=null!=i?i:e.tangentWeightMode,e.easingMethod=null!=l?l:e.easingMethod,h&&(e[ul]=h)}return e}en.fastDefine("cc.RealKeyframeValue",Ef,((yf={interpolationMode:fc.LINEAR,tangentWeightMode:pc.NONE,value:0,rightTangent:0,rightTangentWeight:0,leftTangent:0,leftTangentWeight:0,easingMethod:vf.LINEAR})[ul]=void 0,yf)),en.Attr.setClassAttr(Ef,ul,"editorOnly",!0),(Af=Ef,null!==(Cf=(bf=Af)[Oc])&&void 0!==Cf?Cf:bf[Oc]={}).uniquelyReferenced=!0;var If,Pf=t("RealCurve",function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).preExtrapolation=dc.CLAMP,e.postExtrapolation=dc.CLAMP,e}$(e,t);var n=e.prototype;return n.evaluate=function(t){var e=this._times,n=this._values,i=e.length;if(0===i)return 0;var r=e[0],a=e[i-1];if(t<r){var o=this.preExtrapolation,s=n[0];if(o===dc.CLAMP||i<2)return s.value;switch(o){case dc.LINEAR:return Wf(r,n[0].value,e[1],n[1].value,t);case dc.LOOP:t=Hf(t,r,a);break;case dc.PING_PONG:t=jf(t,r,a);break;default:return s.value}}else if(t>a){var c=this.postExtrapolation,l=n[i-1];if(c===dc.CLAMP||i<2)return l.value;switch(c){case dc.LINEAR:return Wf(a,l.value,e[i-2],n[i-2].value,t);case dc.LOOP:t=Hf(t,r,a);break;case dc.PING_PONG:t=jf(t,r,a);break;default:return l.value}}var h=_c(e,t);if(h>=0)return n[h].value;var u=~h,_=u-1,f=e[_],d=n[_],p=e[u];return function(t,e,n,i,r){var a=n-t;switch(e.interpolationMode){default:case fc.CONSTANT:return e.value;case fc.LINEAR:var o=e.easingMethod===vf.LINEAR?r:Sf(e.easingMethod)(r);return fn(e.value,i.value,o);case fc.CUBIC:var s=1/3,c=e.rightTangent,l=e.rightTangentWeight,h=0!=(e.tangentWeightMode&pc.RIGHT),u=i.leftTangent,_=i.leftTangentWeight,f=0!=(i.tangentWeightMode&pc.LEFT);if(h||f){var d=0;if(h)d=l;else{var p=a,m=a*c;d=Math.sqrt(p*p+m*m)*s}var v=Math.atan(c),g=Math.cos(v)*d+t,y=Math.sin(v)*d+e.value,x=0;if(f)x=_;else{var S=a,A=a*u;x=Math.sqrt(S*S+A*A)*s}var b=Math.atan(u),C=(g-t)/a,T=(-Math.cos(b)*x+n-t)/a,E=y,w=-Math.sin(b)*x+i.value,I=[0,0,0],P=function(t,e,n,i,r){var a=n/i,o=e/i,s=a*a,c=1/3*(-1/3*s+o),l=.5*(2/27*a*s-1/3*a*o+t/i),h=c*c*c,u=l*l+h,_=0;if(vc(u)){if(vc(l))return r[0]=0,1;var f=Math.cbrt(-l);return r[0]=2*f,r[1]=-f,2}if(u<0){var d=1/3*Math.acos(-l/Math.sqrt(-h)),p=2*Math.sqrt(-c);r[0]=p*Math.cos(d),r[1]=-p*Math.cos(d+Math.PI/3),r[2]=-p*Math.cos(d-Math.PI/3),_=3}else{var m=Math.sqrt(u),v=Math.cbrt(m-l),g=-Math.cbrt(m+l);r[0]=v+g,_=1}for(var y=1/3*a,x=0;x<_;++x)r[x]-=y;return _}(0-r,3*C,3*T-6*C,3*(C-T)+1,I),D=function(t,e,n){var i=n;if(1===e)i=t[0];else{i=-1/0;for(var r=0;r<e;++r){var a=t[r];a>=0&&a<=1&&a>i&&(i=a)}i===-1/0&&(i=0)}return i}(I,P,r);return qf(e.value,E,w,i.value,D)}var R=e.value+s*c*a,M=i.value-s*u*a;return qf(e.value,R,M,i.value,r)}}(f,d,p,n[u],(t-f)/(p-f))},n.addKeyFrame=function(e,n){return t.prototype.addKeyFrame.call(this,e,wf(n))},n.assignSorted=function(t,e){if(void 0!==e)this.setKeyframes(t.slice(),e.map((function(t){return wf(t)})));else{var n=Array.from(t);this.setKeyframes(n.map((function(t){return t[0]})),n.map((function(t){return wf(t[1])})))}},n.isConstant=function(t){if(this._values.length<=1)return!0;var e=this._values[0].value;return this._values.every((function(n){return hn(n.value,e,t)}))},n[Iu]=function(t,e){if(e.toCCON){var n=this._times,i=this._values,r=n.length,a=new DataView(new ArrayBuffer(0+Df+Df+Rf+Mf*r+kf*r)),o=0;a.setUint8(o,this.preExtrapolation),o+=Df,a.setUint8(o,this.postExtrapolation),o+=Df,a.setUint32(o,r,!0),o+=Rf,n.forEach((function(t,e){return a.setFloat32(o+Mf*e,t,!0)})),o+=Mf*r;for(var s,c=st(i);!(s=c()).done;){var l=s.value;o=Uf(a,l,o)}var h=new Uint8Array(a.buffer,0,o);t.writeProperty("bytes",h);var u=i.map((function(t){return t[ul]}));u.some((function(t){return void 0!==t}))&&t.writeProperty("keyframeValueEditorExtras",u)}else t.writeThis()},n[Pu]=function(t,e){if(e.fromCCON){var n=t.readProperty("bytes"),i=new DataView(n.buffer,n.byteOffset,n.byteLength),r=0;this.preExtrapolation=i.getUint8(r),r+=Df,this.postExtrapolation=i.getUint8(r),r+=Df;var a=i.getUint32(r,!0);r+=Rf;var o=Array.from({length:a},(function(t,e){return i.getFloat32(r+Mf*e,!0)}));r+=Mf*a;for(var s=new Array(a),c=0;c<a;++c){var l=wf({});r=Gf(i,l,r),s[c]=l}n.byteLength;var h=t.readProperty("keyframeValueEditorExtras");h&&(h.length,h.forEach((function(t,e){return s[e][ul]=t}))),this._times=o,this._values=s}else t.readThis()},e}(mc));en.fastDefine("cc.RealCurve",Pf,{_times:[],_values:[],preExtrapolation:dc.CLAMP,postExtrapolation:dc.CLAMP}),function(t){t[t.VALUE=1]="VALUE",t[t.INTERPOLATION_MODE=2]="INTERPOLATION_MODE",t[t.TANGENT_WEIGHT_MODE=4]="TANGENT_WEIGHT_MODE",t[t.LEFT_TANGENT=8]="LEFT_TANGENT",t[t.LEFT_TANGENT_WEIGHT=16]="LEFT_TANGENT_WEIGHT",t[t.RIGHT_TANGENT=32]="RIGHT_TANGENT",t[t.RIGHT_TANGENT_WEIGHT=64]="RIGHT_TANGENT_WEIGHT"}(If||(If={}));var Df=1,Rf=4,Mf=4,Of=wf({}),Nf=Of.interpolationMode,Bf=Of.tangentWeightMode,Lf=Of.leftTangent,Ff=Of.leftTangentWeight,Vf=Of.rightTangent,zf=Of.rightTangentWeight,kf=26;function Uf(t,e,n){var i=0,r=n,a=r;r+=4;var o=e.value,s=e.interpolationMode,c=e.tangentWeightMode,l=e.rightTangent,h=e.rightTangentWeight,u=e.leftTangent,_=e.leftTangentWeight,f=e.easingMethod;return t.setFloat32(r,o,!0),r+=4,s!==Nf&&(i|=If.INTERPOLATION_MODE,t.setUint8(r,s),r+=1),c!==Bf&&(i|=If.TANGENT_WEIGHT_MODE,t.setUint8(r,c),r+=1),u!==Lf&&(i|=If.LEFT_TANGENT,t.setFloat32(r,u,!0),r+=4),_!==Ff&&(i|=If.LEFT_TANGENT_WEIGHT,t.setFloat32(r,_,!0),r+=4),l!==Vf&&(i|=If.RIGHT_TANGENT,t.setFloat32(r,l,!0),r+=4),h!==zf&&(i|=If.RIGHT_TANGENT_WEIGHT,t.setFloat32(r,h,!0),r+=4),i|=f<<8,t.setUint32(a,i,!0),r}function Gf(t,e,n){var i=n,r=t.getUint32(i,!0);i+=4,e.value=t.getFloat32(i,!0),i+=4,r&If.INTERPOLATION_MODE&&(e.interpolationMode=t.getUint8(i),i+=1),r&If.TANGENT_WEIGHT_MODE&&(e.tangentWeightMode=t.getUint8(i),i+=1),r&If.LEFT_TANGENT&&(e.leftTangent=t.getFloat32(i,!0),i+=4),r&If.LEFT_TANGENT_WEIGHT&&(e.leftTangentWeight=t.getFloat32(i,!0),i+=4),r&If.RIGHT_TANGENT&&(e.rightTangent=t.getFloat32(i,!0),i+=4),r&If.RIGHT_TANGENT_WEIGHT&&(e.rightTangentWeight=t.getFloat32(i,!0),i+=4);var a=(65280&r)>>8;return e.easingMethod=a,i}function Hf(t,e,n){return e+bn(t-e,n-e)}function jf(t,e,n){return e+Cn(t-e,n-e)}function Wf(t,e,n,i,r){return e+(i-e)/(n-t)*(r-t)}function qf(t,e,n,i,r){var a=1-r;return a*a*a*t+3*a*a*r*e+3*a*r*r*n+r*r*r*i}function Xf(t,e,n,i,r){var a=1-r;return a*(a*(t+(3*e-t)*r)+3*n*r*r)+i*r*r*r}h.bezier=Xf;var Yf,Kf,Jf,Qf,Zf,$f,td,ed,nd,id,rd,ad=Math.cos,od=Math.acos,sd=Math.max,cd=2*Math.PI,ld=Math.sqrt;function hd(t){return t<0?-Math.pow(-t,1/3):Math.pow(t,1/3)}function ud(t,e){var n=function(t,e){var n,i,r,a,o=e-0,s=e-t[0],c=3*o,l=3*s,h=3*(e-t[2]),u=1/(-o+l-h+(e-1)),_=1/3,f=(c-6*s+h)*u,d=f*_,p=(-c+l)*u,m=(3*p-f*f)*_,v=m*_,g=(2*f*f*f-9*f*p+o*u*27)/27,y=g/2,x=y*y+v*v*v;if(x<0){var S=-m*_,A=ld(S*S*S),b=-g/(2*A),C=od(b<-1?-1:b>1?1:b),T=2*hd(A);return i=T*ad(C*_)-d,r=T*ad((C+cd)*_)-d,a=T*ad((C+2*cd)*_)-d,i>=0&&i<=1?r>=0&&r<=1?a>=0&&a<=1?sd(i,r,a):sd(i,r):a>=0&&a<=1?sd(i,a):i:r>=0&&r<=1?a>=0&&a<=1?sd(r,a):r:a}if(0===x)return r=-(n=y<0?hd(-y):-hd(y))-d,(i=2*n-d)>=0&&i<=1?r>=0&&r<=1?sd(i,r):i:r;var E=ld(x);return(n=hd(-y+E))-hd(y+E)-d}(t,e),i=t[1];return((1-n)*(i+(t[3]-i)*n)*3+n*n)*n}h.bezierByTime=ud,function(t){t[t.SLERP=0]="SLERP",t[t.CONSTANT=1]="CONSTANT"}(rd||(rd=t("QuatInterpolationMode",{})));var _d=Ec("cc.QuatKeyframeValue")(Yf=Vc((Jf=lt((Kf=function(t){var e=void 0===t?{}:t,n=e.value,i=e.interpolationMode,r=e.easingMethod;ct(this,"interpolationMode",Jf,this),ct(this,"value",Qf,this),ct(this,"easingMethod",Zf,this),this.value=n?zn.clone(n):this.value,this.interpolationMode=null!=i?i:this.interpolationMode,this.easingMethod=null!=r?r:this.easingMethod}).prototype,"interpolationMode",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return rd.SLERP}}),Qf=lt(Kf.prototype,"value",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zn.clone(zn.IDENTITY)}}),Zf=lt(Kf.prototype,"easingMethod",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return vf.LINEAR}}),Yf=Kf))||Yf)||Yf;function fd(t){return new _d(t)}var dd,pd=t("QuatCurve",Ec("cc.QuatCurve")((id=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"preExtrapolation",ed,at(e)),ct(e,"postExtrapolation",nd,at(e)),e}$(e,t);var n=e.prototype;return n.evaluate=function(t,e){var n;null!==(n=e)&&void 0!==n||(e=new zn);var i=this._times,r=this._values,a=this.postExtrapolation,o=this.preExtrapolation,s=i.length;if(0===s)return e;var c=i[0],l=i[s-1];if(t<c){var h=r[0];switch(o){case dc.LOOP:t=c+bn(t-c,l-c);break;case dc.PING_PONG:t=c+Cn(t-c,l-c);break;case dc.CLAMP:default:return zn.copy(e,h.value)}}else if(t>l){var u=r[s-1];switch(a){case dc.LOOP:t=c+bn(t-c,l-c);break;case dc.PING_PONG:t=c+Cn(t-c,l-c);break;case dc.CLAMP:default:return zn.copy(e,u.value)}}var _=_c(i,t);if(_>=0)return zn.copy(e,r[_].value);var f=~_,d=f-1,p=i[d],m=r[d],v=i[f],g=r[f],y=(t-p)/(v-p);switch(m.interpolationMode){default:case rd.CONSTANT:return zn.copy(e,m.value);case rd.SLERP:var x=m.easingMethod,S=x===vf.LINEAR?y:Array.isArray(x)?ud(x,y):Sf(x)(y);return zn.slerp(e,m.value,g.value,S)}},n.addKeyFrame=function(e,n){var i=new _d(n);return t.prototype.addKeyFrame.call(this,e,i)},n.assignSorted=function(t,e){if(void 0!==e)this.setKeyframes(t.slice(),e.map((function(t){return fd(t)})));else{var n=Array.from(t);this.setKeyframes(n.map((function(t){return t[0]})),n.map((function(t){return fd(t[1])})))}},n[Iu]=function(t,e){if(e.toCCON){var n=this._times,i=this._values,r=!0;i.forEach((function(t,e,n){var i=n[0];r&&t.interpolationMode!==i.interpolationMode&&(r=!1)}));var a=n.length,o=Sd*(r?1:a),s=i.reduce((function(t,e){var n=e.easingMethod;return t+(Array.isArray(n)?Ad+4*Cd:Ad)}),0),c=0,l=new DataView(new ArrayBuffer(c+=vd+gd+yd*a+4*xd*a+s+o+0)),h=0,u=0;r&&(u|=dd.INTERPOLATION_MODE),l.setUint32(h,u,!0),h+=vd,l.setUint32(h,a,!0),h+=gd,n.forEach((function(t,e){return l.setFloat32(h+yd*e,t,!0)})),h+=yd*a,i.forEach((function(t,e){var n=t.value,i=n.x,r=n.y,a=n.z,o=n.w,s=h+4*xd*e;l.setFloat32(s+0*xd,i,!0),l.setFloat32(s+1*xd,r,!0),l.setFloat32(s+2*xd,a,!0),l.setFloat32(s+3*xd,o,!0)})),h+=4*xd*a,i.forEach((function(t){var e=t.easingMethod;Array.isArray(e)?(l.setUint8(h,bd),++h,l.setFloat32(h+0*Cd,e[0],!0),l.setFloat32(h+1*Cd,e[1],!0),l.setFloat32(h+2*Cd,e[2],!0),l.setFloat32(h+3*Cd,e[3],!0),h+=4*Cd):(l.setUint8(h,e),++h)}));var _=h;h+=o;var f=_;i.forEach((function(t){var e=t.interpolationMode;l.setUint8(f,e),r||(f+=Sd)}));var d=new Uint8Array(l.buffer);t.writeProperty("bytes",d)}else t.writeThis()},n[Pu]=function(t,e){if(e.fromCCON){var n=t.readProperty("bytes"),i=new DataView(n.buffer,n.byteOffset,n.byteLength),r=0,a=i.getUint32(r,!0);r+=vd;var o=a&dd.INTERPOLATION_MODE,s=i.getUint32(r,!0);r+=gd;var c=Array.from({length:s},(function(t,e){return i.getFloat32(r+yd*e,!0)})),l=r+=yd*s;r+=4*xd*s;var h=Array.from({length:s},(function(t,e){var n=l+4*xd*e,a=i.getFloat32(n+0*xd,!0),o=i.getFloat32(n+1*xd,!0),s=i.getFloat32(n+2*xd,!0),c=i.getFloat32(n+3*xd,!0),h=i.getUint8(r);++r;var u=fd({value:{x:a,y:o,z:s,w:c}});return h!==bd?u.easingMethod=h:(u.easingMethod=[i.getFloat32(r+0*Cd,!0),i.getFloat32(r+1*Cd,!0),i.getFloat32(r+2*Cd,!0),i.getFloat32(r+3*Cd,!0)],r+=4*Cd),u}));if(o){var u=i.getUint8(r);++r;for(var _=0;_<s;++_)h[_].interpolationMode=u}else{for(var f=0;f<s;++f){var d=i.getUint8(r+f);h[f].interpolationMode=d}r+=s}this._times=c,this._values=h}else t.readThis()},e}(mc),ed=lt((td=id).prototype,"preExtrapolation",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dc.CLAMP}}),nd=lt(td.prototype,"postExtrapolation",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return dc.CLAMP}}),$f=td))||$f);!function(t){t[t.INTERPOLATION_MODE=1]="INTERPOLATION_MODE"}(dd||(dd={}));var md,vd=1,gd=4,yd=4,xd=4,Sd=1,Ad=1,bd=255,Cd=4,Td=t("ObjectCurve",Ec("cc.ObjectCurve")(md=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e.prototype.evaluate=function(t){var e=this.searchKeyframe(t);if(e>=0)return this._values[e];var n=un(~e-1,0,this._values.length-1);return this._values[n]},e}(mc))||md),Ed=function(){this.time=0,this.value=0,this.inTangent=0,this.outTangent=0};en.fastDefine("cc.Keyframe",Ed,{time:0,value:0,inTangent:0,outTangent:0});var wd=function(){function t(){this.index=void 0,this.time=void 0,this.endTime=void 0,this.coefficient=void 0,this.index=-1,this.time=0,this.endTime=0,this.coefficient=new Float32Array(4)}return t.prototype.evaluate=function(t){return e=t-this.time,n=this.coefficient,e*(e*(e*n[0]+n[1])+n[2])+n[3];var e,n},t}(),Id=function(){function t(t){if(void 0===t&&(t=null),this.cachedKey=void 0,t instanceof Pf)this._curve=t;else{var e=new Pf;this._curve=e,e.preExtrapolation=dc.LOOP,e.postExtrapolation=dc.CLAMP,t?e.assignSorted(t.map((function(t){return[t.time,{interpolationMode:fc.CUBIC,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}]}))):e.assignSorted([[0,{interpolationMode:fc.CUBIC,value:1}],[1,{interpolationMode:fc.CUBIC,value:1}]])}this.cachedKey=new wd}var e=t.prototype;return e.addKey=function(t){t?this._curve.addKeyFrame(t.time,{interpolationMode:fc.CUBIC,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}):this._curve.clear()},e.evaluate_slow=function(t){return this._curve.evaluate(t)},e.evaluate=function(t){var e=this.cachedKey,n=this._curve,i=n.keyFramesCount-1,r=t,a=t<0?n.preExtrapolation:n.postExtrapolation,o=n.getKeyframeTime(0),s=n.getKeyframeTime(i);switch(a){case dc.LOOP:r=bn(t-o,s-o)+o;break;case dc.PING_PONG:r=Cn(t-o,s-o)+o;break;case dc.CLAMP:default:r=un(t,o,s)}if(r>=e.time&&r<e.endTime)return e.evaluate(r);var c=this.findIndex(e,r),l=Math.min(c+1,i);return this.calcOptimizedKey(e,c,l),e.evaluate(r)},e.calcOptimizedKey=function(t,e,n){var i=this._curve.getKeyframeTime(e),r=this._curve.getKeyframeTime(n),a=this._curve.getKeyframeValue(e),o=a.value,s=a.leftTangent,c=this._curve.getKeyframeValue(n),l=c.value,h=c.rightTangent;t.index=e,t.time=i,t.endTime=r;var u=r-i,_=l-o,f=1/(u*u),d=s*u,p=h*u;t.coefficient[0]=(d+p-_-_)*f/u,t.coefficient[1]=(_+_+_-d-d-p)*f,t.coefficient[2]=s,t.coefficient[3]=o},e.findIndex=function(t,e){var n=this._curve,i=n.keyFramesCount,r=t.index;if(-1!==r)if(e>n.getKeyframeTime(r))for(var a=0;a<3;a++){var o=r+a;if(o+1<i&&n.getKeyframeTime(o+1)>e)return o}else for(var s=0;s<3;s++){var c=r-s;if(c>=0&&n.getKeyframeTime(c-1)<=e)return c-1}for(var l,h=0,u=i;u-h>1;)l=Math.floor((h+u)/2),n.getKeyframeTime(l)>=e?u=l:h=l;return h},Q(t,[{key:"_internalCurve",get:function(){return this._curve}},{key:"keyFrames",get:function(){return Array.from(this._curve.keyframes()).map((function(t){var e=t[0],n=t[1],i=new Ed;return i.time=e,i.value=n.value,i.inTangent=n.leftTangent,i.outTangent=n.rightTangent,i}))},set:function(t){this._curve.assignSorted(t.map((function(t){return[t.time,{interpolationMode:fc.CUBIC,value:t.value,leftTangent:t.inTangent,rightTangent:t.outTangent}]})))}},{key:"preWrapMode",get:function(){return Dd(this._curve.preExtrapolation)},set:function(t){this._curve.preExtrapolation=Pd(t)}},{key:"postWrapMode",get:function(){return Dd(this._curve.postExtrapolation)},set:function(t){this._curve.postExtrapolation=Pd(t)}}]),t}();function Pd(t){switch(t){default:case rc.Default:case rc.Normal:case rc.Clamp:return dc.CLAMP;case rc.PingPong:return dc.PING_PONG;case rc.Loop:return dc.LOOP}}function Dd(t){switch(t){default:case dc.LINEAR:case dc.CLAMP:return rc.Clamp;case dc.PING_PONG:return rc.PingPong;case dc.LOOP:return rc.Loop}}function Rd(t,e){console.warn(t+" is deprecated, please use "+e+" instead.")}Id.defaultKF=[{time:0,value:1,inTangent:0,outTangent:0},{time:1,value:1,inTangent:0,outTangent:0}],en.fastDefine("cc.AnimationCurve",Id,{_curve:null}),k(vs,"intersect",[{name:"ray_aabb",newName:"rayAABB"},{name:"ray_plane",newName:"rayPlane"},{name:"ray_triangle",newName:"rayTriangle"},{name:"ray_sphere",newName:"raySphere"},{name:"ray_obb",newName:"rayOBB"},{name:"ray_capsule",newName:"rayCapsule"},{name:"ray_subMesh",newName:"raySubMesh"},{name:"ray_mesh",newName:"rayMesh"},{name:"ray_model",newName:"rayModel"},{name:"line_plane",newName:"linePlane"},{name:"line_triangle",newName:"lineTriangle"},{name:"line_aabb",newName:"lineAABB"},{name:"line_obb",newName:"lineOBB"},{name:"line_sphere",newName:"lineSphere"},{name:"aabb_aabb",newName:"aabbWithAABB"},{name:"aabb_obb",newName:"aabbWithOBB"},{name:"aabb_plane",newName:"aabbPlane"},{name:"aabb_frustum",newName:"aabbFrustum"},{name:"aabbFrustum_accurate",newName:"aabbFrustumAccurate"},{name:"obb_point",newName:"obbPoint"},{name:"obb_plane",newName:"obbPlane"},{name:"obb_frustum",newName:"obbFrustum"},{name:"obbFrustum_accurate",newName:"obbFrustumAccurate"},{name:"obb_obb",newName:"obbWithOBB"},{name:"obb_capsule",newName:"obbCapsule"},{name:"sphere_plane",newName:"spherePlane"},{name:"sphere_frustum",newName:"sphereFrustum"},{name:"sphereFrustum_accurate",newName:"sphereFrustumAccurate"},{name:"sphere_sphere",newName:"sphereWithSphere"},{name:"sphere_aabb",newName:"sphereAABB"},{name:"sphere_obb",newName:"sphereOBB"},{name:"sphere_capsule",newName:"sphereCapsule"},{name:"capsule_capsule",newName:"capsuleWithCapsule"}]);var Md=function(t){function e(){var e;return e=t.call(this)||this,Rd("line","Line"),e}return $(e,t),e}(ro),Od=function(t){function e(){var e;return e=t.call(this)||this,Rd("plane","Plane"),e}return $(e,t),e}(Ps),Nd=function(t){function e(){var e;return e=t.call(this)||this,Rd("ray","Ray"),e}return $(e,t),e}(ao),Bd=function(t){function e(){var e;return e=t.call(this)||this,Rd("triangle","Triangle"),e}return $(e,t),e}(fo),Ld=function(t){function e(){var e;return e=t.call(this)||this,Rd("sphere","Sphere"),e}return $(e,t),e}(_o),Fd=function(t){function e(){var e;return e=t.call(this)||this,Rd("aabb","AABB"),e}return $(e,t),e}(Qs),Vd=function(t){function e(){var e;return e=t.call(this)||this,Rd("obb","OBB"),e}return $(e,t),e}(ec),zd=function(t){function e(){var e;return e=t.call(this)||this,Rd("capsule","Capsule"),e}return $(e,t),e}(nc),kd=function(t){function e(){var e;return e=t.call(this)||this,Rd("frustum","Frustum"),e}return $(e,t),e}(lc),Ud=Object.freeze({__proto__:null,distance:no,enums:io,intersect:vs,Line:ro,Plane:Ps,Ray:ao,Triangle:fo,Sphere:_o,AABB:Qs,OBB:ec,Capsule:nc,Frustum:lc,Keyframe:Ed,AnimationCurve:Id,get ERaycastMode(){return uo},line:Md,plane:Od,ray:Nd,triangle:Bd,sphere:Ld,aabb:Fd,obb:Vd,capsule:zd,frustum:kd});t("geometry",Ud);var Gd={NONE:0,IGNORE_RAYCAST:1<<20,GIZMOS:1<<21,EDITOR:1<<22,UI_3D:1<<23,SCENE_GIZMO:1<<24,UI_2D:1<<25,PROFILER:1<<28,DEFAULT:1<<30,ALL:4294967295},Hd=t("Layers",function(){function t(){}return t.makeMaskInclude=function(t){for(var e,n=0,i=st(t);!(e=i()).done;)n|=e.value;return n},t.makeMaskExclude=function(e){return~t.makeMaskInclude(e)},t.addLayer=function(e,n){if(void 0!==n)if(n>19||n<0)console.warn("maximum layers reached.");else{var i=1<<n;t.Enum[e],F(2104,e),t.Enum[e]=i,re.value(t.Enum,String(i),e),t.BitMask[e]=i,re.value(t.BitMask,String(i),e)}else console.warn("bitNum can't be undefined")},t.deleteLayer=function(e){if(e>19||e<0)console.warn("do not change buildin layers.");else{var n=1<<e;delete t.Enum[t.Enum[n]],delete t.Enum[n],delete t.BitMask[t.BitMask[n]],delete t.BitMask[n]}},t.nameToLayer=function(e){return void 0===e?(console.warn("name can't be undefined"),-1):n(t.Enum[e])},t.layerToName=function(e){return e>31||e<0?(console.warn("Unable to access unknown layer."),""):t.Enum[1<<e]},t}());Hd.Enum=se(Gd),Hd.BitMask=ae(Z({},Gd)),h.Layers=Hd;var jd,Wd,qd="MainFlow",Xd="ForwardFlow",Yd="ShadowFlow";!function(t){t[t.DEFAULT=100]="DEFAULT",t[t.UI=200]="UI"}(jd||(jd={})),h.RenderPassStage=jd,function(t){t[t.MIN=0]="MIN",t[t.MAX=255]="MAX",t[t.DEFAULT=128]="DEFAULT"}(Wd||(Wd={}));var Kd,Jd={bindings:[],layouts:{}},Qd={bindings:[],layouts:{}};!function(t){t[t.UBO_GLOBAL=0]="UBO_GLOBAL",t[t.UBO_CAMERA=1]="UBO_CAMERA",t[t.UBO_SHADOW=2]="UBO_SHADOW",t[t.SAMPLER_SHADOWMAP=3]="SAMPLER_SHADOWMAP",t[t.SAMPLER_ENVIRONMENT=4]="SAMPLER_ENVIRONMENT",t[t.SAMPLER_SPOT_LIGHTING_MAP=5]="SAMPLER_SPOT_LIGHTING_MAP",t[t.SAMPLER_DIFFUSEMAP=6]="SAMPLER_DIFFUSEMAP",t[t.COUNT=7]="COUNT"}(Kd||(Kd={}));var Zd,$d=Kd.SAMPLER_SHADOWMAP,tp=Kd.COUNT-$d;!function(t){t[t.UBO_LOCAL=0]="UBO_LOCAL",t[t.UBO_FORWARD_LIGHTS=1]="UBO_FORWARD_LIGHTS",t[t.UBO_SKINNING_ANIMATION=2]="UBO_SKINNING_ANIMATION",t[t.UBO_SKINNING_TEXTURE=3]="UBO_SKINNING_TEXTURE",t[t.UBO_MORPH=4]="UBO_MORPH",t[t.UBO_UI_LOCAL=5]="UBO_UI_LOCAL",t[t.SAMPLER_JOINTS=6]="SAMPLER_JOINTS",t[t.SAMPLER_MORPH_POSITION=7]="SAMPLER_MORPH_POSITION",t[t.SAMPLER_MORPH_NORMAL=8]="SAMPLER_MORPH_NORMAL",t[t.SAMPLER_MORPH_TANGENT=9]="SAMPLER_MORPH_TANGENT",t[t.SAMPLER_LIGHTMAP=10]="SAMPLER_LIGHTMAP",t[t.SAMPLER_SPRITE=11]="SAMPLER_SPRITE",t[t.SAMPLER_REFLECTION=12]="SAMPLER_REFLECTION",t[t.STORAGE_REFLECTION=13]="STORAGE_REFLECTION",t[t.COUNT=14]="COUNT"}(Zd||(Zd={}));var ep,np=Zd.SAMPLER_JOINTS,ip=Zd.STORAGE_REFLECTION-np,rp=Zd.COUNT-np-ip;!function(t){t[t.GLOBAL=0]="GLOBAL",t[t.MATERIAL=1]="MATERIAL",t[t.LOCAL=2]="LOCAL"}(ep||(ep={}));var ap=new pr([$d,0,np],[tp,0,ip],[0,0,0],[0,0,0],[0,0,0],[0,0,rp],[0,0,0],[0,2,1]),op=function(){};op.SIZE=4*(op.COUNT=4+(op.SCREEN_SIZE_OFFSET=4+(op.NATIVE_SIZE_OFFSET=4+(op.TIME_OFFSET=0)))),op.NAME="CCGlobal",op.BINDING=Kd.UBO_GLOBAL,op.DESCRIPTOR=new qr(op.BINDING,Yi.UNIFORM_BUFFER,1,Li.ALL),op.LAYOUT=new wr(ep.GLOBAL,op.BINDING,op.NAME,[new Er("cc_time",gi.FLOAT4,1),new Er("cc_screenSize",gi.FLOAT4,1),new Er("cc_nativeSize",gi.FLOAT4,1)],1),Jd.layouts[op.NAME]=op.LAYOUT,Jd.bindings[op.BINDING]=op.DESCRIPTOR;var sp=function(){};sp.SIZE=4*(sp.COUNT=4+(sp.VIEW_PORT_OFFSET=4+(sp.NEAR_FAR_OFFSET=4+(sp.GLOBAL_FOG_ADD_OFFSET=4+(sp.GLOBAL_FOG_BASE_OFFSET=4+(sp.GLOBAL_FOG_COLOR_OFFSET=4+(sp.AMBIENT_GROUND_OFFSET=4+(sp.AMBIENT_SKY_OFFSET=4+(sp.MAIN_LIT_COLOR_OFFSET=4+(sp.MAIN_LIT_DIR_OFFSET=4+(sp.EXPOSURE_OFFSET=4+(sp.SCREEN_SCALE_OFFSET=4+(sp.CAMERA_POS_OFFSET=16+(sp.MAT_VIEW_PROJ_INV_OFFSET=16+(sp.MAT_VIEW_PROJ_OFFSET=16+(sp.MAT_PROJ_INV_OFFSET=16+(sp.MAT_PROJ_OFFSET=16+(sp.MAT_VIEW_INV_OFFSET=16+(sp.MAT_VIEW_OFFSET=0))))))))))))))))))),sp.NAME="CCCamera",sp.BINDING=Kd.UBO_CAMERA,sp.DESCRIPTOR=new qr(sp.BINDING,Yi.UNIFORM_BUFFER,1,Li.ALL),sp.LAYOUT=new wr(ep.GLOBAL,sp.BINDING,sp.NAME,[new Er("cc_matView",gi.MAT4,1),new Er("cc_matViewInv",gi.MAT4,1),new Er("cc_matProj",gi.MAT4,1),new Er("cc_matProjInv",gi.MAT4,1),new Er("cc_matViewProj",gi.MAT4,1),new Er("cc_matViewProjInv",gi.MAT4,1),new Er("cc_cameraPos",gi.FLOAT4,1),new Er("cc_screenScale",gi.FLOAT4,1),new Er("cc_exposure",gi.FLOAT4,1),new Er("cc_mainLitDir",gi.FLOAT4,1),new Er("cc_mainLitColor",gi.FLOAT4,1),new Er("cc_ambientSky",gi.FLOAT4,1),new Er("cc_ambientGround",gi.FLOAT4,1),new Er("cc_fogColor",gi.FLOAT4,1),new Er("cc_fogBase",gi.FLOAT4,1),new Er("cc_fogAdd",gi.FLOAT4,1),new Er("cc_nearFar",gi.FLOAT4,1),new Er("cc_viewPort",gi.FLOAT4,1)],1),Jd.layouts[sp.NAME]=sp.LAYOUT,Jd.bindings[sp.BINDING]=sp.DESCRIPTOR;var cp=function(){};cp.SIZE=4*(cp.COUNT=4+(cp.PLANAR_NORMAL_DISTANCE_INFO_OFFSET=4+(cp.SHADOW_COLOR_OFFSET=4+(cp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET=4+(cp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET=4+(cp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET=4+(cp.SHADOW_PROJ_INFO_OFFSET=4+(cp.SHADOW_PROJ_DEPTH_INFO_OFFSET=4+(cp.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET=16+(cp.MAT_LIGHT_VIEW_PROJ_OFFSET=16+(cp.MAT_LIGHT_VIEW_OFFSET=16+(cp.MAT_LIGHT_PLANE_PROJ_OFFSET=0)))))))))))),cp.NAME="CCShadow",cp.BINDING=Kd.UBO_SHADOW,cp.DESCRIPTOR=new qr(cp.BINDING,Yi.UNIFORM_BUFFER,1,Li.ALL),cp.LAYOUT=new wr(ep.GLOBAL,cp.BINDING,cp.NAME,[new Er("cc_matLightPlaneProj",gi.MAT4,1),new Er("cc_matLightView",gi.MAT4,1),new Er("cc_matLightViewProj",gi.MAT4,1),new Er("cc_shadowInvProjDepthInfo",gi.FLOAT4,1),new Er("cc_shadowProjDepthInfo",gi.FLOAT4,1),new Er("cc_shadowProjInfo",gi.FLOAT4,1),new Er("cc_shadowNFLSInfo",gi.FLOAT4,1),new Er("cc_shadowWHPBInfo",gi.FLOAT4,1),new Er("cc_shadowLPNNInfo",gi.FLOAT4,1),new Er("cc_shadowColor",gi.FLOAT4,1),new Er("cc_planarNDInfo",gi.FLOAT4,1)],1),Jd.layouts[cp.NAME]=cp.LAYOUT,Jd.bindings[cp.BINDING]=cp.DESCRIPTOR;var lp=Kd.SAMPLER_SHADOWMAP,hp=new qr(lp,Yi.SAMPLER_TEXTURE,1,Li.FRAGMENT),up=new Ir(ep.GLOBAL,lp,"cc_shadowMap",gi.SAMPLER2D,1);Jd.layouts.cc_shadowMap=up,Jd.bindings[lp]=hp;var _p=Kd.SAMPLER_ENVIRONMENT,fp=new qr(_p,Yi.SAMPLER_TEXTURE,1,Li.FRAGMENT),dp=new Ir(ep.GLOBAL,_p,"cc_environment",gi.SAMPLER_CUBE,1);Jd.layouts.cc_environment=dp,Jd.bindings[_p]=fp;var pp=Kd.SAMPLER_DIFFUSEMAP,mp=new qr(pp,Yi.SAMPLER_TEXTURE,1,Li.FRAGMENT),vp=new Ir(ep.GLOBAL,pp,"cc_diffuseMap",gi.SAMPLER_CUBE,1);Jd.layouts.cc_diffuseMap=vp,Jd.bindings[pp]=mp;var gp=Kd.SAMPLER_SPOT_LIGHTING_MAP,yp=new qr(gp,Yi.SAMPLER_TEXTURE,1,Li.FRAGMENT),xp=new Ir(ep.GLOBAL,gp,"cc_spotLightingMap",gi.SAMPLER2D,1);Jd.layouts.cc_spotLightingMap=xp,Jd.bindings[gp]=yp;var Sp=function(){};Sp.SIZE=4*(Sp.COUNT=4+(Sp.LOCAL_SHADOW_BIAS=4+(Sp.LIGHTINGMAP_UVPARAM=16+(Sp.MAT_WORLD_IT_OFFSET=16+(Sp.MAT_WORLD_OFFSET=0))))),Sp.NAME="CCLocal",Sp.BINDING=Zd.UBO_LOCAL,Sp.DESCRIPTOR=new qr(Sp.BINDING,Yi.UNIFORM_BUFFER,1,Li.VERTEX|Li.COMPUTE),Sp.LAYOUT=new wr(ep.LOCAL,Sp.BINDING,Sp.NAME,[new Er("cc_matWorld",gi.MAT4,1),new Er("cc_matWorldIT",gi.MAT4,1),new Er("cc_lightingMapUVParam",gi.FLOAT4,1),new Er("cc_localShadowBias",gi.FLOAT4,1)],1),Qd.layouts[Sp.NAME]=Sp.LAYOUT,Qd.bindings[Sp.BINDING]=Sp.DESCRIPTOR;var Ap=function(){};Ap.SIZE=4*(Ap.COUNT=4+(Ap.WORLD_BOUND_HALF_EXTENTS=4+(Ap.WORLD_BOUND_CENTER=0))),Ap.NAME="CCWorldBound",Ap.BINDING=Zd.UBO_LOCAL,Ap.DESCRIPTOR=new qr(Ap.BINDING,Yi.UNIFORM_BUFFER,1,Li.VERTEX|Li.COMPUTE),Ap.LAYOUT=new wr(ep.LOCAL,Ap.BINDING,Ap.NAME,[new Er("cc_worldBoundCenter",gi.FLOAT4,1),new Er("cc_worldBoundHalfExtents",gi.FLOAT4,1)],1),Qd.layouts[Ap.NAME]=Ap.LAYOUT,Qd.bindings[Ap.BINDING]=Ap.DESCRIPTOR;var bp="a_matWorld0",Cp=function(){};Cp.BATCHING_COUNT=10,Cp.MAT_WORLDS_OFFSET=0,Cp.SIZE=4*(Cp.COUNT=16*Cp.BATCHING_COUNT),Cp.NAME="CCLocalBatched",Cp.BINDING=Zd.UBO_LOCAL,Cp.DESCRIPTOR=new qr(Cp.BINDING,Yi.UNIFORM_BUFFER,1,Li.VERTEX|Li.COMPUTE),Cp.LAYOUT=new wr(ep.LOCAL,Cp.BINDING,Cp.NAME,[new Er("cc_matWorlds",gi.MAT4,Cp.BATCHING_COUNT)],1),Qd.layouts[Cp.NAME]=Cp.LAYOUT,Qd.bindings[Cp.BINDING]=Cp.DESCRIPTOR;var Tp=function(){};Tp.LIGHTS_PER_PASS=1,Tp.SIZE=4*(Tp.COUNT=(Tp.LIGHT_DIR_OFFSET=(Tp.LIGHT_SIZE_RANGE_ANGLE_OFFSET=(Tp.LIGHT_COLOR_OFFSET=(Tp.LIGHT_POS_OFFSET=0)+4*Tp.LIGHTS_PER_PASS)+4*Tp.LIGHTS_PER_PASS)+4*Tp.LIGHTS_PER_PASS)+4*Tp.LIGHTS_PER_PASS),Tp.NAME="CCForwardLight",Tp.BINDING=Zd.UBO_FORWARD_LIGHTS,Tp.DESCRIPTOR=new qr(Tp.BINDING,Yi.DYNAMIC_UNIFORM_BUFFER,1,Li.FRAGMENT),Tp.LAYOUT=new wr(ep.LOCAL,Tp.BINDING,Tp.NAME,[new Er("cc_lightPos",gi.FLOAT4,Tp.LIGHTS_PER_PASS),new Er("cc_lightColor",gi.FLOAT4,Tp.LIGHTS_PER_PASS),new Er("cc_lightSizeRangeAngle",gi.FLOAT4,Tp.LIGHTS_PER_PASS),new Er("cc_lightDir",gi.FLOAT4,Tp.LIGHTS_PER_PASS)],1),Qd.layouts[Tp.NAME]=Tp.LAYOUT,Qd.bindings[Tp.BINDING]=Tp.DESCRIPTOR;var Ep=function(){};Ep.LIGHTS_PER_PASS=10;var wp=function(){};wp.SIZE=4*(wp.COUNT=4+(wp.JOINTS_TEXTURE_INFO_OFFSET=0)),wp.NAME="CCSkinningTexture",wp.BINDING=Zd.UBO_SKINNING_TEXTURE,wp.DESCRIPTOR=new qr(wp.BINDING,Yi.UNIFORM_BUFFER,1,Li.VERTEX),wp.LAYOUT=new wr(ep.LOCAL,wp.BINDING,wp.NAME,[new Er("cc_jointTextureInfo",gi.FLOAT4,1)],1),Qd.layouts[wp.NAME]=wp.LAYOUT,Qd.bindings[wp.BINDING]=wp.DESCRIPTOR;var Ip=function(){};Ip.SIZE=4*(Ip.COUNT=4+(Ip.JOINTS_ANIM_INFO_OFFSET=0)),Ip.NAME="CCSkinningAnimation",Ip.BINDING=Zd.UBO_SKINNING_ANIMATION,Ip.DESCRIPTOR=new qr(Ip.BINDING,Yi.UNIFORM_BUFFER,1,Li.VERTEX),Ip.LAYOUT=new wr(ep.LOCAL,Ip.BINDING,Ip.NAME,[new Er("cc_jointAnimInfo",gi.FLOAT4,1)],1),Qd.layouts[Ip.NAME]=Ip.LAYOUT,Qd.bindings[Ip.BINDING]=Ip.DESCRIPTOR;var Pp="a_jointAnimInfo",Dp=function(){};Dp.SIZE=4*(Dp.COUNT=360+(Dp.JOINTS_OFFSET=0)),Dp.NAME="CCSkinning",Dp.BINDING=Zd.UBO_SKINNING_TEXTURE,Dp.DESCRIPTOR=new qr(Dp.BINDING,Yi.UNIFORM_BUFFER,1,Li.VERTEX),Dp.LAYOUT=new wr(ep.LOCAL,Dp.BINDING,Dp.NAME,[new Er("cc_joints",gi.FLOAT4,90)],1),Qd.layouts[Dp.NAME]=Dp.LAYOUT,Qd.bindings[Dp.BINDING]=Dp.DESCRIPTOR;var Rp=function(){};Rp.MAX_MORPH_TARGET_COUNT=60,Rp.OFFSET_OF_WEIGHTS=0,Rp.OFFSET_OF_VERTICES_COUNT=4+(Rp.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT=4+(Rp.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH=4*Rp.MAX_MORPH_TARGET_COUNT)),Rp.COUNT_BASE_4_BYTES=4*Math.ceil(Rp.MAX_MORPH_TARGET_COUNT/4)+4,Rp.SIZE=4*Rp.COUNT_BASE_4_BYTES,Rp.NAME="CCMorph",Rp.BINDING=Zd.UBO_MORPH,Rp.DESCRIPTOR=new qr(Rp.BINDING,Yi.UNIFORM_BUFFER,1,Li.VERTEX),Rp.LAYOUT=new wr(ep.LOCAL,Rp.BINDING,Rp.NAME,[new Er("cc_displacementWeights",gi.FLOAT4,Rp.MAX_MORPH_TARGET_COUNT/4),new Er("cc_displacementTextureInfo",gi.FLOAT4,1)],1),Qd.layouts[Rp.NAME]=Rp.LAYOUT,Qd.bindings[Rp.BINDING]=Rp.DESCRIPTOR;var Mp=function(){};Mp.NAME="CCUILocal",Mp.BINDING=Zd.UBO_UI_LOCAL,Mp.DESCRIPTOR=new qr(Mp.BINDING,Yi.DYNAMIC_UNIFORM_BUFFER,1,Li.VERTEX),Mp.LAYOUT=new wr(ep.LOCAL,Mp.BINDING,Mp.NAME,[new Er("cc_local_data",gi.FLOAT4,1)],1),Qd.layouts[Mp.NAME]=Mp.LAYOUT,Qd.bindings[Mp.BINDING]=Mp.DESCRIPTOR;var Op=Zd.SAMPLER_JOINTS,Np=new qr(Op,Yi.SAMPLER_TEXTURE,1,Li.VERTEX),Bp=new Ir(ep.LOCAL,Op,"cc_jointTexture",gi.SAMPLER2D,1);Qd.layouts.cc_jointTexture=Bp,Qd.bindings[Op]=Np;var Lp=Zd.SAMPLER_MORPH_POSITION,Fp=new qr(Lp,Yi.SAMPLER_TEXTURE,1,Li.VERTEX),Vp=new Ir(ep.LOCAL,Lp,"cc_PositionDisplacements",gi.SAMPLER2D,1);Qd.layouts.cc_PositionDisplacements=Vp,Qd.bindings[Lp]=Fp;var zp=Zd.SAMPLER_MORPH_NORMAL,kp=new qr(zp,Yi.SAMPLER_TEXTURE,1,Li.VERTEX),Up=new Ir(ep.LOCAL,zp,"cc_NormalDisplacements",gi.SAMPLER2D,1);Qd.layouts.cc_NormalDisplacements=Up,Qd.bindings[zp]=kp;var Gp=Zd.SAMPLER_MORPH_TANGENT,Hp=new qr(Gp,Yi.SAMPLER_TEXTURE,1,Li.VERTEX),jp=new Ir(ep.LOCAL,Gp,"cc_TangentDisplacements",gi.SAMPLER2D,1);Qd.layouts.cc_TangentDisplacements=jp,Qd.bindings[Gp]=Hp;var Wp=Zd.SAMPLER_LIGHTMAP,qp=new qr(Wp,Yi.SAMPLER_TEXTURE,1,Li.FRAGMENT),Xp=new Ir(ep.LOCAL,Wp,"cc_lightingMap",gi.SAMPLER2D,1);Qd.layouts.cc_lightingMap=Xp,Qd.bindings[Wp]=qp;var Yp=Zd.SAMPLER_SPRITE,Kp=new qr(Yp,Yi.SAMPLER_TEXTURE,1,Li.FRAGMENT),Jp=new Ir(ep.LOCAL,Yp,"cc_spriteTexture",gi.SAMPLER2D,1);Qd.layouts.cc_spriteTexture=Jp,Qd.bindings[Yp]=Kp;var Qp=Zd.SAMPLER_REFLECTION,Zp=new qr(Qp,Yi.SAMPLER_TEXTURE,1,Li.FRAGMENT),$p=new Ir(ep.LOCAL,Qp,"cc_reflectionTexture",gi.SAMPLER2D,1);Qd.layouts.cc_reflectionTexture=$p,Qd.bindings[Qp]=Zp;var tm=Zd.STORAGE_REFLECTION,em=new qr(tm,Yi.STORAGE_IMAGE,1,Li.COMPUTE),nm=new Rr(ep.LOCAL,tm,"cc_reflectionStorage",gi.IMAGE2D,1);Qd.layouts.cc_reflectionStorage=nm,Qd.bindings[tm]=em;var im,rm,am=Hd.makeMaskExclude([Hd.BitMask.UI_2D,Hd.BitMask.GIZMOS,Hd.BitMask.EDITOR,Hd.BitMask.SCENE_GIZMO,Hd.BitMask.PROFILER]),om=Hd.makeMaskExclude([Hd.BitMask.UI_2D,Hd.BitMask.PROFILER]),sm=Hd.Enum.ALL;function cm(t){return(t.getFormatFeatures(mi.R32F)&(Ei.RENDER_TARGET|Ei.SAMPLED_TEXTURE))==(Ei.RENDER_TARGET|Ei.SAMPLED_TEXTURE)}t("pipeline",Object.freeze({__proto__:null,PIPELINE_FLOW_MAIN:qd,PIPELINE_FLOW_FORWARD:Xd,PIPELINE_FLOW_SHADOW:Yd,PIPELINE_FLOW_SMAA:"SMAAFlow",PIPELINE_FLOW_TONEMAP:"ToneMapFlow",get RenderPassStage(){return jd},get RenderPriority(){return Wd},globalDescriptorSetLayout:Jd,localDescriptorSetLayout:Qd,get PipelineGlobalBindings(){return Kd},get ModelLocalBindings(){return Zd},get SetIndex(){return ep},bindingMappingInfo:ap,UBOGlobal:op,UBOCamera:sp,UBOShadow:cp,UNIFORM_SHADOWMAP_BINDING:lp,UNIFORM_ENVIRONMENT_BINDING:_p,UNIFORM_DIFFUSEMAP_BINDING:pp,UNIFORM_SPOT_LIGHTING_MAP_TEXTURE_BINDING:gp,UBOLocal:Sp,UBOWorldBound:Ap,INST_MAT_WORLD:bp,UBOLocalBatched:Cp,UBOForwardLight:Tp,UBODeferredLight:Ep,JOINT_UNIFORM_CAPACITY:30,UBOSkinningTexture:wp,UBOSkinningAnimation:Ip,INST_JOINT_ANIM_INFO:Pp,UBOSkinning:Dp,UBOMorph:Rp,UBOUILocal:Mp,UNIFORM_JOINT_TEXTURE_BINDING:Op,UNIFORM_POSITION_MORPH_TEXTURE_BINDING:Lp,UNIFORM_NORMAL_MORPH_TEXTURE_BINDING:zp,UNIFORM_TANGENT_MORPH_TEXTURE_BINDING:Gp,UNIFORM_LIGHTMAP_TEXTURE_BINDING:Wp,UNIFORM_SPRITE_TEXTURE_BINDING:Yp,UNIFORM_REFLECTION_TEXTURE_BINDING:Qp,UNIFORM_REFLECTION_STORAGE_BINDING:tm,CAMERA_DEFAULT_MASK:am,CAMERA_EDITOR_MASK:om,MODEL_ALWAYS_MASK:sm,supportsR16HalfFloatTexture:function(t){return(t.getFormatFeatures(mi.R16F)&(Ei.RENDER_TARGET|Ei.SAMPLED_TEXTURE))==(Ei.RENDER_TARGET|Ei.SAMPLED_TEXTURE)},supportsR32FloatTexture:cm}));var lm=4227858432,hm=66060288,um=1044480,_m=function(t,e,n,i){return void 0===i&&(i=0),e<<26&lm|t<<20&hm|n<<12&um|4095&i},fm=function(t){return(t&lm)>>>26},dm=function(t){return(t&hm)>>>20},pm=function(t){return(t&um)>>>12},mm=function(t){return 4095&t},vm=function(t,e){return 67108863&t|e<<26&lm},gm=((im={})[gi.UNKNOWN]=function(){return console.warn("illegal uniform handle")},im[gi.INT]=function(t,e,n){return void 0===n&&(n=0),t[n]},im[gi.INT2]=function(t,e,n){return void 0===n&&(n=0),Qn.fromArray(e,t,n)},im[gi.INT3]=function(t,e,n){return void 0===n&&(n=0),Mn.fromArray(e,t,n)},im[gi.INT4]=function(t,e,n){return void 0===n&&(n=0),ei.fromArray(e,t,n)},im[gi.FLOAT]=function(t,e,n){return void 0===n&&(n=0),t[n]},im[gi.FLOAT2]=function(t,e,n){return void 0===n&&(n=0),Qn.fromArray(e,t,n)},im[gi.FLOAT3]=function(t,e,n){return void 0===n&&(n=0),Mn.fromArray(e,t,n)},im[gi.FLOAT4]=function(t,e,n){return void 0===n&&(n=0),ei.fromArray(e,t,n)},im[gi.MAT3]=function(t,e,n){return void 0===n&&(n=0),Ln.fromArray(e,t,n)},im[gi.MAT4]=function(t,e,n){return void 0===n&&(n=0),Xn.fromArray(e,t,n)},im),ym=((rm={})[gi.UNKNOWN]=function(){return console.warn("illegal uniform handle")},rm[gi.INT]=function(t,e,n){return void 0===n&&(n=0),t[n]=e},rm[gi.INT2]=function(t,e,n){return void 0===n&&(n=0),Qn.toArray(t,e,n)},rm[gi.INT3]=function(t,e,n){return void 0===n&&(n=0),Mn.toArray(t,e,n)},rm[gi.INT4]=function(t,e,n){return void 0===n&&(n=0),ei.toArray(t,e,n)},rm[gi.FLOAT]=function(t,e,n){return void 0===n&&(n=0),t[n]=e},rm[gi.FLOAT2]=function(t,e,n){return void 0===n&&(n=0),Qn.toArray(t,e,n)},rm[gi.FLOAT3]=function(t,e,n){return void 0===n&&(n=0),Mn.toArray(t,e,n)},rm[gi.FLOAT4]=function(t,e,n){return void 0===n&&(n=0),ei.toArray(t,e,n)},rm[gi.MAT3]=function(t,e,n){return void 0===n&&(n=0),Ln.toArray(t,e,n)},rm[gi.MAT4]=function(t,e,n){return void 0===n&&(n=0),Xn.toArray(t,e,n)},rm),xm=[Object.freeze([0]),Object.freeze([0,0]),Object.freeze([0,0,0,0]),Object.freeze([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1])];function Sm(t){switch(t){case gi.BOOL:case gi.INT:case gi.UINT:case gi.FLOAT:return xm[0];case gi.BOOL2:case gi.INT2:case gi.UINT2:case gi.FLOAT2:return xm[1];case gi.BOOL4:case gi.INT4:case gi.UINT4:case gi.FLOAT4:return xm[2];case gi.MAT4:return xm[3];case gi.SAMPLER2D:return"default-texture";case gi.SAMPLER_CUBE:return"default-cube-texture"}return xm[0]}function Am(t,e){for(var n=Object.entries(e),i=!1,r=0;r<n.length;r++)t[n[r][0]]!==n[r][1]&&(t[n[r][0]]=n[r][1],i=!0);return i}var bm=new Xr;function Cm(t){return Math.ceil(Math.log2(Math.max(t,2)))}function Tm(t,e){switch(t.type){case"boolean":return"number"==typeof e?e.toString():e?"1":"0";case"string":return void 0!==e?e:t.options[0];case"number":return void 0!==e?e.toString():t.range[0].toString();default:return console.warn("unknown define type '"+t.type+"'"),"-1"}}function Em(t,e,n,i,r){for(var a=t.builtins[i],o=[],s=function(t){var e=a.blocks[t],i=n.layouts[e.name],s=i&&n.bindings.find((function(t){return t.binding===i.binding}));if(!(i&&s&&s.descriptorType&oa))return console.warn("builtin UBO '"+e.name+"' not available!"),"continue";o.push(i),r&&!r.includes(s)&&r.push(s)},c=0;c<a.blocks.length;c++)s(c);Array.prototype.unshift.apply(e.shaderInfo.blocks,o);for(var l=[],h=function(t){var e=a.samplerTextures[t],i=n.layouts[e.name],o=i&&n.bindings.find((function(t){return t.binding===i.binding}));if(!(i&&o&&o.descriptorType&sa))return console.warn("builtin samplerTexture '"+e.name+"' not available!"),"continue";l.push(i),r&&!r.includes(o)&&r.push(o)},u=0;u<a.samplerTextures.length;u++)h(u);Array.prototype.unshift.apply(e.shaderInfo.samplerTextures,l),r&&r.sort((function(t,e){return t.binding-e.binding}))}function wm(t){return t.members.reduce((function(t,e){return t+fa(e.type)*e.count}),0)}function Im(t,e){for(var n=0;n<t.length;n++){var i=t[n];if("!"===i[0]){if(e[i.slice(1)])return!1}else if(!e[i])return!1}return!0}function Pm(t){switch(t.gfxAPI){case fi.GLES2:case fi.WEBGL:return"glsl1";case fi.GLES3:case fi.WEBGL2:return"glsl3";default:return"glsl4"}}var Dm,Rm,Mm,Om,Nm,Bm,Lm,Fm,Vm=new(function(){function t(){this._templates={},this._cache={},this._templateInfos={}}var e=t.prototype;return e.register=function(t){for(var e=0;e<t.shaders.length;e++)this.define(t.shaders[e]).effectName=t.name;for(var n=0;n<t.techniques.length;n++)for(var i=t.techniques[n],r=0;r<i.passes.length;r++){var a=i.passes[r];void 0!==a.propertyIndex&&void 0===a.properties&&(a.properties=i.passes[a.propertyIndex].properties)}},e.define=function(t){var e=this._templates[t.name];if(e&&e.hash===t.hash)return e;for(var n=Z({},t),i=0,r=function(t){var e=n.defines[t],r=1;if("number"===e.type){var a=e.range;r=Cm(a[1]-a[0]+1),e._map=function(t){return t-a[0]}}else"string"===e.type?(r=Cm(e.options.length),e._map=function(t){return Math.max(0,e.options.findIndex((function(e){return e===t})))}):"boolean"===e.type&&(e._map=function(t){return t?1:0});e._offset=i,i+=r},a=0;a<n.defines.length;a++)r(a);for(var o in i>31&&(n.uber=!0),n.constantMacros="",n.builtins.statistics)n.constantMacros+="#define "+o+" "+n.builtins.statistics[o]+"\n";if(this._templates[t.name]=n,!this._templateInfos[n.hash]){var s={};s.samplerStartBinding=n.blocks.length,s.shaderInfo=new Lr,s.blockSizes=[],s.bindings=[];for(var c=0;c<n.blocks.length;c++){var l=n.blocks[c];s.blockSizes.push(wm(l)),s.bindings.push(new qr(l.binding,Yi.UNIFORM_BUFFER,1,l.stageFlags)),s.shaderInfo.blocks.push(new wr(ep.MATERIAL,l.binding,l.name,l.members.map((function(t){return new Er(t.name,t.type,t.count)})),1))}for(var h=0;h<n.samplerTextures.length;h++){var u=n.samplerTextures[h];s.bindings.push(new qr(u.binding,Yi.SAMPLER_TEXTURE,u.count,u.stageFlags)),s.shaderInfo.samplerTextures.push(new Ir(ep.MATERIAL,u.binding,u.name,u.type,u.count))}for(var _=0;_<n.samplers.length;_++){var f=n.samplers[_];s.bindings.push(new qr(f.binding,Yi.SAMPLER,f.count,f.stageFlags)),s.shaderInfo.samplers.push(new Pr(ep.MATERIAL,f.binding,f.name,f.count))}for(var d=0;d<n.textures.length;d++){var p=n.textures[d];s.bindings.push(new qr(p.binding,Yi.TEXTURE,p.count,p.stageFlags)),s.shaderInfo.textures.push(new Dr(ep.MATERIAL,p.binding,p.name,p.type,p.count))}for(var m=0;m<n.buffers.length;m++){var v=n.buffers[m];s.bindings.push(new qr(v.binding,Yi.STORAGE_BUFFER,1,v.stageFlags)),s.shaderInfo.buffers.push(new Mr(ep.MATERIAL,v.binding,v.name,1,v.memoryAccess))}for(var g=0;g<n.images.length;g++){var y=n.images[g];s.bindings.push(new qr(y.binding,Yi.STORAGE_IMAGE,y.count,y.stageFlags)),s.shaderInfo.images.push(new Rr(ep.MATERIAL,y.binding,y.name,y.type,y.count,y.memoryAccess))}for(var x=0;x<n.subpassInputs.length;x++){var S=n.subpassInputs[x];s.bindings.push(new qr(S.binding,Yi.INPUT_ATTACHMENT,S.count,S.stageFlags)),s.shaderInfo.subpassInputs.push(new Or(ep.MATERIAL,S.binding,S.name,S.count))}s.gfxAttributes=[];for(var A=0;A<n.attributes.length;A++){var b=n.attributes[A];s.gfxAttributes.push(new Br(b.name,b.format,b.isNormalized,0,b.isInstanced,b.location))}Em(n,s,Qd,"locals"),s.shaderInfo.stages.push(new Nr(Li.VERTEX,"")),s.shaderInfo.stages.push(new Nr(Li.FRAGMENT,"")),s.handleMap=function(t){for(var e={},n=0;n<t.blocks.length;n++)for(var i=t.blocks[n],r=i.members,a=0,o=0;o<r.length;o++){var s=r[o];e[s.name]=_m(i.binding,s.type,s.count,a),a+=(fa(s.type)>>2)*s.count}for(var c=0;c<t.samplerTextures.length;c++){var l=t.samplerTextures[c];e[l.name]=_m(l.binding,l.type,l.count)}return e}(n),s.setLayouts=[],this._templateInfos[n.hash]=s}return n},e.getTemplate=function(t){return this._templates[t]},e.getTemplateInfo=function(t){var e=this._templates[t].hash;return this._templateInfos[e]},e.getDescriptorSetLayout=function(t,e,n){void 0===n&&(n=!1);var i=this._templates[e],r=this._templateInfos[i.hash];return r.setLayouts.length||(bm.bindings=r.bindings,r.setLayouts[ep.MATERIAL]=t.createDescriptorSetLayout(bm),bm.bindings=Qd.bindings,r.setLayouts[ep.LOCAL]=t.createDescriptorSetLayout(bm)),r.setLayouts[n?ep.LOCAL:ep.MATERIAL]},e.hasProgram=function(t){return void 0!==this._templates[t]},e.getKey=function(t,e){var n=this._templates[t],i=n.defines;if(n.uber){for(var r="",a=0;a<i.length;a++){var o=i[a],s=e[o.name];if(s&&o._map){var c=o._map(s);r+=""+o._offset+c+"|"}}return""+r+n.hash}for(var l=0,h=0;h<i.length;h++){var u=i[h],_=e[u.name];_&&u._map&&(l|=u._map(_)<<u._offset)}return l.toString(16)+"|"+n.hash},e.destroyShaderByDefines=function(t){var e=this,n=Object.keys(t);if(n.length)for(var i=n.map((function(e){var n=t[e];return"boolean"==typeof n&&(n=n?"1":"0"),new RegExp(""+e+n)})),r=Object.keys(this._cache).filter((function(t){return i.every((function(n){return n.test(e._cache[t].name)}))})),a=0;a<r.length;a++){var o=r[a],s=this._cache[o];C("destroyed shader "+s.name),s.destroy(),delete this._cache[o]}},e.getGFXShader=function(t,e,n,i,r){Object.assign(n,i.macros),r||(r=this.getKey(e,n));var a=this._cache[r];if(a)return a;var o=this._templates[e],s=this._templateInfos[o.hash];s.pipelineLayout||(this.getDescriptorSetLayout(t,e),Em(o,s,Jd,"globals"),s.setLayouts[ep.GLOBAL]=i.descriptorSetLayout,s.pipelineLayout=t.createPipelineLayout(new Kr(s.setLayouts)));var c=function(t,e){for(var n=[],i=0;i<e.length;i++){var r=e[i],a=r.name,o=t[a],s=Tm(r,o),c=!o||"0"===o;n.push({name:a,value:s,isDefault:c})}return n}(n,o.defines),l=i.constantMacros+o.constantMacros+c.reduce((function(t,e){return t+"#define "+e.name+" "+e.value+"\n"}),""),h=o.glsl3,u=Pm(t);return u?h=o[u]:console.error("Invalid GFX API!"),s.shaderInfo.stages[0].source=l+h.vert,s.shaderInfo.stages[1].source=l+h.frag,s.shaderInfo.attributes=function(t,e,n){for(var i=[],r=t.attributes,a=e.gfxAttributes,o=0;o<r.length;o++)Im(r[o].defines,n)&&i.push(a[o]);return i}(o,s,n),s.shaderInfo.name=function(t,e){return t+e.reduce((function(t,e){return e.isDefault?t:t+"|"+e.name+e.value}),"")}(e,c),this._cache[r]=t.createShader(s.shaderInfo)},t}());h.programLib=Vm;var zm=t("EffectAsset",Ec("cc.EffectAsset")((Fm=Lm=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"techniques",Mm,at(e)),ct(e,"shaders",Om,at(e)),ct(e,"combinations",Nm,at(e)),ct(e,"hideInEditor",Bm,at(e)),e}$(e,t),e.register=function(t){e._effects[t.name]=t},e.remove=function(t){if("string"!=typeof t)e._effects[t.name]&&e._effects[t.name]===t&&delete e._effects[t.name];else{if(e._effects[t])return void delete e._effects[t];for(var n in e._effects)if(e._effects[n]._uuid===t)return void delete e._effects[n]}},e.get=function(t){if(e._effects[t])return e._effects[t];for(var n in e._effects)if(e._effects[n]._uuid===t)return e._effects[n];return null},e.getAll=function(){return e._effects};var n=e.prototype;return n.onLoaded=function(){Vm.register(this),e.register(this),h.game.once(h.Game.EVENT_ENGINE_INITED,this._precompile,this)},n._precompile=function(){for(var t=this,e=h.director.root,n=function(n){var i=t.shaders[n],r=t.combinations[n];if(!r)return"continue";Object.keys(r).reduce((function(t,e){return t.reduce((function(t,n){for(var i=r[e],a=0;a<i.length;++a){var o=Z({},n);o[e]=i[a],t.push(o)}return t}),[])}),[{}]).forEach((function(t){return Vm.getGFXShader(e.device,i.name,t,e.pipeline)}))},i=0;i<this.shaders.length;i++)n(i)},n.destroy=function(){return e.remove(this),t.prototype.destroy.call(this)},n.initDefault=function(n){t.prototype.initDefault.call(this,n);var i=e.get("unlit");this.name="unlit",this.shaders=i.shaders,this.combinations=i.combinations,this.techniques=i.techniques},n.validate=function(){return this.techniques.length>0&&this.shaders.length>0},e}($h),Lm._effects={},Mm=lt((Rm=Fm).prototype,"techniques",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Om=lt(Rm.prototype,"shaders",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Nm=lt(Rm.prototype,"combinations",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Bm=lt(Rm.prototype,"hideInEditor",[Nc,Lc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Dm=Rm))||Dm);h.EffectAsset=zm;var km,Um,Gm,Hm,jm,Wm,qm,Xm,Ym,Km,Jm,Qm,Zm,$m,tv,ev=1024;!function(t){t[t.RGB565=mi.R5G6B5]="RGB565",t[t.RGB5A1=mi.RGB5A1]="RGB5A1",t[t.RGBA4444=mi.RGBA4]="RGBA4444",t[t.RGB888=mi.RGB8]="RGB888",t[t.RGB32F=mi.RGB32F]="RGB32F",t[t.RGBA8888=mi.RGBA8]="RGBA8888",t[t.RGBA32F=mi.RGBA32F]="RGBA32F",t[t.A8=mi.A8]="A8",t[t.I8=mi.L8]="I8",t[t.AI8=mi.LA8]="AI8",t[t.RGB_PVRTC_2BPPV1=mi.PVRTC_RGB2]="RGB_PVRTC_2BPPV1",t[t.RGBA_PVRTC_2BPPV1=mi.PVRTC_RGBA2]="RGBA_PVRTC_2BPPV1",t[t.RGB_A_PVRTC_2BPPV1=ev++]="RGB_A_PVRTC_2BPPV1",t[t.RGB_PVRTC_4BPPV1=mi.PVRTC_RGB4]="RGB_PVRTC_4BPPV1",t[t.RGBA_PVRTC_4BPPV1=mi.PVRTC_RGBA4]="RGBA_PVRTC_4BPPV1",t[t.RGB_A_PVRTC_4BPPV1=ev++]="RGB_A_PVRTC_4BPPV1",t[t.RGB_ETC1=mi.ETC_RGB8]="RGB_ETC1",t[t.RGBA_ETC1=ev++]="RGBA_ETC1",t[t.RGB_ETC2=mi.ETC2_RGB8]="RGB_ETC2",t[t.RGBA_ETC2=mi.ETC2_RGBA8]="RGBA_ETC2",t[t.RGBA_ASTC_4x4=mi.ASTC_RGBA_4X4]="RGBA_ASTC_4x4",t[t.RGBA_ASTC_5x4=mi.ASTC_RGBA_5X4]="RGBA_ASTC_5x4",t[t.RGBA_ASTC_5x5=mi.ASTC_RGBA_5X5]="RGBA_ASTC_5x5",t[t.RGBA_ASTC_6x5=mi.ASTC_RGBA_6X5]="RGBA_ASTC_6x5",t[t.RGBA_ASTC_6x6=mi.ASTC_RGBA_6X6]="RGBA_ASTC_6x6",t[t.RGBA_ASTC_8x5=mi.ASTC_RGBA_8X5]="RGBA_ASTC_8x5",t[t.RGBA_ASTC_8x6=mi.ASTC_RGBA_8X6]="RGBA_ASTC_8x6",t[t.RGBA_ASTC_8x8=mi.ASTC_RGBA_8X8]="RGBA_ASTC_8x8",t[t.RGBA_ASTC_10x5=mi.ASTC_RGBA_10X5]="RGBA_ASTC_10x5",t[t.RGBA_ASTC_10x6=mi.ASTC_RGBA_10X6]="RGBA_ASTC_10x6",t[t.RGBA_ASTC_10x8=mi.ASTC_RGBA_10X8]="RGBA_ASTC_10x8",t[t.RGBA_ASTC_10x10=mi.ASTC_RGBA_10X10]="RGBA_ASTC_10x10",t[t.RGBA_ASTC_12x10=mi.ASTC_RGBA_12X10]="RGBA_ASTC_12x10",t[t.RGBA_ASTC_12x12=mi.ASTC_RGBA_12X12]="RGBA_ASTC_12x12"}(km||(km={})),function(t){t[t.REPEAT=Di.WRAP]="REPEAT",t[t.CLAMP_TO_EDGE=Di.CLAMP]="CLAMP_TO_EDGE",t[t.MIRRORED_REPEAT=Di.MIRROR]="MIRRORED_REPEAT",t[t.CLAMP_TO_BORDER=Di.BORDER]="CLAMP_TO_BORDER"}(Um||(Um={})),function(t){t[t.NONE=Pi.NONE]="NONE",t[t.LINEAR=Pi.LINEAR]="LINEAR",t[t.NEAREST=Pi.POINT]="NEAREST"}(Gm||(Gm={})),he(mi);var nv,iv,rv,av,ov=new vt("Tex"),sv=Ec("cc.TextureBase")((tv=$m=function(t){function e(){var e;return ct(e=t.call(this)||this,"_format",Wm,at(e)),ct(e,"_minFilter",qm,at(e)),ct(e,"_magFilter",Xm,at(e)),ct(e,"_mipFilter",Ym,at(e)),ct(e,"_wrapS",Km,at(e)),ct(e,"_wrapT",Jm,at(e)),ct(e,"_wrapR",Qm,at(e)),ct(e,"_anisotropy",Zm,at(e)),e._width=1,e._height=1,e._id=void 0,e._samplerInfo=new Tr,e._gfxSampler=null,e._gfxDevice=null,e._textureHash=0,e._id=ov.getNewId(),e._gfxDevice=e._getGFXDevice(),e._textureHash=ba(e._id,666),e}$(e,t);var n=e.prototype;return n.getId=function(){return this._id},n.getPixelFormat=function(){return this._format},n.getAnisotropy=function(){return this._anisotropy},n.setWrapMode=function(t,e,n){void 0===n&&(n=t),this._wrapS=t,this._samplerInfo.addressU=t,this._wrapT=e,this._samplerInfo.addressV=e,this._wrapR=n,this._samplerInfo.addressW=n,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},n.setFilters=function(t,e){this._minFilter=t,this._samplerInfo.minFilter=t,this._magFilter=e,this._samplerInfo.magFilter=e,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},n.setMipFilter=function(t){this._mipFilter=t,this._samplerInfo.mipFilter=t,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},n.setAnisotropy=function(t){this._anisotropy=t,this._samplerInfo.maxAnisotropy=t,this._gfxDevice&&(this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo))},n.destroy=function(){var e,n=t.prototype.destroy.call(this);return n&&(null===(e=h.director.root)||void 0===e?void 0:e.batcher2D)&&h.director.root.batcher2D._releaseDescriptorSetCache(this._textureHash),n},n.getHash=function(){return this._textureHash},n.getGFXTexture=function(){return null},n.getSamplerInfo=function(){return this._samplerInfo},n.getGFXSampler=function(){return this._gfxSampler||(this._gfxDevice?this._gfxSampler=this._gfxDevice.getSampler(this._samplerInfo):O(9302)),this._gfxSampler},n._serialize=function(){return""},n._deserialize=function(t){var e=t.split(",");e.unshift(""),e.length>=5&&(this.setFilters(parseInt(e[1]),parseInt(e[2])),this.setWrapMode(parseInt(e[3]),parseInt(e[4]))),e.length>=7&&(this.setMipFilter(parseInt(e[5])),this.setAnisotropy(parseInt(e[6])))},n._getGFXDevice=function(){return h.director.root?h.director.root.device:null},n._getGFXFormat=function(){return this._getGFXPixelFormat(this._format)},n._setGFXFormat=function(t){this._format=void 0===t?km.RGBA8888:t},n._getGFXPixelFormat=function(t){return t===km.RGBA_ETC1?t=km.RGB_ETC1:t===km.RGB_A_PVRTC_4BPPV1?t=km.RGB_PVRTC_4BPPV1:t===km.RGB_A_PVRTC_2BPPV1&&(t=km.RGB_PVRTC_2BPPV1),t},Q(e,[{key:"isCompressed",get:function(){return this._format>=km.RGB_ETC1&&this._format<=km.RGBA_ASTC_12x12||this._format>=km.RGB_A_PVRTC_2BPPV1&&this._format<=km.RGBA_ETC1}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),e}($h),$m.PixelFormat=km,$m.WrapMode=Um,$m.Filter=Gm,Wm=lt((jm=tv).prototype,"_format",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return km.RGBA8888}}),qm=lt(jm.prototype,"_minFilter",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Gm.LINEAR}}),Xm=lt(jm.prototype,"_magFilter",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Gm.LINEAR}}),Ym=lt(jm.prototype,"_mipFilter",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Gm.NONE}}),Km=lt(jm.prototype,"_wrapS",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Um.REPEAT}}),Jm=lt(jm.prototype,"_wrapT",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Um.REPEAT}}),Qm=lt(jm.prototype,"_wrapR",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Um.REPEAT}}),Zm=lt(jm.prototype,"_anisotropy",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Hm=jm))||Hm;function cv(t){return!!(h.sys.hasFeature(h.sys.Feature.IMAGE_BITMAP)&&t instanceof ImageBitmap)}h.TextureBase=sv;var lv=t("ImageAsset",Ec("cc.ImageAsset")((av=rv=function(t){function e(e){var n;return(n=t.call(this)||this)._nativeData=void 0,n._exportedExts=void 0,n._format=km.RGBA8888,n._width=0,n._height=0,n._nativeData={_data:null,width:0,height:0,format:0,_compressed:!1},void 0!==e&&n.reset(e),n}$(e,t);var n=e.prototype;return n.reset=function(t){cv(t)||t instanceof HTMLElement?this._nativeData=t:(this._nativeData=t,this._format=t.format)},n.destroy=function(){return this.data&&this.data instanceof HTMLImageElement?(this.data.src="",this._setRawAsset("")):cv(this.data)&&this.data.close&&this.data.close(),t.prototype.destroy.call(this)},n._serialize=function(){},n._deserialize=function(t){var n="";"string"==typeof t?n=t:(this._width=t.w,this._height=t.h,n=t.fmt);for(var i,r=h.director.root?h.director.root.device:null,a=n.split("_"),o=Number.MAX_VALUE,s=this._format,c="",l=h.macro.SUPPORT_TEXTURE_FORMATS,u=st(a);!(i=u()).done;){var _=i.value.split("@"),f=parseInt(_[0],void 0),d=e.extnames[f]||_[0],p=l.indexOf(d);if(-1!==p&&p<o){var m=_[1]?parseInt(_[1]):this._format;if(!(".astc"!==d||r&&r.getFormatFeatures(mi.ASTC_RGBA_4X4)&Ei.SAMPLED_TEXTURE))continue;if(!(".pvr"!==d||r&&r.getFormatFeatures(mi.PVRTC_RGBA4)&Ei.SAMPLED_TEXTURE))continue;if(!(m!==km.RGB_ETC1&&m!==km.RGBA_ETC1||r&&r.getFormatFeatures(mi.ETC_RGB8)&Ei.SAMPLED_TEXTURE))continue;if(!(m!==km.RGB_ETC2&&m!==km.RGBA_ETC2||r&&r.getFormatFeatures(mi.ETC2_RGB8)&Ei.SAMPLED_TEXTURE))continue;if(".webp"===d&&!h.sys.hasFeature(h.sys.Feature.WEBP))continue;o=p,c=d,s=m}}c?(this._setRawAsset(c),this._format=s):R(3121)},n.initDefault=function(n){if(t.prototype.initDefault.call(this,n),e._sharedPlaceHolderCanvas)this.reset(e._sharedPlaceHolderCanvas);else{var i=document.createElement("canvas"),r=i.getContext("2d"),a=i.width=i.height=2;r.fillStyle="#ff00ff",r.fillRect(0,0,a,a),this.reset(i),e._sharedPlaceHolderCanvas=i}},n.validate=function(){return!!this.data},Q(e,[{key:"_nativeAsset",get:function(){return this._nativeData},set:function(t){t instanceof HTMLElement||cv(t)||(t.format=t.format||this._format),this.reset(t)}},{key:"data",get:function(){return this._nativeData&&((t=this._nativeData)instanceof HTMLImageElement||t instanceof HTMLCanvasElement||cv(t))?this._nativeData:this._nativeData&&this._nativeData._data;var t}},{key:"width",get:function(){return this._nativeData.width||this._width}},{key:"height",get:function(){return this._nativeData.height||this._height}},{key:"format",get:function(){return this._format}},{key:"isCompressed",get:function(){return this._format>=km.RGB_ETC1&&this._format<=km.RGBA_ASTC_12x12||this._format>=km.RGB_A_PVRTC_2BPPV1&&this._format<=km.RGBA_ETC1}},{key:"url",get:function(){return this.nativeUrl}}]),e}($h),rv.extnames=[".png",".jpg",".jpeg",".bmp",".webp",".pvr",".pkm",".astc"],rv._sharedPlaceHolderCanvas=null,lt((iv=av).prototype,"_nativeAsset",[hl],Object.getOwnPropertyDescriptor(iv.prototype,"_nativeAsset"),iv.prototype),nv=iv))||nv);h.ImageAsset=lv;var hv=new WeakMap,uv=new WeakSet,_v=new WeakSet;function fv(t,e){var n;n=Au.safeFindClass;var i,r=Uu.pool.get();try{i=$u(t,r,{classFinder:n,customEnv:e})}catch(t){throw A(t),Uu.pool.put(r),t}i._uuid=e.__uuid__||"";for(var a=r.uuidList,o=r.uuidObjList,s=r.uuidPropList,c=r.uuidTypeList||[],l=[],h=0;h<a.length;h++){var u=a[h];l[h]={uuid:Ll(u),owner:o[h],prop:s[h],type:re._getClassById(c[h])}}return hv.set(i,l),i._native&&uv.add(i),Uu.pool.put(r),i}var dv,pv=new(function(){function t(){this._depends=new yl}var e=t.prototype;return e.init=function(){this._depends.clear()},e.getNativeDep=function(t){var e=this._depends.get(t);return e&&e.nativeDep?Z({},e.nativeDep):null},e.getDeps=function(t){return this._depends.has(t)?this._depends.get(t).deps:[]},e.getDepsRecursively=function(t){var e=Object.create(null),n=[];return this._descend(t,e,n),n},e.remove=function(t){this._depends.remove(t)},e.parse=function(t,e){var n,i,r=null;if(Array.isArray(e)||e.__type__||e instanceof Du){if(this._depends.has(t))return this._depends.get(t);if(!Array.isArray(e)||"number"==typeof(i=(n=e[5])[n.length-1])&&i<0)try{var a=fv(e,{__uuid__:t});(r=this._parseDepsFromAsset(a)).nativeDep&&(r.nativeDep.uuid=t),Cl.add(t+"@import",a)}catch(e){bl.remove(t+"@import"),r={deps:[]}}else r={deps:this._parseDepsFromJson(e)}}else{if(this._depends.has(t)&&(r=this._depends.get(t)).parsedFromExistAsset)return r;r=this._parseDepsFromAsset(e)}return this._depends.add(t,r),r},e._parseDepsFromAsset=function(t){for(var e={deps:[],parsedFromExistAsset:!0},n=hv.get(t),i=0,r=n.length;i<r;i++)e.deps.push(n[i].uuid);return uv.has(t)&&(e.nativeDep=t._nativeDep),e},e._parseDepsFromJson=function(t){var e=function(t){return n=(e=t)[1],e[10].map((function(t){return n[t]}));var e,n}(t);return e.forEach((function(t,n){return e[n]=Ll(t)})),e},e._descend=function(t,e,n){for(var i=this.getDeps(t),r=0;r<i.length;r++){var a=i[r];e[a]||(e[a]=!0,n.push(a),this._descend(a,e,n))}},t}()),mv=[new _r];function vv(t){return t&&0==(t&t-1)}var gv,yv,xv,Sv,Av,bv,Cv=Ec("cc.SimpleTexture")(dv=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gfxTexture=null,e._gfxTextureView=null,e._mipmapLevel=1,e._textureWidth=0,e._textureHeight=0,e._baseLevel=0,e._maxLevel=1e3,e}$(e,t);var n=e.prototype;return n.getGFXTexture=function(){return this._gfxTextureView},n.destroy=function(){return this._tryDestroyTextureView(),this._tryDestroyTexture(),t.prototype.destroy.call(this)},n.updateImage=function(){this.updateMipmaps(0)},n.updateMipmaps=function(){},n.uploadData=function(t,e,n){if(void 0===e&&(e=0),void 0===n&&(n=0),this._gfxTexture&&!(this._mipmapLevel<=e)){var i=this._getGFXDevice();if(i){var r=mv[0];r.texExtent.width=this._textureWidth>>e,r.texExtent.height=this._textureHeight>>e,r.texSubres.mipLevel=e,r.texSubres.baseArrayLayer=n,ArrayBuffer.isView(t)?i.copyBuffersToTexture([t],this._gfxTexture,mv):i.copyTexImagesToTexture([t],this._gfxTexture,mv)}}},n._assignImage=function(t,e,n){var i=t.data;if(i&&(this.uploadData(i,e,n),this._checkTextureLoaded(),_e.CLEANUP_IMAGE_CACHE)){var r=pv.getDeps(this._uuid),a=r.indexOf(t._uuid);-1!==a&&(_t(r,a),t.decRef())}},n._checkTextureLoaded=function(){this._textureReady()},n._textureReady=function(){this.loaded=!0,this.emit("load")},n._setMipmapLevel=function(t){this._mipmapLevel=t<1?1:t},n._setMipRange=function(t,e){this._baseLevel=t<1?0:t,this._maxLevel=e<1?0:e},n.setMipRange=function(t,e){L(t<=e,3124),this._setMipRange(t,e);var n=this._getGFXDevice();if(n){var i=this._createTextureView(n);this._tryDestroyTextureView(),this._gfxTextureView=i}},n._getGfxTextureCreateInfo=function(){return null},n._getGfxTextureViewCreateInfo=function(){return null},n._tryReset=function(){if(this._tryDestroyTextureView(),this._tryDestroyTexture(),0!==this._mipmapLevel){var t=this._getGFXDevice();t&&(this._createTexture(t),this._gfxTextureView=this._createTextureView(t))}},n._createTexture=function(t){if(0!==this._width&&0!==this._height){var e=Ti.NONE;this._mipFilter!==Gm.NONE&&function(t,e,n){return!(t.gfxAPI===fi.WEBGL)||vv(e)&&vv(n)}(t,this._width,this._height)&&(this._mipmapLevel=function(t,e){for(var n=Math.max(t,e),i=0;n;)n>>=1,i++;return i}(this._width,this._height),e=Ti.GEN_MIPMAP);var n=this._getGfxTextureCreateInfo({usage:Ci.SAMPLED|Ci.TRANSFER_DST,format:this._getGFXFormat(),levelCount:this._mipmapLevel,flags:e});if(n){var i=t.createTexture(n);this._textureWidth=n.width,this._textureHeight=n.height,this._gfxTexture=i}}},n._createTextureView=function(t){if(!this._gfxTexture)return null;var e=this._maxLevel<this._mipmapLevel?this._maxLevel:this._mipmapLevel-1,n=this._getGfxTextureViewCreateInfo({texture:this._gfxTexture,format:this._getGFXFormat(),baseLevel:this._baseLevel,levelCount:e-this._baseLevel+1});return n?t.createTexture(n):null},n._tryDestroyTexture=function(){this._gfxTexture&&(this._gfxTexture.destroy(),this._gfxTexture=null)},n._tryDestroyTextureView=function(){this._gfxTextureView&&(this._gfxTextureView.destroy(),this._gfxTextureView=null)},Q(e,[{key:"mipmapLevel",get:function(){return this._mipmapLevel}}]),e}(sv))||dv;h.SimpleTexture=Cv;var Tv,Ev,wv,Iv,Pv,Dv,Rv,Mv=t("Texture2D",(gv=Ec("cc.Texture2D"),yv=cl([lv]),gv((bv=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_mipmaps",Av,at(e)),e}$(e,t);var n=e.prototype;return n.initialize=function(){this.mipmaps=this._mipmaps},n.onLoaded=function(){this.initialize()},n.reset=function(t){this._width=t.width,this._height=t.height,this._setGFXFormat(t.format);var e=void 0===t.mipmapLevel?1:t.mipmapLevel;this._setMipmapLevel(e);var n=void 0===t.baseLevel?0:t.baseLevel,i=void 0===t.maxLevel?1e3:t.maxLevel;this._setMipRange(n,i),this._tryReset()},n.create=function(t,e,n,i,r,a){void 0===n&&(n=km.RGBA8888),void 0===i&&(i=1),void 0===r&&(r=0),void 0===a&&(a=1e3),this.reset({width:t,height:e,format:n,mipmapLevel:i,baseLevel:r,maxLevel:a})},n.toString=function(){return 0!==this._mipmaps.length?this._mipmaps[0].url:""},n.updateMipmaps=function(t,e){if(void 0===t&&(t=0),!(t>=this._mipmaps.length))for(var n=Math.min(void 0===e?this._mipmaps.length:e,this._mipmaps.length-t),i=0;i<n;++i){var r=t+i;this._assignImage(this._mipmaps[r],r)}},n.getHtmlElementObj=function(){return this._mipmaps[0]&&this._mipmaps[0].data instanceof HTMLElement?this._mipmaps[0].data:null},n.destroy=function(){return this._mipmaps=[],t.prototype.destroy.call(this)},n.description=function(){return"<cc.Texture2D | Name = "+(this._mipmaps[0]?this._mipmaps[0].url:"")+" | Dimension = "+this.width+" x "+this.height+">"},n.releaseTexture=function(){this.destroy()},n._serialize=function(){return null},n._deserialize=function(e,n){var i=e;t.prototype._deserialize.call(this,i.base,n),this._mipmaps=new Array(i.mipmaps.length);for(var r=0;r<i.mipmaps.length;++r)if(this._mipmaps[r]=new lv,i.mipmaps[r]){var a=i.mipmaps[r];n.result.push(this._mipmaps,""+r,a,re._getClassId(lv))}},n._getGfxTextureCreateInfo=function(t){var e=new br(bi.TEX2D);return e.width=this._width,e.height=this._height,Object.assign(e,t),e},n._getGfxTextureViewCreateInfo=function(t){var e=new Cr;return e.type=bi.TEX2D,Object.assign(e,t),e},n.initDefault=function(e){t.prototype.initDefault.call(this,e);var n=new lv;n.initDefault(),this.image=n},n.validate=function(){return this.mipmaps&&0!==this.mipmaps.length},Q(e,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(t){var e=this;if(this._mipmaps=t,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var n=this._mipmaps[0];this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this._mipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel}),this._mipmaps.forEach((function(t,n){e._assignImage(t,n)}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(t){this.mipmaps=t?[t]:[]}}]),e}(Cv),Av=lt((Sv=bv).prototype,"_mipmaps",[yv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xv=Sv))||xv));h.Texture2D=Mv,function(t){t[t.right=0]="right",t[t.left=1]="left",t[t.top=2]="top",t[t.bottom=3]="bottom",t[t.front=4]="front",t[t.back=5]="back"}(Rv||(Rv={}));var Ov=t("TextureCube",Ec("cc.TextureCube")((Dv=Pv=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"isRGBE",wv,at(e)),ct(e,"_mipmaps",Iv,at(e)),e}$(e,t),e.fromTexture2DArray=function(t,n){for(var i=[],r=t.length/6,a=0;a<r;a++){var o=6*a;i.push({front:t[o+Rv.front].image,back:t[o+Rv.back].image,left:t[o+Rv.left].image,right:t[o+Rv.right].image,top:t[o+Rv.top].image,bottom:t[o+Rv.bottom].image})}return(n=n||new e).mipmaps=i,n};var n=e.prototype;return n.onLoaded=function(){this.mipmaps=this._mipmaps},n.reset=function(t){this._width=t.width,this._height=t.height,this._setGFXFormat(t.format);var e=void 0===t.mipmapLevel?1:t.mipmapLevel;this._setMipmapLevel(e);var n=void 0===t.baseLevel?0:t.baseLevel,i=void 0===t.maxLevel?1e3:t.maxLevel;this._setMipRange(n,i),this._tryReset()},n.updateMipmaps=function(t,e){var n=this;if(void 0===t&&(t=0),!(t>=this._mipmaps.length))for(var i=Math.min(void 0===e?this._mipmaps.length:e,this._mipmaps.length-t),r=function(e){var i=t+e;Nv(n._mipmaps[i],(function(t,e){n._assignImage(t,i,e)}))},a=0;a<i;++a)r(a)},n.destroy=function(){return this._mipmaps=[],t.prototype.destroy.call(this)},n.releaseTexture=function(){this.mipmaps=[]},n._serialize=function(){return null},n._deserialize=function(e,n){var i=e;t.prototype._deserialize.call(this,i.base,n),this.isRGBE=i.rgbe,this._mipmaps=new Array(i.mipmaps.length);for(var r=0;r<i.mipmaps.length;++r){this._mipmaps[r]={front:new lv,back:new lv,left:new lv,right:new lv,top:new lv,bottom:new lv};var a=i.mipmaps[r],o=re._getClassId(lv);n.result.push(this._mipmaps[r],"front",a.front,o),n.result.push(this._mipmaps[r],"back",a.back,o),n.result.push(this._mipmaps[r],"left",a.left,o),n.result.push(this._mipmaps[r],"right",a.right,o),n.result.push(this._mipmaps[r],"top",a.top,o),n.result.push(this._mipmaps[r],"bottom",a.bottom,o)}},n._getGfxTextureCreateInfo=function(t){var e=new br(bi.CUBE);return e.width=this._width,e.height=this._height,e.layerCount=6,Object.assign(e,t),e},n._getGfxTextureViewCreateInfo=function(t){var e=new Cr;return e.type=bi.CUBE,e.baseLayer=0,e.layerCount=6,Object.assign(e,t),e},n.initDefault=function(e){t.prototype.initDefault.call(this,e);var n=new lv;n.initDefault(),this.mipmaps=[{front:n,back:n,top:n,bottom:n,left:n,right:n}]},n.validate=function(){return 0!==this._mipmaps.length&&!this._mipmaps.find((function(t){return!(t.top&&t.bottom&&t.front&&t.back&&t.left&&t.right)}))},Q(e,[{key:"mipmaps",get:function(){return this._mipmaps},set:function(t){var e=this;if(this._mipmaps=t,this._setMipmapLevel(this._mipmaps.length),this._mipmaps.length>0){var n=this._mipmaps[0].front;this.reset({width:n.width,height:n.height,format:n.format,mipmapLevel:this._mipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel}),this._mipmaps.forEach((function(t,n){Nv(t,(function(t,i){e._assignImage(t,n,i)}))}))}else this.reset({width:0,height:0,mipmapLevel:this._mipmaps.length,baseLevel:this._baseLevel,maxLevel:this._maxLevel})}},{key:"image",get:function(){return 0===this._mipmaps.length?null:this._mipmaps[0]},set:function(t){this.mipmaps=t?[t]:[]}}]),e}(Cv),Pv.FaceIndex=Rv,wv=lt((Ev=Dv).prototype,"isRGBE",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Iv=lt(Ev.prototype,"_mipmaps",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Tv=Ev))||Tv);function Nv(t,e){e(t.front,Rv.front),e(t.back,Rv.back),e(t.left,Rv.left),e(t.right,Rv.right),e(t.top,Rv.top),e(t.bottom,Rv.bottom)}h.TextureCube=Ov;var Bv,Lv,Fv,Vv=t("effects",[{name:"billboard",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"billboard|vert:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"billboard|vert:vs_main|tinted-fs:add",hash:3642336485,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:54,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:21,location:1},{name:"a_color",defines:[],format:44,location:2}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1},{name:"nodeRotation",type:16,count:1}]},{name:"builtin",defines:[],binding:1,stageFlags:1,members:[{name:"cc_size_rotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:2,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:3}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"clear-stencil",techniques:[{passes:[{blendState:{targets:[{blend:!0}]},rasterizerState:{cullMode:0},program:"clear-stencil|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"clear-stencil|sprite-vs:vert|sprite-fs:frag",hash:3507038093,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:0,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"geometry-renderer",techniques:[{passes:[{primitive:1,blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"geometry-renderer|line-vs:vert|line-fs:front",priority:245,depthStencilState:{depthTest:!1,depthWrite:!1}}]},{passes:[{primitive:1,blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"geometry-renderer|line-vs:vert|line-fs:front",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1}},{primitive:1,blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"geometry-renderer|line-vs:vert|line-fs:back",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1,depthFunc:4}}]},{passes:[{primitive:1,blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"geometry-renderer|dashed-line-vs:vert|dashed-line-fs:front",priority:245,depthStencilState:{depthTest:!1,depthWrite:!1}}]},{passes:[{primitive:1,blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"geometry-renderer|dashed-line-vs:vert|dashed-line-fs:front",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1}},{primitive:1,blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"geometry-renderer|dashed-line-vs:vert|dashed-line-fs:back",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1,depthFunc:4}}]},{passes:[{rasterizerState:{cullMode:2},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"geometry-renderer|triangle-vs:vert|triangle-fs:front",priority:245,depthStencilState:{depthTest:!1,depthWrite:!1}}]},{passes:[{rasterizerState:{cullMode:2},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"geometry-renderer|triangle-vs:vert|triangle-fs:front",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1}},{rasterizerState:{cullMode:2},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"geometry-renderer|triangle-vs:vert|triangle-fs:back",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1,depthFunc:4}}]}],shaders:[{name:"geometry-renderer|line-vs:vert|line-fs:front",hash:3617431e3,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"USE_FORWARD_PIPELINE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_color",defines:[],format:44,location:1}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"geometry-renderer|line-vs:vert|line-fs:back",hash:4168905198,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"USE_FORWARD_PIPELINE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_color",defines:[],format:44,location:1}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"geometry-renderer|dashed-line-vs:vert|dashed-line-fs:front",hash:4034582016,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"USE_FORWARD_PIPELINE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_color",defines:[],format:44,location:1}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"geometry-renderer|dashed-line-vs:vert|dashed-line-fs:back",hash:1762165009,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"USE_FORWARD_PIPELINE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_color",defines:[],format:44,location:1}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"geometry-renderer|triangle-vs:vert|triangle-fs:front",hash:4143142643,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"USE_FORWARD_PIPELINE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:44,location:1},{name:"a_color",defines:[],format:44,location:2}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"geometry-renderer|triangle-vs:vert|triangle-fs:back",hash:826026446,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"USE_FORWARD_PIPELINE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:44,location:1},{name:"a_color",defines:[],format:44,location:2}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"graphics",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:1,blendDst:4,blendSrcAlpha:1,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"graphics|vs:vert|fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"graphics|vs:vert|fs:frag",hash:4284763886,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:49,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_color",defines:[],format:44,location:1},{name:"a_dist",defines:[],format:11,location:2}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"occlusion-query",techniques:[{passes:[{rasterizerState:{cullMode:2},blendState:{targets:[{blendColorMask:0}]},program:"occlusion-query|occlusion-query-vs:vert|occlusion-query-fs:frag",depthStencilState:{depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"occlusion-query|occlusion-query-vs:vert|occlusion-query-fs:frag",hash:1571978323,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:41,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCWorldBound",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"particle-gpu",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-gpu|particle-vs-gpu:gpvs_main|tinted-fs:add",hash:851293782,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:64,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"USE_VK_SHADER",type:"boolean"},{name:"COLOR_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"ROTATION_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"SIZE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"FORCE_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"VELOCITY_OVER_TIME_MODULE_ENABLE",type:"boolean"},{name:"TEXTURE_ANIMATION_MODULE_ENABLE",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"}],attributes:[{name:"a_position_starttime",defines:[],format:44,location:0},{name:"a_size_uv",defines:[],format:44,location:1},{name:"a_rotation_uv",defines:[],format:44,location:2},{name:"a_color",defines:[],format:44,location:3},{name:"a_dir_life",defines:[],format:44,location:4},{name:"a_rndSeed",defines:[],format:11,location:5},{name:"a_texCoord",defines:["CC_RENDER_MODE"],format:32,location:6},{name:"a_texCoord3",defines:["CC_RENDER_MODE"],format:32,location:7},{name:"a_normal",defines:["CC_RENDER_MODE"],format:32,location:8},{name:"a_color1",defines:["CC_RENDER_MODE"],format:44,location:9}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1},{name:"nodeRotation",type:16,count:1}]},{name:"SampleConstants",defines:[],binding:1,stageFlags:1,members:[{name:"u_sampleInfo",type:16,count:1}]},{name:"TickConstants",defines:[],binding:2,stageFlags:1,members:[{name:"u_worldRot",type:16,count:1},{name:"u_timeDelta",type:16,count:1}]},{name:"ColorConstant",defines:["COLOR_OVER_TIME_MODULE_ENABLE"],binding:3,stageFlags:1,members:[{name:"u_color_mode",type:5,count:1}]},{name:"RotationConstant",defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],binding:4,stageFlags:1,members:[{name:"u_rotation_mode",type:5,count:1}]},{name:"SizeConstant",defines:["SIZE_OVER_TIME_MODULE_ENABLE"],binding:5,stageFlags:1,members:[{name:"u_size_mode",type:5,count:1}]},{name:"ForceConstant",defines:["FORCE_OVER_TIME_MODULE_ENABLE"],binding:6,stageFlags:1,members:[{name:"u_force_mode",type:5,count:1},{name:"u_force_space",type:5,count:1}]},{name:"VelocityConstant",defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],binding:7,stageFlags:1,members:[{name:"u_velocity_mode",type:5,count:1},{name:"u_velocity_space",type:5,count:1}]},{name:"AnimationConstant",defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],binding:8,stageFlags:1,members:[{name:"u_anim_info",type:16,count:1}]},{name:"FragConstants",defines:[],binding:9,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"color_over_time_tex0",type:28,count:1,defines:["COLOR_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:10},{name:"rotation_over_time_tex0",type:28,count:1,defines:["ROTATION_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:11},{name:"size_over_time_tex0",type:28,count:1,defines:["SIZE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:12},{name:"force_over_time_tex0",type:28,count:1,defines:["FORCE_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:13},{name:"velocity_over_time_tex0",type:28,count:1,defines:["VELOCITY_OVER_TIME_MODULE_ENABLE"],stageFlags:1,binding:14},{name:"texture_animation_tex0",type:28,count:1,defines:["TEXTURE_ANIMATION_MODULE_ENABLE"],stageFlags:1,binding:15},{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:16}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"particle-trail",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle-trail|particle-trail:vs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},frameTile_velLenScale:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle-trail|particle-trail:vs_main|tinted-fs:add",hash:2502358098,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:53,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_DRAW_WIRE_FRAME",type:"boolean"},{name:"CC_USE_WORLD_SPACE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:44,location:1},{name:"a_texCoord1",defines:[],format:32,location:2},{name:"a_texCoord2",defines:[],format:32,location:3},{name:"a_color",defines:[],format:44,location:4}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1},{name:"nodeRotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"particle",techniques:[{name:"add",passes:[{rasterizerState:{cullMode:0},blendState:{targets:[{blend:!0,blendSrc:2,blendDst:1,blendSrcAlpha:2,blendDstAlpha:1}]},program:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",depthStencilState:{depthTest:!0,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},mainTiling_Offset:{value:[1,1,0,0],type:16},tintColor:{value:[.5,.5,.5,.5],type:16}}}]}],shaders:[{name:"particle|particle-vs-legacy:lpvs_main|tinted-fs:add",hash:585841727,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:53,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"CC_RENDER_MODE",type:"number",range:[0,4]},{name:"CC_USE_WORLD_SPACE",type:"boolean"},{name:"ROTATION_OVER_TIME_MODULE_ENABLE",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:32,location:1},{name:"a_texCoord1",defines:[],format:32,location:2},{name:"a_texCoord2",defines:[],format:32,location:3},{name:"a_color",defines:[],format:44,location:4},{name:"a_color1",defines:["CC_RENDER_MODE"],format:32,location:8},{name:"a_texCoord3",defines:["CC_RENDER_MODE"],format:32,location:6},{name:"a_normal",defines:["CC_RENDER_MODE"],format:32,location:7}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"mainTiling_Offset",type:16,count:1},{name:"frameTile_velLenScale",type:16,count:1},{name:"scale",type:16,count:1},{name:"nodeRotation",type:16,count:1}]},{name:"FragConstants",defines:[],binding:1,stageFlags:16,members:[{name:"tintColor",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"spine",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"spine|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"spine|sprite-vs:vert|sprite-fs:frag",hash:2499219289,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:49,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:1},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplerTextures:[{name:"cc_spriteTexture",defines:[]}],buffers:[],images:[]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"TWO_COLORED",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:21,location:1},{name:"a_color",defines:[],format:44,location:2},{name:"a_color2",defines:["TWO_COLORED"],format:44,location:3}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"sprite",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"sprite|sprite-vs:vert|sprite-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{alphaThreshold:{value:[.5],type:13}}}]}],shaders:[{name:"sprite|sprite-vs:vert|sprite-fs:frag",hash:67215139,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:49,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:1},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:["USE_LOCAL"]}],samplerTextures:[{name:"cc_spriteTexture",defines:["USE_TEXTURE"]}],buffers:[],images:[]}},defines:[{name:"USE_LOCAL",type:"boolean"},{name:"SAMPLE_FROM_RT",type:"boolean"},{name:"USE_PIXEL_ALIGNMENT",type:"boolean"},{name:"CC_USE_EMBEDDED_ALPHA",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"IS_GRAY",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_texCoord",defines:[],format:21,location:1},{name:"a_color",defines:[],format:44,location:2}],blocks:[{name:"ALPHA_TEST_DATA",defines:["USE_ALPHA_TEST"],binding:0,stageFlags:16,members:[{name:"alphaThreshold",type:13,count:1}]}],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"standard",techniques:[{name:"opaque",passes:[{program:"standard|standard-vs|standard-fs",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],linear:!0,type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},occlusion:{value:[1],type:13,handleInfo:["pbrParams",0,13]},roughness:{value:[.8],type:13,handleInfo:["pbrParams",1,13]},metallic:{value:[.6],type:13,handleInfo:["pbrParams",2,13]},specularIntensity:{value:[.5],type:13,handleInfo:["pbrParams",3,13]},emissive:{value:[0,0,0,1],linear:!0,type:16},emissiveScale:{value:[1,1,1],type:15,handleInfo:["emissiveScaleParam",0,15]},normalStrength:{value:[1],type:13,handleInfo:["emissiveScaleParam",3,13]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},normalMap:{value:"normal",type:28},pbrMap:{value:"grey",type:28},metallicRoughnessMap:{value:"grey",type:28},occlusionMap:{value:"white",type:28},emissiveMap:{value:"grey",type:28},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},pbrParams:{type:16,value:[1,.8,.6,.5]},emissiveScaleParam:{type:16,value:[1,1,1,1]},albedoMap:{type:28,value:"grey"}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"standard|standard-vs|standard-fs",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1}},{phase:"shadow-caster",propertyIndex:0,rasterizerState:{cullMode:1},program:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",properties:{tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],type:16,handleInfo:["albedo",0,16]},albedoScale:{value:[1,1,1],type:15,handleInfo:["albedoScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["albedoScaleAndCutoff",3,13]},mainTexture:{value:"grey",type:28,handleInfo:["albedoMap",0,28]},albedo:{type:16,value:[1,1,1,1]},albedoScaleAndCutoff:{type:16,value:[1,1,1,.5]},albedoMap:{type:28,value:"grey"}}}]}],shaders:[{name:"standard|standard-vs|standard-fs",hash:4079105024,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:223,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:75},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_diffuseMap",defines:["CC_USE_DIFFUSEMAP"]}],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"cc_lightingMap",defines:["CC_USE_LIGHTMAP","!USE_BATCHING","!CC_FORWARD_ADD"]}],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_USE_ACCURATE_FOG",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"USE_NORMAL_MAP",type:"boolean"},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"USE_TWOSIDE",type:"boolean"},{name:"SAMPLE_FROM_RT",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_DIFFUSEMAP",type:"number",range:[0,2]},{name:"USE_REFLECTION_DENOISE",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"NORMAL_UV",type:"string",options:["v_uv","v_uv1"]},{name:"PBR_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_PBR_MAP",type:"boolean"},{name:"USE_METALLIC_ROUGHNESS_MAP",type:"boolean"},{name:"USE_OCCLUSION_MAP",type:"boolean"},{name:"USE_EMISSIVE_MAP",type:"boolean"},{name:"EMISSIVE_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]},{name:"CC_PIPELINE_TYPE",type:"number",range:[0,1]},{name:"CC_FORCE_FORWARD_SHADING",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13},{name:"a_color",defines:["USE_VERTEX_COLOR"],format:44,location:14},{name:"a_texCoord1",defines:[],format:21,location:15}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplerTextures:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1},{name:"normalMap",type:28,count:1,defines:["USE_NORMAL_MAP"],stageFlags:16,binding:2},{name:"pbrMap",type:28,count:1,defines:["USE_PBR_MAP"],stageFlags:16,binding:3},{name:"metallicRoughnessMap",type:28,count:1,defines:["USE_METALLIC_ROUGHNESS_MAP"],stageFlags:16,binding:4},{name:"occlusionMap",type:28,count:1,defines:["USE_OCCLUSION_MAP"],stageFlags:16,binding:5},{name:"emissiveMap",type:28,count:1,defines:["USE_EMISSIVE_MAP"],stageFlags:16,binding:6}],buffers:[{name:"b_ccLightsBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:7},{name:"b_clusterLightIndicesBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:8},{name:"b_clusterLightGridBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:9}],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"standard|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:3928335406,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:184,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:75},globals:{blocks:[{name:"CCShadow",defines:[]},{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]}],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"HAS_SECOND_UV",type:"boolean"},{name:"USE_ALBEDO_MAP",type:"boolean"},{name:"ALBEDO_UV",type:"string",options:["v_uv","v_uv1"]},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r"]}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13},{name:"a_texCoord1",defines:[],format:21,location:14}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:17,members:[{name:"tilingOffset",type:16,count:1},{name:"albedo",type:16,count:1},{name:"albedoScaleAndCutoff",type:16,count:1},{name:"pbrParams",type:16,count:1},{name:"emissive",type:16,count:1},{name:"emissiveScaleParam",type:16,count:1}]}],samplerTextures:[{name:"albedoMap",type:28,count:1,defines:["USE_ALBEDO_MAP"],stageFlags:16,binding:1}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"terrain",techniques:[{name:"opaque",passes:[{program:"terrain|terrain-vs|terrain-fs",properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal",type:28},normalMap1:{value:"normal",type:28},normalMap2:{value:"normal",type:28},normalMap3:{value:"normal",type:28},lightMap:{value:"grey",type:28}}},{phase:"forward-add",propertyIndex:0,embeddedMacros:{CC_FORWARD_ADD:!0},blendState:{targets:[{blend:!0,blendSrc:1,blendDst:1,blendSrcAlpha:0,blendDstAlpha:1}]},program:"terrain|terrain-vs|terrain-fs",depthStencilState:{depthFunc:2,depthTest:!0,depthWrite:!1},properties:{UVScale:{value:[1,1,1,1],type:16},lightMapUVParam:{value:[0,0,0,0],type:16},metallic:{value:[0,0,0,0],type:16},roughness:{value:[1,1,1,1],type:16},weightMap:{value:"black",type:28},detailMap0:{value:"grey",type:28},detailMap1:{value:"grey",type:28},detailMap2:{value:"grey",type:28},detailMap3:{value:"grey",type:28},normalMap0:{value:"normal",type:28},normalMap1:{value:"normal",type:28},normalMap2:{value:"normal",type:28},normalMap3:{value:"normal",type:28},lightMap:{value:"grey",type:28}}},{phase:"shadow-add",propertyIndex:0,rasterizerState:{cullMode:2},program:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag"}]}],shaders:[{name:"terrain|terrain-vs|terrain-fs",hash:3669699677,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:71,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:71},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_diffuseMap",defines:["CC_USE_DIFFUSEMAP"]}],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]},{name:"CCForwardLight",defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"]}],samplerTextures:[{name:"cc_lightingMap",defines:["CC_USE_LIGHTMAP","!USE_BATCHING","!CC_FORWARD_ADD"]}],buffers:[],images:[]}},defines:[{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_USE_ACCURATE_FOG",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_DIFFUSEMAP",type:"number",range:[0,2]},{name:"USE_REFLECTION_DENOISE",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"LAYERS",type:"number",range:[0,4]},{name:"USE_NORMALMAP",type:"boolean"},{name:"USE_PBR",type:"boolean"},{name:"CC_PIPELINE_TYPE",type:"number",range:[0,1]},{name:"CC_FORCE_FORWARD_SHADING",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2}],blocks:[{name:"TexCoords",defines:[],binding:0,stageFlags:1,members:[{name:"UVScale",type:16,count:1},{name:"lightMapUVParam",type:16,count:1}]},{name:"PbrParams",defines:[],binding:1,stageFlags:16,members:[{name:"metallic",type:16,count:1},{name:"roughness",type:16,count:1}]}],samplerTextures:[{name:"weightMap",type:28,count:1,defines:[],stageFlags:16,binding:2},{name:"detailMap0",type:28,count:1,defines:[],stageFlags:16,binding:3},{name:"detailMap1",type:28,count:1,defines:[],stageFlags:16,binding:4},{name:"detailMap2",type:28,count:1,defines:[],stageFlags:16,binding:5},{name:"detailMap3",type:28,count:1,defines:[],stageFlags:16,binding:6},{name:"normalMap0",type:28,count:1,defines:[],stageFlags:16,binding:7},{name:"normalMap1",type:28,count:1,defines:[],stageFlags:16,binding:8},{name:"normalMap2",type:28,count:1,defines:[],stageFlags:16,binding:9},{name:"normalMap3",type:28,count:1,defines:[],stageFlags:16,binding:10},{name:"lightMap",type:28,count:1,defines:[],stageFlags:16,binding:11}],buffers:[{name:"b_ccLightsBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:12},{name:"b_clusterLightIndicesBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:13},{name:"b_clusterLightGridBuffer",memoryAccess:1,defines:["CC_FORWARD_ADD","CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:14}],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"terrain|shadow-caster-vs:vert|shadow-caster-fs:frag",hash:2218105608,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:69,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:0},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]}],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"unlit",techniques:[{name:"opaque",passes:[{program:"unlit|unlit-vs:vert|unlit-fs:frag",properties:{mainTexture:{value:"grey",type:28},tilingOffset:{value:[1,1,0,0],type:16},mainColor:{value:[1,1,1,1],linear:!0,type:16},colorScale:{value:[1,1,1],type:15,handleInfo:["colorScaleAndCutoff",0,15]},alphaThreshold:{value:[.5],type:13,handleInfo:["colorScaleAndCutoff",3,13]},color:{linear:!0,type:16,handleInfo:["mainColor",0,16]},colorScaleAndCutoff:{type:16,value:[1,1,1,.5]}}}]}],shaders:[{name:"unlit|unlit-vs:vert|unlit-fs:frag",hash:3152709001,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:198,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:41},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]},{name:"CC_USE_ACCURATE_FOG",type:"boolean"},{name:"USE_VERTEX_COLOR",type:"boolean"},{name:"USE_TEXTURE",type:"boolean"},{name:"SAMPLE_FROM_RT",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_ALPHA_TEST",type:"boolean"},{name:"ALPHA_TEST_CHANNEL",type:"string",options:["a","r","g","b"]}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13},{name:"a_color",defines:["USE_VERTEX_COLOR"],format:44,location:14}],blocks:[{name:"TexCoords",defines:["USE_TEXTURE"],binding:0,stageFlags:1,members:[{name:"tilingOffset",type:16,count:1}]},{name:"Constant",defines:[],binding:1,stageFlags:16,members:[{name:"mainColor",type:16,count:1},{name:"colorScaleAndCutoff",type:16,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:["USE_TEXTURE"],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"bloom",techniques:[{passes:[{phase:"bloom-prefilter",program:"bloom|bloom-vs|prefilter-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-downsample",program:"bloom|bloom-vs|downsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-upsample",program:"bloom|bloom-vs|upsample-fs",depthStencilState:{depthTest:!1,depthWrite:!1}},{phase:"bloom-combine",program:"bloom|bloom-vs|combine-fs",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"bloom|bloom-vs|prefilter-fs",hash:837263906,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13}],blocks:[{name:"BloomUBO",defines:[],binding:0,stageFlags:16,members:[{name:"texSize",type:16,count:1}]}],samplerTextures:[{name:"outputResultMap",type:28,count:1,defines:[],stageFlags:16,binding:1}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"bloom|bloom-vs|downsample-fs",hash:682261797,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13}],blocks:[{name:"BloomUBO",defines:[],binding:0,stageFlags:16,members:[{name:"texSize",type:16,count:1}]}],samplerTextures:[{name:"bloomTexture",type:28,count:1,defines:[],stageFlags:16,binding:1}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"bloom|bloom-vs|upsample-fs",hash:3663548873,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13}],blocks:[{name:"BloomUBO",defines:[],binding:0,stageFlags:16,members:[{name:"texSize",type:16,count:1}]}],samplerTextures:[{name:"bloomTexture",type:28,count:1,defines:[],stageFlags:16,binding:1}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]},{name:"bloom|bloom-vs|combine-fs",hash:670444562,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:40},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13}],blocks:[{name:"BloomUBO",defines:[],binding:0,stageFlags:16,members:[{name:"texSize",type:16,count:1}]}],samplerTextures:[{name:"outputResultMap",type:28,count:1,defines:[],stageFlags:16,binding:1},{name:"bloomTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"deferred-lighting",techniques:[{passes:[{phase:"deferred-lighting",program:"deferred-lighting|lighting-vs|lighting-fs",depthStencilState:{depthFunc:4,depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"deferred-lighting|lighting-vs|lighting-fs",hash:2587574837,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:69},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[{name:"cc_shadowMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_spotLightingMap",defines:["CC_RECEIVE_SHADOW"]},{name:"cc_environment",defines:["CC_USE_IBL"]},{name:"cc_diffuseMap",defines:["CC_USE_DIFFUSEMAP"]}],buffers:[],images:[]},locals:{blocks:[{name:"CCLocal",defines:[]},{name:"CCForwardLight",defines:["CC_ENABLE_CLUSTERED_LIGHT_CULLING"]}],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_DIFFUSEMAP",type:"number",range:[0,2]},{name:"USE_REFLECTION_DENOISE",type:"boolean"},{name:"CC_FORWARD_ADD",type:"boolean"},{name:"CC_PIPELINE_TYPE",type:"number",range:[0,1]},{name:"CC_FORCE_FORWARD_SHADING",type:"boolean"},{name:"CC_USE_HDR",type:"boolean"},{name:"CC_USE_FOG",type:"number",range:[0,4]}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13}],blocks:[],samplerTextures:[],buffers:[{name:"b_ccLightsBuffer",memoryAccess:1,defines:["CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:4},{name:"b_clusterLightIndicesBuffer",memoryAccess:1,defines:["CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:5},{name:"b_clusterLightGridBuffer",memoryAccess:1,defines:["CC_ENABLE_CLUSTERED_LIGHT_CULLING"],stageFlags:16,binding:6}],images:[],textures:[],samplers:[],subpassInputs:[{name:"gbuffer_albedoMap",count:1,defines:["CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT"],stageFlags:16,binding:0},{name:"gbuffer_normalMap",count:1,defines:["CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT"],stageFlags:16,binding:1},{name:"gbuffer_emissiveMap",count:1,defines:["CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT"],stageFlags:16,binding:2},{name:"depth_stencil",count:1,defines:["CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT"],stageFlags:16,binding:3}]}]},{name:"planar-shadow",techniques:[{passes:[{phase:"planarShadow",blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},program:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",depthStencilState:{depthTest:!0,depthWrite:!1,stencilTestFront:!0,stencilFuncFront:5,stencilPassOpFront:2,stencilRefBack:128,stencilRefFront:128,stencilReadMaskBack:128,stencilReadMaskFront:128,stencilWriteMaskBack:128,stencilWriteMaskFront:128}}]}],shaders:[{name:"planar-shadow|planar-shadow-vs:vert|planar-shadow-fs:frag",hash:3542426468,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:217,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:59},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]},{name:"CCShadow",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]},{name:"CCLocalBatched",defines:["!USE_INSTANCING","USE_BATCHING"]},{name:"CCLocal",defines:["!USE_INSTANCING","!USE_BATCHING"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"post-process",techniques:[{passes:[{phase:"post-process",blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendSrcAlpha:2,blendDstAlpha:4}]},program:"post-process|post-process-vs|post-process-fs",depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"post-process|post-process-vs|post-process-fs",hash:2960965003,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:147,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[{name:"CCMorph",defines:["CC_USE_MORPH"]},{name:"CCSkinningTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinningAnimation",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]},{name:"CCSkinning",defines:["CC_USE_SKINNING","!CC_USE_BAKED_ANIMATION"]}],samplerTextures:[{name:"cc_PositionDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_POSITION"]},{name:"cc_NormalDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_NORMAL"]},{name:"cc_TangentDisplacements",defines:["CC_USE_MORPH","CC_MORPH_TARGET_HAS_TANGENT"]},{name:"cc_jointTexture",defines:["CC_USE_SKINNING","CC_USE_BAKED_ANIMATION"]}],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_MORPH_TARGET_COUNT",type:"number",range:[2,8]},{name:"CC_MORPH_PRECOMPUTED",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_POSITION",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_NORMAL",type:"boolean"},{name:"CC_MORPH_TARGET_HAS_TANGENT",type:"boolean"},{name:"ANTIALIAS_TYPE",type:"number",range:[0,3]}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13}],blocks:[],samplerTextures:[{name:"outputResultMap",type:28,count:1,defines:[],stageFlags:16,binding:0}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"skybox",techniques:[{passes:[{rasterizerState:{cullMode:0},program:"skybox|sky-vs:vert|sky-fs:frag",priority:245,depthStencilState:{depthTest:!0,depthWrite:!1}}]}],shaders:[{name:"skybox|sky-vs:vert|sky-fs:frag",hash:2207113861,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:39,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[{name:"cc_environment",defines:[]}],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[{name:"USE_INSTANCING",type:"boolean"},{name:"USE_BATCHING",type:"boolean"},{name:"CC_USE_SKINNING",type:"boolean"},{name:"CC_USE_BAKED_ANIMATION",type:"boolean"},{name:"CC_USE_LIGHTMAP",type:"boolean"},{name:"CC_RECEIVE_SHADOW",type:"boolean"},{name:"CC_USE_MORPH",type:"boolean"},{name:"CC_USE_IBL",type:"number",range:[0,2]},{name:"CC_USE_HDR",type:"boolean"},{name:"USE_RGBE_CUBEMAP",type:"boolean"}],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_normal",defines:[],format:32,location:1},{name:"a_texCoord",defines:[],format:21,location:2},{name:"a_tangent",defines:[],format:44,location:3},{name:"a_joints",defines:["CC_USE_SKINNING"],location:4},{name:"a_weights",defines:["CC_USE_SKINNING"],format:44,location:5},{name:"a_jointAnimInfo",defines:["USE_INSTANCING","CC_USE_BAKED_ANIMATION"],format:44,isInstanced:!0,location:6},{name:"a_matWorld0",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:7},{name:"a_matWorld1",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:8},{name:"a_matWorld2",defines:["USE_INSTANCING"],format:44,isInstanced:!0,location:9},{name:"a_lightingMapUVParam",defines:["USE_INSTANCING","CC_USE_LIGHTMAP"],format:44,isInstanced:!0,location:10},{name:"a_localShadowBias",defines:["USE_INSTANCING","CC_RECEIVE_SHADOW"],format:21,isInstanced:!0,location:11},{name:"a_dyn_batch_id",defines:["!USE_INSTANCING","USE_BATCHING"],format:11,location:12},{name:"a_vertexId",defines:["CC_USE_MORPH"],format:11,location:13}],blocks:[],samplerTextures:[],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"profiler",techniques:[{passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"profiler|profiler-vs:vert|profiler-fs:frag",priority:255,depthStencilState:{depthTest:!1,depthWrite:!1}}]}],shaders:[{name:"profiler|profiler-vs:vert|profiler-fs:frag",hash:179162168,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:60,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:39},globals:{blocks:[{name:"CCGlobal",defines:[]},{name:"CCCamera",defines:[]}],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:32,location:0},{name:"a_color",defines:[],format:44,location:1}],blocks:[{name:"Constants",defines:[],binding:0,stageFlags:1,members:[{name:"offset",type:16,count:1}]},{name:"PerFrameInfo",defines:[],binding:1,stageFlags:1,members:[{name:"digits",type:16,count:20}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]},{name:"splash-screen",techniques:[{name:"default",passes:[{blendState:{targets:[{blend:!0,blendSrc:2,blendDst:4,blendDstAlpha:4}]},rasterizerState:{cullMode:0},program:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",depthStencilState:{depthTest:!1,depthWrite:!1},properties:{mainTexture:{value:"grey",type:28},resolution:{value:[640,960],type:14,handleInfo:["u_buffer0",0,14]},percent:{value:[.5],type:13,handleInfo:["u_percent",0,13]},scale:{value:[200,500],type:14,handleInfo:["u_buffer1",0,14]},translate:{value:[320,480],type:14,handleInfo:["u_buffer1",2,14]},u_buffer0:{type:16,value:[640,960,0,0]},u_percent:{type:13,value:[.5]},u_buffer1:{type:16,value:[200,500,320,480]}}}]}],shaders:[{name:"splash-screen|splash-screen-vs:vert|splash-screen-fs:frag",hash:3189094080,builtins:{statistics:{CC_EFFECT_USED_VERTEX_UNIFORM_VECTORS:6,CC_EFFECT_USED_FRAGMENT_UNIFORM_VECTORS:1},globals:{blocks:[],samplerTextures:[],buffers:[],images:[]},locals:{blocks:[],samplerTextures:[],buffers:[],images:[]}},defines:[],attributes:[{name:"a_position",defines:[],format:21,location:0},{name:"a_texCoord",defines:[],format:21,location:1}],blocks:[{name:"Constant",defines:[],binding:0,stageFlags:1,members:[{name:"u_buffer0",type:16,count:1},{name:"u_buffer1",type:16,count:1},{name:"u_projection",type:25,count:1}]},{name:"Factor",defines:[],binding:1,stageFlags:16,members:[{name:"u_percent",type:13,count:1}]}],samplerTextures:[{name:"mainTexture",type:28,count:1,defines:[],stageFlags:16,binding:2}],buffers:[],images:[],textures:[],samplers:[],subpassInputs:[]}]}]),zv={glsl1:[[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n, mat4 viewInv\n) {\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nuniform vec4 cc_size_rotation;\nvec4 vs_main() {\nvec4 pos = vec4(a_position, 1);\npos = cc_matWorld * pos;\nvec2 vertOffset = a_texCoord.xy - 0.5;\ncomputeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\npos = cc_matViewProj * pos;\nuv = a_texCoord.xy;\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nattribute vec3 a_position;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\nvec4 o = vec4(1.0);\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nattribute highp vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\npos.z -= 0.000001;\nv_color = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec4 v_color;\nvec4 front() {\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(v_color);\n#else\nreturn v_color;\n#endif\n}\nvoid main() { gl_FragColor = front(); }"},{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nattribute highp vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\npos.z -= 0.000001;\nv_color = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec4 v_color;\nvec4 back() {\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(vec4(v_color.rgb, v_color.a * 0.2));\n#else\nreturn vec4(v_color.rgb, v_color.a * 0.2);\n#endif\n}\nvoid main() { gl_FragColor = back(); }"},{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nattribute highp vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nvarying float v_distance;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\npos.z -= 0.000001;\nv_color = a_color;\nv_distance = dot(a_position, vec3(1.0, 1.0, 1.0));\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec4 v_color;\nvarying float v_distance;\nvec4 front() {\nif (fract(v_distance) > 0.5) {\ndiscard;\n}\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(v_color);\n#else\nreturn v_color;\n#endif\n}\nvoid main() { gl_FragColor = front(); }"},{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nattribute highp vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nvarying float v_distance;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\npos.z -= 0.000001;\nv_color = a_color;\nv_distance = dot(a_position, vec3(1.0, 1.0, 1.0));\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec4 v_color;\nvarying float v_distance;\nvec4 back() {\nif (fract(v_distance) > 0.5) {\ndiscard;\n}\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(vec4(v_color.rgb, v_color.a * 0.2));\n#else\nreturn vec4(v_color.rgb, v_color.a * 0.2);\n#endif\n}\nvoid main() { gl_FragColor = back(); }"},{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nattribute highp vec3 a_position;\nattribute vec4 a_normal;\nattribute vec4 a_color;\nvarying vec4 v_color;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\nv_color = a_color;\nfloat intensity = dot(vec3(1, 2, 4), a_normal.xyz);\nv_color.rgb -= a_normal.w * intensity * 0.1;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec4 v_color;\nvec4 front() {\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(v_color);\n#else\nreturn v_color;\n#endif\n}\nvoid main() { gl_FragColor = front(); }"},{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nattribute highp vec3 a_position;\nattribute vec4 a_normal;\nattribute vec4 a_color;\nvarying vec4 v_color;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\nv_color = a_color;\nfloat intensity = dot(vec3(1, 2, 4), a_normal.xyz);\nv_color.rgb -= a_normal.w * intensity * 0.1;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec4 v_color;\nvec4 back() {\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(vec4(v_color.rgb, v_color.a * 0.2));\n#else\nreturn vec4(v_color.rgb, v_color.a * 0.2);\n#endif\n}\nvoid main() { gl_FragColor = back(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\nuniform highp mat4 cc_matWorld;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec4 v_color;\nattribute float a_dist;\nvarying float v_dist;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\npos = cc_matViewProj * cc_matWorld * pos;\nv_color = a_color;\nv_dist = a_dist;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\nprecision highp float;\nvarying vec4 v_color;\nvarying float v_dist;\nvec4 frag () {\nvec4 o = v_color;\n#ifdef GL_OES_standard_derivatives\nfloat aa = fwidth(v_dist);\n#else\nfloat aa = 0.05;\n#endif\nfloat alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\no.rgb *= o.a;\no *= alpha;\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_worldBoundCenter;\nuniform highp vec4 cc_worldBoundHalfExtents;\nattribute vec3 a_position;\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition *= cc_worldBoundHalfExtents;\nposition += cc_worldBoundCenter;\nposition = cc_matViewProj * position;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 frag () {\nreturn vec4(1, 0, 0, 1);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nmat3 quatToMat3(vec4 q) {\nvec3 m0 = vec3(\n1.0 - 2.0 * q.y * q.y - 2.0 * q.z * q.z,\n2.0 * q.x * q.y + 2.0 * q.w * q.z,\n2.0 * q.x * q.z - 2.0 * q.w * q.y);\nvec3 m1 = vec3(\n2.0 * q.x * q.y - 2.0 * q.w * q.z,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.z * q.z,\n2.0 * q.y * q.z + 2.0 * q.w * q.x);\nvec3 m2 = vec3(\n2.0 * q.x * q.z + 2.0 * q.w * q.y,\n2.0 * q.y * q.z - 2.0 * q.w * q.x,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.y * q.y);\nreturn mat3(m0, m1, m2);\n}\nvec4 mat3ToQuat(mat3 mat) {\nfloat tr = mat[0][0] + mat[1][1] + mat[2][2];\nfloat qw, qx, qy, qz;\nif (tr > 0.0) {\nfloat S = sqrt(tr + 1.0) * 2.0;\nfloat invS = 1.0 / S;\nqw = 0.25 * S;\nqx = (mat[1][2] - mat[2][1]) * invS;\nqy = (mat[2][0] - mat[0][2]) * invS;\nqz = (mat[0][1] - mat[1][0]) * invS;\n} else if ((mat[0][0] > mat[1][1])&&(mat[0][0] > mat[2][2])) {\nfloat S = sqrt(1.0 + mat[0][0] - mat[1][1] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[1][2] - mat[2][1]) * invS;\nqx = 0.25 * S;\nqy = (mat[1][0] + mat[0][1]) * invS;\nqz = (mat[2][0] + mat[0][2]) * invS;\n} else if (mat[1][1] > mat[2][2]) {\nfloat S = sqrt(1.0 + mat[1][1] - mat[0][0] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[2][0] - mat[0][2]) * invS;\nqx = (mat[1][0] + mat[0][1]) * invS;\nqy = 0.25 * S;\nqz = (mat[2][1] + mat[1][2]) * invS;\n} else {\nfloat S = sqrt(1.0 + mat[2][2] - mat[0][0] - mat[1][1]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[0][1] - mat[1][0]) * invS;\nqx = (mat[2][0] + mat[0][2]) * invS;\nqy = (mat[2][1] + mat[1][2]) * invS;\nqz = 0.25 * S;\n}\nreturn vec4(qx, qy, qz, qw);\n}\nvec4 eulerToQuat(vec3 euler) {\nvec3 er = euler * 0.5;\nfloat x = er.x, y = er.y, z = er.z;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat;\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform vec4 nodeRotation;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nrotateVecFromQuat(viewSpaceVert, q);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nuniform vec4 u_sampleInfo;\nuniform vec4 u_worldRot;\nuniform vec4 u_timeDelta;\nattribute vec4 a_position_starttime;\nattribute vec4 a_size_uv;\nattribute vec4 a_rotation_uv;\nattribute vec4 a_color;\nattribute vec4 a_dir_life;\nattribute float a_rndSeed;\n#if CC_RENDER_MODE == 4\nattribute vec3 a_texCoord;\nattribute vec3 a_texCoord3;\nattribute vec3 a_normal;\nattribute vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\nvec4 a = texture2D(tex, coord);\nvec4 b = texture2D(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nreturn mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\nvec4 a = texture2D(tex, coord);\nvec4 b = texture2D(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nw = mix(a.w, b.w, c);\nreturn mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom(float x) {\n#if USE_VK_SHADER\nfloat o = x;\nx = mod(x - 1.0, 2.0) - 1.0;\nfloat freqVar = 10.16640753482;\nfloat y = sin(freqVar * floor(o * 0.5 - 0.5));\nfloat v = max(0.0, 1.0-abs(x));\nv *= 0.7071067812;\nv = y < 0.0 ? -v : v;\nreturn v;\n#else\nfloat seed = mod(x, 233280.);\nfloat q = (seed * 9301. + 49297.) / 233280.;\nreturn fract(q);\n#endif\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\nuniform sampler2D color_over_time_tex0;\nuniform int u_color_mode;\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nuniform sampler2D rotation_over_time_tex0;\nuniform int u_rotation_mode;\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D size_over_time_tex0;\nuniform int u_size_mode;\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D force_over_time_tex0;\nuniform int u_force_mode;\nuniform int u_force_space;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nuniform sampler2D velocity_over_time_tex0;\nuniform int u_velocity_mode;\nuniform int u_velocity_space;\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nuniform sampler2D texture_animation_tex0;\nuniform vec4 u_anim_info;\n#endif\nfloat repeat (float t, float length) {\nreturn t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\nvec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\nvec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\nreturn vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\nfloat activeTime = u_timeDelta.x - a_position_starttime.w;\nfloat normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\nvec2 timeCoord0 = vec2(normalizedTime, 0.);\nvec2 timeCoord1 = vec2(normalizedTime, 1.);\n#if CC_RENDER_MODE == 4\nvec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n#else\nvec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n#endif\nvec4 velocity = vec4(a_dir_life.xyz, 0.);\nvec4 pos = vec4(a_position_starttime.xyz, 1.);\nvec3 size = a_size_uv.xyz;\n#if SIZE_OVER_TIME_MODULE_ENABLE\nif (u_size_mode == 1) {\nsize *= unpackCurveData(size_over_time_tex0, timeCoord0);\n} else {\nvec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\nvec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\nfloat factor_s = pseudoRandom(a_rndSeed + 39825.);\nsize *= mix(size_0, size_1, factor_s);\n}\n#endif\nvec3 compScale = scale.xyz * size;\n#if FORCE_OVER_TIME_MODULE_ENABLE\nvec3 forceAnim = vec3(0.);\nif (u_force_mode == 1) {\nforceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n} else {\nvec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\nvec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\nfloat factor_f =  pseudoRandom(a_rndSeed + 212165.);\nforceAnim = mix(force_0, force_1, factor_f);\n}\nvec4 forceTrack = vec4(forceAnim, 0.);\nif (u_force_space == 0) {\nforceTrack = rotateQuat(forceTrack, u_worldRot);\n}\nvelocity.xyz += forceTrack.xyz;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nfloat speedModifier0 = 1.;\nfloat speedModifier1 = 1.;\nvec3 velocityAnim = vec3(0.);\nif (u_velocity_mode == 1) {\nvelocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n} else {\nvec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\nvec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\nfloat factor_v = pseudoRandom(a_rndSeed + 197866.);\nvelocityAnim = mix(vectory_0, vectory_1, factor_v);\nspeedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n}\nvec4 velocityTrack = vec4(velocityAnim, 0.);\nif (u_velocity_space == 0) {\nvelocityTrack = rotateQuat(velocityTrack, u_worldRot);\n}\nvelocity.xyz += velocityTrack.xyz;\nvelocity.xyz *= speedModifier0;\n#endif\npos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = rotateQuat(velocity, u_worldRot);\n#endif\n#endif\nvec3 startRotation = a_rotation_uv.xyz;\n#if CC_RENDER_MODE != 4\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = startRotation.xyz;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., startRotation.z);\n#endif\nvec4 rot = quaternionFromEuler(rotEuler);\n#else\nvec4 rot = quaternionFromEuler(startRotation);\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nif (u_rotation_mode == 1) {\nvec3 euler = unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\nvec4 quat = eulerToQuat(euler);\nmat3 mLocal = quatToMat3(quat);\nmat3 mStart = quatToMat3(rot);\nrot = mat3ToQuat(mStart * mLocal);\n} else {\nvec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\nvec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\nfloat factor_r = pseudoRandom(a_rndSeed + 125292.);\nvec3 euler = mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n#if CC_RENDER_MODE == 3 || CC_RENDER_MODE == 2\neuler = vec3(0.0, 0.0, euler.z);\n#endif\nvec4 quat = eulerToQuat(euler);\nmat3 mLocal = quatToMat3(quat);\nmat3 mStart = quatToMat3(rot);\nrot = mat3ToQuat(mStart * mLocal);\n}\n#endif\n#if COLOR_OVER_TIME_MODULE_ENABLE\nif (u_color_mode == 1) {\ncolor = a_color * texture2D(color_over_time_tex0, timeCoord0);\n} else {\nvec4 color_0 = texture2D(color_over_time_tex0, timeCoord0);\nvec4 color_1 = texture2D(color_over_time_tex0, timeCoord1);\nfloat factor_c = pseudoRandom(a_rndSeed + 91041.);\ncolor = a_color * mix(color_0, color_1, factor_c);\n}\n#else\ncolor = a_color;\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((vertIdx - 0.5));\n#if CC_RENDER_MODE == 1\nrot = vec4(0.0, 0.0, 0.0, 1.0);\n#endif\ncomputeVertPos(pos, cornerOffset, rot, compScale\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, cc_matViewInv\n#endif\n#if CC_RENDER_MODE == 1\n, cc_cameraPos.xyz\n, velocity\n, frameTile_velLenScale.z\n, frameTile_velLenScale.w\n, a_size_uv.w\n#endif\n);\n#else\nmat3 rotMat = quatToMat3(rot);\nmat3 nodeMat = quatToMat3(nodeRotation);\nrotMat = nodeMat * rotMat;\nrot = mat3ToQuat(rotMat);\nmat4 xformNoScale = matrixFromRT(rot, pos.xyz);\nmat4 xform = matFromRTS(rot, pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor *= a_color1;\n#endif\npos = cc_matViewProj * pos;\nfloat frameIndex = 0.;\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nfloat startFrame = 0.;\nvec3 frameInfo = vec3(0.);\nif (int(u_anim_info.x) == 1) {\nframeInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n} else {\nvec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\nvec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\nfloat factor_t = pseudoRandom(a_rndSeed + 90794.);\nframeInfo = mix(frameInfo0, frameInfo1, factor_t);\n}\nstartFrame = frameInfo.x / u_anim_info.y;\nframeIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n#endif\nuv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\nreturn pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nuniform vec4 mainTiling_Offset;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nattribute vec3 a_position;\nattribute vec4 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\nvarying vec3 vBarycentric;\n#endif\nvec4 vs_main() {\nhighp vec4 pos = vec4(a_position, 1);\nvec4 velocity = vec4(a_texCoord1.xyz, 0);\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\nvelocity = cc_matWorld * velocity;\n#endif\nfloat vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\nvec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\npos.xyz += camUp * vertOffset;\npos = cc_matViewProj * pos;\nuv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\ncolor = a_color;\n#if CC_DRAW_WIRE_FRAME\nvBarycentric = a_texCoord2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\n#if CC_DRAW_WIRE_FRAME\nvarying vec3 vBarycentric;\n#endif\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\nif (any(lessThan(vBarycentric, vec3(0.02)))) {\ncol = vec4(0., 1., 1., 1.);\n}\n#endif\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nmat3 quatToMat3(vec4 q) {\nvec3 m0 = vec3(\n1.0 - 2.0 * q.y * q.y - 2.0 * q.z * q.z,\n2.0 * q.x * q.y + 2.0 * q.w * q.z,\n2.0 * q.x * q.z - 2.0 * q.w * q.y);\nvec3 m1 = vec3(\n2.0 * q.x * q.y - 2.0 * q.w * q.z,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.z * q.z,\n2.0 * q.y * q.z + 2.0 * q.w * q.x);\nvec3 m2 = vec3(\n2.0 * q.x * q.z + 2.0 * q.w * q.y,\n2.0 * q.y * q.z - 2.0 * q.w * q.x,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.y * q.y);\nreturn mat3(m0, m1, m2);\n}\nvec4 mat3ToQuat(mat3 mat) {\nfloat tr = mat[0][0] + mat[1][1] + mat[2][2];\nfloat qw, qx, qy, qz;\nif (tr > 0.0) {\nfloat S = sqrt(tr + 1.0) * 2.0;\nfloat invS = 1.0 / S;\nqw = 0.25 * S;\nqx = (mat[1][2] - mat[2][1]) * invS;\nqy = (mat[2][0] - mat[0][2]) * invS;\nqz = (mat[0][1] - mat[1][0]) * invS;\n} else if ((mat[0][0] > mat[1][1])&&(mat[0][0] > mat[2][2])) {\nfloat S = sqrt(1.0 + mat[0][0] - mat[1][1] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[1][2] - mat[2][1]) * invS;\nqx = 0.25 * S;\nqy = (mat[1][0] + mat[0][1]) * invS;\nqz = (mat[2][0] + mat[0][2]) * invS;\n} else if (mat[1][1] > mat[2][2]) {\nfloat S = sqrt(1.0 + mat[1][1] - mat[0][0] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[2][0] - mat[0][2]) * invS;\nqx = (mat[1][0] + mat[0][1]) * invS;\nqy = 0.25 * S;\nqz = (mat[2][1] + mat[1][2]) * invS;\n} else {\nfloat S = sqrt(1.0 + mat[2][2] - mat[0][0] - mat[1][1]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[0][1] - mat[1][0]) * invS;\nqx = (mat[2][0] + mat[0][2]) * invS;\nqy = (mat[2][1] + mat[1][2]) * invS;\nqz = 0.25 * S;\n}\nreturn vec4(qx, qy, qz, qw);\n}\nuniform vec4 mainTiling_Offset;\nuniform vec4 frameTile_velLenScale;\nuniform vec4 scale;\nuniform vec4 nodeRotation;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewInv;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform highp mat4 cc_matWorld;\nvarying mediump vec2 uv;\nvarying mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nrotateVecFromQuat(viewSpaceVert, q);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nattribute vec3 a_position;\nattribute vec3 a_texCoord;\nattribute vec3 a_texCoord1;\nattribute vec3 a_texCoord2;\nattribute vec4 a_color;\n#if CC_RENDER_MODE == 1\nattribute vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\nattribute vec3 a_texCoord3;\nattribute vec3 a_normal;\nattribute vec4 a_color1;\n#endif\nvec4 lpvs_main () {\nvec3 compScale = scale.xyz * a_texCoord1;\nvec4 pos = vec4(a_position, 1);\n#if CC_RENDER_MODE == 1\nvec4 velocity = vec4(a_color1.xyz, 0);\n#endif\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = cc_matWorld * velocity;\n#endif\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nvec3 rotTmp = a_texCoord2;\nfloat mulFactor = 1.0;\nif (rotTmp.x > 10.0 * 0.5) {\nrotTmp.x -= 10.0;\nmulFactor = -1.0;\n}\nvec4 rot = vec4(rotTmp, 0.0);\nrot.w = mulFactor * sqrt(abs(1.0 - rot.x * rot.x - rot.y * rot.y - rot.z * rot.z));\n#else\n#if CC_RENDER_MODE != 4\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = a_texCoord2;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n#endif\nvec4 rot = quaternionFromEuler(rotEuler);\n#else\nvec4 rot = quaternionFromEuler(a_texCoord2);\n#endif\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\ncomputeVertPos(pos, cornerOffset, rot, compScale, cc_matViewInv);\n#elif CC_RENDER_MODE == 1\ncomputeVertPos(pos, cornerOffset, rot, compScale, cc_cameraPos.xyz, velocity, frameTile_velLenScale.z, frameTile_velLenScale.w, a_texCoord.x);\n#elif 2\ncomputeVertPos(pos, cornerOffset, rot, compScale);\n#endif\ncolor = a_color;\n#else\nmat3 rotMat = quatToMat3(rot);\nmat3 nodeMat = quatToMat3(nodeRotation);\nrotMat = nodeMat * rotMat;\nrot = mat3ToQuat(rotMat);\nmat4 xformNoScale = matrixFromRT(rot, pos.xyz);\nmat4 xform = matFromRTS(rot, pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor = a_color * a_color1;\n#endif\nuv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\npos = cc_matViewProj * pos;\nreturn pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 uv;\nvarying vec4 color;\nuniform sampler2D mainTexture;\nuniform vec4 tintColor;\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture2D(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nvoid main() { gl_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matViewProj;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 v_light;\nvarying vec2 uv0;\n#if TWO_COLORED\nattribute vec4 a_color2;\nvarying vec4 v_dark;\n#endif\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\npos = cc_matViewProj * pos;\nuv0 = a_texCoord;\nv_light = a_color;\n#if TWO_COLORED\nv_dark = a_color2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\nuniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nvarying vec4 v_light;\n#if TWO_COLORED\nvarying vec4 v_dark;\n#endif\nvarying vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if TWO_COLORED\nvec4 texColor = vec4(1, 1, 1, 1);\ntexColor *= texture2D(cc_spriteTexture, uv0);\no.a = texColor.a * v_light.a;\no.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n#else\no *= texture2D(cc_spriteTexture, uv0);\no *= v_light;\n#endif\nALPHA_TEST(o);\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\n#if USE_LOCAL\nuniform highp mat4 cc_matWorld;\n#endif\n#if SAMPLE_FROM_RT\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\n#endif\nattribute vec3 a_position;\nattribute vec2 a_texCoord;\nattribute vec4 a_color;\nvarying vec4 color;\nvarying vec2 uv0;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\n#if USE_PIXEL_ALIGNMENT\npos = cc_matView * pos;\npos.xyz = floor(pos.xyz);\npos = cc_matProj * pos;\n#else\npos = cc_matViewProj * pos;\n#endif\nuv0 = a_texCoord;\n#if SAMPLE_FROM_RT\nuv0 = cc_cameraPos.w > 1.0 ? vec2(uv0.x, 1.0 - uv0.y) : uv0;\n#endif\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\nreturn vec4(texture2D(tex, uv).rgb, texture2D(tex, uv + vec2(0.0, 0.5)).r);\n#else\nreturn texture2D(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\nuniform float alphaThreshold;\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nvarying vec4 color;\n#if USE_TEXTURE\nvarying vec2 uv0;\nuniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if USE_TEXTURE\no *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n#if IS_GRAY\nfloat gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\no.r = o.g = o.b = gray;\n#endif\n#endif\no *= color;\nALPHA_TEST(o);\nreturn o;\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if !USE_INSTANCING\n#if USE_BATCHING\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\nuniform highp vec4 cc_lightingMapUVParam;\nuniform highp vec4 cc_localShadowBias;\n#endif\n#endif\nvoid CCGetWorldMatrixFull(out mat4 matWorld, out mat4 matWorldIT)\n{\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\n}\nuniform vec4 tilingOffset;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\nuniform mediump vec4 cc_shadowWHPBInfo;\nuniform mediump vec4 cc_shadowLPNNInfo;\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\n#if CC_RECEIVE_SHADOW\nvec2 CCGetShadowBias()\n{\n#if USE_INSTANCING\nreturn vec2(a_localShadowBias.x + cc_shadowWHPBInfo.w, a_localShadowBias.y + cc_shadowLPNNInfo.z);\n#elif !USE_BATCHING\nreturn vec2(cc_localShadowBias.x + cc_shadowWHPBInfo.w, cc_localShadowBias.y + cc_shadowLPNNInfo.z);\n#else\nreturn vec2(cc_shadowWHPBInfo.w, cc_shadowLPNNInfo.z);\n#endif\n}\n#endif\n#if USE_VERTEX_COLOR\nattribute vec4 a_color;\nvarying lowp vec4 v_color;\n#endif\nvarying vec3 v_position;\nvarying mediump vec3 v_normal;\nvarying vec2 v_uv;\n#if HAS_SECOND_UV\nvarying mediump vec2 v_uv1;\n#endif\n#if CC_RECEIVE_SHADOW\nvarying mediump vec2 v_shadowBias;\n#endif\n#if USE_NORMAL_MAP\nvarying mediump vec4 v_tangent;\n#endif\n#if HAS_SECOND_UV || CC_USE_LIGHTMAP\nattribute vec2 a_texCoord1;\n#endif\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvarying vec3 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\nv_luv.xy = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.z;\nv_luv.z = cc_lightingMapUVParam.w;\n#else\nv_luv.xy = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.z;\nv_luv.z = a_lightingMapUVParam.w;\n#endif\n}\n#endif\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nmat4 matWorld, matWorldIT;\nCCGetWorldMatrixFull(matWorld, matWorldIT);\nvec4 pos = matWorld * In.position;\nv_position = pos.xyz;\nv_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n#if CC_RECEIVE_SHADOW\nv_shadowBias = CCGetShadowBias();\n#endif\n#if USE_TWOSIDE\nvec3 viewDirect = normalize(cc_cameraPos.xyz - v_position);\nv_normal *= dot(v_normal, viewDirect) < 0.0 ? -1.0 : 1.0;\n#endif\n#if USE_NORMAL_MAP\nv_tangent.xyz = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\nv_tangent.w = In.tangent.w;\n#endif\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv1 = cc_cameraPos.w > 1.0 ? vec2(v_uv1.x, 1.0 - v_uv1.y) : v_uv1;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\nCC_TRANSFER_FOG(pos);\nv_shadowPos = cc_matLightViewProj * pos;\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nCCLightingMapCaclUV();\n#endif\ngl_Position = cc_matProj * (cc_matView * matWorld) * In.position;\n}",frag:"\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers: enable\n#endif\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform mediump vec4 cc_nearFar;\nuniform mediump vec4 cc_viewPort;\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nuniform vec4 pbrParams;\nuniform vec4 emissive;\nuniform vec4 emissiveScaleParam;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nuniform highp mat4 cc_matLightView;\nuniform highp vec4 cc_shadowInvProjDepthInfo;\nuniform highp vec4 cc_shadowProjDepthInfo;\nuniform highp vec4 cc_shadowProjInfo;\nuniform mediump vec4 cc_shadowNFLSInfo;\nuniform mediump vec4 cc_shadowWHPBInfo;\nuniform mediump vec4 cc_shadowLPNNInfo;\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data, const float modValue) {\nhighp float divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data, const float modValue) {\nhighp vec2 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data, const float modValue) {\nhighp vec3 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data, const float modValue) {\nhighp vec4 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal, float normalBias)\n{\nvec4 newShadowPos = shadowPos;\nif(normalBias > EPSILON_LOWP)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * normalBias * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > EPSILON) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCSpotShadowFactorBase(vec4 shadowPos, vec3 worldPos, vec2 shadowBias)\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nreturn CCGetSpotLightShadowFactorSoft2X(shadowPos, worldPos, shadowBias.x);\n}else if (pcf > 0.9) {\nreturn CCGetSpotLightShadowFactorSoft(shadowPos, worldPos, shadowBias.x);\n}else {\nreturn CCGetSpotLightShadowFactorHard(shadowPos, worldPos, shadowBias.x);\n}\n}\nfloat CCShadowFactorBase(vec4 shadowPos, vec3 N, vec2 shadowBias)\n{\nfloat realtimeShadow = 1.0;\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N, shadowBias.y);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nrealtimeShadow =  CCGetShadowFactorSoft2X(pos, shadowBias.x);\n}else if (pcf > 0.9) {\nrealtimeShadow = CCGetShadowFactorSoft(pos, shadowBias.x);\n}else {\nrealtimeShadow = CCGetShadowFactorHard(pos, shadowBias.x);\n}\nreturn mix(realtimeShadow, 1.0, cc_shadowNFLSInfo.w);\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DLodEXT(tex, coord, lod);\n#else\nreturn texture2D(tex, coord, lod);\n#endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn textureCubeLodEXT(tex, coord, lod);\n#else\nreturn textureCube(tex, coord, lod);\n#endif\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = textureCube(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\nfloat specularIntensity;\n#if CC_RECEIVE_SHADOW\nvec2 shadowBias;\n#endif\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.08 * s.specularIntensity), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse / PI;\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\nshadow = CCShadowFactorBase(shadowPos, N, s.shadowBias);\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > EPSILON_LOWP) {\nfinalColor = diffuse * s.lightmap.rgb * shadow;\n}\n#endif\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = textureCube(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nvarying highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n#endif\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvarying vec3 v_luv;\nuniform sampler2D cc_lightingMap;\n#endif\nvarying vec3 v_position;\nvarying vec2 v_uv;\n#if HAS_SECOND_UV\nvarying mediump vec2 v_uv1;\n#endif\nvarying mediump vec3 v_normal;\n#if CC_RECEIVE_SHADOW\nvarying mediump vec2 v_shadowBias;\n#endif\n#if USE_VERTEX_COLOR\nvarying lowp vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\nvarying mediump vec4 v_tangent;\nuniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\nuniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nuniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\nuniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\nuniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\nvec4 baseColor = albedo;\n#if USE_VERTEX_COLOR\nbaseColor.rgb *= SRGBToLinear(v_color.rgb);\nbaseColor.a *= v_color.a;\n#endif\n#if USE_ALBEDO_MAP\nvec4 texColor = texture2D(albedoMap, ALBEDO_UV);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\nbaseColor *= texColor;\n#endif\ns.albedo = baseColor;\ns.albedo.rgb *= albedoScaleAndCutoff.xyz;\n#if USE_ALPHA_TEST\nif (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture2D(cc_lightingMap, v_luv.xy);\ns.lightmap = lightColor.xyz * v_luv.z;\ns.lightmap_test = v_luv.z;\n#endif\ns.normal = v_normal;\n#if CC_RECEIVE_SHADOW\ns.shadowBias = v_shadowBias;\n#endif\n#if USE_NORMAL_MAP\nvec3 nmmp = texture2D(normalMap, NORMAL_UV).xyz - vec3(0.5);\nvec3 bitangent = cross(v_normal, v_tangent.xyz) * v_tangent.w;\ns.normal =\n(nmmp.x * emissiveScaleParam.w) * normalize(v_tangent.xyz) +\n(nmmp.y * emissiveScaleParam.w) * normalize(bitangent) +\nnmmp.z * normalize(s.normal);\n#endif\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\npackHighpData(s.position, s.position_fract_part, v_position);\n#else\ns.position = v_position;\n#endif\nvec4 pbr = pbrParams;\n#if USE_PBR_MAP\nvec4 res = texture2D(pbrMap, PBR_UV);\npbr.x *= res.r;\npbr.y *= res.g;\npbr.z *= res.b;\npbr.w *= res.a;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nvec4 metallicRoughness = texture2D(metallicRoughnessMap, PBR_UV);\npbr.z *= metallicRoughness.b;\npbr.y *= metallicRoughness.g;\n#endif\n#if USE_OCCLUSION_MAP\npbr.x *= texture2D(occlusionMap, PBR_UV).r;\n#endif\ns.occlusion = pbr.x;\ns.roughness = pbr.y;\ns.specularIntensity = 0.5;\ns.metallic = pbr.z;\ns.emissive = emissive.rgb * emissiveScaleParam.xyz;\n#if USE_EMISSIVE_MAP\ns.emissive *= SRGBToLinear(texture2D(emissiveMap, EMISSIVE_UV).rgb);\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n#define LIGHTS_PER_PASS 1\n#else\n#define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nuniform highp vec4 cc_lightPos[LIGHTS_PER_PASS];\nuniform vec4 cc_lightColor[LIGHTS_PER_PASS];\nuniform vec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nuniform vec4 cc_lightDir[LIGHTS_PER_PASS];\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = litRadiusSqr / max(litRadiusSqr, distSqr);\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nreadonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nreadonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nreadonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = PI * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nvoid main () {\nStandardSurface s; surf(s);\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nvec4 color = CCClusterShadingAdditive(s, v_shadowPos);\n#else\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\n#endif\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif (CC_PIPELINE_TYPE == 0 || CC_FORCE_FORWARD_SHADING)\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\nCC_APPLY_FOG(color, s.position.xyz);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec2 float32x3_to_oct(in vec3 v) {\nvec2 p = v.xy * (1.0 / (abs(v.x) + abs(v.y) + abs(v.z)));\nreturn (v.z <= 0.0) ? ((1.0 - abs(p.yx)) * signNotZero(p)) : p;\n}\nvoid main () {\nStandardSurface s; surf(s);\ngl_FragData[0] = s.albedo;\ngl_FragData[1] = vec4(float32x3_to_oct(s.normal), s.roughness, s.metallic);\ngl_FragData[2] = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\n#if !USE_INSTANCING\n#if USE_BATCHING\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matWorldIT;\n#endif\n#endif\nvoid CCGetWorldMatrixFull(out mat4 matWorld, out mat4 matWorldIT)\n{\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\n}\nuniform vec4 tilingOffset;\nuniform highp mat4 cc_matLightViewProj;\n#if HAS_SECOND_UV || CC_USE_LIGHTMAP\nattribute vec2 a_texCoord1;\n#endif\nvarying vec2 v_uv;\n#if HAS_SECOND_UV\nvarying vec2 v_uv1;\n#endif\nvarying vec4 v_worldPos;\nvarying float v_clip_depth;\nvec4 vert () {\nStandardVertInput In;\nCCVertInput(In);\nmat4 matWorld, matWorldIT;\nCCGetWorldMatrixFull(matWorld, matWorldIT);\nv_worldPos = matWorld * In.position;\nvec4 clipPos = cc_matLightViewProj * v_worldPos;\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#endif\nv_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nuniform vec4 albedo;\nuniform vec4 albedoScaleAndCutoff;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nret = fract(ret);\nret -= vec4(ret.yzw, 0.0) / 255.0;\nreturn ret;\n}\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nuniform highp mat4 cc_matLightView;\nuniform mediump vec4 cc_shadowNFLSInfo;\nuniform mediump vec4 cc_shadowLPNNInfo;\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\nvarying vec2 v_uv;\n#if HAS_SECOND_UV\nvarying vec2 v_uv1;\n#endif\nvarying vec4 v_worldPos;\nvarying float v_clip_depth;\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\nvec4 baseColor = albedo;\n#if USE_ALBEDO_MAP\nbaseColor *= texture2D(albedoMap, ALBEDO_UV);\n#endif\n#if USE_ALPHA_TEST\nif (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\nif(cc_shadowLPNNInfo.x > 0.000001 && cc_shadowLPNNInfo.x < 1.999999) {\nif (cc_shadowNFLSInfo.z > 0.000001) {\nreturn vec4(CCGetLinearDepth(v_worldPos.xyz), 1.0, 1.0, 1.0);\n}\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nreturn packDepthToRGBA(v_clip_depth);\n}\nreturn vec4(v_clip_depth, 1.0, 1.0, 1.0);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matViewProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform highp mat4 cc_matWorld;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\nvarying highp vec4 v_shadowPos;\nuniform highp mat4 cc_matLightViewProj;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\n#if CC_RECEIVE_SHADOW\n#endif\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\n#if CC_RECEIVE_SHADOW\nvarying vec2 v_shadowBias;\n#endif\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec3 luv;\nvarying mediump vec3 diffuse;\nuniform vec4 UVScale;\nuniform vec4 lightMapUVParam;\nvoid main () {\nvec3 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nvec4 pos = vec4(worldPos, 1.0);\npos = cc_matViewProj * pos;\nuvw = a_texCoord;\nuv0 = a_position.xz * UVScale.x;\nuv1 = a_position.xz * UVScale.y;\nuv2 = a_position.xz * UVScale.z;\nuv3 = a_position.xz * UVScale.w;\n#if CC_USE_LIGHTMAP\nluv.xy = lightMapUVParam.xy + a_texCoord * lightMapUVParam.z;\nluv.z = lightMapUVParam.w;\n#endif\nv_position = worldPos;\nv_normal = a_normal;\nCC_TRANSFER_FOG(vec4(worldPos, 1.0));\n#if CC_RECEIVE_SHADOW\nv_shadowBias = vec2(0.0, 0.0);\n#endif\nv_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\ngl_Position = pos;\n}",frag:"\n#ifdef GL_EXT_draw_buffers\n#extension GL_EXT_draw_buffers: enable\n#endif\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform mediump vec4 cc_nearFar;\nuniform mediump vec4 cc_viewPort;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nuniform highp mat4 cc_matLightView;\nuniform highp vec4 cc_shadowInvProjDepthInfo;\nuniform highp vec4 cc_shadowProjDepthInfo;\nuniform highp vec4 cc_shadowProjInfo;\nuniform mediump vec4 cc_shadowNFLSInfo;\nuniform mediump vec4 cc_shadowWHPBInfo;\nuniform mediump vec4 cc_shadowLPNNInfo;\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data, const float modValue) {\nhighp float divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data, const float modValue) {\nhighp vec2 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data, const float modValue) {\nhighp vec3 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data, const float modValue) {\nhighp vec4 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal, float normalBias)\n{\nvec4 newShadowPos = shadowPos;\nif(normalBias > EPSILON_LOWP)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * normalBias * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > EPSILON) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCSpotShadowFactorBase(vec4 shadowPos, vec3 worldPos, vec2 shadowBias)\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nreturn CCGetSpotLightShadowFactorSoft2X(shadowPos, worldPos, shadowBias.x);\n}else if (pcf > 0.9) {\nreturn CCGetSpotLightShadowFactorSoft(shadowPos, worldPos, shadowBias.x);\n}else {\nreturn CCGetSpotLightShadowFactorHard(shadowPos, worldPos, shadowBias.x);\n}\n}\nfloat CCShadowFactorBase(vec4 shadowPos, vec3 N, vec2 shadowBias)\n{\nfloat realtimeShadow = 1.0;\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N, shadowBias.y);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nrealtimeShadow =  CCGetShadowFactorSoft2X(pos, shadowBias.x);\n}else if (pcf > 0.9) {\nrealtimeShadow = CCGetShadowFactorSoft(pos, shadowBias.x);\n}else {\nrealtimeShadow = CCGetShadowFactorHard(pos, shadowBias.x);\n}\nreturn mix(realtimeShadow, 1.0, cc_shadowNFLSInfo.w);\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DLodEXT(tex, coord, lod);\n#else\nreturn texture2D(tex, coord, lod);\n#endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn textureCubeLodEXT(tex, coord, lod);\n#else\nreturn textureCube(tex, coord, lod);\n#endif\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = textureCube(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\nfloat specularIntensity;\n#if CC_RECEIVE_SHADOW\nvec2 shadowBias;\n#endif\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.08 * s.specularIntensity), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse / PI;\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\nshadow = CCShadowFactorBase(shadowPos, N, s.shadowBias);\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > EPSILON_LOWP) {\nfinalColor = diffuse * s.lightmap.rgb * shadow;\n}\n#endif\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = textureCube(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\nvarying highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n#endif\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvarying vec3 v_luv;\nuniform sampler2D cc_lightingMap;\n#endif\nvarying highp vec3 v_position;\nvarying mediump vec3 v_normal;\n#if CC_RECEIVE_SHADOW\nvarying vec2 v_shadowBias;\n#endif\nvarying mediump vec2 uvw;\nvarying mediump vec2 uv0;\nvarying mediump vec2 uv1;\nvarying mediump vec2 uv2;\nvarying mediump vec2 uv3;\nvarying mediump vec3 diffuse;\nvarying mediump vec3 luv;\nuniform vec4 metallic;\nuniform vec4 roughness;\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n#if LAYERS > 1\nvec4 w = texture2D(weightMap, uvw);\n#endif\nvec4 baseColor = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseColor = texture2D(detailMap0, uv0);\n#elif LAYERS == 2\nbaseColor += texture2D(detailMap0, uv0) * w.r;\nbaseColor += texture2D(detailMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseColor += texture2D(detailMap0, uv0) * w.r;\nbaseColor += texture2D(detailMap1, uv1) * w.g;\nbaseColor += texture2D(detailMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseColor += texture2D(detailMap0, uv0) * w.r;\nbaseColor += texture2D(detailMap1, uv1) * w.g;\nbaseColor += texture2D(detailMap2, uv2) * w.b;\nbaseColor += texture2D(detailMap3, uv3) * w.a;\n#else\nbaseColor = texture2D(detailMap0, uv0);\n#endif\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\npackHighpData(s.position, s.position_fract_part, v_position);\n#else\ns.position = v_position;\n#endif\n#if USE_NORMALMAP\nvec4 baseNormal = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseNormal = texture2D(normalMap0, uv0);\n#elif LAYERS == 2\nbaseNormal += texture2D(normalMap0, uv0) * w.r;\nbaseNormal += texture2D(normalMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseNormal += texture2D(normalMap0, uv0) * w.r;\nbaseNormal += texture2D(normalMap1, uv1) * w.g;\nbaseNormal += texture2D(normalMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseNormal += texture2D(normalMap0, uv0) * w.r;\nbaseNormal += texture2D(normalMap1, uv1) * w.g;\nbaseNormal += texture2D(normalMap2, uv2) * w.b;\nbaseNormal += texture2D(normalMap3, uv3) * w.a;\n#else\nbaseNormal = texture2D(normalMap0, uv0);\n#endif\nvec3 tangent = vec3(1.0, 0.0, 0.0);\nvec3 binormal = vec3(0.0, 0.0, 1.0);\nbinormal = cross(tangent, v_normal);\ntangent = cross(v_normal, binormal);\nvec3 nmmp = baseNormal.xyz - vec3(0.5);\ns.normal =\nnmmp.x * normalize(tangent) +\nnmmp.y * normalize(binormal) +\nnmmp.z * normalize(v_normal);\n#else\ns.normal = v_normal;\n#endif\n#if CC_RECEIVE_SHADOW\ns.shadowBias = v_shadowBias;\n#endif\ns.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\ns.occlusion = 1.0;\n#if USE_PBR\ns.roughness = 0.0;\n#if LAYERS == 1\ns.roughness = roughness.x;\n#elif LAYERS == 2\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\n#elif LAYERS == 3\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\n#elif LAYERS == 4\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\ns.roughness += roughness.w * w.a;\n#else\ns.roughness = 1.0;\n#endif\ns.specularIntensity = 0.5;\ns.metallic = 0.0;\n#if LAYERS == 1\ns.specularIntensity = 0.5;\ns.metallic = metallic.x;\n#elif LAYERS == 2\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\n#elif LAYERS == 3\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\n#elif LAYERS == 4\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\ns.metallic += metallic.w * w.a;\n#else\ns.specularIntensity = 0.5;\ns.metallic = 0.0;\n#endif\n#else\ns.roughness = 1.0;\ns.specularIntensity = 0.5;\ns.metallic = 0.0;\n#endif\ns.emissive = vec3(0.0, 0.0, 0.0);\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture2D(lightMap, luv.xy);\ns.lightmap = lightColor.xyz * luv.z;\ns.lightmap_test = luv.z;\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n#define LIGHTS_PER_PASS 1\n#else\n#define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nuniform highp vec4 cc_lightPos[LIGHTS_PER_PASS];\nuniform vec4 cc_lightColor[LIGHTS_PER_PASS];\nuniform vec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nuniform vec4 cc_lightDir[LIGHTS_PER_PASS];\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = litRadiusSqr / max(litRadiusSqr, distSqr);\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nreadonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nreadonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nreadonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = PI * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nvoid main () {\nStandardSurface s; surf(s);\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nvec4 color = CCClusterShadingAdditive(s, v_shadowPos);\n#else\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\n#endif\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif (CC_PIPELINE_TYPE == 0 || CC_FORCE_FORWARD_SHADING)\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\nCC_APPLY_FOG(color, s.position.xyz);\ngl_FragData[0] = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec2 float32x3_to_oct(in vec3 v) {\nvec2 p = v.xy * (1.0 / (abs(v.x) + abs(v.y) + abs(v.z)));\nreturn (v.z <= 0.0) ? ((1.0 - abs(p.yx)) * signNotZero(p)) : p;\n}\nvoid main () {\nStandardSurface s; surf(s);\ngl_FragData[0] = s.albedo;\ngl_FragData[1] = vec4(float32x3_to_oct(s.normal), s.roughness, s.metallic);\ngl_FragData[2] = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nuniform highp mat4 cc_matWorld;\nuniform highp mat4 cc_matLightViewProj;\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nvarying vec2 v_clip_depth;\nvec4 vert () {\nvec4 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nworldPos.w = 1.0;\nvec4 clipPos = cc_matLightViewProj * worldPos;\nv_clip_depth = clipPos.zw;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nret = fract(ret);\nret -= vec4(ret.yzw, 0.0) / 255.0;\nreturn ret;\n}\nvarying vec2 v_clip_depth;\nvec4 frag () {\nreturn packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout vec4 In)\n{\nIn = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\n}\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\n#if !USE_INSTANCING\n#if USE_BATCHING\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\n#endif\nvoid CCGetWorldMatrix(out mat4 matWorld)\n{\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\n#if USE_VERTEX_COLOR\nattribute lowp vec4 a_color;\nvarying lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\nvarying vec2 v_uv;\nuniform vec4 tilingOffset;\n#endif\nvec4 vert () {\nvec4 position;\nCCVertInput(position);\nmat4 matWorld;\nCCGetWorldMatrix(matWorld);\n#if USE_TEXTURE\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\nCC_TRANSFER_FOG(matWorld * position);\nreturn cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_fogColor;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nvarying float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\n#endif\nuniform vec4 mainColor;\nuniform vec4 colorScaleAndCutoff;\n#if USE_VERTEX_COLOR\nvarying lowp vec4 v_color;\n#endif\nvec4 frag () {\nvec4 o = mainColor;\no.rgb *= colorScaleAndCutoff.xyz;\n#if USE_VERTEX_COLOR\no.rgb *= SRGBToLinear(v_color.rgb);\no.a *= v_color.a;\n#endif\n#if USE_TEXTURE\nvec4 texColor = texture2D(mainTexture, v_uv);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\no *= texColor;\n#endif\n#if USE_ALPHA_TEST\nif (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n#endif\nCC_APPLY_FOG(o);\nreturn CCFragOutput(o);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvarying vec2 v_uv;\nuniform mediump vec4 texSize;\nuniform sampler2D outputResultMap;\nfloat luminance(vec3 color) {\nreturn dot(color, vec3(0.2126, 0.7152, 0.0722));\n}\nvoid main() {\nvec3 color = texture2D(outputResultMap, v_uv).xyz;\nif (luminance(SRGBToLinear(color)) > texSize.z) {\ngl_FragColor = vec4(color, 1.0);\n} else {\ngl_FragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n}"},{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nvarying vec2 v_uv;\nuniform mediump vec4 texSize;\nuniform sampler2D bloomTexture;\nvec3 downsample4taps(vec2 uv, vec2 halfpixel) {\nvec3 sum = texture2D(bloomTexture, uv + vec2(-halfpixel.x, halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(halfpixel.x, halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(halfpixel.x, -halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(-halfpixel.x, -halfpixel.y)).xyz;\nreturn sum / 4.0;\n}\nvoid main()\n{\nvec3 result = downsample4taps(v_uv, 1.0 / texSize.xy).rgb;\ngl_FragColor = vec4(result, 1.0);\n}"},{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nvarying vec2 v_uv;\nuniform mediump vec4 texSize;\nuniform sampler2D bloomTexture;\nvec3 upsample4taps(vec2 uv, vec2 halfpixel) {\nvec3 sum = texture2D(bloomTexture, uv + vec2(-halfpixel.x, halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(halfpixel.x, halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(halfpixel.x, -halfpixel.y)).xyz;\nsum += texture2D(bloomTexture, uv + vec2(-halfpixel.x, -halfpixel.y)).xyz;\nreturn sum / 4.0;\n}\nvoid main() {\nvec3 result = upsample4taps(v_uv, 0.5 / texSize.xy).rgb;\ngl_FragColor = vec4(result, 1.0);\n}"},{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nvarying vec2 v_uv;\nuniform mediump vec4 texSize;\nuniform sampler2D outputResultMap;\nuniform sampler2D bloomTexture;\nvoid main() {\nvec4 hdrColor = texture2D(outputResultMap, v_uv);\nvec3 bloomColor = texture2D(bloomTexture, v_uv).rgb;\nvec3 result = hdrColor.rgb + bloomColor * texSize.w * hdrColor.a;\ngl_FragColor = vec4(result, hdrColor.a);\n}"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\n#endif\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition.xy = cc_cameraPos.w == 0.0 ? vec2(position.xy.x, -position.xy.y) : position.xy;\ngl_Position = vec4(position.x, position.y, 1.0, 1.0);\nv_uv = a_texCoord;\n}",frag:"\n#ifdef GL_EXT_shader_framebuffer_fetch\n#extension GL_EXT_shader_framebuffer_fetch: enable\n#endif\n#ifdef GL_OES_standard_derivatives\n#extension GL_OES_standard_derivatives: enable\n#endif\n#ifdef GL_EXT_shader_texture_lod\n#extension GL_EXT_shader_texture_lod: enable\n#endif\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matViewProjInv;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_mainLitDir;\nuniform mediump vec4 cc_mainLitColor;\nuniform mediump vec4 cc_ambientSky;\nuniform mediump vec4 cc_ambientGround;\nuniform mediump vec4 cc_fogColor;\nuniform mediump vec4 cc_fogBase;\nuniform mediump vec4 cc_fogAdd;\nuniform mediump vec4 cc_nearFar;\nuniform mediump vec4 cc_viewPort;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nuniform highp mat4 cc_matLightView;\nuniform highp mat4 cc_matLightViewProj;\nuniform highp vec4 cc_shadowInvProjDepthInfo;\nuniform highp vec4 cc_shadowProjDepthInfo;\nuniform highp vec4 cc_shadowProjInfo;\nuniform mediump vec4 cc_shadowNFLSInfo;\nuniform mediump vec4 cc_shadowWHPBInfo;\nuniform mediump vec4 cc_shadowLPNNInfo;\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal, float normalBias)\n{\nvec4 newShadowPos = shadowPos;\nif(normalBias > EPSILON_LOWP)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * normalBias * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > EPSILON) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture2D(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture2D(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture2D(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture2D(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture2D(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCSpotShadowFactorBase(vec4 shadowPos, vec3 worldPos, vec2 shadowBias)\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nreturn CCGetSpotLightShadowFactorSoft2X(shadowPos, worldPos, shadowBias.x);\n}else if (pcf > 0.9) {\nreturn CCGetSpotLightShadowFactorSoft(shadowPos, worldPos, shadowBias.x);\n}else {\nreturn CCGetSpotLightShadowFactorHard(shadowPos, worldPos, shadowBias.x);\n}\n}\nfloat CCShadowFactorBase(vec4 shadowPos, vec3 N, vec2 shadowBias)\n{\nfloat realtimeShadow = 1.0;\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N, shadowBias.y);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nrealtimeShadow =  CCGetShadowFactorSoft2X(pos, shadowBias.x);\n}else if (pcf > 0.9) {\nrealtimeShadow = CCGetShadowFactorSoft(pos, shadowBias.x);\n}else {\nrealtimeShadow = CCGetShadowFactorHard(pos, shadowBias.x);\n}\nreturn mix(realtimeShadow, 1.0, cc_shadowNFLSInfo.w);\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn texture2DLodEXT(tex, coord, lod);\n#else\nreturn texture2D(tex, coord, lod);\n#endif\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\n#ifdef GL_EXT_shader_texture_lod\nreturn textureCubeLodEXT(tex, coord, lod);\n#else\nreturn textureCube(tex, coord, lod);\n#endif\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = textureCube(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\nfloat specularIntensity;\n#if CC_RECEIVE_SHADOW\nvec2 shadowBias;\n#endif\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.08 * s.specularIntensity), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse / PI;\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\nshadow = CCShadowFactorBase(shadowPos, N, s.shadowBias);\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > EPSILON_LOWP) {\nfinalColor = diffuse * s.lightmap.rgb * shadow;\n}\n#endif\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = textureCube(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\n#if CC_PIPELINE_TYPE == 0\n#define LIGHTS_PER_PASS 1\n#else\n#define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nuniform highp vec4 cc_lightPos[LIGHTS_PER_PASS];\nuniform vec4 cc_lightColor[LIGHTS_PER_PASS];\nuniform vec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nuniform vec4 cc_lightDir[LIGHTS_PER_PASS];\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = litRadiusSqr / max(litRadiusSqr, distSqr);\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nreadonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nreadonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nreadonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = PI * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec3 oct_to_float32x3(vec2 e) {\nvec3 v = vec3(e.xy, 1.0 - abs(e.x) - abs(e.y));\nif (v.z < 0.0) v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\nreturn normalize(v);\n}\nvec4 screen2WS(vec3 coord) {\nvec3 ndc = vec3(\n2.0 * (coord.x - cc_viewPort.x) / cc_viewPort.z - 1.0,\n2.0 * (coord.y - cc_viewPort.y) / cc_viewPort.w - 1.0,\n2.0 * coord.z - 1.0);\nvec4 world = ((cc_matViewProjInv) * (vec4(ndc, 1.0)));\nworld      = world / world.w;\nreturn world;\n}\nvarying vec2 v_uv;\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\nuniform sampler2D depth_stencil;\n#else\nuniform sampler2D gbuffer_albedoMap;\nuniform sampler2D gbuffer_normalMap;\nuniform sampler2D gbuffer_emissiveMap;\nuniform sampler2D depth_stencil;\n#endif\n#if !CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT || __VERSION__ >= 450\n#endif\nvoid main () {\nStandardSurface s;\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\nvec4 albedoMap = gl_LastFragData[0];\nvec4 normalMap = gl_LastFragData[1];\nvec4 emissiveMap = gl_LastFragData[2];\nfloat depth = texture2D(depth_stencil, v_uv).x;\n#else\nvec4 albedoMap = texture2D(gbuffer_albedoMap,v_uv);\nvec4 normalMap = texture2D(gbuffer_normalMap,v_uv);\nvec4 emissiveMap = texture2D(gbuffer_emissiveMap,v_uv);\nfloat depth = texture2D(depth_stencil, v_uv).x;\n#endif\ns.albedo = albedoMap;\nvec3 position = screen2WS(vec3(gl_FragCoord.xy, depth)).xyz;\ns.position = position;\ns.roughness = normalMap.z;\ns.normal = oct_to_float32x3(normalMap.xy);\ns.specularIntensity = 0.5;\ns.metallic = normalMap.w;\ns.emissive = emissiveMap.xyz;\ns.occlusion = emissiveMap.w;\nfloat fogFactor;\nCC_TRANSFER_FOG_BASE(vec4(position, 1), fogFactor);\nvec4 shadowPos;\nshadowPos = cc_matLightViewProj * vec4(position, 1);\nvec4 color = CCStandardShadingBase(s, shadowPos) +\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nCCClusterShadingAdditive(s, shadowPos);\n#else\nCCStandardShadingAdditive(s, shadowPos);\n#endif\nCC_APPLY_FOG_BASE(color, fogFactor);\ncolor = CCFragOutput(color);\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\ngl_FragData[2] = color;\n#else\ngl_FragColor = color;\n#endif\n}"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout vec4 In)\n{\nIn = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\n}\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\nuniform highp vec4 cc_cameraPos;\nuniform mediump vec4 cc_mainLitDir;\n#if !USE_INSTANCING\n#if USE_BATCHING\nuniform highp mat4 cc_matWorlds[10];\n#else\nuniform highp mat4 cc_matWorld;\n#endif\n#endif\nvoid CCGetWorldMatrix(out mat4 matWorld)\n{\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\n}\nuniform mediump vec4 cc_planarNDInfo;\nvarying float v_dist;\nvec4 vert () {\nvec4 position;\nCCVertInput(position);\nmat4 matWorld;\nCCGetWorldMatrix(matWorld);\nvec3 P = (matWorld * position).xyz;\nvec3 L = cc_mainLitDir.xyz;\nvec3 N = cc_planarNDInfo.xyz;\nfloat d = cc_planarNDInfo.w + 0.001;\nfloat dist = (-d - dot(P, N)) / (dot(L, N) + 0.0001);\nvec3 shadowPos = P + L * dist;\nvec3 view = normalize(cc_cameraPos.xyz - shadowPos);\nfloat viewLength = length(cc_cameraPos.xyz - shadowPos);\nshadowPos += view * min(1.0, 0.005 * viewLength);\nposition = cc_matProj * cc_matView * vec4(shadowPos, 1.0);\nv_dist = dist;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform lowp vec4 cc_shadowColor;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying float v_dist;\nvec4 frag () {\nif(v_dist < 0.0)\ndiscard;\nreturn CCFragOutput(cc_shadowColor);\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nuniform vec4 cc_displacementWeights[15];\nuniform vec4 cc_displacementTextureInfo;\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 uv = getPixelCoordFromLocation(location, cc_displacementTextureInfo.xy);\nreturn texture2D(tex, uv);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture2D(tex, x)),\ndecode32(texture2D(tex, y)),\ndecode32(texture2D(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nuniform highp vec4 cc_jointTextureInfo;\nuniform highp vec4 cc_jointAnimInfo;\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nuniform highp vec4 cc_joints[90];\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture2D(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture2D(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nuniform highp vec4 cc_cameraPos;\nvarying vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nuniform mediump vec4 cc_screenSize;\n#if ANTIALIAS_TYPE == 1\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\nvec2 v_rgbNW, vec2 v_rgbNE,\nvec2 v_rgbSW, vec2 v_rgbSE,\nvec2 v_rgbM) {\nvec4 color;\nmediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\nvec3 rgbNW = texture2D(tex, v_rgbNW).xyz;\nvec3 rgbNE = texture2D(tex, v_rgbNE).xyz;\nvec3 rgbSW = texture2D(tex, v_rgbSW).xyz;\nvec3 rgbSE = texture2D(tex, v_rgbSE).xyz;\nvec4 texColor = texture2D(tex, v_rgbM);\nvec3 rgbM  = texColor.xyz;\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat lumaNW = dot(rgbNW, luma);\nfloat lumaNE = dot(rgbNE, luma);\nfloat lumaSW = dot(rgbSW, luma);\nfloat lumaSE = dot(rgbSE, luma);\nfloat lumaM  = dot(rgbM,  luma);\nfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\nfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\nmediump vec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n(0.25 * (1.0 / 8.0)), (1.0/ 128.0));\nfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\ndir = min(vec2(8.0, 8.0),\nmax(vec2(-8.0, -8.0),\ndir * rcpDirMin)) * inverseVP;\nvec3 rgbA = 0.5 * (\ntexture2D(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\ntexture2D(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture2D(tex, fragCoord * inverseVP + dir * -0.5).xyz +\ntexture2D(tex, fragCoord * inverseVP + dir * 0.5).xyz);\nfloat lumaB = dot(rgbB, luma);\nif ((lumaB < lumaMin) || (lumaB > lumaMax))\ncolor = vec4(rgbA, texColor.a);\nelse\ncolor = vec4(rgbB, texColor.a);\nreturn color;\n}\n#endif\nvarying vec2 v_uv;\nuniform sampler2D outputResultMap;\nvoid texcoords(vec2 fragCoord, vec2 resolution,\nout vec2 v_rgbNW, out vec2 v_rgbNE,\nout vec2 v_rgbSW, out vec2 v_rgbSE,\nout vec2 v_rgbM) {\nvec2 inverseVP = 1.0 / resolution.xy;\nv_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\nv_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\nv_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\nv_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\nv_rgbM = vec2(fragCoord * inverseVP);\n}\nvoid main () {\nmediump vec2 v_rgbNW;\nmediump vec2 v_rgbNE;\nmediump vec2 v_rgbSW;\nmediump vec2 v_rgbSE;\nmediump vec2 v_rgbM;\n#if ANTIALIAS_TYPE == 1\nvec2 resolution = cc_screenSize.xy;\nvec2 fragCoord = v_uv * resolution;\ntexcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\ngl_FragColor = fxaa(outputResultMap, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n#else\ngl_FragColor = texture2D(outputResultMap, v_uv);\n#endif\n}"}],[{vert:"\nprecision highp float;\nuniform highp mat4 cc_matView;\nuniform highp mat4 cc_matProj;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nattribute vec3 a_position;\nattribute vec3 a_normal;\nattribute vec2 a_texCoord;\nattribute vec4 a_tangent;\n#if CC_USE_SKINNING\nattribute vec4 a_joints;\nattribute vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nattribute highp vec4 a_jointAnimInfo;\n#endif\nattribute vec4 a_matWorld0;\nattribute vec4 a_matWorld1;\nattribute vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nattribute vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nattribute vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nattribute float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nattribute float a_vertexId;\n#endif\nvarying mediump vec4 viewDir;\nvec4 vert () {\nviewDir = vec4(a_position, 1.0);\nmat4 matViewRotOnly = mat4(mat3(cc_matView));\nvec4 pos = matViewRotOnly * viewDir;\nif (cc_matProj[3].w > 0.0) {\nmat4 matProj = cc_matProj;\nmatProj[0].x = 5.2;\nmatProj[1].y = 2.6;\nmatProj[2].zw = vec2(-1.0);\nmatProj[3].zw = vec2(0.0);\npos = matProj * pos;\n} else {\npos = cc_matProj * pos;\n}\npos.z = 0.99999 * pos.w;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nuniform mediump vec4 cc_ambientSky;\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nvarying mediump vec4 viewDir;\nvec4 frag () {\n#if USE_RGBE_CUBEMAP\nvec3 c = unpackRGBE(textureCube(cc_environment, viewDir.xyz));\n#else\nvec3 c = SRGBToLinear(textureCube(cc_environment, viewDir.xyz).rgb);\n#endif\nreturn CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nuniform highp mat4 cc_matProj;\nattribute vec3 a_position;\nattribute vec4 a_color;\nvarying vec2 v_uv;\nuniform vec4 offset;\nuniform vec4 digits[20];\nfloat getComponent(vec4 v, float i) {\nif (i < 1.0) { return v.x; }\nelse if (i < 2.0) { return v.y; }\nelse if (i < 3.0) { return v.z; }\nelse { return v.w; }\n}\nvec4 vert () {\nmat2 proj = mat2(cc_matProj[0].xy, cc_matProj[1].xy);\nproj /= abs(proj[1].x + proj[1].y);\nvec2 position = proj * a_position.xy + offset.xy;\nv_uv = a_color.xy;\nif (a_color.z >= 0.0) {\nfloat n = getComponent(digits[int(a_color.z)], a_color.w);\nv_uv += vec2(offset.z * n, 0.0);\n}\nreturn vec4(position, 0.0, 1.0);\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nvarying vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\nreturn CCFragOutput(texture2D(mainTexture, v_uv));\n}\nvoid main() { gl_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nattribute vec2 a_position;\nattribute vec2 a_texCoord;\nvarying vec2 v_uv;\nuniform vec4 u_buffer0;\nuniform vec4 u_buffer1;\nuniform mat4 u_projection;\nvec4 vert () {\nvec2 worldPos = a_position * u_buffer1.xy + u_buffer1.zw;\nvec2 clipSpace = worldPos / u_buffer0.xy * 2.0 - 1.0;\nvec4 screenPos = u_projection * vec4(clipSpace, 0.0, 1.0);\nv_uv = a_texCoord;\nreturn screenPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvarying vec2 v_uv;\nuniform float u_percent;\nuniform sampler2D mainTexture;\nvec4 frag () {\nvec4 color = texture2D(mainTexture, v_uv);\nfloat percent = clamp(u_percent, 0.0, 1.0);\ncolor.xyz *= percent;\nreturn color;\n}\nvoid main() { gl_FragColor = frag(); }"}]],glsl3:[[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n, mat4 viewInv\n) {\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n}\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nlayout(std140) uniform builtin {\nvec4 cc_size_rotation;\n};\nvec4 vs_main() {\nvec4 pos = vec4(a_position, 1);\npos = cc_matWorld * pos;\nvec2 vertOffset = a_texCoord.xy - 0.5;\ncomputeVertPos(pos, vertOffset, quaternionFromEuler(vec3(0., 0., cc_size_rotation.z)), vec3(cc_size_rotation.xy, 0.), cc_matViewInv);\npos = cc_matViewProj * pos;\nuv = a_texCoord.xy;\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nin vec3 a_position;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 frag () {\nvec4 o = vec4(1.0);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin highp vec3 a_position;\nin vec4 a_color;\nout vec4 v_color;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\npos.z -= 0.000001;\nv_color = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec4 v_color;\nvec4 front() {\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(v_color);\n#else\nreturn v_color;\n#endif\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = front(); }"},{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin highp vec3 a_position;\nin vec4 a_color;\nout vec4 v_color;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\npos.z -= 0.000001;\nv_color = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec4 v_color;\nvec4 back() {\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(vec4(v_color.rgb, v_color.a * 0.2));\n#else\nreturn vec4(v_color.rgb, v_color.a * 0.2);\n#endif\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = back(); }"},{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin highp vec3 a_position;\nin vec4 a_color;\nout vec4 v_color;\nout float v_distance;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\npos.z -= 0.000001;\nv_color = a_color;\nv_distance = dot(a_position, vec3(1.0, 1.0, 1.0));\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec4 v_color;\nin float v_distance;\nvec4 front() {\nif (fract(v_distance) > 0.5) {\ndiscard;\n}\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(v_color);\n#else\nreturn v_color;\n#endif\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = front(); }"},{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin highp vec3 a_position;\nin vec4 a_color;\nout vec4 v_color;\nout float v_distance;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\npos.z -= 0.000001;\nv_color = a_color;\nv_distance = dot(a_position, vec3(1.0, 1.0, 1.0));\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec4 v_color;\nin float v_distance;\nvec4 back() {\nif (fract(v_distance) > 0.5) {\ndiscard;\n}\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(vec4(v_color.rgb, v_color.a * 0.2));\n#else\nreturn vec4(v_color.rgb, v_color.a * 0.2);\n#endif\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = back(); }"},{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin highp vec3 a_position;\nin vec4 a_normal;\nin vec4 a_color;\nout vec4 v_color;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\nv_color = a_color;\nfloat intensity = dot(vec3(1, 2, 4), a_normal.xyz);\nv_color.rgb -= a_normal.w * intensity * 0.1;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec4 v_color;\nvec4 front() {\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(v_color);\n#else\nreturn v_color;\n#endif\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = front(); }"},{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin highp vec3 a_position;\nin vec4 a_normal;\nin vec4 a_color;\nout vec4 v_color;\nvec4 vert () {\nvec4 pos = cc_matViewProj * vec4(a_position, 1);\nv_color = a_color;\nfloat intensity = dot(vec3(1, 2, 4), a_normal.xyz);\nv_color.rgb -= a_normal.w * intensity * 0.1;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec4 v_color;\nvec4 back() {\n#if USE_FORWARD_PIPELINE\nreturn CCFragOutput(vec4(v_color.rgb, v_color.a * 0.2));\n#else\nreturn vec4(v_color.rgb, v_color.a * 0.2);\n#endif\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = back(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec4 v_color;\nin float a_dist;\nout float v_dist;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\npos = cc_matViewProj * cc_matWorld * pos;\nv_color = a_color;\nv_dist = a_dist;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nin vec4 v_color;\nin float v_dist;\nvec4 frag () {\nvec4 o = v_color;\nfloat aa = fwidth(v_dist);\nfloat alpha = 1. - smoothstep(-aa, 0., abs(v_dist) - 1.0);\no.rgb *= o.a;\no *= alpha;\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCWorldBound {\nhighp vec4 cc_worldBoundCenter;\nhighp vec4 cc_worldBoundHalfExtents;\n};\nin vec3 a_position;\nvec4 vert () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition *= cc_worldBoundHalfExtents;\nposition += cc_worldBoundCenter;\nposition = cc_matViewProj * position;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nvec4 frag () {\nreturn vec4(1, 0, 0, 1);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nmat3 quatToMat3(vec4 q) {\nvec3 m0 = vec3(\n1.0 - 2.0 * q.y * q.y - 2.0 * q.z * q.z,\n2.0 * q.x * q.y + 2.0 * q.w * q.z,\n2.0 * q.x * q.z - 2.0 * q.w * q.y);\nvec3 m1 = vec3(\n2.0 * q.x * q.y - 2.0 * q.w * q.z,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.z * q.z,\n2.0 * q.y * q.z + 2.0 * q.w * q.x);\nvec3 m2 = vec3(\n2.0 * q.x * q.z + 2.0 * q.w * q.y,\n2.0 * q.y * q.z - 2.0 * q.w * q.x,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.y * q.y);\nreturn mat3(m0, m1, m2);\n}\nvec4 mat3ToQuat(mat3 mat) {\nfloat tr = mat[0][0] + mat[1][1] + mat[2][2];\nfloat qw, qx, qy, qz;\nif (tr > 0.0) {\nfloat S = sqrt(tr + 1.0) * 2.0;\nfloat invS = 1.0 / S;\nqw = 0.25 * S;\nqx = (mat[1][2] - mat[2][1]) * invS;\nqy = (mat[2][0] - mat[0][2]) * invS;\nqz = (mat[0][1] - mat[1][0]) * invS;\n} else if ((mat[0][0] > mat[1][1])&&(mat[0][0] > mat[2][2])) {\nfloat S = sqrt(1.0 + mat[0][0] - mat[1][1] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[1][2] - mat[2][1]) * invS;\nqx = 0.25 * S;\nqy = (mat[1][0] + mat[0][1]) * invS;\nqz = (mat[2][0] + mat[0][2]) * invS;\n} else if (mat[1][1] > mat[2][2]) {\nfloat S = sqrt(1.0 + mat[1][1] - mat[0][0] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[2][0] - mat[0][2]) * invS;\nqx = (mat[1][0] + mat[0][1]) * invS;\nqy = 0.25 * S;\nqz = (mat[2][1] + mat[1][2]) * invS;\n} else {\nfloat S = sqrt(1.0 + mat[2][2] - mat[0][0] - mat[1][1]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[0][1] - mat[1][0]) * invS;\nqx = (mat[2][0] + mat[0][2]) * invS;\nqy = (mat[2][1] + mat[1][2]) * invS;\nqz = 0.25 * S;\n}\nreturn vec4(qx, qy, qz, qw);\n}\nvec4 eulerToQuat(vec3 euler) {\nvec3 er = euler * 0.5;\nfloat x = er.x, y = er.y, z = er.z;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat;\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nrotateVecFromQuat(viewSpaceVert, q);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nlayout(std140) uniform SampleConstants {\nvec4 u_sampleInfo;\n};\nlayout(std140) uniform TickConstants {\nvec4 u_worldRot;\nvec4 u_timeDelta;\n};\nin vec4 a_position_starttime;\nin vec4 a_size_uv;\nin vec4 a_rotation_uv;\nin vec4 a_color;\nin vec4 a_dir_life;\nin float a_rndSeed;\n#if CC_RENDER_MODE == 4\nin vec3 a_texCoord;\nin vec3 a_texCoord3;\nin vec3 a_normal;\nin vec4 a_color1;\n#endif\nvec3 unpackCurveData (sampler2D tex, vec2 coord) {\nvec4 a = texture(tex, coord);\nvec4 b = texture(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nreturn mix(a.xyz, b.xyz, c);\n}\nvec3 unpackCurveData (sampler2D tex, vec2 coord, out float w) {\nvec4 a = texture(tex, coord);\nvec4 b = texture(tex, coord + u_sampleInfo.y);\nfloat c = fract(coord.x * u_sampleInfo.x);\nw = mix(a.w, b.w, c);\nreturn mix(a.xyz, b.xyz, c);\n}\nfloat pseudoRandom(float x) {\n#if USE_VK_SHADER\nfloat o = x;\nx = mod(x - 1.0, 2.0) - 1.0;\nfloat freqVar = 10.16640753482;\nfloat y = sin(freqVar * floor(o * 0.5 - 0.5));\nfloat v = max(0.0, 1.0-abs(x));\nv *= 0.7071067812;\nv = y < 0.0 ? -v : v;\nreturn v;\n#else\nfloat seed = mod(x, 233280.);\nfloat q = (seed * 9301. + 49297.) / 233280.;\nreturn fract(q);\n#endif\n}\n#if COLOR_OVER_TIME_MODULE_ENABLE\nuniform sampler2D color_over_time_tex0;\nlayout(std140) uniform ColorConstant {\nint u_color_mode;\n};\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nuniform sampler2D rotation_over_time_tex0;\nlayout(std140) uniform RotationConstant {\nint u_rotation_mode;\n};\n#endif\n#if SIZE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D size_over_time_tex0;\nlayout(std140) uniform SizeConstant {\nint u_size_mode;\n};\n#endif\n#if FORCE_OVER_TIME_MODULE_ENABLE\nuniform sampler2D force_over_time_tex0;\nlayout(std140) uniform ForceConstant {\nint u_force_mode;\nint u_force_space;\n};\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nuniform sampler2D velocity_over_time_tex0;\nlayout(std140) uniform VelocityConstant {\nint u_velocity_mode;\nint u_velocity_space;\n};\n#endif\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nuniform sampler2D texture_animation_tex0;\nlayout(std140) uniform AnimationConstant {\nvec4 u_anim_info;\n};\n#endif\nfloat repeat (float t, float length) {\nreturn t - floor(t / length) * length;\n}\nvec4 rotateQuat (vec4 p, vec4 q) {\nvec3 iv = cross(q.xyz, p.xyz) + q.w * p.xyz;\nvec3 res = p.xyz + 2.0 * cross(q.xyz, iv);\nreturn vec4(res.xyz, p.w);\n}\nvec4 gpvs_main () {\nfloat activeTime = u_timeDelta.x - a_position_starttime.w;\nfloat normalizedTime = clamp(activeTime / a_dir_life.w, 0.0, 1.0);\nvec2 timeCoord0 = vec2(normalizedTime, 0.);\nvec2 timeCoord1 = vec2(normalizedTime, 1.);\n#if CC_RENDER_MODE == 4\nvec2 vertIdx = vec2(a_texCoord.x, a_texCoord.y);\n#else\nvec2 vertIdx = vec2(a_size_uv.w, a_rotation_uv.w);\n#endif\nvec4 velocity = vec4(a_dir_life.xyz, 0.);\nvec4 pos = vec4(a_position_starttime.xyz, 1.);\nvec3 size = a_size_uv.xyz;\n#if SIZE_OVER_TIME_MODULE_ENABLE\nif (u_size_mode == 1) {\nsize *= unpackCurveData(size_over_time_tex0, timeCoord0);\n} else {\nvec3 size_0 = unpackCurveData(size_over_time_tex0, timeCoord0);\nvec3 size_1 = unpackCurveData(size_over_time_tex0, timeCoord1);\nfloat factor_s = pseudoRandom(a_rndSeed + 39825.);\nsize *= mix(size_0, size_1, factor_s);\n}\n#endif\nvec3 compScale = scale.xyz * size;\n#if FORCE_OVER_TIME_MODULE_ENABLE\nvec3 forceAnim = vec3(0.);\nif (u_force_mode == 1) {\nforceAnim = unpackCurveData(force_over_time_tex0, timeCoord0);\n} else {\nvec3 force_0 = unpackCurveData(force_over_time_tex0, timeCoord0);\nvec3 force_1 = unpackCurveData(force_over_time_tex0, timeCoord1);\nfloat factor_f =  pseudoRandom(a_rndSeed + 212165.);\nforceAnim = mix(force_0, force_1, factor_f);\n}\nvec4 forceTrack = vec4(forceAnim, 0.);\nif (u_force_space == 0) {\nforceTrack = rotateQuat(forceTrack, u_worldRot);\n}\nvelocity.xyz += forceTrack.xyz;\n#endif\n#if VELOCITY_OVER_TIME_MODULE_ENABLE\nfloat speedModifier0 = 1.;\nfloat speedModifier1 = 1.;\nvec3 velocityAnim = vec3(0.);\nif (u_velocity_mode == 1) {\nvelocityAnim = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\n} else {\nvec3 vectory_0 = unpackCurveData(velocity_over_time_tex0, timeCoord0, speedModifier0);\nvec3 vectory_1 = unpackCurveData(velocity_over_time_tex0, timeCoord1, speedModifier1);\nfloat factor_v = pseudoRandom(a_rndSeed + 197866.);\nvelocityAnim = mix(vectory_0, vectory_1, factor_v);\nspeedModifier0 = mix(speedModifier0, speedModifier1, factor_v);\n}\nvec4 velocityTrack = vec4(velocityAnim, 0.);\nif (u_velocity_space == 0) {\nvelocityTrack = rotateQuat(velocityTrack, u_worldRot);\n}\nvelocity.xyz += velocityTrack.xyz;\nvelocity.xyz *= speedModifier0;\n#endif\npos.xyz += velocity.xyz * normalizedTime * a_dir_life.w;\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = rotateQuat(velocity, u_worldRot);\n#endif\n#endif\nvec3 startRotation = a_rotation_uv.xyz;\n#if CC_RENDER_MODE != 4\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = startRotation.xyz;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., startRotation.z);\n#endif\nvec4 rot = quaternionFromEuler(rotEuler);\n#else\nvec4 rot = quaternionFromEuler(startRotation);\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nif (u_rotation_mode == 1) {\nvec3 euler = unpackCurveData(rotation_over_time_tex0, timeCoord0) * normalizedTime * a_dir_life.w;\nvec4 quat = eulerToQuat(euler);\nmat3 mLocal = quatToMat3(quat);\nmat3 mStart = quatToMat3(rot);\nrot = mat3ToQuat(mStart * mLocal);\n} else {\nvec3 rotation_0 = unpackCurveData(rotation_over_time_tex0, timeCoord0);\nvec3 rotation_1 = unpackCurveData(rotation_over_time_tex0, timeCoord1);\nfloat factor_r = pseudoRandom(a_rndSeed + 125292.);\nvec3 euler = mix(rotation_0, rotation_1, factor_r) * normalizedTime * a_dir_life.w;\n#if CC_RENDER_MODE == 3 || CC_RENDER_MODE == 2\neuler = vec3(0.0, 0.0, euler.z);\n#endif\nvec4 quat = eulerToQuat(euler);\nmat3 mLocal = quatToMat3(quat);\nmat3 mStart = quatToMat3(rot);\nrot = mat3ToQuat(mStart * mLocal);\n}\n#endif\n#if COLOR_OVER_TIME_MODULE_ENABLE\nif (u_color_mode == 1) {\ncolor = a_color * texture(color_over_time_tex0, timeCoord0);\n} else {\nvec4 color_0 = texture(color_over_time_tex0, timeCoord0);\nvec4 color_1 = texture(color_over_time_tex0, timeCoord1);\nfloat factor_c = pseudoRandom(a_rndSeed + 91041.);\ncolor = a_color * mix(color_0, color_1, factor_c);\n}\n#else\ncolor = a_color;\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((vertIdx - 0.5));\n#if CC_RENDER_MODE == 1\nrot = vec4(0.0, 0.0, 0.0, 1.0);\n#endif\ncomputeVertPos(pos, cornerOffset, rot, compScale\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, cc_matViewInv\n#endif\n#if CC_RENDER_MODE == 1\n, cc_cameraPos.xyz\n, velocity\n, frameTile_velLenScale.z\n, frameTile_velLenScale.w\n, a_size_uv.w\n#endif\n);\n#else\nmat3 rotMat = quatToMat3(rot);\nmat3 nodeMat = quatToMat3(nodeRotation);\nrotMat = nodeMat * rotMat;\nrot = mat3ToQuat(rotMat);\nmat4 xformNoScale = matrixFromRT(rot, pos.xyz);\nmat4 xform = matFromRTS(rot, pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor *= a_color1;\n#endif\npos = cc_matViewProj * pos;\nfloat frameIndex = 0.;\n#if TEXTURE_ANIMATION_MODULE_ENABLE\nfloat startFrame = 0.;\nvec3 frameInfo = vec3(0.);\nif (int(u_anim_info.x) == 1) {\nframeInfo = unpackCurveData(texture_animation_tex0, timeCoord0);\n} else {\nvec3 frameInfo0 = unpackCurveData(texture_animation_tex0, timeCoord0);\nvec3 frameInfo1 = unpackCurveData(texture_animation_tex0, timeCoord1);\nfloat factor_t = pseudoRandom(a_rndSeed + 90794.);\nframeInfo = mix(frameInfo0, frameInfo1, factor_t);\n}\nstartFrame = frameInfo.x / u_anim_info.y;\nframeIndex = repeat(u_anim_info.z * (frameInfo.y + startFrame), 1.);\n#endif\nuv = computeUV(frameIndex, vertIdx, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\nreturn pos;\n}\nvoid main() { gl_Position = gpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nin vec3 a_position;\nin vec4 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_DRAW_WIRE_FRAME\nout vec3 vBarycentric;\n#endif\nvec4 vs_main() {\nhighp vec4 pos = vec4(a_position, 1);\nvec4 velocity = vec4(a_texCoord1.xyz, 0);\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\nvelocity = cc_matWorld * velocity;\n#endif\nfloat vertOffset = (a_texCoord.x - 0.5) * a_texCoord.y;\nvec3 camUp = normalize(cross(pos.xyz - cc_cameraPos.xyz, velocity.xyz));\npos.xyz += camUp * vertOffset;\npos = cc_matViewProj * pos;\nuv = a_texCoord.zw * mainTiling_Offset.xy + mainTiling_Offset.zw;;\ncolor = a_color;\n#if CC_DRAW_WIRE_FRAME\nvBarycentric = a_texCoord2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\n#if CC_DRAW_WIRE_FRAME\nin vec3 vBarycentric;\n#endif\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\n#if CC_DRAW_WIRE_FRAME\nif (any(lessThan(vBarycentric, vec3(0.02)))) {\ncol = vec4(0., 1., 1., 1.);\n}\n#endif\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nvec4 quaternionFromAxis (vec3 xAxis,vec3 yAxis,vec3 zAxis){\nmat3 m = mat3(xAxis,yAxis,zAxis);\nfloat trace = m[0][0] + m[1][1] + m[2][2];\nvec4 quat;\nif (trace > 0.) {\nfloat s = 0.5 / sqrt(trace + 1.0);\nquat.w = 0.25 / s;\nquat.x = (m[2][1] - m[1][2]) * s;\nquat.y = (m[0][2] - m[2][0]) * s;\nquat.z = (m[1][0] - m[0][1]) * s;\n} else if ((m[0][0] > m[1][1]) && (m[0][0] > m[2][2])) {\nfloat s = 2.0 * sqrt(1.0 + m[0][0] - m[1][1] - m[2][2]);\nquat.w = (m[2][1] - m[1][2]) / s;\nquat.x = 0.25 * s;\nquat.y = (m[0][1] + m[1][0]) / s;\nquat.z = (m[0][2] + m[2][0]) / s;\n} else if (m[1][1] > m[2][2]) {\nfloat s = 2.0 * sqrt(1.0 + m[1][1] - m[0][0] - m[2][2]);\nquat.w = (m[0][2] - m[2][0]) / s;\nquat.x = (m[0][1] + m[1][0]) / s;\nquat.y = 0.25 * s;\nquat.z = (m[1][2] + m[2][1]) / s;\n} else {\nfloat s = 2.0 * sqrt(1.0 + m[2][2] - m[0][0] - m[1][1]);\nquat.w = (m[1][0] - m[0][1]) / s;\nquat.x = (m[0][2] + m[2][0]) / s;\nquat.y = (m[1][2] + m[2][1]) / s;\nquat.z = 0.25 * s;\n}\nfloat len = quat.x * quat.x + quat.y * quat.y + quat.z * quat.z + quat.w * quat.w;\nif (len > 0.) {\nlen = 1. / sqrt(len);\nquat.x = quat.x * len;\nquat.y = quat.y * len;\nquat.z = quat.z * len;\nquat.w = quat.w * len;\n}\nreturn quat;\n}\nvec4 quaternionFromEuler (vec3 angle){\nfloat x = angle.x / 2.;\nfloat y = angle.y / 2.;\nfloat z = angle.z / 2.;\nfloat sx = sin(x);\nfloat cx = cos(x);\nfloat sy = sin(y);\nfloat cy = cos(y);\nfloat sz = sin(z);\nfloat cz = cos(z);\nvec4 quat = vec4(0);\nquat.x = sx * cy * cz + cx * sy * sz;\nquat.y = cx * sy * cz + sx * cy * sz;\nquat.z = cx * cy * sz - sx * sy * cz;\nquat.w = cx * cy * cz - sx * sy * sz;\nreturn quat;\n}\nmat4 matrixFromRT (vec4 q, vec3 p){\nfloat x2 = q.x + q.x;\nfloat y2 = q.y + q.y;\nfloat z2 = q.z + q.z;\nfloat xx = q.x * x2;\nfloat xy = q.x * y2;\nfloat xz = q.x * z2;\nfloat yy = q.y * y2;\nfloat yz = q.y * z2;\nfloat zz = q.z * z2;\nfloat wx = q.w * x2;\nfloat wy = q.w * y2;\nfloat wz = q.w * z2;\nreturn mat4(\n1. - (yy + zz), xy + wz, xz - wy, 0,\nxy - wz, 1. - (xx + zz), yz + wx, 0,\nxz + wy, yz - wx, 1. - (xx + yy), 0,\np.x, p.y, p.z, 1\n);\n}\nmat4 matFromRTS (vec4 q, vec3 t, vec3 s){\nfloat x = q.x, y = q.y, z = q.z, w = q.w;\nfloat x2 = x + x;\nfloat y2 = y + y;\nfloat z2 = z + z;\nfloat xx = x * x2;\nfloat xy = x * y2;\nfloat xz = x * z2;\nfloat yy = y * y2;\nfloat yz = y * z2;\nfloat zz = z * z2;\nfloat wx = w * x2;\nfloat wy = w * y2;\nfloat wz = w * z2;\nfloat sx = s.x;\nfloat sy = s.y;\nfloat sz = s.z;\nreturn mat4((1. - (yy + zz)) * sx, (xy + wz) * sx, (xz - wy) * sx, 0,\n(xy - wz) * sy, (1. - (xx + zz)) * sy, (yz + wx) * sy, 0,\n(xz + wy) * sz, (yz - wx) * sz, (1. - (xx + yy)) * sz, 0,\nt.x, t.y, t.z, 1);\n}\nvec4 quatMultiply (vec4 a, vec4 b){\nvec4 quat;\nquat.x = a.x * b.w + a.w * b.x + a.y * b.z - a.z * b.y;\nquat.y = a.y * b.w + a.w * b.y + a.z * b.x - a.x * b.z;\nquat.z = a.z * b.w + a.w * b.z + a.x * b.y - a.y * b.x;\nquat.w = a.w * b.w - a.x * b.x - a.y * b.y - a.z * b.z;\nreturn quat;\n}\nvoid rotateVecFromQuat (inout vec3 v, vec4 q){\nfloat ix = q.w * v.x + q.y * v.z - q.z * v.y;\nfloat iy = q.w * v.y + q.z * v.x - q.x * v.z;\nfloat iz = q.w * v.z + q.x * v.y - q.y * v.x;\nfloat iw = -q.x * v.x - q.y * v.y - q.z * v.z;\nv.x = ix * q.w + iw * -q.x + iy * -q.z - iz * -q.y;\nv.y = iy * q.w + iw * -q.y + iz * -q.x - ix * -q.z;\nv.z = iz * q.w + iw * -q.z + ix * -q.y - iy * -q.x;\n}\nvec3 rotateInLocalSpace (vec3 pos, vec3 xAxis, vec3 yAxis, vec3 zAxis, vec4 q){\nvec4 viewQuat = quaternionFromAxis(xAxis, yAxis, zAxis);\nvec4 rotQuat = quatMultiply(viewQuat, q);\nrotateVecFromQuat(pos, rotQuat);\nreturn pos;\n}\nmat3 quatToMat3(vec4 q) {\nvec3 m0 = vec3(\n1.0 - 2.0 * q.y * q.y - 2.0 * q.z * q.z,\n2.0 * q.x * q.y + 2.0 * q.w * q.z,\n2.0 * q.x * q.z - 2.0 * q.w * q.y);\nvec3 m1 = vec3(\n2.0 * q.x * q.y - 2.0 * q.w * q.z,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.z * q.z,\n2.0 * q.y * q.z + 2.0 * q.w * q.x);\nvec3 m2 = vec3(\n2.0 * q.x * q.z + 2.0 * q.w * q.y,\n2.0 * q.y * q.z - 2.0 * q.w * q.x,\n1.0 - 2.0 * q.x * q.x - 2.0 * q.y * q.y);\nreturn mat3(m0, m1, m2);\n}\nvec4 mat3ToQuat(mat3 mat) {\nfloat tr = mat[0][0] + mat[1][1] + mat[2][2];\nfloat qw, qx, qy, qz;\nif (tr > 0.0) {\nfloat S = sqrt(tr + 1.0) * 2.0;\nfloat invS = 1.0 / S;\nqw = 0.25 * S;\nqx = (mat[1][2] - mat[2][1]) * invS;\nqy = (mat[2][0] - mat[0][2]) * invS;\nqz = (mat[0][1] - mat[1][0]) * invS;\n} else if ((mat[0][0] > mat[1][1])&&(mat[0][0] > mat[2][2])) {\nfloat S = sqrt(1.0 + mat[0][0] - mat[1][1] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[1][2] - mat[2][1]) * invS;\nqx = 0.25 * S;\nqy = (mat[1][0] + mat[0][1]) * invS;\nqz = (mat[2][0] + mat[0][2]) * invS;\n} else if (mat[1][1] > mat[2][2]) {\nfloat S = sqrt(1.0 + mat[1][1] - mat[0][0] - mat[2][2]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[2][0] - mat[0][2]) * invS;\nqx = (mat[1][0] + mat[0][1]) * invS;\nqy = 0.25 * S;\nqz = (mat[2][1] + mat[1][2]) * invS;\n} else {\nfloat S = sqrt(1.0 + mat[2][2] - mat[0][0] - mat[1][1]) * 2.0;\nfloat invS = 1.0 / S;\nqw = (mat[0][1] - mat[1][0]) * invS;\nqx = (mat[2][0] + mat[0][2]) * invS;\nqy = (mat[2][1] + mat[1][2]) * invS;\nqz = 0.25 * S;\n}\nreturn vec4(qx, qy, qz, qw);\n}\nlayout(std140) uniform Constants {\nvec4 mainTiling_Offset;\nvec4 frameTile_velLenScale;\nvec4 scale;\nvec4 nodeRotation;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nout mediump vec2 uv;\nout mediump vec4 color;\nvoid computeVertPos (inout vec4 pos, vec2 vertOffset, vec4 q, vec3 s\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\n, mat4 viewInv\n#endif\n#if CC_RENDER_MODE == 1\n, vec3 eye\n, vec4 velocity\n, float velocityScale\n, float lengthScale\n, float xIndex\n#endif\n) {\n#if CC_RENDER_MODE == 0\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = normalize(vec3(viewInv[0][0], viewInv[1][0], viewInv[2][0]));\nvec3 camY = normalize(vec3(viewInv[0][1], viewInv[1][1], viewInv[2][1]));\nvec3 camZ = normalize(vec3(viewInv[0][2], viewInv[1][2], viewInv[2][2]));\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, camZ, q);\n#elif CC_RENDER_MODE == 1\nvec3 camRight = normalize(cross(pos.xyz - eye, velocity.xyz)) * s.x;\nvec3 camUp = velocity.xyz * velocityScale + normalize(velocity.xyz) * lengthScale * s.y;\npos.xyz += (camRight * abs(vertOffset.x) * sign(vertOffset.y)) - camUp * xIndex;\n#elif CC_RENDER_MODE == 2\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nvec3 camX = vec3(1, 0, 0);\nvec3 camY = vec3(0, 0, -1);\npos.xyz += rotateInLocalSpace(viewSpaceVert, camX, camY, cross(camX, camY), q);\n#elif CC_RENDER_MODE == 3\nvec3 viewSpaceVert = vec3(vertOffset.x * s.x, vertOffset.y * s.y, 0.);\nrotateVecFromQuat(viewSpaceVert, q);\nvec3 camX = normalize(vec3(cc_matView[0][0], cc_matView[1][0], cc_matView[2][0]));\nvec3 camY = vec3(0, 1, 0);\nvec3 offset = camX * viewSpaceVert.x + camY * viewSpaceVert.y;\npos.xyz += offset;\n#else\npos.x += vertOffset.x;\npos.y += vertOffset.y;\n#endif\n}\nvec2 computeUV (float frameIndex, vec2 vertIndex, vec2 frameTile){\nvec2 aniUV = vec2(0, floor(frameIndex * frameTile.y));\naniUV.x = floor(frameIndex * frameTile.x * frameTile.y - aniUV.y * frameTile.x);\n#if CC_RENDER_MODE != 4\nvertIndex.y = 1. - vertIndex.y;\n#endif\nreturn (aniUV.xy + vertIndex) / vec2(frameTile.x, frameTile.y);\n}\nin vec3 a_position;\nin vec3 a_texCoord;\nin vec3 a_texCoord1;\nin vec3 a_texCoord2;\nin vec4 a_color;\n#if CC_RENDER_MODE == 1\nin vec3 a_color1;\n#endif\n#if CC_RENDER_MODE == 4\nin vec3 a_texCoord3;\nin vec3 a_normal;\nin vec4 a_color1;\n#endif\nvec4 lpvs_main () {\nvec3 compScale = scale.xyz * a_texCoord1;\nvec4 pos = vec4(a_position, 1);\n#if CC_RENDER_MODE == 1\nvec4 velocity = vec4(a_color1.xyz, 0);\n#endif\n#if !CC_USE_WORLD_SPACE\npos = cc_matWorld * pos;\n#if CC_RENDER_MODE == 1\nvelocity = cc_matWorld * velocity;\n#endif\n#endif\n#if ROTATION_OVER_TIME_MODULE_ENABLE\nvec3 rotTmp = a_texCoord2;\nfloat mulFactor = 1.0;\nif (rotTmp.x > 10.0 * 0.5) {\nrotTmp.x -= 10.0;\nmulFactor = -1.0;\n}\nvec4 rot = vec4(rotTmp, 0.0);\nrot.w = mulFactor * sqrt(abs(1.0 - rot.x * rot.x - rot.y * rot.y - rot.z * rot.z));\n#else\n#if CC_RENDER_MODE != 4\n#if CC_RENDER_MODE == 0\nvec3 rotEuler = a_texCoord2;\n#elif CC_RENDER_MODE == 1\nvec3 rotEuler = vec3(0.);\n#else\nvec3 rotEuler = vec3(0., 0., a_texCoord2.z);\n#endif\nvec4 rot = quaternionFromEuler(rotEuler);\n#else\nvec4 rot = quaternionFromEuler(a_texCoord2);\n#endif\n#endif\n#if CC_RENDER_MODE != 4\nvec2 cornerOffset = vec2((a_texCoord.xy - 0.5));\n#if CC_RENDER_MODE == 0 || CC_RENDER_MODE == 3\ncomputeVertPos(pos, cornerOffset, rot, compScale, cc_matViewInv);\n#elif CC_RENDER_MODE == 1\ncomputeVertPos(pos, cornerOffset, rot, compScale, cc_cameraPos.xyz, velocity, frameTile_velLenScale.z, frameTile_velLenScale.w, a_texCoord.x);\n#elif 2\ncomputeVertPos(pos, cornerOffset, rot, compScale);\n#endif\ncolor = a_color;\n#else\nmat3 rotMat = quatToMat3(rot);\nmat3 nodeMat = quatToMat3(nodeRotation);\nrotMat = nodeMat * rotMat;\nrot = mat3ToQuat(rotMat);\nmat4 xformNoScale = matrixFromRT(rot, pos.xyz);\nmat4 xform = matFromRTS(rot, pos.xyz, compScale);\npos = xform * vec4(a_texCoord3, 1);\nvec4 normal = xformNoScale * vec4(a_normal, 0);\ncolor = a_color * a_color1;\n#endif\nuv = computeUV(a_texCoord.z, a_texCoord.xy, frameTile_velLenScale.xy) * mainTiling_Offset.xy + mainTiling_Offset.zw;\npos = cc_matViewProj * pos;\nreturn pos;\n}\nvoid main() { gl_Position = lpvs_main(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 uv;\nin vec4 color;\nuniform sampler2D mainTexture;\nlayout(std140) uniform FragConstants {\nvec4 tintColor;\n};\nvec4 add () {\nvec4 col = 2.0 * color * tintColor * texture(mainTexture, uv);\nreturn CCFragOutput(col);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = add(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 v_light;\nout vec2 uv0;\n#if TWO_COLORED\nin vec4 a_color2;\nout vec4 v_dark;\n#endif\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\npos = cc_matViewProj * pos;\nuv0 = a_texCoord;\nv_light = a_color;\n#if TWO_COLORED\nv_dark = a_color2;\n#endif\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\n#if USE_ALPHA_TEST\nlayout(std140) uniform ALPHA_TEST_DATA {\nfloat alphaThreshold;\n};\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nin vec4 v_light;\n#if TWO_COLORED\nin vec4 v_dark;\n#endif\nin vec2 uv0;\nuniform sampler2D cc_spriteTexture;\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if TWO_COLORED\nvec4 texColor = vec4(1, 1, 1, 1);\ntexColor *= texture(cc_spriteTexture, uv0);\no.a = texColor.a * v_light.a;\no.rgb = ((texColor.a - 1.0) * v_dark.a + 1.0 - texColor.rgb) * v_dark.rgb + texColor.rgb * v_light.rgb;\n#else\no *= texture(cc_spriteTexture, uv0);\no *= v_light;\n#endif\nALPHA_TEST(o);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if USE_LOCAL\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\n#endif\n#if SAMPLE_FROM_RT\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\n#endif\nin vec3 a_position;\nin vec2 a_texCoord;\nin vec4 a_color;\nout vec4 color;\nout vec2 uv0;\nvec4 vert () {\nvec4 pos = vec4(a_position, 1);\n#if USE_LOCAL\npos = cc_matWorld * pos;\n#endif\n#if USE_PIXEL_ALIGNMENT\npos = cc_matView * pos;\npos.xyz = floor(pos.xyz);\npos = cc_matProj * pos;\n#else\npos = cc_matViewProj * pos;\n#endif\nuv0 = a_texCoord;\n#if SAMPLE_FROM_RT\nuv0 = cc_cameraPos.w > 1.0 ? vec2(uv0.x, 1.0 - uv0.y) : uv0;\n#endif\ncolor = a_color;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 CCSampleWithAlphaSeparated(sampler2D tex, vec2 uv) {\n#if CC_USE_EMBEDDED_ALPHA\nreturn vec4(texture(tex, uv).rgb, texture(tex, uv + vec2(0.0, 0.5)).r);\n#else\nreturn texture(tex, uv);\n#endif\n}\n#if USE_ALPHA_TEST\nlayout(std140) uniform ALPHA_TEST_DATA {\nfloat alphaThreshold;\n};\n#endif\nvoid ALPHA_TEST (in vec4 color) {\n#if USE_ALPHA_TEST\nif (color.a < alphaThreshold) discard;\n#endif\n}\nvoid ALPHA_TEST (in float alpha) {\n#if USE_ALPHA_TEST\nif (alpha < alphaThreshold) discard;\n#endif\n}\nin vec4 color;\n#if USE_TEXTURE\nin vec2 uv0;\nuniform sampler2D cc_spriteTexture;\n#endif\nvec4 frag () {\nvec4 o = vec4(1, 1, 1, 1);\n#if USE_TEXTURE\no *= CCSampleWithAlphaSeparated(cc_spriteTexture, uv0);\n#if IS_GRAY\nfloat gray  = 0.2126 * o.r + 0.7152 * o.g + 0.0722 * o.b;\no.r = o.g = o.b = gray;\n#endif\n#endif\no *= color;\nALPHA_TEST(o);\nreturn o;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if !USE_INSTANCING\n#if USE_BATCHING\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\n#endif\n#endif\nvoid CCGetWorldMatrixFull(out mat4 matWorld, out mat4 matWorldIT)\n{\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\n}\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nout float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\n#if CC_RECEIVE_SHADOW\nvec2 CCGetShadowBias()\n{\n#if USE_INSTANCING\nreturn vec2(a_localShadowBias.x + cc_shadowWHPBInfo.w, a_localShadowBias.y + cc_shadowLPNNInfo.z);\n#elif !USE_BATCHING\nreturn vec2(cc_localShadowBias.x + cc_shadowWHPBInfo.w, cc_localShadowBias.y + cc_shadowLPNNInfo.z);\n#else\nreturn vec2(cc_shadowWHPBInfo.w, cc_shadowLPNNInfo.z);\n#endif\n}\n#endif\n#if USE_VERTEX_COLOR\nin vec4 a_color;\nout lowp vec4 v_color;\n#endif\nout vec3 v_position;\nout mediump vec3 v_normal;\nout vec2 v_uv;\n#if HAS_SECOND_UV\nout mediump vec2 v_uv1;\n#endif\n#if CC_RECEIVE_SHADOW\nout mediump vec2 v_shadowBias;\n#endif\n#if USE_NORMAL_MAP\nout mediump vec4 v_tangent;\n#endif\n#if HAS_SECOND_UV || CC_USE_LIGHTMAP\nin vec2 a_texCoord1;\n#endif\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nout vec3 v_luv;\nvoid CCLightingMapCaclUV()\n{\n#if !USE_INSTANCING\nv_luv.xy = cc_lightingMapUVParam.xy + a_texCoord1 * cc_lightingMapUVParam.z;\nv_luv.z = cc_lightingMapUVParam.w;\n#else\nv_luv.xy = a_lightingMapUVParam.xy + a_texCoord1 * a_lightingMapUVParam.z;\nv_luv.z = a_lightingMapUVParam.w;\n#endif\n}\n#endif\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nmat4 matWorld, matWorldIT;\nCCGetWorldMatrixFull(matWorld, matWorldIT);\nvec4 pos = matWorld * In.position;\nv_position = pos.xyz;\nv_normal = normalize((matWorldIT * vec4(In.normal, 0.0)).xyz);\n#if CC_RECEIVE_SHADOW\nv_shadowBias = CCGetShadowBias();\n#endif\n#if USE_TWOSIDE\nvec3 viewDirect = normalize(cc_cameraPos.xyz - v_position);\nv_normal *= dot(v_normal, viewDirect) < 0.0 ? -1.0 : 1.0;\n#endif\n#if USE_NORMAL_MAP\nv_tangent.xyz = normalize((matWorld * vec4(In.tangent.xyz, 0.0)).xyz);\nv_tangent.w = In.tangent.w;\n#endif\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv1 = cc_cameraPos.w > 1.0 ? vec2(v_uv1.x, 1.0 - v_uv1.y) : v_uv1;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\nCC_TRANSFER_FOG(pos);\nv_shadowPos = cc_matLightViewProj * pos;\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nCCLightingMapCaclUV();\n#endif\ngl_Position = cc_matProj * (cc_matView * matWorld) * In.position;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nin float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data, const float modValue) {\nhighp float divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data, const float modValue) {\nhighp vec2 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data, const float modValue) {\nhighp vec3 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data, const float modValue) {\nhighp vec4 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal, float normalBias)\n{\nvec4 newShadowPos = shadowPos;\nif(normalBias > EPSILON_LOWP)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * normalBias * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > EPSILON) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCSpotShadowFactorBase(vec4 shadowPos, vec3 worldPos, vec2 shadowBias)\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nreturn CCGetSpotLightShadowFactorSoft2X(shadowPos, worldPos, shadowBias.x);\n}else if (pcf > 0.9) {\nreturn CCGetSpotLightShadowFactorSoft(shadowPos, worldPos, shadowBias.x);\n}else {\nreturn CCGetSpotLightShadowFactorHard(shadowPos, worldPos, shadowBias.x);\n}\n}\nfloat CCShadowFactorBase(vec4 shadowPos, vec3 N, vec2 shadowBias)\n{\nfloat realtimeShadow = 1.0;\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N, shadowBias.y);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nrealtimeShadow =  CCGetShadowFactorSoft2X(pos, shadowBias.x);\n}else if (pcf > 0.9) {\nrealtimeShadow = CCGetShadowFactorSoft(pos, shadowBias.x);\n}else {\nrealtimeShadow = CCGetShadowFactorHard(pos, shadowBias.x);\n}\nreturn mix(realtimeShadow, 1.0, cc_shadowNFLSInfo.w);\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = texture(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\nfloat specularIntensity;\n#if CC_RECEIVE_SHADOW\nvec2 shadowBias;\n#endif\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.08 * s.specularIntensity), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse / PI;\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\nshadow = CCShadowFactorBase(shadowPos, N, s.shadowBias);\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > EPSILON_LOWP) {\nfinalColor = diffuse * s.lightmap.rgb * shadow;\n}\n#endif\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = texture(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nin highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n#endif\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nin vec3 v_luv;\nuniform sampler2D cc_lightingMap;\n#endif\nin vec3 v_position;\nin vec2 v_uv;\n#if HAS_SECOND_UV\nin mediump vec2 v_uv1;\n#endif\nin mediump vec3 v_normal;\n#if CC_RECEIVE_SHADOW\nin mediump vec2 v_shadowBias;\n#endif\n#if USE_VERTEX_COLOR\nin lowp vec4 v_color;\n#endif\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_NORMAL_MAP\nin mediump vec4 v_tangent;\nuniform sampler2D normalMap;\n#endif\n#if USE_PBR_MAP\nuniform sampler2D pbrMap;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nuniform sampler2D metallicRoughnessMap;\n#endif\n#if USE_OCCLUSION_MAP\nuniform sampler2D occlusionMap;\n#endif\n#if USE_EMISSIVE_MAP\nuniform sampler2D emissiveMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvoid surf (out StandardSurface s) {\nvec4 baseColor = albedo;\n#if USE_VERTEX_COLOR\nbaseColor.rgb *= SRGBToLinear(v_color.rgb);\nbaseColor.a *= v_color.a;\n#endif\n#if USE_ALBEDO_MAP\nvec4 texColor = texture(albedoMap, ALBEDO_UV);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\nbaseColor *= texColor;\n#endif\ns.albedo = baseColor;\ns.albedo.rgb *= albedoScaleAndCutoff.xyz;\n#if USE_ALPHA_TEST\nif (s.albedo.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture(cc_lightingMap, v_luv.xy);\ns.lightmap = lightColor.xyz * v_luv.z;\ns.lightmap_test = v_luv.z;\n#endif\ns.normal = v_normal;\n#if CC_RECEIVE_SHADOW\ns.shadowBias = v_shadowBias;\n#endif\n#if USE_NORMAL_MAP\nvec3 nmmp = texture(normalMap, NORMAL_UV).xyz - vec3(0.5);\nvec3 bitangent = cross(v_normal, v_tangent.xyz) * v_tangent.w;\ns.normal =\n(nmmp.x * emissiveScaleParam.w) * normalize(v_tangent.xyz) +\n(nmmp.y * emissiveScaleParam.w) * normalize(bitangent) +\nnmmp.z * normalize(s.normal);\n#endif\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\npackHighpData(s.position, s.position_fract_part, v_position);\n#else\ns.position = v_position;\n#endif\nvec4 pbr = pbrParams;\n#if USE_PBR_MAP\nvec4 res = texture(pbrMap, PBR_UV);\npbr.x *= res.r;\npbr.y *= res.g;\npbr.z *= res.b;\npbr.w *= res.a;\n#endif\n#if USE_METALLIC_ROUGHNESS_MAP\nvec4 metallicRoughness = texture(metallicRoughnessMap, PBR_UV);\npbr.z *= metallicRoughness.b;\npbr.y *= metallicRoughness.g;\n#endif\n#if USE_OCCLUSION_MAP\npbr.x *= texture(occlusionMap, PBR_UV).r;\n#endif\ns.occlusion = pbr.x;\ns.roughness = pbr.y;\ns.specularIntensity = 0.5;\ns.metallic = pbr.z;\ns.emissive = emissive.rgb * emissiveScaleParam.xyz;\n#if USE_EMISSIVE_MAP\ns.emissive *= SRGBToLinear(texture(emissiveMap, EMISSIVE_UV).rgb);\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n#define LIGHTS_PER_PASS 1\n#else\n#define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nlayout(std140) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = litRadiusSqr / max(litRadiusSqr, distSqr);\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nlayout(std430, binding = 4) readonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nlayout(std430, binding = 5) readonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nlayout(std430, binding = 6) readonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = PI * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nvec4 color = CCClusterShadingAdditive(s, v_shadowPos);\n#else\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\n#endif\nfragColorX = CCFragOutput(color);\n}\n#elif (CC_PIPELINE_TYPE == 0 || CC_FORCE_FORWARD_SHADING)\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\nCC_APPLY_FOG(color, s.position.xyz);\nfragColorX = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec2 float32x3_to_oct(in vec3 v) {\nvec2 p = v.xy * (1.0 / (abs(v.x) + abs(v.y) + abs(v.z)));\nreturn (v.z <= 0.0) ? ((1.0 - abs(p.yx)) * signNotZero(p)) : p;\n}\nlayout(location = 0) out vec4 fragColor0;\nlayout(location = 1) out vec4 fragColor1;\nlayout(location = 2) out vec4 fragColor2;\nvoid main () {\nStandardSurface s; surf(s);\nfragColor0 = s.albedo;\nfragColor1 = vec4(float32x3_to_oct(s.normal), s.roughness, s.metallic);\nfragColor2 = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\n#if !USE_INSTANCING\n#if USE_BATCHING\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\n#endif\n#endif\nvoid CCGetWorldMatrixFull(out mat4 matWorld, out mat4 matWorldIT)\n{\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\nmatWorldIT = matWorld;\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\nmatWorldIT = matWorld;\n#else\nmatWorld = cc_matWorld;\nmatWorldIT = cc_matWorldIT;\n#endif\n}\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\n#if HAS_SECOND_UV || CC_USE_LIGHTMAP\nin vec2 a_texCoord1;\n#endif\nout vec2 v_uv;\n#if HAS_SECOND_UV\nout vec2 v_uv1;\n#endif\nout vec4 v_worldPos;\nout float v_clip_depth;\nvec4 vert () {\nStandardVertInput In;\nCCVertInput(In);\nmat4 matWorld, matWorldIT;\nCCGetWorldMatrixFull(matWorld, matWorldIT);\nv_worldPos = matWorld * In.position;\nvec4 clipPos = cc_matLightViewProj * v_worldPos;\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if HAS_SECOND_UV\nv_uv1 = a_texCoord1 * tilingOffset.xy + tilingOffset.zw;\n#endif\nv_clip_depth = clipPos.z / clipPos.w * 0.5 + 0.5;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nlayout(std140) uniform Constants {\nvec4 tilingOffset;\nvec4 albedo;\nvec4 albedoScaleAndCutoff;\nvec4 pbrParams;\nvec4 emissive;\nvec4 emissiveScaleParam;\n};\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nret = fract(ret);\nret -= vec4(ret.yzw, 0.0) / 255.0;\nreturn ret;\n}\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\nin vec2 v_uv;\n#if HAS_SECOND_UV\nin vec2 v_uv1;\n#endif\nin vec4 v_worldPos;\nin float v_clip_depth;\n#if USE_ALBEDO_MAP\nuniform sampler2D albedoMap;\n#endif\n#if USE_ALPHA_TEST\n#endif\nvec4 frag () {\nvec4 baseColor = albedo;\n#if USE_ALBEDO_MAP\nbaseColor *= texture(albedoMap, ALBEDO_UV);\n#endif\n#if USE_ALPHA_TEST\nif (baseColor.ALPHA_TEST_CHANNEL < albedoScaleAndCutoff.w) discard;\n#endif\nif(cc_shadowLPNNInfo.x > 0.000001 && cc_shadowLPNNInfo.x < 1.999999) {\nif (cc_shadowNFLSInfo.z > 0.000001) {\nreturn vec4(CCGetLinearDepth(v_worldPos.xyz), 1.0, 1.0, 1.0);\n}\n}\nif (cc_shadowLPNNInfo.y > 0.000001) {\nreturn packDepthToRGBA(v_clip_depth);\n}\nreturn vec4(v_clip_depth, 1.0, 1.0, 1.0);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nout float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\nout highp vec4 v_shadowPos;\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\n#endif\n#if CC_RECEIVE_SHADOW\n#endif\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\n#if CC_RECEIVE_SHADOW\nout vec2 v_shadowBias;\n#endif\nout highp vec3 v_position;\nout mediump vec3 v_normal;\nout mediump vec2 uvw;\nout mediump vec2 uv0;\nout mediump vec2 uv1;\nout mediump vec2 uv2;\nout mediump vec2 uv3;\nout mediump vec3 luv;\nout mediump vec3 diffuse;\nlayout(std140) uniform TexCoords {\nvec4 UVScale;\nvec4 lightMapUVParam;\n};\nvoid main () {\nvec3 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nvec4 pos = vec4(worldPos, 1.0);\npos = cc_matViewProj * pos;\nuvw = a_texCoord;\nuv0 = a_position.xz * UVScale.x;\nuv1 = a_position.xz * UVScale.y;\nuv2 = a_position.xz * UVScale.z;\nuv3 = a_position.xz * UVScale.w;\n#if CC_USE_LIGHTMAP\nluv.xy = lightMapUVParam.xy + a_texCoord * lightMapUVParam.z;\nluv.z = lightMapUVParam.w;\n#endif\nv_position = worldPos;\nv_normal = a_normal;\nCC_TRANSFER_FOG(vec4(worldPos, 1.0));\n#if CC_RECEIVE_SHADOW\nv_shadowBias = vec2(0.0, 0.0);\n#endif\nv_shadowPos = cc_matLightViewProj * vec4(worldPos, 1.0);\ngl_Position = pos;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out float mainPart, out float modPart, highp float data, const float modValue) {\nhighp float divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec2 mainPart, out vec2 modPart, highp vec2 data, const float modValue) {\nhighp vec2 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec3 mainPart, out vec3 modPart, highp vec3 data, const float modValue) {\nhighp vec3 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data) {\nmainPart = fract(data);\nmodPart = data - mainPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nvoid packHighpData (out vec4 mainPart, out vec4 modPart, highp vec4 data, const float modValue) {\nhighp vec4 divide = data / modValue;\nmainPart = floor(divide);\nmodPart = (data - mainPart * modValue) / modValue;\n}\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal, float normalBias)\n{\nvec4 newShadowPos = shadowPos;\nif(normalBias > EPSILON_LOWP)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * normalBias * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > EPSILON) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCSpotShadowFactorBase(vec4 shadowPos, vec3 worldPos, vec2 shadowBias)\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nreturn CCGetSpotLightShadowFactorSoft2X(shadowPos, worldPos, shadowBias.x);\n}else if (pcf > 0.9) {\nreturn CCGetSpotLightShadowFactorSoft(shadowPos, worldPos, shadowBias.x);\n}else {\nreturn CCGetSpotLightShadowFactorHard(shadowPos, worldPos, shadowBias.x);\n}\n}\nfloat CCShadowFactorBase(vec4 shadowPos, vec3 N, vec2 shadowBias)\n{\nfloat realtimeShadow = 1.0;\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N, shadowBias.y);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nrealtimeShadow =  CCGetShadowFactorSoft2X(pos, shadowBias.x);\n}else if (pcf > 0.9) {\nrealtimeShadow = CCGetShadowFactorSoft(pos, shadowBias.x);\n}else {\nrealtimeShadow = CCGetShadowFactorHard(pos, shadowBias.x);\n}\nreturn mix(realtimeShadow, 1.0, cc_shadowNFLSInfo.w);\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = texture(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\nfloat specularIntensity;\n#if CC_RECEIVE_SHADOW\nvec2 shadowBias;\n#endif\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.08 * s.specularIntensity), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse / PI;\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\nshadow = CCShadowFactorBase(shadowPos, N, s.shadowBias);\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > EPSILON_LOWP) {\nfinalColor = diffuse * s.lightmap.rgb * shadow;\n}\n#endif\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = texture(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nin float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\nin highp vec4 v_shadowPos;\n#if CC_RECEIVE_SHADOW\n#endif\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nin vec3 v_luv;\nuniform sampler2D cc_lightingMap;\n#endif\nin highp vec3 v_position;\nin mediump vec3 v_normal;\n#if CC_RECEIVE_SHADOW\nin vec2 v_shadowBias;\n#endif\nin mediump vec2 uvw;\nin mediump vec2 uv0;\nin mediump vec2 uv1;\nin mediump vec2 uv2;\nin mediump vec2 uv3;\nin mediump vec3 diffuse;\nin mediump vec3 luv;\nlayout(std140) uniform PbrParams {\nvec4 metallic;\nvec4 roughness;\n};\nuniform sampler2D weightMap;\nuniform sampler2D detailMap0;\nuniform sampler2D detailMap1;\nuniform sampler2D detailMap2;\nuniform sampler2D detailMap3;\nuniform sampler2D normalMap0;\nuniform sampler2D normalMap1;\nuniform sampler2D normalMap2;\nuniform sampler2D normalMap3;\nuniform sampler2D lightMap;\nvoid surf (out StandardSurface s) {\n#if LAYERS > 1\nvec4 w = texture(weightMap, uvw);\n#endif\nvec4 baseColor = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseColor = texture(detailMap0, uv0);\n#elif LAYERS == 2\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\nbaseColor += texture(detailMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseColor += texture(detailMap0, uv0) * w.r;\nbaseColor += texture(detailMap1, uv1) * w.g;\nbaseColor += texture(detailMap2, uv2) * w.b;\nbaseColor += texture(detailMap3, uv3) * w.a;\n#else\nbaseColor = texture(detailMap0, uv0);\n#endif\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\npackHighpData(s.position, s.position_fract_part, v_position);\n#else\ns.position = v_position;\n#endif\n#if USE_NORMALMAP\nvec4 baseNormal = vec4(0, 0, 0, 0);\n#if LAYERS == 1\nbaseNormal = texture(normalMap0, uv0);\n#elif LAYERS == 2\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\n#elif LAYERS == 3\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\nbaseNormal += texture(normalMap2, uv2) * w.b;\n#elif LAYERS == 4\nbaseNormal += texture(normalMap0, uv0) * w.r;\nbaseNormal += texture(normalMap1, uv1) * w.g;\nbaseNormal += texture(normalMap2, uv2) * w.b;\nbaseNormal += texture(normalMap3, uv3) * w.a;\n#else\nbaseNormal = texture(normalMap0, uv0);\n#endif\nvec3 tangent = vec3(1.0, 0.0, 0.0);\nvec3 binormal = vec3(0.0, 0.0, 1.0);\nbinormal = cross(tangent, v_normal);\ntangent = cross(v_normal, binormal);\nvec3 nmmp = baseNormal.xyz - vec3(0.5);\ns.normal =\nnmmp.x * normalize(tangent) +\nnmmp.y * normalize(binormal) +\nnmmp.z * normalize(v_normal);\n#else\ns.normal = v_normal;\n#endif\n#if CC_RECEIVE_SHADOW\ns.shadowBias = v_shadowBias;\n#endif\ns.albedo = vec4(SRGBToLinear(baseColor.rgb), 1.0);\ns.occlusion = 1.0;\n#if USE_PBR\ns.roughness = 0.0;\n#if LAYERS == 1\ns.roughness = roughness.x;\n#elif LAYERS == 2\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\n#elif LAYERS == 3\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\n#elif LAYERS == 4\ns.roughness += roughness.x * w.r;\ns.roughness += roughness.y * w.g;\ns.roughness += roughness.z * w.b;\ns.roughness += roughness.w * w.a;\n#else\ns.roughness = 1.0;\n#endif\ns.specularIntensity = 0.5;\ns.metallic = 0.0;\n#if LAYERS == 1\ns.specularIntensity = 0.5;\ns.metallic = metallic.x;\n#elif LAYERS == 2\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\n#elif LAYERS == 3\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\n#elif LAYERS == 4\ns.metallic += metallic.x * w.r;\ns.metallic += metallic.y * w.g;\ns.metallic += metallic.z * w.b;\ns.metallic += metallic.w * w.a;\n#else\ns.specularIntensity = 0.5;\ns.metallic = 0.0;\n#endif\n#else\ns.roughness = 1.0;\ns.specularIntensity = 0.5;\ns.metallic = 0.0;\n#endif\ns.emissive = vec3(0.0, 0.0, 0.0);\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nvec4 lightColor = texture(lightMap, luv.xy);\ns.lightmap = lightColor.xyz * luv.z;\ns.lightmap_test = luv.z;\n#endif\n}\n#if CC_FORWARD_ADD\n#if CC_PIPELINE_TYPE == 0\n#define LIGHTS_PER_PASS 1\n#else\n#define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nlayout(std140) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = litRadiusSqr / max(litRadiusSqr, distSqr);\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nlayout(std430, binding = 4) readonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nlayout(std430, binding = 5) readonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nlayout(std430, binding = 6) readonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = PI * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nvec4 color = CCClusterShadingAdditive(s, v_shadowPos);\n#else\nvec4 color = CCStandardShadingAdditive(s, v_shadowPos);\n#endif\nfragColorX = CCFragOutput(color);\n}\n#elif (CC_PIPELINE_TYPE == 0 || CC_FORCE_FORWARD_SHADING)\nlayout(location = 0) out vec4 fragColorX;\nvoid main () {\nStandardSurface s; surf(s);\nvec4 color = CCStandardShadingBase(s, v_shadowPos);\nCC_APPLY_FOG(color, s.position.xyz);\nfragColorX = CCFragOutput(color);\n}\n#elif CC_PIPELINE_TYPE == 1\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec2 float32x3_to_oct(in vec3 v) {\nvec2 p = v.xy * (1.0 / (abs(v.x) + abs(v.y) + abs(v.z)));\nreturn (v.z <= 0.0) ? ((1.0 - abs(p.yx)) * signNotZero(p)) : p;\n}\nlayout(location = 0) out vec4 fragColor0;\nlayout(location = 1) out vec4 fragColor1;\nlayout(location = 2) out vec4 fragColor2;\nvoid main () {\nStandardSurface s; surf(s);\nfragColor0 = s.albedo;\nfragColor1 = vec4(float32x3_to_oct(s.normal), s.roughness, s.metallic);\nfragColor2 = vec4(s.emissive, s.occlusion);\n}\n#endif"},{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nout vec2 v_clip_depth;\nvec4 vert () {\nvec4 worldPos;\nworldPos.x = cc_matWorld[3][0] + a_position.x;\nworldPos.y = cc_matWorld[3][1] + a_position.y;\nworldPos.z = cc_matWorld[3][2] + a_position.z;\nworldPos.w = 1.0;\nvec4 clipPos = cc_matLightViewProj * worldPos;\nv_clip_depth = clipPos.zw;\nreturn clipPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec4 packDepthToRGBA (float depth) {\nvec4 ret = vec4(1.0, 255.0, 65025.0, 16581375.0) * depth;\nret = fract(ret);\nret -= vec4(ret.yzw, 0.0) / 255.0;\nreturn ret;\n}\nin vec2 v_clip_depth;\nvec4 frag () {\nreturn packDepthToRGBA(v_clip_depth.x / v_clip_depth.y * 0.5 + 0.5);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout vec4 In)\n{\nIn = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if !USE_INSTANCING\n#if USE_BATCHING\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\n#endif\n#endif\nvoid CCGetWorldMatrix(out mat4 matWorld)\n{\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\n#if !CC_USE_ACCURATE_FOG\nout float v_fog_factor;\n#endif\nvoid CC_TRANSFER_FOG(vec4 pos) {\n#if !CC_USE_ACCURATE_FOG\nCC_TRANSFER_FOG_BASE(pos, v_fog_factor);\n#endif\n}\n#if USE_VERTEX_COLOR\nin lowp vec4 a_color;\nout lowp vec4 v_color;\n#endif\n#if USE_TEXTURE\nout vec2 v_uv;\nlayout(std140) uniform TexCoords {\nvec4 tilingOffset;\n};\n#endif\nvec4 vert () {\nvec4 position;\nCCVertInput(position);\nmat4 matWorld;\nCCGetWorldMatrix(matWorld);\n#if USE_TEXTURE\nv_uv = a_texCoord * tilingOffset.xy + tilingOffset.zw;\n#if SAMPLE_FROM_RT\nv_uv = cc_cameraPos.w > 1.0 ? vec2(v_uv.x, 1.0 - v_uv.y) : v_uv;\n#endif\n#endif\n#if USE_VERTEX_COLOR\nv_color = a_color;\n#endif\nCC_TRANSFER_FOG(matWorld * position);\nreturn cc_matProj * (cc_matView * matWorld) * position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision highp float;\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\n#if !CC_USE_ACCURATE_FOG\nin float v_fog_factor;\n#endif\nvoid CC_APPLY_FOG(inout vec4 color) {\n#if !CC_USE_ACCURATE_FOG\nCC_APPLY_FOG_BASE(color, v_fog_factor);\n#endif\n}\nvoid CC_APPLY_FOG(inout vec4 color, vec3 worldPos) {\n#if CC_USE_ACCURATE_FOG\nfloat factor;\nCC_TRANSFER_FOG_BASE(vec4(worldPos, 1.0), factor);\n#else\nfloat factor = v_fog_factor;\n#endif\nCC_APPLY_FOG_BASE(color, factor);\n}\n#if USE_ALPHA_TEST\n#endif\n#if USE_TEXTURE\nin vec2 v_uv;\nuniform sampler2D mainTexture;\n#endif\nlayout(std140) uniform Constant {\nvec4 mainColor;\nvec4 colorScaleAndCutoff;\n};\n#if USE_VERTEX_COLOR\nin lowp vec4 v_color;\n#endif\nvec4 frag () {\nvec4 o = mainColor;\no.rgb *= colorScaleAndCutoff.xyz;\n#if USE_VERTEX_COLOR\no.rgb *= SRGBToLinear(v_color.rgb);\no.a *= v_color.a;\n#endif\n#if USE_TEXTURE\nvec4 texColor = texture(mainTexture, v_uv);\ntexColor.rgb = SRGBToLinear(texColor.rgb);\no *= texColor;\n#endif\n#if USE_ALPHA_TEST\nif (o.ALPHA_TEST_CHANNEL < colorScaleAndCutoff.w) discard;\n#endif\nCC_APPLY_FOG(o);\nreturn CCFragOutput(o);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nin vec2 v_uv;\nlayout(std140) uniform BloomUBO {\nmediump vec4 texSize;\n};\nuniform sampler2D outputResultMap;\nlayout(location = 0) out vec4 fragColor;\nfloat luminance(vec3 color) {\nreturn dot(color, vec3(0.2126, 0.7152, 0.0722));\n}\nvoid main() {\nvec3 color = texture(outputResultMap, v_uv).xyz;\nif (luminance(SRGBToLinear(color)) > texSize.z) {\nfragColor = vec4(color, 1.0);\n} else {\nfragColor = vec4(0.0, 0.0, 0.0, 1.0);\n}\n}"},{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin vec2 v_uv;\nlayout(std140) uniform BloomUBO {\nmediump vec4 texSize;\n};\nuniform sampler2D bloomTexture;\nlayout(location = 0) out vec4 fragColor;\nvec3 downsample4taps(vec2 uv, vec2 halfpixel) {\nvec3 sum = texture(bloomTexture, uv + vec2(-halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, -halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(-halfpixel.x, -halfpixel.y)).xyz;\nreturn sum / 4.0;\n}\nvoid main()\n{\nvec3 result = downsample4taps(v_uv, 1.0 / texSize.xy).rgb;\nfragColor = vec4(result, 1.0);\n}"},{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin vec2 v_uv;\nlayout(std140) uniform BloomUBO {\nmediump vec4 texSize;\n};\nuniform sampler2D bloomTexture;\nlayout(location = 0) out vec4 fragColor;\nvec3 upsample4taps(vec2 uv, vec2 halfpixel) {\nvec3 sum = texture(bloomTexture, uv + vec2(-halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(halfpixel.x, -halfpixel.y)).xyz;\nsum += texture(bloomTexture, uv + vec2(-halfpixel.x, -halfpixel.y)).xyz;\nreturn sum / 4.0;\n}\nvoid main() {\nvec3 result = upsample4taps(v_uv, 0.5 / texSize.xy).rgb;\nfragColor = vec4(result, 1.0);\n}"},{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin vec2 v_uv;\nlayout(std140) uniform BloomUBO {\nmediump vec4 texSize;\n};\nuniform sampler2D outputResultMap;\nuniform sampler2D bloomTexture;\nlayout(location = 0) out vec4 fragColor;\nvoid main() {\nvec4 hdrColor = texture(outputResultMap, v_uv);\nvec3 bloomColor = texture(bloomTexture, v_uv).rgb;\nvec3 result = hdrColor.rgb + bloomColor * texSize.w * hdrColor.a;\nfragColor = vec4(result, hdrColor.a);\n}"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\n#endif\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nvec4 position;\nposition = vec4(a_position, 1.0);\nposition.xy = cc_cameraPos.w == 0.0 ? vec2(position.xy.x, -position.xy.y) : position.xy;\ngl_Position = vec4(position.x, position.y, 1.0, 1.0);\nv_uv = a_texCoord;\n}",frag:"\n#ifdef GL_EXT_shader_framebuffer_fetch\n#extension GL_EXT_shader_framebuffer_fetch: enable\n#endif\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nhighp float unpackHighpData (float mainPart, float modPart) {\nhighp float data = mainPart;\nreturn data + modPart;\n}\nhighp float unpackHighpData (float mainPart, float modPart, const float modValue) {\nhighp float data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart) {\nhighp vec2 data = mainPart;\nreturn data + modPart;\n}\nhighp vec2 unpackHighpData (vec2 mainPart, vec2 modPart, const float modValue) {\nhighp vec2 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart) {\nhighp vec3 data = mainPart;\nreturn data + modPart;\n}\nhighp vec3 unpackHighpData (vec3 mainPart, vec3 modPart, const float modValue) {\nhighp vec3 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart) {\nhighp vec4 data = mainPart;\nreturn data + modPart;\n}\nhighp vec4 unpackHighpData (vec4 mainPart, vec4 modPart, const float modValue) {\nhighp vec4 data = mainPart * modValue;\nreturn data + modPart * modValue;\n}\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\nfloat CCGetLinearDepthFromViewSpace(vec3 viewPos) {\nfloat dist = length(viewPos);\nreturn (dist - cc_shadowNFLSInfo.x) / (cc_shadowNFLSInfo.y - cc_shadowNFLSInfo.x);\n}\nfloat CCGetLinearDepth(vec3 worldPos) {\nvec4 viewStartPos = cc_matLightView * vec4(worldPos.xyz, 1.0);\nreturn CCGetLinearDepthFromViewSpace(viewStartPos.xyz);\n}\n#if CC_RECEIVE_SHADOW\nuniform highp sampler2D cc_shadowMap;\nuniform highp sampler2D cc_spotLightingMap;\nvec4 ApplyShadowDepthBias_FaceNormal(vec4 shadowPos, vec3 worldNormal, float normalBias)\n{\nvec4 newShadowPos = shadowPos;\nif(normalBias > EPSILON_LOWP)\n{\nvec4 viewNormal = cc_matLightView * vec4(worldNormal, 0.0);\nif(viewNormal.z < 0.1)\nnewShadowPos.xy += viewNormal.xy * cc_shadowProjInfo.xy * normalBias * clamp(viewNormal.z, 0.001, 0.1);\n}\nreturn newShadowPos;\n}\nvec4 ApplyShadowDepthBias_Perspective(vec4 shadowPos, float viewspaceDepthBias)\n{\nvec3 viewSpacePos;\nviewSpacePos.xy = shadowPos.xy * cc_shadowProjInfo.zw;\nviewSpacePos.z = shadowPos.z * cc_shadowInvProjDepthInfo.x + shadowPos.w * cc_shadowInvProjDepthInfo.y;\nviewSpacePos.xyz += cc_shadowProjDepthInfo.z * normalize(viewSpacePos.xyz) * viewspaceDepthBias;\nvec4 clipSpacePos;\nclipSpacePos.xy = viewSpacePos.xy * cc_shadowProjInfo.xy;\nclipSpacePos.zw = viewSpacePos.z * cc_shadowProjDepthInfo.xz + vec2(cc_shadowProjDepthInfo.y, 0.0);\nif (cc_shadowNFLSInfo.z > EPSILON) {\nclipSpacePos.z = CCGetLinearDepthFromViewSpace(viewSpacePos.xyz);\nclipSpacePos.z = (clipSpacePos.z * 2.0 - 1.0) * clipSpacePos.w;\n}\nreturn clipSpacePos;\n}\nvec4 ApplyShadowDepthBias_Orthographic(vec4 shadowPos, float viewspaceDepthBias)\n{\nfloat coeffA = cc_shadowProjDepthInfo.x;\nfloat coeffB = cc_shadowProjDepthInfo.y;\nfloat viewSpacePos_z = (shadowPos.z - coeffB) / coeffA;\nviewSpacePos_z += viewspaceDepthBias;\nvec4 result = shadowPos;\nresult.z = viewSpacePos_z * coeffA + coeffB;\nreturn result;\n}\nfloat CCGetShadowFactorHard (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture(cc_shadowMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_shadowMap, clipPos.xy).x;\n}\nshadow = step(clipPos.z, closestDepth);\nreturn shadow;\n}\nfloat CCGetShadowFactorSoft (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * mapSize.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetShadowFactorSoft2X (vec4 shadowPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Orthographic(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat offsetDepth = clipPos.z;\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(offsetDepth, dot(texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(offsetDepth, texture(cc_shadowMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCGetSpotLightShadowFactorHard (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat shadow = 0.0;\nfloat closestDepth = 0.0;\nfloat depth = clipPos.z;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nclosestDepth = dot(texture(cc_spotLightingMap, clipPos.xy), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0));\n} else {\nclosestDepth = texture(cc_spotLightingMap, clipPos.xy).x;\n}\nshadow = step(depth, closestDepth);\nreturn shadow;\n}\nfloat CCGetSpotLightShadowFactorSoft (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 oneTap = 1.0 / cc_shadowWHPBInfo.xy;\nvec2 clipPos_offset = clipPos.xy + oneTap;\nfloat block0, block1, block2, block3;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos.y)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset.y)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset.x, clipPos_offset.y)).x);\n}\nfloat coefX   = mod(clipPos.x, oneTap.x) * cc_shadowWHPBInfo.x;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block2, block3, coefX);\nfloat coefY   = mod(clipPos.y, oneTap.y) * cc_shadowWHPBInfo.y;\nreturn mix(resultX, resultY, coefY);\n}\nfloat CCGetSpotLightShadowFactorSoft2X (vec4 shadowPos, vec3 worldPos, float bias) {\nvec4 clipPosNew = ApplyShadowDepthBias_Perspective(shadowPos, bias);\nvec3 clipPos = clipPosNew.xyz / clipPosNew.w * 0.5 + 0.5;\nif (clipPos.x < 0.0 || clipPos.x > 1.0 ||\nclipPos.y < 0.0 || clipPos.y > 1.0 ||\nclipPos.z < 0.0 || clipPos.z > 1.0) { return 1.0; }\nclipPos.xy = cc_cameraPos.w == 1.0 ? vec2(clipPos.xy.x, 1.0 - clipPos.xy.y) : clipPos.xy;\nfloat depth = 0.0;\nif (cc_shadowNFLSInfo.z > EPSILON) {\ndepth = CCGetLinearDepth(worldPos);\n} else {\ndepth = clipPos.z;\n}\nvec2 mapSize = cc_shadowWHPBInfo.xy;\nvec2 oneTap = 1.0 / mapSize;\nfloat clipPos_offset_L = clipPos.x - oneTap.x;\nfloat clipPos_offset_R = clipPos.x + oneTap.x;\nfloat clipPos_offset_U = clipPos.y - oneTap.y;\nfloat clipPos_offset_D = clipPos.y + oneTap.y;\nfloat block0, block1, block2, block3, block4, block5, block6, block7, block8;\nif (cc_shadowLPNNInfo.y > EPSILON) {\nblock0 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock1 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock2 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock3 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock4 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock5 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock6 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock7 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\nblock8 = step(depth, dot(texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)), vec4(1.0, 1.0 / 255.0, 1.0 / 65025.0, 1.0 / 16581375.0)));\n} else {\nblock0 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_U)).x);\nblock1 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_U)).x);\nblock2 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_U)).x);\nblock3 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos.y)).x);\nblock4 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos.y)).x);\nblock5 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos.y)).x);\nblock6 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_L, clipPos_offset_D)).x);\nblock7 = step(depth, texture(cc_spotLightingMap, vec2(clipPos.x, clipPos_offset_D)).x);\nblock8 = step(depth, texture(cc_spotLightingMap, vec2(clipPos_offset_R, clipPos_offset_D)).x);\n}\nfloat coefX = mod(clipPos.x, oneTap.x) * mapSize.x;\nfloat coefY = mod(clipPos.y, oneTap.y) * mapSize.y;\nfloat shadow = 0.0;\nfloat resultX = mix(block0, block1, coefX);\nfloat resultY = mix(block3, block4, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block1, block2, coefX);\nresultY = mix(block4, block5, coefX);\nshadow += mix(resultX , resultY, coefY);\nresultX = mix(block3, block4, coefX);\nresultY = mix(block6, block7, coefX);\nshadow += mix(resultX, resultY, coefY);\nresultX = mix(block4, block5, coefX);\nresultY = mix(block7, block8, coefX);\nshadow += mix(resultX, resultY, coefY);\nreturn shadow * 0.25;\n}\nfloat CCSpotShadowFactorBase(vec4 shadowPos, vec3 worldPos, vec2 shadowBias)\n{\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nreturn CCGetSpotLightShadowFactorSoft2X(shadowPos, worldPos, shadowBias.x);\n}else if (pcf > 0.9) {\nreturn CCGetSpotLightShadowFactorSoft(shadowPos, worldPos, shadowBias.x);\n}else {\nreturn CCGetSpotLightShadowFactorHard(shadowPos, worldPos, shadowBias.x);\n}\n}\nfloat CCShadowFactorBase(vec4 shadowPos, vec3 N, vec2 shadowBias)\n{\nfloat realtimeShadow = 1.0;\nvec4 pos = ApplyShadowDepthBias_FaceNormal(shadowPos, N, shadowBias.y);\nfloat pcf = cc_shadowWHPBInfo.z;\nif (pcf > 1.9) {\nrealtimeShadow =  CCGetShadowFactorSoft2X(pos, shadowBias.x);\n}else if (pcf > 0.9) {\nrealtimeShadow = CCGetShadowFactorSoft(pos, shadowBias.x);\n}else {\nrealtimeShadow = CCGetShadowFactorHard(pos, shadowBias.x);\n}\nreturn mix(realtimeShadow, 1.0, cc_shadowNFLSInfo.w);\n}\n#endif\n#if CC_USE_IBL\nuniform samplerCube cc_environment;\nvec4 fragTextureLod (sampler2D tex, vec2 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec4 fragTextureLod (samplerCube tex, vec3 coord, float lod) {\nreturn textureLod(tex, coord, lod);\n}\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\n#if CC_USE_DIFFUSEMAP\nuniform samplerCube cc_diffuseMap;\n#endif\n#endif\nfloat GGXMobile (float roughness, float NoH, vec3 H, vec3 N) {\nvec3 NxH = cross(N, H);\nfloat OneMinusNoHSqr = dot(NxH, NxH);\nfloat a = roughness * roughness;\nfloat n = NoH * a;\nfloat p = a / (OneMinusNoHSqr + n * n);\nreturn p * p;\n}\nfloat CalcSpecular (float roughness, float NoH, vec3 H, vec3 N) {\nreturn (roughness * 0.25 + 0.25) * GGXMobile(roughness, NoH, H, N);\n}\nvec3 BRDFApprox (vec3 specular, float roughness, float NoV) {\nconst vec4 c0 = vec4(-1.0, -0.0275, -0.572, 0.022);\nconst vec4 c1 = vec4(1.0, 0.0425, 1.04, -0.04);\nvec4 r = roughness * c0 + c1;\nfloat a004 = min(r.x * r.x, exp2(-9.28 * NoV)) * r.x + r.y;\nvec2 AB = vec2(-1.04, 1.04) * a004 + r.zw;\nAB.y *= clamp(50.0 * specular.g, 0.0, 1.0);\nreturn specular * AB.x + AB.y;\n}\n#if USE_REFLECTION_DENOISE\nvec3 GetEnvReflectionWithMipFiltering(vec3 R, float roughness, float mipCount, float denoiseIntensity) {\n#if CC_USE_IBL\nfloat mip = roughness * mipCount;\nfloat delta = (dot(dFdx(R), dFdy(R))) * 1000.0;\nfloat mipBias = mix(0.0, 5.0, clamp(delta, 0.0, 1.0));\nvec4 biased = fragTextureLod(cc_environment, R, mip + mipBias);\nvec4 filtered = texture(cc_environment, R);\n#if CC_USE_IBL == 2\nbiased.rgb = unpackRGBE(biased);\nfiltered.rgb = unpackRGBE(filtered);\n#else\nbiased.rgb = SRGBToLinear(biased.rgb);\nfiltered.rgb = SRGBToLinear(filtered.rgb);\n#endif\nreturn mix(biased.rgb, filtered.rgb, denoiseIntensity);\n#else\nreturn vec3(0.0, 0.0, 0.0);\n#endif\n}\n#endif\nstruct StandardSurface {\nvec4 albedo;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nvec3 position, position_fract_part;\n#else\nvec3 position;\n#endif\nvec3 normal;\nvec3 emissive;\nvec3 lightmap;\nfloat lightmap_test;\nfloat roughness;\nfloat metallic;\nfloat occlusion;\nfloat specularIntensity;\n#if CC_RECEIVE_SHADOW\nvec2 shadowBias;\n#endif\n};\nvec4 CCStandardShadingBase (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.08 * s.specularIntensity), s.albedo.rgb, s.metallic);\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 L = normalize(-cc_mainLitDir.xyz);\nvec3 H = normalize(L + V);\nfloat NH = max(dot(N, H), 0.0);\nfloat NL = max(dot(N, L), 0.0);\nvec3 finalColor = NL * cc_mainLitColor.rgb * cc_mainLitColor.w;\nvec3 diffuseContrib = diffuse / PI;\nvec3 specularContrib = specular * CalcSpecular(s.roughness, NH, H, N);\nvec3 dirlightContrib = (diffuseContrib + specularContrib);\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (NL > 0.0 && cc_mainLitDir.w > 0.0) {\nshadow = CCShadowFactorBase(shadowPos, N, s.shadowBias);\n}\n#endif\ndirlightContrib *= shadow;\nfinalColor *= dirlightContrib;\n#if CC_USE_LIGHTMAP && !USE_BATCHING && !CC_FORWARD_ADD\nif (s.lightmap_test > EPSILON_LOWP) {\nfinalColor = diffuse * s.lightmap.rgb * shadow;\n}\n#endif\nfloat fAmb = 0.5 - N.y * 0.5;\nvec3 ambDiff = mix(cc_ambientSky.rgb, cc_ambientGround.rgb, fAmb);\n#if CC_USE_IBL\n#if CC_USE_DIFFUSEMAP\nvec4 diffuseMap = texture(cc_diffuseMap, N);\n#if CC_USE_DIFFUSEMAP == 2\nambDiff = unpackRGBE(diffuseMap);\n#else\nambDiff = SRGBToLinear(diffuseMap.rgb);\n#endif\n#endif\nvec3 R = normalize(reflect(-V, N));\n#if USE_REFLECTION_DENOISE\nvec3 env = GetEnvReflectionWithMipFiltering(R, s.roughness, cc_ambientGround.w, 0.6);\n#else\nvec4 envmap = fragTextureLod(cc_environment, R, s.roughness * cc_ambientGround.w);\n#if CC_USE_IBL == 2\nvec3 env = unpackRGBE(envmap);\n#else\nvec3 env = SRGBToLinear(envmap.rgb);\n#endif\n#endif\nfinalColor += env * cc_ambientSky.w * specular * s.occlusion;\n#endif\nfinalColor += ambDiff.rgb * cc_ambientSky.w * diffuse * s.occlusion;\nfinalColor += s.emissive;\nreturn vec4(finalColor, s.albedo.a);\n}\n#if CC_PIPELINE_TYPE == 0\n#define LIGHTS_PER_PASS 1\n#else\n#define LIGHTS_PER_PASS 10\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nlayout(std140) uniform CCForwardLight {\nhighp vec4 cc_lightPos[LIGHTS_PER_PASS];\nvec4 cc_lightColor[LIGHTS_PER_PASS];\nvec4 cc_lightSizeRangeAngle[LIGHTS_PER_PASS];\nvec4 cc_lightDir[LIGHTS_PER_PASS];\n};\n#endif\nfloat SmoothDistAtt (float distSqr, float invSqrAttRadius) {\nfloat factor = distSqr * invSqrAttRadius;\nfloat smoothFactor = clamp(1.0 - factor * factor, 0.0, 1.0);\nreturn smoothFactor * smoothFactor;\n}\nfloat GetDistAtt (float distSqr, float invSqrAttRadius) {\nfloat attenuation = 1.0 / max(distSqr, 0.01*0.01);\nattenuation *= SmoothDistAtt(distSqr , invSqrAttRadius);\nreturn attenuation;\n}\nfloat GetAngleAtt (vec3 L, vec3 litDir, float litAngleScale, float litAngleOffset) {\nfloat cd = dot(litDir, L);\nfloat attenuation = clamp(cd * litAngleScale + litAngleOffset, 0.0, 1.0);\nreturn (attenuation * attenuation);\n}\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 0\nvec4 CCStandardShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.0);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nint numLights = CC_PIPELINE_TYPE == 0 ? LIGHTS_PER_PASS : int(cc_lightDir[0].w);\nfor (int i = 0; i < LIGHTS_PER_PASS; i++) {\nif (i >= numLights) break;\nvec3 SLU = cc_lightPos[i].xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.0);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = cc_lightSizeRangeAngle[i].x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = litRadiusSqr / max(litRadiusSqr, distSqr);\nfloat attRadiusSqrInv = 1.0 / max(cc_lightSizeRangeAngle[i].y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (cc_lightPos[i].w > 0.0) {\nfloat cosInner = max(dot(-cc_lightDir[i].xyz, SL), 0.01);\nfloat cosOuter = cc_lightSizeRangeAngle[i].z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -cc_lightDir[i].xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = cc_lightColor[i].rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (cc_lightPos[i].w > 0.0 && cc_lightSizeRangeAngle[i].w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * cc_lightColor[i].w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nlayout(std430, binding = 4) readonly buffer b_ccLightsBuffer { vec4 b_ccLights[]; };\nlayout(std430, binding = 5) readonly buffer b_clusterLightIndicesBuffer { uint b_clusterLightIndices[]; };\nlayout(std430, binding = 6) readonly buffer b_clusterLightGridBuffer { uvec4 b_clusterLightGrid[]; };\nstruct CCLight\n{\nvec4 cc_lightPos;\nvec4 cc_lightColor;\nvec4 cc_lightSizeRangeAngle;\nvec4 cc_lightDir;\n};\nstruct Cluster\n{\nvec3 minBounds;\nvec3 maxBounds;\n};\nstruct LightGrid\n{\nuint offset;\nuint ccLights;\n};\nCCLight getCCLight(uint i)\n{\nCCLight light;\nlight.cc_lightPos = b_ccLights[4u * i + 0u];\nlight.cc_lightColor = b_ccLights[4u * i + 1u];\nlight.cc_lightSizeRangeAngle = b_ccLights[4u * i + 2u];\nlight.cc_lightDir = b_ccLights[4u * i + 3u];\nreturn light;\n}\nLightGrid getLightGrid(uint cluster)\n{\nuvec4 gridvec = b_clusterLightGrid[cluster];\nLightGrid grid;\ngrid.offset = gridvec.x;\ngrid.ccLights = gridvec.y;\nreturn grid;\n}\nuint getGridLightIndex(uint start, uint offset)\n{\nreturn b_clusterLightIndices[start + offset];\n}\nuint getClusterZIndex(vec4 worldPos)\n{\nfloat scale = float(24) / log(cc_nearFar.y / cc_nearFar.x);\nfloat bias = -(float(24) * log(cc_nearFar.x) / log(cc_nearFar.y / cc_nearFar.x));\nfloat eyeDepth = -(cc_matView * worldPos).z;\nuint zIndex = uint(max(log(eyeDepth) * scale + bias, 0.0));\nreturn zIndex;\n}\nuint getClusterIndex(vec4 fragCoord, vec4 worldPos)\n{\nuint zIndex = getClusterZIndex(worldPos);\nfloat clusterSizeX = ceil(cc_viewPort.z / float(16));\nfloat clusterSizeY = ceil(cc_viewPort.w / float(8));\nuvec3 indices = uvec3(uvec2(fragCoord.xy / vec2(clusterSizeX, clusterSizeY)), zIndex);\nuint cluster = (16u * 8u) * indices.z + 16u * indices.y + indices.x;\nreturn cluster;\n}\nvec4 CCClusterShadingAdditive (StandardSurface s, vec4 shadowPos) {\nvec3 diffuse = s.albedo.rgb * (1.0 - s.metallic);\nvec3 specular = mix(vec3(0.04), s.albedo.rgb, s.metallic);\nvec3 diffuseContrib = diffuse / PI;\nvec3 position;\n#if CC_PLATFORM_ANDROID_AND_WEBGL && CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES\nposition = unpackHighpData(s.position, s.position_fract_part);\n#else\nposition = s.position;\n#endif\nvec3 N = normalize(s.normal);\nvec3 V = normalize(cc_cameraPos.xyz - position);\nfloat NV = max(abs(dot(N, V)), 0.001);\nspecular = BRDFApprox(specular, s.roughness, NV);\nvec3 finalColor = vec3(0.0);\nuint cluster = getClusterIndex(gl_FragCoord, vec4(position, 1.0));\nLightGrid grid = getLightGrid(cluster);\nuint numLights = grid.ccLights;\nfor (uint i = 0u; i < 100u; i++) {\nif (i >= numLights) break;\nuint lightIndex = getGridLightIndex(grid.offset, i);\nCCLight light = getCCLight(lightIndex);\nvec3 SLU = light.cc_lightPos.xyz - position;\nvec3 SL = normalize(SLU);\nvec3 SH = normalize(SL + V);\nfloat SNL = max(dot(N, SL), 0.001);\nfloat SNH = max(dot(N, SH), 0.0);\nfloat distSqr = dot(SLU, SLU);\nfloat litRadius = light.cc_lightSizeRangeAngle.x;\nfloat litRadiusSqr = litRadius * litRadius;\nfloat illum = PI * (litRadiusSqr / max(litRadiusSqr , distSqr));\nfloat attRadiusSqrInv = 1.0 / max(light.cc_lightSizeRangeAngle.y, 0.01);\nattRadiusSqrInv *= attRadiusSqrInv;\nfloat att = GetDistAtt(distSqr, attRadiusSqrInv);\nvec3 lspec = specular * CalcSpecular(s.roughness, SNH, SH, N);\nif (light.cc_lightPos.w > 0.0) {\nfloat cosInner = max(dot(-light.cc_lightDir.xyz, SL), 0.01);\nfloat cosOuter = light.cc_lightSizeRangeAngle.z;\nfloat litAngleScale = 1.0 / max(0.001, cosInner - cosOuter);\nfloat litAngleOffset = -cosOuter * litAngleScale;\natt *= GetAngleAtt(SL, -light.cc_lightDir.xyz, litAngleScale, litAngleOffset);\n}\nvec3 lightColor = light.cc_lightColor.rgb;\nfloat shadow = 1.0;\n#if CC_RECEIVE_SHADOW\nif (light.cc_lightPos.w > 0.0) {\nshadow = CCSpotShadowFactorBase(shadowPos, position, s.shadowBias);\n}\n#endif\nlightColor *= shadow;\nfinalColor += SNL * lightColor * light.cc_lightColor.w * illum * att * (diffuseContrib + lspec);\n}\nreturn vec4(finalColor, 0.0);\n}\n#endif\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nfloat LinearFog(vec4 pos) {\nvec4 wPos = pos;\nfloat cam_dis = distance(cc_cameraPos, wPos);\nfloat fogStart = cc_fogBase.x;\nfloat fogEnd = cc_fogBase.y;\nreturn clamp((fogEnd - cam_dis) / (fogEnd - fogStart), 0., 1.);\n}\nfloat ExpFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * fogDensity);\nreturn f;\n}\nfloat ExpSquaredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat fogStart = cc_fogBase.x;\nfloat fogDensity = cc_fogBase.z;\nfloat cam_dis = max(distance(cc_cameraPos, wPos) - fogStart, 0.0) / fogAtten * 4.;\nfloat f = exp(-cam_dis * cam_dis * fogDensity * fogDensity);\nreturn f;\n}\nfloat LayeredFog(vec4 pos) {\nvec4 wPos = pos;\nfloat fogAtten = cc_fogAdd.z;\nfloat _FogTop = cc_fogAdd.x;\nfloat _FogRange = cc_fogAdd.y;\nvec3 camWorldProj = cc_cameraPos.xyz;\ncamWorldProj.y = 0.;\nvec3 worldPosProj = wPos.xyz;\nworldPosProj.y = 0.;\nfloat fDeltaD = distance(worldPosProj, camWorldProj) / fogAtten * 2.0;\nfloat fDeltaY, fDensityIntegral;\nif (cc_cameraPos.y > _FogTop) {\nif (wPos.y < _FogTop) {\nfDeltaY = (_FogTop - wPos.y) / _FogRange * 2.0;\nfDensityIntegral = fDeltaY * fDeltaY * 0.5;\n} else {\nfDeltaY = 0.;\nfDensityIntegral = 0.;\n}\n} else {\nif (wPos.y < _FogTop) {\nfloat fDeltaA = (_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfloat fDeltaB = (_FogTop - wPos.y) / _FogRange * 2.;\nfDeltaY = abs(fDeltaA - fDeltaB);\nfDensityIntegral = abs((fDeltaA * fDeltaA * 0.5) - (fDeltaB * fDeltaB * 0.5));\n} else {\nfDeltaY = abs(_FogTop - cc_cameraPos.y) / _FogRange * 2.;\nfDensityIntegral = abs(fDeltaY * fDeltaY * 0.5);\n}\n}\nfloat fDensity;\nif (fDeltaY != 0.) {\nfDensity = (sqrt(1.0 + ((fDeltaD / fDeltaY) * (fDeltaD / fDeltaY)))) * fDensityIntegral;\n} else {\nfDensity = 0.;\n}\nfloat f = exp(-fDensity);\nreturn f;\n}\nvoid CC_TRANSFER_FOG_BASE(vec4 pos, out float factor)\n{\n#if CC_USE_FOG == 0\nfactor = LinearFog(pos);\n#elif CC_USE_FOG == 1\nfactor = ExpFog(pos);\n#elif CC_USE_FOG == 2\nfactor = ExpSquaredFog(pos);\n#elif CC_USE_FOG == 3\nfactor = LayeredFog(pos);\n#else\nfactor = 1.0;\n#endif\n}\nvoid CC_APPLY_FOG_BASE(inout vec4 color, float factor) {\ncolor = vec4(mix(cc_fogColor.rgb, color.rgb, factor), color.a);\n}\nvec2 signNotZero(vec2 v) {\nreturn vec2((v.x >= 0.0) ? +1.0 : -1.0, (v.y >= 0.0) ? +1.0 : -1.0);\n}\nvec3 oct_to_float32x3(vec2 e) {\nvec3 v = vec3(e.xy, 1.0 - abs(e.x) - abs(e.y));\nif (v.z < 0.0) v.xy = (1.0 - abs(v.yx)) * signNotZero(v.xy);\nreturn normalize(v);\n}\nvec4 screen2WS(vec3 coord) {\nvec3 ndc = vec3(\n2.0 * (coord.x - cc_viewPort.x) / cc_viewPort.z - 1.0,\n2.0 * (coord.y - cc_viewPort.y) / cc_viewPort.w - 1.0,\n2.0 * coord.z - 1.0);\nvec4 world = ((cc_matViewProjInv) * (vec4(ndc, 1.0)));\nworld      = world / world.w;\nreturn world;\n}\nin vec2 v_uv;\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\nlayout(location = 0) inout vec4 gbuffer_albedoMap;\nlayout(location = 1) inout vec4 gbuffer_normalMap;\nlayout(location = 2) inout vec4 gbuffer_emissiveMap;\nuniform sampler2D depth_stencil;\n#else\nuniform sampler2D gbuffer_albedoMap;\nuniform sampler2D gbuffer_normalMap;\nuniform sampler2D gbuffer_emissiveMap;\nuniform sampler2D depth_stencil;\n#endif\n#if !CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT || __VERSION__ >= 450\nlayout(location = 0) out vec4 fragColor;\n#endif\nvoid main () {\nStandardSurface s;\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\nvec4 albedoMap = gbuffer_albedoMap;\nvec4 normalMap = gbuffer_normalMap;\nvec4 emissiveMap = gbuffer_emissiveMap;\nfloat depth = texture(depth_stencil, v_uv).x;\n#else\nvec4 albedoMap = texture(gbuffer_albedoMap,v_uv);\nvec4 normalMap = texture(gbuffer_normalMap,v_uv);\nvec4 emissiveMap = texture(gbuffer_emissiveMap,v_uv);\nfloat depth = texture(depth_stencil, v_uv).x;\n#endif\ns.albedo = albedoMap;\nvec3 position = screen2WS(vec3(gl_FragCoord.xy, depth)).xyz;\ns.position = position;\ns.roughness = normalMap.z;\ns.normal = oct_to_float32x3(normalMap.xy);\ns.specularIntensity = 0.5;\ns.metallic = normalMap.w;\ns.emissive = emissiveMap.xyz;\ns.occlusion = emissiveMap.w;\nfloat fogFactor;\nCC_TRANSFER_FOG_BASE(vec4(position, 1), fogFactor);\nvec4 shadowPos;\nshadowPos = cc_matLightViewProj * vec4(position, 1);\nvec4 color = CCStandardShadingBase(s, shadowPos) +\n#if CC_ENABLE_CLUSTERED_LIGHT_CULLING == 1\nCCClusterShadingAdditive(s, shadowPos);\n#else\nCCStandardShadingAdditive(s, shadowPos);\n#endif\nCC_APPLY_FOG_BASE(color, fogFactor);\ncolor = CCFragOutput(color);\n#if CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT\ngbuffer_emissiveMap = color;\n#else\nfragColor = color;\n#endif\n}"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout vec4 In)\n{\nIn = vec4(a_position, 1.0);\n#if CC_USE_MORPH\napplyMorph(In);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In);\n#endif\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if !USE_INSTANCING\n#if USE_BATCHING\nlayout(std140) uniform CCLocalBatched {\nhighp mat4 cc_matWorlds[10];\n};\n#else\nlayout(std140) uniform CCLocal {\nhighp mat4 cc_matWorld;\nhighp mat4 cc_matWorldIT;\nhighp vec4 cc_lightingMapUVParam;\nhighp vec4 cc_localShadowBias;\n};\n#endif\n#endif\nvoid CCGetWorldMatrix(out mat4 matWorld)\n{\n#if USE_INSTANCING\nmatWorld = mat4(\nvec4(a_matWorld0.xyz, 0.0),\nvec4(a_matWorld1.xyz, 0.0),\nvec4(a_matWorld2.xyz, 0.0),\nvec4(a_matWorld0.w, a_matWorld1.w, a_matWorld2.w, 1.0)\n);\n#elif USE_BATCHING\nmatWorld = cc_matWorlds[int(a_dyn_batch_id)];\n#else\nmatWorld = cc_matWorld;\n#endif\n}\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nout float v_dist;\nvec4 vert () {\nvec4 position;\nCCVertInput(position);\nmat4 matWorld;\nCCGetWorldMatrix(matWorld);\nvec3 P = (matWorld * position).xyz;\nvec3 L = cc_mainLitDir.xyz;\nvec3 N = cc_planarNDInfo.xyz;\nfloat d = cc_planarNDInfo.w + 0.001;\nfloat dist = (-d - dot(P, N)) / (dot(L, N) + 0.0001);\nvec3 shadowPos = P + L * dist;\nvec3 view = normalize(cc_cameraPos.xyz - shadowPos);\nfloat viewLength = length(cc_cameraPos.xyz - shadowPos);\nshadowPos += view * min(1.0, 0.005 * viewLength);\nposition = cc_matProj * cc_matView * vec4(shadowPos, 1.0);\nv_dist = dist;\nreturn position;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCShadow {\nhighp mat4 cc_matLightPlaneProj;\nhighp mat4 cc_matLightView;\nhighp mat4 cc_matLightViewProj;\nhighp vec4 cc_shadowInvProjDepthInfo;\nhighp vec4 cc_shadowProjDepthInfo;\nhighp vec4 cc_shadowProjInfo;\nmediump vec4 cc_shadowNFLSInfo;\nmediump vec4 cc_shadowWHPBInfo;\nmediump vec4 cc_shadowLPNNInfo;\nlowp vec4 cc_shadowColor;\nmediump vec4 cc_planarNDInfo;\n};\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin float v_dist;\nvec4 frag () {\nif(v_dist < 0.0)\ndiscard;\nreturn CCFragOutput(cc_shadowColor);\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision highp float;\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nhighp float decode32 (highp vec4 rgba) {\nrgba = rgba * 255.0;\nhighp float Sign = 1.0 - (step(128.0, (rgba[3]) + 0.5)) * 2.0;\nhighp float Exponent = 2.0 * (mod(float(int((rgba[3]) + 0.5)), 128.0)) + (step(128.0, (rgba[2]) + 0.5)) - 127.0;\nhighp float Mantissa = (mod(float(int((rgba[2]) + 0.5)), 128.0)) * 65536.0 + rgba[1] * 256.0 + rgba[0] + 8388608.0;\nreturn Sign * exp2(Exponent - 23.0) * Mantissa;\n}\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\nint getVertexId() {\nreturn int(a_vertexId);\n}\n#endif\n#if CC_USE_MORPH\nlayout(std140) uniform CCMorph {\nvec4 cc_displacementWeights[15];\nvec4 cc_displacementTextureInfo;\n};\nvec2 getPixelLocation(vec2 textureResolution, int pixelIndex) {\nfloat pixelIndexF = float(pixelIndex);\nfloat x = mod(pixelIndexF, textureResolution.x);\nfloat y = floor(pixelIndexF / textureResolution.x);\nreturn vec2(x, y);\n}\nvec2 getPixelCoordFromLocation(vec2 location, vec2 textureResolution) {\nreturn (vec2(location.x, location.y) + .5) / textureResolution;\n}\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int pixelIndex) {\nivec2 texSize = textureSize(tex, 0);\nreturn texelFetch(tex, ivec2(pixelIndex % texSize.x, pixelIndex / texSize.x), 0);\n}\n#else\nvec4 fetchVec3ArrayFromTexture(sampler2D tex, int elementIndex) {\nint pixelIndex = elementIndex * 4;\nvec2 location = getPixelLocation(cc_displacementTextureInfo.xy, pixelIndex);\nvec2 x = getPixelCoordFromLocation(location + vec2(0.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 y = getPixelCoordFromLocation(location + vec2(1.0, 0.0), cc_displacementTextureInfo.xy);\nvec2 z = getPixelCoordFromLocation(location + vec2(2.0, 0.0), cc_displacementTextureInfo.xy);\nreturn vec4(\ndecode32(texture(tex, x)),\ndecode32(texture(tex, y)),\ndecode32(texture(tex, z)),\n1.0\n);\n}\n#endif\nfloat getDisplacementWeight(int index) {\nint quot = index / 4;\nint remainder = index - quot * 4;\nif (remainder == 0) {\nreturn cc_displacementWeights[quot].x;\n} else if (remainder == 1) {\nreturn cc_displacementWeights[quot].y;\n} else if (remainder == 2) {\nreturn cc_displacementWeights[quot].z;\n} else {\nreturn cc_displacementWeights[quot].w;\n}\n}\nvec3 getVec3DisplacementFromTexture(sampler2D tex, int vertexIndex) {\n#if CC_MORPH_PRECOMPUTED\nreturn fetchVec3ArrayFromTexture(tex, vertexIndex).rgb;\n#else\nvec3 result = vec3(0, 0, 0);\nint nVertices = int(cc_displacementTextureInfo.z);\nfor (int iTarget = 0; iTarget < CC_MORPH_TARGET_COUNT; ++iTarget) {\nresult += (fetchVec3ArrayFromTexture(tex, nVertices * iTarget + vertexIndex).rgb * getDisplacementWeight(iTarget));\n}\nreturn result;\n#endif\n}\n#if CC_MORPH_TARGET_HAS_POSITION\nuniform sampler2D cc_PositionDisplacements;\nvec3 getPositionDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_PositionDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nuniform sampler2D cc_NormalDisplacements;\nvec3 getNormalDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_NormalDisplacements, vertexId);\n}\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\nuniform sampler2D cc_TangentDisplacements;\nvec3 getTangentDisplacement(int vertexId) {\nreturn getVec3DisplacementFromTexture(cc_TangentDisplacements, vertexId);\n}\n#endif\nvoid applyMorph (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nint vertexId = getVertexId();\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_NORMAL\nnormal.xyz = normal.xyz + getNormalDisplacement(vertexId);\n#endif\n#if CC_MORPH_TARGET_HAS_TANGENT\ntangent.xyz = tangent.xyz + getTangentDisplacement(vertexId);\n#endif\n}\nvoid applyMorph (inout vec4 position) {\n#if CC_MORPH_TARGET_HAS_POSITION\nposition.xyz = position.xyz + getPositionDisplacement(getVertexId());\n#endif\n}\n#endif\n#if CC_USE_SKINNING\n#if CC_USE_BAKED_ANIMATION\nlayout(std140) uniform CCSkinningTexture {\nhighp vec4 cc_jointTextureInfo;\n};\nlayout(std140) uniform CCSkinningAnimation {\nhighp vec4 cc_jointAnimInfo;\n};\nuniform highp sampler2D cc_jointTexture;\nvoid CCGetJointTextureCoords(float pixelsPerJoint, float jointIdx, out highp float x, out highp float y, out highp float invSize)\n{\n#if USE_INSTANCING\nhighp float temp = pixelsPerJoint * (a_jointAnimInfo.x * a_jointAnimInfo.y + jointIdx) + a_jointAnimInfo.z;\n#else\nhighp float temp = pixelsPerJoint * (cc_jointAnimInfo.x * cc_jointTextureInfo.y + jointIdx) + cc_jointTextureInfo.z;\n#endif\ninvSize = cc_jointTextureInfo.w;\nhighp float tempY = floor(temp * invSize);\nx = floor(temp - tempY * cc_jointTextureInfo.x);\ny = (tempY + 0.5) * invSize;\n}\n#else\nlayout(std140) uniform CCSkinning {\nhighp vec4 cc_joints[30 * 3];\n};\n#endif\n#if CC_USE_BAKED_ANIMATION\n#if CC_DEVICE_SUPPORT_FLOAT_TEXTURE\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(3.0, i, x, y, invSize);\nvec4 v1 = texture(cc_jointTexture, vec2((x + 0.5) * invSize, y));\nvec4 v2 = texture(cc_jointTexture, vec2((x + 1.5) * invSize, y));\nvec4 v3 = texture(cc_jointTexture, vec2((x + 2.5) * invSize, y));\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#else\nmat4 getJointMatrix (float i) {\nhighp float x, y, invSize;\nCCGetJointTextureCoords(12.0, i, x, y, invSize);\nvec4 v1 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 0.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 1.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 2.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 3.5) * invSize, y)))\n);\nvec4 v2 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 4.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 5.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 6.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 7.5) * invSize, y)))\n);\nvec4 v3 = vec4(\ndecode32(texture(cc_jointTexture, vec2((x + 8.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 9.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 10.5) * invSize, y))),\ndecode32(texture(cc_jointTexture, vec2((x + 11.5) * invSize, y)))\n);\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\n#else\nmat4 getJointMatrix (float i) {\nint idx = int(i);\nvec4 v1 = cc_joints[idx * 3];\nvec4 v2 = cc_joints[idx * 3 + 1];\nvec4 v3 = cc_joints[idx * 3 + 2];\nreturn mat4(vec4(v1.xyz, 0.0), vec4(v2.xyz, 0.0), vec4(v3.xyz, 0.0), vec4(v1.w, v2.w, v3.w, 1.0));\n}\n#endif\nmat4 skinMatrix () {\nvec4 joints = vec4(a_joints);\nreturn getJointMatrix(joints.x) * a_weights.x\n+ getJointMatrix(joints.y) * a_weights.y\n+ getJointMatrix(joints.z) * a_weights.z\n+ getJointMatrix(joints.w) * a_weights.w;\n}\nvoid CCSkin (inout vec4 position) {\nmat4 m = skinMatrix();\nposition = m * position;\n}\nvoid CCSkin (inout vec4 position, inout vec3 normal, inout vec4 tangent) {\nmat4 m = skinMatrix();\nposition = m * position;\nnormal = (m * vec4(normal, 0.0)).xyz;\ntangent.xyz = (m * vec4(tangent.xyz, 0.0)).xyz;\n}\n#endif\nvoid CCVertInput(inout StandardVertInput In)\n{\nIn.position = vec4(a_position, 1.0);\nIn.normal = a_normal;\nIn.tangent = a_tangent;\n#if CC_USE_MORPH\napplyMorph(In.position, In.normal, In.tangent);\n#endif\n#if CC_USE_SKINNING\nCCSkin(In.position, In.normal, In.tangent);\n#endif\n}\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nout vec2 v_uv;\nvoid main () {\nStandardVertInput In;\nCCVertInput(In);\nIn.position.xy = cc_cameraPos.w == 0.0 ? vec2(In.position.xy.x, -In.position.xy.y) : In.position.xy;\ngl_Position = In.position;\ngl_Position.y = gl_Position.y;\nv_uv = a_texCoord;\n}",frag:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#if ANTIALIAS_TYPE == 1\nvec4 fxaa(sampler2D tex, vec2 fragCoord, vec2 resolution,\nvec2 v_rgbNW, vec2 v_rgbNE,\nvec2 v_rgbSW, vec2 v_rgbSE,\nvec2 v_rgbM) {\nvec4 color;\nmediump vec2 inverseVP = vec2(1.0 / resolution.x, 1.0 / resolution.y);\nvec3 rgbNW = texture(tex, v_rgbNW).xyz;\nvec3 rgbNE = texture(tex, v_rgbNE).xyz;\nvec3 rgbSW = texture(tex, v_rgbSW).xyz;\nvec3 rgbSE = texture(tex, v_rgbSE).xyz;\nvec4 texColor = texture(tex, v_rgbM);\nvec3 rgbM  = texColor.xyz;\nvec3 luma = vec3(0.299, 0.587, 0.114);\nfloat lumaNW = dot(rgbNW, luma);\nfloat lumaNE = dot(rgbNE, luma);\nfloat lumaSW = dot(rgbSW, luma);\nfloat lumaSE = dot(rgbSE, luma);\nfloat lumaM  = dot(rgbM,  luma);\nfloat lumaMin = min(lumaM, min(min(lumaNW, lumaNE), min(lumaSW, lumaSE)));\nfloat lumaMax = max(lumaM, max(max(lumaNW, lumaNE), max(lumaSW, lumaSE)));\nmediump vec2 dir;\ndir.x = -((lumaNW + lumaNE) - (lumaSW + lumaSE));\ndir.y =  ((lumaNW + lumaSW) - (lumaNE + lumaSE));\nfloat dirReduce = max((lumaNW + lumaNE + lumaSW + lumaSE) *\n(0.25 * (1.0 / 8.0)), (1.0/ 128.0));\nfloat rcpDirMin = 1.0 / (min(abs(dir.x), abs(dir.y)) + dirReduce);\ndir = min(vec2(8.0, 8.0),\nmax(vec2(-8.0, -8.0),\ndir * rcpDirMin)) * inverseVP;\nvec3 rgbA = 0.5 * (\ntexture(tex, fragCoord * inverseVP + dir * (1.0 / 3.0 - 0.5)).xyz +\ntexture(tex, fragCoord * inverseVP + dir * (2.0 / 3.0 - 0.5)).xyz);\nvec3 rgbB = rgbA * 0.5 + 0.25 * (\ntexture(tex, fragCoord * inverseVP + dir * -0.5).xyz +\ntexture(tex, fragCoord * inverseVP + dir * 0.5).xyz);\nfloat lumaB = dot(rgbB, luma);\nif ((lumaB < lumaMin) || (lumaB > lumaMax))\ncolor = vec4(rgbA, texColor.a);\nelse\ncolor = vec4(rgbB, texColor.a);\nreturn color;\n}\n#endif\nin vec2 v_uv;\nuniform sampler2D outputResultMap;\nlayout(location = 0) out vec4 fragColor;\nvoid texcoords(vec2 fragCoord, vec2 resolution,\nout vec2 v_rgbNW, out vec2 v_rgbNE,\nout vec2 v_rgbSW, out vec2 v_rgbSE,\nout vec2 v_rgbM) {\nvec2 inverseVP = 1.0 / resolution.xy;\nv_rgbNW = (fragCoord + vec2(-1.0, -1.0)) * inverseVP;\nv_rgbNE = (fragCoord + vec2(1.0, -1.0)) * inverseVP;\nv_rgbSW = (fragCoord + vec2(-1.0, 1.0)) * inverseVP;\nv_rgbSE = (fragCoord + vec2(1.0, 1.0)) * inverseVP;\nv_rgbM = vec2(fragCoord * inverseVP);\n}\nvoid main () {\nmediump vec2 v_rgbNW;\nmediump vec2 v_rgbNE;\nmediump vec2 v_rgbSW;\nmediump vec2 v_rgbSE;\nmediump vec2 v_rgbM;\n#if ANTIALIAS_TYPE == 1\nvec2 resolution = cc_screenSize.xy;\nvec2 fragCoord = v_uv * resolution;\ntexcoords(fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\nfragColor = fxaa(outputResultMap, fragCoord, resolution, v_rgbNW, v_rgbNE, v_rgbSW, v_rgbSE, v_rgbM);\n#else\nfragColor = texture(outputResultMap, v_uv);\n#endif\n}"}],[{vert:"\nprecision highp float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\n#define QUATER_PI         0.78539816340\n#define HALF_PI           1.57079632679\n#define PI                3.14159265359\n#define PI2               6.28318530718\n#define PI4               12.5663706144\n#define INV_QUATER_PI     1.27323954474\n#define INV_HALF_PI       0.63661977237\n#define INV_PI            0.31830988618\n#define INV_PI2           0.15915494309\n#define INV_PI4           0.07957747155\n#define EPSILON           1e-6\n#define EPSILON_LOWP      1e-4\n#define LOG2              1.442695\n#define EXP_VALUE         2.71828183f\n#define FP_MAX            65504.0\n#define FP_SCALE          0.0009765625\n#define FP_SCALE_INV      1024.0\n#define GRAY_VECTOR       vec3(0.299, 0.587, 0.114)\nstruct StandardVertInput {\nhighp vec4 position;\nvec3 normal;\nvec4 tangent;\n};\nin vec3 a_position;\nin vec3 a_normal;\nin vec2 a_texCoord;\nin vec4 a_tangent;\n#if CC_USE_SKINNING\nin vec4 a_joints;\nin vec4 a_weights;\n#endif\n#if USE_INSTANCING\n#if CC_USE_BAKED_ANIMATION\nin highp vec4 a_jointAnimInfo;\n#endif\nin vec4 a_matWorld0;\nin vec4 a_matWorld1;\nin vec4 a_matWorld2;\n#if CC_USE_LIGHTMAP\nin vec4 a_lightingMapUVParam;\n#endif\n#if CC_RECEIVE_SHADOW\nin vec2 a_localShadowBias;\n#endif\n#elif USE_BATCHING\nin float a_dyn_batch_id;\n#endif\n#if CC_USE_MORPH\nin float a_vertexId;\n#endif\nout mediump vec4 viewDir;\nvec4 vert () {\nviewDir = vec4(a_position, 1.0);\nmat4 matViewRotOnly = mat4(mat3(cc_matView));\nvec4 pos = matViewRotOnly * viewDir;\nif (cc_matProj[3].w > 0.0) {\nmat4 matProj = cc_matProj;\nmatProj[0].x = 5.2;\nmatProj[1].y = 2.6;\nmatProj[2].zw = vec2(-1.0);\nmatProj[3].zw = vec2(0.0);\npos = matProj * pos;\n} else {\npos = cc_matProj * pos;\n}\npos.z = 0.99999 * pos.w;\nreturn pos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nuniform samplerCube cc_environment;\nvec3 unpackRGBE (vec4 rgbe) {\nreturn rgbe.rgb * pow(1.1, rgbe.a * 255.0 - 128.0);\n}\nvec3 SRGBToLinear (vec3 gamma) {\nreturn gamma * gamma;\n}\nvec3 ACESToneMap (vec3 color) {\ncolor = min(color, vec3(8.0));\nconst float A = 2.51;\nconst float B = 0.03;\nconst float C = 2.43;\nconst float D = 0.59;\nconst float E = 0.14;\nreturn (color * (A * color + B)) / (color * (C * color + D) + E);\n}\nvec4 CCFragOutput (vec4 color) {\n#if CC_USE_HDR\ncolor.rgb = ACESToneMap(color.rgb);\n#endif\ncolor.rgb = sqrt(color.rgb);\nreturn color;\n}\nin mediump vec4 viewDir;\nvec4 frag () {\n#if USE_RGBE_CUBEMAP\nvec3 c = unpackRGBE(texture(cc_environment, viewDir.xyz));\n#else\nvec3 c = SRGBToLinear(texture(cc_environment, viewDir.xyz).rgb);\n#endif\nreturn CCFragOutput(vec4(c * cc_ambientSky.w, 1.0));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nin vec3 a_position;\nin vec4 a_color;\nout vec2 v_uv;\nlayout(std140) uniform Constants {\nvec4 offset;\n};\nlayout(std140) uniform PerFrameInfo {\nvec4 digits[8 * 10 / 4];\n};\nfloat getComponent(vec4 v, float i) {\nif (i < 1.0) { return v.x; }\nelse if (i < 2.0) { return v.y; }\nelse if (i < 3.0) { return v.z; }\nelse { return v.w; }\n}\nvec4 vert () {\nmat2 proj = mat2(cc_matProj[0].xy, cc_matProj[1].xy);\nproj /= abs(proj[1].x + proj[1].y);\nvec2 position = proj * a_position.xy + offset.xy;\nv_uv = a_color.xy;\nif (a_color.z >= 0.0) {\nfloat n = getComponent(digits[int(a_color.z)], a_color.w);\nv_uv += vec2(offset.z * n, 0.0);\n}\nreturn vec4(position, 0.0, 1.0);\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nlayout(std140) uniform CCGlobal {\nhighp   vec4 cc_time;\nmediump vec4 cc_screenSize;\nmediump vec4 cc_nativeSize;\n};\nlayout(std140) uniform CCCamera {\nhighp   mat4 cc_matView;\nhighp   mat4 cc_matViewInv;\nhighp   mat4 cc_matProj;\nhighp   mat4 cc_matProjInv;\nhighp   mat4 cc_matViewProj;\nhighp   mat4 cc_matViewProjInv;\nhighp   vec4 cc_cameraPos;\nmediump vec4 cc_screenScale;\nmediump vec4 cc_exposure;\nmediump vec4 cc_mainLitDir;\nmediump vec4 cc_mainLitColor;\nmediump vec4 cc_ambientSky;\nmediump vec4 cc_ambientGround;\nmediump vec4 cc_fogColor;\nmediump vec4 cc_fogBase;\nmediump vec4 cc_fogAdd;\nmediump vec4 cc_nearFar;\nmediump vec4 cc_viewPort;\n};\nvec4 CCFragOutput (vec4 color) {\nreturn color;\n}\nin vec2 v_uv;\nuniform sampler2D mainTexture;\nvec4 frag () {\nreturn CCFragOutput(texture(mainTexture, v_uv));\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}],[{vert:"\nprecision mediump float;\nin vec2 a_position;\nin vec2 a_texCoord;\nout vec2 v_uv;\nlayout(std140) uniform Constant {\nvec4 u_buffer0;\nvec4 u_buffer1;\nmat4 u_projection;\n};\nvec4 vert () {\nvec2 worldPos = a_position * u_buffer1.xy + u_buffer1.zw;\nvec2 clipSpace = worldPos / u_buffer0.xy * 2.0 - 1.0;\nvec4 screenPos = u_projection * vec4(clipSpace, 0.0, 1.0);\nv_uv = a_texCoord;\nreturn screenPos;\n}\nvoid main() { gl_Position = vert(); }",frag:"\nprecision mediump float;\nin vec2 v_uv;\nlayout(std140) uniform Factor {\nfloat u_percent;\n};\nuniform sampler2D mainTexture;\nvec4 frag () {\nvec4 color = texture(mainTexture, v_uv);\nfloat percent = clamp(u_percent, 0.0, 1.0);\ncolor.xyz *= percent;\nreturn color;\n}\nlayout(location = 0) out vec4 cc_FragColor;\nvoid main() { cc_FragColor = frag(); }"}]]},kv=function(){function t(){this._device=null,this._resources={}}var e=t.prototype;return e.initBuiltinRes=function(t){var e=this;this._device=t;for(var n=this._resources,i=new Uint8Array(16),r=new Uint8Array(16),a=new Uint8Array(16),o=new Uint8Array(16),s=new Uint8Array(16),c=0,l=0;l<4;l++)i[c]=0,i[c+1]=0,i[c+2]=0,i[c+3]=255,r[c]=0,r[c+1]=0,r[c+2]=0,r[c+3]=0,a[c]=119,a[c+1]=119,a[c+2]=119,a[c+3]=255,o[c]=255,o[c+1]=255,o[c+2]=255,o[c+3]=255,s[c]=127,s[c+1]=127,s[c+2]=255,s[c+3]=255,c+=4;var u=new Uint8Array(1024);c=0;for(var _=0;_<256;_++)u[c]=221,u[c+1]=221,u[c+2]=221,u[c+3]=255,c+=4;c=0;for(var f=0;f<8;f++){for(var d=0;d<8;d++)u[c]=85,u[c+1]=85,u[c+2]=85,u[c+3]=255,c+=4;c+=32}c+=32;for(var p=0;p<8;p++){for(var m=0;m<8;m++)u[c]=85,u[c+1]=85,u[c+2]=85,u[c+3]=255,c+=4;c+=32}var v={width:2,height:2,_data:i,_compressed:!1,format:Mv.PixelFormat.RGBA8888},g={width:2,height:2,_data:r,_compressed:!1,format:Mv.PixelFormat.RGBA8888},y={width:2,height:2,_data:a,_compressed:!1,format:Mv.PixelFormat.RGBA8888},x={width:2,height:2,_data:o,_compressed:!1,format:Mv.PixelFormat.RGBA8888},S={width:2,height:2,_data:s,_compressed:!1,format:Mv.PixelFormat.RGBA8888},A={width:16,height:16,_data:u,_compressed:!1,format:Mv.PixelFormat.RGBA8888},b=new lv(v),C=new Mv;C._uuid="black-texture",C.image=b,n[C._uuid]=C;var T=new lv(g),E=new Mv;E._uuid="empty-texture",E.image=T,n[E._uuid]=E;var w=new Ov;w._uuid="black-cube-texture",w.setMipFilter(Ov.Filter.NEAREST),w.image={front:new lv(v),back:new lv(v),left:new lv(v),right:new lv(v),top:new lv(v),bottom:new lv(v)},n[w._uuid]=w;var I=new lv(y),P=new Mv;P._uuid="grey-texture",P.image=I,n[P._uuid]=P;var D=new lv(x),R=new Mv;R._uuid="white-texture",R.image=D,n[R._uuid]=R;var M=new Ov;M._uuid="white-cube-texture",M.setMipFilter(Ov.Filter.NEAREST),M.image={front:new lv(x),back:new lv(x),left:new lv(x),right:new lv(x),top:new lv(x),bottom:new lv(x)},n[M._uuid]=M;var O=new lv(S),N=new Mv;N._uuid="normal-texture",N.image=O,n[N._uuid]=N;var B=new lv(A),L=new Mv;L._uuid="default-texture",L.image=B,n[L._uuid]=L;var F=new Ov;if(F.setMipFilter(Ov.Filter.NEAREST),F._uuid="default-cube-texture",F.image={front:new lv(A),back:new lv(A),left:new lv(A),right:new lv(A),top:new lv(A),bottom:new lv(A)},n[F._uuid]=F,h.SpriteFrame){var V=new h.SpriteFrame,z=b,k=new Mv;k.image=z,V.texture=k,V._uuid="default-spriteframe",n[V._uuid]=V}var U=Pm(t);if(!U)return Promise.reject(Error("Failed to initialize builtin shaders: unknown device."));var G=zv[U];return G?Promise.resolve().then((function(){Vv.forEach((function(t,e){var n=Object.assign(new h.EffectAsset,t);n.shaders.forEach((function(t,n){var i=G[e][n];i&&(t[U]=i)})),n.hideInEditor=!0,n.onLoaded()})),e._initMaterials()})):Promise.reject(Error("Current device is requiring builtin shaders of version "+U+" but shaders of that version are not assembled in this build."))},e.get=function(t){return this._resources[t]},e._initMaterials=function(){var t=this._resources,e=[],n=new h.Material;n._uuid="standard-material",n.initialize({effectName:"standard"}),t[n._uuid]=n,e.push(n);var i=new h.Material;i._uuid="missing-effect-material",i.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),i.setProperty("mainColor",h.color("#ffff00")),t[i._uuid]=i,e.push(i);var r=new h.Material;r._uuid="missing-material",r.initialize({effectName:"unlit",defines:{USE_COLOR:!0}}),r.setProperty("mainColor",h.color("#ff00ff")),t[r._uuid]=r,e.push(r);var a=new h.Material;a._uuid="default-clear-stencil",a.initialize({defines:{USE_TEXTURE:!1},effectName:"clear-stencil"}),t[a._uuid]=a,e.push(a);var o=new h.Material;o._uuid="ui-base-material",o.initialize({defines:{USE_TEXTURE:!1},effectName:"sprite"}),t[o._uuid]=o,e.push(o);var s=new h.Material;s._uuid="ui-sprite-material",s.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),t[s._uuid]=s,e.push(s);var c=new h.Material;c._uuid="ui-alpha-test-material",c.initialize({defines:{USE_TEXTURE:!0,USE_ALPHA_TEST:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"sprite"}),t[c._uuid]=c,e.push(c);var l=new h.Material;l._uuid="ui-sprite-gray-material",l.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!0},effectName:"sprite"}),t[l._uuid]=l,e.push(l);var u=new h.Material;u._uuid="ui-sprite-alpha-sep-material",u.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!1},effectName:"sprite"}),t[u._uuid]=u,e.push(u);var _=new h.Material;_._uuid="ui-sprite-gray-alpha-sep-material",_.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!0,IS_GRAY:!0},effectName:"sprite"}),t[_._uuid]=_,e.push(_);var f=new h.Material;f._uuid="ui-graphics-material",f.initialize({effectName:"graphics"}),t[f._uuid]=f,e.push(f);var d=new h.Material;d._uuid="default-particle-material",d.initialize({effectName:"particle"}),t[d._uuid]=d,e.push(d);var p=new h.Material;p._uuid="default-particle-gpu-material",p.initialize({effectName:"particle-gpu"}),t[p._uuid]=p,e.push(p);var m=new h.Material;m._uuid="default-trail-material",m.initialize({effectName:"particle-trail"}),t[m._uuid]=m,e.push(m);var v=new h.Material;v._uuid="default-billboard-material",v.initialize({effectName:"billboard"}),t[v._uuid]=v,e.push(v);var g=new h.Material;g._uuid="default-spine-material",g.initialize({defines:{USE_TEXTURE:!0,CC_USE_EMBEDDED_ALPHA:!1,IS_GRAY:!1},effectName:"spine"}),t[g._uuid]=g,e.push(g),h.game.on(h.Game.EVENT_GAME_INITED,(function(){for(var t=0;t<e.length;++t)for(var n=e[t],i=0;i<n.passes.length;++i)n.passes[i].tryCompile()}))},t}(),Uv=t("builtinResMgr",h.builtinResMgr=new kv),Gv=t("getPhaseID",(Bv=new Map,Lv=0,function(t){return"number"==typeof t?t:(Bv.has(t)||(Bv.set(t,1<<Lv),Lv++),Bv.get(t))})),Hv=t("InstancedBuffer",function(){function t(t){this.instances=[],this.pass=void 0,this.hasPendingModels=!1,this.dynamicOffsets=[],this._device=void 0,this._device=t.device,this.pass=t}var e=t.prototype;return e.destroy=function(){for(var t=0;t<this.instances.length;++t){var e=this.instances[t];e.vb.destroy(),e.ia.destroy()}this.instances.length=0},e.merge=function(t,e,n,i){void 0===i&&(i=null);var r=e.buffer.length;if(r){var a=t.inputAssembler,o=t.descriptorSet.getTexture(Wp),s=i;s||(s=t.shaders[n]);for(var c=t.descriptorSet,l=0;l<this.instances.length;++l){var h=this.instances[l];if(!(h.ia.indexBuffer!==a.indexBuffer||h.count>=1024)&&h.lightingMap===o&&h.stride===r){if(h.count>=h.capacity){h.capacity<<=1;var u=h.stride*h.capacity,_=h.data;h.data=new Uint8Array(u),h.data.set(_),h.vb.resize(u)}return h.shader!==s&&(h.shader=s),h.descriptorSet!==c&&(h.descriptorSet=c),h.data.set(e.buffer,h.stride*h.count++),void(this.hasPendingModels=!0)}}for(var f=this._device.createBuffer(new gr(yi.VERTEX|yi.TRANSFER_DST,Ai.HOST|Ai.DEVICE,32*r,r)),d=new Uint8Array(32*r),p=a.vertexBuffers.slice(),m=a.attributes.slice(),v=a.indexBuffer,g=0;g<e.attributes.length;g++){var y=e.attributes[g],x=new Br(y.name,y.format,y.isNormalized,p.length,!0);m.push(x)}d.set(e.buffer),p.push(f);var S=new Fr(m,p,v),A=this._device.createInputAssembler(S);this.instances.push({count:1,capacity:32,vb:f,data:d,ia:A,stride:r,shader:s,descriptorSet:c,lightingMap:o}),this.hasPendingModels=!0}},e.uploadBuffers=function(t){for(var e=0;e<this.instances.length;++e){var n=this.instances[e];n.count&&(n.ia.instanceCount=n.count,t.updateBuffer(n.vb,n.data))}},e.clear=function(){for(var t=0;t<this.instances.length;++t)this.instances[t].count=0;this.hasPendingModels=!1},t}()),jv=function(){function t(t){this.batches=[],this.dynamicOffsets=[],this._device=void 0,this._device=t.device}var e=t.prototype;return e.destroy=function(){for(var t=0;t<this.batches.length;++t){for(var e=this.batches[t],n=0;n<e.vbs.length;++n)e.vbs[n].destroy();e.vbIdx.destroy(),e.ia.destroy(),e.ubo.destroy()}this.batches.length=0},e.merge=function(t,e,n){var i=t.subMesh.flatBuffers;if(0!==i.length){for(var r=0,a=0,o=i[0].count,s=t.passes[e],c=t.shaders[e],l=t.descriptorSet,h=!1,u=0;u<this.batches.length;++u){var _=this.batches[u];if(_.vbs.length===i.length&&_.mergeCount<Cp.BATCHING_COUNT){h=!0;for(var f=0;f<_.vbs.length;++f)if(_.vbs[f].stride!==i[f].stride){h=!1;break}if(h){for(var d=0;d<_.vbs.length;++d){var p=i[d],m=_.vbs[d],v=_.vbDatas[d];(r=(o+_.vbCount)*p.stride)>m.size&&(m.resize(r),_.vbDatas[d]=new Uint8Array(r),_.vbDatas[d].set(v)),_.vbDatas[d].set(p.buffer,_.vbCount*p.stride)}var g=_.vbIdxData;(a=4*(o+_.vbCount))>_.vbIdx.size&&(_.vbIdx.resize(a),_.vbIdxData=new Float32Array(a/Float32Array.BYTES_PER_ELEMENT),_.vbIdxData.set(g),g=_.vbIdxData);var y=_.vbCount,x=y+o,S=_.mergeCount;if(g[y]!==S||g[x-1]!==S)for(var A=y;A<x;A++)g[A]=S+.1;return Xn.toArray(_.uboData,n.transform.worldMatrix,Cp.MAT_WORLDS_OFFSET+16*_.mergeCount),_.mergeCount||(l.bindBuffer(Cp.BINDING,_.ubo),l.update(),_.pass=s,_.shader=c,_.descriptorSet=l),++_.mergeCount,_.vbCount+=o,void(_.ia.vertexCount+=o)}}}for(var b=[],C=[],T=[],E=0;E<i.length;++E){var w=i[E],I=this._device.createBuffer(new gr(yi.VERTEX|yi.TRANSFER_DST,Ai.HOST|Ai.DEVICE,w.count*w.stride,w.stride));I.update(w.buffer.buffer),b.push(I),C.push(new Uint8Array(I.size)),T.push(I)}var P=this._device.createBuffer(new gr(yi.VERTEX|yi.TRANSFER_DST,Ai.HOST|Ai.DEVICE,4*o,4)),D=new Float32Array(o);D.fill(0),P.update(D),T.push(P);for(var R=t.inputAssembler.attributes,M=new Array(R.length+1),O=0;O<R.length;++O)M[O]=R[O];M[R.length]=new Br("a_dyn_batch_id",mi.R32F,!1,i.length);var N=new Fr(M,T),B=this._device.createInputAssembler(N),L=this._device.createBuffer(new gr(yi.UNIFORM|yi.TRANSFER_DST,Ai.HOST|Ai.DEVICE,Cp.SIZE,Cp.SIZE));l.bindBuffer(Cp.BINDING,L),l.update();var F=new Float32Array(Cp.COUNT);Xn.toArray(F,n.transform.worldMatrix,Cp.MAT_WORLDS_OFFSET),this.batches.push({mergeCount:1,vbs:b,vbDatas:C,vbIdx:P,vbIdxData:D,vbCount:o,ia:B,ubo:L,uboData:F,pass:s,shader:c,descriptorSet:l})}},e.clear=function(){for(var t=0;t<this.batches.length;++t){var e=this.batches[t];e.vbCount=0,e.mergeCount=0,e.ia.vertexCount=0}},t}(),Wv=new gr(yi.UNIFORM|yi.TRANSFER_DST,Ai.DEVICE),qv=new yr(null),Xv=new Yr(null);!function(t){t[t.NONE=0]="NONE",t[t.INSTANCING=1]="INSTANCING",t[t.VB_MERGING=2]="VB_MERGING"}(Fv||(Fv={}));var Yv=function(){function t(t){this._rootBuffer=null,this._buffers=[],this._descriptorSet=null,this._pipelineLayout=null,this._passIndex=0,this._propertyIndex=0,this._programName="",this._dynamics={},this._propertyHandleMap={},this._rootBlock=null,this._blocksInt=[],this._blocks=[],this._shaderInfo=null,this._defines={},this._properties={},this._shader=null,this._bs=new Ra,this._dss=new Pa,this._rs=new Ia,this._priority=Wd.DEFAULT,this._stage=jd.DEFAULT,this._phase=Gv("default"),this._primitive=Gi.TRIANGLE_LIST,this._batchingScheme=Fv.NONE,this._dynamicStates=qi.NONE,this._instancedBuffers={},this._batchedBuffers={},this._hash=0,this._root=void 0,this._device=void 0,this._passHandle=0,this._rootBufferDirty=!1,this._root=t,this._device=t.device}t.fillPipelineInfo=function(t,e){void 0!==e.priority&&t._setPriority(e.priority),void 0!==e.primitive&&t._setPrimitive(e.primitive),void 0!==e.stage&&t._setStage(e.stage),void 0!==e.dynamicStates&&t._setDynamicState(e.dynamicStates),void 0!==e.phase&&t._setPhase(Gv(e.phase));var n=t._bs;if(e.blendState){var i=e.blendState,r=i.targets;r&&r.forEach((function(t,e){n.setTarget(e,t)})),void 0!==i.isA2C&&(n.isA2C=i.isA2C),void 0!==i.isIndepend&&(n.isIndepend=i.isIndepend),void 0!==i.blendColor&&(n.blendColor=i.blendColor)}t._rs.assign(e.rasterizerState),t._dss.assign(e.depthStencilState)},t.getPassHash=function(t){var e,n=Vm.getKey(t.program,t.defines)+","+t._primitive+","+t._dynamicStates;return n+=function(t){for(var e,n=",bs,"+t.isA2C,i=st(t.targets);!(e=i()).done;){var r=e.value;n+=",bt,"+r.blend+","+r.blendEq+","+r.blendAlphaEq+","+r.blendColorMask,n+=","+r.blendSrc+","+r.blendDst+","+r.blendSrcAlpha+","+r.blendDstAlpha}return n}(t._bs),n+=function(t){var e=",dss,"+t.depthTest+","+t.depthWrite+","+t.depthFunc;return e+=","+t.stencilTestFront+","+t.stencilFuncFront+","+t.stencilRefFront+","+t.stencilReadMaskFront,e+=","+t.stencilFailOpFront+","+t.stencilZFailOpFront+","+t.stencilPassOpFront+","+t.stencilWriteMaskFront,(e+=","+t.stencilTestBack+","+t.stencilFuncBack+","+t.stencilRefBack+","+t.stencilReadMaskBack)+","+t.stencilFailOpBack+","+t.stencilZFailOpBack+","+t.stencilPassOpBack+","+t.stencilWriteMaskBack}(t._dss),ba(n+=",rs,"+(e=t._rs).cullMode+","+e.depthBias+","+e.isFrontFaceCCW,666)};var e=t.prototype;return e.initialize=function(t){this._doInit(t),this.resetUBOs(),this.resetTextures(),this.tryCompile()},e.getHandle=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=gi.UNKNOWN);var i=this._propertyHandleMap[t];return i?(n?i=vm(i,n):e&&(i=vm(i,fm(i)-e)),i+e):0},e.getBinding=function(e){var n=this.getHandle(e);return n?t.getBindingFromHandle(n):-1},e.setUniform=function(e,n){var i=t.getBindingFromHandle(e),r=t.getTypeFromHandle(e),a=t.getOffsetFromHandle(e),o=this._getBlockView(r,i);ym[r](o,n,a),this._setRootBufferDirty(!0)},e.getUniform=function(e,n){var i=t.getBindingFromHandle(e),r=t.getTypeFromHandle(e),a=t.getOffsetFromHandle(e),o=this._getBlockView(r,i);return gm[r](o,n,a)},e.setUniformArray=function(e,n){for(var i=t.getBindingFromHandle(e),r=t.getTypeFromHandle(e),a=fa(r)>>2,o=this._getBlockView(r,i),s=t.getOffsetFromHandle(e),c=0;c<n.length;c++,s+=a)null!==n[c]&&ym[r](o,n[c],s);this._setRootBufferDirty(!0)},e.bindTexture=function(t,e,n){this._descriptorSet.bindTexture(t,e,n||0)},e.bindSampler=function(t,e,n){this._descriptorSet.bindSampler(t,e,n||0)},e.setDynamicState=function(t,e){var n=this._dynamics[t];n&&n.value===e||(n.value=e,n.dirty=!0)},e.overridePipelineStates=function(){console.warn("base pass cannot override states, please use pass instance instead.")},e._setRootBufferDirty=function(t){this._rootBufferDirty=t},e.update=function(){this._descriptorSet?(this._rootBuffer&&this._rootBufferDirty&&(this._rootBuffer.update(this._rootBlock),this._setRootBufferDirty(!1)),this._descriptorSet.update()):O(12006)},e.getInstancedBuffer=function(t){return void 0===t&&(t=0),this._instancedBuffers[t]||(this._instancedBuffers[t]=new Hv(this))},e.getBatchedBuffer=function(t){return void 0===t&&(t=0),this._batchedBuffers[t]||(this._batchedBuffers[t]=new jv(this))},e._initNative=function(){},e._destroy=function(){},e.destroy=function(){for(var t=0;t<this._shaderInfo.blocks.length;t++){var e=this._shaderInfo.blocks[t];this._buffers[e.binding].destroy()}for(var n in this._buffers=[],this._rootBuffer&&(this._rootBuffer.destroy(),this._rootBuffer=null),this._instancedBuffers)this._instancedBuffers[n].destroy();for(var i in this._batchedBuffers)this._batchedBuffers[i].destroy();this._descriptorSet.destroy(),this._rs.destroy(),this._dss.destroy(),this._bs.destroy(),this._destroy()},e.resetUniform=function(e){var n=this.getHandle(e);if(n){for(var i=t.getTypeFromHandle(n),r=t.getBindingFromHandle(n),a=t.getOffsetFromHandle(n),o=t.getCountFromHandle(n),s=this._getBlockView(i,r),c=this._properties[e],l=c&&c.value||Sm(i),h=(fa(i)>>2)*o,u=0;u+l.length<=h;u+=l.length)s.set(l,a+u);this._setRootBufferDirty(!0)}},e.resetTexture=function(e,n){var i=this.getHandle(e);if(i){var r=t.getTypeFromHandle(i),a=t.getBindingFromHandle(i),o=this._properties[e],s=o&&o.value,c=s?s+"-texture":Sm(r),l=Uv.get(c),h=l&&l.getGFXTexture(),u=o&&void 0!==o.samplerHash?La.unpackFromHash(o.samplerHash):l&&l.getSamplerInfo(),_=this._device.getSampler(u);this._descriptorSet.bindSampler(a,_,n),this._descriptorSet.bindTexture(a,h,n)}},e.resetUBOs=function(){for(var t=0;t<this._shaderInfo.blocks.length;t++)for(var e=this._shaderInfo.blocks[t],n=0,i=0;i<e.members.length;i++){for(var r=e.members[i],a=this._getBlockView(r.type,e.binding),o=this._properties[r.name],s=o&&o.value||Sm(r.type),c=(fa(r.type)>>2)*r.count,l=0;l+s.length<=c;l+=s.length)a.set(s,n+l);n+=c}this._setRootBufferDirty(!0)},e.resetTextures=function(){for(var t=0;t<this._shaderInfo.samplerTextures.length;t++)for(var e=this._shaderInfo.samplerTextures[t],n=0;n<e.count;n++)this.resetTexture(e.name,n)},e.tryCompile=function(){var e=this._root.pipeline;if(!e)return!1;this._syncBatchingScheme();var n=Vm.getGFXShader(this._device,this._programName,this._defines,e);return n?(this._shader=n,this._setPipelineLayout(Vm.getTemplateInfo(this._programName).pipelineLayout),this._setHash(t.getPassHash(this)),!0):(console.warn("create shader "+this._programName+" failed"),!1)},e.getShaderVariant=function(t){if(void 0===t&&(t=null),!this._shader&&!this.tryCompile())return console.warn("pass resources incomplete"),null;if(!t)return this._shader;for(var e=this._root.pipeline,n=0;n<t.length;n++){var i=t[n];this._defines[i.name]=i.value}for(var r=Vm.getGFXShader(this._device,this._programName,this._defines,e),a=0;a<t.length;a++){var o=t[a];delete this._defines[o.name]}return r},e.beginChangeStatesSilently=function(){},e.endChangeStatesSilently=function(){},e._setPriority=function(t){this._priority=t},e._setStage=function(t){this._stage=t},e._setPhase=function(t){this._phase=t},e._setPrimitive=function(t){this._primitive=t},e._setState=function(t,e,n,i){this._bs=t,this._dss=e,this._rs=n,this._descriptorSet=i},e._doInit=function(e,n){void 0===n&&(n=!1),this._initNative(),this._setPriority(Wd.DEFAULT),this._setStage(jd.DEFAULT),this._setPhase(Gv("default")),this._setPrimitive(Gi.TRIANGLE_LIST),this._passIndex=e.passIndex,this._propertyIndex=void 0!==e.propertyIndex?e.propertyIndex:e.passIndex,this._programName=e.program,this._defines=n?Z({},e.defines):e.defines,this._shaderInfo=Vm.getTemplate(e.program),this._properties=e.properties||this._properties;var i=this._device;t.fillPipelineInfo(this,e),e.stateOverrides&&t.fillPipelineInfo(this,e.stateOverrides),Xv.layout=Vm.getDescriptorSetLayout(this._device,e.program),this._descriptorSet=this._device.createDescriptorSet(Xv),this._setState(this._bs,this._dss,this._rs,this._descriptorSet);for(var r=this._shaderInfo.blocks,a=Vm.getTemplateInfo(e.program),o=a.blockSizes,s=a.handleMap,c=i.capabilities.uboOffsetAlignment,l=[],h=0,u=0,_=0;_<r.length;_++){var f=o[_];l.push(u),u+=Math.ceil(f/c)*c,h=f}var d=l[l.length-1]+h;d&&(Wv.size=16*Math.ceil(d/16),this._rootBuffer=i.createBuffer(Wv),this._rootBlock=new ArrayBuffer(d));for(var p=0,m=0;p<r.length;p++){var v=r[p].binding,g=o[p];qv.buffer=this._rootBuffer,qv.offset=l[m++],qv.range=16*Math.ceil(g/16);var y=this._buffers[v]=i.createBuffer(qv);this._blocks[v]=new Float32Array(this._rootBlock,qv.offset,g/Float32Array.BYTES_PER_ELEMENT),this._blocksInt[v]=new Int32Array(this._blocks[v].buffer,this._blocks[v].byteOffset,this._blocks[v].length),this._descriptorSet.bindBuffer(v,y)}var x=this._propertyHandleMap=s,S={};for(var A in this._properties){var b=this._properties[A];b.handleInfo&&(S[A]=this.getHandle.apply(this,b.handleInfo))}Object.assign(x,S)},e._syncBatchingScheme=function(){this._defines.USE_INSTANCING?this._device.hasFeature(pi.INSTANCED_ARRAYS)?this._setBatchingScheme(Fv.INSTANCING):(this._defines.USE_INSTANCING=!1,this._setBatchingScheme(Fv.NONE)):this._defines.USE_BATCHING?this._setBatchingScheme(Fv.VB_MERGING):this._setBatchingScheme(Fv.NONE)},e._setBatchingScheme=function(t){this._batchingScheme=t},e._setDynamicState=function(t){this._dynamicStates=t},e._setHash=function(t){this._hash=t},e._getBlockView=function(t,e){return t<gi.FLOAT?this._blocksInt[e]:this._blocks[e]},e._setPipelineLayout=function(t){this._pipelineLayout=t},e._initPassFromTarget=function(t,e,n,i){this._initNative(),this._setPriority(t.priority),this._setStage(t.stage),this._setPhase(t.phase),this._setBatchingScheme(t.batchingScheme),this._setPrimitive(t.primitive),this._setDynamicState(t.dynamicStates),this._setState(n,e,t.rasterizerState,t.descriptorSet),this._passIndex=t.passIndex,this._propertyIndex=t.propertyIndex,this._programName=t.program,this._defines=t.defines,this._shaderInfo=t._shaderInfo,this._properties=t._properties,this._blocks=t._blocks,this._blocksInt=t._blocksInt,this._dynamics=t._dynamics,this._shader=t._shader,this._setPipelineLayout(Vm.getTemplateInfo(this._programName).pipelineLayout),this._setHash(t._hash^i)},Q(t,[{key:"native",get:function(){return this._nativeObj}},{key:"root",get:function(){return this._root}},{key:"device",get:function(){return this._device}},{key:"shaderInfo",get:function(){return this._shaderInfo}},{key:"localSetLayout",get:function(){return Vm.getDescriptorSetLayout(this._device,this._programName,!0)}},{key:"program",get:function(){return this._programName}},{key:"properties",get:function(){return this._properties}},{key:"defines",get:function(){return this._defines}},{key:"passIndex",get:function(){return this._passIndex}},{key:"propertyIndex",get:function(){return this._propertyIndex}},{key:"dynamics",get:function(){return this._dynamics}},{key:"blocks",get:function(){return this._blocks}},{key:"blocksInt",get:function(){return this._blocksInt}},{key:"rootBufferDirty",get:function(){return this._rootBufferDirty}},{key:"priority",get:function(){return this._priority}},{key:"primitive",get:function(){return this._primitive}},{key:"stage",get:function(){return this._stage}},{key:"phase",get:function(){return this._phase}},{key:"rasterizerState",get:function(){return this._rs}},{key:"depthStencilState",get:function(){return this._dss}},{key:"blendState",get:function(){return this._bs}},{key:"dynamicStates",get:function(){return this._dynamicStates}},{key:"batchingScheme",get:function(){return this._batchingScheme}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"hash",get:function(){return this._hash}},{key:"pipelineLayout",get:function(){return this._pipelineLayout}}]),t}();Yv.getTypeFromHandle=fm,Yv.getBindingFromHandle=dm,Yv.getCountFromHandle=pm,Yv.getOffsetFromHandle=mm;var Kv=t("PipelineStateManager",function(){function t(){}return t.getOrCreatePipelineState=function(t,e,n,i,r){var a=e.hash^i.hash^r.attributesHash^n.typedID,o=this._PSOHashMap.get(a);if(!o){var s=e.pipelineLayout,c=new Jr(r.attributes),l=new Ma(n,s,i,c,e.rasterizerState,e.depthStencilState,e.blendState,e.primitive,e.dynamicStates);o=t.createPipelineState(l),this._PSOHashMap.set(a,o)}return o},t}());Kv._PSOHashMap=new Map;var Jv=new fr,Qv=new or;function Zv(t,e){t.x=e.x*e.x,t.y=e.y*e.y,t.z=e.z*e.z}var $v,tg,eg,ng,ig,rg,ag,og,sg,cg,lg=null;function hg(t,e,n,i,r){if(i&&i.enabled&&r===lg){var a=i.subModels[0],o=a.inputAssembler,s=a.passes,c=a.shaders,l=a.descriptorSet;Jv.width=Qv.width=r.window.width,Jv.height=Qv.height=r.window.height;var h=Kv.getOrCreatePipelineState(t,s[0],c[0],e,o);n.setViewport(Jv),n.setScissor(Qv),n.bindPipelineState(h),n.bindDescriptorSet(ep.MATERIAL,s[0].descriptorSet),n.bindDescriptorSet(ep.LOCAL,l),n.bindInputAssembler(o),n.draw(o)}}var ug,_g,fg,dg,pg,mg=new ei,vg=t("Material",($v=Ec("cc.Material"),tg=cl(zm),$v((cg=function(t){function e(){var e;return ct(e=t.call(this)||this,"_effectAsset",ig,at(e)),ct(e,"_techIdx",rg,at(e)),ct(e,"_defines",ag,at(e)),ct(e,"_states",og,at(e)),ct(e,"_props",sg,at(e)),e._passes=[],e._hash=0,e}$(e,t),e.getHash=function(t){for(var e,n=0,i=st(t.passes);!(e=i()).done;)n^=e.value.hash;return n};var n=e.prototype;return n.initialize=function(t){this._passes.length?R(12005):(this._defines||(this._defines=[]),this._states||(this._states=[]),this._props||(this._props=[]),this._fillInfo(t),this._update())},n.reset=function(t){this.initialize(t)},n.destroy=function(){return this._doDestroy(),t.prototype.destroy.call(this)},n.recompileShaders=function(){console.warn("Shaders in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},n.overridePipelineStates=function(){console.warn("Pipeline states in material asset '"+this.name+"' cannot be modified at runtime, please instantiate the material first.")},n.onLoaded=function(){this._update()},n.resetUniforms=function(t){void 0===t&&(t=!0),this._props.length=this._passes.length;for(var e=0;e<this._props.length;e++)this._props[e]={};if(t)for(var n,i=st(this._passes);!(n=i()).done;){var r=n.value;r.resetUBOs(),r.resetTextures()}},n.setProperty=function(t,e,n){var i=!1;if(void 0===n)for(var r=this._passes,a=r.length,o=0;o<a;o++){var s=r[o];this._uploadProperty(s,t,e)&&(this._props[s.propertyIndex][t]=e,i=!0)}else{if(n>=this._passes.length)return void console.warn("illegal pass index: "+n+".");var c=this._passes[n];this._uploadProperty(c,t,e)&&(this._props[c.propertyIndex][t]=e,i=!0)}i||console.warn("illegal property name: "+t+".")},n.getProperty=function(t,e){if(void 0===e)for(var n=this._props,i=n.length,r=0;r<i;r++){var a=n[r];if(t in a)return a[t]}else{if(e>=this._props.length)return console.warn("illegal pass index: "+e+"."),null;var o=this._props[this._passes[e].propertyIndex];if(t in o)return o[t]}return null},n.copy=function(t,e){this._techIdx=t._techIdx,this._props.length=t._props.length;for(var n=0;n<t._props.length;n++)this._props[n]=Z({},t._props[n]);this._defines.length=t._defines.length;for(var i=0;i<t._defines.length;i++)this._defines[i]=Z({},t._defines[i]);this._states.length=t._states.length;for(var r=0;r<t._states.length;r++)this._states[r]=Z({},t._states[r]);this._effectAsset=t._effectAsset,e&&this._fillInfo(e),this._update()},n._fillInfo=function(t){void 0!==t.technique&&(this._techIdx=t.technique),t.effectAsset?this._effectAsset=t.effectAsset:t.effectName&&(this._effectAsset=zm.get(t.effectName)),t.defines&&this._prepareInfo(t.defines,this._defines),t.states&&this._prepareInfo(t.states,this._states)},n._prepareInfo=function(t,e){var n=t;if(!Array.isArray(n)){var i=this._effectAsset?this._effectAsset.techniques[this._techIdx].passes.length:1;n=Array(i).fill(n)}for(var r=0;r<n.length;++r)Object.assign(e[r]||(e[r]={}),n[r])},n._createPasses=function(){var t=this._effectAsset.techniques[this._techIdx||0];if(!t)return[];for(var e=t.passes.length,n=[],i=0;i<e;++i){var r=t.passes[i],a=r.passIndex=i,o=r.defines=this._defines[a]||(this._defines[a]={});if(r.stateOverrides=this._states[a]||(this._states[a]={}),void 0!==r.propertyIndex&&Object.assign(o,this._defines[r.propertyIndex]),void 0!==r.embeddedMacros&&Object.assign(o,r.embeddedMacros),!r.switch||o[r.switch]){var s=new Yv(h.director.root);s.initialize(r),n.push(s)}}return n},n._update=function(t){var n=this;if(void 0===t&&(t=!0),this._effectAsset){this._passes=this._createPasses();var i=this._effectAsset.techniques[this._techIdx].passes.length;if(this._props.length=i,t)this._passes.forEach((function(t,e){var i=n._props[e];for(var r in i||(i=n._props[e]={}),void 0!==t.propertyIndex&&Object.assign(i,n._props[t.propertyIndex]),i)n._uploadProperty(t,r,i[r])}));else for(var r=0;r<this._props.length;r++)this._props[r]={}}this._hash=e.getHash(this)},n._uploadProperty=function(t,e,n){var i=t.getHandle(e);if(!i)return!1;if(Yv.getTypeFromHandle(i)<gi.SAMPLER1D)if(Array.isArray(n))t.setUniformArray(i,n);else if(null!==n){var r;if(null===(r=t.properties[e])||void 0===r?void 0:r.linear){var a=n;Zv(mg,a),mg.w=a.w,n=mg}t.setUniform(i,n)}else t.resetUniform(e);else if(Array.isArray(n))for(var o=0;o<n.length;o++)this._bindTexture(t,i,n[o],o);else n?this._bindTexture(t,i,n):t.resetTexture(e);return!0},n._bindTexture=function(t,e,n,i){var r=Yv.getBindingFromHandle(e);if(n instanceof Va)t.bindTexture(r,n,i);else if(n instanceof sv){var a=n.getGFXTexture();if(!a||!a.width||!a.height)return;t.bindTexture(r,a,i),t.bindSampler(r,n.getGFXSampler(),i)}},n._doDestroy=function(){if(this._passes&&this._passes.length)for(var t,e=st(this._passes);!(t=e()).done;)t.value.destroy();this._passes.length=0},n.initDefault=function(e){t.prototype.initDefault.call(this,e),this.initialize({effectName:"unlit",defines:{USE_COLOR:!0},technique:0}),this.setProperty("mainColor",new Dn("#ff00ff"))},n.validate=function(){return!!this._effectAsset&&!this._effectAsset.isDefault&&this.passes.length>0},Q(e,[{key:"effectAsset",get:function(){return this._effectAsset}},{key:"effectName",get:function(){return this._effectAsset?this._effectAsset.name:""}},{key:"technique",get:function(){return this._techIdx}},{key:"passes",get:function(){return this._passes}},{key:"hash",get:function(){return this._hash}},{key:"parent",get:function(){return null}},{key:"owner",get:function(){return null}}]),e}($h),ig=lt((ng=cg).prototype,"_effectAsset",[tg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rg=lt(ng.prototype,"_techIdx",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ag=lt(ng.prototype,"_defines",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),og=lt(ng.prototype,"_states",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sg=lt(ng.prototype,"_props",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),eg=ng))||eg));h.Material=vg,function(t){t[t.VERTICAL=0]="VERTICAL",t[t.HORIZONTAL=1]="HORIZONTAL"}(ug||(ug={})),function(t){t[t.ORTHO=0]="ORTHO",t[t.PERSPECTIVE=1]="PERSPECTIVE"}(_g||(_g={})),function(t){t[t.F1_8=0]="F1_8",t[t.F2_0=1]="F2_0",t[t.F2_2=2]="F2_2",t[t.F2_5=3]="F2_5",t[t.F2_8=4]="F2_8",t[t.F3_2=5]="F3_2",t[t.F3_5=6]="F3_5",t[t.F4_0=7]="F4_0",t[t.F4_5=8]="F4_5",t[t.F5_0=9]="F5_0",t[t.F5_6=10]="F5_6",t[t.F6_3=11]="F6_3",t[t.F7_1=12]="F7_1",t[t.F8_0=13]="F8_0",t[t.F9_0=14]="F9_0",t[t.F10_0=15]="F10_0",t[t.F11_0=16]="F11_0",t[t.F13_0=17]="F13_0",t[t.F14_0=18]="F14_0",t[t.F16_0=19]="F16_0",t[t.F18_0=20]="F18_0",t[t.F20_0=21]="F20_0",t[t.F22_0=22]="F22_0"}(fg||(fg={})),function(t){t[t.ISO100=0]="ISO100",t[t.ISO200=1]="ISO200",t[t.ISO400=2]="ISO400",t[t.ISO800=3]="ISO800"}(dg||(dg={})),function(t){t[t.D1=0]="D1",t[t.D2=1]="D2",t[t.D4=2]="D4",t[t.D8=3]="D8",t[t.D15=4]="D15",t[t.D30=5]="D30",t[t.D60=6]="D60",t[t.D125=7]="D125",t[t.D250=8]="D250",t[t.D500=9]="D500",t[t.D1000=10]="D1000",t[t.D2000=11]="D2000",t[t.D4000=12]="D4000"}(pg||(pg={}));var gg=[1.8,2,2.2,2.5,2.8,3.2,3.5,4,4.5,5,5.6,6.3,7.1,8,9,10,11,13,14,16,18,20,22],yg=[1,.5,1/4,1/8,1/15,1/30,1/60,.008,.004,.002,.001,5e-4,1/4e3],xg=[100,200,400,800],Sg=new Mn,Ag=new Mn,bg=new Xn,Cg=Zi.STENCIL<<1,Tg=[],Eg=function(){function t(t){if(this.isWindowSize=!0,this.screenScale=void 0,this._device=void 0,this._scene=null,this._node=null,this._name=null,this._enabled=!1,this._proj=-1,this._aspect=void 0,this._orthoHeight=10,this._fovAxis=ug.VERTICAL,this._fov=dn(45),this._nearClip=1,this._farClip=1e3,this._clearColor=new dr(.2,.2,.2,1),this._viewport=new oi(0,0,1,1),this._orientedViewport=new oi(0,0,1,1),this._curTransform=di.IDENTITY,this._isProjDirty=!0,this._matView=new Xn,this._matProj=new Xn,this._matProjInv=new Xn,this._matViewProj=new Xn,this._matViewProjInv=new Xn,this._frustum=new lc,this._forward=new Mn,this._position=new Mn,this._priority=0,this._aperture=fg.F16_0,this._apertureValue=void 0,this._shutter=pg.D125,this._shutterValue=0,this._iso=dg.ISO100,this._isoValue=0,this._window=null,this._width=1,this._height=1,this._clearFlag=Zi.NONE,this._clearDepth=1,this._visibility=am,this._exposure=0,this._clearStencil=0,this._device=t,this._apertureValue=gg[this._aperture],this._shutterValue=yg[this._shutter],this._isoValue=xg[this._iso],this._aspect=this.screenScale=1,this._frustum.accurate=!0,!Tg.length){var e=t.capabilities.clipSpaceSignY;Tg[di.IDENTITY]=new Xn(1,0,0,0,0,e),Tg[di.ROTATE_90]=new Xn(0,1,0,0,-e,0),Tg[di.ROTATE_180]=new Xn(-1,0,0,0,0,-e),Tg[di.ROTATE_270]=new Xn(0,-1,0,0,e,0)}}var e=t.prototype;return e._setWidth=function(t){this._width=t},e._setHeight=function(t){this._height=t},e._setScene=function(t){this._scene=t},e._updateAspect=function(t){if(void 0===t&&(t=!0),this._aspect=this.window.width*this._viewport.width/(this.window.height*this._viewport.height),t){var e=this.window.swapchain;(e&&e.surfaceTransform||di.IDENTITY)%2&&(this._aspect=1/this._aspect)}this._isProjDirty=!0},e._init=function(){},e._destroy=function(){},e.initialize=function(t){this._init(t),this.node=t.node,this._setWidth(1),this._setHeight(1),this.clearFlag=Zi.NONE,this.clearDepth=1,this.visibility=am,this._name=t.name,this._proj=t.projection,this._priority=t.priority||0,this._aspect=this.screenScale=1,this.updateExposure(),this.changeTargetWindow(t.window)},e.destroy=function(){this._node=null,this.detachFromScene(),this._window&&(this._window.detachCamera(this),this.window=null),this._name=null,this._destroy()},e.attachToScene=function(t){this._enabled=!0,this._setScene(t)},e.detachFromScene=function(){this._enabled=!1,this._setScene(null)},e.resize=function(t,e){this._window&&(this._setWidth(t),this._setHeight(e),this._updateAspect())},e.setFixedSize=function(t,e){this._setWidth(t),this._setHeight(e),this._updateAspect(!1),this.isWindowSize=!1},e.syncCameraEditor=function(){},e.update=function(t){var e;if(void 0===t&&(t=!1),this._node){var n=!1;(this._node.hasChangedFlags||t)&&(Xn.invert(this._matView,this._node.worldMatrix),this._forward.x=-this._matView.m02,this._forward.y=-this._matView.m06,this._forward.z=-this._matView.m10,this._node.getWorldPosition(this._position),n=!0);var i=null===(e=this.window)||void 0===e?void 0:e.swapchain,r=i&&i.surfaceTransform||di.IDENTITY;if(this._isProjDirty||this._curTransform!==r){this._curTransform=r;var a=this._device.capabilities.clipSpaceSignY;if(this._proj===_g.PERSPECTIVE)Xn.perspective(this._matProj,this._fov,this._aspect,this._nearClip,this._farClip,this._fovAxis===ug.VERTICAL,this._device.capabilities.clipSpaceMinZ,a,r);else{var o=this._orthoHeight*this._aspect,s=this._orthoHeight;Xn.ortho(this._matProj,-o,o,-s,s,this._nearClip,this._farClip,this._device.capabilities.clipSpaceMinZ,a,r)}Xn.invert(this._matProjInv,this._matProj),n=!0,this._isProjDirty=!1}n&&(Xn.multiply(this._matViewProj,this._matProj,this._matView),Xn.invert(this._matViewProjInv,this._matViewProj),this._frustum.update(this._matViewProj,this._matViewProjInv))}},e.setViewportInOrientedSpace=function(t){var e,n=t.x,i=t.width,r=t.height,a=this._device.capabilities.screenSpaceSignY<0?1-t.y-r:t.y,o=null===(e=this.window)||void 0===e?void 0:e.swapchain;switch(o&&o.surfaceTransform||di.IDENTITY){case di.ROTATE_90:this._viewport.x=1-a-r,this._viewport.y=n,this._viewport.width=r,this._viewport.height=i;break;case di.ROTATE_180:this._viewport.x=1-n-i,this._viewport.y=1-a-r,this._viewport.width=i,this._viewport.height=r;break;case di.ROTATE_270:this._viewport.x=a,this._viewport.y=1-n-i,this._viewport.width=r,this._viewport.height=i;break;case di.IDENTITY:this._viewport.x=n,this._viewport.y=a,this._viewport.width=i,this._viewport.height=r}this._orientedViewport.x=n,this._orientedViewport.y=a,this._orientedViewport.width=i,this._orientedViewport.height=r,this.resize(this.width,this.height)},e.changeTargetWindow=function(t){void 0===t&&(t=null),this._window&&this._window.detachCamera(this);var e=t||h.director.root.mainWindow;if(e){e.attachCamera(this),this.window=e;var n=e.swapchain;(n&&n.surfaceTransform||di.IDENTITY)%2?this.resize(e.height,e.width):this.resize(e.width,e.height)}},e.detachCamera=function(){this._window&&this._window.detachCamera(this)},e.screenPointToRay=function(t,e,n){if(!this._node)return null;var i=this.width,r=this.height,a=this._orientedViewport.x*i,o=this._orientedViewport.y*r,s=this._orientedViewport.width*i,c=this._orientedViewport.height*r,l=this._proj===_g.PERSPECTIVE,h=this._device.capabilities.clipSpaceSignY,u=qn[this._curTransform];Mn.set(Sg,(e-a)/s*2-1,(n-o)/c*2-1,l?1:-1);var _=Sg.x,f=Sg.y;return Sg.x=_*u[0]+f*u[2]*h,Sg.y=_*u[1]+f*u[3]*h,Mn.transformMat4(l?Sg:t.o,Sg,this._matViewProjInv),l?(this._node.getWorldPosition(Ag),ao.fromPoints(t,Ag,Sg)):Mn.transformQuat(t.d,Mn.FORWARD,this._node.worldRotation),t},e.screenToWorld=function(t,e){var n=this.width,i=this.height,r=this._orientedViewport.x*n,a=this._orientedViewport.y*i,o=this._orientedViewport.width*n,s=this._orientedViewport.height*i,c=this._device.capabilities.clipSpaceSignY,l=qn[this._curTransform];if(this._proj===_g.PERSPECTIVE){Mn.set(t,(e.x-r)/o*2-1,(e.y-a)/s*2-1,1);var h=t.x,u=t.y;t.x=h*l[0]+u*l[2]*c,t.y=h*l[1]+u*l[3]*c,Mn.transformMat4(t,t,this._matViewProjInv),this._node&&this._node.getWorldPosition(Sg),Mn.lerp(t,Sg,t,fn(this._nearClip/this._farClip,1,e.z))}else{Mn.set(t,(e.x-r)/o*2-1,(e.y-a)/s*2-1,2*e.z-1);var _=t.x,f=t.y;t.x=_*l[0]+f*l[2]*c,t.y=_*l[1]+f*l[3]*c,Mn.transformMat4(t,t,this._matViewProjInv)}return t},e.worldToScreen=function(t,e){var n=this._device.capabilities.clipSpaceSignY,i=qn[this._curTransform];Mn.transformMat4(t,e,this._matViewProj);var r=t.x,a=t.y;t.x=r*i[0]+a*i[2]*n,t.y=r*i[1]+a*i[3]*n;var o=this.width,s=this.height,c=this._orientedViewport.x*o,l=this._orientedViewport.y*s,h=this._orientedViewport.width*o,u=this._orientedViewport.height*s;return t.x=c+.5*(t.x+1)*h,t.y=l+.5*(t.y+1)*u,t.z=.5*t.z+.5,t},e.worldMatrixToScreen=function(t,e,n,i){Xn.multiply(t,this._matViewProj,e),Xn.multiply(t,Tg[this._curTransform],t);var r=n/2,a=i/2;return Xn.identity(bg),Xn.transform(bg,bg,Mn.set(Sg,r,a,0)),Xn.scale(bg,bg,Mn.set(Sg,r,a,1)),Xn.multiply(t,bg,t),t},e.setExposure=function(t){this._exposure=.833333/Math.pow(2,t)},e.updateExposure=function(){var t=Math.log2(this._apertureValue*this._apertureValue/this._shutterValue*100/this._isoValue);this.setExposure(t)},Q(t,[{key:"name",get:function(){return this._name}},{key:"scene",get:function(){return this._scene}},{key:"node",get:function(){return this._node},set:function(t){this._node=t}},{key:"window",get:function(){return this._window},set:function(t){this._window=t}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"position",get:function(){return this._position},set:function(t){this._position=t}},{key:"forward",get:function(){return this._forward},set:function(t){this._forward=t}},{key:"aperture",get:function(){return this._aperture},set:function(t){this._aperture=t,this._apertureValue=gg[this._aperture],this.updateExposure()}},{key:"apertureValue",get:function(){return this._apertureValue}},{key:"shutter",get:function(){return this._shutter},set:function(t){this._shutter=t,this._shutterValue=yg[this._shutter],this.updateExposure()}},{key:"shutterValue",get:function(){return this._shutterValue}},{key:"iso",get:function(){return this._iso},set:function(t){this._iso=t,this._isoValue=xg[this._iso],this.updateExposure()}},{key:"isoValue",get:function(){return this._isoValue}},{key:"exposure",get:function(){return this._exposure}},{key:"clearFlag",get:function(){return this._clearFlag},set:function(t){this._clearFlag=t}},{key:"clearColor",get:function(){return this._clearColor},set:function(t){this._clearColor.x=t.x,this._clearColor.y=t.y,this._clearColor.z=t.z,this._clearColor.w=t.w}},{key:"clearDepth",get:function(){return this._clearDepth},set:function(t){this._clearDepth=t}},{key:"clearStencil",get:function(){return this._clearStencil},set:function(t){this._clearStencil=t}},{key:"projectionType",get:function(){return this._proj},set:function(t){this._proj=t,this._isProjDirty=!0}},{key:"aspect",get:function(){return this._aspect}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(t){this._orthoHeight=t,this._isProjDirty=!0}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(t){this._fovAxis=t,this._isProjDirty=!0}},{key:"fov",get:function(){return this._fov},set:function(t){this._fov=t,this._isProjDirty=!0}},{key:"nearClip",get:function(){return this._nearClip},set:function(t){this._nearClip=t,this._isProjDirty=!0}},{key:"farClip",get:function(){return this._farClip},set:function(t){this._farClip=t,this._isProjDirty=!0}},{key:"viewport",get:function(){return this._viewport},set:function(t){R(8302),this.setViewportInOrientedSpace(t)}},{key:"frustum",get:function(){return this._frustum},set:function(t){this._frustum=t}},{key:"matView",get:function(){return this._matView}},{key:"matProj",get:function(){return this._matProj}},{key:"matProjInv",get:function(){return this._matProjInv}},{key:"matViewProj",get:function(){return this._matViewProj}},{key:"matViewProjInv",get:function(){return this._matViewProjInv}},{key:"native",get:function(){return this._nativeObj}}],[{key:"standardExposureValue",get:function(){return 1/38400}},{key:"standardLightMeterScale",get:function(){return 1e4}}]),t}(),wg=se({Low_256x256:256,Medium_512x512:512,High_1024x1024:1024,Ultra_2048x2048:2048}),Ig=se({Planar:0,ShadowMap:1}),Pg=se({HARD:0,SOFT:1,SOFT_2X:2}),Dg=Ig.ShadowMap+1,Rg=function(){function t(){this.fixedSphere=new _o(0,0,0,.01),this.maxReceived=4,this.firstSetCSM=!1,this.shadowCameraFar=0,this.matShadowView=new Xn,this.matShadowProj=new Xn,this.matShadowViewProj=new Xn,this._enabled=!1,this._type=Dg,this._distance=0,this._normal=new Mn(0,1,0),this._shadowColor=new Dn(0,0,0,76),this._size=new Qn(512,512),this._shadowMapDirty=!1,this._matLight=new Xn,this._material=null,this._instancingMaterial=null}var e=t.prototype;return e.getPlanarShader=function(t){return this._material||(this._material=new vg,this._material.initialize({effectName:"planar-shadow"})),this._material.passes[0].getShaderVariant(t)},e.getPlanarInstanceShader=function(t){return this._instancingMaterial||(this._instancingMaterial=new vg,this._instancingMaterial.initialize({effectName:"planar-shadow",defines:{USE_INSTANCING:!0}})),this._instancingMaterial.passes[0].getShaderVariant(t)},e._setEnable=function(t){this._enabled=t},e._setType=function(t){this._type=this.enabled?t:Dg},e.initialize=function(t){this._setEnable(t.enabled),this._setType(t.type),this.normal=t.planeDirection,this.distance=t.planeHeight,this.shadowColor=t.shadowColor,this.maxReceived=t.maxReceived,this.size=t.size},e.activate=function(){this.enabled&&this.type===Ig.Planar&&this._updatePlanarInfo()},e._updatePlanarInfo=function(){this._material||(this._material=new vg,this._material.initialize({effectName:"planar-shadow"})),this._instancingMaterial||(this._instancingMaterial=new vg,this._instancingMaterial.initialize({effectName:"planar-shadow",defines:{USE_INSTANCING:!0}}))},e._destroy=function(){},e.destroy=function(){this._destroy(),this._material&&this._material.destroy(),this._instancingMaterial&&this._instancingMaterial.destroy(),this.fixedSphere.destroy()},Q(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._setEnable(t),this.activate()}},{key:"type",get:function(){return this._type},set:function(t){this._setType(t),this.activate()}},{key:"normal",get:function(){return this._normal},set:function(t){Mn.copy(this._normal,t)}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance=t}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor=t}},{key:"size",get:function(){return this._size},set:function(t){this._size.set(t)}},{key:"shadowMapDirty",get:function(){return this._shadowMapDirty},set:function(t){this._shadowMapDirty=t}},{key:"matLight",get:function(){return this._matLight}},{key:"material",get:function(){return this._material}},{key:"instancingMaterial",get:function(){return this._instancingMaterial}},{key:"native",get:function(){return this._nativeObj}}]),t}();Rg.MAX_FAR=2e3,Rg.COEFFICIENT_OF_EXPANSION=2*Math.sqrt(3),h.Shadows=Rg;var Mg=new Mn,Og=(new Mn,new Mn,new Mn),Ng=new Xn,Bg=new Qs,Lg=new Qs,Fg=!1,Vg=_o.create(0,0,0,1),zg=new _o,kg=new lc;kg.accurate=!0;var Ug=new lc;Ug.accurate=!0;var Gg=new lc,Hg=new Xn,jg=new Xn,Wg=new Xn,qg=new Xn,Xg=new Xn,Yg=new Xn,Kg=new Xn,Jg=new Mn,Qg=new Qn,Zg=new Mn,$g=new Mn,ty=new Mn(0,0,0),ey=(new Qs,new ql((function(){return{model:null,depth:0}}),128)),ny=new ql((function(){return{model:null,depth:0}}),128),iy=new ql((function(){return{model:null,depth:0}}),128);function ry(t,e){var n=0;t.node&&(Mn.subtract(Mg,t.node.worldPosition,e.position),n=Mn.dot(Mg,e.forward));var i=ey.alloc();return i.model=t,i.depth=n,i}function ay(t,e){var n=0;t.node&&(Mn.subtract(Mg,t.node.worldPosition,e.position),n=Mn.dot(Mg,e.forward));var i=ny.alloc();return i.model=t,i.depth=n,i}function oy(t,e){var n=0;t.node&&(Mn.subtract(Mg,t.node.worldPosition,e.position),n=Mn.dot(Mg,e.forward));var i=iy.alloc();return i.model=t,i.depth=n,i}function sy(t,e,n){var i=e.direction,r=t.normal,a=t.distance+.001,o=1/Mn.dot(r,i),s=i.x*o,c=i.y*o,l=i.z*o,h=r.x,u=r.y,_=r.z,f=t.matLight;f.m00=1-h*s,f.m01=-h*c,f.m02=-h*l,f.m03=0,f.m04=-u*s,f.m05=1-u*c,f.m06=-u*l,f.m07=0,f.m08=-_*s,f.m09=-_*c,f.m10=1-_*l,f.m11=0,f.m12=s*a,f.m13=c*a,f.m14=l*a,f.m15=1,Xn.toArray(n,f,cp.MAT_LIGHT_PLANE_PROJ_OFFSET)}function cy(t,e){Mn.normalize(Mg,t.normal),e[cp.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+0]=Mg.x,e[cp.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+1]=Mg.y,e[cp.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+2]=Mg.z,e[cp.PLANAR_NORMAL_DISTANCE_INFO_OFFSET+3]=t.distance}function ly(t,e){var n=t.pipelineSceneData.validPunctualLights;n.length=0;for(var i=e.scene.spotLights,r=0;r<i.length;r++){var a=i[r];a.baked||(_o.set(Vg,a.position.x,a.position.y,a.position.z,a.range),vs.sphereFrustum(Vg,e.frustum)&&n.push(a))}for(var o=e.scene.sphereLights,s=0;s<o.length;s++){var c=o[s];c.baked||(_o.set(Vg,c.position.x,c.position.y,c.position.z,c.range),vs.sphereFrustum(Vg,e.frustum)&&n.push(c))}}function hy(t,e){var n=e.scene,i=n.mainLight,r=t.pipelineSceneData,a=r.shadows,o=r.skybox,s=r.renderObjects;ey.freeArray(s),s.length=0;var c=r.castShadowObjects;iy.freeArray(c),c.length=0,Fg=!1;var l=null;if(a.enabled&&(t.pipelineUBO.updateShadowUBORange(cp.SHADOW_COLOR_OFFSET,a.shadowColor),a.type===Ig.ShadowMap))if(l=t.pipelineSceneData.dirShadowObjects,ny.freeArray(l),l.length=0,i&&i.node)!function(t,e,n,i,r){var a=e.device;if(n.shadowFixedArea){var o=n.shadowOrthoSize,s=n.shadowOrthoSize,c=n.shadowNear,l=n.shadowFar;Xn.fromRT(Hg,n.node.getWorldRotation(),n.node.getWorldPosition()),Xn.invert(jg,Hg),Xn.ortho(qg,-o,o,-s,s,c,l,a.capabilities.clipSpaceMinZ,a.capabilities.clipSpaceSignY),Xn.multiply(Xg,qg,jg),Xn.invert(Wg,jg),r.matShadowView=jg,r.matShadowProj=qg,r.matShadowViewProj=Xg,lc.createOrtho(t,2*o,2*s,c,l,Wg)}else{var h=n.shadowInvisibleOcclusionRange,u=r.size.x;!function(t,e){if(e.node){var n=e.node,i=n.getWorldPosition(),r=n.getWorldRotation();Xn.fromRT(t,r,i),t.m08*=-1,t.m09*=-1,t.m10*=-1}}(Ng,i),lc.split(kg,i,Ng,.1,n.shadowDistance),Ug=lc.clone(kg),Xn.fromRT(Hg,n.node.rotation,ty),Xn.invert(jg,Hg),Xn.invert(Wg,jg);var _=jg.clone();Ug.transform(jg),Qs.fromPoints(Bg,new Mn(1e7,1e7,1e7),new Mn(-1e7,-1e7,-1e7)),Bg.mergeFrustum(Ug);var f=2*Bg.halfExtents.z;Og.set(Bg.center.x,Bg.center.y,Bg.center.z+Bg.halfExtents.z+h),Mn.transformMat4(Og,Og,Wg),Xn.fromRT(Hg,n.node.rotation,Og),Xn.invert(jg,Hg),Xn.invert(Wg,jg);var d=Mn.distance(kg.vertices[0],kg.vertices[6]);zg.center.set(0,0,0),zg.radius=-1,zg.mergePoints(kg.vertices);var p=.8*d+.4*zg.radius;r.shadowCameraFar=f+h;var m=.5*p;if(Xn.ortho(qg,-m,m,-m,m,.1,r.shadowCameraFar,a.capabilities.clipSpaceMinZ,a.capabilities.clipSpaceSignY),u>0){Xn.multiply(Yg,qg,_),Mn.transformMat4(Jg,Og,Yg);var v=2/u;Qg.set(v,v);var g=Jg.x%Qg.x,y=Jg.y%Qg.y;Zg.set(Jg.x-g,Jg.y-y,Jg.z),Xn.invert(Kg,Yg),Mn.transformMat4($g,Zg,Kg),Xn.fromRT(Hg,n.node.rotation,$g),Xn.invert(jg,Hg),Xn.invert(Wg,jg),lc.createOrtho(t,p,p,.1,r.shadowCameraFar,Wg)}else{for(var x=0;x<8;x++)t.vertices[x].set(0,0,0);t.updatePlanes()}Xn.multiply(Xg,qg,jg),r.matShadowView=jg,r.matShadowProj=qg,r.matShadowViewProj=Xg}}(Gg,t,i,e,a);else{for(var h=0;h<8;h++)Gg.vertices[h].set(0,0,0);Gg.updatePlanes()}i&&a.type===Ig.Planar&&function(t,e){var n=t.pipelineSceneData.shadows,i=e.direction,r=n.normal,a=n.distance+.001,o=1/Mn.dot(r,i),s=i.x*o,c=i.y*o,l=i.z*o,h=r.x,u=r.y,_=r.z,f=n.matLight;f.m00=1-h*s,f.m01=-h*c,f.m02=-h*l,f.m03=0,f.m04=-u*s,f.m05=1-u*c,f.m06=-u*l,f.m07=0,f.m08=-_*s,f.m09=-_*c,f.m10=1-_*l,f.m11=0,f.m12=s*a,f.m13=c*a,f.m14=l*a,f.m15=1,t.pipelineUBO.updateShadowUBORange(cp.MAT_LIGHT_PLANE_PROJ_OFFSET,n.matLight)}(t,i),o.enabled&&o.model&&e.clearFlag&Cg&&s.push(ry(o.model,e));for(var u=n.models,_=e.visibility,f=0;f<u.length;f++){var d=u[f];if(d.enabled&&(d.castShadow&&c.push(oy(d,e)),a.firstSetCSM&&d.worldBounds&&(Fg||(Lg.copy(d.worldBounds),Fg=!0),Qs.merge(Lg,Lg,d.worldBounds)),d.node&&(_&d.node.layer)===d.node.layer||_&d.visFlags)){if(null!=l&&d.castShadow&&d.worldBounds&&vs.aabbFrustum(d.worldBounds,Gg)&&l.push(ay(d,e)),d.worldBounds&&!vs.aabbFrustum(d.worldBounds,e.frustum))continue;s.push(ry(d,e))}}}var uy,_y=new Tr(Pi.LINEAR,Pi.LINEAR,Pi.NONE,Di.CLAMP,Di.CLAMP,Di.CLAMP),fy=new Tr(Pi.POINT,Pi.POINT,Pi.NONE,Di.CLAMP,Di.CLAMP,Di.CLAMP),dy=function(){function t(t){this._device=void 0,this._descriptorSetMap=new Map,this._globalDescriptorSet=void 0,this._descriptorSetLayout=void 0,this._linearSampler=void 0,this._pointSampler=void 0,this._device=t.device,this._linearSampler=this._device.getSampler(_y),this._pointSampler=this._device.getSampler(fy);var e=new Xr(Jd.bindings);this._descriptorSetLayout=this._device.createDescriptorSetLayout(e),this._globalDescriptorSet=this._device.createDescriptorSet(new Yr(this._descriptorSetLayout))}var e=t.prototype;return e.bindBuffer=function(t,e){this._globalDescriptorSet.bindBuffer(t,e);for(var n=this._descriptorSetMap.values(),i=n.next();!i.done;)i.value.bindBuffer(t,e),i=n.next()},e.bindSampler=function(t,e){this._globalDescriptorSet.bindSampler(t,e);for(var n=this._descriptorSetMap.values(),i=n.next();!i.done;)i.value.bindSampler(t,e),i=n.next()},e.bindTexture=function(t,e){this._globalDescriptorSet.bindTexture(t,e);for(var n=this._descriptorSetMap.values(),i=n.next();!i.done;)i.value.bindTexture(t,e),i=n.next()},e.update=function(){this._globalDescriptorSet.update();for(var t=this._descriptorSetMap.values(),e=t.next();!e.done;)e.value.update(),e=t.next()},e.getOrCreateDescriptorSet=function(t){var e=this._device;if(!this._descriptorSetMap.has(t)){var n=this._globalDescriptorSet,i=e.createDescriptorSet(new Yr(this._descriptorSetLayout));this._descriptorSetMap.set(t,i);for(var r=Kd.UBO_GLOBAL;r<Kd.COUNT;r++)i.bindBuffer(r,n.getBuffer(r)),i.bindSampler(r,n.getSampler(r)),i.bindTexture(r,n.getTexture(r));var a=e.createBuffer(new gr(yi.UNIFORM|yi.TRANSFER_DST,Ai.HOST|Ai.DEVICE,cp.SIZE,cp.SIZE));i.bindBuffer(cp.BINDING,a),i.update()}return this._descriptorSetMap.get(t)},e.destroy=function(){this._descriptorSetLayout.destroy()},Q(t,[{key:"descriptorSetMap",get:function(){return this._descriptorSetMap}},{key:"linearSampler",get:function(){return this._linearSampler}},{key:"pointSampler",get:function(){return this._pointSampler}},{key:"descriptorSetLayout",get:function(){return this._descriptorSetLayout}},{key:"globalDescriptorSet",get:function(){return this._globalDescriptorSet}}]),t}(),py=0,my={},vy=new Yr(null),gy=function(){function t(){this._device=null,this._passes=null,this._shaders=null,this._subMesh=null,this._patches=null,this._priority=Wd.DEFAULT,this._inputAssembler=null,this._descriptorSet=null,this._worldBoundDescriptorSet=null,this._planarInstanceShader=null,this._planarShader=null,this._reflectionTex=null,this._reflectionSampler=null}var e=t.prototype;return e._destroyDescriptorSet=function(){this._descriptorSet.destroy(),this._descriptorSet=null},e._destroyWorldBoundDescriptorSet=function(){this._worldBoundDescriptorSet.destroy(),this._worldBoundDescriptorSet=null},e._destroyInputAssembler=function(){this._inputAssembler.destroy(),this._inputAssembler=null},e._createDescriptorSet=function(t){this._descriptorSet=this._device.createDescriptorSet(t)},e._createWorldBoundDescriptorSet=function(t){this._worldBoundDescriptorSet=this._device.createDescriptorSet(t)},e._setInputAssembler=function(t){this._inputAssembler=this._device.createInputAssembler(t)},e._setSubMesh=function(t){this._subMesh=t},e._init=function(){},e.initialize=function(t,e,n){void 0===n&&(n=null);var i=h.director.root;this._device=i.device,vy.layout=e[0].localSetLayout,this._init(),this._setInputAssembler(t.iaInfo),this._createDescriptorSet(vy);var r=h.director.root.pipeline.pipelineSceneData.getOcclusionQueryPass(),a=new Yr(null);if(a.layout=r.localSetLayout,this._createWorldBoundDescriptorSet(a),this._setSubMesh(t),this._patches=n,this._passes=e,this._flushPassInfo(),e[0].batchingScheme===Fv.VB_MERGING&&(this.subMesh.genFlatBuffers(),this._setSubMesh(this.subMesh)),this.priority=Wd.DEFAULT,e[0].phase===Gv("reflection")){var o=i.mainWindow.width,s=i.mainWindow.height,c=512;s<o?(o=c*o/s,s=c):s=c*s/(o=c),this._reflectionTex=this._device.createTexture(new br(bi.TEX2D,Ci.STORAGE|Ci.TRANSFER_SRC|Ci.SAMPLED,mi.RGBA8,o,s)),this.descriptorSet.bindTexture(Qp,this._reflectionTex),this._reflectionSampler=this._device.getSampler(new Tr(Pi.LINEAR,Pi.LINEAR,Pi.NONE,Di.CLAMP,Di.CLAMP,Di.CLAMP)),this.descriptorSet.bindSampler(Qp,this._reflectionSampler),this.descriptorSet.bindTexture(tm,this._reflectionTex)}},e._initNativePlanarShadowShader=function(t){this._planarShader=t.getPlanarShader(this._patches)},e.initPlanarShadowShader=function(){var t=h.director.root.pipeline.pipelineSceneData.shadows;this._initNativePlanarShadowShader(t)},e._initNativePlanarShadowInstanceShader=function(t){this._planarInstanceShader=t.getPlanarInstanceShader(this._patches)},e.initPlanarShadowInstanceShader=function(){var t=h.director.root.pipeline.pipelineSceneData.shadows;this._initNativePlanarShadowInstanceShader(t)},e._destroy=function(){},e.destroy=function(){this._destroyDescriptorSet(),this._destroyWorldBoundDescriptorSet(),this._destroyInputAssembler(),this.priority=Wd.DEFAULT,this._patches=null,this._subMesh=null,this._passes=null,this._shaders=null,this._reflectionTex&&this._reflectionTex.destroy(),this._reflectionTex=null,this._reflectionSampler=null,this._destroy()},e.update=function(){for(var t=0;t<this._passes.length;++t)this._passes[t].update();this._descriptorSet.update(),this._worldBoundDescriptorSet.update()},e.onPipelineStateChanged=function(){var t=this._passes;if(t){for(var e=0;e<t.length;e++){var n=t[e];n.beginChangeStatesSilently(),n.tryCompile(),n.endChangeStatesSilently()}this._flushPassInfo()}},e.onMacroPatchesStateChanged=function(t){this._patches=t;var e=this._passes;if(e){for(var n=0;n<e.length;n++){var i=e[n];i.beginChangeStatesSilently(),i.tryCompile(),i.endChangeStatesSilently()}this._flushPassInfo()}},e._flushPassInfo=function(){var t=this._passes;if(t){this._shaders||(this._shaders=[]),this._shaders.length=t.length;for(var e=0,n=t.length;e<n;e++)this._shaders[e]=t[e].getShaderVariant(this.patches)}},Q(t,[{key:"passes",get:function(){return this._passes},set:function(t){t.length>8?O(12004,8):(this._passes=t,this._flushPassInfo(),this._passes[0].batchingScheme===Fv.VB_MERGING&&(this.subMesh.genFlatBuffers(),this._setSubMesh(this.subMesh)),this._descriptorSet&&(this._destroyDescriptorSet(),vy.layout=t[0].localSetLayout,this._createDescriptorSet(vy)))}},{key:"shaders",get:function(){return this._shaders}},{key:"subMesh",get:function(){return this._subMesh},set:function(t){this._inputAssembler.destroy(),this._inputAssembler.initialize(t.iaInfo),this._passes[0].batchingScheme===Fv.VB_MERGING&&this.subMesh.genFlatBuffers(),this._setSubMesh(t)}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"inputAssembler",get:function(){return this._inputAssembler}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"worldBoundDescriptorSet",get:function(){return this._worldBoundDescriptorSet}},{key:"patches",get:function(){return this._patches}},{key:"planarInstanceShader",get:function(){return this._planarInstanceShader}},{key:"planarShader",get:function(){return this._planarShader}},{key:"native",get:function(){return this._nativeObj}}]),t}(),yy=new Xn,xy=[{name:"CC_RECEIVE_SHADOW",value:!0}],Sy=[{name:"CC_USE_LIGHTMAP",value:!0}];!function(t){t[t.DEFAULT=0]="DEFAULT",t[t.SKINNING=1]="SKINNING",t[t.BAKED_SKINNING=2]="BAKED_SKINNING",t[t.BATCH_2D=3]="BATCH_2D",t[t.PARTICLE_BATCH=4]="PARTICLE_BATCH",t[t.LINE=5]="LINE"}(uy||(uy={}));var Ay=new Tr(Pi.LINEAR,Pi.LINEAR,Pi.NONE,Di.CLAMP,Di.CLAMP,Di.CLAMP),by=new Tr(Pi.LINEAR,Pi.LINEAR,Pi.LINEAR,Di.CLAMP,Di.CLAMP,Di.CLAMP),Cy=function(){function t(){this.type=uy.DEFAULT,this.scene=null,this.isDynamicBatching=!1,this.instancedAttributes={buffer:null,views:[],attributes:[]},this._worldBounds=null,this._modelBounds=null,this._subModels=[],this._node=null,this._transform=null,this._device=void 0,this._inited=!1,this._descriptorSetCount=1,this._updateStamp=-1,this._localDataUpdated=!0,this._localData=new Float32Array(Sp.COUNT),this._localBuffer=null,this._instMatWorldIdx=-1,this._lightmap=null,this._lightmapUVParam=new ei,this._worldBoundBuffer=null,this._receiveShadow=!1,this._castShadow=!1,this._shadowBias=0,this._shadowNormalBias=0,this._enabled=!0,this._visFlags=Hd.Enum.NONE,this._device=h.director.root.device}var e=t.prototype;return e._setReceiveShadow=function(t){this._receiveShadow=t},e._init=function(){},e.initialize=function(){this._inited||(this._init(),this._setReceiveShadow(!0),this.castShadow=!1,this.enabled=!0,this.visFlags=Hd.Enum.NONE,this._inited=!0)},e._destroySubmodel=function(t){t.destroy()},e._destroy=function(){},e.destroy=function(){for(var t=this._subModels,e=0;e<t.length;e++){var n=this._subModels[e];this._destroySubmodel(n)}this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._worldBoundBuffer&&(this._worldBoundBuffer.destroy(),this._worldBoundBuffer=null),this._worldBounds=null,this._modelBounds=null,this._subModels.length=0,this._inited=!1,this._localDataUpdated=!0,this._transform=null,this._node=null,this.isDynamicBatching=!1,this._destroy()},e.attachToScene=function(t){this.scene=t,this._localDataUpdated=!0},e.detachFromScene=function(){this.scene=null},e.updateTransform=function(){var t=this.transform;if(t.hasChangedFlags||t._dirtyFlags){t.updateWorldTransform(),this._localDataUpdated=!0;var e=this._worldBounds;this._modelBounds&&e&&this._modelBounds.transform(t._mat,t._pos,t._rot,t._scale,e)}},e.updateWorldBound=function(){var t=this.transform;if(null!==t){t.updateWorldTransform(),this._localDataUpdated=!0;var e=this._worldBounds;this._modelBounds&&e&&this._modelBounds.transform(t._mat,t._pos,t._rot,t._scale,e)}},e._applyLocalData=function(){},e._applyLocalBuffer=function(){},e._applyWorldBoundBuffer=function(){},e.updateUBOs=function(t){for(var e=this._subModels,n=0;n<e.length;n++)e[n].update();if(this._updateStamp=t,this._localDataUpdated){this._localDataUpdated=!1;var i=this.transform._mat,r=this._instMatWorldIdx;if(r>=0){var a=this.instancedAttributes.views;!function(t,e,n,i){e[0]=t.m00,e[1]=t.m01,e[2]=t.m02,e[3]=t.m12,n[0]=t.m04,n[1]=t.m05,n[2]=t.m06,n[3]=t.m13,i[0]=t.m08,i[1]=t.m09,i[2]=t.m10,i[3]=t.m14}(i,a[r],a[r+1],a[r+2])}else if(this._localBuffer){Xn.toArray(this._localData,i,Sp.MAT_WORLD_OFFSET),Xn.inverseTranspose(yy,i);var o=Math.abs(Xn.determinant(yy)),s=1/Math.sqrt(o);Xn.multiplyScalar(yy,yy,s),Xn.toArray(this._localData,yy,Sp.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData),this._applyLocalData(),this._applyLocalBuffer()}}},e._updateNativeBounds=function(){},e.createBoundingShape=function(t,e){t&&e&&(this._modelBounds=Qs.fromPoints(Qs.create(),t,e),this._worldBounds=Qs.clone(this._modelBounds),this._updateNativeBounds())},e._createSubModel=function(){return new gy},e.initSubModel=function(t,e,n){this.initialize(),null==this._subModels[t]?this._subModels[t]=this._createSubModel():this._subModels[t].destroy(),this._subModels[t].initialize(e,n.passes,this.getMacroPatches(t)),this._subModels[t].initPlanarShadowShader(),this._subModels[t].initPlanarShadowInstanceShader(),this._updateAttributesAndBinding(t)},e.setSubModelMesh=function(t,e){this._subModels[t]&&(this._subModels[t].subMesh=e)},e.setSubModelMaterial=function(t,e){this._subModels[t]&&(this._subModels[t].passes=e.passes,this._updateAttributesAndBinding(t))},e.onGlobalPipelineStateChanged=function(){for(var t=this._subModels,e=0;e<t.length;e++)t[e].onPipelineStateChanged()},e.onMacroPatchesStateChanged=function(){for(var t=this._subModels,e=0;e<t.length;e++)t[e].onMacroPatchesStateChanged(this.getMacroPatches(e))},e.updateLightingmap=function(t,e){ei.toArray(this._localData,e,Sp.LIGHTINGMAP_UVPARAM),this._localDataUpdated=!0,this._lightmap=t,this._lightmapUVParam=e,this.onMacroPatchesStateChanged(),null===t&&(t=Uv.get("empty-texture"));var n=t.getGFXTexture();if(n)for(var i=this._device.getSampler(t.mipmaps.length>1?by:Ay),r=this._subModels,a=0;a<r.length;a++){var o=r[a].descriptorSet;o.bindTexture(Wp,n),o.bindSampler(Wp,i),o.update()}},e.updateLocalShadowBias=function(){var t=this._localData;t[Sp.LOCAL_SHADOW_BIAS+0]=this._shadowBias,t[Sp.LOCAL_SHADOW_BIAS+1]=this._shadowNormalBias,t[Sp.LOCAL_SHADOW_BIAS+2]=0,t[Sp.LOCAL_SHADOW_BIAS+3]=0,this._localDataUpdated=!0},e.getMacroPatches=function(){var t=this.receiveShadow?xy:null;return null!=this._lightmap&&(t=t?t.concat(Sy):Sy),t},e._updateAttributesAndBinding=function(t){var e=this._subModels[t];if(e){this._initLocalDescriptors(t),this._updateLocalDescriptors(t,e.descriptorSet),this._initWorldBoundDescriptors(t),this._updateWorldBoundDescriptors(t,e.worldBoundDescriptorSet);var n=e.passes[0].getShaderVariant(e.patches);this._updateInstancedAttributes(n.attributes,e.passes[0])}},e._getInstancedAttributeIndex=function(t){for(var e=this.instancedAttributes.attributes,n=0;n<e.length;n++)if(e[n].name===t)return n;return-1},e._setInstMatWorldIdx=function(t){this._instMatWorldIdx=t},e._updateInstancedAttributes=function(t,e){if(e.device.hasFeature(pi.INSTANCED_ARRAYS)){for(var n=0,i=0;i<t.length;i++){var r=t[i];r.isInstanced&&(n+=aa[r.format].size)}var a=this.instancedAttributes;a.buffer=new Uint8Array(n),a.views.length=a.attributes.length=0;for(var o=0,s=0;s<t.length;s++){var c=t[s];if(c.isInstanced){var l=new Br;l.format=c.format,l.name=c.name,l.isNormalized=c.isNormalized,l.location=c.location,a.attributes.push(l);var h=aa[c.format],u=new(da(h))(a.buffer.buffer,o,h.count);a.views.push(u),o+=h.size}}e.batchingScheme===Fv.INSTANCING&&e.getInstancedBuffer().destroy(),this._setInstMatWorldIdx(this._getInstancedAttributeIndex(bp)),this._localDataUpdated=!0}},e._initLocalDescriptors=function(){this._localBuffer||(this._localBuffer=this._device.createBuffer(new gr(yi.UNIFORM|yi.TRANSFER_DST,Ai.DEVICE,Sp.SIZE,Sp.SIZE)),this._applyLocalBuffer())},e._initWorldBoundDescriptors=function(){this._worldBoundBuffer||(this._worldBoundBuffer=this._device.createBuffer(new gr(yi.UNIFORM|yi.TRANSFER_DST,Ai.DEVICE,Ap.SIZE,Ap.SIZE)),this._applyWorldBoundBuffer())},e._updateLocalDescriptors=function(t,e){this._localBuffer&&e.bindBuffer(Sp.BINDING,this._localBuffer)},e._updateWorldBoundDescriptors=function(t,e){this._worldBoundBuffer&&e.bindBuffer(Ap.BINDING,this._worldBoundBuffer)},Q(t,[{key:"subModels",get:function(){return this._subModels}},{key:"inited",get:function(){return this._inited}},{key:"worldBounds",get:function(){return this._worldBounds}},{key:"modelBounds",get:function(){return this._modelBounds}},{key:"localBuffer",get:function(){return this._localBuffer}},{key:"worldBoundBuffer",get:function(){return this._worldBoundBuffer}},{key:"updateStamp",get:function(){return this._updateStamp}},{key:"isInstancingEnabled",get:function(){return this._instMatWorldIdx>=0}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t}},{key:"receiveShadow",get:function(){return this._receiveShadow},set:function(t){this._setReceiveShadow(t),this.onMacroPatchesStateChanged()}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}},{key:"node",get:function(){return this._node},set:function(t){this._node=t}},{key:"transform",get:function(){return this._transform},set:function(t){this._transform=t}},{key:"visFlags",get:function(){return this._visFlags},set:function(t){this._visFlags=t}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"native",get:function(){return this._nativeObj}}]),t}(),Ty=function(){function t(){this._groundAlbedoHDR=new ei(.2,.2,.2,1),this._skyColorHDR=new ei(.2,.5,.8,1),this._skyIllumHDR=0,this._groundAlbedoLDR=new ei(.2,.2,.2,1),this._skyColorLDR=new ei(.2,.5,.8,1),this._skyIllumLDR=0,this._enabled=!1}var e=t.prototype;return e.initialize=function(t){this._skyColorHDR=t.skyColorHDR,this._groundAlbedoHDR.set(t.groundAlbedoHDR),this._skyIllumHDR=t.skyIllumHDR,this._skyColorLDR=t.skyColorLDR,this._groundAlbedoLDR.set(t.groundAlbedoLDR),this._skyIllumLDR=t.skyIllumLDR},e._destroy=function(){},e.destroy=function(){this._destroy()},Q(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"skyColor",get:function(){return h.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR:this._skyColorLDR},set:function(t){h.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(t):this._skyColorLDR.set(t)}},{key:"skyIllum",get:function(){return h.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR:this._skyIllumLDR},set:function(t){h.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR=t:this._skyIllumLDR=t}},{key:"groundAlbedo",get:function(){return h.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR:this._groundAlbedoLDR},set:function(t){h.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(t):this._groundAlbedoLDR.set(t)}},{key:"native",get:function(){return this._nativeObj}}]),t}();Ty.SUN_ILLUM=65e3,Ty.SKY_ILLUM=2e4,h.Ambient=Ty;var Ey=function(t){function e(e,n){var i;(i=t.call(this,e.root)||this)._parent=void 0,i._owner=void 0,i._dontNotify=!1,i._parent=e,i._owner=n,i._doInit(i._parent,!0);for(var r=0;r<i._shaderInfo.blocks.length;r++){var a=i._shaderInfo.blocks[r],o=i._blocks[a.binding],s=i._parent.blocks[a.binding];o.set(s)}i._setRootBufferDirty(!0);for(var c=i._parent,l=0;l<i._shaderInfo.samplerTextures.length;l++)for(var h=i._shaderInfo.samplerTextures[l],u=0;u<h.count;u++){var _=c._descriptorSet.getSampler(h.binding,u),f=c._descriptorSet.getTexture(h.binding,u);i._descriptorSet.bindSampler(h.binding,_,u),i._descriptorSet.bindTexture(h.binding,f,u)}return t.prototype.tryCompile.call(at(i)),i}$(e,t);var n=e.prototype;return n.overridePipelineStates=function(t,e){this._bs.reset(),this._rs.reset(),this._dss.reset(),Yv.fillPipelineInfo(this,t),Yv.fillPipelineInfo(this,e),this._onStateChange()},n.tryCompile=function(e){if(e&&!Am(this._defines,e))return!1;var n=t.prototype.tryCompile.call(this);return this._onStateChange(),n},n.beginChangeStatesSilently=function(){this._dontNotify=!0},n.endChangeStatesSilently=function(){this._dontNotify=!1},n._syncBatchingScheme=function(){this._defines.USE_BATCHING=this._defines.USE_INSTANCING=!1,this._setBatchingScheme(Fv.NONE)},n._onStateChange=function(){this._setHash(Yv.getPassHash(this)),this._owner.onPassStateChange(this._dontNotify)},Q(e,[{key:"parent",get:function(){return this._parent}}]),e}(Yv),wy=function(t){function e(e){var n;return(n=t.call(this)||this)._passes=[],n._parent=void 0,n._owner=void 0,n._subModelIdx=0,n._parent=e.parent,n._owner=e.owner||null,n._subModelIdx=e.subModelIdx||0,n.copy(n._parent),n}$(e,t);var n=e.prototype;return n.recompileShaders=function(t,e){if(this._passes&&this.effectAsset)if(void 0===e)for(var n,i=st(this._passes);!(n=i()).done;)n.value.tryCompile(t);else this._passes[e].tryCompile(t)},n.overridePipelineStates=function(t,e){if(this._passes&&this.effectAsset){var n=this.effectAsset.techniques[this.technique].passes;if(void 0===e)for(var i=0;i<this._passes.length;i++){var r=this._passes[i],a=this._states[i]||(this._states[i]={});for(var o in t)a[o]=t[o];r.overridePipelineStates(n[r.passIndex],a)}else{var s=this._states[e]||(this._states[e]={});for(var c in t)s[c]=t[c];this._passes[e].overridePipelineStates(n[e],s)}}},n.destroy=function(){return this._doDestroy(),!0},n.onPassStateChange=function(t){this._hash=vg.getHash(this),!t&&this._owner&&this._owner._onRebuildPSO(this._subModelIdx,this)},n._createPasses=function(){var t=[],e=this._parent.passes;if(!e)return t;for(var n=0;n<e.length;++n)t.push(new Ey(e[n],this));return t},Q(e,[{key:"parent",get:function(){return this._parent}},{key:"owner",get:function(){return this._owner}}]),e}(vg),Iy=null,Py=null,Dy=se({HEMISPHERE_DIFFUSE:0,AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION:1,DIFFUSEMAP_WITH_REFLECTION:2}),Ry=function(){function t(){this._envmapLDR=null,this._envmapHDR=null,this._diffuseMapLDR=null,this._diffuseMapHDR=null,this._globalDSManager=null,this._model=null,this._default=null,this._enabled=!1,this._useIBL=!1,this._useHDR=!0,this._useDiffuseMap=!1}var e=t.prototype;return e._setEnabled=function(t){this._enabled=t},e._setUseIBL=function(t){this._useIBL=t},e._setUseHDR=function(t){this._useHDR=t},e._setUseDiffuseMap=function(t){this._useDiffuseMap=t},e.initialize=function(t){this._setEnabled(t.enabled),this._setUseIBL(t.useIBL),this._setUseDiffuseMap(t.applyDiffuseMap),this._setUseHDR(t.useHDR)},e.setEnvMaps=function(t,e){this._envmapHDR=t,this._envmapLDR=e,this._updateGlobalBinding(),this._updatePipeline()},e.setDiffuseMaps=function(t,e){this._diffuseMapHDR=t,this._diffuseMapLDR=e,this._updateGlobalBinding(),this._updatePipeline()},e.activate=function(){var t=h.director.root.pipeline;this._globalDSManager=t.globalDSManager,this._default=Uv.get("default-cube-texture"),this._model||(this._model=h.director.root.createModel(h.renderer.scene.Model),this._model._initLocalDescriptors=function(){},this._model._initWorldBoundDescriptors=function(){});var e=this._default.isRGBE;if(this.envmap&&(e=this.envmap.isRGBE),!Py){var n=new vg;n.initialize({effectName:"skybox",defines:{USE_RGBE_CUBEMAP:e}}),Py=new wy({parent:n})}this.enabled&&(Iy||(Iy=h.utils.createMesh(h.primitives.box({width:2,height:2,length:2}))),this._model.initSubModel(0,Iy.renderingSubMeshes[0],Py)),this.envmap||(this.envmap=this._default),this.diffuseMap||(this.diffuseMap=this._default),this._updateGlobalBinding(),this._updatePipeline()},e._updatePipeline=function(){var t=h.director.root,e=t.pipeline,n=this.useIBL?this.isRGBE?2:1:0,i=this.useIBL&&this.useDiffuseMap&&this.diffuseMap?this.isRGBE?2:1:0,r=this.useHDR;e.macros.CC_USE_IBL===n&&e.macros.CC_USE_DIFFUSEMAP===i&&e.macros.CC_USE_HDR===r||(e.macros.CC_USE_IBL=n,e.macros.CC_USE_DIFFUSEMAP=i,e.macros.CC_USE_HDR=r,t.onGlobalPipelineStateChanged()),this.enabled&&Py&&Py.recompileShaders({USE_RGBE_CUBEMAP:this.isRGBE}),this._model&&this._model.setSubModelMaterial(0,Py)},e._updateGlobalBinding=function(){if(this._globalDSManager){var t=h.director.root.device,e=this.envmap?this.envmap:this._default;if(e){var n=e.getGFXTexture(),i=t.getSampler(e.getSamplerInfo());this._globalDSManager.bindSampler(_p,i),this._globalDSManager.bindTexture(_p,n)}var r=this.diffuseMap?this.diffuseMap:this._default;if(r){var a=r.getGFXTexture(),o=t.getSampler(r.getSamplerInfo());this._globalDSManager.bindSampler(pp,o),this._globalDSManager.bindTexture(pp,a)}this._globalDSManager.update()}},e._destroy=function(){},e.destroy=function(){this._destroy()},Q(t,[{key:"model",get:function(){return this._model}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._setEnabled(t),t?this.activate():this._updatePipeline()}},{key:"useHDR",get:function(){return this._useHDR},set:function(t){this._setUseHDR(t),this.setEnvMaps(this._envmapHDR,this._envmapLDR)}},{key:"useIBL",get:function(){return this._useIBL},set:function(t){this._setUseIBL(t),this._updatePipeline()}},{key:"useDiffuseMap",get:function(){return this._useDiffuseMap},set:function(t){this._useDiffuseMap=t,this._updatePipeline()}},{key:"isRGBE",get:function(){return!!this.envmap&&this.envmap.isRGBE}},{key:"envmap",get:function(){return h.director.root.pipeline.pipelineSceneData.isHDR?this._envmapHDR:this._envmapLDR},set:function(t){h.director.root.pipeline.pipelineSceneData.isHDR?this.setEnvMaps(t,this._envmapLDR):this.setEnvMaps(this._envmapHDR,t)}},{key:"diffuseMap",get:function(){return h.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR:this._diffuseMapLDR},set:function(t){h.director.root.pipeline.pipelineSceneData.isHDR?this.setDiffuseMaps(t,this._diffuseMapLDR):this.setDiffuseMaps(this._diffuseMapHDR,t)}},{key:"native",get:function(){return this._nativeObj}}]),t}();h.Skybox=Ry;var My=new ei,Oy=se({LINEAR:0,EXP:1,EXP_SQUARED:2,LAYERED:3}),Ny=Oy.LAYERED+1,By=function(){function t(){this._fogColor=new Dn("#C8C8C8"),this._colorArray=new ei(.2,.2,.2,1),this._enabled=!1,this._accurate=!1,this._type=0,this._fogDensity=.3,this._fogStart=.5,this._fogEnd=300,this._fogAtten=5,this._fogTop=1.5,this._fogRange=1.2}var e=t.prototype;return e._setType=function(t){this._type=this.enabled?t:Ny},e._setEnable=function(t){this._enabled=t},e._setAccurate=function(t){this._accurate=t},e.initialize=function(t){this.fogColor=t.fogColor,this._setEnable(t.enabled),this._setAccurate(t.accurate),this._setType(t.type),this.fogDensity=t.fogDensity,this.fogStart=t.fogStart,this.fogEnd=t.fogEnd,this.fogAtten=t.fogAtten,this.fogTop=t.fogTop,this.fogRange=t.fogRange},e.activate=function(){this._updatePipeline()},e._updatePipeline=function(){var t=h.director.root,e=this.enabled?this.type:Ny,n=this.accurate?1:0,i=t.pipeline;i.macros.CC_USE_FOG===e&&i.macros.CC_USE_ACCURATE_FOG===n||(i.macros.CC_USE_FOG=e,i.macros.CC_USE_ACCURATE_FOG=n,t.onGlobalPipelineStateChanged())},e._destroy=function(){},e.destroy=function(){this._destroy()},Q(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._setEnable(t),t?this.activate():(this._type=Ny,this._updatePipeline())}},{key:"accurate",get:function(){return this._accurate},set:function(t){this._setAccurate(t),this._updatePipeline()}},{key:"fogColor",get:function(){return this._fogColor},set:function(t){this._fogColor.set(t),My.set(t.x,t.y,t.z,t.w),Zv(this._colorArray,My)}},{key:"type",get:function(){return this._type},set:function(t){this._setType(t),this.enabled&&this._updatePipeline()}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(t){this._fogDensity=t}},{key:"fogStart",get:function(){return this._fogStart},set:function(t){this._fogStart=t}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(t){this._fogEnd=t}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(t){this._fogAtten=t}},{key:"fogTop",get:function(){return this._fogTop},set:function(t){this._fogTop=t}},{key:"fogRange",get:function(){return this._fogRange},set:function(t){this._fogRange=t}},{key:"colorArray",get:function(){return this._colorArray}},{key:"native",get:function(){return this._nativeObj}}]),t}();h.Fog=By;var Ly,Fy,Vy,zy=function(){function t(){this._enabled=!1,this._minPos=new Mn(0,0,0),this._maxPos=new Mn(0,0,0),this._depth=0}var e=t.prototype;return e.initialize=function(t){this._enabled=t.enabled,this._minPos=t.minPos,this._maxPos=t.maxPos,this._depth=t.depth},e._destroy=function(){},e.destroy=function(){this._destroy()},Q(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}},{key:"minPos",get:function(){return this._minPos},set:function(t){this._minPos=t}},{key:"maxPos",get:function(){return this._maxPos},set:function(t){this._maxPos=t}},{key:"depth",get:function(){return this._depth},set:function(t){this._depth=t}},{key:"native",get:function(){return this._nativeObj}}]),t}();function ky(t,e){e<1e3?e=1e3:e>15e3&&(e=15e3);var n=e*e,i=(.860117757+.000154118254*e+1.28641212e-7*n)/(1+.000842420235*e+7.08145163e-7*n),r=(.317398726+422806245e-13*e+4.20481691e-8*n)/(1-289741816e-13*e+1.61456053e-7*n),a=2*i-8*r+4,o=3*i/a,s=2*r/a,c=1/s*o,l=1/s*(1-o-s);t.x=3.2404542*c-1.5371385+-.4985314*l,t.y=-.969266*c+1.8760108+.041556*l,t.z=.0556434*c-.2040259+1.0572252*l}!function(t){t[t.LOCAL=0]="LOCAL",t[t.WORLD=1]="WORLD"}(Ly||(Ly=t("NodeSpace",{}))),function(t){t[t.NONE=0]="NONE",t[t.POSITION=1]="POSITION",t[t.ROTATION=2]="ROTATION",t[t.SCALE=4]="SCALE",t[t.RS=t.ROTATION|t.SCALE]="RS",t[t.TRS=t.POSITION|t.ROTATION|t.SCALE]="TRS",t[t.TRS_MASK=~t.TRS]="TRS_MASK"}(Fy||(Fy=t("TransformBit",{}))),h.internal.TransformBit=Fy,function(t){t[t.DIRECTIONAL=0]="DIRECTIONAL",t[t.SPHERE=1]="SPHERE",t[t.SPOT=2]="SPOT",t[t.UNKNOWN=3]="UNKNOWN"}(Vy||(Vy={}));var Uy,Gy,Hy=function(t){return 4*Math.PI*Math.PI*t*t},jy=function(){function t(){this._baked=!1,this._color=new Mn(1,1,1),this._colorTemp=6550,this._colorTempRGB=new Mn(1,1,1),this._scene=null,this._node=null,this._name=null,this._useColorTemperature=!1,this._type=Vy.UNKNOWN}var e=t.prototype;return e._init=function(){},e._destroy=function(){},e.initialize=function(){this._init(),this.color=new Mn(1,1,1),this.colorTemperature=6550},e.attachToScene=function(t){this._scene=t},e.detachFromScene=function(){this._scene=null},e.destroy=function(){this._name=null,this._node=null,this._destroy()},e.update=function(){},Q(t,[{key:"baked",get:function(){return this._baked},set:function(t){this._baked=t}},{key:"color",get:function(){return this._color},set:function(t){this._color.set(t)}},{key:"useColorTemperature",get:function(){return this._useColorTemperature},set:function(t){this._useColorTemperature=t}},{key:"colorTemperature",get:function(){return this._colorTemp},set:function(t){this._colorTemp=t,ky(this._colorTempRGB,this._colorTemp)}},{key:"colorTemperatureRGB",get:function(){return this._colorTempRGB}},{key:"node",get:function(){return this._node},set:function(t){this._node=t,this._node&&(this._node.hasChangedFlags|=Fy.ROTATION)}},{key:"type",get:function(){return this._type}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"scene",get:function(){return this._scene}},{key:"native",get:function(){return this._nativeObj}}]),t}(),Wy=new Mn(0,0,-1),qy=new Mn,Xy=function(t){function e(){var e;return(e=t.call(this)||this)._dir=new Mn(1,-1,-1),e._illuminanceHDR=Ty.SUN_ILLUM,e._illuminanceLDR=1,e._shadowEnabled=!1,e._shadowPcf=Pg.HARD,e._shadowBias=1e-5,e._shadowNormalBias=0,e._shadowSaturation=1,e._shadowDistance=100,e._shadowInvisibleOcclusionRange=200,e._shadowFixedArea=!1,e._shadowNear=.1,e._shadowFar=10,e._shadowOrthoSize=5,e._type=Vy.DIRECTIONAL,e}$(e,t);var n=e.prototype;return n.initialize=function(){t.prototype.initialize.call(this),this.illuminance=Ty.SUN_ILLUM,this.direction=new Mn(1,-1,-1)},n.update=function(){this._node&&this._node.hasChangedFlags&&(this.direction=Mn.transformQuat(qy,Wy,this._node.worldRotation))},Q(e,[{key:"direction",get:function(){return this._dir},set:function(t){Mn.normalize(this._dir,t)}},{key:"illuminance",get:function(){return h.director.root.pipeline.pipelineSceneData.isHDR?this._illuminanceHDR:this._illuminanceLDR},set:function(t){h.director.root.pipeline.pipelineSceneData.isHDR?this.illuminanceHDR=t:this.illuminanceLDR=t}},{key:"illuminanceHDR",get:function(){return this._illuminanceHDR},set:function(t){this._illuminanceHDR=t}},{key:"illuminanceLDR",get:function(){return this._illuminanceLDR},set:function(t){this._illuminanceLDR=t}},{key:"shadowEnabled",get:function(){return this._shadowEnabled},set:function(t){this._shadowEnabled=t}},{key:"shadowPcf",get:function(){return this._shadowPcf},set:function(t){this._shadowPcf=t}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t}},{key:"shadowSaturation",get:function(){return this._shadowSaturation},set:function(t){this._shadowSaturation=t}},{key:"shadowDistance",get:function(){return this._shadowDistance},set:function(t){this._shadowDistance=Math.min(t,Rg.MAX_FAR)}},{key:"shadowInvisibleOcclusionRange",get:function(){return this._shadowInvisibleOcclusionRange},set:function(t){this._shadowInvisibleOcclusionRange=Math.min(t,Rg.MAX_FAR)}},{key:"shadowFixedArea",get:function(){return this._shadowFixedArea},set:function(t){this._shadowFixedArea=t}},{key:"shadowNear",get:function(){return this._shadowNear},set:function(t){this._shadowNear=t}},{key:"shadowFar",get:function(){return this._shadowFar},set:function(t){this._shadowFar=Math.min(t,Rg.MAX_FAR)}},{key:"shadowOrthoSize",get:function(){return this._shadowOrthoSize},set:function(t){this._shadowOrthoSize=t}}]),e}(jy),Yy=function(t){$(n,t);var e=n.prototype;function n(){var e;return(e=t.call(this)||this)._needUpdate=!1,e._size=.15,e._range=1,e._luminanceHDR=0,e._luminanceLDR=0,e._pos=void 0,e._aabb=void 0,e._aabb=Qs.create(),e._pos=new Mn,e._type=Vy.SPHERE,e}return e._init=function(){t.prototype._init.call(this)},e._destroy=function(){t.prototype._destroy.call(this)},e.initialize=function(){t.prototype.initialize.call(this),this.size=.15,this.range=1,this.luminanceHDR=1700/Hy(.15),this.luminanceLDR=1},e.update=function(){if(this._node&&(this._node.hasChangedFlags||this._needUpdate)){this._node.getWorldPosition(this._pos);var t=this._range;Qs.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,t,t,t),this._needUpdate=!1}},Q(n,[{key:"position",get:function(){return this._pos}},{key:"size",get:function(){return this._size},set:function(t){this._size=t}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._needUpdate=!0}},{key:"luminance",get:function(){return h.director.root.pipeline.pipelineSceneData.isHDR?this._luminanceHDR:this._luminanceLDR},set:function(t){h.director.root.pipeline.pipelineSceneData.isHDR?this.luminanceHDR=t:this.luminanceLDR=t}},{key:"luminanceHDR",get:function(){return this._luminanceHDR},set:function(t){this._luminanceHDR=t}},{key:"luminanceLDR",set:function(t){this._luminanceLDR=t}},{key:"aabb",get:function(){return this._aabb}}]),n}(jy),Ky=new Mn(0,0,-1),Jy=new zn,Qy=new Xn,Zy=new Xn,$y=new Xn,tx=new Xn,ex=function(t){$(n,t);var e=n.prototype;function n(){var e;return(e=t.call(this)||this)._dir=new Mn(1,-1,-1),e._range=5,e._spotAngle=Math.cos(Math.PI/6),e._pos=void 0,e._aabb=void 0,e._frustum=void 0,e._angle=0,e._needUpdate=!1,e._size=.15,e._luminanceHDR=0,e._luminanceLDR=0,e._shadowEnabled=!1,e._shadowPcf=Pg.HARD,e._shadowBias=1e-5,e._shadowNormalBias=0,e._aabb=Qs.create(),e._frustum=lc.create(),e._pos=new Mn,e._type=Vy.SPOT,e}return e._init=function(){t.prototype._init.call(this)},e._destroy=function(){t.prototype._destroy.call(this)},e._setDirection=function(t){this._dir.set(t)},e.initialize=function(){t.prototype.initialize.call(this),this.size=.15,this.luminanceHDR=1700/Hy(.15),this.luminanceLDR=1,this.range=Math.cos(Math.PI/6),this._setDirection(new Mn(1,-1,-1))},e.update=function(){this._node&&(this._node.hasChangedFlags||this._needUpdate)&&(this._node.getWorldPosition(this._pos),Mn.transformQuat(this._dir,Ky,this._node.getWorldRotation(Jy)),Mn.normalize(this._dir,this._dir),Qs.set(this._aabb,this._pos.x,this._pos.y,this._pos.z,this._range,this._range,this._range),this._node.getWorldRT(Qy),Xn.invert(Qy,Qy),Xn.perspective(Zy,this._angle,1,.001,this._range),Xn.multiply($y,Zy,Qy),this._frustum.update($y,tx),this._needUpdate=!1)},Q(n,[{key:"position",get:function(){return this._pos}},{key:"size",get:function(){return this._size},set:function(t){this._size=t}},{key:"range",get:function(){return this._range},set:function(t){this._range=t,this._needUpdate=!0}},{key:"luminance",get:function(){return h.director.root.pipeline.pipelineSceneData.isHDR?this._luminanceHDR:this._luminanceLDR},set:function(t){h.director.root.pipeline.pipelineSceneData.isHDR?this.luminanceHDR=t:this.luminanceLDR=t}},{key:"luminanceHDR",get:function(){return this._luminanceHDR},set:function(t){this._luminanceHDR=t}},{key:"luminanceLDR",get:function(){return this._luminanceLDR},set:function(t){this._luminanceLDR=t}},{key:"direction",get:function(){return this._dir}},{key:"spotAngle",get:function(){return this._spotAngle},set:function(t){this._angle=t,this._spotAngle=Math.cos(.5*t),this._needUpdate=!0}},{key:"angle",get:function(){return this._angle}},{key:"aabb",get:function(){return this._aabb}},{key:"frustum",get:function(){return this._frustum}},{key:"shadowEnabled",get:function(){return this._shadowEnabled},set:function(t){this._shadowEnabled=t}},{key:"shadowPcf",get:function(){return this._shadowPcf},set:function(t){this._shadowPcf=t}},{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t}}]),n}(jy),nx=function(){function t(t){this._root=void 0,this._name="",this._cameras=[],this._models=[],this._batches=[],this._directionalLights=[],this._sphereLights=[],this._spotLights=[],this._mainLight=null,this._modelId=0,this._root=t,this._createNativeObject()}t.registerCreateFunc=function(e){e._createSceneFun=function(e){return new t(e)}};var e=t.prototype;return e.initialize=function(t){return this._name=t.name,!0},e.activate=function(){},e.update=function(t){var e=this._mainLight;e&&e.update();for(var n=this._sphereLights,i=0;i<n.length;i++)n[i].update();for(var r=this._spotLights,a=0;a<r.length;a++)r[a].update();for(var o=this._models,s=0;s<o.length;s++){var c=o[s];c.enabled&&(c.updateTransform(t),c.updateUBOs(t))}},e.destroy=function(){this.removeCameras(),this.removeSphereLights(),this.removeSpotLights(),this.removeModels(),this._destroy()},e.addCamera=function(t){t.attachToScene(this),this._cameras.push(t)},e.removeCamera=function(t){for(var e=0;e<this._cameras.length;++e)if(this._cameras[e]===t)return this._cameras.splice(e,1),void t.detachFromScene()},e.removeCameras=function(){for(var t,e=st(this._cameras);!(t=e()).done;)t.value.detachFromScene();this._cameras.splice(0)},e.setMainLight=function(t){this._mainLight=t},e.unsetMainLight=function(t){if(this._mainLight===t){var e=this._directionalLights;if(e.length)return this.setMainLight(e[e.length-1]),void(this._mainLight.node&&(this._mainLight.node.hasChangedFlags|=Fy.ROTATION));this.setMainLight(null)}},e.addDirectionalLight=function(t){t.attachToScene(this),this._directionalLights.push(t)},e.removeDirectionalLight=function(t){for(var e=0;e<this._directionalLights.length;++e)if(this._directionalLights[e]===t)return t.detachFromScene(),void this._directionalLights.splice(e,1)},e.addSphereLight=function(t){t.attachToScene(this),this._sphereLights.push(t)},e.removeSphereLight=function(t){for(var e=0;e<this._sphereLights.length;++e)if(this._sphereLights[e]===t)return t.detachFromScene(),void this._sphereLights.splice(e,1)},e.addSpotLight=function(t){t.attachToScene(this),this._spotLights.push(t)},e.removeSpotLight=function(t){for(var e=0;e<this._spotLights.length;++e)if(this._spotLights[e]===t)return t.detachFromScene(),void this._spotLights.splice(e,1)},e.removeSphereLights=function(){for(var t=0;t<this._sphereLights.length;++t)this._sphereLights[t].detachFromScene();this._sphereLights.length=0},e.removeSpotLights=function(){for(var t=0;t<this._spotLights.length;++t)this._spotLights[t].detachFromScene();this._spotLights=[]},e.addModel=function(t){t.attachToScene(this),this._models.push(t)},e.removeModel=function(t){for(var e=0;e<this._models.length;++e)if(this._models[e]===t)return t.detachFromScene(),void this._models.splice(e,1)},e.removeModels=function(){for(var t,e=st(this._models);!(t=e()).done;){var n=t.value;n.detachFromScene(),n.destroy()}this._models.length=0},e.addBatch=function(t){this._batches.push(t)},e.removeBatch=function(t){for(var e=0;e<this._batches.length;++e)if(this._batches[e]===t)return void this._batches.splice(e,1)},e.removeBatches=function(){this._batches.length=0},e.onGlobalPipelineStateChanged=function(){for(var t,e=st(this._models);!(t=e()).done;)t.value.onGlobalPipelineStateChanged()},e.generateModelId=function(){return this._modelId++},e._destroy=function(){},e._createNativeObject=function(){},Q(t,[{key:"root",get:function(){return this._root}},{key:"name",get:function(){return this._name}},{key:"cameras",get:function(){return this._cameras}},{key:"mainLight",get:function(){return this._mainLight}},{key:"sphereLights",get:function(){return this._sphereLights}},{key:"spotLights",get:function(){return this._spotLights}},{key:"models",get:function(){return this._models}},{key:"batches",get:function(){return this._batches}},{key:"native",get:function(){return this._nativeObj}}]),t}(),ix=Object.freeze({__proto__:null,get CameraFOVAxis(){return ug},get CameraProjection(){return _g},get CameraAperture(){return fg},get CameraISO(){return dg},get CameraShutter(){return pg},SKYBOX_FLAG:Cg,Camera:Eg,get ModelType(){return uy},Model:Cy,SubModel:gy,Ambient:Ty,EnvironmentLightingType:Dy,Skybox:Ry,ShadowSize:wg,ShadowType:Ig,PCFType:Pg,Shadows:Rg,FogType:Oy,Fog:By,Octree:zy,ColorTemperatureToRGB:ky,get LightType(){return Vy},nt2lm:Hy,Light:jy,DirectionalLight:Xy,SphereLight:Yy,SpotLight:ex,RenderScene:nx});function rx(t){return--t,t|=t>>16,t|=t>>8,t|=t>>4,t|=t>>2,t|=t>>1,++t}function ax(t,e){return Math.ceil(t/e)*e}!function(t){t[t.OPAQUE=0]="OPAQUE",t[t.TRANSPARENT=1]="TRANSPARENT",t[t.OVERLAY=2]="OVERLAY"}(Uy||(Uy={})),function(t){t[t.DEFAULT=1]="DEFAULT",t[t.FORWARD=2]="FORWARD",t[t.SHADOWCAST=4]="SHADOWCAST"}(Gy||(Gy={}));var ox=function(){function t(t){this._device=void 0,this._format=mi.UNKNOWN,this._formatSize=0,this._chunks=[],this._chunkCount=0,this._handles=[],this._region0=new _r,this._region1=new _r,this._region2=new _r,this._roundUpFn=null,this._bufferViewCtor=Uint8Array,this._channels=4,this._alignment=1,this._device=t}var e=t.prototype;return e.initialize=function(t){var e=aa[t.format];this._format=t.format,this._formatSize=e.size,this._channels=e.count,this._bufferViewCtor=da(e),this._roundUpFn=t.roundUpFn||null,this._alignment=t.alignment||1,t.inOrderFree&&(this.alloc=this._McDonaldAlloc)},e.destroy=function(){for(var t=0;t<this._chunkCount;++t)this._chunks[t].texture.destroy();this._chunks.length=0,this._handles.length=0},e.alloc=function(t,e){t=ax(t,this._alignment);var n=-1,i=-1;if(void 0!==e&&(n=e,i=this._findAvailableSpace(t,n)),i<0)for(var r=0;r<this._chunkCount&&(n=r,!((i=this._findAvailableSpace(t,n))>=0));++r);if(i>=0){var a=this._chunks[n];a.start+=t;var o={chunkIdx:n,start:i,end:i+t,texture:a.texture};return this._handles.push(o),o}var s=Math.sqrt(t/this._formatSize),c=this._roundUpFn&&this._roundUpFn(s,this._formatSize)||Math.max(1024,rx(s)),l=this._chunks[this.createChunk(c)];l.start+=t;var h={chunkIdx:this._chunkCount-1,start:0,end:t,texture:l.texture};return this._handles.push(h),h},e.free=function(t){for(var e=0;e<this._handles.length;++e)if(this._handles[e]===t)return this._chunks[t.chunkIdx].end=t.end,void this._handles.splice(e,1)},e.createChunk=function(t){var e=t*t*this._formatSize;C("TextureBufferPool: Allocate chunk "+this._chunkCount+", size: "+e+", format: "+this._format);var n={texture:this._device.createTexture(new br(bi.TEX2D,Ci.SAMPLED|Ci.TRANSFER_DST,this._format,t,t)),size:e,start:0,end:e};return this._chunks[this._chunkCount]=n,this._chunkCount++},e.update=function(t,e){var n=[],i=[],r=t.start/this._formatSize,a=e.byteLength/this._formatSize,o=r%t.texture.width,s=Math.floor(r/t.texture.width),c=Math.min(t.texture.width-o,a),l=0;o>0&&(this._region0.texOffset.x=o,this._region0.texOffset.y=s,this._region0.texExtent.width=c,this._region0.texExtent.height=1,n.push(new this._bufferViewCtor(e,l*this._formatSize,c*this._channels)),i.push(this._region0),o=0,s+=1,a-=c,l+=c),a>0&&(this._region1.texOffset.x=o,this._region1.texOffset.y=s,a>t.texture.width?(this._region1.texExtent.width=t.texture.width,this._region1.texExtent.height=Math.floor(a/t.texture.width),c=this._region1.texExtent.width*this._region1.texExtent.height):(c=a,this._region1.texExtent.width=c,this._region1.texExtent.height=1),n.push(new this._bufferViewCtor(e,l*this._formatSize,c*this._channels)),i.push(this._region1),o=0,s+=this._region1.texExtent.height,a-=c,l+=c),a>0&&(this._region2.texOffset.x=o,this._region2.texOffset.y=s,this._region2.texExtent.width=a,this._region2.texExtent.height=1,n.push(new this._bufferViewCtor(e,l*this._formatSize,a*this._channels)),i.push(this._region2)),this._device.copyBuffersToTexture(n,t.texture,i)},e._findAvailableSpace=function(t,e){var n=this._chunks[e],i=!1,r=n.start;if(r+t<=n.size)i=!0;else{r=0;for(var a=this._handles.filter((function(t){return t.chunkIdx===e})).sort((function(t,e){return t.start-e.start})),o=0;o<a.length;o++){var s=a[o];if(r+t<=s.start){i=!0;break}r=s.end}!i&&r+t<=n.size&&(i=!0)}return i?r:-1},e._McDonaldAlloc=function(t){t=ax(t,this._alignment);for(var e=0;e<this._chunkCount;++e){var n=this._chunks[e],i=!1,r=n.start;if(r+t<=n.end?i=!0:r>n.end?r+t<=n.size?i=!0:t<=n.end&&(n.start=r=0,i=!0):r===n.end&&(n.start=r=0,n.end=n.size,t<=n.end&&(i=!0)),i){n.start+=t;var a={chunkIdx:e,start:r,end:r+t,texture:n.texture};return this._handles.push(a),a}}var o=Math.sqrt(t/this._formatSize),s=this._roundUpFn&&this._roundUpFn(o,this._formatSize)||Math.max(1024,rx(o)),c=this._chunks[this.createChunk(s)];c.start+=t;var l={chunkIdx:this._chunkCount,start:0,end:t,texture:c.texture};return this._handles.push(l),l},t}();U(nx.prototype,"RenderScene.prototype",[{name:"raycastUI2DNode"},{name:"raycastUINode"}]),U(nx.prototype,"RenderScene.prototype",[{name:"raycastAll",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllModels",suggest:"using intersect.rayModel in geometry"},{name:"raycastSingleModel",suggest:"using intersect.rayModel in geometry"},{name:"raycastAllCanvas",suggest:"using intersect.rayAABB in geometry"},{name:"rayResultCanvas"},{name:"rayResultModels"},{name:"rayResultAll"},{name:"rayResultSingleModel"}]);var sx={};U(sx,"CameraVisFlags",[{name:"GENERAL"}]),k(sx,"CameraVisFlags",[{name:"PROFILER",newName:"PROFILER",target:Hd.BitMask,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:Hd.BitMask,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:Hd.BitMask,targetName:"EDITOR"},{name:"UI",newName:"UI",target:Hd.BitMask,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:Hd.BitMask,targetName:"UI_2D"}]),h.CameraVisFlags=sx;var cx={};U(cx,"VisibilityFlags",[{name:"GENERAL"}]),k(cx,"VisibilityFlags",[{name:"ALWALS",newName:"ALWALS",target:Hd.Enum,targetName:"ALWALS"},{name:"PROFILER",newName:"PROFILER",target:Hd.Enum,targetName:"PROFILER"},{name:"GIZMOS",newName:"GIZMOS",target:Hd.Enum,targetName:"GIZMOS"},{name:"EDITOR",newName:"EDITOR",target:Hd.Enum,targetName:"EDITOR"},{name:"UI",newName:"UI",target:Hd.Enum,targetName:"UI_3D"},{name:"UI2D",newName:"UI2D",target:Hd.Enum,targetName:"UI_2D"}]),h.VisibilityFlags=cx,k(Yv.prototype,"Pass.prototype",[{name:"getBindingTypeFromHandle",newName:"getDescriptorTypeFromHandle"}]),U(Eg.prototype,"Camera.prototype",[{name:"getSplitFrustum"},{name:"setMatView"},{name:"setMatViewInv"},{name:"setMatProjInv"},{name:"setMatViewProjInv"},{name:"setMatProj"},{name:"setMatViewProj"},{name:"getMatViewInv"}]),U(Rg.prototype,"Shadows.prototype",[{name:"aspect"},{name:"selfShadow"},{name:"linear"},{name:"packing"},{name:"autoAdapt"},{name:"fixedArea"},{name:"pcf"},{name:"bias"},{name:"normalBias"},{name:"near"},{name:"far"},{name:"shadowDistance"},{name:"invisibleOcclusionRange"},{name:"orthoSize"},{name:"saturation"}]),U(ex.prototype,"SpotLight.prototype",[{name:"aspect"}]);var lx=function(t){if(void 0===my[t]){var e=1<<py;my[t]=e,py+=1}},hx=Object.freeze({__proto__:null,addStage:lx,scene:ix,createIA:function(t,e){if(!e.positions)return console.error("The data must have positions field"),null;for(var n=[],i=e.positions.length/3,r=0;r<i;++r)n.push(e.positions[3*r],e.positions[3*r+1],e.positions[3*r+2]),e.normals&&n.push(e.normals[3*r],e.normals[3*r+1],e.normals[3*r+2]),e.uvs&&n.push(e.uvs[2*r],e.uvs[2*r+1]),e.colors&&n.push(e.colors[3*r],e.colors[3*r+1],e.colors[3*r+2]);var a=[];a.push(new Br(nr.ATTR_POSITION,mi.RGB32F)),e.normals&&a.push(new Br(nr.ATTR_NORMAL,mi.RGB32F)),e.uvs&&a.push(new Br(nr.ATTR_TEX_COORD,mi.RG32F)),e.colors&&a.push(new Br(nr.ATTR_COLOR,mi.RGB32F));var o=t.createBuffer(new gr(yi.VERTEX|yi.TRANSFER_DST,Ai.DEVICE,4*n.length,4*n.length/i));o.update(new Float32Array(n));var s=null;return e.indices&&(s=t.createBuffer(new gr(yi.INDEX|yi.TRANSFER_DST,Ai.DEVICE,2*e.indices.length,2))).update(new Uint16Array(e.indices)),t.createInputAssembler(new Fr(a,[o],s))},get RenderQueue(){return Uy},get PassStage(){return Gy},genHandle:_m,getTypeFromHandle:fm,getBindingFromHandle:dm,getCountFromHandle:pm,getOffsetFromHandle:mm,customizeType:vm,type2reader:gm,type2writer:ym,getDefaultFromType:Sm,overrideMacros:Am,get BatchingSchemes(){return Fv},Pass:Yv,getDeviceShaderVersion:Pm,programLib:Vm,nearestPOT:rx,TextureBufferPool:ox,MaterialInstance:wy,PassInstance:Ey,get PoolType(){return Rs},NULL_HANDLE:0,get NodeView(){return Ms},NodePool:Fs,get PassView(){return Ns},PassPool:Us,get AABBView(){return Vs},AABBPool:js,RenderScene:nx,NativeNode:null,NativeScene:null,NativeAABB:null,NativeModel:null,NativeSkinningModel:null,NativeBakedAnimInfo:null,NativeBakedJointInfo:null,NativeBakedSkinningModel:null,NativeLight:null,NativeDirectionalLight:null,NativeSphereLight:null,NativeSpotLight:null,NaitveSkybox:null,NativeFog:null,NativeRenderWindow:null,NativeCamera:null,NativePass:null,NativeSubModel:null,NativeDrawBatch2D:null,NativeRenderScene:null,NativeOctree:null,NativeAmbient:null,NativeShadow:null,NativeRoot:null,NativeJointTransform:null,NativeJointInfo:null,NativePipelineSharedSceneData:null,NativeGeometryRenderer:null,CameraVisFlags:sx,VisibilityFlags:cx});t("renderer",hx);var ux,_x=new Mn,fx=new Mn,dx=new Mn,px=new Mn,mx=new Mn,vx=new Mn,gx=new Mn,yx=new Mn,xx=new Mn,Sx=new Mn;!function(t){t[t.LINE=0]="LINE",t[t.DASHED_LINE=1]="DASHED_LINE",t[t.TRIANGLE=2]="TRIANGLE"}(ux||(ux={}));var Ax,bx,Cx,Tx,Ex,Ix,Px,Dx,Rx,Mx,Ox=function(){function t(){this._maxVertices=0,this._vertexCount=0,this._stride=0}var e=t.prototype;return e.init=function(t,e,n,i){this._maxVertices=e,this._vertexCount=0,this._stride=n,this._vertices=new Float32Array(e*n/Float32Array.BYTES_PER_ELEMENT),this._buffer=t.createBuffer(new gr(yi.VERTEX|yi.TRANSFER_DST,Ai.DEVICE,e*n,n)),this._inputAssembler=t.createInputAssembler(new Fr(i,[this._buffer],null))},e.empty=function(){return 0===this._vertexCount},e.reset=function(){this._vertexCount=0},e.update=function(){if(!this.empty()){var t=Math.min(this._vertexCount,this._maxVertices)*this._stride;this._buffer.update(this._vertices,t)}},e.destroy=function(){this._inputAssembler&&this._inputAssembler.destroy(),this._buffer&&this._buffer.destroy()},t}(),Nx=function(){this.lines=[],this.dashedLines=[],this.triangles=[];for(var t=0;t<2;t++)this.lines[t]=new Ox,this.dashedLines[t]=new Ox,this.triangles[t]=new Ox},Bx=function(){function t(){this._device=null,this._pipeline=null,this._buffers=void 0,this._nativeObj=null,this._buffers=new Nx}var e=t.prototype;return e.activate=function(t,e,n){this._device=t,this._pipeline=e;for(var i=[new Br(nr.ATTR_POSITION,mi.RGB32F),new Br(nr.ATTR_COLOR,mi.RGBA32F)],r=[new Br(nr.ATTR_POSITION,mi.RGB32F),new Br(nr.ATTR_NORMAL,mi.RGBA32F),new Br(nr.ATTR_COLOR,mi.RGBA32F)],a=n?n.maxLines:1e5,o=n?n.maxDashedLines:1e4,s=n?n.maxTriangles:1e4,c=Float32Array.BYTES_PER_ELEMENT*(Mn.length+Dn.length),l=Float32Array.BYTES_PER_ELEMENT*(Mn.length+ei.length+Dn.length),h=0;h<2;h++)this._buffers.lines[h].init(this._device,2*a,c,i),this._buffers.dashedLines[h].init(this._device,2*o,c,i),this._buffers.triangles[h].init(this._device,3*s,l,r)},e.flush=function(){},e.render=function(t,e){this.update();for(var n=this._pipeline.pipelineSceneData.geometryRendererPasses,i=this._pipeline.pipelineSceneData.geometryRendererShaders,r=0,a=[1,2],o=0;o<2;o++){var s=this._buffers.lines[o];if(!s.empty()){var c=new xr;c.vertexCount=s._vertexCount;for(var l=0;l<a[o];l++){var h=n[r+l],u=i[r+l],_=Kv.getOrCreatePipelineState(this._device,h,u,t,s._inputAssembler);e.bindPipelineState(_),e.bindDescriptorSet(ep.MATERIAL,h.descriptorSet),e.bindInputAssembler(s._inputAssembler),e.draw(c)}}r+=a[o]}for(var f=0;f<2;f++){var d=this._buffers.dashedLines[f];if(!d.empty()){var p=new xr;p.vertexCount=d._vertexCount;for(var m=0;m<a[f];m++){var v=n[r+m],g=i[r+m],y=Kv.getOrCreatePipelineState(this._device,v,g,t,d._inputAssembler);e.bindPipelineState(y),e.bindDescriptorSet(ep.MATERIAL,v.descriptorSet),e.bindInputAssembler(d._inputAssembler),e.draw(p)}}r+=a[f]}for(var x=0;x<2;x++){var S=this._buffers.triangles[x];if(!S.empty()){var A=new xr;A.vertexCount=S._vertexCount;for(var b=0;b<a[x];b++){var C=n[r+b],T=i[r+b],E=Kv.getOrCreatePipelineState(this._device,C,T,t,S._inputAssembler);e.bindPipelineState(E),e.bindDescriptorSet(ep.MATERIAL,C.descriptorSet),e.bindInputAssembler(S._inputAssembler),e.draw(A)}}r+=a[x]}this.reset()},e.destroy=function(){for(var t=0;t<2;t++)this._buffers.lines[t].destroy(),this._buffers.dashedLines[t].destroy(),this._buffers.triangles[t].destroy()},e.empty=function(){for(var t=0;t<2;t++)if(!this._buffers.lines[t].empty()||!this._buffers.dashedLines[t].empty()||!this._buffers.triangles[t].empty())return!1;return!0},e.update=function(){for(var t=0;t<2;t++)this._buffers.lines[t].update(),this._buffers.dashedLines[t].update(),this._buffers.triangles[t].update()},e.reset=function(){for(var t=0;t<2;t++)this._buffers.lines[t].reset(),this._buffers.dashedLines[t].reset(),this._buffers.triangles[t].reset()},e.addDashedLine=function(t,e,n,i){void 0===i&&(i=!0);var r=this._buffers.dashedLines[i?1:0];if(r._vertexCount+2>r._maxVertices)R(12008);else{var a=r._vertexCount*(Mn.length+Dn.length);Mn.toArray(r._vertices,t,a),a+=Mn.length,Dn.toArray(r._vertices,n,a),a+=Dn.length,Mn.toArray(r._vertices,e,a),a+=Mn.length,Dn.toArray(r._vertices,n,a),r._vertexCount+=2}},e.addLine=function(t,e,n,i){void 0===i&&(i=!0);var r=this._buffers.lines[i?1:0];if(r._vertexCount+2>r._maxVertices)R(12008);else{var a=r._vertexCount*(Mn.length+Dn.length);Mn.toArray(r._vertices,t,a),a+=Mn.length,Dn.toArray(r._vertices,n,a),a+=Dn.length,Mn.toArray(r._vertices,e,a),a+=Mn.length,Dn.toArray(r._vertices,n,a),r._vertexCount+=2}},e.addTriangle=function(t,e,n,i,r,a,o){if(void 0===r&&(r=!0),void 0===a&&(a=!0),void 0===o&&(o=!1),r)return this.addLine(t,e,i,a),this.addLine(e,n,i,a),void this.addLine(n,t,i,a);var s=this._buffers.triangles[a?1:0];if(s._vertexCount+3>s._maxVertices)R(12009);else{var c=new ei(ei.ZERO);if(!o){var l=new Mn(e.x-t.x,e.y-t.y,e.z-t.z),h=new Mn(n.x-t.x,n.y-t.y,n.z-t.z),u=new Mn;Mn.normalize(u,Mn.cross(u,l,h)),c.set(u.x,u.y,u.z,1)}var _=s._vertexCount*(Mn.length+ei.length+Dn.length);Mn.toArray(s._vertices,t,_),_+=Mn.length,ei.toArray(s._vertices,c,_),_+=ei.length,Dn.toArray(s._vertices,i,_),_+=Dn.length,Mn.toArray(s._vertices,e,_),_+=Mn.length,ei.toArray(s._vertices,c,_),_+=ei.length,Dn.toArray(s._vertices,i,_),_+=Dn.length,Mn.toArray(s._vertices,n,_),_+=Mn.length,ei.toArray(s._vertices,c,_),_+=ei.length,Dn.toArray(s._vertices,i,_),s._vertexCount+=3}},e.addQuad=function(t,e,n,i,r,a,o,s){void 0===a&&(a=!0),void 0===o&&(o=!0),void 0===s&&(s=!1),a?(this.addLine(t,e,r,o),this.addLine(e,n,r,o),this.addLine(n,i,r,o),this.addLine(i,t,r,o)):(this.addTriangle(t,e,n,r,a,o,s),this.addTriangle(t,n,i,r,a,o,s))},e.addBoundingBox=function(t,e,n,i,r,a,o){void 0===n&&(n=!0),void 0===i&&(i=!0),void 0===r&&(r=!1),void 0===a&&(a=!1),void 0===o&&(o=new Xn),_x.set(t.center.x-t.halfExtents.x,t.center.y-t.halfExtents.y,t.center.z-t.halfExtents.z),fx.set(t.center.x+t.halfExtents.x,t.center.y+t.halfExtents.y,t.center.z+t.halfExtents.z),dx.set(_x.x,_x.y,_x.z),px.set(fx.x,_x.y,_x.z),mx.set(_x.x,fx.y,_x.z),vx.set(fx.x,fx.y,_x.z),gx.set(_x.x,_x.y,fx.z),yx.set(fx.x,_x.y,fx.z),xx.set(_x.x,fx.y,fx.z),Sx.set(fx.x,fx.y,fx.z),a&&(Mn.transformMat4(dx,dx,o),Mn.transformMat4(px,px,o),Mn.transformMat4(mx,mx,o),Mn.transformMat4(vx,vx,o),Mn.transformMat4(gx,gx,o),Mn.transformMat4(yx,yx,o),Mn.transformMat4(xx,xx,o),Mn.transformMat4(Sx,Sx,o)),n?(this.addLine(xx,Sx,e,i),this.addLine(Sx,vx,e,i),this.addLine(vx,mx,e,i),this.addLine(mx,xx,e,i),this.addLine(gx,yx,e,i),this.addLine(yx,px,e,i),this.addLine(px,dx,e,i),this.addLine(dx,gx,e,i),this.addLine(xx,gx,e,i),this.addLine(Sx,yx,e,i),this.addLine(vx,px,e,i),this.addLine(mx,dx,e,i)):(this.addQuad(gx,yx,Sx,xx,e,n,i,r),this.addQuad(yx,px,vx,Sx,e,n,i,r),this.addQuad(px,dx,mx,vx,e,n,i,r),this.addQuad(dx,gx,xx,mx,e,n,i,r),this.addQuad(xx,Sx,vx,mx,e,n,i,r),this.addQuad(dx,px,yx,gx,e,n,i,r))},e.addCross=function(t,e,n,i){void 0===i&&(i=!0);var r=.5*e,a=new Mn(t.x-r,t.y,t.z),o=new Mn(t.x+r,t.y,t.z);this.addLine(a,o,n,i),a.set(t.x,t.y-r,t.z),o.set(t.x,t.y+r,t.z),this.addLine(a,o,n,i),a.set(t.x,t.y,t.z-r),o.set(t.x,t.y,t.z+r),this.addLine(a,o,n,i)},e.addFrustum=function(t,e,n){void 0===n&&(n=!0);var i=t.vertices;this.addLine(i[0],i[1],e,n),this.addLine(i[1],i[2],e,n),this.addLine(i[2],i[3],e,n),this.addLine(i[3],i[0],e,n),this.addLine(i[4],i[5],e,n),this.addLine(i[5],i[6],e,n),this.addLine(i[6],i[7],e,n),this.addLine(i[7],i[4],e,n),this.addLine(i[0],i[4],e,n),this.addLine(i[1],i[5],e,n),this.addLine(i[2],i[6],e,n),this.addLine(i[3],i[7],e,n)},e.addCapsule=function(t,e,n,i,r,a,o,s,c,l,h){void 0===r&&(r=32),void 0===a&&(a=8),void 0===o&&(o=!0),void 0===s&&(s=!0),void 0===c&&(c=!1),void 0===l&&(l=!1),void 0===h&&(h=new Xn);for(var u=2*Math.PI/r,_=Math.PI/2/a,f=new Mn(t.x,t.y-n/2,t.z),d=new Mn(t.x,t.y+n/2,t.z),p=new Array,m=new Array,v=0;v<a+1;v++){for(var g=new Array,y=new Array,x=v*_,S=Math.sin(x),A=Math.cos(x),b=0;b<r+1;b++){var C=b*u,T=Math.sin(C),E=Math.cos(C),w=new Mn(e*S*E,e*A,e*S*T),I=new Mn(f.x+w.x,f.y-w.y,f.z+w.z),P=new Mn(d.x+w.x,d.y+w.y,d.z+w.z);g.push(I),y.push(P)}p.push(g),m.push(y)}if(l)for(var D=0;D<a+1;D++)for(var R=0;R<r+1;R++)Mn.transformMat4(p[D][R],p[D][R],h),Mn.transformMat4(m[D][R],m[D][R],h);for(var M=0;M<a;M++)for(var O=0;O<r;O++)this.addTriangle(p[M+1][O],p[M][O+1],p[M][O],i,o,s,c),this.addTriangle(p[M+1][O],p[M+1][O+1],p[M][O+1],i,o,s,c),this.addTriangle(m[M][O],m[M+1][O+1],m[M+1][O],i,o,s,c),this.addTriangle(m[M][O],m[M][O+1],m[M+1][O+1],i,o,s,c);for(var N=p[a],B=m[a],L=0;L<r;L++)this.addTriangle(B[L],N[L+1],N[L],i,o,s,c),this.addTriangle(B[L],B[L+1],N[L+1],i,o,s,c)},e.addCylinder=function(t,e,n,i,r,a,o,s,c,l){void 0===r&&(r=32),void 0===a&&(a=!0),void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===c&&(c=!1),void 0===l&&(l=new Xn);for(var h=2*Math.PI/r,u=new Mn(t.x,t.y-n/2,t.z),_=new Mn(t.x,t.y+n/2,t.z),f=new Array,d=new Array,p=0;p<r+1;p++){var m=p*h,v=new Mn(e*Math.cos(m),0,e*Math.sin(m)),g=new Mn(v.x+u.x,v.y+u.y,v.z+u.z),y=new Mn(v.x+_.x,v.y+_.y,v.z+_.z);f.push(g),d.push(y)}if(c){Mn.transformMat4(u,u,l),Mn.transformMat4(_,_,l);for(var x=0;x<r+1;x++)Mn.transformMat4(f[x],f[x],l),Mn.transformMat4(d[x],d[x],l)}for(var S=0;S<r;S++)this.addTriangle(_,d[S+1],d[S],i,a,o,s),this.addTriangle(u,f[S],f[S+1],i,a,o,s),this.addTriangle(d[S],f[S+1],f[S],i,a,o,s),this.addTriangle(d[S],d[S+1],f[S+1],i,a,o,s)},e.addCone=function(t,e,n,i,r,a,o,s,c,l){void 0===r&&(r=32),void 0===a&&(a=!0),void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===c&&(c=!1),void 0===l&&(l=new Xn);for(var h=2*Math.PI/r,u=new Mn(t.x,t.y-n/2,t.z),_=new Mn(t.x,t.y+n/2,t.z),f=new Array,d=0;d<r+1;d++){var p=new Mn(e*Math.cos(d*h),0,e*Math.sin(d*h)),m=new Mn(p.x+u.x,p.y+u.y,p.z+u.z);f.push(m)}if(c){Mn.transformMat4(u,u,l),Mn.transformMat4(_,_,l);for(var v=0;v<r+1;v++)Mn.transformMat4(f[v],f[v],l)}for(var g=0;g<r;g++)this.addTriangle(_,f[g+1],f[g],i,a,o,s),this.addTriangle(u,f[g],f[g+1],i,a,o,s)},e.addCircle=function(t,e,n,i,r,a,o){void 0===i&&(i=32),void 0===r&&(r=!0),void 0===a&&(a=!1),void 0===o&&(o=new Xn);for(var s=2*Math.PI/i,c=new Array,l=0;l<i+1;l++){var h=new Mn(e*Math.cos(l*s),0,e*Math.sin(l*s)),u=new Mn(h.x+t.x,h.y+t.y,h.z+t.z);c.push(u)}if(a)for(var _=0;_<i+1;_++)Mn.transformMat4(c[_],c[_],o);for(var f=0;f<i;f++)this.addLine(c[f],c[f+1],n,r)},e.addArc=function(t,e,n,i,r,a,o,s,c){void 0===a&&(a=32),void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===c&&(c=new Xn);for(var l=dn(i),h=(dn(r)-l)/a,u=new Array,_=0;_<a+1;_++){var f=new Mn(e*Math.cos(_*h+l),0,e*Math.sin(_*h+l)),d=new Mn(f.x+t.x,f.y+t.y,f.z+t.z);u.push(d)}if(s)for(var p=0;p<a+1;p++)Mn.transformMat4(u[p],u[p],c);for(var m=0;m<a;m++)this.addLine(u[m],u[m+1],n,o)},e.addPolygon=function(t,e,n,i,r,a,o,s,c){void 0===i&&(i=6),void 0===r&&(r=!0),void 0===a&&(a=!0),void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===c&&(c=new Xn),r?this.addCircle(t,e,n,i,a,s,c):this.addDisc(t,e,n,i,r,a,o,s,c)},e.addDisc=function(t,e,n,i,r,a,o,s,c){void 0===i&&(i=32),void 0===r&&(r=!0),void 0===a&&(a=!0),void 0===o&&(o=!1),void 0===s&&(s=!1),void 0===c&&(c=new Xn);for(var l=2*Math.PI/i,h=new Array,u=new Mn(t),_=0;_<i+1;_++){var f=new Mn(e*Math.cos(_*l),0,e*Math.sin(_*l)),d=new Mn(f.x+u.x,f.y+u.y,f.z+u.z);h.push(d)}if(s){Mn.transformMat4(u,u,c);for(var p=0;p<i+1;p++)Mn.transformMat4(h[p],h[p],c)}for(var m=0;m<i;m++)this.addTriangle(u,h[m],h[m+1],n,r,a,o);if(!r)for(var v=0;v<i;v++)this.addTriangle(u,h[v+1],h[v],n,r,a,o)},e.addSector=function(t,e,n,i,r,a,o,s,c,l,h){void 0===a&&(a=32),void 0===o&&(o=!0),void 0===s&&(s=!0),void 0===c&&(c=!1),void 0===l&&(l=!1),void 0===h&&(h=new Xn);for(var u=dn(i),_=(dn(r)-u)/a,f=new Array,d=new Mn(t),p=0;p<a+1;p++){var m=new Mn(e*Math.cos(p*_),0,e*Math.sin(p*_)),v=new Mn(m.x+d.x,m.y+d.y,m.z+d.z);f.push(v)}if(l){Mn.transformMat4(d,d,h);for(var g=0;g<a+1;g++)Mn.transformMat4(f[g],f[g],h)}for(var y=0;y<a;y++)this.addTriangle(d,f[y],f[y+1],n,o,s,c);if(!o)for(var x=0;x<a;x++)this.addTriangle(d,f[x+1],f[x],n,o,s,c)},e.addSphere=function(t,e,n,i,r,a,o,s,c,l){void 0===i&&(i=32),void 0===r&&(r=16),void 0===a&&(a=!0),void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===c&&(c=!1),void 0===l&&(l=new Xn);for(var h=2*Math.PI/i,u=Math.PI/r,_=new Array,f=0;f<r+1;f++){for(var d=new Array,p=f*u,m=Math.sin(p),v=Math.cos(p),g=0;g<i+1;g++){var y=g*h,x=Math.sin(y),S=Math.cos(y),A=new Mn(e*m*S,e*v,e*m*x),b=new Mn(t.x+A.x,t.y+A.y,t.z+A.z);d.push(b)}_.push(d)}if(c)for(var C=0;C<r+1;C++)for(var T=0;T<i+1;T++)Mn.transformMat4(_[C][T],_[C][T],l);for(var E=0;E<r;E++)for(var w=0;w<i;w++)this.addTriangle(_[E][w],_[E+1][w+1],_[E+1][w],n,a,o,s),this.addTriangle(_[E][w],_[E][w+1],_[E+1][w+1],n,a,o,s)},e.addTorus=function(t,e,n,i,r,a,o,s,c,l,h){void 0===r&&(r=32),void 0===a&&(a=16),void 0===o&&(o=!0),void 0===s&&(s=!0),void 0===c&&(c=!1),void 0===l&&(l=!1),void 0===h&&(h=new Xn);for(var u=2*Math.PI/r,_=2*Math.PI/a,f=new Array,d=0;d<r+1;d++){for(var p=new Array,m=d*u,v=Math.sin(m),g=Math.cos(m),y=0;y<a+1;y++){var x=y*_,S=Math.sin(x),A=Math.cos(x),b=new Mn((e+n*A)*g,n*S,(e+n*A)*v),C=new Mn(t.x+b.x,t.y+b.y,t.z+b.z);p.push(C)}f.push(p)}if(l)for(var T=0;T<r+1;T++)for(var E=0;E<a+1;E++)Mn.transformMat4(f[T][E],f[T][E],h);for(var w=0;w<r;w++)for(var I=0;I<a;I++)this.addTriangle(f[w][I+1],f[w+1][I],f[w][I],i,o,s,c),this.addTriangle(f[w][I+1],f[w+1][I+1],f[w+1][I],i,o,s,c)},e.addOctahedron=function(t,e,n,i,r,a,o,s){void 0===i&&(i=!0),void 0===r&&(r=!0),void 0===a&&(a=!1),void 0===o&&(o=!1),void 0===s&&(s=new Xn);var c=new Array;if(c.push(new Mn(e+t.x,t.y,t.z)),c.push(new Mn(t.x,t.y,t.z-e)),c.push(new Mn(-e+t.x,t.y,t.z)),c.push(new Mn(t.x,t.y,t.z+e)),c.push(new Mn(t.x,t.y+e,t.z)),c.push(new Mn(t.x,t.y-e,t.z)),o)for(var l=0;l<c.length;l++)Mn.transformMat4(c[l],c[l],s);i?(this.addLine(c[0],c[1],n,r),this.addLine(c[1],c[2],n,r),this.addLine(c[2],c[3],n,r),this.addLine(c[3],c[0],n,r),this.addLine(c[0],c[4],n,r),this.addLine(c[1],c[4],n,r),this.addLine(c[2],c[4],n,r),this.addLine(c[3],c[4],n,r),this.addLine(c[0],c[5],n,r),this.addLine(c[1],c[5],n,r),this.addLine(c[2],c[5],n,r),this.addLine(c[3],c[5],n,r)):(this.addTriangle(c[0],c[1],c[4],n,i,r,a),this.addTriangle(c[1],c[2],c[4],n,i,r,a),this.addTriangle(c[2],c[3],c[4],n,i,r,a),this.addTriangle(c[3],c[0],c[4],n,i,r,a),this.addTriangle(c[0],c[3],c[5],n,i,r,a),this.addTriangle(c[3],c[2],c[5],n,i,r,a),this.addTriangle(c[2],c[1],c[5],n,i,r,a),this.addTriangle(c[1],c[0],c[5],n,i,r,a))},e.addBezier=function(t,e,n,i,r,a,o,s,c){void 0===a&&(a=32),void 0===o&&(o=!0),void 0===s&&(s=!1),void 0===c&&(c=new Xn);var l=1/a,h=new Array,u=new Mn(t),_=new Mn(e),f=new Mn(n),d=new Mn(i);s&&(Mn.transformMat4(u,u,c),Mn.transformMat4(_,_,c),Mn.transformMat4(f,f,c),Mn.transformMat4(d,d,c));for(var p=0;p<a+1;p++){var m=p*l,v=(1-m)*(1-m)*(1-m),g=3*m*(1-m)*(1-m),y=3*m*m*(1-m),x=m*m*m,S=new Mn(v*u.x+g*_.x+y*f.x+x*d.x,v*u.y+g*_.y+y*f.y+x*d.y,v*u.z+g*_.z+y*f.z+x*d.z);h.push(S)}for(var A=0;A<a;A++)this.addLine(h[A],h[A+1],r,o)},e.addMesh=function(t,e,n,i,r,a){void 0===i&&(i=!0),void 0===r&&(r=!1),void 0===a&&(a=new Xn);for(var o=0;o<e.length;o+=3){var s=new Mn(t.x+e[o].x,t.y+e[o].y,t.z+e[o].z),c=new Mn(t.x+e[o+1].x,t.y+e[o+1].y,t.z+e[o+1].z),l=new Mn(t.x+e[o+2].x,t.y+e[o+2].y,t.z+e[o+2].z);r&&(Mn.transformMat4(s,s,a),Mn.transformMat4(c,c,a),Mn.transformMat4(l,l,a)),this.addLine(s,c,n,i),this.addLine(c,l,n,i),this.addLine(l,s,n,i)}},e.addIndexedMesh=function(t,e,n,i,r,a,o){void 0===r&&(r=!0),void 0===a&&(a=!1),void 0===o&&(o=new Xn);for(var s=0;s<n.length;s+=3){var c=new Mn(t.x+e[n[s]].x,t.y+e[n[s]].y,t.z+e[n[s]].z),l=new Mn(t.x+e[n[s+1]].x,t.y+e[n[s+1]].y,t.z+e[n[s+1]].z),h=new Mn(t.x+e[n[s+2]].x,t.y+e[n[s+2]].y,t.z+e[n[s+2]].z);a&&(Mn.transformMat4(c,c,o),Mn.transformMat4(l,l,o),Mn.transformMat4(h,h,o)),this.addLine(c,l,i,r),this.addLine(l,h,i,r),this.addLine(h,c,i,r)}},Q(t,[{key:"native",get:function(){return this._nativeObj}}]),t}(),Lx=new Xn,Fx=new Xn,Vx=new Xn,zx=new ei,kx=new ei(0,0,1,0),Ux=function(){function t(){this._globalUBO=new Float32Array(op.COUNT),this._cameraUBO=new Float32Array(sp.COUNT),this._shadowUBO=new Float32Array(cp.COUNT)}t.updateGlobalUBOView=function(t,e){var n=h.director.root,i=e,r=Math.floor(t.width),a=Math.floor(t.height);i[op.TIME_OFFSET]=n.cumulativeTime,i[op.TIME_OFFSET+1]=n.frameTime,i[op.TIME_OFFSET+2]=h.director.getTotalFrames(),i[op.SCREEN_SIZE_OFFSET]=r,i[op.SCREEN_SIZE_OFFSET+1]=a,i[op.SCREEN_SIZE_OFFSET+2]=1/r,i[op.SCREEN_SIZE_OFFSET+3]=1/a,i[op.NATIVE_SIZE_OFFSET]=r,i[op.NATIVE_SIZE_OFFSET+1]=a,i[op.NATIVE_SIZE_OFFSET+2]=1/i[op.NATIVE_SIZE_OFFSET],i[op.NATIVE_SIZE_OFFSET+3]=1/i[op.NATIVE_SIZE_OFFSET+1]},t.updateCameraUBOView=function(t,e,n){var i,r=(n.scene?n.scene:h.director.getScene().renderScene).mainLight,a=t.pipelineSceneData,o=a.ambient,s=a.skybox,c=a.fog,l=a.shadows,u=e,_=n.exposure,f=a.isHDR;if(u[sp.SCREEN_SCALE_OFFSET]=a.shadingScale,u[sp.SCREEN_SCALE_OFFSET+1]=a.shadingScale,u[sp.SCREEN_SCALE_OFFSET+2]=1/u[sp.SCREEN_SCALE_OFFSET],u[sp.SCREEN_SCALE_OFFSET+3]=1/u[sp.SCREEN_SCALE_OFFSET+1],u[sp.EXPOSURE_OFFSET]=_,u[sp.EXPOSURE_OFFSET+1]=1/_,u[sp.EXPOSURE_OFFSET+2]=f?1:0,u[sp.EXPOSURE_OFFSET+3]=1/Eg.standardExposureValue,r){var d=r.shadowEnabled&&l.type===Ig.ShadowMap?1:0,p=r.direction;if(kx.set(p.x,p.y,p.z,d),ei.toArray(u,kx,sp.MAIN_LIT_DIR_OFFSET),Mn.toArray(u,r.color,sp.MAIN_LIT_COLOR_OFFSET),r.useColorTemperature){var m=r.colorTemperatureRGB;u[sp.MAIN_LIT_COLOR_OFFSET]*=m.x,u[sp.MAIN_LIT_COLOR_OFFSET+1]*=m.y,u[sp.MAIN_LIT_COLOR_OFFSET+2]*=m.z}u[sp.MAIN_LIT_COLOR_OFFSET+3]=f?r.illuminance*_:r.illuminance}else kx.set(0,0,1,0),ei.toArray(u,kx,sp.MAIN_LIT_DIR_OFFSET),ei.toArray(u,ei.ZERO,sp.MAIN_LIT_COLOR_OFFSET);var v=o.skyColor;v.w=f?o.skyIllum*_:o.skyIllum,u[sp.AMBIENT_SKY_OFFSET+0]=v.x,u[sp.AMBIENT_SKY_OFFSET+1]=v.y,u[sp.AMBIENT_SKY_OFFSET+2]=v.z,u[sp.AMBIENT_SKY_OFFSET+3]=v.w,u[sp.AMBIENT_GROUND_OFFSET+0]=o.groundAlbedo.x,u[sp.AMBIENT_GROUND_OFFSET+1]=o.groundAlbedo.y,u[sp.AMBIENT_GROUND_OFFSET+2]=o.groundAlbedo.z,u[sp.AMBIENT_GROUND_OFFSET+3]=s.envmap?null===(i=s.envmap)||void 0===i?void 0:i.mipmapLevel:1,Xn.toArray(u,n.matView,sp.MAT_VIEW_OFFSET),Xn.toArray(u,n.node.worldMatrix,sp.MAT_VIEW_INV_OFFSET),Mn.toArray(u,n.position,sp.CAMERA_POS_OFFSET),Xn.toArray(u,n.matProj,sp.MAT_PROJ_OFFSET),Xn.toArray(u,n.matProjInv,sp.MAT_PROJ_INV_OFFSET),Xn.toArray(u,n.matViewProj,sp.MAT_VIEW_PROJ_OFFSET),Xn.toArray(u,n.matViewProjInv,sp.MAT_VIEW_PROJ_INV_OFFSET),u[sp.CAMERA_POS_OFFSET+3]=this.getCombineSignY();var g=c.colorArray;u[sp.GLOBAL_FOG_COLOR_OFFSET]=g.x,u[sp.GLOBAL_FOG_COLOR_OFFSET+1]=g.y,u[sp.GLOBAL_FOG_COLOR_OFFSET+2]=g.z,u[sp.GLOBAL_FOG_COLOR_OFFSET+3]=g.z,u[sp.GLOBAL_FOG_BASE_OFFSET]=c.fogStart,u[sp.GLOBAL_FOG_BASE_OFFSET+1]=c.fogEnd,u[sp.GLOBAL_FOG_BASE_OFFSET+2]=c.fogDensity,u[sp.GLOBAL_FOG_ADD_OFFSET]=c.fogTop,u[sp.GLOBAL_FOG_ADD_OFFSET+1]=c.fogRange,u[sp.GLOBAL_FOG_ADD_OFFSET+2]=c.fogAtten,u[sp.NEAR_FAR_OFFSET]=n.nearClip,u[sp.NEAR_FAR_OFFSET+1]=n.farClip,u[sp.VIEW_PORT_OFFSET]=a.shadingScale*n.window.width*n.viewport.x,u[sp.VIEW_PORT_OFFSET+1]=a.shadingScale*n.window.height*n.viewport.y,u[sp.VIEW_PORT_OFFSET+2]=a.shadingScale*n.window.width*n.viewport.z,u[sp.VIEW_PORT_OFFSET+3]=a.shadingScale*n.window.height*n.viewport.w},t.updateShadowUBOView=function(t,e,n){var i=t.device,r=n.scene.mainLight,a=t.pipelineSceneData.shadows,o=e;if(a.enabled){if(r&&r.shadowEnabled&&a.type===Ig.ShadowMap){var s=.1,c=0,l=a.matShadowView,h=a.matShadowProj,u=a.matShadowViewProj;r.shadowFixedArea?(s=r.shadowNear,c=r.shadowFar):(s=.1,c=a.shadowCameraFar),Xn.toArray(e,l,cp.MAT_LIGHT_VIEW_OFFSET),o[cp.SHADOW_PROJ_DEPTH_INFO_OFFSET+0]=h.m10,o[cp.SHADOW_PROJ_DEPTH_INFO_OFFSET+1]=h.m14,o[cp.SHADOW_PROJ_DEPTH_INFO_OFFSET+2]=h.m11,o[cp.SHADOW_PROJ_DEPTH_INFO_OFFSET+3]=h.m15,o[cp.SHADOW_PROJ_INFO_OFFSET+0]=h.m00,o[cp.SHADOW_PROJ_INFO_OFFSET+1]=h.m05,o[cp.SHADOW_PROJ_INFO_OFFSET+2]=1/h.m00,o[cp.SHADOW_PROJ_INFO_OFFSET+3]=1/h.m05,Xn.toArray(e,u,cp.MAT_LIGHT_VIEW_PROJ_OFFSET);var _=cm(i)?0:1;o[cp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+0]=s,o[cp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+1]=c,o[cp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+2]=0,o[cp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+3]=1-r.shadowSaturation,o[cp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=a.size.x,o[cp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=a.size.y,o[cp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=r.shadowPcf,o[cp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=r.shadowBias,o[cp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=0,o[cp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=_,o[cp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=r.shadowNormalBias,o[cp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0}else r&&a.type===Ig.Planar&&(sy(a,r,o),cy(a,o));Dn.toArray(o,a.shadowColor,cp.SHADOW_COLOR_OFFSET)}},t.updateShadowUBOLightView=function(t,e,n){var i=t.device,r=t.pipelineSceneData.shadows,a=e,o=cm(i)?0:1,s=.1,c=0,l=r.matShadowView,h=r.matShadowProj,u=r.matShadowViewProj;switch(n.type){case Vy.DIRECTIONAL:var _=n;_.shadowFixedArea?(s=_.shadowNear,c=_.shadowFar):(s=.1,c=r.shadowCameraFar),Xn.toArray(e,l,cp.MAT_LIGHT_VIEW_OFFSET),a[cp.SHADOW_PROJ_DEPTH_INFO_OFFSET+0]=h.m10,a[cp.SHADOW_PROJ_DEPTH_INFO_OFFSET+1]=h.m14,a[cp.SHADOW_PROJ_DEPTH_INFO_OFFSET+2]=h.m11,a[cp.SHADOW_PROJ_DEPTH_INFO_OFFSET+3]=h.m15,a[cp.SHADOW_PROJ_INFO_OFFSET+0]=h.m00,a[cp.SHADOW_PROJ_INFO_OFFSET+1]=h.m05,a[cp.SHADOW_PROJ_INFO_OFFSET+2]=1/h.m00,a[cp.SHADOW_PROJ_INFO_OFFSET+3]=1/h.m05,Xn.toArray(e,u,cp.MAT_LIGHT_VIEW_PROJ_OFFSET),zx.set(s,c,0,1-_.shadowSaturation),ei.toArray(a,zx,cp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET),zx.set(0,o,_.shadowNormalBias,0),ei.toArray(a,zx,cp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET),zx.set(r.size.x,r.size.y,_.shadowPcf,_.shadowBias),ei.toArray(a,zx,cp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET);break;case Vy.SPOT:var f=n;Xn.invert(Lx,n.node.getWorldMatrix()),Xn.toArray(a,Lx,cp.MAT_LIGHT_VIEW_OFFSET),Xn.perspective(Fx,n.angle,1,.001,n.range),Xn.multiply(Vx,Fx,Lx),Xn.toArray(a,Vx,cp.MAT_LIGHT_VIEW_PROJ_OFFSET),zx.set(.01,n.range,0,0),ei.toArray(a,zx,cp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET),zx.set(1,o,f.shadowNormalBias,0),ei.toArray(a,zx,cp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET),zx.set(r.size.x,r.size.y,f.shadowPcf,f.shadowBias),ei.toArray(a,zx,cp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET)}Dn.toArray(a,r.shadowColor,cp.SHADOW_COLOR_OFFSET)},t.getCombineSignY=function(){return t._combineSignY};var e=t.prototype;return e._initCombineSignY=function(){var e=this._device;t._combineSignY=.5*e.capabilities.screenSpaceSignY+.5<<1|.5*e.capabilities.clipSpaceSignY+.5},e.activate=function(t,e){this._device=t,this._pipeline=e;var n=this._pipeline.descriptorSet;this._initCombineSignY();var i=t.createBuffer(new gr(yi.UNIFORM|yi.TRANSFER_DST,Ai.HOST|Ai.DEVICE,op.SIZE,op.SIZE));n.bindBuffer(op.BINDING,i);var r=t.createBuffer(new gr(yi.UNIFORM|yi.TRANSFER_DST,Ai.HOST|Ai.DEVICE,sp.SIZE,sp.SIZE));n.bindBuffer(sp.BINDING,r);var a=t.createBuffer(new gr(yi.UNIFORM|yi.TRANSFER_DST,Ai.HOST|Ai.DEVICE,cp.SIZE,cp.SIZE));n.bindBuffer(cp.BINDING,a)},e.updateGlobalUBO=function(e){var n=this._pipeline.globalDSManager,i=this._pipeline.descriptorSet,r=this._pipeline.commandBuffers;i.update(),t.updateGlobalUBOView(e,this._globalUBO),r[0].updateBuffer(i.getBuffer(op.BINDING),this._globalUBO),n.bindBuffer(op.BINDING,i.getBuffer(op.BINDING)),n.update()},e.updateCameraUBO=function(e){var n=this._pipeline.globalDSManager,i=this._pipeline.descriptorSet,r=this._pipeline.commandBuffers;t.updateCameraUBOView(this._pipeline,this._cameraUBO,e),r[0].updateBuffer(i.getBuffer(sp.BINDING),this._cameraUBO),n.bindBuffer(sp.BINDING,i.getBuffer(sp.BINDING)),n.update()},e.updateShadowUBO=function(e){var n=this._pipeline.pipelineSceneData;if(n.shadows.enabled){var i=this._pipeline.descriptorSet,r=this._pipeline.commandBuffers,a=n.shadowFrameBufferMap,o=e.scene.mainLight;o&&a.has(o)&&i.bindTexture(lp,a.get(o).colorTextures[0]),t.updateShadowUBOView(this._pipeline,this._shadowUBO,e),i.update(),r[0].updateBuffer(i.getBuffer(cp.BINDING),this._shadowUBO)}},e.updateShadowUBOLight=function(e,n){t.updateShadowUBOLightView(this._pipeline,this._shadowUBO,n),e.bindTexture(lp,Uv.get("default-texture").getGFXTexture()),e.bindTexture(gp,Uv.get("default-texture").getGFXTexture()),e.update(),e.getBuffer(cp.BINDING).update(this._shadowUBO)},e.updateShadowUBORange=function(t,e){e instanceof Xn?Xn.toArray(this._shadowUBO,e,t):e instanceof Dn&&Dn.toArray(this._shadowUBO,e,t)},e.destroy=function(){},t}();Ux._combineSignY=0;var Gx,Hx,jx,Wx,qx,Xx,Yx,Kx,Jx,Qx,Zx,$x,tS,eS=t("RenderStage",(Ax=Ec("RenderStage"),bx=el(),Cx=el(),Tx=el(),Ax((Mx=function(){function t(){ct(this,"_name",Px,this),ct(this,"_priority",Dx,this),this._enabled=!0,ct(this,"_tag",Rx,this)}var e=t.prototype;return e.initialize=function(t){return this._name=t.name,this._priority=t.priority,t.tag&&(this._tag=t.tag),!0},e.activate=function(t,e){this._pipeline=t,this._flow=e},Q(t,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled=t}}]),t}(),Px=lt((Ix=Mx).prototype,"_name",[bx,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Dx=lt(Ix.prototype,"_priority",[Cx,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Rx=lt(Ix.prototype,"_tag",[Tx,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ex=Ix))||Ex));h.RenderStage=eS;var nS,iS=t("RenderFlow",(Gx=Ec("RenderFlow"),Hx=el(),jx=el(),Wx=el(),qx=el(),Xx=cl([eS]),Gx((tS=function(){function t(){ct(this,"_name",Jx,this),ct(this,"_priority",Qx,this),ct(this,"_tag",Zx,this),ct(this,"_stages",$x,this)}var e=t.prototype;return e.initialize=function(t){return this._name=t.name,this._priority=t.priority,this._stages=t.stages,t.tag&&(this._tag=t.tag),!0},e.activate=function(t){this._pipeline=t,this._stages.sort((function(t,e){return t.priority-e.priority}));for(var e=0,n=this._stages.length;e<n;e++)this._stages[e].activate(t,this)},e.render=function(t){for(var e=0,n=this._stages.length;e<n;e++)this._stages[e].enabled&&this._stages[e].render(t)},e.destroy=function(){for(var t=0,e=this._stages.length;t<e;t++)this._stages[t].destroy();this._stages.length=0},Q(t,[{key:"name",get:function(){return this._name}},{key:"priority",get:function(){return this._priority}},{key:"tag",get:function(){return this._tag}},{key:"stages",get:function(){return this._stages}},{key:"pipeline",get:function(){return this._pipeline}}]),t}(),Jx=lt((Kx=tS).prototype,"_name",[Hx,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Qx=lt(Kx.prototype,"_priority",[jx,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Zx=lt(Kx.prototype,"_tag",[Wx,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$x=lt(Kx.prototype,"_stages",[qx,Xx,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Yx=Kx))||Yx));h.RenderFlow=iS,function(t){t.RENDER_FRAME_BEGIN="render-frame-begin",t.RENDER_FRAME_END="render-frame-end",t.RENDER_CAMERA_BEGIN="render-camera-begin",t.RENDER_CAMERA_END="render-camera-end",t.ATTACHMENT_SCALE_CAHNGED="attachment-scale-changed"}(nS||(nS=t("PipelineEventType",{})));var rS,aS,oS,sS,cS,lS,hS,uS,_S,fS,dS,pS,mS,vS,gS,yS=t("PipelineEventProcessor",function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).eventTargetOn=t.prototype.on,e.eventTargetOnce=t.prototype.once,e}$(e,t);var n=e.prototype;return n.on=function(t,e,n,i){return this.eventTargetOn(t,e,n,i)},n.once=function(t,e,n){return this.eventTargetOnce(t,e,n)},e}(uh)),xS=new or,SS=new fr,AS=function(){this.renderPass=null,this.sampler=null,this.prefiterTex=null,this.downsampleTexs=[],this.upsampleTexs=[],this.combineTex=null,this.prefilterFramebuffer=null,this.downsampleFramebuffers=[],this.upsampleFramebuffers=[],this.combineFramebuffer=null},bS=function(){this.quadIB=null,this.quadVB=null,this.quadIA=null},CS=t("RenderPipeline",(rS=Ec("cc.RenderPipeline"),aS=el(),oS=el(),sS=cl([iS]),rS((_S=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_tag",hS,at(e)),ct(e,"_flows",uS,at(e)),e._quadIB=null,e._quadVBOnscreen=null,e._quadVBOffscreen=null,e._quadIAOnscreen=null,e._quadIAOffscreen=null,e._eventProcessor=new yS,e._commandBuffers=[],e._pipelineUBO=new Ux,e._macros={},e._constantMacros="",e._profiler=null,e._geometryRenderer=new Bx,e._pipelineRenderData=null,e._renderPasses=new Map,e._width=0,e._height=0,e._lastUsedRenderArea=new or,e._clusterEnabled=!1,e._bloomEnabled=!1,e}$(e,t);var n=e.prototype;return n.getPipelineRenderData=function(){return this._pipelineRenderData},n.initialize=function(t){return this._flows=t.flows,t.tag&&(this._tag=t.tag),!0},n.createRenderPass=function(t,e,n){var i=this._device,r=new Vr,a=new zr;r.format=e,a.format=n,a.stencilStoreOp=Vi.DISCARD,a.depthStoreOp=Vi.DISCARD,t&Zi.COLOR||(t&Cg?r.loadOp=Fi.DISCARD:(r.loadOp=Fi.LOAD,r.barrier=i.getGeneralBarrier(new Hr(zi.COLOR_ATTACHMENT_WRITE,zi.COLOR_ATTACHMENT_WRITE)))),(t&Zi.DEPTH_STENCIL)!==Zi.DEPTH_STENCIL&&(t&Zi.DEPTH||(a.depthLoadOp=Fi.LOAD),t&Zi.STENCIL||(a.stencilLoadOp=Fi.LOAD)),a.barrier=i.getGeneralBarrier(new Hr(zi.DEPTH_STENCIL_ATTACHMENT_WRITE,zi.DEPTH_STENCIL_ATTACHMENT_WRITE));var o=new Gr([r],a);return i.createRenderPass(o)},n.getRenderPass=function(t,e){var n=this._renderPasses.get(t);return n||(n=this.createRenderPass(t,e.colorTextures[0].format,e.depthStencilTexture.format),this._renderPasses.set(t,n),n)},n.applyFramebufferRatio=function(t){for(var e=this.pipelineSceneData,n=this._width*e.shadingScale,i=this._height*e.shadingScale,r=t.colorTextures,a=0;a<r.length;a++)r[a].resize(n,i);t.depthStencilTexture&&t.depthStencilTexture.resize(n,i),t.destroy(),t.initialize(new Wr(t.renderPass,r,t.depthStencilTexture))},n.generateRenderArea=function(t,e){var n=t.viewport,i=t.window.width,r=t.window.height;e.x=n.x*i,e.y=n.y*r,e.width=n.width*i,e.height=n.height*r},n.generateViewport=function(t,e){this.generateRenderArea(t,xS),e||(e=SS);var n=this.pipelineSceneData.shadingScale;return e.left=xS.x*n,e.top=xS.y*n,e.width=xS.width*n,e.height=xS.height*n,e},n.generateScissor=function(t,e){e||(e=xS),this.generateRenderArea(t,e);var n=this.pipelineSceneData.shadingScale;return e.x*=n,e.y*=n,e.width*=n,e.height*=n,e},n.activate=function(){var t=h.director.root;this._device=t.device,this._generateConstantMacros(),this._globalDSManager=new dy(this),this._descriptorSet=this._globalDSManager.globalDescriptorSet,this._pipelineUBO.activate(this._device,this),this._macros.CC_USE_HDR=this._pipelineSceneData.isHDR,this._generateConstantMacros(),this._pipelineSceneData.activate(this._device,this),this._geometryRenderer.activate(this._device,this);for(var e=0;e<this._flows.length;e++)this._flows[e].activate(this);return!0},n._ensureEnoughSize=function(){},n.render=function(t){if(0!==t.length){this._commandBuffers[0].begin(),this.emit(nS.RENDER_FRAME_BEGIN,t),this._ensureEnoughSize(t),function(t){for(var e=t.length-1;e>=0;--e){var n=t[e];if(n.window.swapchain)return void(lg=n)}lg=null}(t);for(var e=0;e<t.length;e++){var n=t[e];if(n.scene){this.emit(nS.RENDER_CAMERA_BEGIN,n),ly(this,n),hy(this,n),this._pipelineUBO.updateGlobalUBO(n.window),this._pipelineUBO.updateCameraUBO(n);for(var i=0;i<this._flows.length;i++)this._flows[i].render(n);this.emit(nS.RENDER_CAMERA_END,n)}}this.emit(nS.RENDER_FRAME_END,t),this._commandBuffers[0].end(),this._device.queue.submit(this._commandBuffers)}},n._destroyQuadInputAssembler=function(){this._quadIB&&(this._quadIB.destroy(),this._quadIB=null),this._quadVBOnscreen&&(this._quadVBOnscreen.destroy(),this._quadVBOnscreen=null),this._quadVBOffscreen&&(this._quadVBOffscreen.destroy(),this._quadVBOffscreen=null),this._quadIAOnscreen&&(this._quadIAOnscreen.destroy(),this._quadIAOnscreen=null),this._quadIAOffscreen&&(this._quadIAOffscreen.destroy(),this._quadIAOffscreen=null)},n._destroyBloomData=function(){var t,e=this._pipelineRenderData.bloom;if(null!==e){e.prefiterTex&&e.prefiterTex.destroy(),e.prefilterFramebuffer&&e.prefilterFramebuffer.destroy();for(var n=0;n<e.downsampleTexs.length;++n)e.downsampleTexs[n].destroy(),e.downsampleFramebuffers[n].destroy();e.downsampleTexs.length=0,e.downsampleFramebuffers.length=0;for(var i=0;i<e.upsampleTexs.length;++i)e.upsampleTexs[i].destroy(),e.upsampleFramebuffers[i].destroy();e.upsampleTexs.length=0,e.upsampleFramebuffers.length=0,e.combineTex&&e.combineTex.destroy(),e.combineFramebuffer&&e.combineFramebuffer.destroy(),null===(t=e.renderPass)||void 0===t||t.destroy(),this._pipelineRenderData.bloom=null}},n._genQuadVertexData=function(t,e){var n=new Float32Array(16),i=e.x/this._width,r=(e.x+e.width)/this._width,a=e.y/this._height,o=(e.y+e.height)/this._height;if(this.device.capabilities.screenSpaceSignY>0){var s=o;o=a,a=s}var c=0;switch(t){case di.IDENTITY:c=0,n[c++]=-1,n[c++]=-1,n[c++]=i,n[c++]=o,n[c++]=1,n[c++]=-1,n[c++]=r,n[c++]=o,n[c++]=-1,n[c++]=1,n[c++]=i,n[c++]=a,n[c++]=1,n[c++]=1,n[c++]=r,n[c++]=a;break;case di.ROTATE_90:c=0,n[c++]=-1,n[c++]=-1,n[c++]=r,n[c++]=o,n[c++]=1,n[c++]=-1,n[c++]=r,n[c++]=a,n[c++]=-1,n[c++]=1,n[c++]=i,n[c++]=o,n[c++]=1,n[c++]=1,n[c++]=i,n[c++]=a;break;case di.ROTATE_180:c=0,n[c++]=-1,n[c++]=-1,n[c++]=i,n[c++]=a,n[c++]=1,n[c++]=-1,n[c++]=r,n[c++]=a,n[c++]=-1,n[c++]=1,n[c++]=i,n[c++]=o,n[c++]=1,n[c++]=1,n[c++]=r,n[c++]=o;break;case di.ROTATE_270:c=0,n[c++]=-1,n[c++]=-1,n[c++]=i,n[c++]=a,n[c++]=1,n[c++]=-1,n[c++]=i,n[c++]=o,n[c++]=-1,n[c++]=1,n[c++]=r,n[c++]=a,n[c++]=1,n[c++]=1,n[c++]=r,n[c++]=o}return n},n._createQuadInputAssembler=function(){var t=new bS,e=4*Float32Array.BYTES_PER_ELEMENT,n=4*e,i=this._device.createBuffer(new gr(yi.VERTEX|yi.TRANSFER_DST,Ai.DEVICE|Ai.HOST,n,e));if(!i)return t;var r=Uint8Array.BYTES_PER_ELEMENT,a=6*r,o=this._device.createBuffer(new gr(yi.INDEX|yi.TRANSFER_DST,Ai.DEVICE,a,r));if(!o)return t;var s=new Uint8Array(6);s[0]=0,s[1]=1,s[2]=2,s[3]=1,s[4]=3,s[5]=2,o.update(s);var c=new Array(2);c[0]=new Br("a_position",mi.RG32F),c[1]=new Br("a_texCoord",mi.RG32F);var l=this._device.createInputAssembler(new Fr(c,[i],o));return t.quadIB=o,t.quadVB=i,t.quadIA=l,t},n.updateQuadVertexData=function(t,e){var n=this._lastUsedRenderArea;if(n.x!==t.x||n.y!==t.y||n.width!==t.width||n.height!==t.height){var i=this._genQuadVertexData(di.IDENTITY,t);this._quadVBOffscreen.update(i);var r=this._genQuadVertexData(e.swapchain&&e.swapchain.surfaceTransform||di.IDENTITY,t);this._quadVBOnscreen.update(r),n.copy(t)}},n.destroy=function(){for(var e,n,i=0;i<this._flows.length;i++)this._flows[i].destroy();this._flows.length=0,this._descriptorSet&&this._descriptorSet.destroy(),null===(e=this._globalDSManager)||void 0===e||e.destroy();for(var r=0;r<this._commandBuffers.length;r++)this._commandBuffers[r].destroy();return this._commandBuffers.length=0,this._pipelineUBO.destroy(),null===(n=this._pipelineSceneData)||void 0===n||n.destroy(),this._geometryRenderer.destroy(),t.prototype.destroy.call(this)},n._generateConstantMacros=function(){var t="";t+="#define CC_DEVICE_SUPPORT_FLOAT_TEXTURE "+(this.device.getFormatFeatures(mi.RGBA32F)&(Ei.RENDER_TARGET|Ei.SAMPLED_TEXTURE)?1:0)+"\n",t+="#define CC_ENABLE_CLUSTERED_LIGHT_CULLING "+(this._clusterEnabled?1:0)+"\n",t+="#define CC_DEVICE_MAX_VERTEX_UNIFORM_VECTORS "+this.device.capabilities.maxVertexUniformVectors+"\n",t+="#define CC_DEVICE_MAX_FRAGMENT_UNIFORM_VECTORS "+this.device.capabilities.maxFragmentUniformVectors+"\n",t+="#define CC_DEVICE_CAN_BENEFIT_FROM_INPUT_ATTACHMENT "+(this.device.hasFeature(pi.INPUT_ATTACHMENT_BENEFIT)?1:0)+"\n",t+="#define CC_PLATFORM_ANDROID_AND_WEBGL "+(Lh.os===Ch.ANDROID&&Lh.isBrowser?1:0)+"\n",t+="#define CC_ENABLE_WEBGL_HIGHP_STRUCT_VALUES "+(_e.ENABLE_WEBGL_HIGHP_STRUCT_VALUES?1:0)+"\n",this._constantMacros=t},n.generateBloomRenderData=function(){if(null==this._pipelineRenderData.bloom){var t=this._pipelineRenderData.bloom=new AS,e=this.device,n=new Vr;n.format=mi.RGBA8,n.loadOp=Fi.CLEAR,n.storeOp=Vi.STORE,n.barrier=e.getGeneralBarrier(new Hr(zi.NONE,zi.COLOR_ATTACHMENT_WRITE)),t.renderPass=e.createRenderPass(new Gr([n]));var i=this._width,r=this._height;t.prefiterTex=e.createTexture(new br(bi.TEX2D,Ci.COLOR_ATTACHMENT|Ci.SAMPLED,mi.RGBA8,i>>1,r>>1)),t.prefilterFramebuffer=e.createFramebuffer(new Wr(t.renderPass,[t.prefiterTex])),i>>=1,r>>=1;for(var a=0;a<6;++a)t.downsampleTexs.push(e.createTexture(new br(bi.TEX2D,Ci.COLOR_ATTACHMENT|Ci.SAMPLED,mi.RGBA8,i>>1,r>>1))),t.downsampleFramebuffers[a]=e.createFramebuffer(new Wr(t.renderPass,[t.downsampleTexs[a]])),t.upsampleTexs.push(e.createTexture(new br(bi.TEX2D,Ci.COLOR_ATTACHMENT|Ci.SAMPLED,mi.RGBA8,i,r))),t.upsampleFramebuffers[a]=e.createFramebuffer(new Wr(t.renderPass,[t.upsampleTexs[a]])),i>>=1,r>>=1;t.combineTex=e.createTexture(new br(bi.TEX2D,Ci.COLOR_ATTACHMENT|Ci.SAMPLED,mi.RGBA8,this._width,this._height)),t.combineFramebuffer=e.createFramebuffer(new Wr(t.renderPass,[t.combineTex])),t.sampler=this.globalDSManager.linearSampler}},n.on=function(t,e,n,i){return this._eventProcessor.on(t,e,n,i)},n.once=function(t,e,n){return this._eventProcessor.once(t,e,n)},n.off=function(t,e,n){this._eventProcessor.off(t,e,n)},n.emit=function(t,e,n,i,r,a){this._eventProcessor.emit(t,e,n,i,r,a)},n.targetOff=function(t){this._eventProcessor.targetOff(t)},n.removeAll=function(t){this._eventProcessor.removeAll(t)},n.hasEventListener=function(t,e,n){return this._eventProcessor.hasEventListener(t,e,n)},Q(e,[{key:"tag",get:function(){return this._tag}},{key:"flows",get:function(){return this._flows}},{key:"quadIAOnscreen",get:function(){return this._quadIAOnscreen}},{key:"quadIAOffscreen",get:function(){return this._quadIAOffscreen}},{key:"constantMacros",get:function(){return this._constantMacros}},{key:"macros",get:function(){return this._macros}},{key:"device",get:function(){return this._device}},{key:"globalDSManager",get:function(){return this._globalDSManager}},{key:"descriptorSetLayout",get:function(){return this._globalDSManager.descriptorSetLayout}},{key:"descriptorSet",get:function(){return this._descriptorSet}},{key:"commandBuffers",get:function(){return this._commandBuffers}},{key:"pipelineUBO",get:function(){return this._pipelineUBO}},{key:"pipelineSceneData",get:function(){return this._pipelineSceneData}},{key:"profiler",get:function(){return this._profiler},set:function(t){this._profiler=t}},{key:"geometryRenderer",get:function(){return this._geometryRenderer}},{key:"clusterEnabled",get:function(){return this._clusterEnabled},set:function(t){this._clusterEnabled=t}},{key:"bloomEnabled",get:function(){return this._bloomEnabled},set:function(t){this._bloomEnabled=t}}]),e}($h),hS=lt((lS=_S).prototype,"_tag",[aS,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),uS=lt(lS.prototype,"_flows",[oS,sS,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cS=lS))||cS));h.RenderPipeline=CS,function(t){t[t.BLOOM=18]="BLOOM",t[t.POST_PROCESS=19]="POST_PROCESS",t[t.UI=20]="UI"}(fS||(fS={})),function(t){t[t.FORWARD=10]="FORWARD"}(dS||(dS={})),function(t){t[t.SHADOW=0]="SHADOW",t[t.FORWARD=1]="FORWARD",t[t.UI=10]="UI"}(pS||(pS={})),function(t){t[t.GBUFFER=10]="GBUFFER",t[t.LIGHTING=15]="LIGHTING",t[t.TRANSPARENT=18]="TRANSPARENT"}(mS||(mS={})),function(t){t[t.SHADOW=0]="SHADOW",t[t.MAIN=1]="MAIN",t[t.UI=10]="UI"}(vS||(vS={}));var TS=new Vr;TS.format=mi.RGBA8;var ES=new zr;ES.format=mi.DEPTH_STENCIL;var wS,IS,PS,DS,RS,MS,OS,NS,BS,LS,FS,VS,zS,kS,US,GS,HS,jS,WS,qS,XS,YS,KS,JS,QS,ZS,$S,tA,eA,nA,iA,rA,aA,oA,sA,cA,lA,hA,uA,_A,fA,dA,pA,mA,vA,gA,yA,xA,SA,AA,bA,CA,TA,EA,wA,IA,PA,DA,RA,MA,OA,NA,BA,LA,FA,VA,zA,kA,UA,GA,HA,jA,WA,qA,XA,YA,KA,JA,QA,ZA=new Gr([TS],ES),$A={width:1,height:1,renderPassInfo:ZA},tb=t("RenderTexture",Ec("cc.RenderTexture")(gS=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._window=null,e}$(e,t);var n=e.prototype;return n.initialize=function(t){this._name=t.name||"",this._width=t.width,this._height=t.height,this._initWindow(t)},n.reset=function(t){this.initialize(t)},n.destroy=function(){if(this._window){var e=h.director.root;null==e||e.destroyWindow(this._window),this._window=null}return t.prototype.destroy.call(this)},n.resize=function(t,e){this._width=Math.floor(un(t,1,2048)),this._height=Math.floor(un(e,1,2048)),this._window&&this._window.resize(this._width,this._height),this.emit("resize",this._window)},n._serialize=function(){return{}},n._deserialize=function(e,n){var i=e;this._width=i.w,this._height=i.h,this._name=i.n,t.prototype._deserialize.call(this,i.base,n)},n.getGFXTexture=function(){return this._window&&this._window.framebuffer.colorTextures[0]},n.onLoaded=function(){this._initWindow()},n._initWindow=function(t){var e=h.director.root;$A.title=this._name,$A.width=this._width,$A.height=this._height,$A.renderPassInfo=t&&t.passInfo?t.passInfo:ZA,TS.barrier=e.device.getGeneralBarrier(new Hr(zi.FRAGMENT_SHADER_READ_TEXTURE,zi.FRAGMENT_SHADER_READ_TEXTURE)),this._window?(this._window.destroy(),this._window.initialize(e.device,$A)):this._window=e.createWindow($A)},n.initDefault=function(e){t.prototype.initDefault.call(this,e),this._width=this._height=1,this._initWindow()},n.validate=function(){return this.width>=1&&this.width<=2048&&this.height>=1&&this.height<=2048},n.readPixels=function(t,e,n,i,r){void 0===t&&(t=0),void 0===e&&(e=0),n=n||this.width,i=i||this.height;var a=this.getGFXTexture();if(!a)return O(7606),null;var o=4*n*i;if(void 0===r)r=new Uint8Array(o);else if(r.length<o)return O(7607,o),null;var s=this._getGFXDevice(),c=[],l=[],h=new _r;return h.texOffset.x=t,h.texOffset.y=e,h.texExtent.width=n,h.texExtent.height=i,l.push(h),c.push(r),null==s||s.copyTextureToBuffers(a,c,l),r},Q(e,[{key:"window",get:function(){return this._window}}]),e}(sv))||gS);h.RenderTexture=tb,he(bi),he(Ci),he(Vi),he(Fi),he(zi),function(t){t[t.SCENE=0]="SCENE",t[t.POSTPROCESS=1]="POSTPROCESS",t[t.UI=2]="UI"}(QA||(QA={})),he(QA),wS=Ec("RenderTextureDesc"),IS=cl(bi),PS=cl(Ci),DS=cl(mi),wS((MS=lt((RS=function(){ct(this,"name",MS,this),ct(this,"type",OS,this),ct(this,"usage",NS,this),ct(this,"format",BS,this),ct(this,"width",LS,this),ct(this,"height",FS,this)}).prototype,"name",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),OS=lt(RS.prototype,"type",[IS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bi.TEX2D}}),NS=lt(RS.prototype,"usage",[PS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ci.COLOR_ATTACHMENT}}),BS=lt(RS.prototype,"format",[DS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return mi.UNKNOWN}}),LS=lt(RS.prototype,"width",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),FS=lt(RS.prototype,"height",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),RS));var eb,nb=(VS=Ec("RenderTextureConfig"),zS=cl(tb),VS((GS=lt((US=function(){ct(this,"name",GS,this),ct(this,"texture",HS,this)}).prototype,"name",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),HS=lt(US.prototype,"texture",[zS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kS=US))||kS),ib=(jS=Ec("MaterialConfig"),WS=cl(vg),jS((XS=lt((qS=function(){ct(this,"name",XS,this),ct(this,"material",YS,this)}).prototype,"name",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),YS=lt(qS.prototype,"material",[WS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qS)),KS=Ec("FrameBufferDesc"),JS=cl([Fe]),QS=cl(tb),KS(($S=lt((ZS=function(){ct(this,"name",$S,this),ct(this,"renderPass",tA,this),ct(this,"colorTextures",eA,this),ct(this,"depthStencilTexture",nA,this),ct(this,"texture",iA,this)}).prototype,"name",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),tA=lt(ZS.prototype,"renderPass",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),eA=lt(ZS.prototype,"colorTextures",[JS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nA=lt(ZS.prototype,"depthStencilTexture",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),iA=lt(ZS.prototype,"texture",[QS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ZS)),rA=Ec("ColorDesc"),aA=cl(mi),oA=cl(Fi),sA=cl(Vi),cA=cl([zi]),lA=cl([zi]),rA((_A=lt((uA=function(){ct(this,"format",_A,this),ct(this,"loadOp",fA,this),ct(this,"storeOp",dA,this),ct(this,"sampleCount",pA,this),ct(this,"beginAccesses",mA,this),ct(this,"endAccesses",vA,this)}).prototype,"format",[aA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return mi.UNKNOWN}}),fA=lt(uA.prototype,"loadOp",[oA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fi.CLEAR}}),dA=lt(uA.prototype,"storeOp",[sA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Vi.STORE}}),pA=lt(uA.prototype,"sampleCount",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),mA=lt(uA.prototype,"beginAccesses",[cA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zi.NONE}}),vA=lt(uA.prototype,"endAccesses",[lA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zi.COLOR_ATTACHMENT_WRITE}}),hA=uA))||hA),rb=(gA=Ec("DepthStencilDesc"),yA=cl(mi),xA=cl(Fi),SA=cl(Vi),AA=cl(Fi),bA=cl(Vi),CA=cl(zi),TA=cl(zi),gA((IA=lt((wA=function(){ct(this,"format",IA,this),ct(this,"depthLoadOp",PA,this),ct(this,"depthStoreOp",DA,this),ct(this,"stencilLoadOp",RA,this),ct(this,"stencilStoreOp",MA,this),ct(this,"sampleCount",OA,this),ct(this,"beginAccesses",NA,this),ct(this,"endAccesses",BA,this)}).prototype,"format",[yA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return mi.UNKNOWN}}),PA=lt(wA.prototype,"depthLoadOp",[xA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fi.CLEAR}}),DA=lt(wA.prototype,"depthStoreOp",[SA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Vi.STORE}}),RA=lt(wA.prototype,"stencilLoadOp",[AA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Fi.CLEAR}}),MA=lt(wA.prototype,"stencilStoreOp",[bA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Vi.STORE}}),OA=lt(wA.prototype,"sampleCount",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),NA=lt(wA.prototype,"beginAccesses",[CA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zi.NONE}}),BA=lt(wA.prototype,"endAccesses",[TA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zi.DEPTH_STENCIL_ATTACHMENT_WRITE}}),EA=wA))||EA);LA=Ec("RenderPassDesc"),FA=cl([ib]),VA=cl(rb),LA((kA=lt((zA=function(){ct(this,"index",kA,this),ct(this,"colorAttachments",UA,this),ct(this,"depthStencilAttachment",GA,this)}).prototype,"index",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),UA=lt(zA.prototype,"colorAttachments",[FA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),GA=lt(zA.prototype,"depthStencilAttachment",[VA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rb}}),zA)),function(t){t[t.FRONT_TO_BACK=0]="FRONT_TO_BACK",t[t.BACK_TO_FRONT=1]="BACK_TO_FRONT"}(eb||(eb={})),he(eb);var ab=(HA=Ec("RenderQueueDesc"),jA=cl(eb),WA=cl([Fe]),HA((YA=lt((XA=function(){ct(this,"isTransparent",YA,this),ct(this,"sortMode",KA,this),ct(this,"stages",JA,this)}).prototype,"isTransparent",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),KA=lt(XA.prototype,"sortMode",[jA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return eb.FRONT_TO_BACK}}),JA=lt(XA.prototype,"stages",[WA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qA=XA))||qA);function ob(t,e){return t.hash-e.hash||t.depth-e.depth||t.shaderId-e.shaderId}function sb(t,e){return t.hash-e.hash||e.depth-t.depth||t.shaderId-e.shaderId}var cb=function(){function t(t){this.queue=void 0,this._passDesc=void 0,this._passPool=void 0,this._passDesc=t,this._passPool=new Xl((function(){return{hash:0,depth:0,shaderId:0,subModel:null,passIdx:0}}),64),this.queue=new Yl(64,this._passDesc.sortFunc)}var e=t.prototype;return e.clear=function(){this.queue.clear(),this._passPool.reset()},e.insertRenderPass=function(t,e,n){var i=t.model.subModels[e],r=i.passes[n],a=i.shaders[n];if(r.blendState.targets[0].blend!==this._passDesc.isTransparent||!(r.phase&this._passDesc.phases))return!1;var o=0|r.priority<<16|i.priority<<8|n,s=this._passPool.add();return s.hash=o,s.depth=t.depth||0,s.shaderId=a.typedID,s.subModel=i,s.passIdx=n,this.queue.push(s),!0},e.sort=function(){this.queue.sort()},e.recordCommandBuffer=function(t,e,n){for(var i=0;i<this.queue.length;++i){var r=this.queue.array[i],a=r.subModel,o=r.passIdx,s=a.inputAssembler,c=a.passes[o],l=a.shaders[o],h=Kv.getOrCreatePipelineState(t,c,l,e,s);n.bindPipelineState(h),n.bindDescriptorSet(ep.MATERIAL,c.descriptorSet),n.bindDescriptorSet(ep.LOCAL,a.descriptorSet),n.bindInputAssembler(s),n.draw(s)}},t}();function lb(t){for(var e=0,n=0;n<t.stages.length;n++)e|=Gv(t.stages[n]);var i=ob;switch(t.sortMode){case eb.BACK_TO_FRONT:i=sb;break;case eb.FRONT_TO_BACK:i=ob}return new cb({isTransparent:t.isTransparent,phases:e,sortFunc:i})}function hb(t){t.clear()}function ub(t){t.sort()}var _b=function(){function t(){this.queue=new Set}var e=t.prototype;return e.clear=function(){for(var t=this.queue.values(),e=t.next();!e.done;)e.value.clear(),e=t.next();this.queue.clear()},e.uploadBuffers=function(t){for(var e=this.queue.values(),n=e.next();!n.done;){for(var i=0;i<n.value.batches.length;++i){var r=n.value.batches[i];if(r.mergeCount){for(var a=0;a<r.vbs.length;++a)r.vbs[a].update(r.vbDatas[a]);t.updateBuffer(r.vbIdx,r.vbIdxData.buffer),t.updateBuffer(r.ubo,r.uboData)}}n=e.next()}},e.recordCommandBuffer=function(t,e,n,i){void 0===i&&(i=null);for(var r=this.queue.values(),a=r.next();!a.done;){for(var o=!1,s=0;s<a.value.batches.length;++s){var c=a.value.batches[s];if(c.mergeCount){if(!o){var l=c.shader,h=Kv.getOrCreatePipelineState(t,c.pass,l,e,c.ia);n.bindPipelineState(h),n.bindDescriptorSet(ep.MATERIAL,c.pass.descriptorSet),o=!0}i&&n.bindDescriptorSet(ep.GLOBAL,i),n.bindDescriptorSet(ep.LOCAL,c.descriptorSet,a.value.dynamicOffsets),n.bindInputAssembler(c.ia),n.draw(c.ia)}}a=r.next()}},t}(),fb=function(){function t(){this.queue=new Set}var e=t.prototype;return e.clear=function(){for(var t=this.queue.values(),e=t.next();!e.done;)e.value.clear(),e=t.next();this.queue.clear()},e.uploadBuffers=function(t){for(var e=this.queue.values(),n=e.next();!n.done;)n.value.hasPendingModels&&n.value.uploadBuffers(t),n=e.next()},e.recordCommandBuffer=function(t,e,n,i){void 0===i&&(i=null);for(var r=this.queue.values(),a=r.next();!a.done;){var o=a.value,s=o.instances,c=o.pass;if(o.hasPendingModels){n.bindDescriptorSet(ep.MATERIAL,c.descriptorSet);for(var l=null,h=0;h<s.length;++h){var u=s[h];if(u.count){var _=u.shader,f=Kv.getOrCreatePipelineState(t,c,_,e,u.ia);l!==f&&(n.bindPipelineState(f),l=f),i&&n.bindDescriptorSet(ep.GLOBAL,i),n.bindDescriptorSet(ep.LOCAL,u.descriptorSet,a.value.dynamicOffsets),n.bindInputAssembler(u.ia),n.draw(u.ia)}}}a=r.next()}},t}(),db=new ql((function(){return{subModel:null,passIdx:-1,dynamicOffsets:[],lights:[]}}),16),pb=new Float32Array(4),mb=[],vb=[],gb=new Xn,yb=new Xn;function xb(t,e){return!(!e.worldBounds||vs.aabbWithAABB(e.worldBounds,t.aabb))}function Sb(t,e){return!(!e.worldBounds||vs.aabbWithAABB(e.worldBounds,t.aabb)&&vs.aabbFrustum(e.worldBounds,t.frustum))}var Ab=Gv("forward-add"),bb=[];function Cb(t,e){e.length=0;for(var n=!1,i=0;i<t.length;i++){for(var r=t[i].passes,a=-1,o=0;o<r.length;o++)if(r[o].phase===Ab){a=o,n=!0;break}e.push(a)}return n}var Tb,Eb,wb,Ib,Pb,Db,Rb,Mb,Ob,Nb,Bb,Lb=function(){function t(t){this._pipeline=void 0,this._device=void 0,this._lightPasses=[],this._shadowUBO=new Float32Array(cp.COUNT),this._lightBufferCount=16,this._lightBufferStride=void 0,this._lightBufferElementCount=void 0,this._lightBuffer=void 0,this._firstLightBufferView=void 0,this._lightBufferData=void 0,this._instancedQueue=void 0,this._batchedQueue=void 0,this._lightMeterScale=1e4,this._pipeline=t,this._device=t.device,this._instancedQueue=new fb,this._batchedQueue=new _b;var e=this._device.capabilities.uboOffsetAlignment;this._lightBufferStride=Math.ceil(Tp.SIZE/e)*e,this._lightBufferElementCount=this._lightBufferStride/Float32Array.BYTES_PER_ELEMENT,this._lightBuffer=this._device.createBuffer(new gr(yi.UNIFORM|yi.TRANSFER_DST,Ai.HOST|Ai.DEVICE,this._lightBufferStride*this._lightBufferCount,this._lightBufferStride)),this._firstLightBufferView=this._device.createBuffer(new yr(this._lightBuffer,0,Tp.SIZE)),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount)}var e=t.prototype;return e.clear=function(){this._instancedQueue.clear(),this._batchedQueue.clear();for(var t=0;t<this._lightPasses.length;t++){var e=this._lightPasses[t];e.dynamicOffsets.length=0,e.lights.length=0}db.freeArray(this._lightPasses),this._lightPasses.length=0},e.destroy=function(){for(var t=this._pipeline.globalDSManager.descriptorSetMap,e=t.keys,n=0;n<e.length;n++){var i=e[n],r=t.get(i);r&&(r.getBuffer(cp.BINDING).destroy(),r.getTexture(lp).destroy(),r.getTexture(gp).destroy(),r.destroy()),t.delete(i)}},e.gatherLightPasses=function(t,e){this.clear();var n=this._pipeline.pipelineSceneData.validPunctualLights;if(n.length){this._updateUBOs(t,e),this._updateLightDescriptorSet(t,e);for(var i=this._pipeline.pipelineSceneData.renderObjects,r=0;r<i.length;r++){var a=i[r].model,o=a.subModels;if(Cb(o,bb)&&(vb.length=0,this._lightCulling(a,n),vb.length))for(var s=0;s<o.length;s++){var c=bb[s];if(!(c<0)){var l=o[s],h=l.passes[c];l.passes[0].blendState.targets[0].blend||(l.descriptorSet.bindBuffer(Tp.BINDING,this._firstLightBufferView),l.descriptorSet.update(),this._addRenderQueue(h,l,a,c))}}}this._instancedQueue.uploadBuffers(e),this._batchedQueue.uploadBuffers(e)}},e.recordCommandBuffer=function(t,e,n){for(var i=this._pipeline.globalDSManager,r=0;r<vb.length;r++){var a=vb[r],o=i.getOrCreateDescriptorSet(a);this._instancedQueue.recordCommandBuffer(t,e,n,o),this._batchedQueue.recordCommandBuffer(t,e,n,o)}for(var s=0;s<this._lightPasses.length;s++){var c=this._lightPasses[s],l=c.subModel,h=c.passIdx,u=c.dynamicOffsets,_=c.lights,f=l.passes[h],d=l.shaders[h],p=l.inputAssembler,m=Kv.getOrCreatePipelineState(t,f,d,e,p),v=f.descriptorSet,g=l.descriptorSet;n.bindPipelineState(m),n.bindDescriptorSet(ep.MATERIAL,v),n.bindInputAssembler(p);for(var y=0;y<u.length;++y){var x=_[y],S=i.getOrCreateDescriptorSet(x);mb[0]=u[y],n.bindDescriptorSet(ep.GLOBAL,S),n.bindDescriptorSet(ep.LOCAL,g,mb),n.draw(p)}}},e._lightCulling=function(t,e){for(var n=!1,i=!function(t){for(var e=t.subModels,n=0;n<e.length;++n)for(var i=e[n].passes,r=0;r<i.length;++r){var a=i[r].batchingScheme;if(a===Fv.INSTANCING)return!0;if(a===Fv.VB_MERGING)return!0}return!1}(t),r=0;r<e.length;r++){var a=e[r];switch(a.type){case Vy.SPHERE:i&&(n=xb(a,t));break;case Vy.SPOT:i&&(n=Sb(a,t))}n||vb.push(r)}},e._addRenderQueue=function(t,e,n,i){var r=t.batchingScheme;if(r===Fv.INSTANCING)for(var a=0;a<vb.length;a++){var o=vb[a],s=t.getInstancedBuffer(o);s.merge(e,n.instancedAttributes,i),s.dynamicOffsets[0]=this._lightBufferStride*o,this._instancedQueue.queue.add(s)}else if(r===Fv.VB_MERGING)for(var c=0;c<vb.length;c++){var l=vb[c],h=t.getBatchedBuffer(l);h.merge(e,i,n),h.dynamicOffsets[0]=this._lightBufferStride*l,this._batchedQueue.queue.add(h)}else{var u=db.alloc();u.subModel=e,u.passIdx=i;for(var _=0;_<vb.length;_++){var f=vb[_];u.lights.push(f),u.dynamicOffsets.push(this._lightBufferStride*f)}this._lightPasses.push(u)}},e._updateLightDescriptorSet=function(t,e){for(var n=this._pipeline.device,i=this._pipeline.pipelineSceneData,r=i.shadows,a=i.shadowFrameBufferMap,o=t.scene.mainLight,s=cm(n)?0:1,c=this._pipeline.globalDSManager,l=i.validPunctualLights,h=0;h<l.length;h++){var u=l[h],_=c.getOrCreateDescriptorSet(h);if(_){var f=void 0,d=void 0;switch(u.type){case Vy.SPHERE:o&&(sy(r,o,this._shadowUBO),cy(r,this._shadowUBO)),this._shadowUBO[cp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=r.size.x,this._shadowUBO[cp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=r.size.y,this._shadowUBO[cp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=1,this._shadowUBO[cp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=0,this._shadowUBO[cp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=2,this._shadowUBO[cp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=s,this._shadowUBO[cp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=0,this._shadowUBO[cp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0,Dn.toArray(this._shadowUBO,r.shadowColor,cp.SHADOW_COLOR_OFFSET);break;case Vy.SPOT:var p=u;if(o&&(sy(r,o,this._shadowUBO),cy(r,this._shadowUBO)),Xn.invert(gb,u.node.getWorldMatrix()),Xn.perspective(yb,u.angle,1,.001,u.range),f=yb.clone(),d=yb.clone().invert(),Xn.multiply(yb,yb,gb),Xn.toArray(this._shadowUBO,gb,cp.MAT_LIGHT_VIEW_OFFSET),Xn.toArray(this._shadowUBO,yb,cp.MAT_LIGHT_VIEW_PROJ_OFFSET),this._shadowUBO[cp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+0]=.01,this._shadowUBO[cp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+1]=u.range,this._shadowUBO[cp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+2]=0,this._shadowUBO[cp.SHADOW_NEAR_FAR_LINEAR_SATURATION_INFO_OFFSET+3]=0,this._shadowUBO[cp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+0]=r.size.x,this._shadowUBO[cp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+1]=r.size.y,this._shadowUBO[cp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+2]=p.shadowPcf,this._shadowUBO[cp.SHADOW_WIDTH_HEIGHT_PCF_BIAS_INFO_OFFSET+3]=p.shadowBias,this._shadowUBO[cp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+0]=1,this._shadowUBO[cp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+1]=s,this._shadowUBO[cp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+2]=p.shadowNormalBias,this._shadowUBO[cp.SHADOW_LIGHT_PACKING_NBIAS_NULL_INFO_OFFSET+3]=0,this._shadowUBO[cp.SHADOW_PROJ_DEPTH_INFO_OFFSET+0]=f.m10,this._shadowUBO[cp.SHADOW_PROJ_DEPTH_INFO_OFFSET+1]=f.m14,this._shadowUBO[cp.SHADOW_PROJ_DEPTH_INFO_OFFSET+2]=f.m11,this._shadowUBO[cp.SHADOW_PROJ_DEPTH_INFO_OFFSET+3]=f.m15,this._shadowUBO[cp.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET+0]=d.m10,this._shadowUBO[cp.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET+1]=d.m14,this._shadowUBO[cp.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET+2]=d.m11,this._shadowUBO[cp.SHADOW_INV_PROJ_DEPTH_INFO_OFFSET+3]=d.m15,this._shadowUBO[cp.SHADOW_PROJ_INFO_OFFSET+0]=f.m00,this._shadowUBO[cp.SHADOW_PROJ_INFO_OFFSET+1]=f.m05,this._shadowUBO[cp.SHADOW_PROJ_INFO_OFFSET+2]=1/f.m00,this._shadowUBO[cp.SHADOW_PROJ_INFO_OFFSET+3]=1/f.m05,Dn.toArray(this._shadowUBO,r.shadowColor,cp.SHADOW_COLOR_OFFSET),a.has(u)){var m,v=null===(m=a.get(u))||void 0===m?void 0:m.colorTextures[0];v&&_.bindTexture(gp,v)}}_.update(),e.updateBuffer(_.getBuffer(cp.BINDING),this._shadowUBO)}}},e._updateUBOs=function(t,e){var n=t.exposure,i=this._pipeline.pipelineSceneData,r=i.isHDR,a=i.shadows,o=i.validPunctualLights;o.length>this._lightBufferCount&&(this._firstLightBufferView.destroy(),this._lightBufferCount=An(o.length),this._lightBuffer.resize(this._lightBufferStride*this._lightBufferCount),this._lightBufferData=new Float32Array(this._lightBufferElementCount*this._lightBufferCount),this._firstLightBufferView.initialize(new yr(this._lightBuffer,0,Tp.SIZE)));for(var s=0,c=0;s<o.length;s++,c+=this._lightBufferElementCount){var l=o[s];switch(l.type){case Vy.SPHERE:if(Mn.toArray(pb,l.position),pb[3]=0,this._lightBufferData.set(pb,c+Tp.LIGHT_POS_OFFSET),pb[0]=l.size,pb[1]=l.range,pb[2]=0,pb[3]=0,this._lightBufferData.set(pb,c+Tp.LIGHT_SIZE_RANGE_ANGLE_OFFSET),Mn.toArray(pb,l.color),l.useColorTemperature){var h=l.colorTemperatureRGB;pb[0]*=h.x,pb[1]*=h.y,pb[2]*=h.z}pb[3]=r?l.luminance*n*this._lightMeterScale:l.luminance,this._lightBufferData.set(pb,c+Tp.LIGHT_COLOR_OFFSET);break;case Vy.SPOT:if(Mn.toArray(pb,l.position),pb[3]=1,this._lightBufferData.set(pb,c+Tp.LIGHT_POS_OFFSET),pb[0]=l.size,pb[1]=l.range,pb[2]=l.spotAngle,pb[3]=a.enabled&&l.shadowEnabled&&a.type===Ig.ShadowMap?1:0,this._lightBufferData.set(pb,c+Tp.LIGHT_SIZE_RANGE_ANGLE_OFFSET),Mn.toArray(pb,l.direction),this._lightBufferData.set(pb,c+Tp.LIGHT_DIR_OFFSET),Mn.toArray(pb,l.color),l.useColorTemperature){var u=l.colorTemperatureRGB;pb[0]*=u.x,pb[1]*=u.y,pb[2]*=u.z}pb[3]=r?l.luminance*n*this._lightMeterScale:l.luminance,this._lightBufferData.set(pb,c+Tp.LIGHT_COLOR_OFFSET)}}e.updateBuffer(this._lightBuffer,this._lightBufferData)},t}(),Fb=new Qs,Vb=function(){function t(t){this._pendingModels=[],this._castModels=[],this._instancedQueue=new fb,this._pipeline=void 0,this._pipeline=t}var e=t.prototype;return e.gatherShadowPasses=function(t,e){var n=this._pipeline.pipelineSceneData,i=(this._pipeline.pipelineUBO,n.shadows);if(this._instancedQueue.clear(),this._pendingModels.length=0,this._castModels.length=0,i.enabled&&i.type===Ig.Planar&&!(i.normal.length()<1e-6)){var r=t.scene,a=t.frustum,o=0!=(t.visibility&Hd.BitMask.DEFAULT);if(r.mainLight&&o){for(var s=r.models,c=0;c<s.length;c++){var l=s[c];l.enabled&&l.node&&l.castShadow&&this._castModels.push(l)}var h=i.instancingMaterial.passes[0].getInstancedBuffer();this._instancedQueue.queue.add(h);for(var u=0;u<this._castModels.length;u++){var _=this._castModels[u];if(!_.worldBounds||(Qs.transform(Fb,_.worldBounds,i.matLight),vs.aabbFrustum(Fb,a)))if(_.isInstancingEnabled)for(var f=_.subModels,d=0;d<f.length;d++){var p=f[d];h.merge(p,_.instancedAttributes,0,p.planarInstanceShader)}else this._pendingModels.push(_)}this._instancedQueue.uploadBuffers(e)}}},e.recordCommandBuffer=function(t,e,n){var i=this._pipeline.pipelineSceneData.shadows;if(i.enabled&&i.type===Ig.Planar&&(this._instancedQueue.recordCommandBuffer(t,e,n),this._pendingModels.length)){var r=i.material.passes[0],a=r.descriptorSet;n.bindDescriptorSet(ep.MATERIAL,a);for(var o=this._pendingModels.length,s=0;s<o;s++)for(var c=this._pendingModels[s],l=0;l<c.subModels.length;l++){var h=c.subModels[l],u=h.planarShader,_=h.inputAssembler,f=Kv.getOrCreatePipelineState(t,r,u,e,_);n.bindPipelineState(f),n.bindDescriptorSet(ep.LOCAL,h.descriptorSet),n.bindInputAssembler(_),n.draw(_)}}},t}(),zb=function(){function t(){this._phaseID=Gv("default")}var e=t.prototype;return e.activate=function(t){this._pipeline=t},e.render=function(t,e){for(var n=this._pipeline,i=n.device,r=n.commandBuffers[0],a=t.scene.batches,o=0;o<a.length;o++){var s=a[o],c=!1;if(t.visibility&s.visFlags&&(c=!0),c)for(var l=s.shaders.length,h=0;h<l;h++){var u=s.passes[h];if(u.phase===this._phaseID){var _=s.shaders[h],f=s.inputAssembler,d=Kv.getOrCreatePipelineState(i,u,_,e,f);r.bindPipelineState(d),r.bindDescriptorSet(ep.MATERIAL,u.descriptorSet);var p=s.descriptorSet;r.bindDescriptorSet(ep.LOCAL,p),r.bindInputAssembler(f),r.draw(f)}}}},t}(),kb=[new dr(0,0,0,1)],Ub=t("ForwardStage",(Tb=Ec("ForwardStage"),Eb=cl([ab]),wb=el(),Tb((Mb=Rb=function(t){function e(){var e;return ct(e=t.call(this)||this,"renderQueues",Db,at(e)),e._renderQueues=[],e._renderArea=new or,e._batchedQueue=void 0,e._instancedQueue=void 0,e._phaseID=Gv("default"),e._clearFlag=4294967295,e._batchedQueue=new _b,e._instancedQueue=new fb,e._uiPhase=new zb,e}$(e,t);var n=e.prototype;return n.initialize=function(e){return t.prototype.initialize.call(this,e),e.renderQueues&&(this.renderQueues=e.renderQueues),!0},n.activate=function(e,n){t.prototype.activate.call(this,e,n);for(var i=0;i<this.renderQueues.length;i++)this._renderQueues[i]=lb(this.renderQueues[i]);this._additiveLightQueue=new Lb(this._pipeline),this._planarQueue=new Vb(this._pipeline),this._uiPhase.activate(e)},n.destroy=function(){},n.render=function(t){this._instancedQueue.clear(),this._batchedQueue.clear();var e=this._pipeline,n=e.device;this._renderQueues.forEach(hb);for(var i=e.pipelineSceneData.renderObjects,r=0,a=0,o=0,s=0;s<i.length;++s){var c=i[s],l=c.model.subModels;for(r=0;r<l.length;++r){var h=l[r],u=h.passes;for(a=0;a<u.length;++a){var _=u[a];if(_.phase===this._phaseID){var f=_.batchingScheme;if(f===Fv.INSTANCING){var d=_.getInstancedBuffer();d.merge(h,c.model.instancedAttributes,a),this._instancedQueue.queue.add(d)}else if(f===Fv.VB_MERGING){var p=_.getBatchedBuffer();p.merge(h,a,c.model),this._batchedQueue.queue.add(p)}else for(o=0;o<this._renderQueues.length;o++)this._renderQueues[o].insertRenderPass(c,r,a)}}}}this._renderQueues.forEach(ub);var m=e.commandBuffers[0];e.pipelineUBO.updateShadowUBO(t),this._instancedQueue.uploadBuffers(m),this._batchedQueue.uploadBuffers(m),this._additiveLightQueue.gatherLightPasses(t,m),this._planarQueue.gatherShadowPasses(t,m),t.clearFlag&Zi.COLOR&&(kb[0].x=t.clearColor.x,kb[0].y=t.clearColor.y,kb[0].z=t.clearColor.z,kb[0].w=t.clearColor.w),e.generateRenderArea(t,this._renderArea);var v=t.window.framebuffer,g=e.getRenderPass(t.clearFlag&this._clearFlag,v);m.beginRenderPass(g,v,this._renderArea,kb,t.clearDepth,t.clearStencil),m.bindDescriptorSet(ep.GLOBAL,e.descriptorSet),this._renderQueues[0].recordCommandBuffer(n,g,m),this._instancedQueue.recordCommandBuffer(n,g,m),this._batchedQueue.recordCommandBuffer(n,g,m),this._additiveLightQueue.recordCommandBuffer(n,g,m),m.bindDescriptorSet(ep.GLOBAL,e.descriptorSet),this._planarQueue.recordCommandBuffer(n,g,m),this._renderQueues[1].recordCommandBuffer(n,g,m),this._pipeline.geometryRenderer.render(g,m),this._uiPhase.render(t,g),hg(n,g,m,e.profiler,t),m.endRenderPass()},e}(eS),Rb.initInfo={name:"ForwardStage",priority:dS.FORWARD,tag:0,renderQueues:[{isTransparent:!1,sortMode:eb.FRONT_TO_BACK,stages:["default"]},{isTransparent:!0,sortMode:eb.BACK_TO_FRONT,stages:["default","planarShadow"]}]},Db=lt((Pb=Mb).prototype,"renderQueues",[Eb,Nc,wb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ib=Pb))||Ib)),Gb=t("ForwardFlow",Ec("ForwardFlow")((Bb=Nb=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._stages.length){var n=new Ub;n.initialize(Ub.initInfo),this._stages.push(n)}return!0},n.activate=function(e){t.prototype.activate.call(this,e)},n.render=function(e){t.prototype.render.call(this,e)},n.destroy=function(){t.prototype.destroy.call(this)},e}(iS),Nb.initInfo={name:Xd,priority:pS.FORWARD,stages:[]},Ob=Bb))||Ob),Hb=new Xn,jb=new Xn,Wb=new Xn,qb=new Qs,Xb=Gv("shadow-caster"),Yb=[];function Kb(t,e){e.length=0;for(var n=!1,i=0;i<t.length;i++){for(var r=t[i].passes,a=-1,o=0;o<r.length;o++)if(r[o].phase===Xb){a=o,n=!0;break}e.push(a)}return n}var Jb,Qb,Zb,$b,tC,eC,nC=function(){function t(t){this._pipeline=void 0,this._subModelsArray=[],this._passArray=[],this._shaderArray=[],this._instancedQueue=void 0,this._batchedQueue=void 0,this._pipeline=t,this._instancedQueue=new fb,this._batchedQueue=new _b}var e=t.prototype;return e.gatherLightPasses=function(t,e,n,i){this.clear();var r=this._pipeline.pipelineSceneData,a=r.shadows;if(n&&a.enabled&&a.type===Ig.ShadowMap){var o=r.dirShadowObjects,s=r.castShadowObjects;switch(n.type){case Vy.DIRECTIONAL:for(var c=0;c<o.length;c++){var l=o[c].model;Kb(l.subModels,Yb)&&this.add(l,Yb)}break;case Vy.SPOT:Xn.invert(Hb,n.node.getWorldMatrix()),Xn.perspective(jb,n.angle,1,.001,n.range),Xn.multiply(Wb,jb,Hb);for(var h=0;h<s.length;h++){var u=s[h].model;Kb(u.subModels,Yb)&&(u.worldBounds&&(Qs.transform(qb,u.worldBounds,Wb),!vs.aabbFrustum(qb,e.frustum))||this.add(u,Yb))}}this._instancedQueue.uploadBuffers(i),this._batchedQueue.uploadBuffers(i)}},e.clear=function(){this._subModelsArray.length=0,this._shaderArray.length=0,this._passArray.length=0,this._instancedQueue.clear(),this._batchedQueue.clear()},e.add=function(t,e){for(var n=t.subModels,i=0;i<n.length;i++){var r=n[i],a=e[i],o=r.passes[a];if(o.batchingScheme===Fv.INSTANCING){var s=o.getInstancedBuffer();s.merge(r,t.instancedAttributes,a),this._instancedQueue.queue.add(s)}else if(o.batchingScheme===Fv.VB_MERGING){var c=o.getBatchedBuffer();c.merge(r,a,t),this._batchedQueue.queue.add(c)}else{var l=r.shaders[a];this._subModelsArray.push(r),l&&this._shaderArray.push(l),this._passArray.push(o)}}},e.recordCommandBuffer=function(t,e,n){this._instancedQueue.recordCommandBuffer(t,e,n),this._batchedQueue.recordCommandBuffer(t,e,n);for(var i=0;i<this._subModelsArray.length;++i){var r=this._subModelsArray[i],a=this._shaderArray[i],o=this._passArray[i],s=r.inputAssembler,c=Kv.getOrCreatePipelineState(t,o,a,e,s),l=o.descriptorSet;n.bindPipelineState(c),n.bindDescriptorSet(ep.MATERIAL,l),n.bindDescriptorSet(ep.LOCAL,r.descriptorSet),n.bindInputAssembler(s),n.draw(s)}},t}(),iC=[new dr(1,1,1,1)],rC=t("ShadowStage",Ec("ShadowStage")((Zb=Qb=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._shadowFrameBuffer=null,e._renderArea=new or,e._light=null,e._globalDS=null,e}$(e,t);var n=e.prototype;return n.setUsage=function(t,e,n){this._globalDS=t,this._light=e,this._shadowFrameBuffer=n},n.destroy=function(){var t;this._shadowFrameBuffer=null,this._globalDS=null,this._light=null,null===(t=this._additiveShadowQueue)||void 0===t||t.clear()},n.clearFramebuffer=function(t){if(this._light&&this._shadowFrameBuffer){iC[0].w=t.clearColor.w;var e=this._pipeline.commandBuffers[0],n=this._shadowFrameBuffer.renderPass;e.beginRenderPass(n,this._shadowFrameBuffer,this._renderArea,iC,t.clearDepth,t.clearStencil),e.endRenderPass()}},n.render=function(t){var e=this._pipeline,n=e.pipelineSceneData,i=n.shadows,r=n.shadingScale,a=this._globalDS,o=e.commandBuffers[0];if(this._light&&this._shadowFrameBuffer){this._pipeline.pipelineUBO.updateShadowUBOLight(a,this._light),this._additiveShadowQueue.gatherLightPasses(a,t,this._light,o);var s=t.viewport,c=i.size;this._renderArea.x=s.x*c.x,this._renderArea.y=s.y*c.y,this._renderArea.width=s.width*c.x*r,this._renderArea.height=s.height*c.y*r;var l=e.device,h=this._shadowFrameBuffer.renderPass;o.beginRenderPass(h,this._shadowFrameBuffer,this._renderArea,iC,t.clearDepth,t.clearStencil),o.bindDescriptorSet(ep.GLOBAL,a),this._additiveShadowQueue.recordCommandBuffer(l,h,o),o.endRenderPass()}},n.activate=function(e,n){t.prototype.activate.call(this,e,n),this._additiveShadowQueue=new nC(e)},e}(eS),Qb.initInfo={name:"ShadowStage",priority:dS.FORWARD,tag:0},Jb=Zb))||Jb),aC=[],oC=t("ShadowFlow",Ec("ShadowFlow")((eC=tC=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._shadowRenderPass=null,e}$(e,t);var n=e.prototype;return n.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._stages.length){var n=new rC;n.initialize(rC.initInfo),this._stages.push(n)}return!0},n.render=function(t){var e=this._pipeline,n=e.pipelineSceneData.shadows,i=e.pipelineSceneData.shadowFrameBufferMap,r=e.pipelineSceneData.castShadowObjects,a=this._pipeline.pipelineSceneData.validPunctualLights;if(n.enabled&&n.type===Ig.ShadowMap){for(var o=0,s=0;o<n.maxReceived&&s<a.length;){var c=a[s];c.type===Vy.SPOT&&(aC.push(c),o++),s++}if(0!==r.length){n.shadowMapDirty&&this.resizeShadowMap();var l=t.scene.mainLight;if(l){var h=e.descriptorSet;i.has(l)||this._initShadowFrameBuffer(e,l,t.window.swapchain);for(var u=i.get(l),_=0;_<this._stages.length;_++){var f=this._stages[_];f.setUsage(h,l,u),f.render(t)}}for(var d=0;d<aC.length;d++){var p=aC[d],m=e.globalDSManager.getOrCreateDescriptorSet(d);i.has(p)||this._initShadowFrameBuffer(e,p,t.window.swapchain);for(var v=i.get(p),g=0;g<this._stages.length;g++){var y=this._stages[g];y.setUsage(m,p,v),y.render(t)}}aC.length=0}else this.clearShadowMap(aC,t)}},n.destroy=function(){if(t.prototype.destroy.call(this),this._pipeline){for(var e=this._pipeline.pipelineSceneData.shadowFrameBufferMap,n=Array.from(e.values()),i=0;i<n.length;i++){var r=n[i];if(r){for(var a=r.colorTextures,o=0;o<a.length;o++){var s=a[i];s&&s.destroy()}a.length=0;var c=r.depthStencilTexture;c&&c.destroy(),r.destroy()}}e.clear()}this._shadowRenderPass&&this._shadowRenderPass.destroy()},n._initShadowFrameBuffer=function(t,e){var n=t.device,i=t.pipelineSceneData.shadows.size,r=t.pipelineSceneData.shadowFrameBufferMap,a=cm(n)?mi.R32F:mi.RGBA8;if(!this._shadowRenderPass){var o=new Vr;o.format=a,o.loadOp=Fi.CLEAR,o.storeOp=Vi.STORE,o.sampleCount=1;var s=new zr;s.format=mi.DEPTH_STENCIL,s.depthLoadOp=Fi.CLEAR,s.depthStoreOp=Vi.DISCARD,s.stencilLoadOp=Fi.CLEAR,s.stencilStoreOp=Vi.DISCARD,s.sampleCount=1;var c=new Gr([o],s);this._shadowRenderPass=n.createRenderPass(c)}var l=[];l.push(n.createTexture(new br(bi.TEX2D,Ci.COLOR_ATTACHMENT|Ci.SAMPLED,a,i.x,i.y)));var h=n.createTexture(new br(bi.TEX2D,Ci.DEPTH_STENCIL_ATTACHMENT,mi.DEPTH_STENCIL,i.x,i.y)),u=n.createFramebuffer(new Wr(this._shadowRenderPass,l,h));r.set(e,u)},n.clearShadowMap=function(t,e){var n=this._pipeline,i=n.pipelineSceneData,r=e.scene.mainLight;if(r){var a=this._pipeline.descriptorSet;i.shadowFrameBufferMap.has(r)||this._initShadowFrameBuffer(this._pipeline,r,e.window.swapchain);for(var o=i.shadowFrameBufferMap.get(r),s=0;s<this._stages.length;s++){var c=this._stages[s];c.setUsage(a,r,o),c.render(e)}}for(var l=0;l<t.length;l++){var h=t[l],u=i.shadowFrameBufferMap.get(h),_=n.globalDSManager.getOrCreateDescriptorSet(l);if(i.shadowFrameBufferMap.has(h))for(var f=0;f<this._stages.length;f++){var d=this._stages[f];d.setUsage(_,h,u),d.clearFramebuffer(e)}}},n.resizeShadowMap=function(){for(var t=this._pipeline.pipelineSceneData.shadows,e=t.size,n=this._pipeline,i=n.device,r=n.pipelineSceneData.shadowFrameBufferMap,a=cm(i)?mi.R32F:mi.RGBA8,o=r.values(),s=o.next();!s.done;){var c=s.value;if(c){var l=[];l.push(n.device.createTexture(new br(bi.TEX2D,Ci.COLOR_ATTACHMENT|Ci.SAMPLED,a,e.x,e.y)));var h=c.depthStencilTexture;h&&h.resize(e.x,e.y);var u=c.renderPass;c.destroy(),c.initialize(new Wr(u,l,h)),s=o.next()}else s=o.next()}t.shadowMapDirty=!1},e}(iS),tC.initInfo={name:Yd,priority:pS.SHADOW,tag:QA.SCENE,stages:[]},$b=eC))||$b);function sC(t,e){for(var n,i=st(e);!(n=i()).done;){var r=n.value;Array.isArray(r)?sC(t,r):t.push(r)}}function cC(t){var e=[];return sC(e,t),e.join("")}var lC=ml.Flags.Destroyed,hC=ml.Flags.PersistentMask,uC=en.IDENTIFIER_RE,_C="var ",fC="o",dC={"cc.ClickEvent":!1,"cc.PrefabInfo":!1},pC=en.escapeForJS,mC=function(){function t(t,e){this.varName=void 0,this.expression=void 0,this.varName=t,this.expression=e}return t.prototype.toString=function(){return _C+this.varName+"="+this.expression+";"},t}();function vC(t,e){return e instanceof mC?new mC(e.varName,t+e.expression):t+e}function gC(t,e,n){Array.isArray(n)?(n[0]=vC(e,n[0]),t.push(n)):t.push(vC(e,n)+";")}var yC=function(){function t(t){this._exps=void 0,this._targetExp=void 0,this._exps=[],this._targetExp=t}var e=t.prototype;return e.append=function(t,e){this._exps.push([t,e])},e.writeCode=function(t){var e;if(this._exps.length>1)t.push("t="+this._targetExp+";"),e="t";else{if(1!==this._exps.length)return;e=this._targetExp}for(var n=0;n<this._exps.length;n++){var i=this._exps[n];gC(t,e+xC(i[0])+"=",i[1])}},t}();function xC(t){return uC.test(t)?"."+t:"["+pC(t)+"]"}yC.pool=void 0,yC.pool=new ne((function(t){t._exps.length=0,t._targetExp=null}),1),yC.pool.get=function(t){var e=this._get()||new yC;return e._targetExp=t,e};var SC=function(){function t(t,e){var n;this.parent=void 0,this.objsToClear_iN$t=void 0,this.codeArray=void 0,this.objs=void 0,this.funcs=void 0,this.funcModuleCache=void 0,this.globalVariables=void 0,this.globalVariableId=void 0,this.localVariableId=void 0,this.result=void 0,this.parent=e,this.objsToClear_iN$t=[],this.codeArray=[],this.objs=[],this.funcs=[],this.funcModuleCache=Pt(),kt(this.funcModuleCache,dC),this.globalVariables=[],this.globalVariableId=0,this.localVariableId=0,this.codeArray.push("var o,t;","if(R){","o=R;","}else{","o=R=new "+this.getFuncModule(t.constructor,!0)+"();","}"),t._iN$t={globalVar:"R"},this.objsToClear_iN$t.push(t),this.enumerateObject(this.codeArray,t),this.globalVariables.length>0&&(n=_C+this.globalVariables.join(",")+";");var i=cC(["return (function(R){",n||[],this.codeArray,"return o;","})"]);this.result=Function("O","F",i)(this.objs,this.funcs);for(var r=0,a=this.objsToClear_iN$t.length;r<a;++r)this.objsToClear_iN$t[r]._iN$t=null;this.objsToClear_iN$t.length=0}var e=t.prototype;return e.getFuncModule=function(t,e){var n=Dt(t);if(n){var i=this.funcModuleCache[n];if(i)return i;if(void 0===i){var r=-1!==n.indexOf(".");if(r)try{if(r=t===Function("return "+n)())return this.funcModuleCache[n]=n,n}catch(t){}}}var a=this.funcs.indexOf(t);a<0&&(a=this.funcs.length,this.funcs.push(t));var o="F["+a+"]";return e&&(o="("+o+")"),this.funcModuleCache[n]=o,o},e.getObjRef=function(t){var e=this.objs.indexOf(t);return e<0&&(e=this.objs.length,this.objs.push(t)),"O["+e+"]"},e.setValueType=function(t,e,n,i){var r=yC.pool.get(i),a=e.constructor.__props__;a||(a=Object.keys(e));for(var o=0;o<a.length;o++){var s=a[o],c=n[s];if(e[s]!==c){var l=this.enumerateField(n,s,c);r.append(s,l)}}r.writeCode(t),yC.pool.put(r)},e.enumerateCCClass=function(t,e,n){for(var i=n.__values__,r=Re(n),a=0;a<i.length;a++){var o=i[a],s=e[o],c=r[o+"$_$default"];if(!AC(c,s))if("object"==typeof s&&s instanceof h.ValueType&&(c=en.getDefault(c))&&c.constructor===s.constructor){var l=fC+xC(o);this.setValueType(t,c,s,l)}else this.setObjProp(t,e,o,s)}},e.instantiateArray=function(t){if(0===t.length)return"[]";var e="a"+ ++this.localVariableId,n=[new mC(e,"new Array("+t.length+")")];t._iN$t={globalVar:"",source:n},this.objsToClear_iN$t.push(t);for(var i=0;i<t.length;++i)gC(n,e+"["+i+"]=",this.enumerateField(t,i,t[i]));return n},e.instantiateTypedArray=function(t){var e=t.constructor.name;if(0===t.length)return"new "+e;var n="a"+ ++this.localVariableId,i=[new mC(n,"new "+e+"("+t.length+")")];t._iN$t={globalVar:"",source:i},this.objsToClear_iN$t.push(t);for(var r=0;r<t.length;++r)0!==t[r]&&gC(i,n+"["+r+"]=",t[r]);return i},e.enumerateField=function(t,e,n){if("object"==typeof n&&n){var i=n._iN$t;if(i){var r=i.globalVar;if(!r){r=i.globalVar="v"+ ++this.globalVariableId,this.globalVariables.push(r);var a=i.source[0];i.source[0]=vC(r+"=",a)}return r}return ArrayBuffer.isView(n)?this.instantiateTypedArray(n):Array.isArray(n)?this.instantiateArray(n):this.instantiateObj(n)}return"function"==typeof n?this.getFuncModule(n):"string"==typeof n?pC(n):("_objFlags"===e&&t instanceof ml&&(n&=hC),n)},e.setObjProp=function(t,e,n,i){gC(t,fC+xC(n)+"=",this.enumerateField(e,n,i))},e.enumerateObject=function(t,e){var n=e.constructor;if(nn(n))this.enumerateCCClass(t,e,n);else for(var i in e)if(e.hasOwnProperty(i)&&(95!==i.charCodeAt(0)||95!==i.charCodeAt(1)||"__type__"===i)){var r=e[i];"object"==typeof r&&r&&r===e._iN$t||this.setObjProp(t,e,i,r)}},e.instantiateObj=function(t){if(t instanceof h.ValueType)return en.getNewValueTypeCode(t);if(t instanceof h.Asset)return this.getObjRef(t);if(t._objFlags&lC)return null;var e,n=t.constructor;if(nn(n)){if(this.parent)if(this.parent instanceof h.Component){if(t instanceof h._BaseNode||t instanceof h.Component)return this.getObjRef(t)}else if(this.parent instanceof h._BaseNode)if(t instanceof h._BaseNode){if(!t.isChildOf(this.parent))return this.getObjRef(t)}else if(t instanceof h.Component){var i;if(!(null===(i=t.node)||void 0===i?void 0:i.isChildOf(this.parent)))return this.getObjRef(t)}e=new mC(fC,"new "+this.getFuncModule(n,!0)+"()")}else if(n===Object)e=new mC(fC,"{}");else{if(n)return this.getObjRef(t);e=new mC(fC,"Object.create(null)")}var r=[e];return t._iN$t={globalVar:"",source:r},this.objsToClear_iN$t.push(t),this.enumerateObject(r,t),["(function(){",r,"return o;})();"]},t}();function AC(t,e){if("function"==typeof t)try{t=t()}catch(t){return!1}if(t===e)return!0;if(t&&e&&"object"==typeof t&&"object"==typeof e&&t.constructor===e.constructor)if(t instanceof h.ValueType){if(t.equals(e))return!0}else{if(Array.isArray(t))return 0===t.length&&0===e.length;if(t.constructor===Object)return bt(t)&&bt(e)}return!1}var bC,CC,TC,EC,wC,IC,PC,DC,RC,MC,OC=function(){function t(t){this._uiComp=null,this._opacity=1,this._localOpacity=1,this.colorDirty=!0,this._uiTransformComp=null,this._node=void 0,this._node=t}return t.prototype.applyOpacity=function(t){this._opacity=this._localOpacity*t},t.markOpacityTree=function(){},Q(t,[{key:"uiTransformComp",get:function(){return this._uiTransformComp||(this._uiTransformComp=this._node.getComponent("cc.UITransform")),this._uiTransformComp},set:function(t){this._uiTransformComp=t}},{key:"uiComp",get:function(){return this._uiComp},set:function(t){this._uiComp&&t?R(12002):this._uiComp=t}},{key:"opacity",get:function(){return this._opacity}},{key:"localOpacity",get:function(){return this._localOpacity},set:function(t){this._localOpacity=t,this.colorDirty=!0}}]),t}();ml.Flags.Destroying,function(t){t.TOUCH_START="touch-start",t.TOUCH_MOVE="touch-move",t.TOUCH_END="touch-end",t.TOUCH_CANCEL="touch-cancel",t.MOUSE_DOWN="mouse-down",t.MOUSE_MOVE="mouse-move",t.MOUSE_UP="mouse-up",t.MOUSE_WHEEL="mouse-wheel",t.MOUSE_ENTER="mouse-enter",t.MOUSE_LEAVE="mouse-leave",t.KEY_DOWN="keydown",t.KEY_UP="keyup",t.DEVICEMOTION="devicemotion",t.TRANSFORM_CHANGED="transform-changed",t.SCENE_CHANGED_FOR_PERSISTS="scene-changed-for-persists",t.SIZE_CHANGED="size-changed",t.ANCHOR_CHANGED="anchor-changed",t.COLOR_CHANGED="color-changed",t.CHILD_ADDED="child-added",t.CHILD_REMOVED="child-removed",t.PARENT_CHANGED="parent-changed",t.NODE_DESTROYED="node-destroyed",t.LAYER_CHANGED="layer-changed",t.SIBLING_ORDER_CHANGED="sibling-order-changed",t.ACTIVE_IN_HIERARCHY_CHANGED="active-in-hierarchy-changed"}(bC||(bC=t("NodeEventType",{})));var NC=ml.Flags.Destroying,BC=ml.Flags.DontDestroy,LC=ml.Flags.Deactivating,FC=new vt("Node");function VC(t){return t?"string"==typeof t?te(t):t:(O(3804),null)}var zC,kC,UC,GC,HC,jC,WC,qC,XC,YC,KC,JC=t("BaseNode",Ec("cc.BaseNode")((MC=RC=function(t){$(n,t),n._setScene=function(t){t._updateScene()},n._findComponent=function(t,e){var n=e,i=t._components;if(n._sealed)for(var r=0;r<i.length;++r){var a=i[r];if(a.constructor===e)return a}else for(var o=0;o<i.length;++o){var s=i[o];if(s instanceof e)return s}return null},n._findComponents=function(t,e,n){var i=e,r=t._components;if(i._sealed)for(var a=0;a<r.length;++a){var o=r[a];o.constructor===e&&n.push(o)}else for(var s=0;s<r.length;++s){var c=r[s];c instanceof e&&n.push(c)}},n._findChildComponent=function(t,e){for(var i=0;i<t.length;++i){var r=t[i],a=n._findComponent(r,e);if(a)return a;if(r._children.length>0&&(a=n._findChildComponent(r._children,e)))return a}return null},n._findChildComponents=function(t,e,i){for(var r=0;r<t.length;++r){var a=t[r];n._findComponents(a,e,i),a._children.length>0&&n._findChildComponents(a._children,e,i)}};var e=n.prototype;function n(e){var n;return ct(n=t.call(this,e)||this,"_parent",EC,at(n)),ct(n,"_children",wC,at(n)),ct(n,"_active",IC,at(n)),ct(n,"_components",PC,at(n)),ct(n,"_prefab",DC,at(n)),n._scene=null,n._activeInHierarchy=!1,n._id=FC.getNewId(),n._name=void 0,n._eventProcessor=new h.NodeEventProcessor(at(n)),n._eventMask=0,n._siblingIndex=0,n._originalSceneId="",n._registerIfAttached=void 0,n._name=void 0!==e?e:"New Node",n}return e._updateScene=function(){null==this._parent?A("Node %s(%s) has not attached to a scene.",this.name,this.uuid):this._scene=this._parent._scene},e.attr=function(t){kt(this,t)},e.getParent=function(){return this._parent},e.setParent=function(t,e){if(void 0===e&&(e=!1),this._parent!==t){var n=this._parent,i=t;if(this._parent=i,this._siblingIndex=0,this._onSetParent(n,e),this.emit&&this.emit(bC.PARENT_CHANGED,n),n&&!(n._objFlags&NC)){var r=n._children.indexOf(this);n._children.splice(r,1),n._updateSiblingIndex(),n.emit&&n.emit(bC.CHILD_REMOVED,this)}i&&(i._children.push(this),this._siblingIndex=i._children.length-1,i.emit&&i.emit(bC.CHILD_ADDED,this)),this._onHierarchyChanged(n)}},e.getChildByUuid=function(t){if(!t)return x("Invalid uuid"),null;for(var e=this._children,n=0,i=e.length;n<i;n++)if(e[n]._id===t)return e[n];return null},e.getChildByName=function(t){if(!t)return x("Invalid name"),null;for(var e=this._children,n=0,i=e.length;n<i;n++)if(e[n]._name===t)return e[n];return null},e.getChildByPath=function(t){for(var e=t.split("/"),n=this,i=function(t){var i=e[t];if(0===i.length)return"continue";var r=n.children.find((function(t){return t.name===i}));if(!r)return{v:null};n=r},r=0;r<e.length;++r){var a=i(r);if("continue"!==a&&"object"==typeof a)return a.v}return n},e.addChild=function(t){t.setParent(this)},e.insertChild=function(t,e){t.parent=this,t.setSiblingIndex(e)},e.getSiblingIndex=function(){return this._siblingIndex},e.setSiblingIndex=function(t){if(this._parent)if(this._parent._objFlags&LC)O(3821);else{var e=this._parent._children;t=-1!==t?t:e.length-1;var n=e.indexOf(this);t!==n&&(e.splice(n,1),t<e.length?e.splice(t,0,this):e.push(this),this._parent._updateSiblingIndex(),this._onSiblingIndexChanged&&this._onSiblingIndexChanged(t))}},e.walk=function(t,e){var i=1,r=null,a=null,o=0,s=n._stacks[n._stackId];s||(s=[],n._stacks.push(s)),n._stackId++,s.length=0,s[0]=this;for(var c=null,l=!1;i;)if(a=s[--i])if(!l&&t?t(a):l&&e&&e(a),s[i]=null,l){if(c===this._parent)break;if(l=!1,r)if(r[++o])s[i]=r[o],i++;else if(c&&(s[i]=c,i++,l=!0,c._parent?(o=(r=c._parent._children).indexOf(c),c=c._parent):(c=null,r=null),o<0))break}else a._children.length>0?(c=a,r=a._children,o=0,s[i]=r[o],i++):(s[i]=a,i++,l=!0);s.length=0,n._stackId--},e.removeFromParent=function(){this._parent&&this._parent.removeChild(this)},e.removeChild=function(t){this._children.indexOf(t)>-1&&(t.parent=null)},e.removeAllChildren=function(){for(var t=this._children,e=t.length-1;e>=0;e--){var n=t[e];n&&(n.parent=null)}this._children.length=0},e.isChildOf=function(t){var e=this;do{if(e===t)return!0;e=e._parent}while(e);return!1},e.getComponent=function(t){var e=VC(t);return e?n._findComponent(this,e):null},e.getComponents=function(t){var e=VC(t),i=[];return e&&n._findComponents(this,e,i),i},e.getComponentInChildren=function(t){var e=VC(t);return e?n._findChildComponent(this._children,e):null},e.getComponentsInChildren=function(t){var e=VC(t),i=[];return e&&(n._findComponents(this,e,i),n._findChildComponents(this._children,e,i)),i},e.addComponent=function(t){var e;if("string"==typeof t){if(!(e=te(t)))throw h._RF.peek()&&O(3808,t),TypeError(F(3807,t))}else{if(!t)throw TypeError(F(3804));e=t}if("function"!=typeof e)throw TypeError(F(3809));if(!Ht(e,h.Component))throw TypeError(F(3810));var n=e._requireComponent;if(n)if(Array.isArray(n))for(var i=0;i<n.length;i++){var r=n[i];this.getComponent(r)||this.addComponent(r)}else{var a=n;this.getComponent(a)||this.addComponent(a)}var o=new e;return o.node=this,this._components.push(o),this._activeInHierarchy&&h.director._nodeActivator.activateComp(o),o},e.removeComponent=function(t){if(t){var e=null;(e=t instanceof xu?t:this.getComponent(t))&&e.destroy()}else O(3813)},e.on=function(t,e,n,i){switch(void 0===i&&(i=!1),t){case bC.TRANSFORM_CHANGED:this._eventMask|=1}this._eventProcessor.on(t,e,n,i)},e.off=function(t,e,n,i){if(void 0===i&&(i=!1),this._eventProcessor.off(t,e,n,i),!this._eventProcessor.hasEventListener(t))switch(t){case bC.TRANSFORM_CHANGED:this._eventMask&=-2}},e.once=function(t,e,n,i){this._eventProcessor.once(t,e,n,i)},e.emit=function(t,e,n,i,r,a){this._eventProcessor.emit(t,e,n,i,r,a)},e.dispatchEvent=function(t){this._eventProcessor.dispatchEvent(t)},e.hasEventListener=function(t,e,n){return this._eventProcessor.hasEventListener(t,e,n)},e.targetOff=function(t){this._eventProcessor.targetOff(t),1&this._eventMask&&!this._eventProcessor.hasEventListener(bC.TRANSFORM_CHANGED)&&(this._eventMask&=-2)},e.destroy=function(){return!!t.prototype.destroy.call(this)&&(this.active=!1,!0)},e.destroyAllChildren=function(){for(var t=this._children,e=0;e<t.length;++e)t[e].destroy()},e._removeComponent=function(t){if(t){if(!(this._objFlags&NC)){var e=this._components.indexOf(t);-1!==e?this._components.splice(e,1):t.node!==this&&O(3815)}}else O(3814)},e._updateSiblingIndex=function(){for(var t=0;t<this._children.length;++t)this._children[t]._siblingIndex=t;this.emit(bC.SIBLING_ORDER_CHANGED)},e._onSetParent=function(t){this._parent&&(null!=t&&t._scene===this._parent._scene||null==this._parent._scene||this.walk(n._setScene))},e._onPostActivated=function(){},e._onBatchCreated=function(){this._parent&&(this._siblingIndex=this._parent.children.indexOf(this))},e._onPreDestroy=function(){this._onPreDestroyBase()},e._onHierarchyChanged=function(t){return this._onHierarchyChangedBase(t)},e._instantiate=function(t,e){return t||(t=h.instantiate._clone(this,this)),t._prefab,t._parent=null,t._onBatchCreated(e),t},e._onHierarchyChangedBase=function(){var t=this._parent;!this._persistNode||t instanceof h.Scene||h.game.removePersistRootNode(this);var e=this._active&&!(!t||!t._activeInHierarchy);this._activeInHierarchy!==e&&h.director._nodeActivator.activateNode(this,e)},e._onPreDestroyBase=function(){this._objFlags|=NC;var t=this._parent,e=!!t&&0!=(t._objFlags&NC);if(this._persistNode&&h.game.removePersistRootNode(this),!e&&t){this.emit(bC.PARENT_CHANGED,this);var n=t._children.indexOf(this);t._children.splice(n,1),this._siblingIndex=0,t._updateSiblingIndex(),t.emit&&t.emit(bC.CHILD_REMOVED,this)}this.emit(bC.NODE_DESTROYED,this),this._eventProcessor.destroy();for(var i=this._children,r=0;r<i.length;++r)i[r]._destroyImmediate();for(var a=this._components,o=0;o<a.length;++o)a[o]._destroyImmediate();return e},Q(n,[{key:"components",get:function(){return this._components}},{key:"_persistNode",get:function(){return(this._objFlags&BC)>0},set:function(t){t?this._objFlags|=BC:this._objFlags&=~BC}},{key:"name",get:function(){return this._name},set:function(t){this._name=t}},{key:"uuid",get:function(){return this._id}},{key:"children",get:function(){return this._children}},{key:"active",get:function(){return this._active},set:function(t){if(t=!!t,this._active!==t){this._active=t;var e=this._parent;e&&e._activeInHierarchy&&h.director._nodeActivator.activateNode(this,t)}}},{key:"activeInHierarchy",get:function(){return this._activeInHierarchy}},{key:"parent",get:function(){return this._parent},set:function(t){this.setParent(t)}},{key:"scene",get:function(){return this._scene}},{key:"eventProcessor",get:function(){return this._eventProcessor}}]),n}(ml),RC.idGenerator=FC,RC._stacks=[[]],RC._stackId=0,lt((TC=MC).prototype,"_persistNode",[Dc],Object.getOwnPropertyDescriptor(TC.prototype,"_persistNode"),TC.prototype),lt(TC.prototype,"name",[Wc],Object.getOwnPropertyDescriptor(TC.prototype,"name"),TC.prototype),lt(TC.prototype,"children",[Wc],Object.getOwnPropertyDescriptor(TC.prototype,"children"),TC.prototype),lt(TC.prototype,"active",[Wc],Object.getOwnPropertyDescriptor(TC.prototype,"active"),TC.prototype),lt(TC.prototype,"activeInHierarchy",[Wc],Object.getOwnPropertyDescriptor(TC.prototype,"activeInHierarchy"),TC.prototype),lt(TC.prototype,"parent",[Wc],Object.getOwnPropertyDescriptor(TC.prototype,"parent"),TC.prototype),EC=lt(TC.prototype,"_parent",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wC=lt(TC.prototype,"_children",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),IC=lt(TC.prototype,"_active",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),PC=lt(TC.prototype,"_components",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),DC=lt(TC.prototype,"_prefab",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),CC=TC))||CC);h._BaseNode=JC;var QC=new Mn,ZC=new zn,$C=new zn,tT=new zn,eT=new Ln,nT=new Ln,iT=new Xn,rT=[],aT=[],oT=[],sT=function(){function t(){this._chunks=[],this._freelists=[],this._createChunk()}var e=t.prototype;return e.alloc=function(){for(var t=this._freelists.length,e=0;e<t;++e)if(this._freelists[e].length)return this._createView(e);return this._createChunk(),this._createView(t)},e.free=function(t,e){for(var n=this._freelists.length,i=0;i<n;++i)if(this._chunks[i]===t)return void this._freelists[i].push(e)},e.clear=function(){for(var t=this._chunks.length,e=0;e<t;++e)this._chunks[e].fill(0)},e._createChunk=function(){this._chunks.push(new Uint32Array(t.CAPACITY_PER_CHUNK));for(var e=[],n=t.CAPACITY_PER_CHUNK-1;n>=0;n--)e.push(n);this._freelists.push(e)},e._createView=function(t){return oT[0]=this._chunks[t],oT[1]=this._freelists[t].pop(),oT},t}();sT.CAPACITY_PER_CHUNK=256;var cT,lT,hT,uT,_T,fT,dT,pT,mT,vT,gT,yT,xT,ST,AT,bT,CT,TT,ET,wT,IT,PT,DT,RT,MT,OT,NT,BT,LT,FT,VT,zT,kT,UT,GT,HT,jT,WT,qT,XT,YT,KT,JT,QT,ZT,$T,tE,eE,nE,iE,rE,aE,oE,sE,cE,lE,hE,uE,_E,fE,dE,pE,mE,vE,gE,yE,xE,SE,AE,bE=new sT,CE=Symbol("ReserveContentsForAllSyncablePrefab"),TE=t("Node",(zC=Ec("cc.Node"),kC=cl(Mn),zC((KC=YC=function(t){$(n,t);var e=n.prototype;function n(e){var n;return(n=t.call(this,e)||this)._uiProps=new OC(at(n)),n._static=!1,ct(n,"_lpos",HC,at(n)),ct(n,"_lrot",jC,at(n)),ct(n,"_lscale",WC,at(n)),ct(n,"_layer",qC,at(n)),ct(n,"_euler",XC,at(n)),n._dirtyFlagsPri=Fy.NONE,n._eulerDirty=!1,n._nodeHandle=0,n._init(),n}return e._init=function(){var t=bE.alloc(),e=t[0],n=t[1];this._hasChangedFlagsChunk=e,this._hasChangedFlagsOffset=n;var i=new Uint32Array(e.buffer,e.byteOffset+4*n,1);this._hasChangedFlags=i,this._pos=new Mn,this._rot=new zn,this._scale=new Mn(1,1,1),this._mat=new Xn},n.isNode=function(t){return t instanceof n&&(t.constructor===n||!(t instanceof h.Scene))},e._onPreDestroy=function(){var t=this._onPreDestroyBase();return bE.free(this._hasChangedFlagsChunk,this._hasChangedFlagsOffset),t},e[Iu]=function(t){t.writeThis()},e.setParent=function(e,n){void 0===n&&(n=!1),n&&this.updateWorldTransform(),t.prototype.setParent.call(this,e,n)},e._onSetParent=function(e,n){if(t.prototype._onSetParent.call(this,e,n),n){var i=this._parent;i?(i.updateWorldTransform(),hn(Xn.determinant(i._mat),0,cn)?(R(14200),this._dirtyFlags|=Fy.TRS,this.updateWorldTransform()):(Xn.multiply(iT,Xn.invert(iT,i._mat),this._mat),Xn.toRTS(iT,this._lrot,this._lpos,this._lscale))):(Mn.copy(this._lpos,this._pos),zn.copy(this._lrot,this._rot),Mn.copy(this._lscale,this._scale)),this._eulerDirty=!0}this.invalidateChildren(Fy.TRS)},e._onHierarchyChanged=function(e){this.eventProcessor.reattach(),t.prototype._onHierarchyChangedBase.call(this,e)},e._onBatchCreated=function(t){this.hasChangedFlags=Fy.TRS,this._dirtyFlags|=Fy.TRS;for(var e=this._children.length,n=0;n<e;++n)this._children[n]._siblingIndex=n,this._children[n]._onBatchCreated(t)},e._onBeforeSerialize=function(){this.eulerAngles},e._onPostActivated=function(t){t?(this._eventProcessor.setEnabled(!0),this.invalidateChildren(Fy.TRS),this._uiProps&&this._uiProps.uiComp&&(this._uiProps.uiComp.setNodeDirty(),this._uiProps.uiComp.setTextureDirty(),this._uiProps.uiComp.markForUpdateRenderData())):this._eventProcessor.setEnabled(!1)},e.translate=function(t,e){var n=e||Ly.LOCAL;if(n===Ly.LOCAL)Mn.transformQuat(QC,t,this._lrot),this._lpos.x+=QC.x,this._lpos.y+=QC.y,this._lpos.z+=QC.z;else if(n===Ly.WORLD)if(this._parent){zn.invert(ZC,this._parent.worldRotation),Mn.transformQuat(QC,t,ZC);var i=this.worldScale;this._lpos.x+=QC.x/i.x,this._lpos.y+=QC.y/i.y,this._lpos.z+=QC.z/i.z}else this._lpos.x+=t.x,this._lpos.y+=t.y,this._lpos.z+=t.z;this.invalidateChildren(Fy.POSITION),1&this._eventMask&&this.emit(bC.TRANSFORM_CHANGED,Fy.POSITION)},e.rotate=function(t,e){var n=e||Ly.LOCAL;if(zn.normalize(ZC,t),n===Ly.LOCAL)zn.multiply(this._lrot,this._lrot,ZC);else if(n===Ly.WORLD){var i=this.worldRotation;zn.multiply($C,ZC,i),zn.invert(ZC,i),zn.multiply($C,ZC,$C),zn.multiply(this._lrot,this._lrot,$C)}this._eulerDirty=!0,this.invalidateChildren(Fy.ROTATION),1&this._eventMask&&this.emit(bC.TRANSFORM_CHANGED,Fy.ROTATION)},e.lookAt=function(t,e){this.getWorldPosition(QC),Mn.subtract(QC,QC,t),Mn.normalize(QC,QC),zn.fromViewUp(ZC,QC,e),this.setWorldRotation(ZC)},e._setDirtyNode=function(t,e){rT[t]=e},e.invalidateChildren=function(t){var e,n,i,r=0,a=0,o=0,s=0,c=0,l=t|Fy.POSITION;for(rT[0]=this;r>=0;){if(c=(e=rT[r--])._hasChangedFlags[0],s=e._dirtyFlagsPri,e.isValid&&(s&c&t)!==t)for(s|=t,e._dirtyFlagsPri=s,e._hasChangedFlags[0]=c|t,o=(i=e._children).length,a=0;a<o;a++)n=i[a],rT[++r]=n;t=l}},e.updateWorldTransform=function(){if(this._dirtyFlags){for(var t,e=this,n=0;e&&e._dirtyFlags;)this._setDirtyNode(n++,e),e=e._parent;for(var i=0;n;)i|=(t=rT[--n])._dirtyFlags,e?(i&Fy.POSITION&&(Mn.transformMat4(t._pos,t._lpos,e._mat),t._mat.m12=t._pos.x,t._mat.m13=t._pos.y,t._mat.m14=t._pos.z),i&Fy.RS&&(Xn.fromRTS(t._mat,t._lrot,t._lpos,t._lscale),Xn.multiply(t._mat,e._mat,t._mat),i&Fy.ROTATION&&zn.multiply(t._rot,e._rot,t._lrot),Ln.fromQuat(eT,zn.conjugate(tT,t._rot)),Ln.multiplyMat4(eT,eT,t._mat),t._scale.x=eT.m00,t._scale.y=eT.m04,t._scale.z=eT.m08)):(i&Fy.POSITION&&(Mn.copy(t._pos,t._lpos),t._mat.m12=t._pos.x,t._mat.m13=t._pos.y,t._mat.m14=t._pos.z),i&Fy.RS&&(i&Fy.ROTATION&&zn.copy(t._rot,t._lrot),i&Fy.SCALE&&(Mn.copy(t._scale,t._lscale),Xn.fromRTS(t._mat,t._rot,t._pos,t._scale)))),t._dirtyFlags=Fy.NONE,e=t}},e.setPosition=function(t,e,n){void 0===e&&void 0===n?Mn.copy(this._lpos,t):void 0===n?Mn.set(this._lpos,t,e,this._lpos.z):Mn.set(this._lpos,t,e,n),this.invalidateChildren(Fy.POSITION),1&this._eventMask&&this.emit(bC.TRANSFORM_CHANGED,Fy.POSITION)},e.getPosition=function(t){return t?Mn.set(t,this._lpos.x,this._lpos.y,this._lpos.z):Mn.copy(new Mn,this._lpos)},e.setRotation=function(t,e,n,i){void 0===e||void 0===n||void 0===i?zn.copy(this._lrot,t):zn.set(this._lrot,t,e,n,i),this._eulerDirty=!0,this.invalidateChildren(Fy.ROTATION),1&this._eventMask&&this.emit(bC.TRANSFORM_CHANGED,Fy.ROTATION)},e.setRotationFromEuler=function(t,e,n){var i=void 0===n?this._euler.z:n;void 0===e?(Mn.copy(this._euler,t),zn.fromEuler(this._lrot,t.x,t.y,t.z)):(Mn.set(this._euler,t,e,i),zn.fromEuler(this._lrot,t,e,i)),this._eulerDirty=!1,this.invalidateChildren(Fy.ROTATION),1&this._eventMask&&this.emit(bC.TRANSFORM_CHANGED,Fy.ROTATION)},e.getRotation=function(t){return t?zn.set(t,this._lrot.x,this._lrot.y,this._lrot.z,this._lrot.w):zn.copy(new zn,this._lrot)},e.setScale=function(t,e,n){void 0===e&&void 0===n?Mn.copy(this._lscale,t):void 0===n?Mn.set(this._lscale,t,e,this._lscale.z):Mn.set(this._lscale,t,e,n),this.invalidateChildren(Fy.SCALE),1&this._eventMask&&this.emit(bC.TRANSFORM_CHANGED,Fy.SCALE)},e.getScale=function(t){return t?Mn.set(t,this._lscale.x,this._lscale.y,this._lscale.z):Mn.copy(new Mn,this._lscale)},e.inverseTransformPoint=function(t,e){Mn.copy(t,e);for(var n=this,i=0;n._parent;)this._setDirtyNode(i++,n),n=n._parent;for(;i>=0;)Mn.transformInverseRTS(t,t,n._lrot,n._lpos,n._lscale),n=rT[--i];return t},e.setWorldPosition=function(t,e,n){void 0===e||void 0===n?Mn.copy(this._pos,t):Mn.set(this._pos,t,e,n);var i=this._parent,r=this._lpos;i?(i.updateWorldTransform(),Mn.transformMat4(r,this._pos,Xn.invert(iT,i._mat))):Mn.copy(r,this._pos),this.invalidateChildren(Fy.POSITION),1&this._eventMask&&this.emit(bC.TRANSFORM_CHANGED,Fy.POSITION)},e.getWorldPosition=function(t){return this.updateWorldTransform(),t?Mn.copy(t,this._pos):Mn.copy(new Mn,this._pos)},e.setWorldRotation=function(t,e,n,i){void 0===e||void 0===n||void 0===i?zn.copy(this._rot,t):zn.set(this._rot,t,e,n,i),this._parent?(this._parent.updateWorldTransform(),zn.multiply(this._lrot,zn.conjugate(this._lrot,this._parent._rot),this._rot)):zn.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(Fy.ROTATION),1&this._eventMask&&this.emit(bC.TRANSFORM_CHANGED,Fy.ROTATION)},e.setWorldRotationFromEuler=function(t,e,n){zn.fromEuler(this._rot,t,e,n),this._parent?(this._parent.updateWorldTransform(),zn.multiply(this._lrot,zn.conjugate(this._lrot,this._parent._rot),this._rot)):zn.copy(this._lrot,this._rot),this._eulerDirty=!0,this.invalidateChildren(Fy.ROTATION),1&this._eventMask&&this.emit(bC.TRANSFORM_CHANGED,Fy.ROTATION)},e.getWorldRotation=function(t){return this.updateWorldTransform(),t?zn.copy(t,this._rot):zn.copy(new zn,this._rot)},e.setWorldScale=function(t,e,n){void 0===e||void 0===n?Mn.copy(this._scale,t):Mn.set(this._scale,t,e,n);var i=this._parent;i?(i.updateWorldTransform(),Ln.fromQuat(eT,zn.conjugate(tT,i._rot)),Ln.multiplyMat4(eT,eT,i._mat),nT.m00=this._scale.x,nT.m04=this._scale.y,nT.m08=this._scale.z,Ln.multiply(eT,nT,Ln.invert(eT,eT)),this._lscale.x=Mn.set(QC,eT.m00,eT.m01,eT.m02).length(),this._lscale.y=Mn.set(QC,eT.m03,eT.m04,eT.m05).length(),this._lscale.z=Mn.set(QC,eT.m06,eT.m07,eT.m08).length()):Mn.copy(this._lscale,this._scale),this.invalidateChildren(Fy.SCALE),1&this._eventMask&&this.emit(bC.TRANSFORM_CHANGED,Fy.SCALE)},e.getWorldScale=function(t){return this.updateWorldTransform(),t?Mn.copy(t,this._scale):Mn.copy(new Mn,this._scale)},e.getWorldMatrix=function(t){this.updateWorldTransform();var e=t||new Xn;return Xn.copy(e,this._mat)},e.getWorldRS=function(t){this.updateWorldTransform();var e=t||new Xn;return Xn.copy(e,this._mat),e.m12=0,e.m13=0,e.m14=0,e},e.getWorldRT=function(t){this.updateWorldTransform();var e=t||new Xn;return Xn.fromRT(e,this._rot,this._pos)},e.setRTS=function(t,e,n){var i=0;t&&(i|=Fy.ROTATION,void 0!==t.w?(zn.copy(this._lrot,t),this._eulerDirty=!0):(Mn.copy(this._euler,t),zn.fromEuler(this._lrot,t.x,t.y,t.z),this._eulerDirty=!1)),e&&(Mn.copy(this._lpos,e),i|=Fy.POSITION),n&&(Mn.copy(this._lscale,n),i|=Fy.SCALE),i&&(this.invalidateChildren(i),1&this._eventMask&&this.emit(bC.TRANSFORM_CHANGED,i))},e.pauseSystemEvents=function(t){this._eventProcessor.setEnabled(!1,t)},e.resumeSystemEvents=function(t){this._eventProcessor.setEnabled(!0,t)},n.resetHasChangedFlags=function(){bE.clear()},n.clearNodeArray=function(){n.ClearFrame<n.ClearRound?n.ClearFrame++:(n.ClearFrame=0,rT.length=0,aT.length=0)},e.getPathInHierarchy=function(){for(var t=this.name,e=this.parent;e&&e instanceof n;)t=e.name+"/"+t,e=e.parent;return t},Q(n,[{key:"_dirtyFlags",get:function(){return this._dirtyFlagsPri},set:function(t){this._dirtyFlagsPri=t}},{key:"native",get:function(){return this._nativeObj}},{key:"position",get:function(){return this._lpos},set:function(t){this.setPosition(t)}},{key:"worldPosition",get:function(){return this.updateWorldTransform(),this._pos},set:function(t){this.setWorldPosition(t)}},{key:"rotation",get:function(){return this._lrot},set:function(t){this.setRotation(t)}},{key:"eulerAngles",get:function(){return this._eulerDirty&&(zn.toEuler(this._euler,this._lrot),this._eulerDirty=!1),this._euler},set:function(t){this.setRotationFromEuler(t.x,t.y,t.z)}},{key:"angle",get:function(){return this._euler.z},set:function(t){Mn.set(this._euler,0,0,t),zn.fromAngleZ(this._lrot,t),this._eulerDirty=!1,this.invalidateChildren(Fy.ROTATION),1&this._eventMask&&this.emit(bC.TRANSFORM_CHANGED,Fy.ROTATION)}},{key:"worldRotation",get:function(){return this.updateWorldTransform(),this._rot},set:function(t){this.setWorldRotation(t)}},{key:"scale",get:function(){return this._lscale},set:function(t){this.setScale(t)}},{key:"worldScale",get:function(){return this.updateWorldTransform(),this._scale},set:function(t){this.setWorldScale(t)}},{key:"matrix",set:function(t){Xn.toRTS(t,this._lrot,this._lpos,this._lscale),this.invalidateChildren(Fy.TRS),this._eulerDirty=!0,1&this._eventMask&&this.emit(bC.TRANSFORM_CHANGED,Fy.TRS)}},{key:"worldMatrix",get:function(){return this.updateWorldTransform(),this._mat}},{key:"forward",get:function(){return Mn.transformQuat(new Mn,Mn.FORWARD,this.worldRotation)},set:function(t){var e=t.length();Mn.multiplyScalar(QC,t,-1/e),zn.fromViewUp(ZC,QC),this.setWorldRotation(ZC)}},{key:"up",get:function(){return Mn.transformQuat(new Mn,Mn.UP,this.worldRotation)}},{key:"right",get:function(){return Mn.transformQuat(new Mn,Mn.RIGHT,this.worldRotation)}},{key:"layer",get:function(){return this._layer},set:function(t){this._layer=t,this._uiProps&&this._uiProps.uiComp&&(this._uiProps.uiComp.setNodeDirty(),this._uiProps.uiComp.markForUpdateRenderData()),this.emit(bC.LAYER_CHANGED,this._layer)}},{key:"hasChangedFlags",get:function(){return this._hasChangedFlagsChunk[this._hasChangedFlagsOffset]},set:function(t){this._hasChangedFlagsChunk[this._hasChangedFlagsOffset]=t}}]),n}(JC),YC.EventType=bC,YC.NodeSpace=Ly,YC.TransformDirtyBit=Fy,YC.TransformBit=Fy,YC.reserveContentsForAllSyncablePrefabTag=CE,YC.ClearFrame=0,YC.ClearRound=1e3,HC=lt((GC=KC).prototype,"_lpos",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Mn}}),jC=lt(GC.prototype,"_lrot",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new zn}}),WC=lt(GC.prototype,"_lscale",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Mn(1,1,1)}}),qC=lt(GC.prototype,"_layer",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Hd.Enum.DEFAULT}}),XC=lt(GC.prototype,"_euler",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Mn}}),lt(GC.prototype,"eulerAngles",[kC],Object.getOwnPropertyDescriptor(GC.prototype,"eulerAngles"),GC.prototype),lt(GC.prototype,"angle",[Wc],Object.getOwnPropertyDescriptor(GC.prototype,"angle"),GC.prototype),lt(GC.prototype,"layer",[Wc],Object.getOwnPropertyDescriptor(GC.prototype,"layer"),GC.prototype),UC=GC))||UC));h.Node=TE;var EE=Ec("cc.TargetInfo")((hT=lt((lT=function(){ct(this,"localID",hT,this)}).prototype,"localID",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cT=lT))||cT,wE=(uT=Ec("cc.TargetOverrideInfo"),_T=cl(ml),fT=cl(EE),dT=cl(TE),pT=cl(EE),uT((gT=lt((vT=function(){ct(this,"source",gT,this),ct(this,"sourceInfo",yT,this),ct(this,"propertyPath",xT,this),ct(this,"target",ST,this),ct(this,"targetInfo",AT,this)}).prototype,"source",[Nc,_T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yT=lt(vT.prototype,"sourceInfo",[Nc,fT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xT=lt(vT.prototype,"propertyPath",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ST=lt(vT.prototype,"target",[Nc,dT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),AT=lt(vT.prototype,"targetInfo",[Nc,pT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mT=vT))||mT),IE=Ec("cc.CompPrefabInfo")((TT=lt((CT=function(){ct(this,"fileId",TT,this)}).prototype,"fileId",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),bT=CT))||bT,PE=(ET=Ec("CCPropertyOverrideInfo"),wT=cl(EE),ET((OT=function(){function t(){ct(this,"targetInfo",DT,this),ct(this,"propertyPath",RT,this),ct(this,"value",MT,this)}return t.prototype.isTarget=function(){},t}(),DT=lt((PT=OT).prototype,"targetInfo",[Nc,wT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),RT=lt(PT.prototype,"propertyPath",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),MT=lt(PT.prototype,"value",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),IT=PT))||IT),DE=(NT=Ec("cc.MountedChildrenInfo"),BT=cl(EE),LT=cl([TE]),NT((UT=function(){function t(){ct(this,"targetInfo",zT,this),ct(this,"nodes",kT,this)}return t.prototype.isTarget=function(){},t}(),zT=lt((VT=UT).prototype,"targetInfo",[Nc,BT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kT=lt(VT.prototype,"nodes",[Nc,LT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),FT=VT))||FT),RE=(GT=Ec("cc.MountedComponentsInfo"),HT=cl(EE),jT=cl([xu]),GT((KT=function(){function t(){ct(this,"targetInfo",XT,this),ct(this,"components",YT,this)}return t.prototype.isTarget=function(){},t}(),XT=lt((qT=KT).prototype,"targetInfo",[Nc,HT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),YT=lt(qT.prototype,"components",[Nc,jT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),WT=qT))||WT),ME=(JT=Ec("cc.PrefabInstance"),QT=cl(TE),ZT=cl([DE]),$T=cl([RE]),tE=cl([PE]),eE=cl([EE]),JT((hE=function(){function t(){ct(this,"fileId",rE,this),ct(this,"prefabRootNode",aE,this),ct(this,"mountedChildren",oE,this),ct(this,"mountedComponents",sE,this),ct(this,"propertyOverrides",cE,this),ct(this,"removedComponents",lE,this),this.targetMap={}}var e=t.prototype;return e.findPropertyOverride=function(){},e.removePropertyOverride=function(){},t}(),rE=lt((iE=hE).prototype,"fileId",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),aE=lt(iE.prototype,"prefabRootNode",[Nc,QT],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oE=lt(iE.prototype,"mountedChildren",[Nc,ZT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sE=lt(iE.prototype,"mountedComponents",[Nc,$T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cE=lt(iE.prototype,"propertyOverrides",[Nc,tE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lE=lt(iE.prototype,"removedComponents",[Nc,eE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nE=iE))||nE),OE=(uE=Ec("cc.PrefabInfo"),_E=cl(TE),fE=cl(ME),dE=cl([wE]),uE((vE=lt((mE=function(){ct(this,"root",vE,this),ct(this,"asset",gE,this),ct(this,"fileId",yE,this),ct(this,"instance",xE,this),ct(this,"targetOverrides",SE,this),ct(this,"nestedPrefabInstanceRoots",AE,this)}).prototype,"root",[Nc,_E],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gE=lt(mE.prototype,"asset",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yE=lt(mE.prototype,"fileId",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),xE=lt(mE.prototype,"instance",[Nc,fE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),SE=lt(mE.prototype,"targetOverrides",[Nc,dE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AE=lt(mE.prototype,"nestedPrefabInstanceRoots",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),pE=mE))||pE);function NE(t){var e=t._prefab;if(e&&e.instance){if(!e.asset)return O(3701,t.name),void(e.instance=void 0);var n=t._objFlags,i=t._parent,r=t._id,a=t._prefab;t[ul],h.game._isCloning=!0;var o=e.asset.data;o._iN$t=t,h.instantiate._clone(o,o),h.game._isCloning=!1,t._objFlags=n,t._parent=i,t._id=r,t._prefab&&(t._prefab.instance=null==a?void 0:a.instance)}}function BE(t,e,n){var i;if(e&&t){var r=e,a=null===(i=t._prefab)||void 0===i?void 0:i.instance;!n&&a&&(e[a.fileId]={},r=e[a.fileId]);var o=t._prefab;o&&(r[o.fileId]=t);for(var s=t.components,c=0;c<s.length;c++){var l=s[c];l.__prefab&&(r[l.__prefab.fileId]=l)}for(var h=0;h<t.children.length;h++)BE(t.children[h],r,!1)}}function LE(t,e){if(!t)return null;for(var n=e,i=0;i<t.length;i++){if(!n)return null;n=n[t[i]]}return n}function FE(t,e,n){if(e)for(var i=0;i<e.length;i++){var r=e[i];if(r&&r.targetInfo){var a=LE(r.targetInfo.localID,n);if(!a)continue;var o=n,s=r.targetInfo.localID;if(s.length>0)for(var c=0;c<s.length-1;c++)o=o[s[c]];if(r.nodes)for(var l=0;l<r.nodes.length;l++){var h=r.nodes[l];h&&!a._children.includes(h)&&(a._children.push(h),h._parent=a,BE(h,o,!1),h._siblingIndex=a._children.length-1,GE(h,!0))}}}}function VE(t,e,n){if(e)for(var i=0;i<e.length;i++){var r=e[i];if(r&&r.targetInfo){var a=LE(r.targetInfo.localID,n);if(!a)continue;if(r.components)for(var o=0;o<r.components.length;o++){var s=r.components[o];s&&(s.node=a,a._components.push(s))}}}}function zE(t,e,n){if(e)for(var i=0;i<e.length;i++){var r=e[i];if(r){var a=LE(r.localID,n);if(!a||!a.node)continue;var o=a.node.components.indexOf(a);o>=0&&a.node._components.splice(o,1)}}}function kE(t,e,n){if(!(e.length<=0))for(var i=null,r=0;r<e.length;r++){var a=e[r];if(a&&a.targetInfo){if(!(i=LE(a.targetInfo.localID,n)))continue;var o=i,s=a.propertyPath.slice();if(s.length>0){var c=s.pop();if(!c)continue;for(var l=0;l<s.length&&(o=o[s[l]]);l++);if(!o)continue;if(Array.isArray(o))if("length"===c)o[c]=a.value;else{var h=Number.parseInt(c);Number.isInteger(h)&&h<o.length&&(o[c]=a.value)}else o[c]instanceof ue?o[c].set(a.value):o[c]=a.value}}}}function UE(t){var e,n=null===(e=t._prefab)||void 0===e?void 0:e.targetOverrides;if(n)for(var i=0;i<n.length;i++){var r,a,o=n[i],s=o.source,c=o.sourceInfo;if(c){var l,h,u=null===(l=o.source)||void 0===l||null===(h=l._prefab)||void 0===h?void 0:h.instance;u&&u.targetMap&&(s=LE(c.localID,u.targetMap))}if(s){var _,f=o.targetInfo;if(f){var d=null===(r=o.target)||void 0===r||null===(a=r._prefab)||void 0===a?void 0:a.instance;if(d&&d.targetMap&&(_=LE(f.localID,d.targetMap))){var p=o.propertyPath.slice(),m=s;if(p.length>0){var v=p.pop();if(!v)return;for(var g=0;g<p.length&&(m=m[p[g]]);g++);if(!m)continue;m[v]=_}}}}}}function GE(t,e){void 0===e&&(e=!1);var n=t._prefab,i=null==n?void 0:n.instance;if(i){NE(t);var r={};i.targetMap=r,BE(t,r,!0),FE(0,i.mountedChildren,r),zE(0,i.removedComponents,r),VE(0,i.mountedComponents,r),kE(0,i.propertyOverrides,r)}e&&t&&t.children&&t.children.forEach((function(t){GE(t,!0)}))}function HE(t){var e=t._prefab;e&&e.nestedPrefabInstanceRoots&&e.nestedPrefabInstanceRoots.forEach((function(t){GE(t)}))}h._PrefabInfo=OE;var jE,WE,qE,XE,YE,KE,JE,QE,ZE,$E,tw,ew,nw,iw,rw=Object.freeze({__proto__:null,TargetInfo:EE,TargetOverrideInfo:wE,CompPrefabInfo:IE,PropertyOverrideInfo:PE,MountedChildrenInfo:DE,MountedComponentsInfo:RE,PrefabInstance:ME,PrefabInfo:OE,createNodeWithPrefab:NE,generateTargetMap:BE,getTarget:LE,applyMountedChildren:FE,applyMountedComponents:VE,applyRemovedComponents:zE,applyPropertyOverrides:kE,applyTargetOverrides:UE,expandPrefabInstanceNode:GE,expandNestedPrefabInstanceNode:HE}),aw=se({AUTO:0,SINGLE_INSTANCE:1,MULTI_INSTANCE:2}),ow=t("Prefab",Ec("cc.Prefab")((JE=KE=function(t){function e(){var e;return ct(e=t.call(this)||this,"data",qE,at(e)),ct(e,"optimizationPolicy",XE,at(e)),ct(e,"persistent",YE,at(e)),e._createFunction=void 0,e._instantiatedTimes=void 0,e._createFunction=null,e._instantiatedTimes=0,e}$(e,t);var n=e.prototype;return n.createNode=function(t){var e=h.instantiate(this);e.name=this.name,t(null,e)},n.compileCreateFunction=function(){var t,e;this._createFunction=(e=(t=this.data)instanceof h._BaseNode&&t,new SC(t,e).result)},n._doInstantiate=function(t){return this.data._prefab||R(3700),this._createFunction||this.compileCreateFunction(),this._createFunction(t)},n._instantiate=function(){var t;return t=this.data._instantiate(),++this._instantiatedTimes,t},n.initDefault=function(e){t.prototype.initDefault.call(this,e),this.data=new TE,this.data.name="(Missing Node)";var n=new h._PrefabInfo;n.asset=this,n.root=this.data,this.data._prefab=n},n.validate=function(){return!!this.data},n.onLoaded=function(){var t=this.data;HE(t),UE(t)},e}($h),KE.OptimizationPolicy=aw,KE.OptimizationPolicyThreshold=3,qE=lt((WE=JE).prototype,"data",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),XE=lt(WE.prototype,"optimizationPolicy",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return aw.AUTO}}),YE=lt(WE.prototype,"persistent",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),jE=WE))||jE);re.value(ow,"_utils",rw),h.Prefab=ow,Rt(h,"cc._Prefab","Prefab"),t("PrefabLink",(QE=Ec("cc.PrefabLink"),ZE=cl(ow),$E=qc(),QE((iw=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"prefab",nw,at(e)),e}return $(e,t),e}(xu),nw=lt((ew=iw).prototype,"prefab",[ZE,Nc,$E],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tw=ew))||tw));var sw=new Mn;function cw(t,e,n,i){i||(i=new Mn),t.convertToUINode(e,n,i);var r=n.position;return i.add(r),i}function lw(t,e,n){return n||(n=new Mn),t.worldToScreen(e,n),n.x/=h.view.getScaleX(),n.y/=h.view.getScaleY(),n}var hw,uw,_w=t("convertUtils",{WorldNode3DToLocalNodeUI:cw,WorldNode3DToWorldNodeUI:lw});h.pipelineUtils=_w,k(h.pipelineUtils,"cc.pipelineUtils",[{name:"WorldNode3DToLocalNodeUI",newName:"convertToUINode",targetName:"cc.Camera.prototype",customFunction:function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=e[0],r=e[3]||sw;return i.convertToUINode(e[1],e[2],r),r.add(e[2].position),e[3]||r.clone()}}]),U(sv.prototype,"TextureBase.prototype",[{name:"hasPremultipliedAlpha"},{name:"setPremultiplyAlpha"},{name:"setFlipY"}]),k(tb.prototype,"RenderTexture.prototype",[{name:"getGFXWindow",customFunction:function(){return this._window}}]);var fw,dw=t("BufferAsset",Ec("cc.BufferAsset")((lt((uw=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._buffer=null,e}$(e,t);var n=e.prototype;return n.buffer=function(){return this._buffer},n.validate=function(){return!!this.buffer},Q(e,[{key:"_nativeAsset",get:function(){return this._buffer},set:function(t){t instanceof ArrayBuffer?this._buffer=t:this._buffer=t.buffer}}]),e}($h)).prototype,"_nativeAsset",[hl],Object.getOwnPropertyDescriptor(uw.prototype,"_nativeAsset"),uw.prototype),hw=uw))||hw);h.BufferAsset=dw;var pw=((fw={})[vi.UNORM]="Uint",fw[vi.SNORM]="Int",fw[vi.UINT]="Uint",fw[vi.INT]="Int",fw[vi.UFLOAT]="Float",fw[vi.FLOAT]="Float",fw.default="Uint",fw);function mw(t){return""+(pw[t.type]||pw.default)+t.size/t.count*8}function vw(t,e,n,i,r){void 0===n&&(n=mi.R32F),void 0===i&&(i=0),void 0===r&&(r=0);var a=aa[n];r||(r=a.size);for(var o="set"+mw(a),s=a.size/a.count,c=Math.floor(e.length/a.count),l=wu.isLittleEndian,h=0;h<c;++h)for(var u=i+r*h,_=0;_<a.count;++_){var f=u+s*_;t[o](f,e[a.count*h+_],l)}}function gw(t,e,n,i,r,a){void 0===e&&(e=mi.R32F),void 0===n&&(n=0),void 0===i&&(i=t.byteLength-n),void 0===r&&(r=0),void 0===a&&(a=[]);var o=aa[e];r||(r=o.size);for(var s="get"+mw(o),c=o.size/o.count,l=Math.floor(i/r),h=wu.isLittleEndian,u=0;u<l;++u)for(var _=n+r*u,f=0;f<o.count;++f){var d=_+c*f;a[o.count*u+f]=t[s](d,h)}return a}function yw(t,e,n,i,r,a,o){void 0===n&&(n=mi.R32F),void 0===i&&(i=0),void 0===r&&(r=t.byteLength-i),void 0===a&&(a=0),o||(o=new DataView(t.buffer.slice(t.byteOffset,t.byteOffset+t.byteLength)));var s=aa[n];a||(a=s.size);for(var c="set"+mw(s),l="get"+mw(s),h=s.size/s.count,u=Math.floor(r/a),_=wu.isLittleEndian,f=0;f<u;++f)for(var d=i+a*f,p=0;p<s.count;++p){var m=d+h*p,v=t[l](m,_);o[c](m,e(v,p,t),_)}return o}var xw,Sw,Aw=t("RenderingSubMesh",function(){var t=e.prototype;function e(t,e,n,i,r,a){void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=!0),this.mesh=void 0,this.subMeshIdx=void 0,this._flatBuffers=[],this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0,this._vertexIdChannel=void 0,this._geometricInfo=void 0,this._vertexBuffers=void 0,this._attributes=void 0,this._indexBuffer=null,this._indirectBuffer=null,this._primitiveMode=void 0,this._iaInfo=void 0,this._isOwnerOfIndexBuffer=!0,this._attributes=e,this._vertexBuffers=t,this._indexBuffer=i,this._indirectBuffer=r,this._primitiveMode=n,this._iaInfo=new Fr(e,t,i,r),this._isOwnerOfIndexBuffer=a,this._init()}return t._init=function(){},t.genFlatBuffers=function(){if(!this._flatBuffers.length&&this.mesh&&void 0!==this.subMeshIdx){var t=this.mesh,e=0,n=t.struct.primitives[this.subMeshIdx];n.indexView&&(e=n.indexView.count);for(var i=0;i<n.vertexBundelIndices.length;i++){var r=n.vertexBundelIndices[i],a=t.struct.vertexBundles[r],o=n.indexView?n.indexView.count:a.view.count,s=a.view.stride,c=s*o,l=new Uint8Array(t.data.buffer,a.view.offset,a.view.length),h=new Uint8Array(n.indexView?c:a.view.length);if(n.indexView){for(var u=t.readIndices(this.subMeshIdx),_=0;_<e;++_)for(var f=_*s,d=u[_]*s,p=0;p<s;++p)h[f+p]=l[d+p];this._flatBuffers.push({stride:s,count:o,buffer:h})}else h.set(t.data.subarray(a.view.offset,a.view.offset+a.view.length)),this._flatBuffers.push({stride:s,count:o,buffer:h})}}},t.destroy=function(){for(var t=0;t<this.vertexBuffers.length;t++)this.vertexBuffers[t].destroy();if(this.vertexBuffers.length=0,this._indexBuffer&&(this._isOwnerOfIndexBuffer&&this._indexBuffer.destroy(),this._indexBuffer=null),this._jointMappedBuffers&&this._jointMappedBufferIndices){for(var e=0;e<this._jointMappedBufferIndices.length;e++)this._jointMappedBuffers[this._jointMappedBufferIndices[e]].destroy();this._jointMappedBuffers=void 0,this._jointMappedBufferIndices=void 0}this._indirectBuffer&&(this._indirectBuffer.destroy(),this._indirectBuffer=null)},t.enableVertexIdChannel=function(t){if(!this._vertexIdChannel){var e=this.vertexBuffers.length,n=this.attributes.length,i=this._allocVertexIdBuffer(t);this._vertexBuffers.push(i),this._attributes.push(new Br("a_vertexId",mi.R32F,!1,e)),this._iaInfo.attributes=this._attributes,this._iaInfo.vertexBuffers=this._vertexBuffers,this._vertexIdChannel={stream:e,index:n}}},t._allocVertexIdBuffer=function(t){for(var e=0===this.vertexBuffers.length||0===this.vertexBuffers[0].stride?0:this.vertexBuffers[0].size/this.vertexBuffers[0].stride,n=new Float32Array(e),i=0;i<e;++i)n[i]=i+.5;var r=t.createBuffer(new gr(yi.VERTEX|yi.TRANSFER_DST,Ai.DEVICE,n.byteLength,n.BYTES_PER_ELEMENT));return r.update(n),r},Q(e,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexBuffers",get:function(){return this._vertexBuffers}},{key:"indexBuffer",get:function(){return this._indexBuffer}},{key:"indirectBuffer",get:function(){return this._indirectBuffer}},{key:"primitiveMode",get:function(){return this._primitiveMode}},{key:"geometricInfo",get:function(){if(this._geometricInfo)return this._geometricInfo;if(void 0===this.mesh)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Mn.ZERO,max:Mn.ZERO}};if(void 0===this.subMeshIdx)return{positions:new Float32Array,indices:new Uint8Array,boundingBox:{min:Mn.ZERO,max:Mn.ZERO}};var t=this.mesh,e=this.subMeshIdx,n=t.readAttribute(e,nr.ATTR_POSITION),i=t.readIndices(e),r=new Mn,a=new Mn,o=this.attributes.find((function(t){return t.name===nr.ATTR_POSITION}));if(o){var s=aa[o.format].count;2===s?(r.set(n[0],n[1],0),a.set(n[0],n[1],0)):(r.set(n[0],n[1],n[2]),a.set(n[0],n[1],n[2]));for(var c=0;c<n.length;c+=s)2===s?(r.x=n[c]>r.x?n[c]:r.x,r.y=n[c+1]>r.y?n[c+1]:r.y,a.x=n[c]<a.x?n[c]:a.x,a.y=n[c+1]<a.y?n[c+1]:a.y):(r.x=n[c]>r.x?n[c]:r.x,r.y=n[c+1]>r.y?n[c+1]:r.y,r.z=n[c+2]>r.z?n[c+2]:r.z,a.x=n[c]<a.x?n[c]:a.x,a.y=n[c+1]<a.y?n[c+1]:a.y,a.z=n[c+2]<a.z?n[c+2]:a.z)}return this._geometricInfo={positions:n,indices:i,boundingBox:{max:r,min:a}},this._geometricInfo}},{key:"flatBuffers",get:function(){return this._flatBuffers}},{key:"jointMappedBuffers",get:function(){var t=this;if(this._jointMappedBuffers)return this._jointMappedBuffers;var e=this._jointMappedBuffers=[],n=this._jointMappedBufferIndices=[];if(!this.mesh||void 0===this.subMeshIdx)return this._jointMappedBuffers=this.vertexBuffers;var i,r,a=this.mesh.struct,o=a.primitives[this.subMeshIdx];if(!a.jointMaps||void 0===o.jointMapIndex||!a.jointMaps[o.jointMapIndex])return this._jointMappedBuffers=this.vertexBuffers;for(var s=h.director.root.device,c=0;c<o.vertexBundelIndices.length;c++){var l=a.vertexBundles[o.vertexBundelIndices[c]];r=0,i=mi.UNKNOWN;for(var u=0;u<l.attributes.length;u++){var _=l.attributes[u];if(_.name===nr.ATTR_JOINTS){i=_.format;break}r+=aa[_.format].size}i?function(){var h=new Uint8Array(t.mesh.data.buffer,l.view.offset,l.view.length),u=new DataView(h.slice().buffer),_=a.jointMaps[o.jointMapIndex];yw(u,(function(t){return _.indexOf(t)}),i,r,l.view.length,l.view.stride,u);var f=s.createBuffer(new gr(yi.VERTEX|yi.TRANSFER_DST,Ai.DEVICE,l.view.length,l.view.stride));f.update(u.buffer),e.push(f),n.push(c)}():e.push(this.vertexBuffers[o.vertexBundelIndices[c]])}return this._vertexIdChannel&&e.push(this._allocVertexIdBuffer(s)),e}},{key:"iaInfo",get:function(){return this._iaInfo}}]),e}());!function(t){t.TOUCH_START="touch-start",t.TOUCH_MOVE="touch-move",t.TOUCH_END="touch-end",t.TOUCH_CANCEL="touch-cancel",t.MOUSE_DOWN="mouse-down",t.MOUSE_MOVE="mouse-move",t.MOUSE_UP="mouse-up",t.MOUSE_WHEEL="mouse-wheel",t.MOUSE_ENTER="mouse-enter",t.MOUSE_LEAVE="mouse-leave",t.KEY_DOWN="keydown",t.KEY_UP="keyup",t.DEVICEMOTION="devicemotion",t.TRANSFORM_CHANGED="transform-changed",t.SCENE_CHANGED_FOR_PERSISTS="scene-changed-for-persists",t.SIZE_CHANGED="size-changed",t.ANCHOR_CHANGED="anchor-changed",t.COLOR_CHANGED="color-changed",t.CHILD_ADDED="child-added",t.CHILD_REMOVED="child-removed",t.PARENT_CHANGED="parent-changed",t.NODE_DESTROYED="node-destroyed",t.LAYER_CHANGED="layer-changed",t.SIBLING_ORDER_CHANGED="sibling-order-changed"}(xw||(xw=t("SystemEventType",{}))),function(t){t.TOUCH_START="touch-start",t.TOUCH_MOVE="touch-move",t.TOUCH_END="touch-end",t.TOUCH_CANCEL="touch-cancel",t.MOUSE_DOWN="mouse-down",t.MOUSE_MOVE="mouse-move",t.MOUSE_UP="mouse-up",t.MOUSE_WHEEL="mouse-wheel",t.KEY_DOWN="keydown",t.KEY_PRESSING="key-pressing",t.KEY_UP="keyup",t.DEVICEMOTION="devicemotion"}(Sw||(Sw={})),h.SystemEventType=xw;var bw,Cw=new Array(16),Tw=null,Ew=new Qn,ww=[bC.TOUCH_START,bC.TOUCH_MOVE,bC.TOUCH_END,bC.TOUCH_CANCEL],Iw=[bC.MOUSE_DOWN,bC.MOUSE_ENTER,bC.MOUSE_MOVE,bC.MOUSE_LEAVE,bC.MOUSE_UP,bC.MOUSE_WHEEL];!function(t){t[t.ADD_POINTER_EVENT_PROCESSOR=0]="ADD_POINTER_EVENT_PROCESSOR",t[t.REMOVE_POINTER_EVENT_PROCESSOR=1]="REMOVE_POINTER_EVENT_PROCESSOR",t[t.MARK_LIST_DIRTY=2]="MARK_LIST_DIRTY"}(bw||(bw={}));var Pw,Dw,Rw,Mw,Ow,Nw,Bw,Lw,Fw,Vw,zw,kw,Uw,Gw,Hw,jw,Ww,qw,Xw,Yw,Kw,Jw,Qw,Zw,$w,tI,eI,nI,iI,rI,aI,oI,sI,cI,lI,hI,uI,_I,fI,dI,pI,mI,vI,gI,yI,xI,SI,AI,bI,CI,TI,EI,wI,II,PI,DI,RI,MI,OI,NI,BI,LI,FI,VI,zI,kI,UI,GI,HI,jI,WI,qI,XI,YI,KI,JI,QI,ZI,$I,tP,eP,nP,iP,rP,aP,oP,sP,cP,lP,hP,uP,_P,fP,dP,pP,mP,vP,gP,yP,xP,SP,AP,bP,CP,TP,EP,wP,IP,PP,DP,RP,MP,OP,NP,BP,LP,FP,VP,zP,kP,UP,GP,HP,jP,WP,qP,XP,YP,KP,JP,QP,ZP,$P,tD,eD,nD,iD,rD,aD,oD,sD=function(){function t(t){this.claimedTouchIdList=[],this.maskList=null,this.cachedCameraPriority=0,this.previousMouseIn=!1,this.bubblingTarget=null,this.capturingTarget=null,this.shouldHandleEventMouse=!1,this.shouldHandleEventTouch=!1,this._isEnabled=!1,this._node=void 0,this._node=t}var e=t.prototype;return e.setEnabled=function(e,n){if(void 0===n&&(n=!1),this._isEnabled!==e){this._isEnabled=e;var i=this.node.children;if(e&&this._attachMask(),t.callbacksInvoker.emit(bw.MARK_LIST_DIRTY),n&&i.length>0)for(var r=0;r<i.length;++r)i[r]._eventProcessor.setEnabled(e,!0)}},e.reattach=function(){var e,n=this;this.node.walk((function(i){e||(e=n._searchComponentsInParent(t._maskComp)),i.eventProcessor.maskList=e}))},e.destroy=function(){Tw===this._node&&(Tw=null),this.capturingTarget&&this.capturingTarget.clear(),this.bubblingTarget&&this.bubblingTarget.clear(),t.callbacksInvoker.emit(bw.REMOVE_POINTER_EVENT_PROCESSOR,this)},e.on=function(t,e,n,i){var r,a;return this._tryEmittingAddEvent(t),((i=!!i)?null!==(r=this.capturingTarget)&&void 0!==r?r:this.capturingTarget=this._newCallbacksInvoker():null!==(a=this.bubblingTarget)&&void 0!==a?a:this.bubblingTarget=this._newCallbacksInvoker()).on(t,e,n),e},e.once=function(t,e,n,i){var r,a;return this._tryEmittingAddEvent(t),((i=!!i)?null!==(r=this.capturingTarget)&&void 0!==r?r:this.capturingTarget=this._newCallbacksInvoker():null!==(a=this.bubblingTarget)&&void 0!==a?a:this.bubblingTarget=this._newCallbacksInvoker()).on(t,e,n,!0),e},e.off=function(t,e,n,i){var r;null===(r=(i=!!i)?this.capturingTarget:this.bubblingTarget)||void 0===r||r.off(t,e,n)},e.targetOff=function(e){var n,i;null===(n=this.capturingTarget)||void 0===n||n.removeAll(e),null===(i=this.bubblingTarget)||void 0===i||i.removeAll(e),this.shouldHandleEventTouch&&!this._hasTouchListeners()&&(this.shouldHandleEventTouch=!1),this.shouldHandleEventMouse&&!this._hasMouseListeners()&&(this.shouldHandleEventMouse=!1),this._hasPointerListeners()||t.callbacksInvoker.emit(bw.REMOVE_POINTER_EVENT_PROCESSOR,this)},e.emit=function(t,e,n,i,r,a){var o;null===(o=this.bubblingTarget)||void 0===o||o.emit(t,e,n,i,r,a)},e.dispatchEvent=function(t){var e,n=this.node,i=0;for(t.target=n,Cw.length=0,this.getCapturingTargets(t.type,Cw),t.eventPhase=1,i=Cw.length-1;i>=0;--i)if((e=Cw[i]).eventProcessor.capturingTarget&&(t.currentTarget=e,e.eventProcessor.capturingTarget.emit(t.type,t,Cw),t.propagationStopped))return void(Cw.length=0);if(Cw.length=0,t.eventPhase=2,t.currentTarget=n,this.capturingTarget&&this.capturingTarget.emit(t.type,t),!t.propagationImmediateStopped&&this.bubblingTarget&&this.bubblingTarget.emit(t.type,t),!t.propagationStopped&&t.bubbles)for(this.getBubblingTargets(t.type,Cw),t.eventPhase=3,i=0;i<Cw.length;++i)if((e=Cw[i]).eventProcessor.bubblingTarget&&(t.currentTarget=e,e.eventProcessor.bubblingTarget.emit(t.type,t),t.propagationStopped))return void(Cw.length=0);Cw.length=0},e.hasEventListener=function(t,e,n){var i=!1;return this.bubblingTarget&&(i=this.bubblingTarget.hasEventListener(t,e,n)),!i&&this.capturingTarget&&(i=this.capturingTarget.hasEventListener(t,e,n)),i},e.getCapturingTargets=function(t,e){for(var n=this._node.parent;n;){var i;(null===(i=n.eventProcessor.capturingTarget)||void 0===i?void 0:i.hasEventListener(t))&&e.push(n),n=n.parent}},e.getBubblingTargets=function(t,e){for(var n=this._node.parent;n;){var i;(null===(i=n.eventProcessor.bubblingTarget)||void 0===i?void 0:i.hasEventListener(t))&&e.push(n),n=n.parent}},e._searchComponentsInParent=function(t){var e=this.node;if(t){for(var n=0,i=[],r=e;r&&TE.isNode(r);r=r.parent,++n){var a=r.getComponent(t);if(a){var o={index:n,comp:a};i?i.push(o):i=[o]}}return i.length>0?i:null}return null},e._attachMask=function(){this.maskList=this._searchComponentsInParent(t._maskComp)},e._isTouchEvent=function(t){return-1!==ww.indexOf(t)},e._isMouseEvent=function(t){return-1!==Iw.indexOf(t)},e._hasTouchListeners=function(){for(var t=0;t<ww.length;++t){var e=ww[t];if(this.hasEventListener(e))return!0}return!1},e._hasMouseListeners=function(){for(var t=0;t<Iw.length;++t){var e=Iw[t];if(this.hasEventListener(e))return!0}return!1},e._hasPointerListeners=function(){return!!this._hasTouchListeners()||this._hasMouseListeners()},e._tryEmittingAddEvent=function(e){var n=this._isTouchEvent(e),i=this._isMouseEvent(e);n?this.shouldHandleEventTouch=!0:i&&(this.shouldHandleEventMouse=!0),!n&&!i||this._hasPointerListeners()||t.callbacksInvoker.emit(bw.ADD_POINTER_EVENT_PROCESSOR,this)},e._newCallbacksInvoker=function(){var e=this,n=new eh;return n._registerOffCallback((function(){e.shouldHandleEventTouch&&!e._hasTouchListeners()&&(e.shouldHandleEventTouch=!1),e.shouldHandleEventMouse&&!e._hasMouseListeners()&&(e.shouldHandleEventMouse=!1),e._hasPointerListeners()||t.callbacksInvoker.emit(bw.REMOVE_POINTER_EVENT_PROCESSOR,e)})),n},e._handleEventMouse=function(t){switch(t.type){case Sw.MOUSE_DOWN:return this._handleMouseDown(t);case Sw.MOUSE_MOVE:return this._handleMouseMove(t);case Sw.MOUSE_UP:return this._handleMouseUp(t);case Sw.MOUSE_WHEEL:return this._handleMouseWheel(t);default:return!1}},e._handleMouseDown=function(t){var e=this._node;return!(!e||!e._uiProps.uiTransformComp||(t.getLocation(Ew),!e._uiProps.uiTransformComp.hitTest(Ew)||(t.type=bC.MOUSE_DOWN,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0)))},e._handleMouseMove=function(t){var e=this._node;return!(!e||!e._uiProps.uiTransformComp||(t.getLocation(Ew),e._uiProps.uiTransformComp.hitTest(Ew)?(this.previousMouseIn||(Tw&&Tw!==e&&(t.type=bC.MOUSE_LEAVE,Tw.dispatchEvent(t),Tw.eventProcessor.previousMouseIn=!1),Tw=e,t.type=bC.MOUSE_ENTER,e.dispatchEvent(t),this.previousMouseIn=!0),t.type=bC.MOUSE_MOVE,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0):(this.previousMouseIn&&(t.type=bC.MOUSE_LEAVE,e.dispatchEvent(t),this.previousMouseIn=!1,Tw=null),1)))},e._handleMouseUp=function(t){var e=this._node;return!(!e||!e._uiProps.uiTransformComp||(t.getLocation(Ew),!e._uiProps.uiTransformComp.hitTest(Ew)||(t.type=bC.MOUSE_UP,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0)))},e._handleMouseWheel=function(t){var e=this._node;return!(!e||!e._uiProps.uiTransformComp||(t.getLocation(Ew),!e._uiProps.uiTransformComp.hitTest(Ew)||(t.type=bC.MOUSE_WHEEL,t.bubbles=!0,e.dispatchEvent(t),t.propagationStopped=!0,0)))},e._handleEventTouch=function(t){switch(t.type){case Sw.TOUCH_START:return this._handleTouchStart(t);case Sw.TOUCH_MOVE:return this._handleTouchMove(t);case Sw.TOUCH_END:return this._handleTouchEnd(t);case Sw.TOUCH_CANCEL:return this._handleTouchCancel(t);default:return!1}},e._handleTouchStart=function(t){var e=this.node;return!(!e||!e._uiProps.uiTransformComp||(t.getLocation(Ew),!e._uiProps.uiTransformComp.hitTest(Ew)||(t.type=bC.TOUCH_START,t.bubbles=!0,e.dispatchEvent(t),0)))},e._handleTouchMove=function(t){var e=this.node;return!(!e||!e._uiProps.uiTransformComp||(t.type=bC.TOUCH_MOVE,t.bubbles=!0,e.dispatchEvent(t),0))},e._handleTouchEnd=function(t){var e=this.node;e&&e._uiProps.uiTransformComp&&(t.getLocation(Ew),e._uiProps.uiTransformComp.hitTest(Ew)?t.type=bC.TOUCH_END:t.type=bC.TOUCH_CANCEL,t.bubbles=!0,e.dispatchEvent(t))},e._handleTouchCancel=function(t){var e=this.node;e&&e._uiProps.uiTransformComp&&(t.type=bC.TOUCH_CANCEL,t.bubbles=!0,e.dispatchEvent(t))},Q(t,[{key:"isEnabled",get:function(){return this._isEnabled}},{key:"node",get:function(){return this._node}}]),t}();sD._maskComp=null,sD.callbacksInvoker=new eh,h.NodeEventProcessor=sD;var cD=new Mn(0,1,0),lD=new Mn,hD=new ei,uD=new Dn,_D=new zn,fD=function(t){var e=1/Math.max(Math.max(Math.max(t.x,t.y),t.z),1e-4);e<1&&(t.x*=e,t.y*=e,t.z*=e)},dD=t("AmbientInfo",(Pw=Ec("cc.AmbientInfo"),Dw=qc(),Rw=Kc(),Mw=cl(Be),Ow=Kc(),Nw=qc(),Bw=Kc(),Lw=Bc("_skyColor"),Fw=Bc("_skyIllum"),Vw=Bc("_groundAlbedo"),Pw((lt((kw=function(){function t(){ct(this,"_skyColorHDR",Uw,this),ct(this,"_skyIllumHDR",Gw,this),ct(this,"_groundAlbedoHDR",Hw,this),ct(this,"_skyColorLDR",jw,this),ct(this,"_skyIllumLDR",Ww,this),ct(this,"_groundAlbedoLDR",qw,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this)},Q(t,[{key:"skyColorHDR",get:function(){return this._skyColorHDR}},{key:"groundAlbedoHDR",get:function(){return this._groundAlbedoHDR}},{key:"skyIllumHDR",get:function(){return this._skyIllumHDR}},{key:"skyColorLDR",get:function(){return this._skyColorLDR}},{key:"groundAlbedoLDR",get:function(){return this._groundAlbedoLDR}},{key:"skyIllumLDR",get:function(){return this._skyIllumLDR}},{key:"skyLightingColor",get:function(){var t=h.director.root.pipeline.pipelineSceneData.isHDR;return hD.set(t?this._skyColorHDR:this._skyColorLDR),fD(hD),uD.set(255*hD.x,255*hD.y,255*hD.z,255)},set:function(t){hD.set(t.x,t.y,t.z,t.w),h.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(hD):this._skyColorLDR.set(hD),this._resource&&this._resource.skyColor.set(hD)}},{key:"skyColor",set:function(t){h.director.root.pipeline.pipelineSceneData.isHDR?this._skyColorHDR.set(t):this._skyColorLDR.set(t),this._resource&&this._resource.skyColor.set(t)}},{key:"skyIllum",get:function(){return h.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR:this._skyIllumLDR},set:function(t){h.director.root.pipeline.pipelineSceneData.isHDR?this._skyIllumHDR=t:this._skyIllumLDR=t,this._resource&&(this._resource.skyIllum=t)}},{key:"groundLightingColor",get:function(){var t=h.director.root.pipeline.pipelineSceneData.isHDR;return hD.set(t?this._groundAlbedoHDR:this._groundAlbedoLDR),fD(hD),uD.set(255*hD.x,255*hD.y,255*hD.z,255)},set:function(t){hD.set(t.x,t.y,t.z,t.w),h.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(hD):this._groundAlbedoLDR.set(hD),this._resource&&this._resource.groundAlbedo.set(hD)}},{key:"groundAlbedo",set:function(t){h.director.root.pipeline.pipelineSceneData.isHDR?this._groundAlbedoHDR.set(t):this._groundAlbedoLDR.set(t),this._resource&&this._resource.groundAlbedo.set(t)}}]),t}()).prototype,"skyLightingColor",[Dw,Wc,Rw],Object.getOwnPropertyDescriptor(kw.prototype,"skyLightingColor"),kw.prototype),lt(kw.prototype,"skyIllum",[Wc,Mw,Ow],Object.getOwnPropertyDescriptor(kw.prototype,"skyIllum"),kw.prototype),lt(kw.prototype,"groundLightingColor",[Nw,Wc,Bw],Object.getOwnPropertyDescriptor(kw.prototype,"groundLightingColor"),kw.prototype),Uw=lt(kw.prototype,"_skyColorHDR",[Nc,Lw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ei(.2,.5,.8,1)}}),Gw=lt(kw.prototype,"_skyIllumHDR",[Nc,Fw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ty.SKY_ILLUM}}),Hw=lt(kw.prototype,"_groundAlbedoHDR",[Nc,Vw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ei(.2,.2,.2,1)}}),jw=lt(kw.prototype,"_skyColorLDR",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ei(.2,.5,.8,1)}}),Ww=lt(kw.prototype,"_skyIllumLDR",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ty.SKY_ILLUM}}),qw=lt(kw.prototype,"_groundAlbedoLDR",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ei(.2,.2,.2,1)}}),zw=kw))||zw));h.AmbientInfo=dD;var pD=t("SkyboxInfo",(Xw=Ec("cc.SkyboxInfo"),Yw=Kc(),Kw=cl(Dy),Jw=Kc(),Qw=Kc(),Zw=cl(Ov),$w=Kc(),tI=qc(),eI=cl(Ov),nI=el(),iI=cl(Ov),rI=Bc("_envmap"),aI=cl(Ov),oI=cl(Ov),sI=cl(Ov),Xw((lt((lI=function(){function t(){ct(this,"_envLightingType",hI,this),ct(this,"_envmapHDR",uI,this),ct(this,"_envmapLDR",_I,this),ct(this,"_diffuseMapHDR",fI,this),ct(this,"_diffuseMapLDR",dI,this),ct(this,"_enabled",pI,this),ct(this,"_useHDR",mI,this),this._resource=null}return t.prototype.activate=function(t){this.envLightingType=this._envLightingType,this._resource=t,this._resource.initialize(this),this._resource.setEnvMaps(this._envmapHDR,this._envmapLDR),this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),this._resource.activate()},Q(t,[{key:"applyDiffuseMap",get:function(){return Dy.DIFFUSEMAP_WITH_REFLECTION===this._envLightingType},set:function(t){this._resource&&(this._resource.useDiffuseMap=t)}},{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=this._enabled))}},{key:"envLightingType",get:function(){return this._envLightingType},set:function(t){this.envmap||Dy.HEMISPHERE_DIFFUSE===t?(Dy.HEMISPHERE_DIFFUSE===t?(this.useIBL=!1,this.applyDiffuseMap=!1):Dy.AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION===t?(this.useIBL=!0,this.applyDiffuseMap=!1):Dy.DIFFUSEMAP_WITH_REFLECTION===t&&(this.useIBL=!0,this.applyDiffuseMap=!0),this._envLightingType=t):(this.useIBL=!1,this.applyDiffuseMap=!1,this._envLightingType=Dy.HEMISPHERE_DIFFUSE,R(15001))}},{key:"useIBL",get:function(){return Dy.HEMISPHERE_DIFFUSE!==this._envLightingType},set:function(t){this._resource&&(this._resource.useIBL=t)}},{key:"useHDR",get:function(){return h.director.root.pipeline.pipelineSceneData.isHDR=this._useHDR,this._useHDR},set:function(t){h.director.root.pipeline.pipelineSceneData.isHDR=t,this._useHDR=t,this._resource&&(this.envmap=this._resource.envmap,this.diffuseMap=this._resource.diffuseMap,this.envLightingType===Dy.DIFFUSEMAP_WITH_REFLECTION&&(null===this.diffuseMap?(this.envLightingType=Dy.AUTOGEN_HEMISPHERE_DIFFUSE_WITH_REFLECTION,R(15e3)):this.diffuseMap.isDefault&&R(15002))),this._resource&&(this._resource.useHDR=this._useHDR)}},{key:"envmap",get:function(){return h.director.root.pipeline.pipelineSceneData.isHDR?this._envmapHDR:this._envmapLDR},set:function(t){var e=h.director.root.pipeline.pipelineSceneData.isHDR;e?this._envmapHDR=t:this._envmapLDR=t,t||(e?this._diffuseMapHDR=null:this._diffuseMapLDR=null,this.applyDiffuseMap=!1,this.useIBL=!1,this.envLightingType=Dy.HEMISPHERE_DIFFUSE,R(15001)),this._resource&&(this._resource.setEnvMaps(this._envmapHDR,this._envmapLDR),this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR),this._resource.useDiffuseMap=this.applyDiffuseMap,this._resource.envmap=t)}},{key:"diffuseMap",get:function(){return h.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR:this._diffuseMapLDR},set:function(t){h.director.root.pipeline.pipelineSceneData.isHDR?this._diffuseMapHDR=t:this._diffuseMapLDR=t,this._resource&&this._resource.setDiffuseMaps(this._diffuseMapHDR,this._diffuseMapLDR)}}]),t}()).prototype,"enabled",[Wc,Yw],Object.getOwnPropertyDescriptor(lI.prototype,"enabled"),lI.prototype),lt(lI.prototype,"envLightingType",[Wc,Kw,Jw],Object.getOwnPropertyDescriptor(lI.prototype,"envLightingType"),lI.prototype),lt(lI.prototype,"useHDR",[Wc,Qw],Object.getOwnPropertyDescriptor(lI.prototype,"useHDR"),lI.prototype),lt(lI.prototype,"envmap",[Wc,Zw,$w],Object.getOwnPropertyDescriptor(lI.prototype,"envmap"),lI.prototype),lt(lI.prototype,"diffuseMap",[tI,Wc,Xc,eI,nI],Object.getOwnPropertyDescriptor(lI.prototype,"diffuseMap"),lI.prototype),hI=lt(lI.prototype,"_envLightingType",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Dy.HEMISPHERE_DIFFUSE}}),uI=lt(lI.prototype,"_envmapHDR",[Nc,iI,rI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_I=lt(lI.prototype,"_envmapLDR",[Nc,aI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fI=lt(lI.prototype,"_diffuseMapHDR",[Nc,oI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dI=lt(lI.prototype,"_diffuseMapLDR",[Nc,sI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pI=lt(lI.prototype,"_enabled",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),mI=lt(lI.prototype,"_useHDR",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),cI=lI))||cI));h.SkyboxInfo=pD;var mD=t("FogInfo",(vI=Ec("cc.FogInfo"),gI=Kc(),yI=el(),xI=Kc(),SI=el(),AI=Kc(),bI=cl(Oy),CI=el(),TI=Kc(),EI=qc(),wI=cl(Be),II=Jc(),PI=$c(),DI=Kc(),RI=qc(),MI=cl(Be),OI=$c(),NI=Kc(),BI=qc(),LI=cl(Be),FI=$c(),VI=Kc(),zI=qc(),kI=cl(Be),UI=Qc(),GI=$c(),HI=Kc(),jI=qc(),WI=cl(Be),qI=$c(),XI=Kc(),YI=qc(),KI=cl(Be),JI=$c(),QI=Kc(),vI((uP=hP=function(){function t(){ct(this,"_type",tP,this),ct(this,"_fogColor",eP,this),ct(this,"_enabled",nP,this),ct(this,"_fogDensity",iP,this),ct(this,"_fogStart",rP,this),ct(this,"_fogEnd",aP,this),ct(this,"_fogAtten",oP,this),ct(this,"_fogTop",sP,this),ct(this,"_fogRange",cP,this),ct(this,"_accurate",lP,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this),this._resource.activate()},Q(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t,t&&(this._resource.type=this._type)))}},{key:"accurate",get:function(){return this._accurate},set:function(t){this._accurate!==t&&(this._accurate=t,this._resource&&(this._resource.accurate=t,t&&(this._resource.type=this._type)))}},{key:"fogColor",get:function(){return this._fogColor},set:function(t){this._fogColor.set(t),this._resource&&(this._resource.fogColor=this._fogColor)}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._resource&&(this._resource.type=t)}},{key:"fogDensity",get:function(){return this._fogDensity},set:function(t){this._fogDensity=t,this._resource&&(this._resource.fogDensity=t)}},{key:"fogStart",get:function(){return this._fogStart},set:function(t){this._fogStart=t,this._resource&&(this._resource.fogStart=t)}},{key:"fogEnd",get:function(){return this._fogEnd},set:function(t){this._fogEnd=t,this._resource&&(this._resource.fogEnd=t)}},{key:"fogAtten",get:function(){return this._fogAtten},set:function(t){this._fogAtten=t,this._resource&&(this._resource.fogAtten=t)}},{key:"fogTop",get:function(){return this._fogTop},set:function(t){this._fogTop=t,this._resource&&(this._resource.fogTop=t)}},{key:"fogRange",get:function(){return this._fogRange},set:function(t){this._fogRange=t,this._resource&&(this._resource.fogRange=t)}}]),t}(),hP.FogType=Oy,lt(($I=uP).prototype,"enabled",[Wc,gI,yI],Object.getOwnPropertyDescriptor($I.prototype,"enabled"),$I.prototype),lt($I.prototype,"accurate",[Wc,xI,SI],Object.getOwnPropertyDescriptor($I.prototype,"accurate"),$I.prototype),lt($I.prototype,"fogColor",[Wc,AI],Object.getOwnPropertyDescriptor($I.prototype,"fogColor"),$I.prototype),lt($I.prototype,"type",[Wc,bI,CI,TI],Object.getOwnPropertyDescriptor($I.prototype,"type"),$I.prototype),lt($I.prototype,"fogDensity",[EI,wI,II,PI,tl,DI],Object.getOwnPropertyDescriptor($I.prototype,"fogDensity"),$I.prototype),lt($I.prototype,"fogStart",[RI,MI,OI,NI],Object.getOwnPropertyDescriptor($I.prototype,"fogStart"),$I.prototype),lt($I.prototype,"fogEnd",[BI,LI,FI,VI],Object.getOwnPropertyDescriptor($I.prototype,"fogEnd"),$I.prototype),lt($I.prototype,"fogAtten",[zI,kI,UI,GI,HI],Object.getOwnPropertyDescriptor($I.prototype,"fogAtten"),$I.prototype),lt($I.prototype,"fogTop",[jI,WI,qI,XI],Object.getOwnPropertyDescriptor($I.prototype,"fogTop"),$I.prototype),lt($I.prototype,"fogRange",[YI,KI,JI,QI],Object.getOwnPropertyDescriptor($I.prototype,"fogRange"),$I.prototype),tP=lt($I.prototype,"_type",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Oy.LINEAR}}),eP=lt($I.prototype,"_fogColor",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn("#C8C8C8")}}),nP=lt($I.prototype,"_enabled",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),iP=lt($I.prototype,"_fogDensity",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),rP=lt($I.prototype,"_fogStart",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),aP=lt($I.prototype,"_fogEnd",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 300}}),oP=lt($I.prototype,"_fogAtten",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),sP=lt($I.prototype,"_fogTop",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),cP=lt($I.prototype,"_fogRange",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),lP=lt($I.prototype,"_accurate",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ZI=$I))||ZI)),vD=t("ShadowsInfo",(_P=Ec("cc.ShadowsInfo"),fP=Kc(),dP=cl(Ig),pP=qc(),mP=qc(),vP=Kc(),gP=cl(Be),yP=qc(),xP=Kc(),SP=cl(Ne),AP=Kc(),bP=qc(),CP=cl(wg),TP=Kc(),EP=qc(),_P((lt((IP=function(){function t(){ct(this,"_enabled",PP,this),ct(this,"_type",DP,this),ct(this,"_normal",RP,this),ct(this,"_distance",MP,this),ct(this,"_shadowColor",OP,this),ct(this,"_maxReceived",NP,this),ct(this,"_size",BP,this),this._resource=null}var e=t.prototype;return e.setPlaneFromNode=function(t){t.getWorldRotation(_D),this.planeDirection=Mn.transformQuat(lD,cD,_D),t.getWorldPosition(lD),this.planeHeight=Mn.dot(this._normal,lD)},e.activate=function(t){this._resource=t,this._resource.initialize(this),this._resource.activate()},Q(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t,t&&(this._resource.type=this._type)))}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._resource&&(this._resource.type=t)}},{key:"shadowColor",get:function(){return this._shadowColor},set:function(t){this._shadowColor.set(t),this._resource&&(this._resource.shadowColor=t)}},{key:"planeDirection",get:function(){return this._normal},set:function(t){Mn.copy(this._normal,t),this._resource&&(this._resource.normal=t)}},{key:"planeHeight",get:function(){return this._distance},set:function(t){this._distance=t,this._resource&&(this._resource.distance=-t)}},{key:"maxReceived",get:function(){return this._maxReceived},set:function(t){this._maxReceived=t,this._resource&&(this._resource.maxReceived=t)}},{key:"shadowMapSize",get:function(){return this._size.x},set:function(t){this._size.set(t,t),this._resource&&(this._resource.size.set(t,t),this._resource.shadowMapDirty=!0)}},{key:"size",get:function(){return this._size}}]),t}()).prototype,"enabled",[Wc,fP],Object.getOwnPropertyDescriptor(IP.prototype,"enabled"),IP.prototype),lt(IP.prototype,"type",[Wc,dP],Object.getOwnPropertyDescriptor(IP.prototype,"type"),IP.prototype),lt(IP.prototype,"shadowColor",[pP],Object.getOwnPropertyDescriptor(IP.prototype,"shadowColor"),IP.prototype),lt(IP.prototype,"planeDirection",[mP,vP],Object.getOwnPropertyDescriptor(IP.prototype,"planeDirection"),IP.prototype),lt(IP.prototype,"planeHeight",[Wc,gP,yP,xP],Object.getOwnPropertyDescriptor(IP.prototype,"planeHeight"),IP.prototype),lt(IP.prototype,"maxReceived",[SP,AP,bP],Object.getOwnPropertyDescriptor(IP.prototype,"maxReceived"),IP.prototype),lt(IP.prototype,"shadowMapSize",[CP,TP,EP],Object.getOwnPropertyDescriptor(IP.prototype,"shadowMapSize"),IP.prototype),PP=lt(IP.prototype,"_enabled",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),DP=lt(IP.prototype,"_type",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ig.Planar}}),RP=lt(IP.prototype,"_normal",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Mn(0,1,0)}}),MP=lt(IP.prototype,"_distance",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),OP=lt(IP.prototype,"_shadowColor",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn(0,0,0,76)}}),NP=lt(IP.prototype,"_maxReceived",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),BP=lt(IP.prototype,"_size",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn(512,512)}}),wP=IP))||wP));h.ShadowsInfo=vD;var gD=t("DEFAULT_WORLD_MIN_POS",new Mn(-1024,-1024,-1024)),yD=t("DEFAULT_WORLD_MAX_POS",new Mn(1024,1024,1024)),xD=t("DEFAULT_OCTREE_DEPTH",8),SD=t("OctreeInfo",(LP=Ec("cc.OctreeInfo"),FP=Kc(),VP=Kc(),zP=Yc(),kP=Kc(),UP=Yc(),GP=Jc(),HP=cl(Ne),jP=Kc(),LP((lt((qP=function(){function t(){ct(this,"_enabled",XP,this),ct(this,"_minPos",YP,this),ct(this,"_maxPos",KP,this),ct(this,"_depth",JP,this),this._resource=null}return t.prototype.activate=function(t){this._resource=t,this._resource.initialize(this)},Q(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(this._enabled=t,this._resource&&(this._resource.enabled=t))}},{key:"minPos",get:function(){return this._minPos},set:function(t){this._minPos=t,this._resource&&(this._resource.minPos=t)}},{key:"maxPos",get:function(){return this._maxPos},set:function(t){this._maxPos=t,this._resource&&(this._resource.maxPos=t)}},{key:"depth",get:function(){return this._depth},set:function(t){this._depth=t,this._resource&&(this._resource.depth=t)}}]),t}()).prototype,"enabled",[Wc,FP],Object.getOwnPropertyDescriptor(qP.prototype,"enabled"),qP.prototype),lt(qP.prototype,"minPos",[Wc,VP,zP],Object.getOwnPropertyDescriptor(qP.prototype,"minPos"),qP.prototype),lt(qP.prototype,"maxPos",[Wc,kP,UP],Object.getOwnPropertyDescriptor(qP.prototype,"maxPos"),qP.prototype),lt(qP.prototype,"depth",[Wc,GP,tl,HP,jP],Object.getOwnPropertyDescriptor(qP.prototype,"depth"),qP.prototype),XP=lt(qP.prototype,"_enabled",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),YP=lt(qP.prototype,"_minPos",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Mn(gD)}}),KP=lt(qP.prototype,"_maxPos",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Mn(yD)}}),JP=lt(qP.prototype,"_depth",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xD}}),WP=qP))||WP)),AD=t("SceneGlobals",(QP=Ec("cc.SceneGlobals"),ZP=cl(pD),QP((oD=function(){function t(){ct(this,"ambient",eD,this),ct(this,"shadows",nD,this),ct(this,"_skybox",iD,this),ct(this,"fog",rD,this),ct(this,"octree",aD,this)}return t.prototype.activate=function(){var t=h.director.root.pipeline.pipelineSceneData;this.skybox.activate(t.skybox),this.ambient.activate(t.ambient),this.shadows.activate(t.shadows),this.fog.activate(t.fog),this.octree.activate(t.octree)},Q(t,[{key:"skybox",get:function(){return this._skybox},set:function(t){this._skybox=t}}]),t}(),eD=lt((tD=oD).prototype,"ambient",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new dD}}),nD=lt(tD.prototype,"shadows",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new vD}}),iD=lt(tD.prototype,"_skybox",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new pD}}),rD=lt(tD.prototype,"fog",[Wc,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new mD}}),lt(tD.prototype,"skybox",[Wc,ZP],Object.getOwnPropertyDescriptor(tD.prototype,"skybox"),tD.prototype),aD=lt(tD.prototype,"octree",[Wc,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new SD}}),$P=tD))||$P));h.SceneGlobals=AD;var bD=t("Event",function(){function t(t,e){this.type=void 0,this.bubbles=void 0,this.target=null,this.currentTarget=null,this.eventPhase=0,this.propagationStopped=!1,this.propagationImmediateStopped=!1,this.type=t,this.bubbles=!!e}var e=t.prototype;return e.unuse=function(){this.type=t.NO_TYPE,this.target=null,this.currentTarget=null,this.eventPhase=t.NONE,this.propagationStopped=!1,this.propagationImmediateStopped=!1},e.reuse=function(t,e){this.type=t,this.bubbles=e||!1},e.isStopped=function(){return this.propagationStopped||this.propagationImmediateStopped},e.getCurrentTarget=function(){return this.currentTarget},e.getType=function(){return this.type},t}());bD.NO_TYPE="no_type",bD.TOUCH="touch",bD.MOUSE="mouse",bD.KEYBOARD="keyboard",bD.ACCELERATION="acceleration",bD.NONE=0,bD.CAPTURING_PHASE=1,bD.AT_TARGET=2,bD.BUBBLING_PHASE=3,h.Event=bD;var CD=t("EventAcceleration",function(t){function e(e,n){var i;return(i=t.call(this,xw.DEVICEMOTION,n)||this).acc=void 0,i.acc=e,i}return $(e,t),e}(bD));bD.EventAcceleration=CD;var TD=t("EventKeyboard",function(t){function e(e,n,i){var r;return"boolean"==typeof n&&(n=n?xw.KEY_DOWN:xw.KEY_UP),(r=t.call(this,n,i)||this).keyCode=void 0,r.rawEvent=void 0,r._isPressed=void 0,r._isPressed=n!==xw.KEY_UP,"number"==typeof e?r.keyCode=e:(r.keyCode=e.keyCode,r.rawEvent=e),r}return $(e,t),Q(e,[{key:"isPressed",get:function(){return this._isPressed}}]),e}(bD));bD.EventKeyboard=TD;var ED=t("EventMouse",function(t){function e(n,i,r){var a;return(a=t.call(this,n,i)||this).movementX=0,a.movementY=0,a.preventSwallow=!1,a._eventType=void 0,a._button=e.BUTTON_MISSING,a._x=0,a._y=0,a._prevX=0,a._prevY=0,a._scrollX=0,a._scrollY=0,a._eventType=n,r&&(a._prevX=r.x,a._prevY=r.y),a}$(e,t);var n=e.prototype;return n.setScrollData=function(t,e){this._scrollX=t,this._scrollY=e},n.getScrollX=function(){return this._scrollX},n.getScrollY=function(){return this._scrollY},n.setLocation=function(t,e){this._x=t,this._y=e},n.getLocation=function(t){return t||(t=new Qn),Qn.set(t,this._x,this._y),t},n.getLocationInView=function(t){return t||(t=new Qn),Qn.set(t,this._x,h.view._designResolutionSize.height-this._y),t},n.getUILocation=function(t){return t||(t=new Qn),Qn.set(t,this._x,this._y),h.view._convertToUISpace(t),t},n.getPreviousLocation=function(t){return t||(t=new Qn),Qn.set(t,this._prevX,this._prevY),t},n.getUIPreviousLocation=function(t){return t||(t=new Qn),Qn.set(t,this._prevX,this._prevY),h.view._convertToUISpace(t),t},n.getDelta=function(t){return t||(t=new Qn),Qn.set(t,this._x-this._prevX,this._y-this._prevY),t},n.getDeltaX=function(){return this._x-this._prevX},n.getDeltaY=function(){return this._y-this._prevY},n.getUIDelta=function(t){return t||(t=new Qn),Qn.set(t,(this._x-this._prevX)/h.view.getScaleX(),(this._y-this._prevY)/h.view.getScaleY()),t},n.getUIDeltaX=function(){return(this._x-this._prevX)/h.view.getScaleX()},n.getUIDeltaY=function(){return(this._y-this._prevY)/h.view.getScaleY()},n.setButton=function(t){this._button=t},n.getButton=function(){return this._button},n.getLocationX=function(){return this._x},n.getLocationY=function(){return this._y},n.getUILocationX=function(){var t=h.view.getViewportRect();return(this._x-t.x)/h.view.getScaleX()},n.getUILocationY=function(){var t=h.view.getViewportRect();return(this._y-t.y)/h.view.getScaleY()},Q(e,[{key:"eventType",get:function(){return this._eventType}}]),e}(bD));ED.BUTTON_MISSING=-1,ED.BUTTON_LEFT=0,ED.BUTTON_RIGHT=2,ED.BUTTON_MIDDLE=1,ED.BUTTON_4=3,ED.BUTTON_5=4,ED.BUTTON_6=5,ED.BUTTON_7=6,ED.BUTTON_8=7,bD.EventMouse=ED;var wD=new Qn,ID=t("EventTouch",function(t){function e(e,n,i,r){var a;return void 0===r&&(r=[]),(a=t.call(this,i,n)||this).touch=null,a.simulate=!1,a.preventSwallow=!1,a._eventCode=void 0,a._touches=void 0,a._allTouches=void 0,a._eventCode=i,a._touches=e||[],a._allTouches=r,a}$(e,t);var n=e.prototype;return n.getEventCode=function(){return this._eventCode},n.getTouches=function(){return this._touches},n.getAllTouches=function(){return this._allTouches},n.setLocation=function(t,e){this.touch&&this.touch.setTouchInfo(this.touch.getID(),t,e)},n.getLocation=function(t){return this.touch?this.touch.getLocation(t):new Qn},n.getUILocation=function(t){return this.touch?this.touch.getUILocation(t):new Qn},n.getLocationInView=function(t){return this.touch?this.touch.getLocationInView(t):new Qn},n.getPreviousLocation=function(t){return this.touch?this.touch.getPreviousLocation(t):new Qn},n.getStartLocation=function(t){return this.touch?this.touch.getStartLocation(t):new Qn},n.getUIStartLocation=function(t){return this.touch?this.touch.getUIStartLocation(t):new Qn},n.getID=function(){return this.touch?this.touch.getID():null},n.getDelta=function(t){return this.touch?this.touch.getDelta(t):new Qn},n.getUIDelta=function(t){return this.touch?this.touch.getUIDelta(t):new Qn},n.getDeltaX=function(){return this.touch?this.touch.getDelta(wD).x:0},n.getDeltaY=function(){return this.touch?this.touch.getDelta(wD).y:0},n.getLocationX=function(){return this.touch?this.touch.getLocationX():0},n.getLocationY=function(){return this.touch?this.touch.getLocationY():0},e}(bD));ID.MAX_TOUCHES=5,bD.EventTouch=ID;var PD,DD=t("Acceleration",(function(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=void 0,this.y=void 0,this.z=void 0,this.timestamp=void 0,this.x=t,this.y=e,this.z=n,this.timestamp=i}));!function(t){t[t.NONE=0]="NONE",t[t.MOBILE_BACK=6]="MOBILE_BACK",t[t.BACKSPACE=8]="BACKSPACE",t[t.TAB=9]="TAB",t[t.ENTER=13]="ENTER",t[t.SHIFT_LEFT=16]="SHIFT_LEFT",t[t.CTRL_LEFT=17]="CTRL_LEFT",t[t.ALT_LEFT=18]="ALT_LEFT",t[t.PAUSE=19]="PAUSE",t[t.CAPS_LOCK=20]="CAPS_LOCK",t[t.ESCAPE=27]="ESCAPE",t[t.SPACE=32]="SPACE",t[t.PAGE_UP=33]="PAGE_UP",t[t.PAGE_DOWN=34]="PAGE_DOWN",t[t.END=35]="END",t[t.HOME=36]="HOME",t[t.ARROW_LEFT=37]="ARROW_LEFT",t[t.ARROW_UP=38]="ARROW_UP",t[t.ARROW_RIGHT=39]="ARROW_RIGHT",t[t.ARROW_DOWN=40]="ARROW_DOWN",t[t.INSERT=45]="INSERT",t[t.DELETE=46]="DELETE",t[t.DIGIT_0=48]="DIGIT_0",t[t.DIGIT_1=49]="DIGIT_1",t[t.DIGIT_2=50]="DIGIT_2",t[t.DIGIT_3=51]="DIGIT_3",t[t.DIGIT_4=52]="DIGIT_4",t[t.DIGIT_5=53]="DIGIT_5",t[t.DIGIT_6=54]="DIGIT_6",t[t.DIGIT_7=55]="DIGIT_7",t[t.DIGIT_8=56]="DIGIT_8",t[t.DIGIT_9=57]="DIGIT_9",t[t.KEY_A=65]="KEY_A",t[t.KEY_B=66]="KEY_B",t[t.KEY_C=67]="KEY_C",t[t.KEY_D=68]="KEY_D",t[t.KEY_E=69]="KEY_E",t[t.KEY_F=70]="KEY_F",t[t.KEY_G=71]="KEY_G",t[t.KEY_H=72]="KEY_H",t[t.KEY_I=73]="KEY_I",t[t.KEY_J=74]="KEY_J",t[t.KEY_K=75]="KEY_K",t[t.KEY_L=76]="KEY_L",t[t.KEY_M=77]="KEY_M",t[t.KEY_N=78]="KEY_N",t[t.KEY_O=79]="KEY_O",t[t.KEY_P=80]="KEY_P",t[t.KEY_Q=81]="KEY_Q",t[t.KEY_R=82]="KEY_R",t[t.KEY_S=83]="KEY_S",t[t.KEY_T=84]="KEY_T",t[t.KEY_U=85]="KEY_U",t[t.KEY_V=86]="KEY_V",t[t.KEY_W=87]="KEY_W",t[t.KEY_X=88]="KEY_X",t[t.KEY_Y=89]="KEY_Y",t[t.KEY_Z=90]="KEY_Z",t[t.NUM_0=96]="NUM_0",t[t.NUM_1=97]="NUM_1",t[t.NUM_2=98]="NUM_2",t[t.NUM_3=99]="NUM_3",t[t.NUM_4=100]="NUM_4",t[t.NUM_5=101]="NUM_5",t[t.NUM_6=102]="NUM_6",t[t.NUM_7=103]="NUM_7",t[t.NUM_8=104]="NUM_8",t[t.NUM_9=105]="NUM_9",t[t.NUM_MULTIPLY=106]="NUM_MULTIPLY",t[t.NUM_PLUS=107]="NUM_PLUS",t[t.NUM_SUBTRACT=109]="NUM_SUBTRACT",t[t.NUM_DECIMAL=110]="NUM_DECIMAL",t[t.NUM_DIVIDE=111]="NUM_DIVIDE",t[t.F1=112]="F1",t[t.F2=113]="F2",t[t.F3=114]="F3",t[t.F4=115]="F4",t[t.F5=116]="F5",t[t.F6=117]="F6",t[t.F7=118]="F7",t[t.F8=119]="F8",t[t.F9=120]="F9",t[t.F10=121]="F10",t[t.F11=122]="F11",t[t.F12=123]="F12",t[t.NUM_LOCK=144]="NUM_LOCK",t[t.SCROLL_LOCK=145]="SCROLL_LOCK",t[t.SEMICOLON=186]="SEMICOLON",t[t.EQUAL=187]="EQUAL",t[t.COMMA=188]="COMMA",t[t.DASH=189]="DASH",t[t.PERIOD=190]="PERIOD",t[t.SLASH=191]="SLASH",t[t.BACK_QUOTE=192]="BACK_QUOTE",t[t.BRACKET_LEFT=219]="BRACKET_LEFT",t[t.BACKSLASH=220]="BACKSLASH",t[t.BRACKET_RIGHT=221]="BRACKET_RIGHT",t[t.QUOTE=222]="QUOTE",t[t.SHIFT_RIGHT=2e3]="SHIFT_RIGHT",t[t.CTRL_RIGHT=2001]="CTRL_RIGHT",t[t.ALT_RIGHT=2002]="ALT_RIGHT",t[t.NUM_ENTER=2003]="NUM_ENTER"}(PD||(PD=t("KeyCode",{})));var RD=new Qn,MD=t("Touch",function(){function t(t,e,n){void 0===n&&(n=0),this._point=new Qn,this._prevPoint=new Qn,this._lastModified=0,this._id=0,this._startPoint=new Qn,this._startPointCaptured=!1,this.setTouchInfo(n,t,e)}var e=t.prototype;return e.getLocation=function(t){return t||(t=new Qn),t.set(this._point.x,this._point.y),t},e.getLocationX=function(){return this._point.x},e.getLocationY=function(){return this._point.y},e.getUILocation=function(t){return t||(t=new Qn),t.set(this._point.x,this._point.y),h.view._convertToUISpace(t),t},e.getUILocationX=function(){var t=h.view.getViewportRect();return(this._point.x-t.x)/h.view.getScaleX()},e.getUILocationY=function(){var t=h.view.getViewportRect();return(this._point.y-t.y)/h.view.getScaleY()},e.getPreviousLocation=function(t){return t||(t=new Qn),t.set(this._prevPoint.x,this._prevPoint.y),t},e.getUIPreviousLocation=function(t){return t||(t=new Qn),t.set(this._prevPoint.x,this._prevPoint.y),h.view._convertToUISpace(t),t},e.getStartLocation=function(t){return t||(t=new Qn),t.set(this._startPoint.x,this._startPoint.y),t},e.getUIStartLocation=function(t){return t||(t=new Qn),t.set(this._startPoint.x,this._startPoint.y),h.view._convertToUISpace(t),t},e.getDelta=function(t){return t||(t=new Qn),t.set(this._point),t.subtract(this._prevPoint),t},e.getUIDelta=function(t){return t||(t=new Qn),RD.set(this._point),RD.subtract(this._prevPoint),t.set(h.view.getScaleX(),h.view.getScaleY()),Qn.divide(t,RD,t),t},e.getLocationInView=function(t){return t||(t=new Qn),t.set(this._point.x,h.view._designResolutionSize.height-this._point.y),t},e.getPreviousLocationInView=function(t){return t||(t=new Qn),t.set(this._prevPoint.x,h.view._designResolutionSize.height-this._prevPoint.y),t},e.getStartLocationInView=function(t){return t||(t=new Qn),t.set(this._startPoint.x,h.view._designResolutionSize.height-this._startPoint.y),t},e.getID=function(){return this._id},e.setTouchInfo=function(t,e,n){void 0===t&&(t=0),this._prevPoint=this._point,this._point=new Qn(e||0,n||0),this._id=t,this._startPointCaptured||(this._startPoint=new Qn(this._point),this._startPointCaptured=!0)},e.setPoint=function(t,e){"object"==typeof t?(this._point.x=t.x,this._point.y=t.y):(this._point.x=t||0,this._point.y=e||0),this._lastModified=h.game.frameStartTime},e.setPrevPoint=function(t,e){this._prevPoint="object"==typeof t?new Qn(t.x,t.y):new Qn(t||0,e||0),this._lastModified=h.game.frameStartTime},Q(t,[{key:"lastModified",get:function(){return this._lastModified}}]),t}());h.Touch=MD;var OD=function(){function t(){this._isStarted=!1,this._accelMode="normal",this._eventTarget=new uh,this._didAccelerateFunc=void 0,this._didAccelerateFunc=this._didAccelerate.bind(this)}var e=t.prototype;return e._registerEvent=function(){dh.onAccelerometerChange(this._didAccelerateFunc)},e._unregisterEvent=function(){dh.offAccelerometerChange(this._didAccelerateFunc)},e._didAccelerate=function(t){var e=performance.now(),n=new DD(t.x,t.y,t.z,e),i=new CD(n);this._eventTarget.emit(Sw.DEVICEMOTION,i)},e.start=function(){var t=this;this._registerEvent(),dh.startAccelerometer({interval:this._accelMode,success:function(){t._isStarted=!0}})},e.stop=function(){var t=this;dh.stopAccelerometer({success:function(){t._isStarted=!1},fail:function(){console.error("failed to stop accelerometer")}}),this._unregisterEvent()},e.setInterval=function(t){this._accelMode=t>=200?"normal":t>=60?"ui":"game",this._isStarted&&(this.stop(),this.start())},e.on=function(t,e,n){this._eventTarget.on(t,e,n)},t}(),ND={Backspace:PD.BACKSPACE,Tab:PD.TAB,Enter:PD.ENTER,ShiftLeft:PD.SHIFT_LEFT,ControlLeft:PD.CTRL_LEFT,AltLeft:PD.ALT_LEFT,ShiftRight:PD.SHIFT_RIGHT,ControlRight:PD.CTRL_RIGHT,AltRight:PD.ALT_RIGHT,Pause:PD.PAUSE,CapsLock:PD.CAPS_LOCK,Escape:PD.ESCAPE,Space:PD.SPACE,PageUp:PD.PAGE_UP,PageDown:PD.PAGE_DOWN,End:PD.END,Home:PD.HOME,ArrowLeft:PD.ARROW_LEFT,ArrowUp:PD.ARROW_UP,ArrowRight:PD.ARROW_RIGHT,ArrowDown:PD.ARROW_DOWN,Insert:PD.INSERT,Delete:PD.DELETE,Digit0:PD.DIGIT_0,Digit1:PD.DIGIT_1,Digit2:PD.DIGIT_2,Digit3:PD.DIGIT_3,Digit4:PD.DIGIT_4,Digit5:PD.DIGIT_5,Digit6:PD.DIGIT_6,Digit7:PD.DIGIT_7,Digit8:PD.DIGIT_8,Digit9:PD.DIGIT_9,KeyA:PD.KEY_A,KeyB:PD.KEY_B,KeyC:PD.KEY_C,KeyD:PD.KEY_D,KeyE:PD.KEY_E,KeyF:PD.KEY_F,KeyG:PD.KEY_G,KeyH:PD.KEY_H,KeyI:PD.KEY_I,KeyJ:PD.KEY_J,KeyK:PD.KEY_K,KeyL:PD.KEY_L,KeyM:PD.KEY_M,KeyN:PD.KEY_N,KeyO:PD.KEY_O,KeyP:PD.KEY_P,KeyQ:PD.KEY_Q,KeyR:PD.KEY_R,KeyS:PD.KEY_S,KeyT:PD.KEY_T,KeyU:PD.KEY_U,KeyV:PD.KEY_V,KeyW:PD.KEY_W,KeyX:PD.KEY_X,KeyY:PD.KEY_Y,KeyZ:PD.KEY_Z,Numpad0:PD.NUM_0,Numpad1:PD.NUM_1,Numpad2:PD.NUM_2,Numpad3:PD.NUM_3,Numpad4:PD.NUM_4,Numpad5:PD.NUM_5,Numpad6:PD.NUM_6,Numpad7:PD.NUM_7,Numpad8:PD.NUM_8,Numpad9:PD.NUM_9,NumpadMultiply:PD.NUM_MULTIPLY,NumpadAdd:PD.NUM_PLUS,NumpadSubtract:PD.NUM_SUBTRACT,NumpadDecimal:PD.NUM_DECIMAL,NumpadDivide:PD.NUM_DIVIDE,NumpadEnter:PD.NUM_ENTER,F1:PD.F1,F2:PD.F2,F3:PD.F3,F4:PD.F4,F5:PD.F5,F6:PD.F6,F7:PD.F7,F8:PD.F8,F9:PD.F9,F10:PD.F10,F11:PD.F11,F12:PD.F12,NumLock:PD.NUM_LOCK,ScrollLock:PD.SCROLL_LOCK,Semicolon:PD.SEMICOLON,Equal:PD.EQUAL,Comma:PD.COMMA,Minus:PD.DASH,Period:PD.PERIOD,Slash:PD.SLASH,Backquote:PD.BACK_QUOTE,BracketLeft:PD.BRACKET_LEFT,Backslash:PD.BACKSLASH,BracketRight:PD.BRACKET_RIGHT,Quote:PD.QUOTE};function BD(t){return ND[t]||PD.NONE}var LD,FD,VD=function(){function t(){this._eventTarget=new uh,this._keyStateMap={},Lh.hasFeature(Eh.EVENT_KEYBOARD)&&this._registerEvent()}var e=t.prototype;return e._registerEvent=function(){var t,e,n,i,r=this;null===(t=dh.wx)||void 0===t||null===(e=t.onKeyDown)||void 0===e||e.call(t,(function(t){var e=BD(t.code);if(r._keyStateMap[e]){var n=r._getInputEvent(t,Sw.KEY_PRESSING);r._eventTarget.emit(Sw.KEY_PRESSING,n)}else{var i=r._getInputEvent(t,Sw.KEY_DOWN);r._eventTarget.emit(Sw.KEY_DOWN,i)}r._keyStateMap[e]=!0})),null===(n=dh.wx)||void 0===n||null===(i=n.onKeyUp)||void 0===i||i.call(n,(function(t){var e=BD(t.code),n=r._getInputEvent(t,Sw.KEY_UP);r._keyStateMap[e]=!1,r._eventTarget.emit(Sw.KEY_UP,n)}))},e._getInputEvent=function(t,e){var n=BD(t.code);return new TD(n,e)},e.on=function(t,e,n){this._eventTarget.on(t,e,n)},t}(),zD=function(){function t(){this._eventTarget=new uh,this._isPressed=!1,this._preMousePos=new Qn,Lh.hasFeature(Eh.EVENT_MOUSE)&&this._registerEvent()}var e=t.prototype;return e._getLocation=function(t){var e=Cu.windowSize,n=Cu.devicePixelRatio,i=t.x*n,r=e.height-t.y*n;return new Qn(i,r)},e._registerEvent=function(){var t,e,n,i,r,a,o,s;null===(t=dh.wx)||void 0===t||null===(e=t.onMouseDown)||void 0===e||e.call(t,this._createCallback(Sw.MOUSE_DOWN)),null===(n=dh.wx)||void 0===n||null===(i=n.onMouseMove)||void 0===i||i.call(n,this._createCallback(Sw.MOUSE_MOVE)),null===(r=dh.wx)||void 0===r||null===(a=r.onMouseUp)||void 0===a||a.call(r,this._createCallback(Sw.MOUSE_UP)),null===(o=dh.wx)||void 0===o||null===(s=o.onWheel)||void 0===s||s.call(o,this._handleMouseWheel.bind(this))},e._createCallback=function(t){var e=this;return function(n){var i=e._getLocation(n),r=n.button;switch(t){case Sw.MOUSE_DOWN:e._isPressed=!0;break;case Sw.MOUSE_UP:e._isPressed=!1;break;case Sw.MOUSE_MOVE:e._isPressed||(r=ED.BUTTON_MISSING)}var a=new ED(t,!1,e._preMousePos);a.setLocation(i.x,i.y),a.setButton(r),a.movementX=i.x-e._preMousePos.x,a.movementY=e._preMousePos.y-i.y,e._preMousePos.set(i.x,i.y),e._eventTarget.emit(t,a)}},e._handleMouseWheel=function(t){var e=Sw.MOUSE_WHEEL,n=this._getLocation(t),i=t.button,r=new ED(e,!1,this._preMousePos);r.setLocation(n.x,n.y),r.setButton(i),r.movementX=n.x-this._preMousePos.x,r.movementY=this._preMousePos.y-n.y,r.setScrollData(t.deltaX,t.deltaY),this._preMousePos.set(n.x,n.y),this._eventTarget.emit(Sw.MOUSE_WHEEL,r)},e.on=function(t,e,n){this._eventTarget.on(t,e,n)},t}(),kD=new Qn,UD=new(function(){function t(){this._touchMap=void 0,this._maxTouches=8,this._touchMap=new Map}var e=t.prototype;return e._cloneTouch=function(t){var e=t.getID();t.getStartLocation(kD);var n=new MD(kD.x,kD.y,e);return t.getLocation(kD),n.setPoint(kD.x,kD.y),t.getPreviousLocation(kD),n.setPrevPoint(kD),n},e._createTouch=function(t,e,n){if(this._touchMap.has(t))console.log("Cannot create the same touch object.");else{if(!this._checkTouchMapSizeMoreThanMax(t)){var i=new MD(e,n,t);return this._touchMap.set(t,i),this._updateTouch(i,e,n),this._cloneTouch(i)}console.log("The touches is more than MAX_TOUCHES.")}},e.releaseTouch=function(t){this._touchMap.has(t)&&this._touchMap.delete(t)},e.getTouch=function(t,e,n){var i=this._touchMap.get(t);return i?this._updateTouch(i,e,n):i=this._createTouch(t,e,n),i?this._cloneTouch(i):void 0},e.getAllTouches=function(){var t=this,e=[];return this._touchMap.forEach((function(n){if(n){var i=t._cloneTouch(n);e.push(i)}})),e},e._updateTouch=function(t,e,n){t.getLocation(kD),t.setPrevPoint(kD),t.setPoint(e,n)},e._checkTouchMapSizeMoreThanMax=function(t){var e=this;if(this._touchMap.has(t))return!1;var n=_e.ENABLE_MULTI_TOUCH?this._maxTouches:1;if(this._touchMap.size<n)return!1;var i=performance.now();return this._touchMap.forEach((function(t){i-t.lastModified>_e.TOUCH_TIMEOUT&&(console.log("The touches is more than MAX_TOUCHES, release touch id "+t.getID()+"."),e.releaseTouch(t.getID()))})),n>=this._touchMap.size},t}()),GD=function(){function t(){this._eventTarget=new uh,this._registerEvent()}var e=t.prototype;return e._registerEvent=function(){dh.onTouchStart(this._createCallback(Sw.TOUCH_START)),dh.onTouchMove(this._createCallback(Sw.TOUCH_MOVE)),dh.onTouchEnd(this._createCallback(Sw.TOUCH_END)),dh.onTouchCancel(this._createCallback(Sw.TOUCH_CANCEL))},e._createCallback=function(t){var e=this;return function(n){for(var i=[],r=Cu.windowSize,a=Cu.devicePixelRatio,o=n.changedTouches.length,s=0;s<o;++s){var c=n.changedTouches[s],l=c.identifier;if(null!==l){var h=e._getLocation(c,r,a),u=UD.getTouch(l,h.x,h.y);u&&(t!==Sw.TOUCH_END&&t!==Sw.TOUCH_CANCEL||UD.releaseTouch(l),i.push(u))}}if(i.length>0){var _=new ID(i,!1,t,_e.ENABLE_MULTI_TOUCH?UD.getAllTouches():i);e._eventTarget.emit(t,_)}}},e._getLocation=function(t,e,n){var i=t.clientX*n,r=e.height-t.clientY*n;return new Qn(i,r)},e.on=function(t,e,n){this._eventTarget.on(t,e,n)},t}();!function(t){t[t.GLOBAL=0]="GLOBAL",t[t.UI=1]="UI"}(FD||(FD={}));var HD=function(){function t(t){this.priority=FD.GLOBAL,this._inputEventTarget=void 0,this._inputEventTarget=t}return t.prototype.dispatchEvent=function(t){return this._inputEventTarget.emit(t.type,t),!0},t}(),jD=((LD={})[Sw.MOUSE_DOWN]=Sw.TOUCH_START,LD[Sw.MOUSE_MOVE]=Sw.TOUCH_MOVE,LD[Sw.MOUSE_UP]=Sw.TOUCH_END,LD),WD=t("Input",function(){function t(){this._dispatchImmediately=!0,this._eventTarget=new uh,this._touchInput=new GD,this._mouseInput=new zD,this._keyboardInput=new VD,this._accelerometerInput=new OD,this._eventTouchList=[],this._eventMouseList=[],this._eventKeyboardList=[],this._eventAccelerationList=[],this._needSimulateTouchMoveEvent=!1,this._inputEventDispatcher=void 0,this._eventDispatcherList=[],this._registerEvent(),this._inputEventDispatcher=new HD(this._eventTarget),this._registerEventDispatcher(this._inputEventDispatcher)}var e=t.prototype;return e.on=function(t,e,n){return this._eventTarget.on(t,e,n),e},e.once=function(t,e,n){return this._eventTarget.once(t,e,n),e},e.off=function(t,e,n){this._eventTarget.off(t,e,n)},e.setAccelerometerEnabled=function(t){t?this._accelerometerInput.start():this._accelerometerInput.stop()},e.setAccelerometerInterval=function(t){this._accelerometerInput.setInterval(t)},e._simulateEventTouch=function(t){var e=jD[t.type],n=UD.getTouch(0,t.getLocationX(),t.getLocationY());if(n){var i=[n],r=new ID(i,!1,e,i);e===Sw.TOUCH_END&&UD.releaseTouch(0),this._dispatchOrPushEventTouch(r,this._eventTouchList)}},e._registerEventDispatcher=function(t){this._eventDispatcherList.push(t),this._eventDispatcherList.sort((function(t,e){return e.priority-t.priority}))},e._emitEvent=function(t){for(var e=this._eventDispatcherList.length,n=0;n<e&&this._eventDispatcherList[n].dispatchEvent(t);++n);},e._registerEvent=function(){var t=this;if(wu.hasFeature(wu.Feature.INPUT_TOUCH)){var e=this._eventTouchList;this._touchInput.on(Sw.TOUCH_START,(function(n){t._dispatchOrPushEventTouch(n,e)})),this._touchInput.on(Sw.TOUCH_MOVE,(function(n){t._dispatchOrPushEventTouch(n,e)})),this._touchInput.on(Sw.TOUCH_END,(function(n){t._dispatchOrPushEventTouch(n,e)})),this._touchInput.on(Sw.TOUCH_CANCEL,(function(n){t._dispatchOrPushEventTouch(n,e)}))}if(wu.hasFeature(wu.Feature.EVENT_MOUSE)){var n=this._eventMouseList;this._mouseInput.on(Sw.MOUSE_DOWN,(function(e){t._needSimulateTouchMoveEvent=!0,t._simulateEventTouch(e),t._dispatchOrPushEvent(e,n)})),this._mouseInput.on(Sw.MOUSE_MOVE,(function(e){t._needSimulateTouchMoveEvent&&t._simulateEventTouch(e),t._dispatchOrPushEvent(e,n)})),this._mouseInput.on(Sw.MOUSE_UP,(function(e){t._needSimulateTouchMoveEvent=!1,t._simulateEventTouch(e),t._dispatchOrPushEvent(e,n)})),this._mouseInput.on(Sw.MOUSE_WHEEL,(function(e){t._dispatchOrPushEvent(e,n)}))}if(wu.hasFeature(wu.Feature.EVENT_KEYBOARD)){var i=this._eventKeyboardList;this._keyboardInput.on(Sw.KEY_DOWN,(function(e){t._dispatchOrPushEvent(e,i)})),this._keyboardInput.on(Sw.KEY_PRESSING,(function(e){t._dispatchOrPushEvent(e,i)})),this._keyboardInput.on(Sw.KEY_UP,(function(e){t._dispatchOrPushEvent(e,i)}))}if(wu.hasFeature(wu.Feature.EVENT_ACCELEROMETER)){var r=this._eventAccelerationList;this._accelerometerInput.on(Sw.DEVICEMOTION,(function(e){t._dispatchOrPushEvent(e,r)}))}},e._clearEvents=function(){this._eventMouseList.length=0,this._eventTouchList.length=0,this._eventKeyboardList.length=0,this._eventAccelerationList.length=0},e._dispatchOrPushEvent=function(t,e){this._dispatchImmediately?this._emitEvent(t):e.push(t)},e._dispatchOrPushEventTouch=function(t,e){if(this._dispatchImmediately)for(var n=t.getTouches(),i=n.length,r=0;r<i;++r)t.touch=n[r],t.propagationStopped=t.propagationImmediateStopped=!1,this._emitEvent(t);else e.push(t)},e._frameDispatchEvents=function(){for(var t=this._eventMouseList,e=0,n=t.length;e<n;++e){var i=t[e];this._emitEvent(i)}for(var r=this._eventTouchList,a=0,o=r.length;a<o;++a)for(var s=r[a],c=s.getTouches(),l=c.length,h=0;h<l;++h)s.touch=c[h],s.propagationStopped=s.propagationImmediateStopped=!1,this._emitEvent(s);for(var u=this._eventKeyboardList,_=0,f=u.length;_<f;++_){var d=u[_];this._emitEvent(d)}for(var p=this._eventAccelerationList,m=0,v=p.length;m<v;++m){var g=p[m];this._emitEvent(g)}this._clearEvents()},t}());WD.EventType=Sw;var qD=t("input",new WD),XD=t("SystemEvent",function(t){function e(){var e;return e=t.call(this)||this,qD.on(Sw.MOUSE_DOWN,(function(t){e.emit(xw.MOUSE_DOWN,t)})),qD.on(Sw.MOUSE_MOVE,(function(t){e.emit(xw.MOUSE_MOVE,t)})),qD.on(Sw.MOUSE_UP,(function(t){e.emit(xw.MOUSE_UP,t)})),qD.on(Sw.MOUSE_WHEEL,(function(t){e.emit(xw.MOUSE_WHEEL,t)})),qD.on(Sw.TOUCH_START,(function(t){e.emit(xw.TOUCH_START,t.touch,t)})),qD.on(Sw.TOUCH_MOVE,(function(t){e.emit(xw.TOUCH_MOVE,t.touch,t)})),qD.on(Sw.TOUCH_END,(function(t){e.emit(xw.TOUCH_END,t.touch,t)})),qD.on(Sw.TOUCH_CANCEL,(function(t){e.emit(xw.TOUCH_CANCEL,t.touch,t)})),qD.on(Sw.KEY_DOWN,(function(t){e.emit(xw.KEY_DOWN,t)})),qD.on(Sw.KEY_PRESSING,(function(t){e.emit(xw.KEY_DOWN,t)})),qD.on(Sw.KEY_UP,(function(t){e.emit(xw.KEY_UP,t)})),qD.on(Sw.DEVICEMOTION,(function(t){e.emit(xw.DEVICEMOTION,t)})),e}$(e,t);var n=e.prototype;return n.setAccelerometerEnabled=function(t){qD.setAccelerometerEnabled(t)},n.setAccelerometerInterval=function(t){qD.setAccelerometerInterval(t)},n.on=function(e,n,i,r){return t.prototype.on.call(this,e,n,i,r),n},n.off=function(e,n,i){t.prototype.off.call(this,e,n,i)},e}(uh));XD.EventType=xw,h.SystemEvent=XD;var YD,KD=t("systemEvent",new XD);h.systemEvent=KD,k(xw,"Node.EventType",[{name:"POSITION_PART",newName:"TRANSFORM_CHANGED"},{name:"ROTATION_PART",newName:"TRANSFORM_CHANGED"},{name:"SCALE_PART",newName:"TRANSFORM_CHANGED"}]),k(bD,"Event",[{name:"ACCELERATION",newName:"DEVICEMOTION",target:XD.EventType,targetName:"SystemEvent.EventType"}]),G(bD,"Event",[{name:"TOUCH",suggest:"please use SystemEvent.EventType.TOUCH_START, SystemEvent.EventType.TOUCH_MOVE, SystemEvent.EventType.TOUCH_END and SystemEvent.EventType.TOUCH_CANCEL instead"},{name:"MOUSE",suggest:"please use SystemEvent.EventType.MOUSE_DOWN, SystemEvent.EventType.MOUSE_MOVE, SystemEvent.EventType.MOUSE_UP, SystemEvent.EventType.MOUSE_WHEEL, Node.EventType.MOUSE_ENTER and Node.EventType.MOUSE_LEAVE instead"},{name:"KEYBOARD",suggest:"please use SystemEvent.EventType.KEY_DOWN and SystemEvent.EventType.KEY_UP instead"}]),k(ED,"EventMouse",["DOWN","UP","MOVE"].map((function(t){return{name:t,newName:"MOUSE_"+t,target:XD.EventType,targetName:"SystemEvent.EventType"}}))),k(ED,"EventMouse",[{name:"SCROLL",newName:"MOUSE_WHEEL",target:XD.EventType,targetName:"SystemEvent.EventType"}]),G(ED.prototype,"EventMouse.prototype",[{name:"eventType",suggest:"please use EventMouse.prototype.type instead"}]),k(ID,"EventTouch",[{name:"BEGAN",newName:"TOUCH_START",target:XD.EventType,targetName:"SystemEvent.EventType"}]),k(ID,"EventTouch",[{name:"MOVED",newName:"TOUCH_MOVE",target:XD.EventType,targetName:"SystemEvent.EventType"}]),k(ID,"EventTouch",[{name:"ENDED",newName:"TOUCH_END",target:XD.EventType,targetName:"SystemEvent.EventType"}]),k(ID,"EventTouch",[{name:"CANCELLED",newName:"TOUCH_CANCEL",target:XD.EventType,targetName:"SystemEvent.EventType"}]),G(ID.prototype,"EventTouch.prototype",[{name:"getEventCode",suggest:"please use EventTouch.prototype.type instead"}]),k(ID.prototype,"EventTouch.prototype",[{name:"getUILocationInView",newName:"getLocationInView",target:ID,targetName:"EventTouch"}]),G(_e.KEY,"macro.KEY",["back","menu","0","1","2","3","4","5","6","7","8","9","0","*","+","-","/",";","=",",",".","[","]","dpadLeft","dpadRight","dpadUp","dpadDown","dpadCenter"].map((function(t){return{name:t}}))),G(_e.KEY,"macro.KEY",[{name:"shift",suggest:"please use KeyCode.SHIFT_LEFT instead"}]),G(_e.KEY,"macro.KEY",[{name:"ctrl",suggest:"please use KeyCode.CTRL_LEFT instead"}]),G(_e.KEY,"macro.KEY",[{name:"alt",suggest:"please use KeyCode.ALT_LEFT instead"}]),G(_e,"macro",[{name:"KEY",suggest:"please use KeyCode instead"}]),k(JC.prototype,"BaseNode",[{name:"childrenCount",newName:"children.length",customGetter:function(){return this.children.length}}]),k(TE.prototype,"Node",[{name:"width",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.width},customSetter:function(t){this._uiProps.uiTransformComp.width=t}},{name:"height",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.height},customSetter:function(t){this._uiProps.uiTransformComp.height=t}},{name:"anchorX",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorX},customSetter:function(t){this._uiProps.uiTransformComp.anchorX=t}},{name:"anchorY",targetName:"node.getComponent(UITransform)",customGetter:function(){return this._uiProps.uiTransformComp.anchorY},customSetter:function(t){this._uiProps.uiTransformComp.anchorY=t}},{name:"getAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(t){return t||(t=new Qn),t.set(this._uiProps.uiTransformComp.anchorPoint),t}},{name:"setAnchorPoint",targetName:"node.getComponent(UITransform)",customFunction:function(t,e){this._uiProps.uiTransformComp.setAnchorPoint(t,e)}},{name:"getContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(t){return t||(t=new ri),t.set(this._uiProps.uiTransformComp.contentSize),t}},{name:"setContentSize",targetName:"node.getComponent(UITransform)",customFunction:function(t,e){"number"==typeof t?this._uiProps.uiTransformComp.setContentSize(t,e):this._uiProps.uiTransformComp.setContentSize(t)}}]),U(AD.prototype,"SceneGlobals.prototype",[{name:"aspect"},{name:"selfShadow"},{name:"linear"},{name:"packing"},{name:"autoAdapt"},{name:"fixedArea"},{name:"pcf"},{name:"bias"},{name:"normalBias"},{name:"near"},{name:"far"},{name:"shadowDistance"},{name:"invisibleOcclusionRange"},{name:"orthoSize"},{name:"saturation"}]),k(AD.prototype,"SceneGlobals.prototype",[{name:"distance",newName:"planeHeight"},{name:"normal",newName:"planeDirection"}]),U(TE.prototype,"Node.prototype",[{name:"addLayer"},{name:"removeLayer"}]),k(OC.prototype,"NodeUIProperties",[{name:"opacityDirty",newName:"colorDirty"}]),U(Hd,"Layers",[{name:"All"},{name:"RaycastMask"},{name:"check"}]),k(Hd,"Layers",[{name:"Default",newName:"DEFAULT",target:Hd.Enum,targetName:"Layers.Enum"},{name:"Always",newName:"ALWAYS",target:Hd.Enum,targetName:"Layers.Enum"},{name:"IgnoreRaycast",newName:"IGNORE_RAYCAST",target:Hd.Enum,targetName:"Layers.Enum"},{name:"Gizmos",newName:"GIZMOS",target:Hd.Enum,targetName:"Layers.Enum"},{name:"Editor",newName:"EDITOR",target:Hd.Enum,targetName:"Layers.Enum"},{name:"UI",newName:"UI_3D",target:Hd.Enum,targetName:"Layers.Enum"},{name:"UI2D",newName:"UI_2D",target:Hd.Enum,targetName:"Layers.Enum"},{name:"SceneGizmo",newName:"SCENE_GIZMO",target:Hd.Enum,targetName:"Layers.Enum"},{name:"makeInclusiveMask",newName:"makeMaskInclude",target:Hd,targetName:"Layers"},{name:"makeExclusiveMask",newName:"makeMaskExclude",target:Hd,targetName:"Layers"}]),U(Hd.Enum,"Layers.Enum",[{name:"ALWAYS"}]),U(Hd.BitMask,"Layers.BitMask",[{name:"ALWAYS"}]);var JD,QD,ZD,$D,tR=ml.Flags.HideInHierarchy,eR=ml.Flags.DontSave,nR=t("PrivateNode",Ec("cc.PrivateNode")(YD=function(t){function e(e){var n;return R(12003,(n=t.call(this,e)||this).name),n.hideFlags|=eR|tR,n}return $(e,t),e}(TE))||YD);k(xw,"SystemEventType",["MOUSE_ENTER","MOUSE_LEAVE","TRANSFORM_CHANGED","SCENE_CHANGED_FOR_PERSISTS","SIZE_CHANGED","ANCHOR_CHANGED","COLOR_CHANGED","CHILD_ADDED","CHILD_REMOVED","PARENT_CHANGED","NODE_DESTROYED","LAYER_CHANGED","SIBLING_ORDER_CHANGED"].map((function(t){return{name:t,target:TE.EventType,targetName:"Node.EventType"}}))),k(TE.EventType,"Node.EventType",[{name:"DEVICEMOTION",target:XD.EventType,targetName:"SystemEvent.EventType"},{name:"KEY_DOWN",target:XD.EventType,targetName:"SystemEvent.EventType"},{name:"KEY_UP",target:XD.EventType,targetName:"SystemEvent.EventType"}]),h.PrivateNode=nR;var iR=t("Scene",Ec("cc.Scene")((lt((QD=function(t){$(n,t);var e=n.prototype;function n(e){var n;return ct(n=t.call(this,e)||this,"autoReleaseAssets",ZD,at(n)),ct(n,"_globals",$D,at(n)),n.dependAssets=null,n._renderScene=null,n._inited=void 0,n._prefabSyncedInLiveReload=!1,n._pos=Mn.ZERO,n._rot=zn.IDENTITY,n._scale=Mn.ONE,n._mat=Xn.IDENTITY,n._dirtyFlags=0,n._lpos=Mn.ZERO,n._lrot=zn.IDENTITY,n._lscale=Mn.ONE,n._activeInHierarchy=!1,h.director&&h.director.root&&(n._renderScene=h.director.root.createScene({})),n._inited=!h.game||!h.game._isCloning,n._init(),n}return e._updateScene=function(){this._scene=this},e._init=function(){},e.destroy=function(){var t=ml.prototype.destroy.call(this);if(t)for(var e=this._children,n=0;n<e.length;++n)e[n].active=!1;return this._renderScene&&h.director.root.destroyScene(this._renderScene),this._active=!1,this._activeInHierarchy=!1,t},e.addComponent=function(){throw new Error(F(3822))},e._onHierarchyChanged=function(){},e._onBatchCreated=function(e){t.prototype._onBatchCreated.call(this,e);for(var n=this._children.length,i=0;i<n;++i)this.children[i]._siblingIndex=i,this._children[i]._onBatchCreated(e)},e.getPosition=function(t){return Mn.copy(t||new Mn,Mn.ZERO)},e.getRotation=function(t){return zn.copy(t||new zn,zn.IDENTITY)},e.getScale=function(t){return Mn.copy(t||new Mn,Mn.ONE)},e.getWorldPosition=function(t){return Mn.copy(t||new Mn,Mn.ZERO)},e.getWorldRotation=function(t){return zn.copy(t||new zn,zn.IDENTITY)},e.getWorldScale=function(t){return Mn.copy(t||new Mn,Mn.ONE)},e.getWorldMatrix=function(t){return Xn.copy(t||new Xn,Xn.IDENTITY)},e.getWorldRS=function(t){return Xn.copy(t||new Xn,Xn.IDENTITY)},e.getWorldRT=function(t){return Xn.copy(t||new Xn,Xn.IDENTITY)},e.updateWorldTransform=function(){},e._instantiate=function(){},e._load=function(){this._inited||(HE(this),UE(this),this._onBatchCreated(false),this._inited=!0),this.walk(JC._setScene)},e._activate=function(t){t=!1!==t,h.director._nodeActivator.activateNode(this,t),this._globals.activate(),this._renderScene&&this._renderScene.activate()},Q(n,[{key:"renderScene",get:function(){return this._renderScene}},{key:"globals",get:function(){return this._globals}},{key:"native",get:function(){return this._nativeObj}},{key:"position",get:function(){return Mn.ZERO}},{key:"worldPosition",get:function(){return Mn.ZERO}},{key:"rotation",get:function(){return zn.IDENTITY}},{key:"worldRotation",get:function(){return zn.IDENTITY}},{key:"scale",get:function(){return Mn.ONE}},{key:"worldScale",get:function(){return Mn.ONE}},{key:"eulerAngles",get:function(){return Mn.ZERO}},{key:"worldMatrix",get:function(){return Xn.IDENTITY}}]),n}(JC)).prototype,"globals",[Wc],Object.getOwnPropertyDescriptor(QD.prototype,"globals"),QD.prototype),ZD=lt(QD.prototype,"autoReleaseAssets",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$D=lt(QD.prototype,"_globals",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new AD}}),JD=QD))||JD);function rR(t,e){if(!e){var n=h.director.getScene();if(!n)return null;e=n}return e.getChildByPath(t)}h.Scene=iR,h.find=rR;var aR=ie.fastRemoveAt,oR=ml.Flags.IsStartCalled,sR=ml.Flags.IsOnEnableCalled;function cR(t,e){for(var n=e.constructor._executionOrder,i=e._id,r=0,a=t.length-1,o=a>>>1;r<=a;o=r+a>>>1){var s=t[o],c=s.constructor._executionOrder;if(c>n)a=o-1;else if(c<n)r=o+1;else{var l=s._id;if(l>i)a=o-1;else{if(!(l<i))return o;r=o+1}}}return~r}function lR(t,e){for(var n=t.array,i=t.i+1;i<n.length;){var r=n[i];r.node._activeInHierarchy?++i:(t.removeAt(i),e&&(r._objFlags&=~e))}}ml.Flags.IsEditorOnEnableCalled;var hR=function(t){this._zero=void 0,this._neg=void 0,this._pos=void 0,this._invoke=void 0;var e=ht;this._zero=new e([]),this._neg=new e([]),this._pos=new e([]),this._invoke=t};function uR(t,e){return t.constructor._executionOrder-e.constructor._executionOrder}hR.stableRemoveInactive=lR;var _R=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.add=function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).array.push(t)},n.remove=function(t){var e=t.constructor._executionOrder;(0===e?this._zero:e<0?this._neg:this._pos).fastRemove(t)},n.cancelInactive=function(t){lR(this._zero,t),lR(this._neg,t),lR(this._pos,t)},n.invoke=function(){var t=this._neg;t.array.length>0&&(t.array.sort(uR),this._invoke(t),t.array.length=0),this._invoke(this._zero),this._zero.array.length=0;var e=this._pos;e.array.length>0&&(e.array.sort(uR),this._invoke(e),e.array.length=0)},e}(hR),fR=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.add=function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.array.push(t);else{var n=e<0?this._neg.array:this._pos.array,i=cR(n,t);i<0&&n.splice(~i,0,t)}},n.remove=function(t){var e=t.constructor._executionOrder;if(0===e)this._zero.fastRemove(t);else{var n=e<0?this._neg:this._pos,i=cR(n.array,t);i>=0&&n.removeAt(i)}},n.invoke=function(t){this._neg.array.length>0&&this._invoke(this._neg,t),this._invoke(this._zero,t),this._pos.array.length>0&&this._invoke(this._pos,t)},e}(hR);function dR(t,e,n){return function(i,r){try{e(i,r)}catch(e){h._throw(e);var a=i.array;for(n&&(a[i.i]._objFlags|=n),++i.i;i.i<a.length;++i.i)try{t(a[i.i],r)}catch(t){h._throw(t),n&&(a[i.i]._objFlags|=n)}}}}var pR=dR((function(t){t.start(),t._objFlags|=oR}),(function(t){var e=t.array;for(t.i=0;t.i<e.length;++t.i){var n=e[t.i];n.start(),n._objFlags|=oR}}),oR),mR=dR((function(t,e){t.update(e)}),(function(t,e){var n=t.array;for(t.i=0;t.i<n.length;++t.i)n[t.i].update(e)})),vR=dR((function(t,e){t.lateUpdate(e)}),(function(t,e){var n=t.array;for(t.i=0;t.i<n.length;++t.i)n[t.i].lateUpdate(e)})),gR=function(t){var e=h.director._compScheduler,n=t.array;for(t.i=0;t.i<n.length;++t.i){var i=n[t.i];i._enabled&&(i.onEnable(),!i.node._activeInHierarchy||e._onEnabled(i))}},yR=function(){function t(){this._deferredComps=[],this.unscheduleAll()}var e=t.prototype;return e.unscheduleAll=function(){this.startInvoker=new _R(pR),this.updateInvoker=new fR(mR),this.lateUpdateInvoker=new fR(vR),this._updating=!1},e._onEnabled=function(t){h.director.getScheduler().resumeTarget(t),t._objFlags|=sR,this._updating?this._deferredComps.push(t):this._scheduleImmediate(t)},e._onDisabled=function(t){h.director.getScheduler().pauseTarget(t),t._objFlags&=~sR;var e=this._deferredComps.indexOf(t);e>=0?aR(this._deferredComps,e):(!t.start||t._objFlags&oR||this.startInvoker.remove(t),t.update&&this.updateInvoker.remove(t),t.lateUpdate&&this.lateUpdateInvoker.remove(t))},e.enableComp=function(t,e){if(!(t._objFlags&sR)){if(t.onEnable){if(e)return void e.add(t);if(t.onEnable(),!t.node._activeInHierarchy)return}this._onEnabled(t)}},e.disableComp=function(t){t._objFlags&sR&&(t.onDisable&&t.onDisable(),this._onDisabled(t))},e.startPhase=function(){this._updating=!0,this.startInvoker.invoke(),this._startForNewComps()},e.updatePhase=function(t){this.updateInvoker.invoke(t)},e.lateUpdatePhase=function(t){this.lateUpdateInvoker.invoke(t),this._updating=!1,this._startForNewComps()},e._startForNewComps=function(){this._deferredComps.length>0&&(this._deferredSchedule(),this.startInvoker.invoke())},e._scheduleImmediate=function(t){"function"!=typeof t.start||t._objFlags&oR||this.startInvoker.add(t),"function"==typeof t.update&&this.updateInvoker.add(t),"function"==typeof t.lateUpdate&&this.lateUpdateInvoker.add(t)},e._deferredSchedule=function(){for(var t=this._deferredComps,e=0,n=t.length;e<n;e++)this._scheduleImmediate(t[e]);t.length=0},t}(),xR=ml.Flags.IsPreloadStarted,SR=ml.Flags.IsOnLoadStarted,AR=ml.Flags.IsOnLoadCalled,bR=ml.Flags.Deactivating,CR=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.add=function(t){this._zero.array.push(t)},n.remove=function(t){this._zero.fastRemove(t)},n.cancelInactive=function(t){hR.stableRemoveInactive(this._zero,t)},n.invoke=function(){this._invoke(this._zero),this._zero.array.length=0},e}(hR),TR=dR((function(t){t.__preload()}),(function(t){var e=t.array;for(t.i=0;t.i<e.length;++t.i)e[t.i].__preload()})),ER=dR((function(t){t.onLoad(),t._objFlags|=AR}),(function(t){var e=t.array;for(t.i=0;t.i<e.length;++t.i){var n=e[t.i];n.onLoad(),n._objFlags|=AR}}),AR),wR=new ne(4);function IR(t,e,n){O(3817,t.name,n),console.log("Corrupted component value:",e),e?t._removeComponent(e):ie.removeAt(t._components,n)}wR.get=function(){var t=this._get()||{preload:new CR(TR),onLoad:new _R(ER),onEnable:new _R(gR)};t.preload._zero.i=-1;var e=t.onLoad;return e._zero.i=-1,e._neg.i=-1,e._pos.i=-1,(e=t.onEnable)._zero.i=-1,e._neg.i=-1,e._pos.i=-1,t};var PR,DR,RR,MR,OR,NR,BR,LR,FR=t("NodeActivator",function(){function t(){this.resetComp=void 0,this.reset()}var e=t.prototype;return e.reset=function(){this._activatingStack=[]},e.activateNode=function(t,e){if(e){var n=wR.get();this._activatingStack.push(n),this._activateNodeRecursively(t,n.preload,n.onLoad,n.onEnable),n.preload.invoke(),n.onLoad.invoke(),n.onEnable.invoke(),this._activatingStack.pop(),wR.put(n)}else{this._deactivateNodeRecursively(t);for(var i,r=st(this._activatingStack);!(i=r()).done;){var a=i.value;a.preload.cancelInactive(xR),a.onLoad.cancelInactive(SR),a.onEnable.cancelInactive()}}t.emit(bC.ACTIVE_IN_HIERARCHY_CHANGED,t)},e.activateComp=function(t,e,n,i){if(gl(t,!0)&&(t._objFlags&xR||(t._objFlags|=xR,t.__preload&&(e?e.add(t):t.__preload())),t._objFlags&SR||(t._objFlags|=SR,t.onLoad?n?n.add(t):(t.onLoad(),t._objFlags|=AR):t._objFlags|=AR),t._enabled)){if(!t.node._activeInHierarchy)return;h.director._compScheduler.enableComp(t,i)}},e.destroyComp=function(t){h.director._compScheduler.disableComp(t),t.onDestroy&&t._objFlags&AR&&t.onDestroy()},e._activateNodeRecursively=function(t,e,n,i){if(t._objFlags&bR)O(3816,t.name);else{t._activeInHierarchy=!0;for(var r=t._components.length,a=0;a<r;++a){var o=t._components[a];o instanceof h.Component?this.activateComp(o,e,n,i):(IR(t,o,a),--a,--r)}for(var s=0,c=t._children.length;s<c;++s){var l=t._children[s];l._active&&this._activateNodeRecursively(l,e,n,i)}t._onPostActivated(!0)}},e._deactivateNodeRecursively=function(t){t._objFlags|=bR,t._activeInHierarchy=!1;for(var e=t._components.length,n=0;n<e;++n){var i=t._components[n];if(i._enabled&&(h.director._compScheduler.disableComp(i),t._activeInHierarchy))return void(t._objFlags&=~bR)}for(var r=0,a=t._children.length;r<a;++r){var o=t._children[r];if(o._activeInHierarchy&&(this._deactivateNodeRecursively(o),t._activeInHierarchy))return void(t._objFlags&=~bR)}t._onPostActivated(!1),t._objFlags&=~bR},t}()),VR=t("SceneAsset",Ec("cc.SceneAsset")((MR=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"scene",RR,at(e)),e}$(e,t);var n=e.prototype;return n.initDefault=function(e){t.prototype.initDefault.call(this,e),this.scene=new iR("New Scene")},n.validate=function(){return!!this.scene},e}($h),RR=lt((DR=MR).prototype,"scene",[Wc,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),PR=DR))||PR);h.SceneAsset=VR;var zR,kR,UR,GR,HR=t("TextAsset",Ec("cc.TextAsset")((LR=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"text",BR,at(e)),e}return $(e,t),e.prototype.toString=function(){return this.text},e}($h),BR=lt((NR=LR).prototype,"text",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),OR=NR))||OR);h.TextAsset=HR;var jR=t("JsonAsset",Ec("cc.JsonAsset")((GR=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"json",UR,at(e)),e}return $(e,t),e}($h),UR=lt((kR=GR).prototype,"json",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zR=kR))||zR);h.JsonAsset=jR;var WR,qR,XR,YR,KR,JR,QR,ZR,$R,tM,eM,nM,iM,rM,aM,oM,sM,cM,lM,hM,uM,_M,fM,dM,pM,mM,vM,gM,yM,xM,SM,AM,bM,CM,TM,EM,wM,IM,PM=function(){var t=e.prototype;function e(){this.fog=new By,this.ambient=new Ty,this.skybox=new Ry,this.shadows=new Rg,this.octree=new zy,this.validPunctualLights=[],this.renderObjects=[],this.castShadowObjects=[],this.dirShadowObjects=[],this.shadowFrameBufferMap=new Map,this._geometryRendererMaterials=[],this._geometryRendererPasses=[],this._geometryRendererShaders=[],this._occlusionQueryVertexBuffer=null,this._occlusionQueryIndicesBuffer=null,this._occlusionQueryInputAssembler=null,this._occlusionQueryMaterial=null,this._occlusionQueryShader=null,this._isHDR=!0,this._shadingScale=1,this._init(),this.shadingScale=1}return t._init=function(){},t.activate=function(t,e){return this._device=t,this._pipeline=e,this.initGeometryRendererMaterials(),this.initOcclusionQuery(),!0},t.initGeometryRendererMaterials=function(){for(var t=0,e=0;e<6;e++){this._geometryRendererMaterials[e]=new vg,this._geometryRendererMaterials[e]._uuid="geometry-renderer-material-"+e,this._geometryRendererMaterials[e].initialize({effectName:"geometry-renderer",technique:e});for(var n=0;n<this._geometryRendererMaterials[e].passes.length;++n)this._geometryRendererPasses[t]=this._geometryRendererMaterials[e].passes[n],this._geometryRendererShaders[t]=this._geometryRendererMaterials[e].passes[n].getShaderVariant(),t++}},t.initOcclusionQuery=function(){if(this._occlusionQueryInputAssembler||(this._occlusionQueryInputAssembler=this._createOcclusionQueryIA()),!this._occlusionQueryMaterial){var t=new vg;t._uuid="default-occlusion-query-material",t.initialize({effectName:"occlusion-query"}),this._occlusionQueryMaterial=t,this._occlusionQueryShader=t.passes[0].getShaderVariant()}},t.getOcclusionQueryPass=function(){return this._occlusionQueryMaterial.passes[0]},t.onGlobalPipelineStateChanged=function(){},t.destroy=function(){var t,e,n;this.ambient.destroy(),this.skybox.destroy(),this.fog.destroy(),this.shadows.destroy(),this.octree.destroy(),this.validPunctualLights.length=0,null===(t=this._occlusionQueryInputAssembler)||void 0===t||t.destroy(),this._occlusionQueryInputAssembler=null,null===(e=this._occlusionQueryVertexBuffer)||void 0===e||e.destroy(),this._occlusionQueryVertexBuffer=null,null===(n=this._occlusionQueryIndicesBuffer)||void 0===n||n.destroy(),this._occlusionQueryIndicesBuffer=null},t._createOcclusionQueryIA=function(){var t=this._device,e=new Float32Array([-1,-1,-1,1,-1,-1,-1,1,-1,1,1,-1,-1,-1,1,1,-1,1,-1,1,1,1,1,1]),n=3*Float32Array.BYTES_PER_ELEMENT,i=8*n;this._occlusionQueryVertexBuffer=t.createBuffer(new gr(yi.VERTEX|yi.TRANSFER_DST,Ai.DEVICE,i,n)),this._occlusionQueryVertexBuffer.update(e);var r=new Uint16Array([0,2,1,1,2,3,4,5,6,5,7,6,1,3,7,1,7,5,0,4,6,0,6,2,0,1,5,0,5,4,2,6,7,2,7,3]),a=Uint16Array.BYTES_PER_ELEMENT,o=36*a;this._occlusionQueryIndicesBuffer=t.createBuffer(new gr(yi.INDEX|yi.TRANSFER_DST,Ai.DEVICE,o,a)),this._occlusionQueryIndicesBuffer.update(r);var s=[new Br("a_position",mi.RGB32F)],c=new Fr(s,[this._occlusionQueryVertexBuffer],this._occlusionQueryIndicesBuffer);return t.createInputAssembler(c)},Q(e,[{key:"native",get:function(){return this._nativeObj}},{key:"isHDR",get:function(){return this._isHDR},set:function(t){this._isHDR=t}},{key:"shadingScale",get:function(){return this._shadingScale},set:function(t){this._shadingScale!==t&&(this._shadingScale=t,this._pipeline.emit(nS.ATTACHMENT_SCALE_CAHNGED,t))}},{key:"geometryRendererPasses",get:function(){return this._geometryRendererPasses}},{key:"geometryRendererShaders",get:function(){return this._geometryRendererShaders}}]),e}(),DM=t("ForwardPipeline",(WR=Ec("ForwardPipeline"),qR=cl([nb]),XR=el(),WR((QR=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"renderTextures",JR,at(e)),e._postRenderPass=null,e}$(e,t);var n=e.prototype;return n.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._flows.length){var n=new oC;n.initialize(oC.initInfo),this._flows.push(n);var i=new Gb;i.initialize(Gb.initInfo),this._flows.push(i)}return!0},n.activate=function(e){return this._macros={CC_PIPELINE_TYPE:0},this._pipelineSceneData=new PM,!(!t.prototype.activate.call(this,e)||!this._activeRenderer(e)&&(O(2402),1))},n._ensureEnoughSize=function(t){for(var e=this._width,n=this._height,i=0;i<t.length;++i){var r=t[i].window;e=Math.max(r.width,e),n=Math.max(r.height,n)}e===this._width&&n===this._height||(this._width=e,this._height=n)},n.destroy=function(){this._destroyUBOs(),this._destroyQuadInputAssembler();for(var e=this._renderPasses.values(),n=e.next();!n.done;)n.value.destroy(),n=e.next();return this._commandBuffers.length=0,t.prototype.destroy.call(this)},n._activeRenderer=function(){var t=this.device;this._commandBuffers.push(t.commandBuffer);var e=this.globalDSManager.pointSampler;return this._descriptorSet.bindSampler(lp,e),this._descriptorSet.bindTexture(lp,Uv.get("default-texture").getGFXTexture()),this._descriptorSet.bindSampler(gp,e),this._descriptorSet.bindTexture(gp,Uv.get("default-texture").getGFXTexture()),this._descriptorSet.update(),!0},n._destroyUBOs=function(){this._descriptorSet&&(this._descriptorSet.getBuffer(op.BINDING).destroy(),this._descriptorSet.getBuffer(cp.BINDING).destroy(),this._descriptorSet.getBuffer(sp.BINDING).destroy(),this._descriptorSet.getTexture(lp).destroy(),this._descriptorSet.getTexture(gp).destroy())},Q(e,[{key:"postRenderPass",get:function(){return this._postRenderPass}}]),e}(CS),JR=lt((KR=QR).prototype,"renderTextures",[qR,Nc,XR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),YR=KR))||YR)),RM=[new dr(0,0,0,0),new dr(0,0,0,0),new dr(0,0,0,0)],MM=t("GbufferStage",(ZR=Ec("GbufferStage"),$R=cl([ab]),tM=el(),ZR((aM=rM=function(t){function e(){var e;return ct(e=t.call(this)||this,"renderQueues",iM,at(e)),e._renderQueues=[],e._renderArea=new or,e._batchedQueue=void 0,e._instancedQueue=void 0,e._phaseID=Gv("default"),e._batchedQueue=new _b,e._instancedQueue=new fb,e}$(e,t);var n=e.prototype;return n.initialize=function(e){return t.prototype.initialize.call(this,e),e.renderQueues&&(this.renderQueues=e.renderQueues),!0},n.activate=function(e,n){t.prototype.activate.call(this,e,n);for(var i=0;i<this.renderQueues.length;i++)this._renderQueues[i]=lb(this.renderQueues[i])},n.destroy=function(){},n.render=function(t){this._instancedQueue.clear(),this._batchedQueue.clear();var e=this._pipeline,n=e.device;this._renderQueues.forEach(hb),e.generateRenderArea(t,this._renderArea),e.updateQuadVertexData(this._renderArea,t.window);for(var i=e.pipelineSceneData.renderObjects,r=0,a=0,o=0,s=0;s<i.length;++s){var c=i[s],l=c.model.subModels;for(r=0;r<l.length;++r){var h=l[r],u=h.passes;for(a=0;a<u.length;++a){var _=u[a];if(_.phase===this._phaseID){var f=_.batchingScheme;if(f===Fv.INSTANCING){var d=_.getInstancedBuffer();d.merge(h,c.model.instancedAttributes,a),this._instancedQueue.queue.add(d)}else if(f===Fv.VB_MERGING){var p=_.getBatchedBuffer();p.merge(h,a,c.model),this._batchedQueue.queue.add(p)}else for(o=0;o<this._renderQueues.length;o++)this._renderQueues[o].insertRenderPass(c,r,a)}}}}this._renderQueues.forEach(ub);var m=e.commandBuffers[0];this._instancedQueue.uploadBuffers(m),this._batchedQueue.uploadBuffers(m),t.clearFlag&Zi.COLOR&&(e.pipelineSceneData.isHDR?Zv(RM[0],t.clearColor):(RM[0].x=t.clearColor.x,RM[0].y=t.clearColor.y,RM[0].z=t.clearColor.z)),RM[0].w=t.clearColor.w;var v=e.getPipelineRenderData().gbufferFrameBuffer,g=v.renderPass;m.beginRenderPass(g,v,this._renderArea,RM,t.clearDepth,t.clearStencil),m.setScissor(e.generateScissor(t)),m.setViewport(e.generateViewport(t)),m.bindDescriptorSet(ep.GLOBAL,e.descriptorSet);for(var y=0;y<this.renderQueues.length;y++)this._renderQueues[y].recordCommandBuffer(n,g,m);this._instancedQueue.recordCommandBuffer(n,g,m),this._batchedQueue.recordCommandBuffer(n,g,m),m.endRenderPass()},e}(eS),rM.initInfo={name:"GbufferStage",priority:mS.GBUFFER,tag:0,renderQueues:[{isTransparent:!1,sortMode:eb.FRONT_TO_BACK,stages:["default"]},{isTransparent:!0,sortMode:eb.BACK_TO_FRONT,stages:["default"]}]},iM=lt((nM=aM).prototype,"renderQueues",[$R,Nc,tM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),eM=nM))||eM)),OM=[new dr(0,0,0,1)],NM=t("LightingStage",(oM=Ec("LightingStage"),sM=cl(vg),cM=el(),lM=cl([ab]),hM=el(),oM((mM=pM=function(t){function e(){var e;return(e=t.call(this)||this)._deferredLitsBufs=null,e._maxDeferredLights=Ep.LIGHTS_PER_PASS,e._lightMeterScale=1e4,e._descriptorSet=null,e._renderArea=new or,e._uiPhase=void 0,ct(e,"_deferredMaterial",fM,at(e)),ct(e,"renderQueues",dM,at(e)),e._phaseID=Gv("default"),e._renderQueues=[],e._uiPhase=new zb,e}$(e,t);var n=e.prototype;return n.initialize=function(e){return t.prototype.initialize.call(this,e),!0},n.gatherLights=function(t){for(var e=this._pipeline,n=e.commandBuffers[0],i=t.scene.sphereLights,r=t.scene.spotLights,a=_o.create(0,0,0,1),o=new Float32Array(4),s=t.exposure,c=0,l=ei.length,h=l*this._maxDeferredLights,u=0;u<i.length&&c<this._maxDeferredLights;u++,++c){var _=i[u];if(_o.set(a,_.position.x,_.position.y,_.position.z,_.range),vs.sphereFrustum(a,t.frustum)){if(Mn.toArray(o,_.position),o[3]=0,this._lightBufferData.set(o,c*l),Mn.toArray(o,_.color),_.useColorTemperature){var f=_.colorTemperatureRGB;o[0]*=f.x,o[1]*=f.y,o[2]*=f.z}e.pipelineSceneData.isHDR?o[3]=_.luminance*s*this._lightMeterScale:o[3]=_.luminance,this._lightBufferData.set(o,c*l+1*h),o[0]=_.size,o[1]=_.range,o[2]=0,this._lightBufferData.set(o,c*l+2*h)}}for(var d=0;d<r.length&&c<this._maxDeferredLights;d++,++c){var p=r[d];if(_o.set(a,p.position.x,p.position.y,p.position.z,p.range),vs.sphereFrustum(a,t.frustum)){if(Mn.toArray(o,p.position),o[3]=1,this._lightBufferData.set(o,c*l+0*h),Mn.toArray(o,p.color),p.useColorTemperature){var m=p.colorTemperatureRGB;o[0]*=m.x,o[1]*=m.y,o[2]*=m.z}e.pipelineSceneData.isHDR?o[3]=p.luminance*s*this._lightMeterScale:o[3]=p.luminance,this._lightBufferData.set(o,c*l+1*h),o[0]=p.size,o[1]=p.range,o[2]=p.spotAngle,this._lightBufferData.set(o,c*l+2*h),Mn.toArray(o,p.direction),this._lightBufferData.set(o,c*l+3*h)}}var v=3*h+3;this._lightBufferData.set([c],v),n.updateBuffer(this._deferredLitsBufs,this._lightBufferData)},n._createStageDescriptor=function(t){var e=this._pipeline.device,n=16*Float32Array.BYTES_PER_ELEMENT*this._maxDeferredLights;n=Math.ceil(n/e.capabilities.uboOffsetAlignment)*e.capabilities.uboOffsetAlignment,this._deferredLitsBufs=e.createBuffer(new gr(yi.UNIFORM|yi.TRANSFER_DST,Ai.HOST|Ai.DEVICE,n,e.capabilities.uboOffsetAlignment));var i=e.createBuffer(new yr(this._deferredLitsBufs,0,n));this._lightBufferData=new Float32Array(n/Float32Array.BYTES_PER_ELEMENT),this._descriptorSet=e.createDescriptorSet(new Yr(t.localSetLayout)),this._descriptorSet.bindBuffer(Tp.BINDING,i);var r=e.createBuffer(new gr(yi.UNIFORM|yi.TRANSFER_DST,Ai.DEVICE,Sp.SIZE,Sp.SIZE));this._descriptorSet.bindBuffer(Sp.BINDING,r)},n.activate=function(e,n){t.prototype.activate.call(this,e,n),this._uiPhase.activate(e);for(var i=0;i<this.renderQueues.length;i++)this._renderQueues[i]=lb(this.renderQueues[i]);this._planarQueue=new Vb(this._pipeline),this._deferredMaterial&&(e.pipelineSceneData.deferredLightingMaterial=this._deferredMaterial)},n.destroy=function(){var t;null===(t=this._deferredLitsBufs)||void 0===t||t.destroy(),this._deferredLitsBufs=null,this._descriptorSet=null},n.render=function(t){var e=this._pipeline,n=e.device,i=e.commandBuffers[0],r=e.pipelineSceneData,a=r.renderObjects;this._planarQueue.gatherShadowPasses(t,i),e.generateRenderArea(t,this._renderArea);for(var o=e.getPipelineRenderData(),s=r.deferredLightingMaterial.passes[0],c=s.getShaderVariant(),l=0;l<3;++l)s.descriptorSet.bindTexture(l,o.gbufferRenderTargets[l]),s.descriptorSet.bindSampler(l,o.sampler);s.descriptorSet.bindTexture(3,o.outputDepth),s.descriptorSet.bindSampler(3,o.sampler),s.descriptorSet.update(),this._descriptorSet||this._createStageDescriptor(s),this.gatherLights(t),t.clearFlag&Zi.COLOR&&(OM[0].x=t.clearColor.x,OM[0].y=t.clearColor.y,OM[0].z=t.clearColor.z),OM[0].w=0;var h=o.outputFrameBuffer,u=h.renderPass;e.pipelineUBO.updateShadowUBO(t),i.beginRenderPass(u,h,this._renderArea,OM,t.clearDepth,t.clearStencil),i.setScissor(e.generateScissor(t)),i.setViewport(e.generateViewport(t)),i.bindDescriptorSet(ep.GLOBAL,e.descriptorSet);var _=e.quadIAOffscreen,f=null;null!=s&&null!=c&&null!=_&&(f=Kv.getOrCreatePipelineState(n,s,c,u,_)),null!=f&&(this._descriptorSet.update(),i.bindPipelineState(f),i.bindDescriptorSet(ep.MATERIAL,s.descriptorSet),i.bindDescriptorSet(ep.LOCAL,this._descriptorSet),i.bindInputAssembler(_),i.draw(_)),this._renderQueues.forEach(hb);for(var d=0,p=0,m=0,v=0;v<a.length;++v){var g=a[v],y=g.model.subModels;for(d=0;d<y.length;++d){var x=y[d].passes;for(p=0;p<x.length;++p)if(x[p].phase===this._phaseID)for(m=0;m<this._renderQueues.length;m++)this._renderQueues[m].insertRenderPass(g,d,p)}}if(a.length>0){this._renderQueues.forEach(ub);for(var S=0;S<this._renderQueues.length;S++)this._renderQueues[S].recordCommandBuffer(n,u,i);this._planarQueue.recordCommandBuffer(n,u,i)}this._pipeline.geometryRenderer.render(u,i),this._uiPhase.render(t,u),i.endRenderPass()},e}(eS),pM.initInfo={name:"LightingStage",priority:mS.LIGHTING,tag:0},fM=lt((_M=mM).prototype,"_deferredMaterial",[sM,Nc,cM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dM=lt(_M.prototype,"renderQueues",[lM,Nc,hM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),uM=_M))||uM)),BM=[new dr(0,0,0,1)],LM=t("PostProcessStage",(vM=Ec("PostProcessStage"),gM=cl(vg),yM=el(),xM=cl([ab]),SM=el(),vM((wM=EM=function(t){function e(){var e;return ct(e=t.call(this)||this,"_postProcessMaterial",CM,at(e)),ct(e,"renderQueues",TM,at(e)),e._renderArea=new or,e._stageDesc=void 0,e._localUBO=void 0,e._uiPhase=new zb,e}$(e,t);var n=e.prototype;return n.initialize=function(e){return t.prototype.initialize.call(this,e),!0},n.activate=function(e,n){t.prototype.activate.call(this,e,n),this._postProcessMaterial&&(e.pipelineSceneData.postprocessMaterial=this._postProcessMaterial),this._uiPhase.activate(e)},n.destroy=function(){},n.render=function(t){var e=this._pipeline,n=e.device,i=e.pipelineSceneData,r=e.commandBuffers[0];e.pipelineUBO.updateCameraUBO(t);var a=t.viewport;this._renderArea.x=a.x*t.window.width,this._renderArea.y=a.y*t.window.height,this._renderArea.width=a.width*t.window.width,this._renderArea.height=a.height*t.window.height;var o=e.getPipelineRenderData(),s=t.window.framebuffer,c=e.getRenderPass(t.clearFlag,s);t.clearFlag&Zi.COLOR&&(BM[0].x=t.clearColor.x,BM[0].y=t.clearColor.y,BM[0].z=t.clearColor.z),BM[0].w=t.clearColor.w,r.beginRenderPass(c,s,this._renderArea,BM,t.clearDepth,t.clearStencil),r.bindDescriptorSet(ep.GLOBAL,e.descriptorSet);var l=i.postprocessMaterial.passes[0],h=l.getShaderVariant();e.bloomEnabled?l.descriptorSet.bindTexture(0,o.bloom.combineTex):l.descriptorSet.bindTexture(0,o.outputRenderTargets[0]),l.descriptorSet.bindSampler(0,o.sampler),l.descriptorSet.update();var u=t.window.swapchain?e.quadIAOnscreen:e.quadIAOffscreen,_=null;null!=l&&null!=h&&null!=u&&(_=Kv.getOrCreatePipelineState(n,l,h,c,u));var f=e.pipelineSceneData.renderObjects;null!=_&&f.length>0&&(this._stageDesc||(this._stageDesc=n.createDescriptorSet(new Yr(l.localSetLayout)),this._localUBO=n.createBuffer(new gr(yi.UNIFORM|yi.TRANSFER_DST,Ai.DEVICE,Sp.SIZE,Sp.SIZE)),this._stageDesc.bindBuffer(Sp.BINDING,this._localUBO)),this._stageDesc.update(),r.bindPipelineState(_),r.bindDescriptorSet(ep.MATERIAL,l.descriptorSet),r.bindDescriptorSet(ep.LOCAL,this._stageDesc),r.bindInputAssembler(u),r.draw(u)),this._uiPhase.render(t,c),hg(n,c,r,e.profiler,t),r.endRenderPass()},e}(eS),EM.initInfo={name:"PostProcessStage",priority:fS.POST_PROCESS,tag:0},CM=lt((bM=wM).prototype,"_postProcessMaterial",[gM,Nc,yM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),TM=lt(bM.prototype,"renderQueues",[xM,Nc,SM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),AM=bM))||AM));!function(t){t[t.NONE=0]="NONE",t[t.FXAA=1]="FXAA"}(IM||(IM={}));var FM,VM,zM,kM,UM,GM,HM,jM,WM=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._antiAliasing=IM.NONE,e}$(e,t);var n=e.prototype;return n.onGlobalPipelineStateChanged=function(){this.updatePipelinePassInfo()},n.updateBloomPass=function(){if(this._bloomMaterial){var t=this._bloomMaterial.passes[0];t.beginChangeStatesSilently(),t.tryCompile(),t.endChangeStatesSilently();for(var e=[],n=[],i=0;i<6;++i){var r=this._bloomMaterial.passes[1+i];r.beginChangeStatesSilently(),r.tryCompile(),r.endChangeStatesSilently();var a=this._bloomMaterial.passes[7+i];a.beginChangeStatesSilently(),a.tryCompile(),a.endChangeStatesSilently(),e.push(r.native),n.push(a.native)}var o=this._bloomMaterial.passes[13];o.beginChangeStatesSilently(),o.tryCompile(),o.endChangeStatesSilently()}},n.updatePostProcessPass=function(){if(this.postprocessMaterial){var t=this.postprocessMaterial.passes[0];t.beginChangeStatesSilently(),t.tryCompile(),t.endChangeStatesSilently()}},n.initPipelinePassInfo=function(){var t=new vg;t._uuid="builtin-deferred-material",t.initialize({effectName:"deferred-lighting"});for(var e=0;e<t.passes.length;++e)t.passes[e].tryCompile();this._deferredLightingMaterial=t;var n=new vg;n._uuid="builtin-bloom-material",n.initialize({effectName:"bloom"});for(var i=0;i<n.passes.length;++i)n.passes[i].tryCompile();this._bloomMaterial=n;var r=new vg;r._uuid="builtin-post-process-material",_e.ENABLE_ANTIALIAS_FXAA&&(this._antiAliasing=IM.FXAA),r.initialize({effectName:"post-process",defines:{ANTIALIAS_TYPE:this._antiAliasing}});for(var a=0;a<r.passes.length;++a)r.passes[a].tryCompile();this._postprocessMaterial=r,this.updatePipelinePassInfo()},n.updatePipelinePassInfo=function(){this.updateBloomPass(),this.updatePostProcessPass(),this.updateDeferredPassInfo()},n.activate=function(e,n){return t.prototype.activate.call(this,e,n),this.initPipelinePassInfo(),!0},n.updateDeferredPassInfo=function(){this.updateDeferredLightPass()},n.updateDeferredLightPass=function(){if(this._deferredLightingMaterial){this.shadows.enabled&&(this._pipeline.macros.CC_RECEIVE_SHADOW=1);var t=this._deferredLightingMaterial.passes[0];t.beginChangeStatesSilently(),t.tryCompile(),t.endChangeStatesSilently()}},Q(e,[{key:"antiAliasing",get:function(){return this._antiAliasing},set:function(t){if(this._antiAliasing=t,this._postprocessMaterial){var e=this._postprocessMaterial.passes[0].defines;Object.assign(e,{ANTIALIAS_TYPE:t});var n=new vg;n.initialize({effectAsset:this._postprocessMaterial.effectAsset,defines:e});for(var i=0;i<n.passes.length;++i)n.passes[i].tryCompile();this._postprocessMaterial=n}}},{key:"bloomMaterial",get:function(){return this._bloomMaterial},set:function(t){this._bloomMaterial!==t&&t&&(this._bloomMaterial=t,this.updatePipelinePassInfo())}},{key:"postprocessMaterial",get:function(){return this._postprocessMaterial},set:function(t){this._postprocessMaterial!==t&&t&&(this._postprocessMaterial=t,this.updatePipelinePassInfo())}},{key:"deferredLightingMaterial",get:function(){return this._deferredLightingMaterial},set:function(t){this._deferredLightingMaterial!==t&&t&&(this._deferredLightingMaterial=t,this.updatePipelinePassInfo())}}]),e}(PM),qM=[new dr(0,0,0,1)],XM=function(){};XM.SIZE=4*(XM.COUNT=4+(XM.TEXTURE_SIZE_OFFSET=0));var YM,KM,JM,QM,ZM,$M,tO,eO,nO,iO,rO=t("BloomStage",(FM=Ec("BloomStage"),VM=cl(vg),zM=el(),FM((jM=HM=function(t){function e(){var e;return(e=t.call(this)||this).threshold=1,e.intensity=.8,e.iterations=2,ct(e,"_bloomMaterial",GM,at(e)),e._renderArea=new or,e._bloomUBO=[],e}$(e,t);var n=e.prototype;return n.initialize=function(e){return t.prototype.initialize.call(this,e),!0},n.activate=function(e,n){t.prototype.activate.call(this,e,n),this._bloomMaterial&&(e.pipelineSceneData.bloomMaterial=this._bloomMaterial)},n.destroy=function(){},n.render=function(t){var e,n=this._pipeline;if(n.generateBloomRenderData(),((null===(e=t.window)||void 0===e?void 0:e.swapchain)||n.macros.CC_PIPELINE_TYPE)&&n.bloomEnabled&&0!==n.pipelineSceneData.renderObjects.length){if(0===this._bloomUBO.length)for(var i=0;i<14;++i)this._bloomUBO[i]=n.device.createBuffer(new gr(yi.UNIFORM|yi.TRANSFER_DST,Ai.HOST|Ai.DEVICE,XM.SIZE,XM.SIZE));t.clearFlag&Zi.COLOR&&(qM[0].x=t.clearColor.x,qM[0].y=t.clearColor.y,qM[0].z=t.clearColor.z),qM[0].w=t.clearColor.w,this._prefilterPass(t,n),this._downsamplePass(t,n),this._upsamplePass(t,n),this._combinePass(t,n)}},n._prefilterPass=function(t,e){e.generateRenderArea(t,this._renderArea),this._renderArea.width>>=1,this._renderArea.height>>=1;var n=e.commandBuffers[0],i=e.pipelineSceneData.bloomMaterial.passes[0],r=e.getPipelineRenderData(),a=r.bloom,o=new Float32Array(XM.COUNT);o[XM.TEXTURE_SIZE_OFFSET+2]=this.threshold,n.updateBuffer(this._bloomUBO[0],o),n.beginRenderPass(a.renderPass,a.prefilterFramebuffer,this._renderArea,qM,0,0),n.bindDescriptorSet(ep.GLOBAL,e.descriptorSet),i.descriptorSet.bindBuffer(0,this._bloomUBO[0]),i.descriptorSet.bindTexture(1,r.outputRenderTargets[0]),i.descriptorSet.bindSampler(1,a.sampler),i.descriptorSet.update(),n.bindDescriptorSet(ep.MATERIAL,i.descriptorSet);var s=t.window.swapchain?e.quadIAOffscreen:e.quadIAOnscreen,c=null,l=i.getShaderVariant();null!=i&&null!=l&&null!=s&&(c=Kv.getOrCreatePipelineState(e.device,i,l,a.renderPass,s)),null!=c&&(n.bindPipelineState(c),n.bindInputAssembler(s),n.draw(s)),n.endRenderPass()},n._downsamplePass=function(t,e){e.generateRenderArea(t,this._renderArea),this._renderArea.width>>=1,this._renderArea.height>>=1;for(var n=e.commandBuffers[0],i=e.pipelineSceneData.bloomMaterial,r=e.getPipelineRenderData().bloom,a=new Float32Array(XM.COUNT),o=0;o<this.iterations;++o){a[XM.TEXTURE_SIZE_OFFSET+0]=this._renderArea.width,a[XM.TEXTURE_SIZE_OFFSET+1]=this._renderArea.height,n.updateBuffer(this._bloomUBO[o+1],a),this._renderArea.width>>=1,this._renderArea.height>>=1,n.beginRenderPass(r.renderPass,r.downsampleFramebuffers[o],this._renderArea,qM,0,0);var s=i.passes[1+o],c=s.getShaderVariant();s.descriptorSet.bindBuffer(0,this._bloomUBO[o+1]),0===o?s.descriptorSet.bindTexture(1,r.prefiterTex):s.descriptorSet.bindTexture(1,r.downsampleTexs[o-1]),s.descriptorSet.bindSampler(1,r.sampler),s.descriptorSet.update(),n.bindDescriptorSet(ep.MATERIAL,s.descriptorSet);var l=t.window.swapchain?e.quadIAOffscreen:e.quadIAOnscreen,h=null;null!=s&&null!=c&&null!=l&&(h=Kv.getOrCreatePipelineState(e.device,s,c,r.renderPass,l)),null!=h&&(n.bindPipelineState(h),n.bindInputAssembler(l),n.draw(l)),n.endRenderPass()}},n._upsamplePass=function(t,e){var n=e.getPipelineRenderData().bloom;e.generateRenderArea(t,this._renderArea),this._renderArea.width>>=this.iterations+1,this._renderArea.height>>=this.iterations+1;for(var i=e.commandBuffers[0],r=e.pipelineSceneData.bloomMaterial,a=new Float32Array(XM.COUNT),o=0;o<this.iterations;++o){var s=o+6+1;a[XM.TEXTURE_SIZE_OFFSET+0]=this._renderArea.width,a[XM.TEXTURE_SIZE_OFFSET+1]=this._renderArea.height,i.updateBuffer(this._bloomUBO[s],a),this._renderArea.width<<=1,this._renderArea.height<<=1,i.beginRenderPass(n.renderPass,n.upsampleFramebuffers[this.iterations-1-o],this._renderArea,qM,0,0);var c=r.passes[7+o],l=c.getShaderVariant();c.descriptorSet.bindBuffer(0,this._bloomUBO[s]),0===o?c.descriptorSet.bindTexture(1,n.downsampleTexs[this.iterations-1]):c.descriptorSet.bindTexture(1,n.upsampleTexs[this.iterations-o]),c.descriptorSet.bindSampler(1,n.sampler),c.descriptorSet.update(),i.bindDescriptorSet(ep.MATERIAL,c.descriptorSet);var h=t.window.swapchain?e.quadIAOffscreen:e.quadIAOnscreen,u=null;null!=c&&null!=l&&null!=h&&(u=Kv.getOrCreatePipelineState(e.device,c,l,n.renderPass,h)),null!=u&&(i.bindPipelineState(u),i.bindInputAssembler(h),i.draw(h)),i.endRenderPass()}},n._combinePass=function(t,e){e.generateRenderArea(t,this._renderArea);var n=e.commandBuffers[0],i=e.pipelineSceneData.bloomMaterial,r=e.getPipelineRenderData(),a=r.bloom,o=new Float32Array(XM.COUNT);o[XM.TEXTURE_SIZE_OFFSET+3]=this.intensity,n.updateBuffer(this._bloomUBO[13],o),n.beginRenderPass(a.renderPass,a.combineFramebuffer,this._renderArea,qM,0,0),n.bindDescriptorSet(ep.GLOBAL,e.descriptorSet);var s=i.passes[13];s.descriptorSet.bindBuffer(0,this._bloomUBO[13]),s.descriptorSet.bindTexture(1,r.outputRenderTargets[0]),s.descriptorSet.bindTexture(2,a.upsampleTexs[0]),s.descriptorSet.bindSampler(1,a.sampler),s.descriptorSet.bindSampler(2,a.sampler),s.descriptorSet.update(),n.bindDescriptorSet(ep.MATERIAL,s.descriptorSet);var c=t.window.swapchain?e.quadIAOffscreen:e.quadIAOnscreen,l=null,h=s.getShaderVariant();null!=s&&null!=h&&null!=c&&(l=Kv.getOrCreatePipelineState(e.device,s,h,a.renderPass,c)),null!=l&&(n.bindPipelineState(l),n.bindInputAssembler(c),n.draw(c)),n.endRenderPass()},e}(eS),HM.initInfo={name:"BloomStage",priority:fS.BLOOM,tag:0},GM=lt((UM=jM).prototype,"_bloomMaterial",[VM,Nc,zM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kM=UM))||kM)),aO=t("MainFlow",Ec("MainFlow")((JM=KM=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._stages.length){var n=new MM;n.initialize(MM.initInfo),this._stages.push(n);var i=new NM;i.initialize(NM.initInfo),this._stages.push(i);var r=new rO;r.initialize(rO.initInfo),this._stages.push(r);var a=new LM;a.initialize(LM.initInfo),this._stages.push(a)}return!0},n.activate=function(e){t.prototype.activate.call(this,e)},n.render=function(e){t.prototype.render.call(this,e)},n.destroy=function(){t.prototype.destroy.call(this)},e}(iS),KM.initInfo={name:qd,priority:vS.MAIN,stages:[]},YM=JM))||YM),oO=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).gbufferFrameBuffer=null,e.gbufferRenderTargets=[],e}return $(e,t),e}((function(){this.outputFrameBuffer=null,this.outputRenderTargets=[],this.outputDepth=null,this.sampler=null,this.bloom=null})),sO=t("DeferredPipeline",(QM=Ec("DeferredPipeline"),ZM=cl([nb]),$M=el(),QM((iO=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gbufferRenderPass=null,e._lightingRenderPass=null,ct(e,"renderTextures",nO,at(e)),e}$(e,t);var n=e.prototype;return n.initialize=function(e){if(t.prototype.initialize.call(this,e),0===this._flows.length){var n=new oC;n.initialize(oC.initInfo),this._flows.push(n);var i=new aO;i.initialize(aO.initInfo),this._flows.push(i)}return!0},n.activate=function(e){return this._macros={CC_PIPELINE_TYPE:1},this._pipelineSceneData=new WM,!(!t.prototype.activate.call(this,e)||!this._activeRenderer(e)&&(O(2402),1))},n.destroy=function(){this._destroyUBOs(),this._destroyQuadInputAssembler(),this._destroyDeferredData();for(var e=this._renderPasses.values(),n=e.next();!n.done;)n.value.destroy(),n=e.next();return this._commandBuffers.length=0,t.prototype.destroy.call(this)},n.getPipelineRenderData=function(){return this._pipelineRenderData||this._generateDeferredRenderData(),this._pipelineRenderData},n._activeRenderer=function(t){var e=this.device;this._commandBuffers.push(e.commandBuffer);var n=this.globalDSManager.pointSampler;this._descriptorSet.bindSampler(lp,n),this._descriptorSet.bindTexture(lp,Uv.get("default-texture").getGFXTexture()),this._descriptorSet.bindSampler(gp,n),this._descriptorSet.bindTexture(gp,Uv.get("default-texture").getGFXTexture()),this._descriptorSet.update();var i=new bS;if(!(i=this._createQuadInputAssembler()).quadIB||!i.quadVB||!i.quadIA)return!1;this._quadIB=i.quadIB,this._quadVBOffscreen=i.quadVB,this._quadIAOffscreen=i.quadIA;var r=this._createQuadInputAssembler();if(!r.quadIB||!r.quadVB||!r.quadIA)return!1;if(this._quadVBOnscreen=r.quadVB,this._quadIAOnscreen=r.quadIA,!this._gbufferRenderPass){var a=new Vr;a.format=mi.RGBA16F,a.loadOp=Fi.CLEAR,a.storeOp=Vi.STORE;var o=new Vr;o.format=mi.RGBA16F,o.loadOp=Fi.CLEAR,o.storeOp=Vi.STORE;var s=new Vr;s.format=mi.RGBA16F,s.loadOp=Fi.CLEAR,s.storeOp=Vi.STORE;var c=new zr;c.format=mi.DEPTH_STENCIL,c.depthLoadOp=Fi.CLEAR,c.depthStoreOp=Vi.STORE,c.stencilLoadOp=Fi.CLEAR,c.stencilStoreOp=Vi.STORE;var l=new Gr([a,o,s],c);this._gbufferRenderPass=e.createRenderPass(l)}if(!this._lightingRenderPass){var h=new Vr;h.format=mi.RGBA8,h.loadOp=Fi.CLEAR,h.storeOp=Vi.STORE,h.barrier=e.getGeneralBarrier(new Hr(zi.NONE,zi.COLOR_ATTACHMENT_WRITE));var u=new zr;u.format=mi.DEPTH_STENCIL,u.depthLoadOp=Fi.LOAD,u.depthStoreOp=Vi.DISCARD,u.stencilLoadOp=Fi.LOAD,u.stencilStoreOp=Vi.DISCARD,h.barrier=e.getGeneralBarrier(new Hr(zi.DEPTH_STENCIL_ATTACHMENT_WRITE,zi.DEPTH_STENCIL_ATTACHMENT_WRITE));var _=new Gr([h],u);this._lightingRenderPass=e.createRenderPass(_)}return this._width=t.width,this._height=t.height,this._generateDeferredRenderData(),!0},n._destroyUBOs=function(){this._descriptorSet&&(this._descriptorSet.getBuffer(op.BINDING).destroy(),this._descriptorSet.getBuffer(cp.BINDING).destroy(),this._descriptorSet.getBuffer(sp.BINDING).destroy(),this._descriptorSet.getTexture(lp).destroy(),this._descriptorSet.getTexture(gp).destroy())},n._destroyDeferredData=function(){var t=this._pipelineRenderData;if(t){t.gbufferFrameBuffer&&t.gbufferFrameBuffer.destroy(),t.outputFrameBuffer&&t.outputFrameBuffer.destroy(),t.outputDepth&&t.outputDepth.destroy();for(var e=0;e<t.gbufferRenderTargets.length;e++)t.gbufferRenderTargets[e].destroy();t.gbufferRenderTargets.length=0;for(var n=0;n<t.outputRenderTargets.length;n++)t.outputRenderTargets[n].destroy();t.outputRenderTargets.length=0,this._destroyBloomData()}this._pipelineRenderData=null},n._ensureEnoughSize=function(t){for(var e=this._width,n=this._height,i=0;i<t.length;++i){var r=t[i].window;e=Math.max(r.width,e),n=Math.max(r.height,n)}e===this._width&&n===this._height||(this._width=e,this._height=n,this._destroyDeferredData(),this._generateDeferredRenderData())},n._generateDeferredRenderData=function(){for(var t=this,e=this.device,n=this._pipelineRenderData=new oO,i=this.pipelineSceneData,r=0;r<3;++r)n.gbufferRenderTargets.push(e.createTexture(new br(bi.TEX2D,Ci.COLOR_ATTACHMENT|Ci.SAMPLED,mi.RGBA16F,this._width*i.shadingScale,this._height*i.shadingScale)));n.outputDepth=e.createTexture(new br(bi.TEX2D,Ci.DEPTH_STENCIL_ATTACHMENT|Ci.SAMPLED,mi.DEPTH_STENCIL,this._width*i.shadingScale,this._height*i.shadingScale)),n.gbufferFrameBuffer=e.createFramebuffer(new Wr(this._gbufferRenderPass,n.gbufferRenderTargets,n.outputDepth)),n.outputRenderTargets.push(e.createTexture(new br(bi.TEX2D,Ci.COLOR_ATTACHMENT|Ci.SAMPLED,mi.RGBA16F,this._width*i.shadingScale,this._height*i.shadingScale))),n.outputFrameBuffer=e.createFramebuffer(new Wr(this._lightingRenderPass,n.outputRenderTargets,null)),n.sampler=this.globalDSManager.pointSampler,this.on(nS.ATTACHMENT_SCALE_CAHNGED,(function(e){n.sampler=e<1?t.globalDSManager.pointSampler:t.globalDSManager.linearSampler,t.applyFramebufferRatio(n.gbufferFrameBuffer),t.applyFramebufferRatio(n.outputFrameBuffer)}))},e}(CS),nO=lt((eO=iO).prototype,"renderTextures",[ZM,Nc,$M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tO=eO))||tO));function cO(){var t=new DM;return t.initialize({flows:[]}),t}var lO=new Qn,hO=function(){var t=e.prototype;function e(){this.handle=0,this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this.isPause=!1,this._splashFinish=!1,this._loadFinish=!1,this._directCall=!1}return t.pauseRendering=function(){this.isPause=!0},t.resumeRendering=function(){this.isPause=!1},t.main=function(t){if(null!=t){if(window._CCSettings&&window._CCSettings.splashScreen){var e=this.settings=window._CCSettings.splashScreen;e.totalTime=null!=this.settings.totalTime?this.settings.totalTime:3e3,e.base64src=this.settings.base64src||"",e.effect=this.settings.effect||"FADE-INOUT",e.clearColor=this.settings.clearColor||new dr(.88,.88,.88,1),e.displayRatio=null!=this.settings.displayRatio?this.settings.displayRatio:.4,e.displayWatermark=null==this.settings.displayWatermark||this.settings.displayWatermark}else this.settings={totalTime:3e3,base64src:"",effect:"FADE-INOUT",clearColor:new dr(.88,.88,.88,1),displayRatio:.4,displayWatermark:!0};if(""===this.settings.base64src||this.settings.totalTime<=0)this.callBack&&this.callBack(),this.callBack=null,this.settings=null,this._directCall=!0;else{h.view.resizeWithBrowserSize(!0);var n=window._CCSettings.designResolution;n?h.view.setDesignResolutionSize(n.width,n.height,n.policy):h.view.setDesignResolutionSize(960,640,4),this.device=t.device,this.swapchain=t.mainWindow.swapchain,this.framebuffer=t.mainWindow.framebuffer,h.game.once(h.Game.EVENT_GAME_INITED,(function(){h.director._lateUpdate=performance.now()}),h.director),this.callBack=null,this.cancelAnimate=!1,this.startTime=-1,this.preInit(),this.logoImage=new Image,this.logoImage.onload=this.init.bind(this),this.logoImage.src=this.settings.base64src}}else A("RENDER ROOT IS NULL.")},t.setOnFinish=function(t){if(this._directCall&&t)return e._ins=void 0,void t();this.callBack=t},t._tryToStart=function(){this._splashFinish&&this._loadFinish&&this.callBack&&(this.callBack(),this.hide(),h.game.resume())},t.preInit=function(){var t=this.settings.clearColor;this.clearColors=[new dr(t.x,t.y,t.z,t.w)];var e=this.device,n=this.swapchain;this.renderArea=new or(0,0,n.width,n.height),this.cmdBuff=e.commandBuffer;var i=new Float32Array([.5,.5,1,0,-.5,.5,0,0,.5,-.5,1,1,-.5,-.5,0,1]),r=4*Float32Array.BYTES_PER_ELEMENT,a=4*r;this.vertexBuffers=e.createBuffer(new gr(yi.VERTEX|yi.TRANSFER_DST,Ai.DEVICE,a,r)),this.vertexBuffers.update(i);var o=new Uint16Array([0,1,2,1,3,2]),s=Uint16Array.BYTES_PER_ELEMENT,c=6*s;this.indicesBuffers=e.createBuffer(new gr(yi.INDEX|yi.TRANSFER_DST,Ai.DEVICE,c,s)),this.indicesBuffers.update(o);var l=[new Br("a_position",mi.RG32F),new Br("a_texCoord",mi.RG32F)],h=new Fr(l,[this.vertexBuffers],this.indicesBuffers);this.quadAssmebler=e.createInputAssembler(h),this.projection=new Xn,Xn.ortho(this.projection,-1,1,-1,1,-1,1,e.capabilities.clipSpaceMinZ,e.capabilities.clipSpaceSignY,n.surfaceTransform)},t.init=function(){var t=this;this.initLogo(),this.settings.displayWatermark&&this.initWarterMark(),h.game.pause(),this.handle=requestAnimationFrame((function e(n){if(!t.cancelAnimate){var i=t.settings,r=t.device,a=t.swapchain;Xn.ortho(t.projection,-1,1,-1,1,-1,1,r.capabilities.clipSpaceMinZ,r.capabilities.clipSpaceSignY,a.surfaceTransform);var o=a.width,s=a.height,c=o<s?o:s;t.startTime<0&&(t.startTime=n);var l=n-t.startTime,h=D_(_n(l/i.totalTime));"NONE"===i.effect&&(h=1);var u=t.logoTexture.width,_=t.logoTexture.height,f=c*i.displayRatio,d=f*u/_,p=f;if(a.surfaceTransform!==di.ROTATE_90&&a.surfaceTransform!==di.ROTATE_270||(d=f*o/s,p=f*_/u*s/o),t.logoMat.setProperty("resolution",lO.set(o,s),0),t.logoMat.setProperty("scale",lO.set(d,p),0),t.logoMat.setProperty("translate",lO.set(.5*o,.5*s),0),t.logoMat.setProperty("percent",h),t.logoMat.setProperty("u_projection",t.projection),t.logoMat.passes[0].update(),i.displayWatermark&&t.watermarkMat){var m=.5*c,v=t.watermarkTexture.width,g=m,y=m*t.watermarkTexture.height/v;a.surfaceTransform!==di.ROTATE_90&&a.surfaceTransform!==di.ROTATE_270||(g=.5*m,y=m*o/s*.5),t.watermarkMat.setProperty("resolution",lO.set(o,s),0),t.watermarkMat.setProperty("scale",lO.set(g,y),0),t.watermarkMat.setProperty("translate",lO.set(.5*o,.1*s),0),t.watermarkMat.setProperty("percent",h),t.watermarkMat.setProperty("u_projection",t.projection),t.watermarkMat.passes[0].update()}t.isPause||(t.frame(),l>i.totalTime&&(t.splashFinish=!0)),requestAnimationFrame(e)}}))},t.hide=function(){cancelAnimationFrame(this.handle),this.cancelAnimate=!0,setTimeout(this.destroy.bind(this))},t.initLogo=function(){var t=this.device;this.logoMat=new vg,this.logoMat.initialize({effectName:"splash-screen"});var e=new Tr;e.addressU=Di.CLAMP,e.addressV=Di.CLAMP,e.addressW=Di.CLAMP,this.sampler=t.getSampler(e),this.logoTexture=t.createTexture(new br(bi.TEX2D,Ci.SAMPLED|Ci.TRANSFER_DST,mi.RGBA8,this.logoImage.width,this.logoImage.height));var n=this.logoMat.passes[0],i=n.getBinding("mainTexture");n.bindTexture(i,this.logoTexture),this.shader=n.getShaderVariant();var r=n.descriptorSet;r.bindSampler(i,this.sampler),r.update();var a=new _r;a.texExtent.width=this.logoImage.width,a.texExtent.height=this.logoImage.height,a.texExtent.depth=1,t.copyTexImagesToTexture([this.logoImage],this.logoTexture,[a])},t.initWarterMark=function(){var t=document.createElement("canvas");t.width=330,t.height=30,t.style.width=""+t.width,t.style.height=""+t.height;var e=t.getContext("2d");e.font="18px Arial",e.textBaseline="top",e.textAlign="left",e.fillStyle="`#424242`";var n="Powered by Cocos Creator",i=e.measureText(n);e.fillText(n,(330-i.width)/2,6);var r=new _r;r.texExtent.width=t.width,r.texExtent.height=t.height,r.texExtent.depth=1,this.watermarkTexture=this.device.createTexture(new br(bi.TEX2D,Ci.SAMPLED|Ci.TRANSFER_DST,mi.RGBA8,t.width,t.height)),this.device.copyTexImagesToTexture([t],this.watermarkTexture,[r]),this.watermarkMat=new vg,this.watermarkMat.initialize({effectName:"splash-screen"});var a=this.watermarkMat.passes[0],o=a.getBinding("mainTexture");a.bindTexture(o,this.watermarkTexture),a.descriptorSet.update()},t.frame=function(){var t=this.device,e=this.swapchain;t.acquire([e]);var n=this.cmdBuff,i=this.framebuffer,r=this.renderArea;r.width=e.width,r.height=e.height,n.begin(),n.beginRenderPass(i.renderPass,i,r,this.clearColors,1,0);var a=this.logoMat.passes[0],o=Kv.getOrCreatePipelineState(t,a,this.shader,i.renderPass,this.quadAssmebler);if(n.bindPipelineState(o),n.bindDescriptorSet(ep.MATERIAL,a.descriptorSet),n.bindInputAssembler(this.quadAssmebler),n.draw(this.quadAssmebler),this.settings.displayWatermark&&this.watermarkMat){var s=this.watermarkMat.passes[0],c=Kv.getOrCreatePipelineState(t,s,this.shader,i.renderPass,this.quadAssmebler);n.bindPipelineState(c),n.bindDescriptorSet(ep.MATERIAL,s.descriptorSet),n.bindInputAssembler(this.quadAssmebler),n.draw(this.quadAssmebler)}n.endRenderPass(),n.end(),t.flushCommands([n]),t.queue.submit([n]),t.present()},t.destroy=function(){this.callBack=null,this.device=null,this.swapchain=null,this.clearColors=null,this.logoImage.destroy&&this.logoImage.destroy(),this.logoImage=null,this.framebuffer=null,this.renderArea=null,this.cmdBuff=null,this.shader=null,this.logoMat.destroy(),this.logoMat=null,this.logoTexture.destroy(),this.logoTexture=null,this.quadAssmebler.destroy(),this.quadAssmebler=null,this.vertexBuffers.destroy(),this.vertexBuffers=null,this.indicesBuffers.destroy(),this.indicesBuffers=null,this.sampler=null,this.watermarkTexture&&(this.watermarkMat.destroy(),this.watermarkMat=null,this.watermarkTexture.destroy(),this.watermarkTexture=null),this.settings=null,e._ins=void 0},Q(e,[{key:"splashFinish",set:function(t){this._splashFinish=t,this._tryToStart()}},{key:"loadFinish",set:function(t){this._loadFinish=t,this._tryToStart()}}],[{key:"instance",get:function(){return e._ins||(e._ins=new e),e._ins}}]),e}();hO._ins=void 0,h.internal.SplashScreen=hO;var uO=t("System",function(){function t(){this._id="",this._priority=0,this._executeInEditMode=!1}t.sortByPriority=function(t,e){return t._priority<e._priority?1:t._priority>e.priority?-1:0};var e=t.prototype;return e.init=function(){},e.update=function(){},e.postUpdate=function(){},Q(t,[{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t}},{key:"id",get:function(){return this._id},set:function(t){this._id=t}}]),t}());uO.Priority=se({LOW:0,MEDIUM:100,HIGH:200,SCHEDULER:1<<31>>>0});var _O=new vt("Scheduler"),fO=function(t,e,n,i){this.target=void 0,this.priority=void 0,this.paused=void 0,this.markedForDeletion=void 0,this.target=t,this.priority=e,this.paused=n,this.markedForDeletion=i};fO.get=function(t,e,n,i){var r=fO._listEntries.pop();return r?(r.target=t,r.priority=e,r.paused=n,r.markedForDeletion=i):r=new fO(t,e,n,i),r},fO.put=function(t){fO._listEntries.length<20&&(t.target=null,fO._listEntries.push(t))},fO._listEntries=[];var dO=function(t,e,n,i){this.list=void 0,this.entry=void 0,this.target=void 0,this.callback=void 0,this.list=t,this.entry=e,this.target=n,this.callback=i};dO.get=function(t,e,n,i){var r=dO._hashUpdateEntries.pop();return r?(r.list=t,r.entry=e,r.target=n,r.callback=i):r=new dO(t,e,n,i),r},dO.put=function(t){dO._hashUpdateEntries.length<20&&(t.list=t.entry=t.target=t.callback=null,dO._hashUpdateEntries.push(t))},dO._hashUpdateEntries=[];var pO=function(t,e,n,i,r,a){this.timers=void 0,this.target=void 0,this.timerIndex=void 0,this.currentTimer=void 0,this.currentTimerSalvaged=void 0,this.paused=void 0,this.timers=t,this.target=e,this.timerIndex=n,this.currentTimer=i,this.currentTimerSalvaged=r,this.paused=a};pO.get=function(t,e,n,i,r,a){var o=pO._hashTimerEntries.pop();return o?(o.timers=t,o.target=e,o.timerIndex=n,o.currentTimer=i,o.currentTimerSalvaged=r,o.paused=a):o=new pO(t,e,n,i,r,a),o},pO.put=function(t){pO._hashTimerEntries.length<20&&(t.timers=t.target=t.currentTimer=null,pO._hashTimerEntries.push(t))},pO._hashTimerEntries=[];var mO=function(){function t(){this._lock=void 0,this._scheduler=void 0,this._elapsed=void 0,this._runForever=void 0,this._useDelay=void 0,this._timesExecuted=void 0,this._repeat=void 0,this._delay=void 0,this._interval=void 0,this._target=void 0,this._callback=void 0,this._lock=!1,this._scheduler=null,this._elapsed=-1,this._runForever=!1,this._useDelay=!1,this._timesExecuted=0,this._repeat=0,this._delay=0,this._interval=0,this._target=null,this._callback=null}var e=t.prototype;return e.initWithCallback=function(t,e,n,i,r,a){return this._lock=!1,this._scheduler=t,this._target=n,this._callback=e,this._elapsed=-1,this._interval=i,this._delay=a,this._useDelay=this._delay>0,this._repeat=r,this._runForever=this._repeat===h.macro.REPEAT_FOREVER,!0},e.getInterval=function(){return this._interval},e.setInterval=function(t){this._interval=t},e.update=function(t){-1===this._elapsed?(this._elapsed=0,this._timesExecuted=0):(this._elapsed+=t,this._runForever&&!this._useDelay?this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0):(this._useDelay?this._elapsed>=this._delay&&(this.trigger(),this._elapsed-=this._delay,this._timesExecuted+=1,this._useDelay=!1):this._elapsed>=this._interval&&(this.trigger(),this._elapsed=0,this._timesExecuted+=1),this._callback&&!this._runForever&&this._timesExecuted>this._repeat&&this.cancel()))},e.getCallback=function(){return this._callback},e.trigger=function(){this._target&&this._callback&&(this._lock=!0,this._callback.call(this._target,this._elapsed),this._lock=!1)},e.cancel=function(){this._scheduler.unschedule(this._callback,this._target)},t}();mO._timers=[],mO.get=function(){return mO._timers.pop()||new mO},mO.put=function(t){mO._timers.length<20&&!t._lock&&(t._scheduler=t._target=t._callback=null,mO._timers.push(t))};var vO,gO=t("Scheduler",function(t){function e(){var e;return(e=t.call(this)||this)._timeScale=void 0,e._updatesNegList=void 0,e._updates0List=void 0,e._updatesPosList=void 0,e._hashForUpdates=void 0,e._hashForTimers=void 0,e._currentTarget=void 0,e._currentTargetSalvaged=void 0,e._updateHashLocked=void 0,e._arrayForTimers=void 0,e._timeScale=1,e._updatesNegList=[],e._updates0List=[],e._updatesPosList=[],e._hashForUpdates=Pt(!0),e._hashForTimers=Pt(!0),e._currentTarget=null,e._currentTargetSalvaged=!1,e._updateHashLocked=!1,e._arrayForTimers=[],e}$(e,t),e.enableForTarget=function(t){var e=!1;(t.uuid||t.id)&&(e=!0),e||(t.__instanceId?R(1513):t.id=_O.getNewId())};var n=e.prototype;return n.setTimeScale=function(t){this._timeScale=t},n.getTimeScale=function(){return this._timeScale},n.update=function(t){var e,n,i,r,a;for(this._updateHashLocked=!0,1!==this._timeScale&&(t*=this._timeScale),e=0,i=(n=this._updatesNegList).length;e<i;e++)(r=n[e]).paused||r.markedForDeletion||r.target.update(t);for(e=0,i=(n=this._updates0List).length;e<i;e++)(r=n[e]).paused||r.markedForDeletion||r.target.update(t);for(e=0,i=(n=this._updatesPosList).length;e<i;e++)(r=n[e]).paused||r.markedForDeletion||r.target.update(t);var o=this._arrayForTimers;for(e=0;e<o.length;e++){if(a=o[e],this._currentTarget=a,this._currentTargetSalvaged=!1,!a.paused)for(a.timerIndex=0;a.timerIndex<a.timers.length;++a.timerIndex)a.currentTimer=a.timers[a.timerIndex],a.currentTimerSalvaged=!1,a.currentTimer.update(t),a.currentTimer=null;this._currentTargetSalvaged&&0===this._currentTarget.timers.length&&(this._removeHashElement(this._currentTarget),--e)}for(e=0,n=this._updatesNegList;e<n.length;)(r=n[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,n=this._updates0List;e<n.length;)(r=n[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;for(e=0,n=this._updatesPosList;e<n.length;)(r=n[e]).markedForDeletion?this._removeUpdateFromHash(r):e++;this._updateHashLocked=!1,this._currentTarget=null},n.schedule=function(t,e,n,i,r,a){if("function"!=typeof t){var o=t;t=e,e=o}3!==arguments.length&&4!==arguments.length&&5!==arguments.length||(a=!!i,i=h.macro.REPEAT_FOREVER,r=0),L(e,1502);var s=e.uuid||e.id;if(s){var c,l,u=this._hashForTimers[s];if(u?u.paused!==a&&R(1511):(u=pO.get(null,e,0,null,null,a),this._arrayForTimers.push(u),this._hashForTimers[s]=u),null==u.timers)u.timers=[];else for(l=0;l<u.timers.length;++l)if((c=u.timers[l])&&t===c._callback)return P(1507,c.getInterval(),n),void(c._interval=n);(c=mO.get()).initWithCallback(this,t,e,n,i,r),u.timers.push(c),this._currentTarget===u&&this._currentTargetSalvaged&&(this._currentTargetSalvaged=!1)}else O(1510)},n.scheduleUpdate=function(t,e,n){var i=t.uuid||t.id;if(i){var r=this._hashForUpdates[i];if(r&&r.entry){if(r.entry.priority===e)return r.entry.markedForDeletion=!1,void(r.entry.paused=n);if(this._updateHashLocked)return P(1506),r.entry.markedForDeletion=!1,void(r.entry.paused=n);this.unscheduleUpdate(t)}var a,o=fO.get(t,e,n,!1);0===e?(a=this._updates0List,this._appendIn(a,o)):(a=e<0?this._updatesNegList:this._updatesPosList,this._priorityIn(a,o,e)),this._hashForUpdates[i]=dO.get(a,o,t,null)}else O(1510)},n.unschedule=function(t,e){if(e&&t){var n=e.uuid||e.id;if(n){var i=this._hashForTimers[n];if(i)for(var r=i.timers,a=0,o=r.length;a<o;a++){var s=r[a];if(t===s._callback)return s!==i.currentTimer||i.currentTimerSalvaged||(i.currentTimerSalvaged=!0),r.splice(a,1),mO.put(s),i.timerIndex>=a&&i.timerIndex--,void(0===r.length&&(this._currentTarget===i?this._currentTargetSalvaged=!0:this._removeHashElement(i)))}}else O(1510)}},n.unscheduleUpdate=function(t){if(t){var e=t.uuid||t.id;if(e){var n=this._hashForUpdates[e];n&&(this._updateHashLocked?n.entry.markedForDeletion=!0:this._removeUpdateFromHash(n.entry))}else O(1510)}},n.unscheduleAllForTarget=function(t){if(t){var e=t.uuid||t.id;if(e){var n=this._hashForTimers[e];if(n){var i=n.timers;i.indexOf(n.currentTimer)>-1&&!n.currentTimerSalvaged&&(n.currentTimerSalvaged=!0);for(var r=0,a=i.length;r<a;r++)mO.put(i[r]);i.length=0,this._currentTarget===n?this._currentTargetSalvaged=!0:this._removeHashElement(n)}this.unscheduleUpdate(t)}else O(1510)}},n.unscheduleAll=function(){this.unscheduleAllWithMinPriority(uO.Priority.SCHEDULER)},n.unscheduleAllWithMinPriority=function(t){var e,n,i,r=this._arrayForTimers;for(e=r.length-1;e>=0;e--)n=r[e],this.unscheduleAllForTarget(n.target);var a=0;if(t<0)for(e=0;e<this._updatesNegList.length;)a=this._updatesNegList.length,(i=this._updatesNegList[e])&&i.priority>=t&&this.unscheduleUpdate(i.target),a===this._updatesNegList.length&&e++;if(t<=0)for(e=0;e<this._updates0List.length;)a=this._updates0List.length,(i=this._updates0List[e])&&this.unscheduleUpdate(i.target),a===this._updates0List.length&&e++;for(e=0;e<this._updatesPosList.length;)a=this._updatesPosList.length,(i=this._updatesPosList[e])&&i.priority>=t&&this.unscheduleUpdate(i.target),a===this._updatesPosList.length&&e++},n.isScheduled=function(t,e){L(t,1508),L(e,1509);var n=e.uuid||e.id;if(!n)return O(1510),!1;var i=this._hashForTimers[n];if(!i)return!1;if(null==i.timers)return!1;for(var r=i.timers,a=0;a<r.length;++a)if(t===r[a]._callback)return!0;return!1},n.pauseAllTargets=function(){return this.pauseAllTargetsWithMinPriority(uO.Priority.SCHEDULER)},n.pauseAllTargetsWithMinPriority=function(t){var e,n,i,r,a=[],o=this._arrayForTimers;for(n=0,i=o.length;n<i;n++)(e=o[n])&&(e.paused=!0,a.push(e.target));if(t<0)for(n=0;n<this._updatesNegList.length;n++)(r=this._updatesNegList[n])&&r.priority>=t&&(r.paused=!0,a.push(r.target));if(t<=0)for(n=0;n<this._updates0List.length;n++)(r=this._updates0List[n])&&(r.paused=!0,a.push(r.target));for(n=0;n<this._updatesPosList.length;n++)(r=this._updatesPosList[n])&&r.priority>=t&&(r.paused=!0,a.push(r.target));return a},n.resumeTargets=function(t){if(t)for(var e=0;e<t.length;e++)this.resumeTarget(t[e])},n.pauseTarget=function(t){L(t,1503);var e=t.uuid||t.id;if(e){var n=this._hashForTimers[e];n&&(n.paused=!0);var i=this._hashForUpdates[e];i&&(i.entry.paused=!0)}else O(1510)},n.resumeTarget=function(t){L(t,1504);var e=t.uuid||t.id;if(e){var n=this._hashForTimers[e];n&&(n.paused=!1);var i=this._hashForUpdates[e];i&&(i.entry.paused=!1)}else O(1510)},n.isTargetPaused=function(t){L(t,1505);var e=t.uuid||t.id;if(!e)return O(1510),!1;var n=this._hashForTimers[e];if(n)return n.paused;var i=this._hashForUpdates[e];return!!i&&i.entry.paused},n._removeHashElement=function(t){var e=t.target.uuid||t.target.id;delete this._hashForTimers[e];for(var n=this._arrayForTimers,i=0,r=n.length;i<r;i++)if(n[i]===t){n.splice(i,1);break}pO.put(t)},n._removeUpdateFromHash=function(t){var e=t.target.uuid||t.target.id,n=this._hashForUpdates[e];if(n){for(var i=n.list,r=n.entry,a=0,o=i.length;a<o;a++)if(i[a]===r){i.splice(a,1);break}delete this._hashForUpdates[e],fO.put(r),dO.put(n)}},n._priorityIn=function(t,e,n){for(var i=0;i<t.length;i++)if(n<t[i].priority)return void t.splice(i,0,e);t.push(e)},n._appendIn=function(t,e){t.push(e)},e}(uO));gO.ID="scheduler",h.Scheduler=gO;var yO=((vO={})[ih.PORTRAIT]=di.IDENTITY,vO[ih.LANDSCAPE_RIGHT]=di.ROTATE_90,vO[ih.PORTRAIT_UPSIDE_DOWN]=di.ROTATE_180,vO[ih.LANDSCAPE_LEFT]=di.ROTATE_270,vO),xO=function(){function t(){this._title="",this._width=1,this._height=1,this._swapchain=null,this._renderPass=null,this._colorTextures=[],this._depthStencilTexture=null,this._cameras=[],this._hasOnScreenAttachments=!1,this._hasOffScreenAttachments=!1,this._framebuffer=null}t.registerCreateFunc=function(e){e._createWindowFun=function(e){return new t(e)}};var e=t.prototype;return e.initialize=function(t,e){if(this._init(),void 0!==e.title&&(this._title=e.title),void 0!==e.swapchain&&(this._swapchain=e.swapchain),this._width=e.width,this._height=e.height,this._renderPass=t.createRenderPass(e.renderPassInfo),e.swapchain)this._setSwapchain(e.swapchain),this._colorTextures.push(e.swapchain.colorTexture),this._depthStencilTexture=e.swapchain.depthStencilTexture;else{for(var n=0;n<e.renderPassInfo.colorAttachments.length;n++)this._colorTextures.push(t.createTexture(new br(bi.TEX2D,Ci.COLOR_ATTACHMENT|Ci.SAMPLED|Ci.TRANSFER_SRC,e.renderPassInfo.colorAttachments[n].format,this._width,this._height)));e.renderPassInfo.depthStencilAttachment.format!==mi.UNKNOWN&&(this._depthStencilTexture=t.createTexture(new br(bi.TEX2D,Ci.DEPTH_STENCIL_ATTACHMENT|Ci.SAMPLED,e.renderPassInfo.depthStencilAttachment.format,this._width,this._height)))}return this._setFrameBuffer(t.createFramebuffer(new Wr(this._renderPass,this._colorTextures,this._depthStencilTexture))),!0},e.destroy=function(){this.clearCameras(),this._framebuffer&&(this._framebuffer.destroy(),this._framebuffer=null),this._depthStencilTexture&&(this._depthStencilTexture.destroy(),this._depthStencilTexture=null);for(var t=0;t<this._colorTextures.length;t++){var e=this._colorTextures[t];e&&e.destroy()}this._colorTextures.length=0,this._destroy()},e.resize=function(t,e){if(this._swapchain)this._swapchain.resize(t,e,yO[Cu.orientation]),this._width=this._swapchain.width,this._height=this._swapchain.height;else{for(var n=0;n<this._colorTextures.length;n++)this._colorTextures[n].resize(t,e);this._depthStencilTexture&&this._depthStencilTexture.resize(t,e),this._width=t,this._height=e}this.framebuffer&&(this.framebuffer.destroy(),this.framebuffer.initialize(new Wr(this._renderPass,this._colorTextures,this._depthStencilTexture)));for(var i,r=st(this._cameras);!(i=r()).done;)i.value.resize(t,e)},e.extractRenderCameras=function(t){for(var e=0;e<this._cameras.length;e++){var n=this._cameras[e];n.enabled&&(n.update(),t.push(n))}},e.attachCamera=function(t){for(var e=0;e<this._cameras.length;e++)if(this._cameras[e]===t)return;this._cameras.push(t),this.sortCameras()},e.detachCamera=function(t){for(var e=0;e<this._cameras.length;++e)if(this._cameras[e]===t)return void this._cameras.splice(e,1)},e.clearCameras=function(){this._cameras.length=0},e.sortCameras=function(){this._cameras.sort((function(t,e){return t.priority-e.priority}))},e._init=function(){},e._destroy=function(){},e._setSwapchain=function(t){this._swapchain=t},e._setFrameBuffer=function(t){this._framebuffer=t},Q(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}},{key:"swapchain",get:function(){return this._swapchain}},{key:"framebuffer",get:function(){return this._framebuffer}},{key:"cameras",get:function(){return this._cameras}},{key:"native",get:function(){return this._nativeObj}}]),t}(),SO=t("Root",function(){function t(t){var e=this;this._createSceneFun=null,this._createWindowFun=null,this._device=void 0,this._windows=[],this._mainWindow=null,this._curWindow=null,this._tempWindow=null,this._pipeline=null,this._batcher=null,this._dataPoolMgr=void 0,this._scenes=[],this._modelPools=new Map,this._cameraPool=null,this._lightPools=new Map,this._fpsTime=0,this._frameCount=0,this._fps=0,this._fixedFPS=0,this._useDeferredPipeline=!1,this._fixedFPSFrameTime=0,this._cumulativeTime=0,this._frameTime=0,this._device=t,this._dataPoolMgr=h.internal.DataPoolManager&&new h.internal.DataPoolManager(t),nx.registerCreateFunc(this),xO.registerCreateFunc(this),this._cameraPool=new ql((function(){return new Eg(e._device)}),4,(function(t){return t.destroy()}))}var e=t.prototype;return e.initialize=function(){this._init();var t=h.game._swapchain,e=new Vr;e.format=t.colorTexture.format;var n=new zr;n.format=t.depthStencilTexture.format,n.depthStoreOp=Vi.DISCARD,n.stencilStoreOp=Vi.DISCARD;var i=new Gr([e],n);return this._mainWindow=this.createWindow({title:"rootMainWindow",width:t.width,height:t.height,renderPassInfo:i,swapchain:t}),this._curWindow=this._mainWindow,Promise.resolve(Uv.initBuiltinRes(this._device))},e.destroy=function(){this.destroyScenes(),this._pipeline&&(this._pipeline.destroy(),this._pipeline=null),this._batcher&&(this._batcher.destroy(),this._batcher=null),this._curWindow=null,this._mainWindow=null,this.dataPoolManager.clear(),this._destroy()},e.resize=function(t,e){for(var n,i=st(this._windows);!(n=i()).done;){var r=n.value;r.swapchain&&r.resize(t,e)}},e.setRenderPipeline=function(t){t instanceof sO&&(this._useDeferredPipeline=!0);var e=!1;if(t||(t=cO(),e=!0),this._pipeline=t,this._useDeferredPipeline&&this.device.hasFeature(pi.COMPUTE_SHADER)||(this._pipeline.clusterEnabled=!1),this._pipeline.bloomEnabled=!1,!this._pipeline.activate(this._mainWindow.swapchain))return e&&this._pipeline.destroy(),this._pipeline=null,!1;var n=h.director.getScene();return n&&n.globals.activate(),this.onGlobalPipelineStateChanged(),!(!this._batcher&&h.internal.Batcher2D&&(this._batcher=new h.internal.Batcher2D(this),!this._batcher.initialize())&&(this.destroy(),1))},e.onGlobalPipelineStateChanged=function(){for(var t=0;t<this._scenes.length;t++)this._scenes[t].onGlobalPipelineStateChanged();this._pipeline.pipelineSceneData.onGlobalPipelineStateChanged()},e.activeWindow=function(t){this._curWindow=t},e.resetCumulativeTime=function(){this._setCumulativeTime(0)},e.frameMove=function(t){this._setFrameTime(t),++this._frameCount,this._setCumulativeTime(t),this._fpsTime+=t,this._fpsTime>1&&(this._fps=this._frameCount,this._frameCount=0,this._fpsTime=0);for(var e=0;e<this._scenes.length;++e)this._scenes[e].removeBatches();for(var n=this._windows,i=[],r=0;r<n.length;r++)n[r].extractRenderCameras(i);if(this._pipeline&&i.length>0){this._device.acquire([h.game._swapchain]);var a=this._scenes,o=h.director.getTotalFrames();this._batcher&&(this._batcher.update(),this._batcher.uploadBuffers());for(var s=0;s<a.length;s++)a[s].update(o);h.director.emit(h.Director.EVENT_BEFORE_COMMIT),i.sort((function(t,e){return t.priority-e.priority})),this._pipeline.render(i),this._device.present()}this._batcher&&this._batcher.reset()},e.createWindow=function(t){var e=this._createWindowFun(this);return e.initialize(this.device,t),this._windows.push(e),e},e.destroyWindow=function(t){for(var e=0;e<this._windows.length;++e)if(this._windows[e]===t)return t.destroy(),void this._windows.splice(e,1)},e.destroyWindows=function(){for(var t,e=st(this._windows);!(t=e()).done;)t.value.destroy();this._windows.length=0},e.createScene=function(t){var e=this._createSceneFun(this);return e.initialize(t),this._scenes.push(e),e},e.destroyScene=function(t){for(var e=0;e<this._scenes.length;++e)if(this._scenes[e]===t)return t.destroy(),void this._scenes.splice(e,1)},e.destroyScenes=function(){for(var t,e=st(this._scenes);!(t=e()).done;)t.value.destroy();this._scenes.length=0},e.createModel=function(t){var e=this._modelPools.get(t);e||(this._modelPools.set(t,new ql((function(){return new t}),10,(function(t){return t.destroy()}))),e=this._modelPools.get(t));var n=e.alloc();return n.initialize(),n},e.destroyModel=function(t){var e=this._modelPools.get(t.constructor);e?(e.free(t),t.scene&&t.scene.removeModel(t)):R(1300,t.constructor.name),t.destroy()},e.createCamera=function(){return this._cameraPool.alloc()},e.createLight=function(t){var e=this._lightPools.get(t);e||(this._lightPools.set(t,new ql((function(){return new t}),4,(function(t){return t.destroy()}))),e=this._lightPools.get(t));var n=e.alloc();return n.initialize(),n},e.destroyLight=function(t){var e=this._lightPools.get(t.constructor);if(e&&(e.free(t),t.scene))switch(t.type){case Vy.SPHERE:t.scene.removeSphereLight(t);break;case Vy.SPOT:t.scene.removeSpotLight(t)}t.destroy()},e._init=function(){},e._destroy=function(){},e._setCumulativeTime=function(t){this._cumulativeTime+=t},e._setFrameTime=function(t){this._frameTime=t},Q(t,[{key:"device",get:function(){return this._device}},{key:"mainWindow",get:function(){return this._mainWindow}},{key:"curWindow",get:function(){return this._curWindow},set:function(t){this._curWindow=t}},{key:"tempWindow",get:function(){return this._tempWindow},set:function(t){this._tempWindow=t}},{key:"windows",get:function(){return this._windows}},{key:"pipeline",get:function(){return this._pipeline}},{key:"batcher2D",get:function(){return this._batcher}},{key:"scenes",get:function(){return this._scenes}},{key:"cumulativeTime",get:function(){return this._cumulativeTime}},{key:"frameTime",get:function(){return this._frameTime}},{key:"frameCount",get:function(){return this._frameCount}},{key:"fps",get:function(){return this._fps}},{key:"fixedFPS",get:function(){return this._fixedFPS},set:function(t){t>0?(this._fixedFPS=t,this._fixedFPSFrameTime=1e3/t):this._fixedFPSFrameTime=0}},{key:"dataPoolManager",get:function(){return this._dataPoolMgr}},{key:"useDeferredPipeline",get:function(){return this._useDeferredPipeline}}]),t}());h.Root=SO;var AO=t("Game",function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).frame=null,e.container=null,e.canvas=null,e.renderType=-1,e.eventTargetOn=t.prototype.on,e.eventTargetOnce=t.prototype.once,e.config={},e.onStart=null,e.frameTime=1e3/60,e.collisionMatrix=[],e.groupList=[],e._persistRootNodes={},e._gfxDevice=null,e._swapchain=null,e._configLoaded=!1,e._isCloning=!1,e._inited=!1,e._engineInited=!1,e._rendererInitialized=!1,e._paused=!0,e._frameRate=60,e._intervalId=0,e._initTime=0,e._startTime=0,e._deltaTime=0,e._onEngineInitedCallback=[],e}$(e,t);var i=e.prototype;return i.setFrameRate=function(t){this.frameRate=t},i.getFrameRate=function(){return this.frameRate},i.step=function(){h.director.tick(this.frameTime/1e3)},i.pause=function(){this._paused||(this._paused=!0,this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0))},i.resume=function(){this._paused&&(qD._clearEvents(),this._intervalId&&(window.cAF(this._intervalId),this._intervalId=0),this._paused=!1,this._updateCallback(),this._intervalId=window.rAF(this._frameCB))},i.isPaused=function(){return this._paused},i.restart=function(){var t=this;return new Promise((function(t){return h.director.once(h.Director.EVENT_END_FRAME,(function(){return t()}))})).then((function(){for(var n in t._persistRootNodes)t.removePersistRootNode(t._persistRootNodes[n]);return h.director.getScene().destroy(),h.Object._deferredDestroy(),h.director.reset(),h.profiler.reset(),t.pause(),t._setRenderPipelineNShowSplash().then((function(){t.resume(),t._safeEmit(e.EVENT_RESTART)}))}))},i.end=function(){Lh.close()},i.on=function(t,n,i,r){return(this._engineInited&&t===e.EVENT_ENGINE_INITED||this._inited&&t===e.EVENT_GAME_INITED||this._rendererInitialized&&t===e.EVENT_RENDERER_INITED)&&n.call(i),this.eventTargetOn(t,n,i,r)},i.once=function(t,n,i){return this._engineInited&&t===e.EVENT_ENGINE_INITED?n.call(i):this.eventTargetOnce(t,n,i)},i.init=function(t){var e=this;if(this._initConfig(t),this.config.assetOptions&&h.assetManager.init(this.config.assetOptions),this.config.layers)for(var i=this.config.layers,r=0;r<i.length;r++){var a=i[r],o=n(a.value);Hd.addLayer(a.name,o)}return this._initEngine().then((function(){return e._initEvents(),h.director.root&&h.director.root.dataPoolManager&&h.director.root.dataPoolManager.jointTexturePool.registerCustomTextureLayouts(t.customJointTextureLayouts),e._engineInited}))},i.run=function(t,e){var n,i=this;return"function"!=typeof t&&t?(n=this.init(t),this.onStart=null!=e?e:null):this.onStart=null!=t?t:null,$i.init(),Promise.resolve(n).then((function(){return i._setRenderPipelineNShowSplash()})).then((function(){Eu._init({configOrientation:"auto",exactFitScreen:!0})}))},i.addPersistRootNode=function(t){if(h.Node.isNode(t)&&t.uuid){var e=t.uuid;if(!this._persistRootNodes[e]){var n=h.director._scene;if(h.isValid(n))if(t.parent){if(!(t.parent instanceof h.Scene))return void R(3801);if(t.parent!==n)return void R(3802);t._originalSceneId=n.uuid}else t.parent=n;this._persistRootNodes[e]=t,t._persistNode=!0,h.assetManager._releaseManager._addPersistNodeRef(t)}}else R(3800)},i.removePersistRootNode=function(t){var e=t.uuid||"";t===this._persistRootNodes[e]&&(delete this._persistRootNodes[e],t._persistNode=!1,t._originalSceneId="",h.assetManager._releaseManager._removePersistNodeRef(t))},i.isPersistRootNode=function(t){return!!t._persistNode},i.onEngineInitedAsync=function(t){this._onEngineInitedCallback.push(t)},i._initEngine=function(){var t=this;this._initDevice();var n=h.director;return Promise.resolve(n._init()).then((function(){h.view.init(),x("Cocos Creator v"+u),t.emit(e.EVENT_ENGINE_INITED),t._engineInited=!0,h.internal.dynamicAtlasManager&&(h.internal.dynamicAtlasManager.enabled=!_e.CLEANUP_IMAGE_CACHE)})).then((function(){var e=t._onEngineInitedCallback.map((function(t){return t()})).filter(Boolean);return t._onEngineInitedCallback.length=0,Promise.all(e)}))},i._setAnimFrame=function(){var t=this._frameRate,e=window.requestAnimationFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;60!==t&&30!==t?(window.rAF=this._stTime.bind(this),window.cAF=this._ctTime):(window.rAF=e||this._stTime.bind(this),window.cAF=window.cancelAnimationFrame||window.cancelRequestAnimationFrame||window.msCancelRequestAnimationFrame||window.mozCancelRequestAnimationFrame||window.oCancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||window.msCancelAnimationFrame||window.mozCancelAnimationFrame||window.webkitCancelAnimationFrame||window.ocancelAnimationFrame||this._ctTime,this._updateCallback())},i._stTime=function(t){var e=performance.now(),n=Math.max(0,e-this._startTime),i=Math.max(0,this.frameTime-n);return window.setTimeout(t,i)},i._ctTime=function(t){window.clearTimeout(t)},i._calculateDT=function(t){return t||(t=performance.now()),this._deltaTime=t>this._startTime?(t-this._startTime)/1e3:0,this._deltaTime>e.DEBUG_DT_THRESHOLD&&(this._deltaTime=this.frameTime/1e3),this._startTime=t,this._deltaTime},i._updateCallback=function(){var t,e=this,n=h.director;if(30===this._frameRate){var i=!0;t=function(t){e._intervalId=window.rAF(e._frameCB),(i=!i)||n.tick(e._calculateDT(t))}}else t=function(t){n.tick(e._calculateDT(t)),e._intervalId=window.rAF(e._frameCB)};this._frameCB=t},i._runMainLoop=function(){if(this._inited){var t=this.config,e=h.director;z(!!t.showFPS),e.startAnimation(),this.resume()}},i._initConfig=function(t){"number"!=typeof t.debugMode&&(t.debugMode=N.NONE),t.exposeClassName=!!t.exposeClassName,"number"!=typeof t.frameRate&&(t.frameRate=60);var e=t.renderMode;("number"!=typeof e||e>3||e<0)&&(t.renderMode=0),t.showFPS=!!t.showFPS,T(t.debugMode),this.config=t,this._configLoaded=!0,this.frameRate=t.frameRate},i._determineRenderType=function(){var t=this.config,n=parseInt(t.renderMode,10);this.renderType=e.RENDER_TYPE_CANVAS;var i=!1;if(1===n?(this.renderType=e.RENDER_TYPE_CANVAS,i=!0):0===n||2===n?(this.renderType=e.RENDER_TYPE_WEBGL,i=!0):3===n&&(this.renderType=e.RENDER_TYPE_HEADLESS,i=!0),!i)throw new Error(F(3820,n))},i._initDevice=function(){if(!this._rendererInitialized){var t=this.config.adapter;if(t&&(this.canvas=t.canvas,this.frame=t.frame,this.container=t.container),this._determineRenderType(),this.renderType===e.RENDER_TYPE_WEBGL){var n=new vr(ap),i=!!window.WebGL2RenderingContext,r=window.navigator.userAgent.toLowerCase();(-1!==r.indexOf("safari")&&-1===r.indexOf("chrome")||wu.browserType===Sh.UC)&&(i=!1);var a=[];i&&h.WebGL2Device&&a.push(h.WebGL2Device),h.WebGLDevice&&a.push(h.WebGLDevice),h.EmptyDevice&&a.push(h.EmptyDevice),ga.canvas=this.canvas;for(var o=0;o<a.length&&(this._gfxDevice=new a[o],!this._gfxDevice.initialize(n));o++);}else this.renderType===e.RENDER_TYPE_HEADLESS&&h.EmptyDevice&&(this._gfxDevice=new h.EmptyDevice,this._gfxDevice.initialize(new vr(ap)));if(!this._gfxDevice)return A("can not support canvas rendering in 3D"),void(this.renderType=e.RENDER_TYPE_CANVAS);var s=new mr(this.canvas),c=Eu.windowSize;s.width=c.width,s.height=c.height,this._swapchain=this._gfxDevice.createSwapchain(s),this.canvas.oncontextmenu=function(){return!1}}},i._initEvents=function(){Lh.on("show",this._onShow,this),Lh.on("hide",this._onHide,this)},i._onHide=function(){this.emit(e.EVENT_HIDE),this.pause()},i._onShow=function(){this.emit(e.EVENT_SHOW),this.resume()},i._setRenderPipelineNShowSplash=function(){var t=this;return Promise.resolve(this._setupRenderPipeline()).then((function(){return Promise.resolve(t._showSplashScreen()).then((function(){t._inited=!0,t._initTime=performance.now(),t._runMainLoop(),t._safeEmit(e.EVENT_GAME_INITED),t.onStart&&t.onStart()}))}))},i._setupRenderPipeline=function(){var t=this,e=this.config.renderPipeline;return e?new Promise((function(t,n){h.assetManager.loadAny(e,(function(e,i){return!e&&i instanceof CS?t(i):n(e)}))})).then((function(e){t._setRenderPipeline(e)})).catch((function(n){S(n),S("Failed load render pipeline: "+e+", engine failed to initialize, will fallback to default pipeline"),t._setRenderPipeline()})):this._setRenderPipeline()},i._showSplashScreen=function(){if(h.internal.SplashScreen){var t=h.internal.SplashScreen.instance;return t.main(h.director.root),new Promise((function(e){t.setOnFinish((function(){return e()})),t.loadFinish=!0}))}return null},i._setRenderPipeline=function(t){h.director.root.setRenderPipeline(t)||this._setRenderPipeline(),this._rendererInitialized=!0,this._safeEmit(e.EVENT_RENDERER_INITED)},i._safeEmit=function(t){this.emit(t)},Q(e,[{key:"inited",get:function(){return this._inited}},{key:"frameRate",get:function(){return this._frameRate},set:function(t){"number"!=typeof t&&(t=parseInt(t,10),Number.isNaN(t)&&(t=60)),this._frameRate=t,this.frameTime=1e3/t,this._setAnimFrame()}},{key:"deltaTime",get:function(){return this._deltaTime}},{key:"totalTime",get:function(){return performance.now()-this._initTime}},{key:"frameStartTime",get:function(){return this._startTime}}]),e}(uh));AO.EVENT_HIDE="game_on_hide",AO.EVENT_SHOW="game_on_show",AO.EVENT_LOW_MEMORY="game_on_low_memory",AO.EVENT_GAME_INITED="game_inited",AO.EVENT_ENGINE_INITED="engine_inited",AO.EVENT_RENDERER_INITED="renderer_inited",AO.EVENT_RESTART="game_on_restart",AO.RENDER_TYPE_CANVAS=0,AO.RENDER_TYPE_WEBGL=1,AO.RENDER_TYPE_OPENGL=2,AO.RENDER_TYPE_HEADLESS=3,AO.DEBUG_DT_THRESHOLD=1,h.Game=AO;var bO=t("game",h.game=new AO),CO=t("Director",function(t){function e(){var e;return(e=t.call(this)||this)._compScheduler=void 0,e._nodeActivator=void 0,e._invalid=void 0,e._paused=void 0,e._root=void 0,e._loadingScene=void 0,e._scene=void 0,e._totalFrames=void 0,e._scheduler=void 0,e._systems=void 0,e._invalid=!1,e._paused=!1,e._root=null,e._loadingScene="",e._scene=null,e._totalFrames=0,e._scheduler=new gO,e._compScheduler=new yR,e._nodeActivator=new FR,e._systems=[],bO.once(AO.EVENT_RENDERER_INITED,e._initOnRendererInitialized,at(e)),e}$(e,t);var n=e.prototype;return n.calculateDeltaTime=function(){},n.end=function(){var t=this;this.once(e.EVENT_END_FRAME,(function(){t.purgeDirector()}))},n.pause=function(){this._paused||(this._paused=!0)},n.purgeDirector=function(){this._scheduler.unscheduleAll(),this._compScheduler.unscheduleAll(),this._nodeActivator.reset(),h.isValid(this._scene)&&this._scene.destroy(),this._scene=null,this.stopAnimation(),h.assetManager.releaseAll()},n.reset=function(){this.purgeDirector(),this.emit(e.EVENT_RESET),this.startAnimation()},n.runSceneImmediate=function(t,e,n){t instanceof VR&&(t=t.scene),L(t instanceof iR,1216),t._load();for(var i=Object.keys(bO._persistRootNodes).map((function(t){return bO._persistRootNodes[t]})),r=0;r<i.length;r++){var a=i[r];a.emit(h.Node.SCENE_CHANGED_FOR_PERSISTS,t.renderScene);var o=t.uuid===a._originalSceneId&&t.getChildByUuid(a.uuid);if(o){var s=o.getSiblingIndex();o._destroyImmediate(),t.insertChild(a,s)}else a.parent=t}var c=this._scene;h.isValid(c)&&c.destroy(),h.assetManager._releaseManager._autoRelease(c,t,bO._persistRootNodes),this._scene=null,ml._deferredDestroy(),e&&e(),this.emit(h.Director.EVENT_BEFORE_SCENE_LAUNCH,t),this._scene=t,t._activate(),this._root&&this._root.resetCumulativeTime(),this.startAnimation(),n&&n(null,t),this.emit(h.Director.EVENT_AFTER_SCENE_LAUNCH,t)},n.runScene=function(t,e,n){var i=this;t instanceof VR&&(t=t.scene),L(t,1205),L(t instanceof iR,1216),t._load(),this.once(h.Director.EVENT_END_FRAME,(function(){i.runSceneImmediate(t,e,n)}))},n.loadScene=function(t,e,n){var i=this;if(this._loadingScene)return R(1208,t,this._loadingScene),!1;var r=h.assetManager.bundles.find((function(e){return!!e.getSceneInfo(t)}));return r?(this.emit(h.Director.EVENT_BEFORE_SCENE_LOADING,t),this._loadingScene=t,console.time("LoadScene "+t),r.loadScene(t,(function(r,a){console.timeEnd("LoadScene "+t),i._loadingScene="",r?(A(r),e&&e(r)):i.runSceneImmediate(a,n,e)})),!0):(O(1209,t),!1)},n.preloadScene=function(t,e,n){var i=h.assetManager.bundles.find((function(e){return!!e.getSceneInfo(t)}));if(i)i.preloadScene(t,null,e,n);else{var r='Can not preload the scene "'+t+'" because it is not in the build settings.';n&&n(new Error(r)),A("preloadScene: "+r)}},n.resume=function(){this._paused&&(this._paused=!1)},n.getScene=function(){return this._scene},n.getDeltaTime=function(){return bO.deltaTime},n.getTotalTime=function(){return bO.totalTime},n.getCurrentTime=function(){return bO.frameStartTime},n.getTotalFrames=function(){return this._totalFrames},n.isPaused=function(){return this._paused},n.getScheduler=function(){return this._scheduler},n.setScheduler=function(t){this._scheduler!==t&&(this.unregisterSystem(this._scheduler),this._scheduler=t,this.registerSystem(gO.ID,t,200))},n.registerSystem=function(t,e,n){e.id=t,e.priority=n,e.init(),this._systems.push(e),this._systems.sort(uO.sortByPriority)},n.unregisterSystem=function(t){ie.fastRemove(this._systems,t),this._systems.sort(uO.sortByPriority)},n.getSystem=function(t){return this._systems.find((function(e){return e.id===t}))},n.getAnimationManager=function(){return this.getSystem(h.AnimationManager.ID)},n.startAnimation=function(){this._invalid=!1},n.stopAnimation=function(){this._invalid=!0},n.mainLoop=function(t){var e;e=bO._calculateDT(t),this.tick(e)},n.tick=function(t){if(!this._invalid){if(this.emit(e.EVENT_BEGIN_FRAME),qD._frameDispatchEvents(),!this._paused){this.emit(e.EVENT_BEFORE_UPDATE),this._compScheduler.startPhase(),this._compScheduler.updatePhase(t);for(var n=0;n<this._systems.length;++n)this._systems[n].update(t);this._compScheduler.lateUpdatePhase(t),this.emit(e.EVENT_AFTER_UPDATE),ml._deferredDestroy();for(var i=0;i<this._systems.length;++i)this._systems[i].postUpdate(t)}this.emit(e.EVENT_BEFORE_DRAW),this._root.frameMove(t),this.emit(e.EVENT_AFTER_DRAW),TE.resetHasChangedFlags(),TE.clearNodeArray(),jl.update(t),this.emit(e.EVENT_END_FRAME),this._totalFrames++}},n._initOnRendererInitialized=function(){this._totalFrames=0,this._paused=!1,this.registerSystem(gO.ID,this._scheduler,200),this.emit(e.EVENT_INIT)},n._init=function(){return this._root=new SO(bO._gfxDevice),this._root.initialize({}).catch((function(t){return O(1217),Promise.reject(t)}))},Q(e,[{key:"root",get:function(){return this._root}}]),e}(uh));CO.EVENT_INIT="director_init",CO.EVENT_RESET="director_reset",CO.EVENT_BEFORE_SCENE_LOADING="director_before_scene_loading",CO.EVENT_BEFORE_SCENE_LAUNCH="director_before_scene_launch",CO.EVENT_AFTER_SCENE_LAUNCH="director_after_scene_launch",CO.EVENT_BEFORE_UPDATE="director_before_update",CO.EVENT_AFTER_UPDATE="director_after_update",CO.EVENT_BEFORE_DRAW="director_before_draw",CO.EVENT_AFTER_DRAW="director_after_draw",CO.EVENT_BEFORE_COMMIT="director_before_commit",CO.EVENT_BEFORE_PHYSICS="director_before_physics",CO.EVENT_AFTER_PHYSICS="director_after_physics",CO.EVENT_BEGIN_FRAME="director_begin_frame",CO.EVENT_END_FRAME="director_end_frame",CO.instance=void 0,h.Director=CO;var TO=t("director",CO.instance=h.director=new CO),EO={};k(EO,"vmath",[{name:"vec2",newName:"Vec2",target:hi,targetName:"math"},{name:"vec3",newName:"Vec3",target:hi,targetName:"math"},{name:"vec4",newName:"Vec4",target:hi,targetName:"math"},{name:"quat",newName:"Quat",target:hi,targetName:"math"},{name:"mat3",newName:"Mat3",target:hi,targetName:"math"},{name:"mat4",newName:"Mat4",target:hi,targetName:"math"},{name:"color4",newName:"Color",target:hi,targetName:"math"},{name:"rect",newName:"Rect",target:hi,targetName:"math"},{name:"approx",newName:"approx",target:hi,targetName:"math"},{name:"EPSILON",newName:"EPSILON",target:hi,targetName:"math"},{name:"equals",newName:"equals",target:hi,targetName:"math"},{name:"clamp",newName:"clamp",target:hi,targetName:"math"},{name:"clamp01",newName:"clamp01",target:hi,targetName:"math"},{name:"lerp",newName:"lerp",target:hi,targetName:"math"},{name:"toRadian",newName:"toRadian",target:hi,targetName:"math"},{name:"toDegree",newName:"toDegree",target:hi,targetName:"math"},{name:"random",newName:"random",target:hi,targetName:"math"},{name:"randomRange",newName:"randomRange",target:hi,targetName:"math"},{name:"randomRangeInt",newName:"randomRangeInt",target:hi,targetName:"math"},{name:"pseudoRandom",newName:"pseudoRandom",target:hi,targetName:"math"},{name:"pseudoRandomRangeInt",newName:"pseudoRandomRangeInt",target:hi,targetName:"math"},{name:"nextPow2",newName:"nextPow2",target:hi,targetName:"math"},{name:"repeat",newName:"repeat",target:hi,targetName:"math"},{name:"pingPong",newName:"pingPong",target:hi,targetName:"math"},{name:"inverseLerp",newName:"inverseLerp",target:hi,targetName:"math"}]),h.vmath=EO,k(gO.prototype,"Scheduler.prototype",[{name:"enableForTarget",newName:"enableForTarget",target:gO,targetName:"Scheduler"}]),k(gO,"Scheduler",[{name:"PRIORITY_SYSTEM",newName:"System.Priority.SCHEDULER",customGetter:function(){return uO.Priority.SCHEDULER}}]),U(gO,"Scheduler",[{name:"PRIORITY_NON_SYSTEM",suggest:"Use enum` System.Priority` instead"}]),k(gy.prototype,"SubModel.prototype",[{name:"subMeshData",newName:"subMesh"}]),U(gy.prototype,"SubModel.prototype",[{name:"getSubModel",suggest:"Use `subModels[i]` instead"},{name:"subModelNum",suggest:"Use `subModels.length` instead"}]),k(SO.prototype,"Root.prototype",[{name:"ui",newName:"batcher2D"}]),G(bO,"game",[{name:"collisionMatrix"},{name:"groupList"}]),G(CO.prototype,"director",[{name:"calculateDeltaTime"},{name:"getDeltaTime",suggest:"Use game.deltaTime instead"},{name:"getTotalTime",suggest:"Use game.totalTime instead"},{name:"getCurrentTime",suggest:"Use game.frameStartTime instead"}]),U(CO.prototype,"director",[{name:"setAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getAnimationInterval",suggest:"please use game.frameRate instead"},{name:"getRunningScene",suggest:"please use getScene instead"},{name:"setDepthTest",suggest:"please use camera API instead"},{name:"setClearColor",suggest:"please use camera API instead"},{name:"getWinSize",suggest:"please use view.getVisibleSize instead"},{name:"getWinSizeInPixels"},{name:"purgeCachedData",suggest:"please use assetManager.releaseAll instead"},{name:"convertToGL"},{name:"convertToUI"}]);var wO,IO={topLeft:h.v2(0,0),topRight:h.v2(0,0),top:h.v2(0,0),bottomLeft:h.v2(0,0),bottomRight:h.v2(0,0),bottom:h.v2(0,0),center:h.v2(0,0),left:h.v2(0,0),right:h.v2(0,0),width:0,height:0,init:function(t){var e=this.width=t.width,n=this.height=t.height,i=t.x,r=t.y,a=r+n,o=i+e;this.topLeft.x=i,this.topLeft.y=a,this.topRight.x=o,this.topRight.y=a,this.top.x=i+e/2,this.top.y=a,this.bottomLeft.x=i,this.bottomLeft.y=r,this.bottomRight.x=o,this.bottomRight.y=r,this.bottom.x=i+e/2,this.bottom.y=r,this.center.x=i+e/2,this.center.y=r+n/2,this.left.x=i,this.left.y=r+n/2,this.right.x=o,this.right.y=r+n/2}};h.visibleRect=IO;var PO=new ri,DO=((wO={})[_e.ORIENTATION_AUTO]=ih.AUTO,wO[_e.ORIENTATION_LANDSCAPE]=ih.LANDSCAPE,wO[_e.ORIENTATION_PORTRAIT]=ih.PORTRAIT,wO),RO=t("View",function(t){function e(){var e;(e=t.call(this)||this)._designResolutionSize=void 0,e._scaleX=void 0,e._scaleY=void 0,e._viewportRect=void 0,e._visibleRect=void 0,e._autoFullScreen=void 0,e._retinaEnabled=void 0,e._resizeCallback=void 0,e._resolutionPolicy=void 0,e._rpExactFit=void 0,e._rpShowAll=void 0,e._rpNoBorder=void 0,e._rpFixedHeight=void 0,e._rpFixedWidth=void 0;var n=MO,i=OO;return e._designResolutionSize=new ri(0,0),e._scaleX=1,e._scaleY=1,e._viewportRect=new oi(0,0,0,0),e._visibleRect=new oi(0,0,0,0),e._autoFullScreen=!1,e._retinaEnabled=!1,e._resizeCallback=null,e._rpExactFit=new NO(n.EQUAL_TO_FRAME,i.EXACT_FIT),e._rpShowAll=new NO(n.EQUAL_TO_FRAME,i.SHOW_ALL),e._rpNoBorder=new NO(n.EQUAL_TO_FRAME,i.NO_BORDER),e._rpFixedHeight=new NO(n.EQUAL_TO_FRAME,i.FIXED_HEIGHT),e._rpFixedWidth=new NO(n.EQUAL_TO_FRAME,i.FIXED_WIDTH),e._resolutionPolicy=e._rpShowAll,e}$(e,t);var n=e.prototype;return n.init=function(){var t=Eu.windowSize,e=t.width,n=t.height;this._designResolutionSize.width=e,this._designResolutionSize.height=n,this._viewportRect.width=e,this._viewportRect.height=n,this._visibleRect.width=e,this._visibleRect.height=n,PO.width=this._visibleRect.width,PO.height=this._visibleRect.height,IO&&IO.init(this._visibleRect),Cu.on("window-resize",this._updateAdaptResult,this),Cu.on("orientation-change",this._updateAdaptResult,this),Cu.on("fullscreen-change",this._updateAdaptResult,this)},n.resizeWithBrowserSize=function(t){Cu.handleResizeEvent=t},n.setResizeCallback=function(t){"function"!=typeof t&&null!=t||(this._resizeCallback=t)},n.setOrientation=function(t){Cu.orientation=DO[t]},n.adjustViewportMeta=function(){},n.enableRetina=function(t){this._retinaEnabled=!!t},n.isRetinaEnabled=function(){return this._retinaEnabled},n.enableAutoFullScreen=function(t){t!==this._autoFullScreen&&(this._autoFullScreen=t,t&&Eu.requestFullScreen().catch((function(){})))},n.isAutoFullScreenEnabled=function(){return this._autoFullScreen},n.setCanvasSize=function(t,e){Cu.resolutionScale=1;var n=Cu.devicePixelRatio,i=new ri(t*n,e*n);Eu.windowSize=i},n.getCanvasSize=function(){return Eu.windowSize},n.getFrameSize=function(){var t=Cu.devicePixelRatio,e=Eu.windowSize;return e.width/=t,e.height/=t,e},n.setFrameSize=function(t,e){var n=Cu.devicePixelRatio;Eu.windowSize=new ri(t*n,e*n)},n.getVisibleSize=function(){return new ri(this._visibleRect.width,this._visibleRect.height)},n.getVisibleSizeInPixel=function(){return new ri(this._visibleRect.width*this._scaleX,this._visibleRect.height*this._scaleY)},n.getVisibleOrigin=function(){return new Qn(this._visibleRect.x,this._visibleRect.y)},n.getVisibleOriginInPixel=function(){return new Qn(this._visibleRect.x*this._scaleX,this._visibleRect.y*this._scaleY)},n.getResolutionPolicy=function(){return this._resolutionPolicy},n._updateResolutionPolicy=function(t){if(t instanceof NO)this._resolutionPolicy=t;else{var e=NO;t===e.EXACT_FIT&&(this._resolutionPolicy=this._rpExactFit),t===e.SHOW_ALL&&(this._resolutionPolicy=this._rpShowAll),t===e.NO_BORDER&&(this._resolutionPolicy=this._rpNoBorder),t===e.FIXED_HEIGHT&&(this._resolutionPolicy=this._rpFixedHeight),t===e.FIXED_WIDTH&&(this._resolutionPolicy=this._rpFixedWidth)}},n.setResolutionPolicy=function(t){this._updateResolutionPolicy(t);var e=BO.getDesignResolutionSize();BO.setDesignResolutionSize(e.width,e.height,t)},n.setDesignResolutionSize=function(t,e,n){if(t>0&&e>0){this._updateResolutionPolicy(n);var i=this._resolutionPolicy;i&&i.preApply(this),this._designResolutionSize.width=t,this._designResolutionSize.height=e;var r=i.apply(this,this._designResolutionSize);if(r.scale&&2===r.scale.length&&(this._scaleX=r.scale[0],this._scaleY=r.scale[1]),r.viewport){var a=this._viewportRect,o=this._visibleRect,s=r.viewport;a.x=s.x,a.y=s.y,a.width=s.width,a.height=s.height,o.x=0,o.y=0,o.width=s.width/this._scaleX,o.height=s.height/this._scaleY}i.postApply(this),PO.width=this._visibleRect.width,PO.height=this._visibleRect.height,IO&&IO.init(this._visibleRect),this.emit("design-resolution-changed")}else O(2200)},n.getDesignResolutionSize=function(){return new ri(this._designResolutionSize.width,this._designResolutionSize.height)},n.setRealPixelResolution=function(t,e,n){this.setDesignResolutionSize(t,e,n)},n.getViewportRect=function(){return this._viewportRect},n.getScaleX=function(){return this._scaleX},n.getScaleY=function(){return this._scaleY},n.getDevicePixelRatio=function(){return Cu.devicePixelRatio},n.convertToLocationInView=function(t,e,n,i){void 0===i&&(i=new Qn);var r=Cu.devicePixelRatio*(t-n.left),a=Cu.devicePixelRatio*(n.top+n.height-e);return Cu.isFrameRotated?(i.x=Eu.windowSize.width-a,i.y=r):(i.x=r,i.y=a),i},n._convertToUISpace=function(t){var e=this._viewportRect;t.x=(t.x-e.x)/this._scaleX,t.y=(t.y-e.y)/this._scaleY},n._updateAdaptResult=function(){var t;h.director.root.resize(Eu.windowSize.width,Eu.windowSize.height);var e=this._designResolutionSize.width,n=this._designResolutionSize.height;e>0&&this.setDesignResolutionSize(e,n,this._resolutionPolicy),this.emit("canvas-resize"),null===(t=this._resizeCallback)||void 0===t||t.call(this)},e}(uh));RO.instance=void 0;var MO=function(){function t(){this.name="ContainerStrategy"}var e=t.prototype;return e.preApply=function(){},e.apply=function(){},e.postApply=function(){},e._setupCanvas=function(){var t=bO.canvas;if(t){var e=Eu.windowSize;t.width=e.width,t.height=e.height}},t}();MO.EQUAL_TO_FRAME=void 0,MO.PROPORTION_TO_FRAME=void 0;var OO=function(){function t(){this.name="ContentStrategy",this._result=void 0,this._result={scale:[1,1],viewport:null}}var e=t.prototype;return e.preApply=function(){},e.apply=function(){return{scale:[1,1]}},e.postApply=function(){},e._buildResult=function(t,e,n,i,r,a){Math.abs(t-n)<2&&(n=t),Math.abs(e-i)<2&&(i=e);var o=new oi(Math.round((t-n)/2),Math.round((e-i)/2),n,i);return this._result.scale=[r,a],this._result.viewport=o,this._result},t}();OO.EXACT_FIT=void 0,OO.SHOW_ALL=void 0,OO.NO_BORDER=void 0,OO.FIXED_HEIGHT=void 0,OO.FIXED_WIDTH=void 0,function(){var t=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="EqualToFrame",e}return $(e,t),e.prototype.apply=function(){Cu.isProportionalToFrame=!1,this._setupCanvas()},e}(MO),e=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="ProportionalToFrame",e}return $(e,t),e.prototype.apply=function(){Cu.isProportionalToFrame=!0,this._setupCanvas()},e}(MO);MO.EQUAL_TO_FRAME=new t,MO.PROPORTION_TO_FRAME=new e;var n=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="ExactFit",e}return $(e,t),e.prototype.apply=function(t,e){var n=Eu.windowSize,i=n.width,r=n.height,a=i/e.width,o=r/e.height;return this._buildResult(i,r,i,r,a,o)},e}(OO),i=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="ShowAll",e}return $(e,t),e.prototype.apply=function(t,e){var n,i,r=Eu.windowSize,a=r.width,o=r.height,s=e.width,c=e.height,l=a/s,h=o/c,u=0;return l<h?(n=a,i=c*(u=l)):(n=s*(u=h),i=o),this._buildResult(a,o,n,i,u,u)},e}(OO),r=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="NoBorder",e}return $(e,t),e.prototype.apply=function(t,e){var n,i,r,a=Eu.windowSize,o=a.width,s=a.height,c=e.width,l=e.height,h=o/c,u=s/l;return h<u?(i=c*(n=u),r=s):(i=o,r=l*(n=h)),this._buildResult(o,s,i,r,n,n)},e}(OO),a=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="FixedHeight",e}return $(e,t),e.prototype.apply=function(t,e){var n=Eu.windowSize,i=n.width,r=n.height,a=r/e.height,o=i,s=r;return this._buildResult(i,r,o,s,a,a)},e}(OO),o=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).name="FixedWidth",e}return $(e,t),e.prototype.apply=function(t,e){var n=Eu.windowSize,i=n.width,r=n.height,a=i/e.width,o=i,s=r;return this._buildResult(i,r,o,s,a,a)},e}(OO);OO.EXACT_FIT=new n,OO.SHOW_ALL=new i,OO.NO_BORDER=new r,OO.FIXED_HEIGHT=new a,OO.FIXED_WIDTH=new o}();var NO=t("ResolutionPolicy",function(){function t(t,e){this.name="ResolutionPolicy",this._containerStrategy=void 0,this._contentStrategy=void 0,this._containerStrategy=null,this._contentStrategy=null,this.setContainerStrategy(t),this.setContentStrategy(e)}var e=t.prototype;return e.preApply=function(t){this._contentStrategy.preApply(t)},e.apply=function(t,e){return this._containerStrategy.apply(t,e),this._contentStrategy.apply(t,e)},e.postApply=function(t){this._contentStrategy.postApply(t)},e.setContainerStrategy=function(t){t instanceof MO&&(this._containerStrategy=t)},e.setContentStrategy=function(t){t instanceof OO&&(this._contentStrategy=t)},Q(t,[{key:"canvasSize",get:function(){return Eu.windowSize}}]),t}());NO.EXACT_FIT=0,NO.NO_BORDER=1,NO.SHOW_ALL=2,NO.FIXED_HEIGHT=3,NO.FIXED_WIDTH=4,NO.UNKNOWN=5,NO.ContainerStrategy=MO,NO.ContentStrategy=OO,h.ResolutionPolicy=NO;var BO=t("view",RO.instance=h.view=new RO);h.winSize=PO,U(RO.prototype,"View.prototype",[{name:"isAntiAliasEnabled",suggest:"The API of Texture2d have been largely modified, no alternative"},{name:"enableAntiAlias",suggest:"The API of Texture2d have been largely modified, no alternative"}]),G(RO.prototype,"View.prototype",[{name:"adjustViewportMeta"},{name:"enableAutoFullScreen",suggest:"use screen.requestFullScreen() instead."},{name:"isAutoFullScreenEnabled"},{name:"setCanvasSize",suggest:"setting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"getCanvasSize",suggest:"please use screen.windowSize instead."},{name:"getFrameSize",suggest:"getting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"setFrameSize",suggest:"setting size in CSS pixels is not recommended, please use screen.windowSize instead."},{name:"getDevicePixelRatio",suggest:"use screen.devicePixelRatio instead."},{name:"convertToLocationInView"},{name:"enableRetina"},{name:"isRetinaEnabled"}]),G(h,"cc",[{name:"winSize",suggest:"please use view.getVisibleSize() instead."}]),G(wu,"sys",[{name:"capabilities",suggest:"please use sys.hasFeature() method instead."}]),k(wu,"sys",["UNKNOWN","ENGLISH","CHINESE","FRENCH","ITALIAN","GERMAN","SPANISH","DUTCH","RUSSIAN","KOREAN","JAPANESE","HUNGARIAN","PORTUGUESE","ARABIC","NORWEGIAN","POLISH","TURKISH","UKRAINIAN","ROMANIAN","BULGARIAN"].map((function(t){return{name:"LANGUAGE_"+t,newName:t,target:wu.Language,targetName:"sys.Language"}}))),k(wu,"sys",["UNKNOWN","IOS","ANDROID","WINDOWS","LINUX","OSX"].map((function(t){return{name:"OS_"+t,newName:t,target:wu.OS,targetName:"sys.OS"}}))),k(wu,"sys",["UNKNOWN","WECHAT","ANDROID","IE","EDGE","QQ","MOBILE_QQ","UC","UCBS","BAIDU_APP","BAIDU","MAXTHON","OPERA","OUPENG","MIUI","FIREFOX","SAFARI","CHROME","LIEBAO","QZONE","SOUGOU","HUAWEI"].map((function(t){return{name:"BROWSER_TYPE_"+t,newName:t,target:wu.BrowserType,targetName:"sys.BrowserType"}}))),k(wu,"sys",[{name:"BROWSER_TYPE_360",newName:"BROWSER_360",target:wu.BrowserType,targetName:"sys.BrowserType"}]),k(wu,"sys",["UNKNOWN","EDITOR_PAGE","EDITOR_CORE","MOBILE_BROWSER","DESKTOP_BROWSER","WIN32","MACOS","IOS","ANDROID","OHOS","WECHAT_GAME","BAIDU_MINI_GAME","XIAOMI_QUICK_GAME","ALIPAY_MINI_GAME","BYTEDANCE_MINI_GAME","OPPO_MINI_GAME","VIVO_MINI_GAME","HUAWEI_QUICK_GAME","COCOSPLAY","LINKSURE_MINI_GAME","QTT_MINI_GAME"].map((function(t){return{name:t,target:wu.Platform,targetName:"sys.Platform"}}))),k(wu,"sys",[{name:"IPHONE",newName:"IOS",target:wu.Platform,targetName:"sys.Platform"},{name:"IPAD",newName:"IOS",target:wu.Platform,targetName:"sys.Platform"}]),U(wu,"sys",["LINUX","BLACKBERRY","NACL","EMSCRIPTEN","TIZEN","WINRT","WP8","QQ_PLAY","FB_PLAYABLE_ADS"].map((function(t){return{name:t}}))),k(wu,"sys",[{name:"windowPixelResolution",target:Eu,targetName:"screen",newName:"windowSize"}]),G(Eu,"screen",[{name:"autoFullScreen",suggest:"please use screen.requestFullScreen() instead."},{name:"disableAutoFullScreen"}]);var LO=function(){function t(){this.name="",this.base="",this.importBase="",this.nativeBase="",this.deps=null,this.assetInfos=new yl,this.scenes=new yl,this.paths=new yl}var e=t.prototype;return e.init=function(t){var e=this;!function(t){var e=t.uuids,n=t.paths,i=t.types,r=t.deps,a=t.paths=Object.create(null);if(!1===t.debug){for(var o=0,s=e.length;o<s;o++)e[o]=Ll(e[o]);for(var c in n){var l=n[c],h=l[1];l[1]=i[h]}}else{for(var u=Object.create(null),_=0,f=e.length;_<f;_++){var d=e[_];e[_]=u[d]=Ll(d)}e=u}for(var p in n){var m=n[p];a[e[p]]=m}var v=t.scenes;for(var g in v){var y=v[g];v[g]=e[y]}var x=t.packs;for(var S in x)for(var A=x[S],b=0;b<A.length;++b)A[b]=e[A[b]];var C=t.versions;if(C)for(var T in C)for(var E=C[T],w=0;w<E.length;w+=2){var I=E[w];E[w]=e[I]||I}var P=t.redirect;if(P)for(var D=0;D<P.length;D+=2)P[D]=e[P[D]],P[D+1]=r[P[D+1]];if(t.extensionMap){var R=function(n){if(!Object.prototype.hasOwnProperty.call(t.extensionMap,n))return"continue";t.extensionMap[n].forEach((function(i,r){t.extensionMap[n][r]=e[i]||i}))};for(var M in t.extensionMap)R(M)}}(t),this.importBase=t.importBase||"",this.nativeBase=t.nativeBase||"",this.base=t.base||"",this.name=t.name||"",this.deps=t.deps||[],this._initUuid(t.uuids),this._initPath(t.paths),this._initScene(t.scenes),this._initPackage(t.packs),this._initVersion(t.versions),this._initRedirect(t.redirect);var n=function(n){if(!Object.prototype.hasOwnProperty.call(t.extensionMap,n))return"continue";t.extensionMap[n].forEach((function(t){var i=e.assetInfos.get(t);i&&(i.extension=n)}))};for(var i in t.extensionMap)n(i)},e.getInfoWithPath=function(t,e){if(!t)return null;t=Ul(t);var n=this.paths.get(t);if(n){if(!e)return n[0];for(var i=0,r=n.length;i<r;i++){var a=n[i];if(re.isChildClassOf(a.ctor,e))return a}}return null},e.getDirWithPath=function(t,e,n){"/"===(t=Ul(t))[t.length-1]&&(t=t.slice(0,-1));var i=n||[];return this.paths.forEach((function(n,r){if(r.startsWith(t)&&function(t,e){return!(t.length>e.length)||47===t.charCodeAt(e.length)}(r,t)||!t)for(var a=0,o=n.length;a<o;a++){var s=n[a];e&&!re.isChildClassOf(s.ctor,e)||i.push(s)}})),i},e.getAssetInfo=function(t){return this.assetInfos.get(t)||null},e.getSceneInfo=function(t){return t.endsWith(".scene")||(t+=".scene"),"/"===t[0]||t.startsWith("db://")||(t="/"+t),this.scenes.find((function(e,n){return n.endsWith(t)}))},e.destroy=function(){this.paths.destroy(),this.scenes.destroy(),this.assetInfos.destroy()},e._initUuid=function(t){if(t){this.assetInfos.clear();for(var e=0,n=t.length;e<n;e++){var i=t[e];this.assetInfos.add(i,{uuid:i})}}},e._initPath=function(t){if(t){var e=this.paths;for(var n in e.clear(),t){var i=t[n],r=i[0],a=i[1],o=3===i.length,s=this.assetInfos.get(n);s.path=r,s.ctor=re._getClassById(a),e.has(r)?o?e.get(r).push(s):e.get(r).unshift(s):e.add(r,[s])}}},e._initScene=function(t){if(t){var e=this.scenes;e.clear();var n=this.assetInfos;for(var i in t){var r=t[i],a=n.get(r);a.url=i,e.add(i,a)}}},e._initPackage=function(t){if(t){var e=this.assetInfos;for(var n in t){var i=t[n],r={uuid:n,packedUuids:i,ext:".json"};e.add(n,r);for(var a=0,o=i.length;a<o;a++){var s=i[a],c=e.get(s),l=c.packs;l?1===o?l.unshift(r):l.push(r):c.packs=[r]}}}},e._initVersion=function(t){if(t){var e=this.assetInfos,n=t.import;if(n)for(var i=0,r=n.length;i<r;i+=2){var a=n[i];e.get(a).ver=n[i+1]}if(n=t.native)for(var o=0,s=n.length;o<s;o+=2){var c=n[o];e.get(c).nativeVer=n[o+1]}}},e._initRedirect=function(t){if(t)for(var e=this.assetInfos,n=0,i=t.length;n<i;n+=2){var r=t[n];e.get(r).redirect=t[n+1]}},t}();function FO(t,e){t._uuid&&e.push(t._uuid)}function VO(t,e){for(var n=Object.getOwnPropertyNames(t),i=0;i<n.length;i++){var r=n[i];if("node"!==r&&"__eventTargets"!==r){var a=t[r];if("object"==typeof a&&a)if(Array.isArray(a))for(var o=0;o<a.length;o++){var s=a[o];s instanceof $h&&FO(s,e)}else if(a.constructor&&a.constructor!==Object)a instanceof $h&&FO(a,e);else for(var c=Object.getOwnPropertyNames(a),l=0;l<c.length;l++){var h=a[c[l]];h instanceof $h&&FO(h,e)}}}}function zO(t,e){for(var n=0;n<t._components.length;n++)VO(t._components[n],e);for(var i=0;i<t._children.length;i++)zO(t._children[i],e)}function kO(t,e,n,i){n.push(t._uuid);for(var r=pv.getDeps(t._uuid),a=0,o=r.length;a<o;a++){var s=Al.get(r[a]);if(s){var c=s._uuid;c in e?e[c]+=i:e[c]=s.refCount+i,n.includes(c)||kO(s,e,n,i)}}}var UO=[],GO=new(function(){function t(){this._persistNodeDeps=new yl,this._toDelete=new yl,this._eventListener=!1}var e=t.prototype;return e.init=function(){this._persistNodeDeps.clear(),this._toDelete.clear()},e._addPersistNodeRef=function(t){var e=[];zO(t,e);for(var n=0,i=e.length;n<i;n++){var r=Al.get(e[n]);r&&r.addRef()}this._persistNodeDeps.add(t.uuid,e)},e._removePersistNodeRef=function(t){if(this._persistNodeDeps.has(t.uuid)){for(var e=this._persistNodeDeps.get(t.uuid),n=0,i=e.length;n<i;n++){var r=Al.get(e[n]);r&&r.decRef()}this._persistNodeDeps.remove(t.uuid)}},e._autoRelease=function(t,e,n){if(t){for(var i=pv.getDeps(t.uuid),r=0,a=i.length;r<a;r++){var o=Al.get(i[r]);o&&o.decRef(t.autoReleaseAssets)}var s=pv._depends.get(t.uuid);if(s&&s.persistDeps)for(var c=s.persistDeps,l=0,h=c.length;l<h;l++){var u=Al.get(c[l]);u&&u.decRef(t.autoReleaseAssets)}t.uuid!==e.uuid&&pv.remove(t.uuid)}var _=pv._depends.get(e.uuid);for(var f in _&&(_.persistDeps=[]),n){for(var d,p,m=n[f],v=this._persistNodeDeps.get(m.uuid),g=st(v);!(p=g()).done;){var y=p.value,x=Al.get(y);x&&x.addRef()}_&&(d=_.persistDeps).push.apply(d,v)}},e.tryRelease=function(t,e){void 0===e&&(e=!1),t instanceof $h&&(e?this._free(t,e):(this._toDelete.add(t._uuid,t),this._eventListener||(this._eventListener=!0,Ae(this._freeAssets.bind(this)))))},e._freeAssets=function(){var t=this;this._eventListener=!1,this._toDelete.forEach((function(e){t._free(e)})),this._toDelete.clear()},e._free=function(t,e){void 0===e&&(e=!1);var n=t._uuid;if(this._toDelete.remove(n),gl(t,!0)&&!(!e&&t.refCount>0&&function(t){var e=Object.create(null);if(e[t._uuid]=t.refCount,kO(t,e,UO,-1),UO.length=0,0!==e[t._uuid])return e[t._uuid];for(var n in e)0!==e[n]&&kO(Al.get(n),e,UO,1);return UO.length=0,e[t._uuid]}(t)>0)){Al.remove(n);for(var i=pv.getDeps(n),r=0,a=i.length;r<a;r++){var o=Al.get(i[r]);o&&(o.decRef(!1),this._free(o,!1))}t.destroy(),pv.remove(n)}},t}()),HO=null;function jO(t,e){for(var n=0,i=t.input.length;n<i;n++){var r=t.input[n];e&&!r.isNative&&r.content instanceof $h&&r.content.decRef(!1),r.recycle()}t.input=null}function WO(t,e){return e?/\?/.test(t)?t+"&_t="+Date.now():t+"?_t="+Date.now():t}function qO(t,e,n,i,r){void 0===r&&(r=0),t(r,(function(a,o){r++,!a||r>e?i&&i(a,o):setTimeout((function(){qO(t,e,n,i,r)}),n)}))}function XO(t,e,n,i,r){try{for(var a=pv.parse(t,e),o=0,s=a.deps.length;o<s;o++){var c=a.deps[o];c in n||(n[c]=!0,i.push({uuid:c,bundle:r&&r.name}))}a.nativeDep&&(r&&(a.nativeDep.bundle=r.name),i.push(Z({},a.nativeDep)))}catch(t){A(t.message,t.stack)}}function YO(t,e,n){e&&(n=void 0!==n?n:h.assetManager.cacheAsset,kl(e)||!n||e.isDefault||Al.add(t,e))}function KO(t,e,n){var i=0,r=[],a=t.length;0===a&&n&&n(r);for(var o=function(t){t&&r.push(t),++i===a&&n&&n(r)},s=0;s<a;s++)e(t[s],o)}function JO(t,e,n){var i=t,r=e,a=n;if(void 0===n){var o="function"==typeof t;e?(a=e,o||(r=null)):void 0===e&&o&&(a=t,i=null,r=null),void 0!==e&&o&&(r=t,i=null)}return{options:i||Object.create(null),onProgress:r,onComplete:a}}function QO(t,e,n){var i=t,r=e,a=n;if(void 0===n){var o=re.isChildClassOf(t,$h);e?(a=e,o&&(r=null)):void 0!==e||o||(a=t,r=null,i=null),void 0===e||o||(r=t,i=null)}return{type:i,onProgress:r||HO,onComplete:a}}function ZO(t,e,n,i){if(void 0===i&&(i={}),!n[e]||i[e])return!1;i[e]=!0;var r=!1,a=pv.getDeps(e);if(a)for(var o=0,s=a.length;o<s;o++){var c=a[o];if(c===t||ZO(t,c,n,i)){r=!0;break}}return r}function $O(t){return function(e,n){if(t){var i=[];Array.isArray(n)?n.forEach((function(t){return t instanceof $h&&i.push(t.addRef())})):n instanceof $h&&i.push(n.addRef()),Ae((function(){i.forEach((function(t){return t.decRef(!1)})),t(e,n)}))}}}var tN=function(){function t(){this._config=new LO}var e=t.prototype;return e.getInfoWithPath=function(t,e){return this._config.getInfoWithPath(t,e)},e.getDirWithPath=function(t,e,n){return this._config.getDirWithPath(t,e,n)},e.getAssetInfo=function(t){return this._config.getAssetInfo(t)},e.getSceneInfo=function(t){return this._config.getSceneInfo(t)},e.init=function(t){this._config.init(t),Tl.add(t.name,this)},e.load=function(t,e,n,i){var r=QO(e,n,i),a=r.type,o=r.onProgress,s=r.onComplete,c={__requestType__:Sl.PATH,type:a,bundle:this.name,__outputAsArray__:Array.isArray(t)};h.assetManager.loadAny(t,c,o,s)},e.preload=function(t,e,n,i){var r=QO(e,n,i),a=r.type,o=r.onProgress,s=r.onComplete;h.assetManager.preloadAny(t,{__requestType__:Sl.PATH,type:a,bundle:this.name},o,s)},e.loadDir=function(t,e,n,i){var r=QO(e,n,i),a=r.type,o=r.onProgress,s=r.onComplete;h.assetManager.loadAny(t,{__requestType__:Sl.DIR,type:a,bundle:this.name,__outputAsArray__:!0},o,s)},e.preloadDir=function(t,e,n,i){var r=QO(e,n,i),a=r.type,o=r.onProgress,s=r.onComplete;h.assetManager.preloadAny(t,{__requestType__:Sl.DIR,type:a,bundle:this.name},o,s)},e.loadScene=function(t,e,n,i){var r=JO(e,n,i),a=r.options,o=r.onProgress,s=r.onComplete;a.preset=a.preset||"scene",a.bundle=this.name,h.assetManager.loadAny({scene:t},a,o,(function(t,e){if(t)A(t.message,t.stack);else if(e instanceof VR&&e.scene){var n=e.scene;n._id=e._uuid,n.name=e.name}else t=new Error("The asset "+e._uuid+" is not a scene");s&&s(t,e)}))},e.preloadScene=function(t,e,n,i){var r=JO(e,n,i),a=r.options,o=r.onProgress,s=r.onComplete;a.bundle=this.name,h.assetManager.preloadAny({scene:t},a,o,(function(e){e&&O(1210,t,e.message),s&&s(e)}))},e.get=function(t,e){var n=this.getInfoWithPath(t,e);return n&&Al.get(n.uuid)||null},e.release=function(t,e){var n=this.get(t,e);n&&GO.tryRelease(n,!0)},e.releaseUnusedAssets=function(){var t=this;Al.forEach((function(e){var n=t.getAssetInfo(e._uuid);n&&!n.redirect&&GO.tryRelease(e)}))},e.releaseAll=function(){var t=this;Al.forEach((function(e){var n=t.getAssetInfo(e._uuid);n&&!n.redirect&&GO.tryRelease(e,!0)}))},e._destroy=function(){this._config.destroy()},Q(t,[{key:"config",get:function(){return this._config}},{key:"name",get:function(){return this._config.name}},{key:"deps",get:function(){return this._config.deps}},{key:"base",get:function(){return this._config.base}}]),t}(),eN=t("resources",new tN);function nN(t,e,n){var i=new Image;function r(){i.removeEventListener("load",r),i.removeEventListener("error",a),n&&n(null,i)}function a(){i.removeEventListener("load",r),i.removeEventListener("error",a),n&&n(new Error(F(4930,t)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.addEventListener("load",r),i.addEventListener("error",a),i.src=t,i}function iN(t,e,n,i){var r=new XMLHttpRequest,a="download failed: "+t+", status: ";if(r.open("GET",t,!0),void 0!==e.xhrResponseType&&(r.responseType=e.xhrResponseType),void 0!==e.xhrWithCredentials&&(r.withCredentials=e.xhrWithCredentials),void 0!==e.xhrMimeType&&r.overrideMimeType&&r.overrideMimeType(e.xhrMimeType),void 0!==e.xhrTimeout&&(r.timeout=e.xhrTimeout),e.xhrHeader)for(var o in e.xhrHeader)r.setRequestHeader(o,e.xhrHeader[o]);return r.onload=function(){200===r.status||0===r.status?i&&i(null,r.response):i&&i(new Error(""+a+r.status+"(no response)"))},n&&(r.onprogress=function(t){t.lengthComputable&&n(t.loaded,t.total)}),r.onerror=function(){i&&i(new Error(""+a+r.status+"(error)"))},r.ontimeout=function(){i&&i(new Error(""+a+r.status+"(time out)"))},r.onabort=function(){i&&i(new Error(""+a+r.status+"(abort)"))},r.send(null),r}h.resources=eN;var rN={};function aN(t,e,n){if(rN[t])return n&&n(null),null;var i=document.createElement("script");function r(){i.parentNode.removeChild(i),i.removeEventListener("load",r,!1),i.removeEventListener("error",a,!1),rN[t]=!0,n&&n(null)}function a(){i.parentNode.removeChild(i),i.removeEventListener("load",r,!1),i.removeEventListener("error",a,!1),n&&n(new Error(F(4928,t)))}return"file:"!==window.location.protocol&&(i.crossOrigin="anonymous"),i.async=e.scriptAsyncLoading||!1,i.src=t,i.addEventListener("load",r,!1),i.addEventListener("error",a,!1),document.body.appendChild(i),i}var oN=/^(?:\w+:\/\/|\.+\/).+/,sN=function(t,e,n){(wu.hasFeature(wu.Feature.IMAGE_BITMAP)&&h.assetManager.allowImageBitmap?cN:nN)(t,e,n)},cN=function(t,e,n){e.xhrResponseType="blob",iN(t,e,e.onFileProgress,n)},lN=function(t,e,n){e.xhrResponseType="json",iN(t,e,e.onFileProgress,n)},hN=function(t,e,n){e.xhrResponseType="arraybuffer",iN(t,e,e.onFileProgress,n)},uN=function(t,e,n){lN(t,e,(function(e,i){if(e)n(e);else{var r=Ru(i);Promise.all(r.chunks.map((function(n){return new Promise((function(i,r){hN(""+Gh(t)+n,{},(function(t,n){e?r(e):i(new Uint8Array(n))}))}))}))).then((function(t){var e=new Du(r.document,t);n(null,e)})).catch((function(t){n(t)}))}}))},_N=function(t,e,n){hN(t,e,(function(t,e){if(t)n(t);else try{var i=Mu(new Uint8Array(e));n(null,i)}catch(t){n(t)}}))},fN=function(t,e,n){e.xhrResponseType="text",iN(t,e,e.onFileProgress,n)},dN=function(t,e,n){var i=Hh(t),r=t;oN.test(r)||(r=-1!==pN.remoteBundles.indexOf(i)?pN.remoteServerAddress+"remote/"+i:"assets/"+i);var a=e.version||pN.bundleVers[i],o=0,s=null,c=null;lN(r+"/config."+(a?a+".":"")+"json",e,(function(t,e){c=t,(s=e)&&(s.base=r+"/"),2==++o&&n(c,s)})),aN(r+"/index."+(a?a+".":"")+"js",e,(function(t){c=t,2==++o&&n(t,s)}))},pN=new(function(){function t(){this.maxConcurrency=6,this.maxRequestsPerFrame=6,this.maxRetryCount=3,this.appendTimeStamp=!1,this.limited=!0,this.retryInterval=2e3,this.bundleVers=null,this.remoteBundles=[],this.downloadDomImage=nN,this.downloadDomAudio=null,this.downloadFile=iN,this.downloadScript=aN,this._downloaders={".png":sN,".jpg":sN,".bmp":sN,".jpeg":sN,".gif":sN,".ico":sN,".tiff":sN,".webp":sN,".image":sN,".pvr":hN,".pkm":hN,".astc":hN,".txt":fN,".xml":fN,".vsh":fN,".fsh":fN,".atlas":fN,".tmx":fN,".tsx":fN,".json":lN,".ExportJson":lN,".plist":fN,".ccon":uN,".cconb":_N,".fnt":fN,".binary":hN,".bin":hN,".dbbin":hN,".skel":hN,".js":aN,bundle:dN,default:fN},this._downloading=new yl,this._queue=[],this._queueDirty=!1,this._totalNum=0,this._totalNumThisPeriod=0,this._lastDate=-1,this._checkNextPeriod=!1,this._remoteServerAddress="",this._maxInterval=1/30}var e=t.prototype;return e.init=function(t,e,n){void 0===t&&(t=""),void 0===e&&(e={}),void 0===n&&(n=[]),this._downloading.clear(),this._queue.length=0,this._remoteServerAddress=t,this.bundleVers=e,this.remoteBundles=n},e.register=function(t,e){"object"==typeof t?kt(this._downloaders,t):this._downloaders[t]=e},e.download=function(t,e,n,i,r){var a=this,o=bl.get(t);if(o)r(null,o);else{var s=this._downloading.get(t);if(s){s.push(r);var c=this._queue.find((function(e){return e.id===t}));if(!c)return;var l=i.priority||0;c.priority<l&&(c.priority=l,this._queueDirty=!0)}else{var h=void 0!==i.maxRetryCount?i.maxRetryCount:this.maxRetryCount,u=void 0!==i.maxConcurrency?i.maxConcurrency:this.maxConcurrency,_=void 0!==i.maxRequestsPerFrame?i.maxRequestsPerFrame:this.maxRequestsPerFrame,f=this._downloaders[n]||this._downloaders.default;qO((function(n,o){if(0===n&&a._downloading.add(t,[r]),a.limited){a._updateTime();var s=function(t,e){a._totalNum--,a._handleQueueInNextFrame(u,_),o(t,e)};a._totalNum<u&&a._totalNumThisPeriod<_?(f(WO(e,a.appendTimeStamp),i,s),a._totalNum++,a._totalNumThisPeriod++):(a._queue.push({id:t,priority:i.priority||0,url:e,options:i,done:s,handler:f}),a._queueDirty=!0,a._totalNum<u&&a._handleQueueInNextFrame(u,_))}else f(WO(e,a.appendTimeStamp),i,o)}),h,this.retryInterval,(function(e,n){e||bl.add(t,n);for(var i=a._downloading.remove(t),r=0,o=i.length;r<o;r++)i[r](e,n)}))}}},e.loadSubpackage=function(t,e){h.assetManager.loadBundle(t,null,e)},e._updateTime=function(){var t=performance.now(),e=h.game.deltaTime,n=e>this._maxInterval?this._maxInterval:e;t-this._lastDate>1e3*n&&(this._totalNumThisPeriod=0,this._lastDate=t)},e._handleQueue=function(t,e){for(this._checkNextPeriod=!1,this._updateTime();this._queue.length>0&&this._totalNum<t&&this._totalNumThisPeriod<e;){this._queueDirty&&(this._queue.sort((function(t,e){return t.priority-e.priority})),this._queueDirty=!1);var n=this._queue.pop();if(!n)break;this._totalNum++,this._totalNumThisPeriod++,n.handler(WO(n.url,this.appendTimeStamp),n.options,n.done)}this._handleQueueInNextFrame(t,e)},e._handleQueueInNextFrame=function(t,e){!this._checkNextPeriod&&this._queue.length>0&&(Ae(this._handleQueue.bind(this),t,e),this._checkNextPeriod=!0)},Q(t,[{key:"remoteServerAddress",get:function(){return this._remoteServerAddress}}]),t}());function mN(t,e,n,i){var r=null,a=null;try{(r=new lv)._nativeUrl=t,r._nativeAsset=e}catch(t){a=t}i(a,r)}function vN(t,e,n,i){var r=new jR;r.json=e,i(null,r)}function gN(t,e,n,i){var r=new HR;r.text=e,i(null,r)}function yN(t,e,n,i){var r=new dw;r._nativeUrl=t,r._nativeAsset=e,i(null,r)}function xN(t,e,n,i){var r=new $h;r._nativeUrl=t,r._nativeAsset=e,i(null,r)}function SN(t,n,i,r){var a=Tl.get(n.name);a||(a=n.name===Pl.RESOURCES?eN:new tN,n.base=n.base||t+"/",a.init(n)),e.import("virtual:///prerequisite-imports/"+a.name).then((function(){r(null,a)})).catch(r)}var AN=new(function(){function t(){this._creating=new yl,this._producers={".png":mN,".jpg":mN,".bmp":mN,".jpeg":mN,".gif":mN,".ico":mN,".tiff":mN,".webp":mN,".image":mN,".pvr":mN,".pkm":mN,".txt":gN,".xml":gN,".vsh":gN,".fsh":gN,".atlas":gN,".tmx":gN,".tsx":gN,".fnt":gN,".json":vN,".ExportJson":vN,".binary":yN,".bin":yN,".dbbin":yN,".skel":yN,bundle:SN,default:xN}}var e=t.prototype;return e.register=function(t,e){"object"==typeof t?re.mixin(this._producers,t):this._producers[t]=e},e.create=function(t,e,n,i,r){var a=this,o=this._producers[n]||this._producers.default,s=Al.get(t);if(i.reloadAsset||!s){var c=this._creating.get(t);c?c.push(r):(this._creating.add(t,[r]),o(t,e,i,(function(e,n){!e&&n instanceof $h&&(n._uuid=t,YO(t,n,i.cacheAsset));for(var r=a._creating.remove(t),o=0,s=r.length;o<s;o++)r[o](e,n)})))}else r(null,s)},t}()),bN=new(function(){function t(){this._loading=new yl,this._unpackers={".json":this.unpackJson}}var e=t.prototype;return e.unpackJson=function(t,e,n,i){var r=re.createMap(!0),a=null;if(Array.isArray(e)){(e=function(t){if(t[0]<1)throw new Error(F(5304,t[0]));Qu(t,!0,void 0,$u.reportMissingClass),Zu(t);for(var e=new t_(t[0]),n=t[1],i=t[2],r=t[3],a=t[4],o=t[5],s=0;s<o.length;++s)o[s].unshift(e,n,i,r,a);return o}(e)).length!==t.length&&O(4915);for(var o=0;o<t.length;o++)r[t[o]+"@import"]=e[o]}else{var s=re._getClassId(Mv),c=re._getClassId(lv);if(e.type===s&&e.data){var l=e.data;l.length!==t.length&&O(4915);for(var h=0;h<t.length;h++)r[t[h]+"@import"]=e_(s,{base:l[h][0],mipmaps:l[h][1]})}else if(e.type===c&&e.data){var u=e.data;u.length!==t.length&&O(4915);for(var _=0;_<t.length;_++)r[t[_]+"@import"]=u[_]}else a=new Error("unmatched type pack!"),r=null}i(a,r)},e.init=function(){this._loading.clear()},e.register=function(t,e){"object"==typeof t?re.mixin(this._unpackers,t):this._unpackers[t]=e},e.unpack=function(t,e,n,i,r){e?(0,this._unpackers[n])(t,e,i,r):r(new Error("package data is wrong!"))},e.load=function(t,e,n){var i=this;if(!t.isNative&&t.info&&t.info.packs)if(bl.has(t.id))n(null,bl.get(t.id));else{var r=t.info.packs,a=r.find((function(t){return i._loading.has(t.uuid)}));if(a)this._loading.get(a.uuid).push({onComplete:n,id:t.id});else{a=r[0],this._loading.add(a.uuid,[{onComplete:n,id:t.id}]);var o=Gl(a.uuid,{ext:a.ext,bundle:t.config.name});pN.download(a.uuid,o,a.ext,t.options,(function(e,n){bl.remove(a.uuid),e&&A(e.message,e.stack),i.unpack(a.packedUuids,n,a.ext,t.options,(function(t,n){if(!t)for(var r in n)bl.add(r,n[r]);for(var o=i._loading.remove(a.uuid),s=0,c=o.length;s<c;s++){var l=o[s];if(e||t)l.onComplete(e||t);else{var h=n[l.id];h?l.onComplete(null,h):l.onComplete(new Error("can not retrieve data from package"))}}}))}))}}else pN.download(t.id,t.url,t.ext,t.options,n)},t}());function CN(t,e){var n=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},n=!0);var i=t.options,r=t.progress,a=[],o=r.total,s=i.__exclude__=i.__exclude__||Object.create(null);t.output=[],KO(t.input,(function(i,c){if(!i.isNative&&Al.has(i.uuid)){var l=Al.get(i.uuid);return i.content=l.addRef(),t.output.push(i),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,i),void c()}bN.load(i,t.options,(function(l,u){l?t.isFinish||(!h.assetManager.force||n?(A(l.message,l.stack),r.canInvoke=!1,e(l)):(t.output.push(i),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,i))):t.isFinish||(i.file=u,t.output.push(i),i.isNative||(s[i.uuid]=!0,XO(i.uuid,u,s,a,i.config),r.total=o+a.length),r.canInvoke&&t.dispatch("progress",++r.finish,r.total,i)),c()}))}),(function(){if(t.isFinish)return jO(t,!0),void t.dispatch("error");if(a.length>0){var o=Rl.create({input:a,progress:r,options:i,onProgress:t.onProgress,onError:Rl.prototype.recycle,onComplete:function(i){var r;i||((r=t.output).push.apply(r,o.output),o.recycle()),n&&TN(t),e(i)}});wl.async(o)}else n&&TN(t),e()}))}function TN(t){for(var e=t.output,n=0,i=e.length;n<i;n++)e[n].content&&e[n].content.decRef(!1)}var EN=function(){function t(){this._parser=null,window.DOMParser&&(this._parser=new DOMParser)}var e=t.prototype;return e.parse=function(t){return this._parseXML(t)},e._parseXML=function(t){if(this._parser)return this._parser.parseFromString(t,"text/xml");throw new Error("Dom parser is not supported in this platform!")},t}(),wN=new(function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.parse=function(t){var e=this._parseXML(t).documentElement;if("plist"!==e.tagName)return R(5100),{};for(var n=null,i=0,r=e.childNodes.length;i<r&&1!==(n=e.childNodes[i]).nodeType;i++);return this._parseNode(n)},n._parseNode=function(t){var e=null,n=t.tagName;if("dict"===n)e=this._parseDict(t);else if("array"===n)e=this._parseArray(t);else if("string"===n)if(1===t.childNodes.length)e=t.firstChild.nodeValue;else{e="";for(var i=0;i<t.childNodes.length;i++)e+=t.childNodes[i].nodeValue}else"false"===n?e=!1:"true"===n?e=!0:"real"===n?e=parseFloat(t.firstChild.nodeValue):"integer"===n&&(e=parseInt(t.firstChild.nodeValue,10));return e},n._parseArray=function(t){for(var e=[],n=0,i=t.childNodes.length;n<i;n++){var r=t.childNodes[n];1===r.nodeType&&e.push(this._parseNode(r))}return e},n._parseDict=function(t){for(var e={},n="",i=0,r=t.childNodes.length;i<r;i++){var a=t.childNodes[i];1===a.nodeType&&("key"===a.tagName?n=a.firstChild.nodeValue:e[n]=this._parseNode(a))}return e},e}(EN));function IN(t,e){return t[e]<<8|t[e+1]}var PN=new(function(){function t(){this._parsing=new yl,this._parsers={".png":this.parseImage,".jpg":this.parseImage,".bmp":this.parseImage,".jpeg":this.parseImage,".gif":this.parseImage,".ico":this.parseImage,".tiff":this.parseImage,".webp":this.parseImage,".image":this.parseImage,".pvr":this.parsePVRTex,".pkm":this.parsePKMTex,".astc":this.parseASTCTex,".plist":this.parsePlist,import:this.parseImport,".ccon":this.parseImport,".cconb":this.parseImport}}var e=t.prototype;return e.parseImage=function(t,e,n){t instanceof HTMLImageElement?n(null,t):createImageBitmap(t,{premultiplyAlpha:"none"}).then((function(t){n(null,t)}),(function(t){n(t,null)}))},e.parsePVRTex=function(t,e,n){var i=null,r=null;try{var a=t instanceof ArrayBuffer?t:t.buffer,o=new Int32Array(a,0,13);if(55727696===o[0]){var s=o[7],c=o[6],l=o[12]+52;r={_data:new Uint8Array(a,l),_compressed:!0,width:s,height:c,format:0}}else{if(559044176!==o[11])throw new Error("Invalid magic number in PVR header");var h=o[0],u=o[1],_=o[2];r={_data:new Uint8Array(a,h),_compressed:!0,width:_,height:u,format:0}}}catch(t){i=t}n(i,r)},e.parsePKMTex=function(t,e,n){var i=null,r=null;try{var a=t instanceof ArrayBuffer?t:t.buffer,o=new Uint8Array(a),s=IN(o,6);if(0!==s&&1!==s&&3!==s)throw new Error("Invalid magic number in ETC header");var c=IN(o,12),l=IN(o,14);IN(o,8),IN(o,10),r={_data:new Uint8Array(a,16),_compressed:!0,width:c,height:l,format:0}}catch(t){i=t}n(i,r)},e.parseASTCTex=function(t,e,n){var i=null,r=null;try{var a=t instanceof ArrayBuffer?t:t.buffer,o=new Uint8Array(a);if(1554098963!==o[0]+(o[1]<<8)+(o[2]<<16)+(o[3]<<24))throw new Error("Invalid magic number in ASTC header");var s=o[4],c=o[5],l=o[6];if((s<3||s>6||c<3||c>6||l<3||l>6)&&(s<4||7===s||9===s||11===s||s>12||c<4||7===c||9===c||11===c||c>12||1!==l))throw new Error("Invalid block number in ASTC header");var h=function(t,e){return 4===t?km.RGBA_ASTC_4x4:5===t?4===e?km.RGBA_ASTC_5x4:km.RGBA_ASTC_5x5:6===t?5===e?km.RGBA_ASTC_6x5:km.RGBA_ASTC_6x6:8===t?5===e?km.RGBA_ASTC_8x5:6===e?km.RGBA_ASTC_8x6:km.RGBA_ASTC_8x8:10===t?5===e?km.RGBA_ASTC_10x5:6===e?km.RGBA_ASTC_10x6:8===e?km.RGBA_ASTC_10x8:km.RGBA_ASTC_10x10:10===e?km.RGBA_ASTC_12x10:km.RGBA_ASTC_12x12}(s,c),u=o[7]+(o[8]<<8)+(o[9]<<16),_=o[10]+(o[11]<<8)+(o[12]<<16);o[13],o[14],o[15],r={_data:new Uint8Array(a,16),_compressed:!0,width:u,height:_,format:h}}catch(t){i=t}n(i,r)},e.parsePlist=function(t,e,n){var i=null,r=wN.parse(t);r||(i=new Error("parse failed")),n(i,r)},e.parseImport=function(t,e,n){if(t){var i=null,r=null;try{i=fv(t,e)}catch(t){r=t}n(r,i)}else n(new Error("The json file of asset "+e.__uuid__+" is empty or missing"))},e.init=function(){this._parsing.clear()},e.register=function(t,e){"object"==typeof t?kt(this._parsers,t):this._parsers[t]=e},e.parse=function(t,e,n,i,r){var a=this,o=Cl.get(t);if(o)r(null,o);else{var s=this._parsing.get(t);if(s)s.push(r);else{var c=this._parsers[n];c?(this._parsing.add(t,[r]),c(e,i,(function(e,n){e?bl.remove(t):kl(n)||Cl.add(t,n);for(var i=a._parsing.remove(t),r=0,o=i.length;r<o;r++)i[r](e,n)}))):r(null,e)}}},t}());function DN(t,e){var n=!1;t.progress||(t.progress={finish:0,total:t.input.length,canInvoke:!0},n=!0);var i=t.options,r=t.progress;i.__exclude__=i.__exclude__||Object.create(null),t.output=[],KO(t.input,(function(a,o){var s=Rl.create({input:a,onProgress:t.onProgress,options:i,progress:r,onComplete:function(i,c){i&&!t.isFinish&&(!h.assetManager.force||n?(A(i.message,i.stack),r.canInvoke=!1,e(i)):r.canInvoke&&t.dispatch("progress",++r.finish,r.total,a)),t.output.push(c),s.recycle(),o(null)}});RN.async(s)}),(function(){if(i.__exclude__=null,t.isFinish)return jO(t,!0),void t.dispatch("error");!function(t){var e=t.source;if(t.options.__outputAsArray__||1!==e.length)for(var n=t.output=[],i=0,r=e.length;i<r;i++)n.push(e[i].content);else t.output=e[0].content}(t),jO(t,!0),e()}))}var RN=new xl("loadOneAsset",[function(t,e){var n=t.output=t.input,i=n.options,r=n.isNative,a=n.uuid,o=n.file,s=i.reloadAsset;o||!s&&!r&&Al.has(a)?e():bN.load(n,t.options,(function(t,i){n.file=i,e(t)}))},function(t,e){var n=t.output=t.input,i=t.progress,r=t.options.__exclude__,a=n.id,o=n.file,s=n.options;if(n.isNative)PN.parse(a,o,n.ext,s,(function(r,o){r?e(r):(n.content=o,i.canInvoke&&t.dispatch("progress",++i.finish,i.total,n),bl.remove(a),Cl.remove(a),e())}));else{var c=n.uuid;if(c in r){var l=r[c],h=l.finish,u=l.content,_=l.err,f=l.callbacks;i.canInvoke&&t.dispatch("progress",++i.finish,i.total,n),h||ZO(c,c,r)?(u&&u.addRef(),n.content=u,e(_)):f.push({done:e,item:n})}else if(!s.reloadAsset&&Al.has(c)){var d=Al.get(c);n.content=d.addRef(),i.canInvoke&&t.dispatch("progress",++i.finish,i.total,n),e()}else s.__uuid__=c,PN.parse(a,o,"import",s,(function(n,i){n?e(n):function(t,e,n){var i=t.input,r=t.progress,a=i,o=a.uuid,s=a.id,c=a.options,l=a.config,h=c.cacheAsset,u=[];e.addRef&&e.addRef(),XO(o,e,Object.create(null),u,l),r.canInvoke&&t.dispatch("progress",++r.finish,r.total+=u.length,i);var _=t.options.__exclude__[o]={content:e,finish:!1,callbacks:[{done:n,item:i}]},f=Rl.create({input:u,options:t.options,onProgress:t.onProgress,onError:Rl.prototype.recycle,progress:r,onComplete:function(t){if(e.decRef&&e.decRef(!1),_.finish=!0,_.err=t,!t){for(var n,i=Array.isArray(f.output)?f.output:[f.output],r=Object.create(null),a=st(i);!(n=a()).done;){var c=n.value;c&&(r[c instanceof $h?c._uuid+"@import":o+"@native"]=c)}!function(t,e,n){var i=hv.get(e);if(i){for(var r=0,a=i.length;r<a;r++){var o=i[r],s=n[o.uuid+"@import"];if(s)o.owner[o.prop]=s.addRef();else{if(A("The asset "+o.uuid+" is missing!"),o.type&&o.type!==$h){var c=new o.type;c.initDefault(o.uuid),o.owner[o.prop]=c}!0}}hv.delete(e)}uv.has(e)&&(n[t+"@native"]?e._nativeAsset=n[t+"@native"]:(!0,console.error("the native asset of "+t+" is missing!")),uv.delete(e))}(o,e,r);try{"function"!=typeof e.onLoaded||_v.has(e)||uv.has(e)||(e.onLoaded(),_v.add(e))}catch(t){A("The asset "+o+" is invalid for some reason, detail message: "+t.message+", stack: "+t.stack)}bl.remove(s),Cl.remove(s),YO(o,e,h),f.recycle()}for(var l=_.callbacks,u=0,d=l.length;u<d;u++){var p=l[u];e.addRef&&e.addRef(),p.item.content=e,p.done(t)}l.length=0}});El.async(f)}(t,i,e)}))}}]);function MN(t,e){var n=t.options,i=Object.create(null),r=Object.create(null);for(var a in n)switch(a){case Sl.PATH:case Sl.UUID:case Sl.DIR:case Sl.SCENE:case Sl.URL:break;case"__requestType__":case"__isNative__":case"ext":case"type":case"__nativeName__":case"audioLoadMode":case"bundle":i[a]=n[a];break;case"__exclude__":case"__outputAsArray__":r[a]=n[a];break;default:i[a]=n[a],r[a]=n[a]}t.options=r;var o=Rl.create({input:t.input,options:i}),s=null;try{t.output=t.source=Il.sync(o)}catch(t){s=t;for(var c=0,l=o.output.length;c<l;c++)o.output[c].recycle()}o.recycle(),e(s)}var ON=function(){function t(){this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),this._id=""}return t.create=function(){return 0!==t._deadPool.length?t._deadPool.pop():new t},t.prototype.recycle=function(){t._deadPool.length!==t.MAX_DEAD_NUM&&(this._id="",this.uuid="",this.url="",this.ext=".json",this.content=null,this.file=null,this.info=null,this.config=null,this.isNative=!1,this.options=Object.create(null),t._deadPool.push(this))},Q(t,[{key:"id",get:function(){return this._id||(this._id=this.uuid+"@"+(this.isNative?"native":"import")),this._id}}]),t}();ON.MAX_DEAD_NUM=500,ON._deadPool=[];var NN=[];function BN(t){var e=t.options,n=Array.isArray(t.input)?t.input:[t.input];t.output=[];for(var i=function(i){var r,a=n[i],o=ON.create(),s=null,c=null;if("string"==typeof a&&((a=Object.create(null))[e.__requestType__||Sl.UUID]=n[i]),"object"==typeof a)for(var l in zt(a,e),a.preset&&zt(a,Dl[a.preset]),a){switch(l){case Sl.UUID:if("break"===function(){var t,e=o.uuid=Ll(a.uuid);if(!a.bundle){var n=Tl.find((function(t){return!!t.getAssetInfo(e)}));a.bundle=n&&n.name}if(Tl.has(a.bundle)){if(s=Tl.get(a.bundle).config,(c=s.getAssetInfo(e))&&c.redirect){if(!Tl.has(c.redirect))throw new Error("Please load bundle "+c.redirect+" first");s=Tl.get(c.redirect).config,c=s.getAssetInfo(e)}o.config=s,o.info=c}return o.ext=a.ext||(null===(t=c)||void 0===t?void 0:t.extension)||".json","break"}())break;case"__requestType__":case"ext":case"bundle":case"preset":case"type":break;case Sl.DIR:if(Tl.has(a.bundle)){Tl.get(a.bundle).config.getDirWithPath(a.dir,a.type,NN);for(var h,u=st(NN);!(h=u()).done;){var _=h.value;n.push({uuid:_.uuid,__isNative__:!1,ext:_.extension||".json",bundle:a.bundle})}NN.length=0}o.recycle(),o=null;break;case Sl.PATH:if(Tl.has(a.bundle)){if(s=Tl.get(a.bundle).config,(c=s.getInfoWithPath(a.path,a.type))&&c.redirect){if(!Tl.has(c.redirect))throw new Error("you need to load bundle "+c.redirect+" first");s=Tl.get(c.redirect).config,c=s.getAssetInfo(c.uuid)}if(!c)throw o.recycle(),new Error("Bundle "+a.bundle+" doesn't contain "+a.path);o.config=s,o.uuid=c.uuid,o.info=c}o.ext=a.ext||(null===(r=c)||void 0===r?void 0:r.extension)||".json";break;case Sl.SCENE:if(!a.bundle){var f=Tl.find((function(t){return!!t.getSceneInfo(a.scene)}));a.bundle=f&&f.name}if(Tl.has(a.bundle)){if(s=Tl.get(a.bundle).config,(c=s.getSceneInfo(a.scene))&&c.redirect){if(!Tl.has(c.redirect))throw new Error("you need to load bundle "+c.redirect+" first");s=Tl.get(c.redirect).config,c=s.getAssetInfo(c.uuid)}if(!c)throw o.recycle(),new Error("Bundle "+s.name+" doesn't contain scene "+a.scene);o.config=s,o.uuid=c.uuid,o.info=c}break;case"__isNative__":o.isNative=a.__isNative__;break;case Sl.URL:o.url=a.url,o.uuid=a.uuid||a.url,o.ext=a.ext||Uh(a.url),o.isNative=void 0===a.__isNative__||a.__isNative__;break;default:o.options[l]=a[l]}if(!o)break}if(!o)return"continue";if(t.output.push(o),!o.uuid&&!o.url)throw new Error("Can not parse this input:"+JSON.stringify(a))},r=0;r<n.length;r++)i(r);return null}function LN(t){for(var e=t.output=t.input,n=0;n<e.length;n++){var i=e[n];if(!i.url){var r,a,o=i.config;a=i.isNative?o&&o.nativeBase?o.base+o.nativeBase:h.assetManager.generalNativeBase:o&&o.importBase?o.base+o.importBase:h.assetManager.generalImportBase;var s=i.uuid,c="";i.info&&(c=i.isNative?i.info.nativeVer?"."+i.info.nativeVer:"":i.info.ver?"."+i.info.ver:""),r=".ttf"===i.ext?a+"/"+s.slice(0,2)+"/"+s+c+"/"+i.options.__nativeName__:a+"/"+s.slice(0,2)+"/"+s+c+i.ext,i.url=r}}return null}var FN=t("AssetManager",function(){function t(){this.pipeline=El.append(MN).append(DN),this.fetchPipeline=wl.append(MN).append(CN),this.transformPipeline=Il.append(BN).append(LN),this.bundles=Tl,this.assets=Al,this.generalImportBase="",this.generalNativeBase="",this.dependUtil=pv,this.force=!1,this.allowImageBitmap=!wu.isMobile,this.utils=Hl,this.downloader=pN,this.parser=PN,this.packManager=bN,this.cacheAsset=!0,this.cacheManager=null,this.presets=Dl,this.factory=AN,this.preprocessPipe=MN,this.fetchPipe=CN,this.loadPipe=DN,this.references=null,this._releaseManager=GO,this._files=bl,this._parsed=Cl,this._parsePipeline=null}var e=t.prototype;return e.init=function(t){void 0===t&&(t={}),this._files.clear(),this._parsed.clear(),this._releaseManager.init(),this.assets.clear(),this.bundles.clear(),this.packManager.init(),this.downloader.init(t.server,t.bundleVers,t.remoteBundles),this.parser.init(),this.dependUtil.init();var e=t.importBase||"";e&&e.endsWith("/")&&(e=e.substr(0,e.length-1));var n=t.nativeBase||"";n&&n.endsWith("/")&&(n=n.substr(0,n.length-1)),this.generalImportBase=e,this.generalNativeBase=n},e.getBundle=function(t){return Tl.get(t)||null},e.removeBundle=function(t){t._destroy(),Tl.remove(t.name)},e.loadAny=function(t,e,n,i){var r=JO(e,n,i),a=r.options,o=r.onProgress,s=r.onComplete;a.preset=a.preset||"default",t=Array.isArray(t)?t.slice():t;var c=Rl.create({input:t,onProgress:o,onComplete:$O(s),options:a});El.async(c)},e.preloadAny=function(t,e,n,i){var r=JO(e,n,i),a=r.options,o=r.onProgress,s=r.onComplete;a.preset=a.preset||"preload",t=Array.isArray(t)?t.slice():t;var c=Rl.create({input:t,onProgress:o,onComplete:$O(s),options:a});wl.async(c)},e.loadRemote=function(t,e,n){var i=JO(e,void 0,n),r=i.options,a=i.onComplete;r.reloadAsset||!this.assets.has(t)?(r.__isNative__=!0,r.preset=r.preset||"remote",this.loadAny({url:t},r,null,(function(e,n){e?(A(e.message,e.stack),a&&a(e,n)):AN.create(t,n,r.ext||Uh(t),r,(function(t,e){a&&a(t,e)}))}))):$O(a)(null,this.assets.get(t))},e.loadBundle=function(t,e,n){var i=JO(e,void 0,n),r=i.options,a=i.onComplete,o=Hh(t);this.bundles.has(o)?$O(a)(null,this.getBundle(o)):(r.preset=r.preset||"bundle",r.ext="bundle",r.__isNative__=!0,this.loadAny({url:t},r,null,(function(e,n){e?(A(e.message,e.stack),a&&a(e,n)):AN.create(t,n,"bundle",r,(function(t,e){a&&a(t,e)}))})))},e.releaseAsset=function(t){GO.tryRelease(t,!0)},e.releaseUnusedAssets=function(){Al.forEach((function(t){GO.tryRelease(t)}))},e.releaseAll=function(){Al.forEach((function(t){GO.tryRelease(t,!0)}))},e.loadWithJson=function(){throw new Error("Only valid in Editor")},Q(t,[{key:"main",get:function(){return Tl.get(Pl.MAIN)||null}},{key:"resources",get:function(){return Tl.get(Pl.RESOURCES)||null}}]),t}());FN.Pipeline=xl,FN.Task=Rl,FN.Cache=yl,FN.RequestItem=ON,FN.Bundle=tN,FN.BuiltinBundleName=Pl;var VN=t("assetManager",h.assetManager=new FN);h.AssetManager=FN;var zN=[".png",".jpg",".bmp",".jpeg",".gif",".ico",".tiff",".webp",".image",".pvr",".pkm",".astc"],kN=[".mp3",".ogg",".wav",".m4a"];function UN(){return!0}var GN={transformURL:function(t){var e=Vl(t);if(!e)return t;var n=Tl.find((function(t){return!!t.getAssetInfo(e)}));if(!n)return t;var i,r=n.getAssetInfo(e);if(!(i=t.startsWith(n.base+n.config.nativeBase)?r.nativeVer||"":r.ver||"")||-1!==t.indexOf(i))return t;var a=!1;if(".ttf"===Uh(t)&&(a=!0),a){var o=jh(t),s=Hh(t);t=o+"."+i+"/"+s}else t=t.replace(/.*[/\\][0-9a-fA-F]{2}[/\\]([0-9a-fA-F-@]{8,})/,(function(t){return t+"."+i}));return t}},HN=t("CCLoader",function(){function t(){this._autoReleaseSetting=Object.create(null),this._parseLoadResArgs=QO}var e=t.prototype;return e.load=function(t,e,n){void 0===n&&void 0!==e&&(n=e,e=null);for(var i=Array.isArray(t)?t:[t],r=0;r<i.length;r++){var a=i[r];"string"==typeof a?i[r]={url:a,__isNative__:!0}:(a.type&&(a.ext="."+a.type,a.type=void 0),a.url&&(a.__isNative__=!0))}var o=[],s=[];VN.loadAny(i,null,(function(t,n,i){i.content&&(zN.includes(i.ext)?o.push(i.content):kN.includes(i.ext)&&s.push(i.content)),e&&e(t,n,i)}),(function(t,e){var r=null;if(!t){e=Array.isArray(e)?e:[e];for(var a=function(t){var n=e[t];if(!(n instanceof $h)){var r=n,a=i[t].url;o.includes(r)?AN.create(a,n,".png",{},(function(n,i){r=e[t]=i})):s.includes(r)&&AN.create(a,n,".mp3",{},(function(n,i){r=e[t]=i})),Al.add(a,r)}},c=0;c<e.length;c++)a(c);if(e.length>1){var l=Object.create(null);e.forEach((function(t){l[t._uuid]=t})),r={isCompleted:UN,_map:l}}else r=e[0]}n&&n(t,r)}))},e.getXMLHttpRequest=function(){return new XMLHttpRequest},e.getItem=function(t){return VN.assets.has(t)?{content:VN.assets.get(t)}:null},e.loadRes=function(t,e,n,i){var r=this._parseLoadResArgs(e,n,i),a=r.type,o=r.onProgress,s=r.onComplete,c=Uh(t);c&&!eN.getInfoWithPath(t,a)&&(t=t.slice(0,-c.length)),eN.load(t,a,o,s)},e.loadResArray=function(t,e,n,i){var r=this._parseLoadResArgs(e,n,i),a=r.type,o=r.onProgress,s=r.onComplete;t.forEach((function(e,n){var i=Uh(e);i&&!eN.getInfoWithPath(e,a)&&(t[n]=e.slice(0,-i.length))})),eN.load(t,a,o,s)},e.loadResDir=function(t,e,n,i){var r=this._parseLoadResArgs(e,n,i),a=r.type,o=r.onProgress,s=r.onComplete;eN.loadDir(t,a,o,(function(e,n){var i=[];e||(i=eN.getDirWithPath(t,a).map((function(t){return t.path}))),s&&s(e,n,i)}))},e.getRes=function(t,e){return Al.has(t)?Al.get(t):eN.get(t,e)},e.getResCount=function(){return Al.count},e.getDependsRecursively=function(t){if(!t)return[];var e="string"==typeof t?t:t._uuid;return pv.getDepsRecursively(e).concat([e])},e.addDownloadHandlers=function(t){var e=Object.create(null),n=function(n){var i=t[n];e["."+n]=function(t,e,n){i({url:t},n)}};for(var i in t)n(i);pN.register(e)},e.addLoadHandlers=function(t){var e=Object.create(null),n=function(n){var i=t[n];e["."+n]=function(t,e,n){i({content:t},n)}};for(var i in t)n(i);PN.register(e)},e.release=function(t){if(Array.isArray(t))for(var e=0;e<t.length;e++){var n=t[e];"string"==typeof n&&(n=Al.get(n)),VN.releaseAsset(n)}else t&&("string"==typeof t&&(t=Al.get(t)),VN.releaseAsset(t))},e.releaseAsset=function(t){VN.releaseAsset(t)},e.releaseRes=function(t,e){eN.release(t,e)},e.releaseAll=function(){VN.releaseAll(),Al.clear()},e.removeItem=function(t){return!!Al.remove(t)},e.setAutoRelease=function(t,e){"object"==typeof t&&(t=t._uuid),this._autoReleaseSetting[t]=!!e},e.setAutoReleaseRecursively=function(t,e){"object"==typeof t&&(t=t._uuid),e=!!e,this._autoReleaseSetting[t]=e;for(var n=pv.getDepsRecursively(t),i=0;i<n.length;i++)this._autoReleaseSetting[n[i]]=e},e.isAutoRelease=function(t){return"object"==typeof t&&(t=t._uuid),!!this._autoReleaseSetting[t]},Q(t,[{key:"onProgress",set:function(t){HO=t}},{key:"_cache",get:function(){if(Al instanceof yl)return Al._map;var t={};return Al.forEach((function(e,n){t[n]=e})),t}},{key:"md5Pipe",get:function(){return GN}},{key:"downloader",get:function(){return pN}},{key:"loader",get:function(){return VN.parser}}]),t}()),jN=t("loader",new HN),WN=t("AssetLibrary",{init:function(t){t.importBase=t.libraryPath,t.nativeBase=t.rawAssetsBase,VN.init(t),t.rawAssets&&eN.init({base:"",deps:[],scenes:{},redirect:[],debug:!0,packs:{},types:[],versions:{import:[],native:[]},name:Pl.RESOURCES,importBase:t.importBase,nativeBase:t.nativeBase,paths:t.rawAssets.assets,uuids:Object.keys(t.rawAssets.assets),extensionMap:{}})},loadAsset:function(t,e){VN.loadAny(t,e)}}),qN=t("url",{});k(qN,"url",[{name:"normalize",target:VN.utils,targetName:"assetManager.utils",newName:"normalize"},{name:"raw",targetName:"Asset.prototype",newName:"nativeUrl",customFunction:function(t){return t.startsWith("resources/")?Gl({path:Wh(t.substr(10)),bundle:Pl.RESOURCES,__isNative__:!0,ext:Uh(t)}):""}}]),U(WN,"AssetLibrary",[{name:"getLibUrlNoExt",suggest:"AssetLibrary.getLibUrlNoExt was removed, if you want to transform url, please use assetManager.utils.getUrlWithUuid instead"},{name:"queryAssetInfo",suggest:"AssetLibrary.queryAssetInfo was removed"}]),U(jN,"loader",[{name:"releaseResDir",suggest:"loader.releaseResDir was removed, please use assetManager.releaseAsset instead"},{name:"flowInDeps",suggest:"loader.flowInDeps was removed"},{name:"assetLoader",suggest:"loader.assetLoader was removed, assetLoader and md5Pipe were merged into assetManager.transformPipeline"}]),k(h,"cc",[{name:"loader",newName:"assetManager",logTimes:1,customGetter:function(){return jN}},{name:"AssetLibrary",newName:"assetManager",logTimes:1,customGetter:function(){return WN}},{name:"Pipeline",target:FN,targetName:"AssetManager",newName:"Pipeline",logTimes:1},{name:"url",targetName:"assetManager",newName:"utils",logTimes:1,customGetter:function(){return qN}}]),U(h,"cc",[{name:"LoadingItems",suggest:F(1400,"LoadingItems","AssetManager.Task")}]),k(_e,"macro",[{name:"DOWNLOAD_MAX_CONCURRENT",target:pN,targetName:"assetManager.downloader",newName:"maxConcurrency"}]),k(TO,"director",[{name:"_getSceneUuid",targetName:"assetManager.main",newName:"getSceneInfo",customFunction:function(t){var e;return VN.main?null===(e=VN.main.getSceneInfo(t))||void 0===e?void 0:e.uuid:""}}]),k(bO,"game",[{name:"_sceneInfos",targetName:"assetManager.main",newName:"getSceneInfo",customGetter:function(){var t=[];return VN.main&&VN.main.config.scenes.forEach((function(e){t.push(e)})),t}}]);var XN,YN,KN,JN,QN,ZN,$N,tB,eB,nB,iB,rB,aB,oB,sB=GO._autoRelease;GO._autoRelease=function(t,e,n){sB.call(GO,t,e,n);for(var i=jN._autoReleaseSetting,r=Object.keys(i),a=0;a<r.length;a++){var o=r[a];if(!0===i[o]){var s=Al.get(o);s&&GO.tryRelease(s)}}};var cB,lB,hB,uB,_B,fB,dB,pB,mB,vB,gB,yB,xB,SB,AB,bB,CB,TB,EB,wB,IB,PB,DB,RB,MB,OB,NB,BB,LB,FB,VB,zB,kB,UB,GB,HB,jB,WB,qB,XB,YB,KB,JB,QB,ZB,$B,tL,eL,nL,iL,rL,aL,oL,sL,cL,lL,hL,uL,_L,fL,dL,pL,mL,vL,gL,yL,xL,SL,AL,bL,CL=t("EventHandler",(XN=Ec("cc.ClickEvent"),YN=cl(h.Node),KN=Kc(),JN=Kc(),QN=Kc(),ZN=Kc(),XN((oB=function(){function t(){ct(this,"target",eB,this),ct(this,"component",nB,this),ct(this,"_componentId",iB,this),ct(this,"handler",rB,this),ct(this,"customEventData",aB,this)}t.emitEvents=function(e){for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];for(var a=0,o=e.length;a<o;a++){var s=e[a];s instanceof t&&s.emit(i)}};var e=t.prototype;return e.emit=function(t){var e=this.target;if(h.isValid(e)){this._genCompIdIfNeeded();var n=h.js._getClassById(this._componentId),i=e.getComponent(n);if(h.isValid(i)){var r=i[this.handler];"function"==typeof r&&(null!=this.customEventData&&""!==this.customEventData&&(t=t.slice()).push(this.customEventData),r.apply(i,t))}}},e._compName2Id=function(t){var e=h.js.getClassByName(t);return h.js._getClassId(e)},e._compId2Name=function(t){var e=h.js._getClassById(t);return h.js.getClassName(e)},e._genCompIdIfNeeded=function(){this._componentId||(this._componentName=this.component,this.component="")},Q(t,[{key:"_componentName",get:function(){return this._genCompIdIfNeeded(),this._compId2Name(this._componentId)},set:function(t){this._componentId=this._compName2Id(t)}}]),t}(),eB=lt((tB=oB).prototype,"target",[Nc,YN,Nc,KN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nB=lt(tB.prototype,"component",[Nc,Wc,JN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),iB=lt(tB.prototype,"_componentId",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),rB=lt(tB.prototype,"handler",[Nc,Wc,QN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),aB=lt(tB.prototype,"customEventData",[Nc,Wc,ZN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),$N=tB))||$N));h.Component.EventHandler=CL;var TL,EL,wL,IL,PL,DL,RL,ML,OL,NL,BL=new Mn,LL=se(_g),FL=se(ug),VL=se(fg),zL=se(pg),kL=se(dg),UL=se({SKYBOX:Cg|Zi.DEPTH_STENCIL,SOLID_COLOR:Zi.ALL,DEPTH_ONLY:Zi.DEPTH_STENCIL,DONT_CLEAR:Zi.NONE}),GL=(cB=Ec("cc.Camera"),lB=jc(),hB=kc(),uB=el(),_B=Kc(),fB=cl(Hd.BitMask),dB=el(),pB=Kc(),mB=cl(UL),vB=el(),gB=Kc(),yB=el(),xB=Kc(),SB=el(),AB=Kc(),bB=el(),CB=Kc(),TB=cl(LL),EB=el(),wB=Kc(),IB=cl(FL),PB=el(),DB=qc(),RB=Kc(),MB=el(),OB=qc(),NB=Kc(),BB=el(),LB=qc(),FB=Kc(),VB=el(),zB=Kc(),kB=el(),UB=Kc(),GB=cl(VL),HB=el(),jB=Kc(),WB=cl(zL),qB=el(),XB=Kc(),YB=cl(kL),KB=el(),JB=Kc(),QB=el(),ZB=Kc(),$B=cl(tb),tL=el(),eL=Kc(),TL=cB(nL=lB(nL=hB(nL=zc((bL=AL=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_projection",rL,at(e)),ct(e,"_priority",aL,at(e)),ct(e,"_fov",oL,at(e)),ct(e,"_fovAxis",sL,at(e)),ct(e,"_orthoHeight",cL,at(e)),ct(e,"_near",lL,at(e)),ct(e,"_far",hL,at(e)),ct(e,"_color",uL,at(e)),ct(e,"_depth",_L,at(e)),ct(e,"_stencil",fL,at(e)),ct(e,"_clearFlags",dL,at(e)),ct(e,"_rect",pL,at(e)),ct(e,"_aperture",mL,at(e)),ct(e,"_shutter",vL,at(e)),ct(e,"_iso",gL,at(e)),ct(e,"_screenScale",yL,at(e)),ct(e,"_visibility",xL,at(e)),ct(e,"_targetTexture",SL,at(e)),e._camera=null,e._inEditorMode=!1,e._flows=void 0,e}$(e,t);var n=e.prototype;return n.onLoad=function(){this._createCamera()},n.onEnable=function(){this.node.hasChangedFlags|=Fy.POSITION,this._camera&&this._attachToScene()},n.onDisable=function(){this._camera&&this._detachFromScene()},n.onDestroy=function(){this._camera&&(this._camera.destroy(),this._camera=null),this._targetTexture&&this._targetTexture.off("resize")},n.screenPointToRay=function(t,e,n){return n||(n=ao.create()),this._camera&&this._camera.screenPointToRay(n,t,e),n},n.worldToScreen=function(t,e){return e||(e=new Mn),this._camera&&this._camera.worldToScreen(e,t),e},n.screenToWorld=function(t,e){return e||(e=this.node.getWorldPosition()),this._camera&&this._camera.screenToWorld(e,t),e},n.convertToUINode=function(t,e,n){if(n||(n=new Mn),!this._camera)return n;this.worldToScreen(t,BL);var i=e.getComponent("cc.UITransform"),r=BO.getVisibleSize(),a=BL.x-.5*this._camera.width,o=BL.y-.5*this._camera.height;return BL.x=a/h.view.getScaleX()+.5*r.width,BL.y=o/h.view.getScaleY()+.5*r.height,i&&i.convertToNodeSpaceAR(BL,n),n},n._createCamera=function(){this._camera||(this._camera=h.director.root.createCamera(),this._camera.initialize({name:this.node.name,node:this.node,projection:this._projection,window:this._inEditorMode?h.director.root&&h.director.root.mainWindow:h.director.root&&h.director.root.tempWindow,priority:this._priority}),this._camera.setViewportInOrientedSpace(this._rect),this._camera.fovAxis=this._fovAxis,this._camera.fov=dn(this._fov),this._camera.orthoHeight=this._orthoHeight,this._camera.nearClip=this._near,this._camera.farClip=this._far,this._camera.clearColor=this._color,this._camera.clearDepth=this._depth,this._camera.clearStencil=this._stencil,this._camera.clearFlag=this._clearFlags,this._camera.visibility=this._visibility,this._camera.aperture=this._aperture,this._camera.shutter=this._shutter,this._camera.iso=this._iso),this._updateTargetTexture()},n._attachToScene=function(){this.node.scene&&this._camera&&(this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera),this._getRenderScene().addCamera(this._camera))},n._detachFromScene=function(){this._camera&&this._camera.scene&&this._camera.scene.removeCamera(this._camera)},n._checkTargetTextureEvent=function(t){var e=this;t&&t.off("resize"),this._targetTexture&&this._targetTexture.on("resize",(function(t){e._camera&&e._camera.setFixedSize(t.width,t.height)}),this)},n._updateTargetTexture=function(){if(this._camera&&this._targetTexture){var t=this._targetTexture.window;this._camera.changeTargetWindow(t),this._camera.setFixedSize(t.width,t.height)}},Q(e,[{key:"camera",get:function(){return this._camera}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority=t,this._camera&&(this._camera.priority=t)}},{key:"visibility",get:function(){return this._visibility},set:function(t){this._visibility=t,this._camera&&(this._camera.visibility=t)}},{key:"clearFlags",get:function(){return this._clearFlags},set:function(t){this._clearFlags=t,this._camera&&(this._camera.clearFlag=t)}},{key:"clearColor",get:function(){return this._color},set:function(t){this._color.set(t),this._camera&&(this._camera.clearColor=this._color)}},{key:"clearDepth",get:function(){return this._depth},set:function(t){this._depth=t,this._camera&&(this._camera.clearDepth=t)}},{key:"clearStencil",get:function(){return this._stencil},set:function(t){this._stencil=t,this._camera&&(this._camera.clearStencil=t)}},{key:"projection",get:function(){return this._projection},set:function(t){this._projection=t,this._camera&&(this._camera.projectionType=t)}},{key:"fovAxis",get:function(){return this._fovAxis},set:function(t){t!==this._fovAxis&&(this._fovAxis=t,this._camera&&(this._camera.fovAxis=t,t===ug.VERTICAL?this.fov=this._fov*this._camera.aspect:this.fov=this._fov/this._camera.aspect))}},{key:"fov",get:function(){return this._fov},set:function(t){this._fov=t,this._camera&&(this._camera.fov=dn(t))}},{key:"orthoHeight",get:function(){return this._orthoHeight},set:function(t){this._orthoHeight=t,this._camera&&(this._camera.orthoHeight=t)}},{key:"near",get:function(){return this._near},set:function(t){this._near=t,this._camera&&(this._camera.nearClip=t)}},{key:"far",get:function(){return this._far},set:function(t){this._far=t,this._camera&&(this._camera.farClip=t)}},{key:"aperture",get:function(){return this._aperture},set:function(t){this._aperture=t,this._camera&&(this._camera.aperture=t)}},{key:"shutter",get:function(){return this._shutter},set:function(t){this._shutter=t,this._camera&&(this._camera.shutter=t)}},{key:"iso",get:function(){return this._iso},set:function(t){this._iso=t,this._camera&&(this._camera.iso=t)}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect=t,this._camera&&this._camera.setViewportInOrientedSpace(t)}},{key:"targetTexture",get:function(){return this._targetTexture},set:function(t){if(this._targetTexture!==t){var n=this._targetTexture;this._targetTexture=t,this._checkTargetTextureEvent(n),this._updateTargetTexture(),!t&&this._camera&&(this._camera.changeTargetWindow(null),this._camera.isWindowSize=!0),this.node.emit(e.TARGET_TEXTURE_CHANGE,this)}}},{key:"screenScale",get:function(){return this._screenScale},set:function(t){this._screenScale=t,this._camera&&(this._camera.screenScale=t)}},{key:"inEditorMode",get:function(){return this._inEditorMode},set:function(t){this._inEditorMode=t,this._camera&&this._camera.changeTargetWindow(t?h.director.root&&h.director.root.mainWindow:h.director.root&&h.director.root.tempWindow)}}]),e}(xu),AL.ProjectionType=LL,AL.FOVAxis=FL,AL.ClearFlag=UL,AL.Aperture=VL,AL.Shutter=zL,AL.ISO=kL,AL.TARGET_TEXTURE_CHANGE="tex-change",rL=lt((iL=bL).prototype,"_projection",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return LL.PERSPECTIVE}}),aL=lt(iL.prototype,"_priority",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),oL=lt(iL.prototype,"_fov",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),sL=lt(iL.prototype,"_fovAxis",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return FL.VERTICAL}}),cL=lt(iL.prototype,"_orthoHeight",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),lL=lt(iL.prototype,"_near",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),hL=lt(iL.prototype,"_far",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),uL=lt(iL.prototype,"_color",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn("#333333")}}),_L=lt(iL.prototype,"_depth",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),fL=lt(iL.prototype,"_stencil",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),dL=lt(iL.prototype,"_clearFlags",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return UL.SOLID_COLOR}}),pL=lt(iL.prototype,"_rect",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new oi(0,0,1,1)}}),mL=lt(iL.prototype,"_aperture",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return VL.F16_0}}),vL=lt(iL.prototype,"_shutter",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return zL.D125}}),gL=lt(iL.prototype,"_iso",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return kL.ISO100}}),yL=lt(iL.prototype,"_screenScale",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),xL=lt(iL.prototype,"_visibility",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return am}}),SL=lt(iL.prototype,"_targetTexture",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lt(iL.prototype,"priority",[uB,_B],Object.getOwnPropertyDescriptor(iL.prototype,"priority"),iL.prototype),lt(iL.prototype,"visibility",[fB,dB,pB],Object.getOwnPropertyDescriptor(iL.prototype,"visibility"),iL.prototype),lt(iL.prototype,"clearFlags",[mB,vB,gB],Object.getOwnPropertyDescriptor(iL.prototype,"clearFlags"),iL.prototype),lt(iL.prototype,"clearColor",[yB,xB],Object.getOwnPropertyDescriptor(iL.prototype,"clearColor"),iL.prototype),lt(iL.prototype,"clearDepth",[SB,AB],Object.getOwnPropertyDescriptor(iL.prototype,"clearDepth"),iL.prototype),lt(iL.prototype,"clearStencil",[bB,CB],Object.getOwnPropertyDescriptor(iL.prototype,"clearStencil"),iL.prototype),lt(iL.prototype,"projection",[TB,EB,wB],Object.getOwnPropertyDescriptor(iL.prototype,"projection"),iL.prototype),lt(iL.prototype,"fovAxis",[IB,PB,DB,RB],Object.getOwnPropertyDescriptor(iL.prototype,"fovAxis"),iL.prototype),lt(iL.prototype,"fov",[MB,OB,NB],Object.getOwnPropertyDescriptor(iL.prototype,"fov"),iL.prototype),lt(iL.prototype,"orthoHeight",[BB,LB,FB],Object.getOwnPropertyDescriptor(iL.prototype,"orthoHeight"),iL.prototype),lt(iL.prototype,"near",[VB,zB],Object.getOwnPropertyDescriptor(iL.prototype,"near"),iL.prototype),lt(iL.prototype,"far",[kB,UB],Object.getOwnPropertyDescriptor(iL.prototype,"far"),iL.prototype),lt(iL.prototype,"aperture",[GB,HB,jB],Object.getOwnPropertyDescriptor(iL.prototype,"aperture"),iL.prototype),lt(iL.prototype,"shutter",[WB,qB,XB],Object.getOwnPropertyDescriptor(iL.prototype,"shutter"),iL.prototype),lt(iL.prototype,"iso",[YB,KB,JB],Object.getOwnPropertyDescriptor(iL.prototype,"iso"),iL.prototype),lt(iL.prototype,"rect",[QB,ZB],Object.getOwnPropertyDescriptor(iL.prototype,"rect"),iL.prototype),lt(iL.prototype,"targetTexture",[$B,tL,eL],Object.getOwnPropertyDescriptor(iL.prototype,"targetTexture"),iL.prototype),nL=iL))||nL)||nL)||nL)||nL,t({Camera:TL,CameraComponent:TL}),TL);h.Camera=GL;var HL={parent:null,owner:null,subModelIdx:0},jL=t("RenderableComponent",(EL=Ec("cc.RenderableComponent"),wL=cl(vg),IL=el(),PL=Yc(),DL=cl([vg]),EL((lt((ML=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_visFlags",OL,at(e)),ct(e,"_materials",NL,at(e)),e._materialInstances=[],e._models=[],e}$(e,t);var n=e.prototype;return n.getMaterial=function(t){return t<0||t>=this._materials.length?null:this._materials[t]},n.setMaterial=function(t,e){t&&t instanceof wy&&console.error("Can't set a material instance to a sharedMaterial slot"),this._materials[e]=t;var n=this._materialInstances[e];n&&(n.destroy(),this._materialInstances[e]=null),this._onMaterialModified(e,this._materials[e])},n.getMaterialInstance=function(t){if(!this._materials[t])return null;if(!this._materialInstances[t]){HL.parent=this._materials[t],HL.owner=this,HL.subModelIdx=t;var e=new wy(HL);HL.parent=null,HL.owner=null,HL.subModelIdx=0,this.setMaterialInstance(e,t)}return this._materialInstances[t]},n.setMaterialInstance=function(t,e){if("number"==typeof t){R(12007);var n=t;t=e,e=n}var i=this._materialInstances[e];t&&t.parent?t!==i&&(this._materialInstances[e]=t,this._onMaterialModified(e,t)):(t!==this._materials[e]||i)&&this.setMaterial(t,e)},n.getRenderMaterial=function(t){return this._materialInstances[t]||this._materials[t]},n._collectModels=function(){return this._models},n._attachToScene=function(){},n._detachFromScene=function(){},n._onMaterialModified=function(){},n._onRebuildPSO=function(){},n._clearMaterials=function(){},n._onVisibilityChange=function(){},Q(e,[{key:"visibility",get:function(){return this._visFlags},set:function(t){this._visFlags=t,this._onVisibilityChange(t)}},{key:"sharedMaterial",get:function(){return this.getMaterial(0)}},{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setMaterial(t[e],e);if(t.length<this._materials.length){for(var n=t.length;n<this._materials.length;n++)this.setMaterial(null,n);this._materials.splice(t.length)}}},{key:"material",get:function(){return this.getMaterialInstance(0)},set:function(t){(1!==this._materials.length||this._materialInstances[0]||this._materials[0]!==t)&&this.setMaterialInstance(t,0)}},{key:"materials",get:function(){for(var t=0;t<this._materials.length;t++)this._materialInstances[t]=this.getMaterialInstance(t);return this._materialInstances},set:function(t){for(var e=t.length,n=this._materials.length,i=e;i<n;i++)this.setMaterialInstance(null,i);this._materials.length=e,this._materialInstances.length=e;for(var r=0;r<e;r++)this._materialInstances[r]!=t[r]&&this.setMaterialInstance(t[r],r)}}]),e}(xu)).prototype,"sharedMaterials",[wL,IL,PL],Object.getOwnPropertyDescriptor(ML.prototype,"sharedMaterials"),ML.prototype),OL=lt(ML.prototype,"_visFlags",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Hd.Enum.NONE}}),NL=lt(ML.prototype,"_materials",[DL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),RL=ML))||RL));h.RenderableComponent=jL,k(GL,"Camera",[{name:"CameraClearFlag",newName:"ClearFlag"}]),k(GL.prototype,"Camera.prototype",[{name:"color",newName:"clearColor"},{name:"depth",newName:"clearDepth"},{name:"stencil",newName:"clearStencil"}]),h.CameraComponent=GL,re.setClassAlias(GL,"cc.CameraComponent"),h.math=hi,h.geometry=Ud;var WL=new Mn,qL=new Xn;function XL(t,e,n,i){var r=n.chunk,a=n.data,o=r.vb,s=n.vertexCount;t.getWorldMatrix(qL);for(var c=0,l=0;l<s;l++){var h=a[l];Mn.set(WL,h.x,h.y,0),Mn.transformMat4(WL,WL,qL),o[c++]=WL.x,o[c++]=WL.y,o[c++]=WL.z,Dn.toArray(o,i,c+2),c+=6}for(var u=r.bufferId,_=r.vertexOffset,f=r.vertexAccessor.getMeshBuffer(r.bufferId),d=r.vertexAccessor.getIndexBuffer(u),p=f.indexOffset,m=0,v=s/4;m<v;m++){var g=_+4*m;d[p++]=g,d[p++]=g+1,d[p++]=g+2,d[p++]=g+1,d[p++]=g+3,d[p++]=g+2}f.indexOffset+=n.indexCount,f.setDirty()}var YL=function(){function t(t,e){this._texture=void 0,this._width=void 0,this._height=void 0,this._x=void 0,this._y=void 0,this._nexty=void 0,this._innerTextureInfos={},this._innerSpriteFrames=void 0,this._count=void 0;var n=new KL;n.initWithSize(t,e),this._texture=n,this._width=t,this._height=e,this._x=2,this._y=2,this._nexty=2,this._innerTextureInfos={},this._innerSpriteFrames=[],this._count=0}var e=t.prototype;return e.insertSpriteFrame=function(t){var e=t.rect,n=t.texture,i=this._innerTextureInfos[n.getId()],r=e.x,a=e.y;if(i)r+=i.x,a+=i.y;else{var o=n.width,s=n.height;if(this._x+o+2>this._width&&(this._x=2,this._y=this._nexty),this._y+s+2>this._nexty&&(this._nexty=this._y+s+2),this._nexty>this._height)return null;h.internal.dynamicAtlasManager.textureBleeding&&((o<=8||s<=8)&&(this._texture.drawTextureAt(n.image,this._x-1,this._y-1),this._texture.drawTextureAt(n.image,this._x-1,this._y+1),this._texture.drawTextureAt(n.image,this._x+1,this._y-1),this._texture.drawTextureAt(n.image,this._x+1,this._y+1)),this._texture.drawTextureAt(n.image,this._x-1,this._y),this._texture.drawTextureAt(n.image,this._x+1,this._y),this._texture.drawTextureAt(n.image,this._x,this._y-1),this._texture.drawTextureAt(n.image,this._x,this._y+1)),this._texture.drawTextureAt(n.image,this._x,this._y),this._innerTextureInfos[n.getId()]={x:this._x,y:this._y,texture:n},this._count++,r+=this._x,a+=this._y,this._x+=o+2}var c={x:r,y:a,texture:this._texture};return this._innerSpriteFrames.push(t),c},e.deleteInnerTexture=function(t){t&&this._innerTextureInfos[t.getId()]&&(delete this._innerTextureInfos[t.getId()],this._count--)},e.isEmpty=function(){return this._count<=0},e.reset=function(){this._x=2,this._y=2,this._nexty=2;for(var t=this._innerSpriteFrames,e=0,n=t.length;e<n;e++){var i=t[e];i.isValid&&i._resetDynamicAtlasFrame()}this._innerSpriteFrames.length=0,this._innerTextureInfos={}},e.destroy=function(){this.reset(),this._texture.destroy()},t}(),KL=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.initWithSize=function(t,e,n){void 0===n&&(n=km.RGBA8888),this.reset({width:t,height:e,format:n})},n.drawTextureAt=function(t,e,n){var i=this.getGFXTexture();if(t&&i){var r=this._getGFXDevice();if(r){var a=new _r;a.texOffset.x=e,a.texOffset.y=n,a.texExtent.width=t.width,a.texExtent.height=t.height,r.copyTexImagesToTexture([t.data],i,[a])}else console.warn("Unable to get device")}},e}(Mv),JL=function(){function t(){this._atlases=[],this._atlasIndex=-1,this._maxAtlasCount=5,this._textureSize=2048,this._maxFrameSize=512,this._textureBleeding=!0,this._enabled=!1}var e=t.prototype;return e.newAtlas=function(){var t=this._atlases[++this._atlasIndex];return t||(t=new YL(this._textureSize,this._textureSize),this._atlases.push(t)),t},e.beforeSceneLoad=function(){this.reset()},e.insertSpriteFrame=function(t){if(!this._enabled||this._atlasIndex===this._maxAtlasCount||!t||t._original)return null;if(!t.packable)return null;var e=t.texture.getSamplerInfo();if(e.minFilter!==Gm.LINEAR||e.magFilter!==Gm.LINEAR||e.mipFilter!==Gm.NONE)return null;var n=this._atlases[this._atlasIndex];n||(n=this.newAtlas());var i=n.insertSpriteFrame(t);return i||this._atlasIndex===this._maxAtlasCount?i:(n=this.newAtlas()).insertSpriteFrame(t)},e.reset=function(){for(var t=0,e=this._atlases.length;t<e;t++)this._atlases[t].destroy();this._atlases.length=0,this._atlasIndex=-1},e.deleteAtlasSpriteFrame=function(t){if(t._original){for(var e,n=this._atlases.length-1;n>=0;n--)e=this._atlases[n],re.array.fastRemove(e._innerSpriteFrames,t);var i=t._original._texture;this.deleteAtlasTexture(i)}},e.deleteAtlasTexture=function(t){if(t)for(var e=this._atlases.length-1;e>=0;e--)this._atlases[e].deleteInnerTexture(t),this._atlases[e].isEmpty()&&(this._atlases[e].destroy(),this._atlases.splice(e,1),this._atlasIndex--)},e.packToDynamicAtlas=function(t,e){if(e&&!e._original&&e.packable&&e.texture&&e.texture.width>0&&e.texture.height>0){var n=this.insertSpriteFrame(e);n&&e._setDynamicAtlasFrame(n)}},Q(t,[{key:"enabled",get:function(){return this._enabled},set:function(t){this._enabled!==t&&(t?(this.reset(),h.director.on(h.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)):(this.reset(),h.director.off(h.Director.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)),this._enabled=t)}},{key:"maxAtlasCount",get:function(){return this._maxAtlasCount},set:function(t){this._maxAtlasCount=t}},{key:"atlasCount",get:function(){return this._atlases.length}},{key:"textureBleeding",get:function(){return this._textureBleeding},set:function(t){this._textureBleeding=t}},{key:"textureSize",get:function(){return this._textureSize},set:function(t){this._textureSize=t}},{key:"maxFrameSize",get:function(){return this._maxFrameSize},set:function(t){this._maxFrameSize=t}}]),t}();JL.instance=void 0;var QL,ZL,$L,tF=t("dynamicAtlasManager",JL.instance=new JL);h.internal.dynamicAtlasManager=tF;var eF,nF,iF,rF,aF=[{u:0,v:0},{u:0,v:0},{u:0,v:0},{u:0,v:0}],oF=t("SpriteFrame",Ec("cc.SpriteFrame")(($L=ZL=function(t){function e(){var e;return(e=t.call(this)||this).vertices=null,e.uv=[],e.unbiasUV=[],e.uvSliced=[],e._rect=new oi,e._offset=new Qn,e._originalSize=new ri,e._rotated=!1,e._capInsets=[0,0,0,0],e._atlasUuid="",e._texture=void 0,e._isFlipUVY=!1,e._isFlipUVX=!1,e._original=null,e._packable=!0,e}$(e,t),e.createWithImage=function(t){var n=t instanceof lv?t:new lv(t),i=new Mv;i.image=n;var r=new e;return r.texture=i,r};var n=e.prototype;return n.textureLoaded=function(){return!!this.texture},n.isRotated=function(){return this._rotated},n.setRotated=function(t){this.rotated=t},n.getRect=function(t){return t?(t.set(this._rect),t):this._rect.clone()},n.setRect=function(t){this.rect=t},n.getOriginalSize=function(t){return t?(t.set(this._originalSize),t):this._originalSize.clone()},n.setOriginalSize=function(t){this.originalSize=t},n.getOffset=function(t){return t?(t.set(this._offset),t):this._offset.clone()},n.setOffset=function(t){this.offset=t},n.getGFXTexture=function(){return this._texture.getGFXTexture()},n.getGFXSampler=function(){return this._texture.getGFXSampler()},n.getHash=function(){return this._texture.getHash()},n.getSamplerInfo=function(){return this._texture.getSamplerInfo()},n.reset=function(t,e){void 0===e&&(e=!1);var n=!1;e&&(this._originalSize.set(0,0),this._rect.set(0,0,0,0),this._offset.set(0,0),this._capInsets=[0,0,0,0],this._rotated=!1,n=!0),t&&(t.texture&&(this._rect.x=this._rect.y=0,this._rect.width=t.texture.width,this._rect.height=t.texture.height,this._refreshTexture(t.texture),this.checkRect(this._texture)),t.originalSize&&this._originalSize.set(t.originalSize),t.rect&&this._rect.set(t.rect),t.offset&&this._offset.set(t.offset),void 0!==t.borderTop&&(this._capInsets[1]=t.borderTop),void 0!==t.borderBottom&&(this._capInsets[3]=t.borderBottom),void 0!==t.borderLeft&&(this._capInsets[0]=t.borderLeft),void 0!==t.borderRight&&(this._capInsets[2]=t.borderRight),void 0!==t.isRotate&&(this._rotated=!!t.isRotate),void 0!==t.isFlipUv&&(this._isFlipUVY=!!t.isFlipUv),n=!0),n&&this.texture&&this._calculateUV()},n.checkRect=function(t){var e=this._rect,n=e.x,i=e.y;return this._rotated?(n+=e.height,i+=e.width):(n+=e.width,i+=e.height),n>t.width?(O(3300,this.name+"/"+t.name,n,t.width),!1):!(i>t.height&&(O(3301,this.name+"/"+t.name,i,t.height),1))},n.destroy=function(){return this._packable&&tF&&tF.deleteAtlasSpriteFrame(this),t.prototype.destroy.call(this)},n._calculateSlicedUV=function(){var t=this._rect,n=this.texture,i=n.width,r=n.height,a=this._capInsets[0],o=this._capInsets[2],s=t.width-a-o,c=this._capInsets[1],l=this._capInsets[3],h=t.height-c-l,u=this.uvSliced;if(u.length=0,this._rotated){aF[0].u=t.x/i,aF[1].u=(t.x+l)/i,aF[2].u=(t.x+l+h)/i,aF[3].u=(t.x+t.height)/i,aF[3].v=t.y/r,aF[2].v=(t.y+a)/r,aF[1].v=(t.y+a+s)/r,aF[0].v=(t.y+t.width)/r;for(var _=0;_<4;++_)for(var f=aF[_],d=0;d<4;++d){var p=aF[3-d];u.push({u:f.u,v:p.v})}}else{aF[0].u=t.x/i,aF[1].u=(t.x+a)/i,aF[2].u=(t.x+a+s)/i,aF[3].u=(t.x+t.width)/i,aF[3].v=t.y/r,aF[2].v=(t.y+c)/r,aF[1].v=(t.y+c+h)/r,aF[0].v=(t.y+t.height)/r;for(var m=0;m<4;++m)for(var v=aF[m],g=0;g<4;++g){var y=aF[g];u.push({u:y.u,v:v.v})}}this.emit(e.EVENT_UV_UPDATED,this)},n._calculateUV=function(){var t=this._rect,e=this.uv,n=this.unbiasUV,i=this.texture,r=i.width,a=i.height;if(this._rotated){var o=0===r?0:t.x/r,s=0===r?1:(t.x+t.height)/r,c=0===a?0:t.y/a,l=0===a?1:(t.y+t.width)/a;this._isFlipUVX&&this._isFlipUVY?(e[0]=s,e[1]=l,e[2]=s,e[3]=c,e[4]=o,e[5]=l,e[6]=o,e[7]=c):this._isFlipUVX?(e[0]=s,e[1]=c,e[2]=s,e[3]=l,e[4]=o,e[5]=c,e[6]=o,e[7]=l):this._isFlipUVY?(e[0]=o,e[1]=l,e[2]=o,e[3]=c,e[4]=s,e[5]=l,e[6]=s,e[7]=c):(e[0]=o,e[1]=c,e[2]=o,e[3]=l,e[4]=s,e[5]=c,e[6]=s,e[7]=l);var h=0===r?0:t.x/r,u=0===r?1:(t.x+t.height)/r,_=0===a?0:t.y/a,f=0===a?1:(t.y+t.width)/a;this._isFlipUVX&&this._isFlipUVY?(n[0]=u,n[1]=f,n[2]=u,n[3]=_,n[4]=h,n[5]=f,n[6]=h,n[7]=_):this._isFlipUVX?(n[0]=u,n[1]=_,n[2]=u,n[3]=f,n[4]=h,n[5]=_,n[6]=h,n[7]=f):this._isFlipUVY?(n[0]=h,n[1]=f,n[2]=h,n[3]=_,n[4]=u,n[5]=f,n[6]=u,n[7]=_):(n[0]=h,n[1]=_,n[2]=h,n[3]=f,n[4]=u,n[5]=_,n[6]=u,n[7]=f)}else{var d=0===r?0:t.x/r,p=0===r?1:(t.x+t.width)/r,m=0===a?1:(t.y+t.height)/a,v=0===a?0:t.y/a;this._isFlipUVX&&this._isFlipUVY?(e[0]=p,e[1]=v,e[2]=d,e[3]=v,e[4]=p,e[5]=m,e[6]=d,e[7]=m):this._isFlipUVX?(e[0]=p,e[1]=m,e[2]=d,e[3]=m,e[4]=p,e[5]=v,e[6]=d,e[7]=v):this._isFlipUVY?(e[0]=d,e[1]=v,e[2]=p,e[3]=v,e[4]=d,e[5]=m,e[6]=p,e[7]=m):(e[0]=d,e[1]=m,e[2]=p,e[3]=m,e[4]=d,e[5]=v,e[6]=p,e[7]=v);var g=0===r?0:t.x/r,y=0===r?1:(t.x+t.width)/r,x=0===a?1:(t.y+t.height)/a,S=0===a?0:t.y/a;this._isFlipUVX&&this._isFlipUVY?(n[0]=y,n[1]=S,n[2]=g,n[3]=S,n[4]=y,n[5]=x,n[6]=g,n[7]=x):this._isFlipUVX?(n[0]=y,n[1]=x,n[2]=g,n[3]=x,n[4]=y,n[5]=S,n[6]=g,n[7]=S):this._isFlipUVY?(n[0]=g,n[1]=S,n[2]=y,n[3]=S,n[4]=g,n[5]=x,n[6]=y,n[7]=x):(n[0]=g,n[1]=x,n[2]=y,n[3]=x,n[4]=g,n[5]=S,n[6]=y,n[7]=S)}var A=this.vertices;if(A){A.nu.length=0,A.nv.length=0;for(var b=0;b<A.u.length;b++)A.nu[b]=A.u[b]/r,A.nv[b]=A.v[b]/a}this._calculateSlicedUV()},n._setDynamicAtlasFrame=function(t){t&&(this._original={_texture:this._texture,_x:this._rect.x,_y:this._rect.y},this._texture=t.texture,this._rect.x=t.x,this._rect.y=t.y,this._calculateUV())},n._resetDynamicAtlasFrame=function(){this._original&&(this._rect.x=this._original._x,this._rect.y=this._original._y,this._texture=this._original._texture,this._original=null,this._calculateUV())},n._checkPackable=function(){var t=tF;if(t){var e=this._texture;if(e instanceof Mv&&!e.isCompressed){var n=this.width,i=this.height;!e.image||n>t.maxFrameSize||i>t.maxFrameSize?this._packable=!1:e.image&&e.image instanceof HTMLCanvasElement&&(this._packable=!0)}else this._packable=!1}},n._serialize=function(){return null},n._deserialize=function(t){var e=t,n=e.rect;n&&(this._rect=new oi(n.x,n.y,n.width,n.height));var i=e.offset;e.offset&&(this._offset=new Qn(i.x,i.y));var r=e.originalSize;e.originalSize&&(this._originalSize=new ri(r.width,r.height)),this._rotated=!!e.rotated,this._name=e.name,this._packable=!!e.packable;var a=e.capInsets;a&&(this._capInsets[0]=a[0],this._capInsets[1]=a[1],this._capInsets[2]=a[2],this._capInsets[3]=a[3]),this.vertices=e.vertices,this.vertices&&(this.vertices.nu=[],this.vertices.nv=[])},n.clone=function(){var t,n,i,r,a,o,s,c,l=new e,h=this.vertices;return l.vertices=h?{x:h.x,y:h.y,triangles:h.triangles,nu:null===(t=h.nu)||void 0===t?void 0:t.slice(0),u:null===(n=h.u)||void 0===n?void 0:n.slice(0),nv:null===(i=h.nv)||void 0===i?void 0:i.slice(0),v:null===(r=h.v)||void 0===r?void 0:r.slice(0)}:null,(a=l.uv).splice.apply(a,[0,l.uv.length].concat(this.uv)),(o=l.unbiasUV).splice.apply(o,[0,l.unbiasUV.length].concat(this.unbiasUV)),(s=l.uvSliced).splice.apply(s,[0,l.uvSliced.length].concat(this.uvSliced)),l._rect.set(this._rect),l._offset.set(this._offset),l._originalSize.set(this._originalSize),l._rotated=this._rotated,(c=l._capInsets).splice.apply(c,[0,l._capInsets.length].concat(this._capInsets)),l._atlasUuid=this._atlasUuid,l._texture=this._texture,l._isFlipUVX=this._isFlipUVX,l._isFlipUVY=this._isFlipUVY,l},n._refreshTexture=function(t){this._texture=t;var e=this._texture,n={},i=!1;0!==this._rect.width&&0!==this._rect.height&&this.checkRect(e)||(n.rect=new oi(0,0,e.width,e.height),i=!0),(0===this._originalSize.width||0===this._originalSize.height||i)&&(n.originalSize=new ri(e.width,e.height),i=!0),i&&(this.reset(n),this.onLoaded()),this._checkPackable()},n.initDefault=function(e){t.prototype.initDefault.call(this,e);var n=new Mv;n.initDefault(),this._refreshTexture(n),this._calculateUV()},n.validate=function(){return this._texture&&this._rect&&0!==this._rect.width&&0!==this._rect.height},Q(e,[{key:"insetTop",get:function(){return this._capInsets[1]},set:function(t){this._capInsets[1]!==t&&(this._capInsets[1]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetBottom",get:function(){return this._capInsets[3]},set:function(t){this._capInsets[3]!==t&&(this._capInsets[3]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetLeft",get:function(){return this._capInsets[0]},set:function(t){this._capInsets[0]!==t&&(this._capInsets[0]=t,this._texture&&this._calculateSlicedUV())}},{key:"insetRight",get:function(){return this._capInsets[2]},set:function(t){this._capInsets[2]!==t&&(this._capInsets[2]=t,this._texture&&this._calculateSlicedUV())}},{key:"rect",get:function(){return this._rect},set:function(t){this._rect.equals(t)||(this._rect.set(t),this._texture&&this._calculateUV())}},{key:"originalSize",get:function(){return this._originalSize},set:function(t){this._originalSize.equals(t)||(this._originalSize.set(t),this._texture&&this._calculateUV())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset.set(t)}},{key:"rotated",get:function(){return this._rotated},set:function(t){this._rotated!==t&&(this._rotated=t,this._texture&&this._calculateUV())}},{key:"texture",get:function(){return this._texture},set:function(t){t?t!==this._texture&&this.reset({texture:t},!0):R(3122,this.name)}},{key:"atlasUuid",get:function(){return this._atlasUuid},set:function(t){this._atlasUuid=t}},{key:"width",get:function(){return this._texture.width}},{key:"height",get:function(){return this._texture.height}},{key:"_textureSource",set:function(t){window.Build?this._texture=t:t&&(this._refreshTexture(t),this._calculateUV())}},{key:"flipUVX",get:function(){return this._isFlipUVX},set:function(t){this._isFlipUVX=t,this._calculateUV()}},{key:"flipUVY",get:function(){return this._isFlipUVY},set:function(t){this._isFlipUVY=t,this._calculateUV()}},{key:"packable",get:function(){return this._packable},set:function(t){this._packable=t}},{key:"original",get:function(){return this._original}}]),e}($h),ZL.EVENT_UV_UPDATED="uv_updated",QL=$L))||QL);h.SpriteFrame=oF;var sF,cF=t("SpriteAtlas",Ec("cc.SpriteAtlas")((rF=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"spriteFrames",iF,at(e)),e}$(e,t);var n=e.prototype;return n.getTexture=function(){var t=Object.keys(this.spriteFrames);if(t.length>0){var e=this.spriteFrames[t[0]];return e&&e.texture}return null},n.getSpriteFrame=function(t){var e=this.spriteFrames[t];return e?(e.name||(e.name=t),e):null},n.getSpriteFrames=function(){for(var t=[],e=this.spriteFrames,n=0,i=Object.keys(e);n<i.length;n++){var r=i[n];t.push(e[r])}return t},n._serialize=function(){},n._deserialize=function(t,e){var n=t;this._name=n.name;var i=n.spriteFrames;this.spriteFrames=Pt();for(var r=0;r<i.length;r+=2)e.result.push(this.spriteFrames,i[r],i[r+1],ee(oF))},e}($h),iF=lt((nF=rF).prototype,"spriteFrames",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Pt()}}),eF=nF))||eF);h.SpriteAtlas=cF;var lF,hF,uF,_F,fF=t("Font",Ec("cc.Font")(sF=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e}($h))||sF);h.Font=fF;var dF,pF,mF,vF,gF,yF,xF,SF,AF,bF=t("TTFFont",Ec("cc.TTFFont")((_F=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_fontFamily",uF,at(e)),e}return $(e,t),e.prototype.initDefault=function(e){this._fontFamily="Arial",t.prototype.initDefault.call(this,e)},Q(e,[{key:"_nativeAsset",get:function(){return this._fontFamily},set:function(t){this._fontFamily=t||"Arial"}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,__nativeName__:this._native,ext:Uh(this._native),__isNative__:!0}}}]),e}(fF),uF=lt((hF=_F).prototype,"_fontFamily",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lt(hF.prototype,"_nativeAsset",[hl,sl],Object.getOwnPropertyDescriptor(hF.prototype,"_nativeAsset"),hF.prototype),lt(hF.prototype,"_nativeDep",[hl],Object.getOwnPropertyDescriptor(hF.prototype,"_nativeDep"),hF.prototype),lF=hF))||lF);h.TTFFont=bF;var CF,TF=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.offsetX=0,this.offsetY=0,this.textureID=0,this.valid=!1,this.xAdvance=0},EF=function(){function t(t){this.letterDefinitions={},this.texture=t}var e=t.prototype;return e.addLetterDefinitions=function(t,e){this.letterDefinitions[t]=e},e.cloneLetterDefinition=function(){for(var t={},e=0,n=Object.keys(this.letterDefinitions);e<n.length;e++){var i=n[e],r=new TF;kt(r,this.letterDefinitions[i]),t[i]=r}return t},e.getTexture=function(){return this.texture},e.getLetter=function(t){return this.letterDefinitions[t]},e.getLetterDefinitionForChar=function(t){var e=t.charCodeAt(0);return this.letterDefinitions.hasOwnProperty(e)?this.letterDefinitions[e]:null},e.clear=function(){this.letterDefinitions={}},t}(),wF=t("BitmapFont",(dF=Ec("cc.BitmapFont"),pF=cl(oF),dF((AF=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"fntDataStr",gF,at(e)),ct(e,"spriteFrame",yF,at(e)),ct(e,"fontSize",xF,at(e)),ct(e,"fntConfig",SF,at(e)),e}return $(e,t),e.prototype.onLoaded=function(){var t=this.spriteFrame;!this.fontDefDictionary&&t&&(this.fontDefDictionary=new EF(t.texture));var e=this.fntConfig;if(e){var n=e.fontDefDictionary;for(var i in n){var r=new TF,a=n[i].rect;r.offsetX=n[i].xOffset,r.offsetY=n[i].yOffset,r.w=a.width,r.h=a.height,r.u=a.x,r.v=a.y,r.textureID=0,r.valid=!0,r.xAdvance=n[i].xAdvance,this.fontDefDictionary.addLetterDefinitions(i,r)}}else S("The fnt config is not exists!")},e}(fF),gF=lt((vF=AF).prototype,"fntDataStr",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),yF=lt(vF.prototype,"spriteFrame",[pF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xF=lt(vF.prototype,"fontSize",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),SF=lt(vF.prototype,"fntConfig",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mF=vF))||mF));h.BitmapFont=wF;var IF=t("LabelAtlas",Ec("cc.LabelAtlas")(CF=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e}(wF))||CF);h.LabelAtlas=IF;var PF=t("BASELINE_RATIO",.26),DF=t("MIDDLE_RATIO",(PF+1)/2-PF);var RF=new ne(2);RF.get=function(){return this._get()||{key:"",value:0,prev:null,next:null}};var MF,OF=new(function(){function t(t){this.count=0,this.limit=0,this.datas={},this.limit=t}var e=t.prototype;return e.moveToHead=function(t){t.next=this.head,t.prev=null,this.head&&(this.head.prev=t),this.head=t,this.tail||(this.tail=t),this.count++,this.datas[t.key]=t},e.put=function(t,e){var n=RF.get();if(n.key=t,n.value=e,this.count>=this.limit){var i=this.tail;delete this.datas[i.key],this.count--,this.tail=i.prev,this.tail.next=null,i.prev=null,i.next=null,RF.put(i)}this.moveToHead(n)},e.remove=function(t){t.prev?t.prev.next=t.next:this.head=t.next,t.next?t.next.prev=t.prev:this.tail=t.prev,delete this.datas[t.key],this.count--},e.get=function(t){var e=this.datas[t];return e?(this.remove(e),this.moveToHead(e),e.value):null},e.clear=function(){this.count=0,this.datas={},this.head=null,this.tail=null},e.has=function(t){return!!this.datas[t]},e.delete=function(t){var e=this.datas[t];this.remove(e)},t}())(100),NF=/([a-zA-Z0-9--]+|\S)/,BF=/^[!,.:;'}\]%\?>]/,LF=/([a-zA-Z0-9--iI]+|\S)$/,FF=/[a-zA-Z0-9--iI]+$/,VF=/^[a-zA-Z0-9--iI]/;function zF(t){return/^[\u4E00-\u9FFF\u3400-\u4DFF]+$/.test(t)||/[\u3000-\u303F]|[\u3040-\u309F]|[\u30A0-\u30FF]|[\uFF00-\uFFEF]|[\u4E00-\u9FAF]|[\u2605-\u2606]|[\u2190-\u2195]|\u203B/g.test(t)||/^[\u1100-\u11FF]|[\u3130-\u318F]|[\uA960-\uA97F]|[\uAC00-\uD7AF]|[\uD7B0-\uD7FF]+$/.test(t)}function kF(t){var e=t.charCodeAt(0);return e>=9&&e<=13||32===e||133===e||160===e||5760===e||e>=8192&&e<=8202||8232===e||8233===e||8239===e||8287===e||12288===e}function UF(t,e,n){var i=(n||t.font)+""+e,r=OF.get(i);if(null!==r)return r;var a=t.measureText(e),o=a&&a.width||0;return OF.put(i,o),o}function GF(t,e,n){var i=e,r=n,a=t[e];if(a>="\udc00"&&a<="\udfff"&&i--,void 0!==n)if(n-1!==e){var o=t[n-1];o>="\ud800"&&o<="\udbff"&&r--}else a>="\ud800"&&a<="\udbff"&&r++;return t.substring(i,r)}function HF(t){return VF.exec(t)}function jF(t){return FF.exec(t)}function WF(t,e,n,i){var r=[];if(0===t.length||n<0)return r.push(""),r;for(var a=t;e>n&&a.length>1;){for(var o=a.length*(n/e)|0,s=GF(a,o),c=e-i(s),l=s,h=0,u=0;c>n&&u++<100;)o*=n/c,c=e-i(s=GF(a,o|=0));for(u=0;s&&c<=n&&u++<100;){var _=NF.exec(s);l=s,c=e-i(s=GF(a,o+=h=_?_[0].length:1))}0==(o-=h)?(o=1,l=GF(a,1)):1===o&&a[0]>="\ud800"&&a[0]<="\udbff"&&(o=2,l=GF(a,2));var f=GF(a,0,o),d=void 0;BF.test(l||s)&&(0==(o-=(d=LF.exec(f))?d[0].length:0)&&(o=1),l=GF(a,o),f=GF(a,0,o)),VF.test(l)&&(d=FF.exec(f))&&f!==d[0]&&(l=GF(a,o-=d[0].length),f=GF(a,0,o)),(0===r.length||(f=f.trim()).length>0)&&r.push(f),e=i(a=l||s)}return(0===r.length||(a=a.trim()).length>0)&&r.push(a),r}var qF=t("CanvasPool",function(){function t(){this.pool=[]}t.getInstance=function(){return MF||(MF=new t),MF};var e=t.prototype;return e.get=function(){var t=this.pool.pop();if(!t){var e=document.createElement("canvas"),n=e.getContext("2d");t={canvas:e,context:n}}return t},e.put=function(t){this.pool.length>=_e.MAX_LABEL_CANVAS_POOL_SIZE||this.pool.push(t)},t}()),XF=Dn.WHITE.clone(),YF=function(){this.u=0,this.v=0,this.w=0,this.h=0,this.texture=null,this.offsetX=0,this.offsetY=0,this.valid=!1,this.xAdvance=0},KF="rgba(255, 255, 255, "+(1/255).toFixed(3)+")",JF=function(){function t(t,e){this.image=null,this.labelInfo=void 0,this.char=void 0,this.data=null,this.canvas=null,this.context=null,this.width=0,this.height=0,this.offsetY=0,this.hash=void 0,this.char=t,this.labelInfo=e,this.hash=t.charCodeAt(0)+e.hash}var e=t.prototype;return e.updateRenderData=function(){this._updateProperties(),this._updateTexture()},e.destroy=function(){this.image=null},e._updateProperties=function(){if(this.data=qF.getInstance().get(),this.canvas=this.data.canvas,this.context=this.data.context,this.context){this.context.font=this.labelInfo.fontDesc;var t=UF(this.context,this.char,this.labelInfo.fontDesc),e=2*this.labelInfo.margin+2;this.width=parseFloat(t.toFixed(2))+e,this.height=(1+PF)*this.labelInfo.fontSize+e,this.offsetY=-this.labelInfo.fontSize*PF/2}this.canvas.width!==this.width&&(this.canvas.width=this.width),this.canvas.height!==this.height&&(this.canvas.height=this.height),this.image||(this.image=new lv),this.image.reset(this.canvas)},e._updateTexture=function(){if(this.context&&this.canvas){var t=this.context,e=this.labelInfo,n=this.canvas.width,i=this.canvas.height;t.textAlign="center",t.textBaseline="alphabetic",t.clearRect(0,0,n,i),t.fillStyle=KF,t.fillRect(0,0,n,i),t.font=e.fontDesc;var r=e.fontSize,a=n/2,o=i/2+r*DF+0*r,s=e.color;if(t.lineJoin="round",t.fillStyle="rgba("+s.r+", "+s.g+", "+s.b+", 1)",e.isOutlined){var c=e.out||XF;t.strokeStyle="rgba("+c.r+", "+c.g+", "+c.b+", "+c.a/255+")",t.lineWidth=2*e.margin,t.strokeText(this.char,a,o)}t.fillText(this.char,a,o)}},t}(),QF=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.initWithSize=function(t,e,n){void 0===n&&(n=km.RGBA8888),this.reset({width:t,height:e,format:n})},n.drawTextureAt=function(t,e,n){var i=this.getGFXTexture();if(t&&i){var r=this._getGFXDevice();if(r){var a=new _r;a.texOffset.x=e,a.texOffset.y=n,a.texExtent.width=t.width,a.texExtent.height=t.height,r.copyTexImagesToTexture([t.data],i,[a])}else console.warn("Unable to get device")}},e}(Mv),ZF=function(){function t(t,e){this._x=0,this._y=0,this._nextY=0,this._width=0,this._height=0,this._halfBleed=0,this._dirty=!1;var n=new QF;n.initWithSize(t,e),this.fontDefDictionary=new EF(n),this._halfBleed=1,this._width=t,this._height=e,TO.on(CO.EVENT_BEFORE_SCENE_LAUNCH,this.beforeSceneLoad,this)}var e=t.prototype;return e.insertLetterTexture=function(t){var e=t.image,n=TO.root.device;if(!e||!this.fontDefDictionary||!n)return null;var i=e.width,r=e.height;if(this._x+i+0>this._width&&(this._x=0,this._y=this._nextY),this._y+r>this._nextY&&(this._nextY=this._y+r+0),this._nextY>this._height)return R(12100),null;this.fontDefDictionary.texture.drawTextureAt(e,this._x,this._y),this._dirty=!0;var a=new YF;return a.u=this._x+this._halfBleed,a.v=this._y+this._halfBleed,a.texture=this.fontDefDictionary.texture,a.valid=!0,a.w=t.width-2,a.h=t.height-2,a.xAdvance=a.w,a.offsetY=t.offsetY,this._x+=i+0,this.fontDefDictionary.addLetterDefinitions(t.hash,a),a},e.update=function(){this._dirty&&(this._dirty=!1)},e.reset=function(){this._x=0,this._y=0,this._nextY=0,this.fontDefDictionary.clear()},e.destroy=function(){this.reset(),this.fontDefDictionary&&(this.fontDefDictionary.texture.destroy(),this.fontDefDictionary.texture=null)},e.getTexture=function(){return this.fontDefDictionary.getTexture()},e.beforeSceneLoad=function(){this.clearAllCache()},e.clearAllCache=function(){this.destroy();var t=new QF;t.initWithSize(this._width,this._height),this.fontDefDictionary.texture=t},e.getLetter=function(t){return this.fontDefDictionary.letterDefinitions[t]},e.getLetterDefinitionForChar=function(t,e){var n=t.charCodeAt(0)+e.hash,i=this.fontDefDictionary.letterDefinitions[n];if(!i){var r=new JF(t,e);r.updateRenderData(),i=this.insertLetterTexture(r),r.destroy()}return i},Q(t,[{key:"width",get:function(){return this._width}},{key:"height",get:function(){return this._height}}]),t}(),$F={fontAtlas:null,fontSize:0,lineHeight:0,hAlign:0,vAlign:0,hash:"",fontFamily:"",fontDesc:"Arial",color:Dn.WHITE.clone(),isOutlined:!1,out:Dn.WHITE.clone(),margin:0},tV=[new Br(nr.ATTR_POSITION,mi.RGB32F)],eV=[new Br(nr.ATTR_POSITION,mi.RGB32F),new Br(nr.ATTR_COLOR,mi.RGBA32F)],nV=[new Br(nr.ATTR_POSITION,mi.RGB32F),new Br(nr.ATTR_TEX_COORD,mi.RG32F),new Br(nr.ATTR_COLOR,mi.RGBA32F)],iV=[new Br(nr.ATTR_POSITION,mi.RGB32F),new Br(nr.ATTR_TEX_COORD,mi.RG32F),new Br(nr.ATTR_COLOR,mi.RGBA32F),new Br(nr.ATTR_COLOR2,mi.RGBA32F)];function rV(t){for(var e=0,n=0;n<t.length;n++){var i=t[n];e+=aa[i.format].count}return e}function aV(t){for(var e=0,n=0;n<t.length;n++){var i=t[n];e+=aa[i.format].size}return e}h.internal.vfmtPosUvColor=nV,h.internal.vfmtPosUvTwoColor=iV,t("UIVertexFormat",Object.freeze({__proto__:null,vfmt:tV,vfmtPosColor:eV,vfmtPosUvColor:nV,vfmtPosUvTwoColor:iV,getComponentPerVertex:rV,getAttributeStride:aV}));var oV,sV,cV,lV,hV,uV,_V,fV,dV,pV,mV,vV,gV,yV,xV,SV=aV(nV)>>2,AV=new ql((function(){return{x:0,y:0,z:0,u:0,v:0,color:Dn.WHITE.clone()}}),128),bV=null,CV=t("BaseRenderData",function(){function t(t){void 0===t&&(t=nV),this.material=null,this.chunk=null,this.dataHash=0,this.isMeshBuffer=!1,this._vc=0,this._ic=0,this._floatStride=0,this._vertexFormat=nV,this._floatStride=t===nV?SV:aV(t)>>2,this._vertexFormat=t}return t.prototype.isValid=function(){return this._ic>0&&this.chunk.vertexAccessor},Q(t,[{key:"vertexCount",get:function(){return this._vc}},{key:"indexCount",get:function(){return this._ic}},{key:"stride",get:function(){return this._floatStride<<2}},{key:"floatStride",get:function(){return this._floatStride}},{key:"vertexFormat",get:function(){return this._vertexFormat}}]),t}()),TV=t("RenderData",function(t){function e(e,n){var i;return void 0===e&&(e=nV),(i=t.call(this,e)||this).indices=null,i.vertDirty=!0,i.frame=void 0,i.layer=0,i.blendHash=-1,i.textureHash=0,i.nodeDirty=!0,i.passDirty=!0,i.textureDirty=!0,i.hashDirty=!0,i._data=[],i._pivotX=0,i._pivotY=0,i._width=0,i._height=0,i._accessor=null,n||(n=TO.root.batcher2D.switchBufferAccessor(i._vertexFormat)),i._accessor=n,i}$(e,t),e.add=function(t,n){void 0===t&&(t=nV),bV||(bV=new Xl((function(){return new e}),32));var i=bV.add();return i._floatStride=t===nV?SV:aV(t)>>2,i._vertexFormat=t,n||(n=TO.root.batcher2D.switchBufferAccessor(i._vertexFormat)),i._accessor=n,i},e.remove=function(t){var e=bV.data.indexOf(t);-1!==e&&(t.clear(),t._accessor=null,bV.removeAt(e))};var n=e.prototype;return n.resize=function(t,e){t===this._vc&&e===this._ic&&this.chunk||(this._vc=t,this._ic=e,this.chunk&&(this._accessor.recycleChunk(this.chunk),this.chunk=null),this.chunk=this._accessor.allocateChunk(t,e),this.updateHash())},n.resizeAndCopy=function(t,e){if(t!==this._vc||e!==this._ic||!this.chunk){this._vc=t,this._ic=e;var n=this.chunk;this.chunk=this._accessor.allocateChunk(t,e),n&&(this.chunk.vb.set(n.vb),this._accessor.recycleChunk(n)),this.updateHash()}},n.getMeshBuffer=function(){return this.chunk&&this._accessor?this._accessor.getMeshBuffer(this.chunk.bufferId):null},n.updateNode=function(t){this.layer=t.node.layer,this.nodeDirty=!1,this.hashDirty=!0},n.updatePass=function(t){this.material=t.getRenderMaterial(0),this.blendHash=t.blendHash,this.passDirty=!1,this.hashDirty=!0},n.updateTexture=function(t){this.frame=t,this.textureHash=t.getHash(),this.textureDirty=!1,this.hashDirty=!0},n.updateHash=function(){var t=""+(this.chunk?this.chunk.bufferId:-1)+this.layer+" "+this.blendHash+" "+this.textureHash;this.dataHash=ba(t,666),this.hashDirty=!1},n.updateRenderData=function(t,e){if(this.passDirty&&(this.material=t.getRenderMaterial(0),this.blendHash=t.blendHash,this.passDirty=!1,this.hashDirty=!0),this.nodeDirty){var n=t.node.scene?t._getRenderScene():null;this.layer=t.node.layer,null!==n&&(this.nodeDirty=!1),this.hashDirty=!0}this.textureDirty&&(this.frame=e,this.textureHash=e.getHash(),this.textureDirty=!1,this.hashDirty=!0),this.hashDirty&&this.updateHash()},n.updateSizeNPivot=function(t,e,n,i){t===this._width&&e===this._height&&n===this._pivotX&&i===this._pivotY||(this._width=t,this._height=e,this._pivotX=n,this._pivotY=i,this.vertDirty=!0)},n.clear=function(){this.resize(0,0),this._data.length=0,this._pivotX=0,this._pivotY=0,this._width=0,this._height=0,this.indices=null,this.vertDirty=!0,this.material=null,this.nodeDirty=!0,this.passDirty=!0,this.textureDirty=!0,this.hashDirty=!0,this.layer=0,this.blendHash=-1,this.frame=null,this.textureHash=0,this.dataHash=0},Q(e,[{key:"dataLength",get:function(){return this._data.length},set:function(t){var e=this._data;if(e.length!==t){var n=e.length,i=0;for(i=t;i<n;i++)AV.free(e[i]);for(i=n;i<t;i++)e[i]=AV.alloc();e.length=t}}},{key:"data",get:function(){return this._data}}]),e}(CV)),EV=t("MeshRenderData",function(t){function e(e){var n;return void 0===e&&(e=nV),(n=t.call(this,e)||this).isMeshBuffer=!0,n.vData=void 0,n.iData=void 0,n.vertexStart=0,n.vertexRange=0,n.indexStart=0,n.indexRange=0,n.lastFilledIndex=0,n.lastFilledVertex=0,n._byteLength=0,n._vertexBuffers=[],n._indexBuffer=null,n._iaPool=null,n._iaInfo=null,n.vData=new Float32Array(256*n.stride),n.iData=new Uint16Array(1536),n}$(e,t),e.add=function(t){void 0===t&&(t=nV);var e=wV.add();return e._floatStride=t===nV?SV:aV(t)>>2,e._vertexFormat=t,e},e.remove=function(t){var e=wV.data.indexOf(t);-1!==e&&(wV.data[e].clear(),wV.removeAt(e))};var n=e.prototype;return n.request=function(t,e){var n=this._byteLength+t*this.stride;return!!this.reserve(t,e)&&(this._vc+=t,this._ic+=e,this._byteLength=n,this.vertexRange=this._vc,this.indexRange=this._ic,!0)},n.reserve=function(t,e){var n=this._byteLength+t*this.stride,i=this.indexCount+e;if(t+this.vertexCount>65535)return!1;var r=this.vData.byteLength,a=this.iData.length,o=this.vData.length,s=this.iData.length;if(n>r||i>a){for(;r<n||a<i;)r=4*(o*=2),a=s*=2;this._reallocBuffer(o,s)}return!0},n.resize=function(t,e){var n=t*this.stride;t>=0&&e>=0&&n<=this.vData.byteLength&&this.iData.length,this._vc=t,this._ic=e,this._byteLength=n,this.updateRange(0,t,0,e)},n.updateRange=function(t,e,n,i){e>=0&&i>=0&&e<=this._vc&&this._ic,this.vertexStart=t,this.indexStart=n,this.vertexRange=e,this.indexRange=i},n.requestIA=function(t){this._initIAInfo(t);var e=this._iaPool.add();return e.firstIndex=this.indexStart,e.indexCount=this.indexRange,e},n.uploadBuffers=function(){if(0!==this._byteLength&&this._vertexBuffers[0]&&this._indexBuffer){var t=this._ic,e=new Float32Array(this.vData.buffer,0,this._byteLength>>2),n=new Uint16Array(this.iData.buffer,0,t),i=this._vertexBuffers[0];this._byteLength>i.size&&i.resize(this._byteLength),i.update(e);var r=t<<1;r>this._indexBuffer.size&&this._indexBuffer.resize(r),this._indexBuffer.update(n)}},n.freeIAPool=function(){this._iaPool&&this._iaPool.reset()},n.reset=function(){this._vc=0,this._ic=0,this._byteLength=0,this.vertexStart=0,this.vertexRange=0,this.indexStart=0,this.indexRange=0,this.lastFilledIndex=0,this.lastFilledVertex=0,this.material=null,this.freeIAPool()},n.clear=function(){this.reset(),this._iaPool&&this._iaPool.destroy(),this._vertexBuffers[0]&&(this._vertexBuffers[0].destroy(),this._vertexBuffers=[]),this._iaInfo=null,this.vData=new Float32Array(256*this.stride),this.iData=new Uint16Array(1536)},n._initIAInfo=function(t){var e=this;if(!this._iaInfo){var n=this.stride,i=this._vertexBuffers;i.length||i.push(t.createBuffer(new gr(yi.VERTEX|yi.TRANSFER_DST,Ai.DEVICE,n,n)));var r=Uint16Array.BYTES_PER_ELEMENT;this._indexBuffer||(this._indexBuffer=t.createBuffer(new gr(yi.INDEX|yi.TRANSFER_DST,Ai.DEVICE,r,r))),this._iaInfo=new Fr(this._vertexFormat,i,this._indexBuffer),this._iaPool=new Xl((function(){return t.createInputAssembler(e._iaInfo)}),1,(function(t){t.destroy()}))}},n._reallocBuffer=function(t,e){var n=this.vData;this.vData=new Float32Array(t),n&&this.vData.set(n,0);var i=this.iData;this.iData=new Uint16Array(e),i&&this.iData.set(i,0)},Q(e,[{key:"formatByte",get:function(){return this.stride},set:function(){}},{key:"floatStride",get:function(){return this._floatStride}},{key:"vDataOffset",get:function(){return this._byteLength>>>2}}]),e}(CV)),wV=new Xl((function(){return new EV}),32),IV=new Qn,PV=new Qn,DV=new Mn,RV=new Xn,MV=new Xn,OV=new Xn,NV=new Xn(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0),BV=new oi,LV=function(e){return t({UITransform:e,UITransformComponent:e}),e}((oV=Ec("cc.UITransform"),sV=jc(),cV=Ic(110),lV=kc(),hV=el(),uV=Kc(),_V=el(),fV=Kc(),oV(dV=sV(dV=cV(dV=lV(dV=Pc(dV=zc((yV=gV=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._priority=0,ct(e,"_contentSize",mV,at(e)),ct(e,"_anchorPoint",vV,at(e)),e}$(e,t);var n=e.prototype;return n.__preload=function(){this.node._uiProps.uiTransformComp=this},n.onLoad=function(){this.node.parent&&e.insertChangeMap(this.node.parent)},n.onEnable=function(){this.node.on(bC.PARENT_CHANGED,this._parentChanged,this),this._markRenderDataDirty()},n.onDisable=function(){this.node.off(bC.PARENT_CHANGED,this._parentChanged,this)},n.onDestroy=function(){this.node._uiProps.uiTransformComp=null},n.setContentSize=function(t,e){var n=this._contentSize;if(void 0===e){if(hn((t=t).width,n.width,cn)&&hn(t.height,n.height,cn))return;n.width=t.width,n.height=t.height}else{if(hn(t=t,n.width,cn)&&hn(e,n.height,cn))return;n.width=t,n.height=e}this.node.emit(bC.SIZE_CHANGED),this._markRenderDataDirty()},n.setAnchorPoint=function(t,e){var n=this._anchorPoint;if(void 0===e){if((t=t).x===n.x&&t.y===n.y)return;n.x=t.x,n.y=t.y}else{if(t===n.x&&e===n.y)return;n.x=t,n.y=e}this.node.emit(bC.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty()},n.isHit=function(t){for(var e=this._contentSize.width,n=this._contentSize.height,i=IV,r=PV,a=this._getRenderScene().cameras,o=0;o<a.length;o++){var s=a[o];if(s.visibility&this.node.layer){s.node.getWorldRT(RV);var c=RV.m12,l=RV.m13,h=IO.center;if(RV.m12=h.x-(RV.m00*c+RV.m04*l),RV.m13=h.y-(RV.m01*c+RV.m05*l),Xn.invert(RV,RV),Qn.transformMat4(i,t,RV),this.node.getWorldMatrix(OV),Xn.invert(RV,OV),!Xn.strictEquals(RV,NV)){Qn.transformMat4(r,i,RV),r.x+=this._anchorPoint.x*e,r.y+=this._anchorPoint.y*n;var u=!1;if(r.x>=0&&r.y>=0&&r.x<=e&&r.y<=n&&(u=this._maskTest(i)),u)return!0}}}return!1},n.hitTest=function(t){for(var e=this._contentSize.width,n=this._contentSize.height,i=DV,r=IV,a=PV,o=this._getRenderScene().cameras,s=0;s<o.length;s++){var c=o[s];if(c.visibility&this.node.layer&&(Mn.set(i,t.x,t.y,0),c.screenToWorld(i,i),Qn.set(r,i.x,i.y),this.node.getWorldMatrix(OV),Xn.invert(RV,OV),!Xn.strictEquals(RV,NV))){Qn.transformMat4(a,r,RV),a.x+=this._anchorPoint.x*e,a.y+=this._anchorPoint.y*n;var l=!1;if(a.x>=0&&a.y>=0&&a.x<=e&&a.y<=n&&(l=this._maskTest(r)),l)return!0}}return!1},n._maskTest=function(t){var e,n,i=null===(e=this.node)||void 0===e||null===(n=e.eventProcessor)||void 0===n?void 0:n.maskList;if(i)for(var r=this.node,a=i.length,o=0,s=0;r&&s<a;++o,r=r.parent){var c=i[s];if(o===c.index){if(r!==c.comp.node){i.length=s;break}var l=c.comp;if(l&&l._enabled&&!l.isHit(t))return!1;s++}else if(o>c.index){i.length=s;break}}return!0},n.convertToNodeSpaceAR=function(t,e){return this.node.getWorldMatrix(OV),Xn.invert(RV,OV),e||(e=new Mn),Mn.transformMat4(e,t,RV)},n.convertToWorldSpaceAR=function(t,e){return this.node.getWorldMatrix(OV),e||(e=new Mn),Mn.transformMat4(e,t,OV)},n.getBoundingBox=function(){Xn.fromRTS(MV,this.node.getRotation(),this.node.getPosition(),this.node.getScale());var t=this._contentSize.width,e=this._contentSize.height,n=new oi(-this._anchorPoint.x*t,-this._anchorPoint.y*e,t,e);return n.transformMat4(MV),n},n.getBoundingBoxToWorld=function(){return this.node.parent?(this.node.parent.getWorldMatrix(OV),this.getBoundingBoxTo(OV)):this.getBoundingBox()},n.getBoundingBoxTo=function(t){Xn.fromRTS(MV,this.node.getRotation(),this.node.getPosition(),this.node.getScale());var n=this._contentSize.width,i=this._contentSize.height,r=new oi(-this._anchorPoint.x*n,-this._anchorPoint.y*i,n,i);if(Xn.multiply(OV,t,MV),r.transformMat4(OV),!this.node.children)return r;for(var a,o=st(this.node.children);!(a=o()).done;){var s=a.value;if(s&&s.active){var c=s.getComponent(e);if(c){var l=c.getBoundingBoxTo(t);l&&oi.union(r,r,l)}}}return r},n.getComputeAABB=function(t){var e=this._contentSize.width,n=this._contentSize.height;BV.set(-this._anchorPoint.x*e,-this._anchorPoint.y*n,e,n),BV.transformMat4(this.node.worldMatrix);var i=BV.x+.5*BV.width,r=BV.y+.5*BV.height,a=this.node.worldPosition.z,o=BV.width/2,s=BV.height/2;return null!=t?(Qs.set(t,i,r,a,o,s,.001),t):new Qs(i,r,a,o,s,.001)},n._parentChanged=function(){this.node.getComponent("cc.RenderRoot2D")||this.node.parent&&e.insertChangeMap(this.node.parent)},n._markRenderDataDirty=function(){var t=this.node._uiProps.uiComp;t&&(t.markForUpdateRenderData(),t.renderData&&(t.renderData.vertDirty=!0))},e.insertChangeMap=function(t){var n=t.uuid;e.priorityChangeNodeMap.has(n)||e.priorityChangeNodeMap.set(n,t)},e._sortChildrenSibling=function(t){var e=t.children;e&&e.sort((function(t,e){var n=t._uiProps.uiTransformComp,i=e._uiProps.uiTransformComp,r=(n?n._priority:0)-(i?i._priority:0);return 0===r?t.getSiblingIndex()-e.getSiblingIndex():r}))},e._sortSiblings=function(){e.priorityChangeNodeMap.forEach((function(t){e._sortChildrenSibling(t),t._updateSiblingIndex(),t.emit("childrenSiblingOrderChanged")})),e.priorityChangeNodeMap.clear()},e._cleanChangeMap=function(){e.priorityChangeNodeMap.clear()},Q(e,[{key:"contentSize",get:function(){return this._contentSize},set:function(t){this._contentSize.equals(t)||(this._contentSize.set(t),this.node.emit(bC.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"width",get:function(){return this._contentSize.width},set:function(t){this._contentSize.width!==t&&(this._contentSize.width=t,this.node.emit(bC.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"height",get:function(){return this._contentSize.height},set:function(t){this.contentSize.height!==t&&(this._contentSize.height=t,this.node.emit(bC.SIZE_CHANGED),this._markRenderDataDirty())}},{key:"anchorPoint",get:function(){return this._anchorPoint},set:function(t){this._anchorPoint.equals(t)||(this._anchorPoint.set(t),this.node.emit(bC.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"anchorX",get:function(){return this._anchorPoint.x},set:function(t){this._anchorPoint.x!==t&&(this._anchorPoint.x=t,this.node.emit(bC.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"anchorY",get:function(){return this._anchorPoint.y},set:function(t){this._anchorPoint.y!==t&&(this._anchorPoint.y=t,this.node.emit(bC.ANCHOR_CHANGED,this._anchorPoint),this._markRenderDataDirty())}},{key:"priority",get:function(){return this._priority},set:function(t){this._priority!==t&&(this.node.getComponent("cc.RenderRoot2D")?R(6706):(this._priority=t,this.node.parent&&e.insertChangeMap(this.node.parent)))}},{key:"visibility",get:function(){var t=TO.root.batcher2D.getFirstRenderCamera(this.node);return t?t.visibility:0}},{key:"cameraPriority",get:function(){var t=TO.root.batcher2D.getFirstRenderCamera(this.node);return t?t.priority:0}}]),e}(xu),gV.EventType=bC,gV.priorityChangeNodeMap=new Map,lt((pV=yV).prototype,"contentSize",[hV,uV],Object.getOwnPropertyDescriptor(pV.prototype,"contentSize"),pV.prototype),lt(pV.prototype,"anchorPoint",[_V,fV],Object.getOwnPropertyDescriptor(pV.prototype,"anchorPoint"),pV.prototype),mV=lt(pV.prototype,"_contentSize",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ri(100,100)}}),vV=lt(pV.prototype,"_anchorPoint",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn(.5,.5)}}),dV=pV))||dV)||dV)||dV)||dV)||dV)||dV));TO.on(CO.EVENT_AFTER_UPDATE,LV._sortSiblings),TO.on(CO.EVENT_BEFORE_SCENE_LAUNCH,LV._cleanChangeMap),function(t){t[t.DISABLED=0]="DISABLED",t[t.CLEAR=1]="CLEAR",t[t.ENTER_LEVEL=2]="ENTER_LEVEL",t[t.ENABLED=3]="ENABLED",t[t.EXIT_LEVEL=4]="EXIT_LEVEL",t[t.CLEAR_INVERTED=5]="CLEAR_INVERTED",t[t.ENTER_LEVEL_INVERTED=6]="ENTER_LEVEL_INVERTED"}(xV||(xV={}));var FV,VV,zV,kV,UV,GV,HV,jV,WV,qV,XV,YV,KV,JV,QV,ZV,$V,tz,ez,nz,iz=t("StencilManager",function(){function t(){this.stage=xV.DISABLED,this._maskStack=[],this._stencilPattern={stencilTest:!0,func:Ri.ALWAYS,stencilMask:65535,writeMask:65535,failOp:Mi.KEEP,zFailOp:Mi.KEEP,passOp:Mi.KEEP,ref:1},this.stencilStateMap=new Map,this.stencilStateMapWithDepth=new Map}var e=t.prototype;return e.pushMask=function(t){this._maskStack.push(t)},e.clear=function(t){t.stencilStage=t.inverted?xV.CLEAR_INVERTED:xV.CLEAR},e.enterLevel=function(t){t.graphics.stencilStage=t.inverted?xV.ENTER_LEVEL_INVERTED:xV.ENTER_LEVEL},e.enableMask=function(){this.stage=xV.ENABLED},e.exitMask=function(){0!==this._maskStack.length&&(this._maskStack.pop(),0===this._maskStack.length?this.stage=xV.DISABLED:this.stage=xV.ENABLED)},e.getWriteMask=function(){return 1<<this._maskStack.length-1},e.getExitWriteMask=function(){return 1<<this._maskStack.length},e.getStencilRef=function(){for(var t=0,e=0;e<this._maskStack.length;++e)t+=1<<e;return t},e.reset=function(){this._maskStack.length=0,this.stage=xV.DISABLED},e.destroy=function(){this.stencilStateMap.forEach((function(t){t.destroy()})),this.stencilStateMap.clear()},e.getStencilStage=function(t,e){var n=0,i=!1,r=!1,a=Ri.LESS,o=this.stencilStateMap;if(e&&e.passes[0]){var s=e.passes[0].depthStencilState,c=0,l=0;s.depthTest&&(c=1),s.depthWrite&&(l=1),n=c|l<<1|s.depthFunc<<2|t<<6|this._maskStack.length<<9,i=s.depthTest,r=s.depthWrite,a=s.depthFunc,o=this.stencilStateMapWithDepth}else n=t<<16|this._maskStack.length;if(o&&o.has(n))return o.get(n);this.setStateFromStage(t);var h=new Pa(i,r,a,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref,this._stencilPattern.stencilTest,this._stencilPattern.func,this._stencilPattern.stencilMask,this._stencilPattern.writeMask,this._stencilPattern.failOp,this._stencilPattern.zFailOp,this._stencilPattern.passOp,this._stencilPattern.ref);return o.set(n,h),h},e.getStencilHash=function(t){return t<<8|this._maskStack.length},e.setStateFromStage=function(t){var e=this._stencilPattern;t===xV.DISABLED?(e.stencilTest=!1,e.func=Ri.ALWAYS,e.failOp=Mi.KEEP,e.stencilMask=e.writeMask=65535,e.ref=1):(e.stencilTest=!0,t===xV.ENABLED?(e.func=Ri.EQUAL,e.failOp=Mi.KEEP,e.stencilMask=e.ref=this.getStencilRef(),e.writeMask=this.getWriteMask()):t===xV.CLEAR?(e.func=Ri.NEVER,e.failOp=Mi.ZERO,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):t===xV.CLEAR_INVERTED||t===xV.ENTER_LEVEL?(e.func=Ri.NEVER,e.failOp=Mi.REPLACE,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()):t===xV.ENTER_LEVEL_INVERTED&&(e.func=Ri.NEVER,e.failOp=Mi.ZERO,e.writeMask=e.stencilMask=e.ref=this.getWriteMask()))},Q(t,[{key:"pattern",get:function(){return this._stencilPattern}}]),t}());iz.sharedManager=null,iz.sharedManager=new iz,he(Oi),function(t){t[t.ADD_COLOR=0]="ADD_COLOR",t[t.ADD_COLOR_AND_TEXTURE=1]="ADD_COLOR_AND_TEXTURE",t[t.GRAYSCALE=2]="GRAYSCALE",t[t.USE_ALPHA_SEPARATED=3]="USE_ALPHA_SEPARATED",t[t.USE_ALPHA_SEPARATED_AND_GRAY=4]="USE_ALPHA_SEPARATED_AND_GRAY"}(nz||(nz=t("InstanceMaterialType",{})));var rz,az,oz,sz,cz,lz,hz,uz,_z,fz,dz,pz,mz,vz,gz,yz,xz,Sz,Az,bz,Cz,Tz,Ez,wz,Iz,Pz,Dz,Rz,Mz,Oz,Nz,Bz,Lz,Fz,Vz,zz,kz,Uz,Gz,Hz,jz,Wz,qz,Xz,Yz,Kz,Jz,Qz,Zz,$z,tk,ek,nk,ik,rk,ak,ok,sk,ck,lk,hk,uk,_k,fk,dk,pk,mk,vk,gk,yk,xk=function(e){return t({Renderable2D:e,RenderComponent:e,UIRenderable:e}),e}((FV=Ec("cc.Renderable2D"),VV=wc(LV),zV=qc(),kV=cl(vg),UV=cl(vg),GV=el(),HV=Kc(),jV=Yc(),WV=el(),qV=Kc(),FV(XV=VV(XV=Pc(XV=zc((ez=tz=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_materials",KV,at(e)),ct(e,"_customMaterial",JV,at(e)),e.stencilStage=xV.DISABLED,ct(e,"_srcBlendFactor",QV,at(e)),ct(e,"_dstBlendFactor",ZV,at(e)),ct(e,"_color",$V,at(e)),e._assembler=null,e._postAssembler=null,e._renderData=null,e._renderDataFlag=!0,e._renderFlag=!0,e._delegateSrc=null,e._instanceMaterialType=-1,e._blendState=new Ra,e._blendHash=0,e._useVertexOpacity=!1,e._lastParent=null,e}$(e,t);var n=e.prototype;return n.updateBlendHash=function(){var t=this._blendState.targets[0].blendDst<<4;this._blendHash=t|this._blendState.targets[0].blendSrc},n.__preload=function(){this.node._uiProps.uiComp=this,this._flushAssembler&&this._flushAssembler()},n.onEnable=function(){this.node.on(bC.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.on(bC.SIZE_CHANGED,this._nodeStateChange,this),this.node.on(bC.PARENT_CHANGED,this._colorDirty,this),this.updateMaterial(),this._renderFlag=this._canRender(),this._colorDirty()},n.onRestore=function(){this.updateMaterial(),this.markForUpdateRenderData()},n.onDisable=function(){this.node.off(bC.ANCHOR_CHANGED,this._nodeStateChange,this),this.node.off(bC.SIZE_CHANGED,this._nodeStateChange,this),this.node.off(bC.PARENT_CHANGED,this._colorDirty,this),this._renderFlag=!1},n.onDestroy=function(){if(this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this.destroyRenderData(),this._materialInstances)for(var t=0;t<this._materialInstances.length;t++){var e=this._materialInstances[t];e&&e.destroy()}this._blendState&&this._blendState.destroy()},n.markForUpdateRenderData=function(t){if(void 0===t&&(t=!0),this._renderFlag=this._canRender(),t){var e=this._renderData;e&&(e.vertDirty=!0),this._renderDataFlag=t}else this._renderDataFlag=t},n.requestRenderData=function(){var t=TV.add();return this._renderData=t,t},n.destroyRenderData=function(){this._renderData&&(TV.remove(this._renderData),this._renderData=null)},n.updateAssembler=function(t){this._renderDataFlag&&(this._assembler.updateRenderData(this,t),this._renderDataFlag=!1),this._renderFlag&&this._render(t)},n.postUpdateAssembler=function(t){this._postAssembler&&this._renderFlag&&this._postRender(t)},n._render=function(){},n._postRender=function(){},n._canRender=function(){return this.isValid&&null!==this.getMaterial(0)&&this.enabled&&(this._delegateSrc?this._delegateSrc.activeInHierarchy:this.enabledInHierarchy)&&this._color.a>0},n._postCanRender=function(){},n.updateMaterial=function(){if(this._customMaterial)return this.setMaterial(this._customMaterial,0),this._renderData&&(this._renderData.material=this._customMaterial,this.markForUpdateRenderData(),this._renderData.passDirty=!0),void(this._blendHash=-1);var t=this._updateBuiltinMaterial();this.setMaterial(t,0),this._renderData&&(this._renderData.material=t,this.markForUpdateRenderData()),this._updateBlendFunc()},n._updateColor=function(){this.node._uiProps.colorDirty=!0,this._assembler&&(this._assembler.updateColor(this),this._renderFlag=this._canRender())},n._updateBlendFunc=function(){var t=this._blendState.targets[0];t||(t=new Da,this._blendState.setTarget(0,t)),t.blendDst===this._dstBlendFactor&&t.blendSrc===this._srcBlendFactor||(t.blend=!0,t.blendDstAlpha=Oi.ONE_MINUS_SRC_ALPHA,t.blendDst=this._dstBlendFactor,t.blendSrc=this._srcBlendFactor,this.renderData&&(this.renderData.passDirty=!0)),this.updateBlendHash()},n.getBlendState=function(){return this._blendState},n._nodeStateChange=function(){this._renderData&&this.markForUpdateRenderData();for(var t=0;t<this.node.children.length;++t){var n=this.node.children[t].getComponent(e);n&&n.markForUpdateRenderData()}},n._colorDirty=function(){this.node._uiProps.colorDirty=!0},n._onMaterialModified=function(e,n){this._renderData&&(this.markForUpdateRenderData(),this._renderData.passDirty=!0),t.prototype._onMaterialModified.call(this,e,n)},n._updateBuiltinMaterial=function(){var t;switch(this._instanceMaterialType){case nz.ADD_COLOR:t=Uv.get("ui-base-material");break;case nz.GRAYSCALE:t=Uv.get("ui-sprite-gray-material");break;case nz.USE_ALPHA_SEPARATED:t=Uv.get("ui-sprite-alpha-sep-material");break;case nz.USE_ALPHA_SEPARATED_AND_GRAY:t=Uv.get("ui-sprite-gray-alpha-sep-material");break;default:t=Uv.get("ui-sprite-material")}return t},n.setNodeDirty=function(){this.renderData&&(this.renderData.nodeDirty=!0)},n.setTextureDirty=function(){this.renderData&&(this.renderData.textureDirty=!0)},Q(e,[{key:"sharedMaterials",get:function(){return this._materials},set:function(t){for(var e=0;e<t.length;e++)t[e]!==this._materials[e]&&this.setMaterial(t[e],e);if(t.length<this._materials.length){for(var n=t.length;n<this._materials.length;n++)this.setMaterial(null,n);this._materials.splice(t.length)}}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this.updateMaterial()}},{key:"color",get:function(){return this._color},set:function(t){this._color.equals(t)||(this._color.set(t),this._updateColor())}},{key:"renderData",get:function(){return this._renderData}},{key:"delegateSrc",set:function(t){this._delegateSrc=t}},{key:"blendHash",get:function(){return this._blendHash}},{key:"useVertexOpacity",get:function(){return this._useVertexOpacity}}]),e}(jL),tz.BlendState=Oi,tz.Assembler=null,tz.PostAssembler=null,KV=lt((YV=ez).prototype,"_materials",[hl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lt(YV.prototype,"sharedMaterials",[hl,zV],Object.getOwnPropertyDescriptor(YV.prototype,"sharedMaterials"),YV.prototype),JV=lt(YV.prototype,"_customMaterial",[kV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lt(YV.prototype,"customMaterial",[UV,GV,HV,jV,il],Object.getOwnPropertyDescriptor(YV.prototype,"customMaterial"),YV.prototype),lt(YV.prototype,"color",[WV,qV],Object.getOwnPropertyDescriptor(YV.prototype,"color"),YV.prototype),QV=lt(YV.prototype,"_srcBlendFactor",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Oi.SRC_ALPHA}}),ZV=lt(YV.prototype,"_dstBlendFactor",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Oi.ONE_MINUS_SRC_ALPHA}}),$V=lt(YV.prototype,"_color",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Dn.WHITE.clone()}}),XV=YV))||XV)||XV)||XV)||XV));h.internal.Renderable2D=xk,function(t){t[t.LEFT=0]="LEFT",t[t.CENTER=1]="CENTER",t[t.RIGHT=2]="RIGHT"}(mk||(mk=t("HorizontalTextAlignment",{}))),he(mk),function(t){t[t.TOP=0]="TOP",t[t.CENTER=1]="CENTER",t[t.BOTTOM=2]="BOTTOM"}(vk||(vk=t("VerticalTextAlignment",{}))),he(vk),function(t){t[t.NONE=0]="NONE",t[t.CLAMP=1]="CLAMP",t[t.SHRINK=2]="SHRINK",t[t.RESIZE_HEIGHT=3]="RESIZE_HEIGHT"}(gk||(gk=t("Overflow",{}))),he(gk),function(t){t[t.NONE=0]="NONE",t[t.BITMAP=1]="BITMAP",t[t.CHAR=2]="CHAR"}(yk||(yk=t("CacheMode",{}))),he(yk);var Sk,Ak,bk,Ck=function(e){return t({Label:e,LabelComponent:e}),e}((rz=Ec("cc.Label"),az=jc(),oz=Ic(110),sz=kc(),cz=el(),lz=Kc(),hz=cl(mk),uz=el(),_z=Kc(),fz=cl(vk),dz=el(),pz=Kc(),mz=el(),vz=Kc(),gz=el(),yz=qc(),xz=Kc(),Sz=el(),Az=Kc(),bz=qc(),Cz=el(),Tz=Kc(),Ez=cl(gk),wz=el(),Iz=Kc(),Pz=el(),Dz=Kc(),Rz=cl(fF),Mz=el(),Oz=qc(),Nz=Kc(),Bz=el(),Lz=Kc(),Fz=cl(yk),Vz=el(),zz=Kc(),kz=el(),Uz=Kc(),Gz=el(),Hz=Kc(),jz=el(),Wz=Kc(),qz=qc(),Xz=el(),Yz=Kc(),rz(Kz=az(Kz=oz(Kz=sz((pk=dk=function(t){function e(){var e;return ct(e=t.call(this)||this,"_string",Qz,at(e)),ct(e,"_horizontalAlign",Zz,at(e)),ct(e,"_verticalAlign",$z,at(e)),ct(e,"_actualFontSize",tk,at(e)),ct(e,"_fontSize",ek,at(e)),ct(e,"_fontFamily",nk,at(e)),ct(e,"_lineHeight",ik,at(e)),ct(e,"_overflow",rk,at(e)),ct(e,"_enableWrapText",ak,at(e)),ct(e,"_font",ok,at(e)),ct(e,"_isSystemFontUsed",sk,at(e)),ct(e,"_spacingX",ck,at(e)),ct(e,"_isItalic",lk,at(e)),ct(e,"_isBold",hk,at(e)),ct(e,"_isUnderline",uk,at(e)),ct(e,"_underlineHeight",_k,at(e)),ct(e,"_cacheMode",fk,at(e)),e._N$file=null,e._texture=null,e._ttfSpriteFrame=null,e._userDefinedFont=null,e._assemblerData=null,e._fontAtlas=null,e._letterTexture=null,e._ttfSpriteFrame=null,e}$(e,t);var n=e.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this._font||this._isSystemFontUsed||(this.useSystemFont=!0),this._isSystemFontUsed&&!this._fontFamily&&(this.fontFamily="Arial"),this._applyFontTexture()},n.onDestroy=function(){if(this._assembler&&this._assembler.resetAssemblerData&&this._assembler.resetAssemblerData(this._assemblerData),this._assemblerData=null,this._ttfSpriteFrame){this._ttfSpriteFrame._resetDynamicAtlasFrame();var e=this._ttfSpriteFrame.texture;if(this._ttfSpriteFrame.destroy(),e){var n=e;n.image&&n.image.destroy(),e.destroy()}this._ttfSpriteFrame=null}this._letterTexture=null,t.prototype.onDestroy.call(this)},n.updateRenderData=function(t){void 0===t&&(t=!1),this.markForUpdateRenderData(),t&&(this._flushAssembler(),this.renderData&&(this.renderData.vertDirty=!0),this._applyFontTexture(),this._assembler&&this._assembler.updateRenderData(this))},n._render=function(t){t.commitComp(this,this.renderData,this._texture,this._assembler,null)},n._updateColor=function(){t.prototype._updateColor.call(this),this.updateRenderData(!1)},n._canRender=function(){if(!t.prototype._canRender.call(this)||!this._string)return!1;var e=this._font;if(e&&e instanceof wF){var n=e.spriteFrame;if(!n||!n.texture)return!1}return!0},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material)},n._applyFontTexture=function(){this.markForUpdateRenderData();var t=this._font;if(t instanceof wF){var e=t.spriteFrame;e&&e.texture&&(this._texture=e,this.renderData&&(this.renderData.textureDirty=!0),this.changeMaterialForDefine(),this._assembler&&this._assembler.updateRenderData(this))}else{if(this.cacheMode===yk.CHAR)this._letterTexture=this._assembler.getAssemblerData(),this._texture=this._letterTexture;else if(!this._ttfSpriteFrame){this._ttfSpriteFrame=new oF,this._assemblerData=this._assembler.getAssemblerData();var n=new lv(this._assemblerData.canvas),i=new Mv;i.image=n,this._ttfSpriteFrame.texture=i}this.cacheMode!==yk.CHAR&&(this._texture=this._ttfSpriteFrame),this.changeMaterialForDefine()}},n.changeMaterialForDefine=function(){if(this._texture){var t=!1;if(this.cacheMode!==yk.CHAR){var e=this._texture.texture;if(e instanceof sv){var n=e.getPixelFormat();t=n===km.RGBA_ETC1||n===km.RGB_A_PVRTC_4BPPV1||n===km.RGB_A_PVRTC_2BPPV1}}this._instanceMaterialType=t?nz.USE_ALPHA_SEPARATED:nz.ADD_COLOR_AND_TEXTURE,this.updateMaterial()}},n._updateBlendFunc=function(){t.prototype._updateBlendFunc.call(this)},Q(e,[{key:"string",get:function(){return this._string},set:function(t){t=null==t?"":t.toString(),this._string!==t&&(this._string=t,this.updateRenderData())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this._horizontalAlign!==t&&(this._horizontalAlign=t,this.updateRenderData())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this.updateRenderData())}},{key:"actualFontSize",get:function(){return this._actualFontSize},set:function(t){this._actualFontSize=t}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this.updateRenderData())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this.updateRenderData())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this.updateRenderData())}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this.updateRenderData())}},{key:"overflow",get:function(){return this._overflow},set:function(t){this._overflow!==t&&(this._overflow=t,this.updateRenderData())}},{key:"enableWrapText",get:function(){return this._enableWrapText},set:function(t){this._enableWrapText!==t&&(this._enableWrapText=t,this.updateRenderData())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._isSystemFontUsed=!t,this._font=t,this._renderData&&(this.destroyRenderData(),this._renderData=null),this._fontAtlas=null,this.updateRenderData(!0))}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this.destroyRenderData(),this._renderData=null,this._isSystemFontUsed=!!t,t&&(this.font=null),this._flushAssembler(),this.updateRenderData())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode!==yk.BITMAP||this._font instanceof wF||!this._ttfSpriteFrame||this._ttfSpriteFrame._resetDynamicAtlasFrame(),this._cacheMode===yk.CHAR&&(this._ttfSpriteFrame=null),this._cacheMode=t,this.updateRenderData(!0))}},{key:"isBold",get:function(){return this._isBold},set:function(t){this._isBold!==t&&(this._isBold=t,this.updateRenderData())}},{key:"isItalic",get:function(){return this._isItalic},set:function(t){this._isItalic!==t&&(this._isItalic=t,this.updateRenderData())}},{key:"isUnderline",get:function(){return this._isUnderline},set:function(t){this._isUnderline!==t&&(this._isUnderline=t,this.updateRenderData())}},{key:"underlineHeight",get:function(){return this._underlineHeight},set:function(t){this._underlineHeight!==t&&(this._underlineHeight=t,this.updateRenderData())}},{key:"spriteFrame",get:function(){return this._texture}},{key:"ttfSpriteFrame",get:function(){return this._ttfSpriteFrame}},{key:"assemblerData",get:function(){return this._assemblerData}},{key:"fontAtlas",get:function(){return this._fontAtlas},set:function(t){this._fontAtlas=t}},{key:"_bmFontOriginalSize",get:function(){return this._font instanceof wF?this._font.fontSize:-1}}]),e}(xk),dk.HorizontalAlign=mk,dk.VerticalAlign=vk,dk.Overflow=gk,dk.CacheMode=yk,dk._canvasPool=qF.getInstance(),lt((Jz=pk).prototype,"string",[cz,lz,nl],Object.getOwnPropertyDescriptor(Jz.prototype,"string"),Jz.prototype),lt(Jz.prototype,"horizontalAlign",[hz,uz,_z],Object.getOwnPropertyDescriptor(Jz.prototype,"horizontalAlign"),Jz.prototype),lt(Jz.prototype,"verticalAlign",[fz,dz,pz],Object.getOwnPropertyDescriptor(Jz.prototype,"verticalAlign"),Jz.prototype),lt(Jz.prototype,"fontSize",[mz,vz],Object.getOwnPropertyDescriptor(Jz.prototype,"fontSize"),Jz.prototype),lt(Jz.prototype,"fontFamily",[gz,yz,xz],Object.getOwnPropertyDescriptor(Jz.prototype,"fontFamily"),Jz.prototype),lt(Jz.prototype,"lineHeight",[Sz,Az],Object.getOwnPropertyDescriptor(Jz.prototype,"lineHeight"),Jz.prototype),lt(Jz.prototype,"spacingX",[bz,Cz,Tz],Object.getOwnPropertyDescriptor(Jz.prototype,"spacingX"),Jz.prototype),lt(Jz.prototype,"overflow",[Ez,wz,Iz],Object.getOwnPropertyDescriptor(Jz.prototype,"overflow"),Jz.prototype),lt(Jz.prototype,"enableWrapText",[Pz,Dz],Object.getOwnPropertyDescriptor(Jz.prototype,"enableWrapText"),Jz.prototype),lt(Jz.prototype,"font",[Rz,Mz,Oz,Nz],Object.getOwnPropertyDescriptor(Jz.prototype,"font"),Jz.prototype),lt(Jz.prototype,"useSystemFont",[Bz,Lz],Object.getOwnPropertyDescriptor(Jz.prototype,"useSystemFont"),Jz.prototype),lt(Jz.prototype,"cacheMode",[Fz,Vz,zz],Object.getOwnPropertyDescriptor(Jz.prototype,"cacheMode"),Jz.prototype),lt(Jz.prototype,"isBold",[kz,Uz],Object.getOwnPropertyDescriptor(Jz.prototype,"isBold"),Jz.prototype),lt(Jz.prototype,"isItalic",[Gz,Hz],Object.getOwnPropertyDescriptor(Jz.prototype,"isItalic"),Jz.prototype),lt(Jz.prototype,"isUnderline",[jz,Wz],Object.getOwnPropertyDescriptor(Jz.prototype,"isUnderline"),Jz.prototype),lt(Jz.prototype,"underlineHeight",[qz,Wc,Xz,Yz],Object.getOwnPropertyDescriptor(Jz.prototype,"underlineHeight"),Jz.prototype),Qz=lt(Jz.prototype,"_string",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"label"}}),Zz=lt(Jz.prototype,"_horizontalAlign",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return mk.CENTER}}),$z=lt(Jz.prototype,"_verticalAlign",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return vk.CENTER}}),tk=lt(Jz.prototype,"_actualFontSize",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ek=lt(Jz.prototype,"_fontSize",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),nk=lt(Jz.prototype,"_fontFamily",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),ik=lt(Jz.prototype,"_lineHeight",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),rk=lt(Jz.prototype,"_overflow",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return gk.NONE}}),ak=lt(Jz.prototype,"_enableWrapText",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ok=lt(Jz.prototype,"_font",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sk=lt(Jz.prototype,"_isSystemFontUsed",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ck=lt(Jz.prototype,"_spacingX",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),lk=lt(Jz.prototype,"_isItalic",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),hk=lt(Jz.prototype,"_isBold",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),uk=lt(Jz.prototype,"_isUnderline",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_k=lt(Jz.prototype,"_underlineHeight",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),fk=lt(Jz.prototype,"_cacheMode",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return yk.NONE}}),Kz=Jz))||Kz)||Kz)||Kz)||Kz));h.Label=Ck,function(t){t[t.BUTT=0]="BUTT",t[t.ROUND=1]="ROUND",t[t.SQUARE=2]="SQUARE"}(Sk||(Sk={})),he(Sk),function(t){t[t.BEVEL=0]="BEVEL",t[t.ROUND=1]="ROUND",t[t.MITER=2]="MITER"}(Ak||(Ak={})),he(Ak),function(t){t[t.PT_CORNER=1]="PT_CORNER",t[t.PT_LEFT=2]="PT_LEFT",t[t.PT_BEVEL=4]="PT_BEVEL",t[t.PT_INNERBEVEL=8]="PT_INNERBEVEL"}(bk||(bk={})),he(bk);var Tk=Math.PI,Ek=Math.min,wk=Math.max,Ik=Math.cos,Pk=Math.sin,Dk=Math.abs,Rk=Math.sign,Mk=.5522847493;function Ok(t,e,n,i,r){t.moveTo(e-i,n),t.bezierCurveTo(e-i,n+r*Mk,e-i*Mk,n+r,e,n+r),t.bezierCurveTo(e+i*Mk,n+r,e+i,n+r*Mk,e+i,n),t.bezierCurveTo(e+i,n-r*Mk,e+i*Mk,n-r,e,n-r),t.bezierCurveTo(e-i*Mk,n-r,e-i,n-r*Mk,e-i,n),t.close()}function Nk(t,e,n,i,r,a,o,s,c,l,h){var u,_,f,d,p,m,v,g,y,x,S,A,b,C,T,E;l>10||(p=.5*(a+s),m=.5*(o+c),v=.5*((u=.5*(e+i))+(f=.5*(i+a))),g=.5*((_=.5*(n+r))+(d=.5*(r+o))),((T=Dk((i-s)*(C=c-n)-(r-c)*(b=s-e)))+(E=Dk((a-s)*C-(o-c)*b)))*(T+E)<t.tessTol*(b*b+C*C)?t.addPoint(s,c,0===h?h|bk.PT_BEVEL:h):(Nk(t,e,n,u,_,v,g,S=.5*(v+(y=.5*(f+p))),A=.5*(g+(x=.5*(d+m))),l+1,0),Nk(t,S,A,y,x,p,m,s,c,l+1,h)))}var Bk,Lk,Fk,Vk,zk,kk,Uk,Gk,Hk,jk,Wk,qk,Xk,Yk,Kk,Jk,Qk,Zk,$k,tU,eU,nU,iU,rU,aU,oU,sU,cU,lU,hU,uU,_U,fU,dU,pU,mU,vU,gU,yU,xU,SU,AU,bU,CU,TU,EU,wU,IU=function(t){function e(e,n){var i;return(i=t.call(this,e,n)||this).dx=0,i.dy=0,i.dmx=0,i.dmy=0,i.flags=0,i.len=0,i.reset(),i}return $(e,t),e.prototype.reset=function(){this.dx=0,this.dy=0,this.dmx=0,this.dmy=0,this.flags=0,this.len=0},e}(Qn),PU=function(){function t(){this.closed=!1,this.bevel=0,this.complex=!0,this.points=[],this.reset()}return t.prototype.reset=function(){this.closed=!1,this.bevel=0,this.complex=!0,this.points?this.points.length=0:this.points=[]},t}(),DU=function(){function t(){this.dataOffset=0,this.updatePathOffset=!1,this.pathLength=0,this.pathOffset=0,this.paths=[],this.tessTol=.25,this.distTol=.01,this.fillColor=Dn.WHITE.clone(),this.lineCap=Sk.BUTT,this.strokeColor=Dn.BLACK.clone(),this.lineJoin=Ak.MITER,this.lineWidth=0,this.pointsOffset=0,this._commandX=0,this._commandY=0,this._points=[],this._renderDataList=[],this._curPath=null}var e=t.prototype;return e.moveTo=function(t,e){this.updatePathOffset&&(this.pathOffset=this.pathLength,this.updatePathOffset=!1),this._addPath(),this.addPoint(t,e,bk.PT_CORNER),this._commandX=t,this._commandY=e},e.lineTo=function(t,e){this.addPoint(t,e,bk.PT_CORNER),this._commandX=t,this._commandY=e},e.bezierCurveTo=function(t,e,n,i,r,a){var o=this._curPath,s=o.points[o.points.length-1];s&&(s.x!==t||s.y!==e||n!==r||i!==a?(Nk(this,s.x,s.y,t,e,n,i,r,a,0,bk.PT_CORNER),this._commandX=r,this._commandY=a):this.lineTo(r,a))},e.quadraticCurveTo=function(t,e,n,i){var r=this._commandX,a=this._commandY;this.bezierCurveTo(r+2/3*(t-r),a+2/3*(e-a),n+2/3*(t-n),i+2/3*(e-i),n,i)},e.arc=function(t,e,n,i,r,a){!function(t,e,n,i,r,a,o){var s,c,l=0,h=0,u=0,_=0,f=0,d=0,p=0,m=0,v=0,g=0,y=0,x=0,S=0,A=0;if(h=a-r,o=o||!1)if(Dk(h)>=2*Tk)h=2*Tk;else for(;h<0;)h+=2*Tk;else if(Dk(h)>=2*Tk)h=2*-Tk;else for(;h>0;)h-=2*Tk;for(c=0|wk(1,Ek(Dk(h)/(.5*Tk)+.5,5)),u=Dk(4/3*(1-Ik(s=h/c/2))/Pk(s)),o||(u=-u),A=0;A<=c;A++)d=e+(_=Ik(l=r+h*(A/c)))*i,p=n+(f=Pk(l))*i,m=-f*i*u,v=_*i*u,0===A?t.moveTo(d,p):t.bezierCurveTo(g+x,y+S,d-m,p-v,d,p),g=d,y=p,x=m,S=v}(this,t,e,n,i,r,a)},e.ellipse=function(t,e,n,i){Ok(this,t,e,n,i),this._curPath.complex=!1},e.circle=function(t,e,n){Ok(this,t,e,n,n),this._curPath.complex=!1},e.rect=function(t,e,n,i){this.moveTo(t,e),this.lineTo(t+n,e),this.lineTo(t+n,e+i),this.lineTo(t,e+i),this.close(),this._curPath.complex=!1},e.roundRect=function(t,e,n,i,r){!function(t,e,n,i,r,a){if(a<.1)t.rect(e,n,i,r);else{var o=Ek(a,.5*Dk(i))*Rk(i),s=Ek(a,.5*Dk(r))*Rk(r);t.moveTo(e,n+s),t.lineTo(e,n+r-s),t.bezierCurveTo(e,n+r-s*(1-Mk),e+o*(1-Mk),n+r,e+o,n+r),t.lineTo(e+i-o,n+r),t.bezierCurveTo(e+i-o*(1-Mk),n+r,e+i,n+r-s*(1-Mk),e+i,n+r-s),t.lineTo(e+i,n+s),t.bezierCurveTo(e+i,n+s*(1-Mk),e+i-o*(1-Mk),n,e+i-o,n),t.lineTo(e+o,n),t.bezierCurveTo(e+o*(1-Mk),n,e,n+s*(1-Mk),e,n+s),t.close()}}(this,t,e,n,i,r),this._curPath.complex=!1},e.clear=function(){this.pathLength=0,this.pathOffset=0,this.pointsOffset=0,this.dataOffset=0,this._curPath=null,this.paths.length=0,this._points.length=0;for(var t=this._renderDataList,e=0,n=t.length;e<n;e++){var i=t[e];i&&EV.remove(i)}this._renderDataList.length=0},e.close=function(){this._curPath.closed=!0},e.requestRenderData=function(){var t=EV.add();return this._renderDataList.push(t),t},e.getRenderDataList=function(){return 0===this._renderDataList.length&&this.requestRenderData(),this._renderDataList},e.addPoint=function(t,e,n){var i=this._curPath;if(i){var r=this._points,a=i.points,o=r[this.pointsOffset++];o?(o.x=t,o.y=e):(o=new IU(t,e),r.push(o)),o.flags=n,a.push(o)}},e._addPath=function(){var t=this.pathLength,e=this.paths[t];return e?e.reset():(e=new PU,this.paths.push(e)),this.pathLength++,this._curPath=e,e},t}(),RU=eV.concat([new Br("a_dist",mi.R32F)]),MU=rV(RU),OU=aV(RU),NU=function(e){return t({Graphics:e,GraphicsComponent:e}),e}((Bk=Ec("cc.Graphics"),Lk=jc(),Fk=Ic(110),Vk=kc(),zk=Kc(),kk=cl(Ak),Uk=Kc(),Gk=cl(Sk),Hk=Kc(),jk=Kc(),Wk=Kc(),qk=Kc(),Xk=qc(),Bk(Yk=Lk(Yk=Fk(Yk=Vk((iU=nU=function(t){function e(){var e;return(e=t.call(this)||this).impl=null,e.model=null,ct(e,"_lineWidth",Jk,at(e)),ct(e,"_strokeColor",Qk,at(e)),ct(e,"_lineJoin",Zk,at(e)),ct(e,"_lineCap",$k,at(e)),ct(e,"_fillColor",tU,at(e)),ct(e,"_miterLimit",eU,at(e)),e._isDrawing=!1,e._isNeedUploadData=!0,e._graphicsUseSubMeshes=[],e._instanceMaterialType=nz.ADD_COLOR,e.impl=new DU,e}$(e,t);var n=e.prototype;return n.onRestore=function(){this.impl||this._flushAssembler()},n.onLoad=function(){this.model=TO.root.createModel(Cy),this.model.node=this.model.transform=this.node,this._flushAssembler()},n.onEnable=function(){t.prototype.onEnable.call(this),this._updateMtlForGraphics()},n.onDisable=function(){t.prototype.onDisable.call(this)},n.onDestroy=function(){this._sceneGetter=null,this.model&&(TO.root.destroyModel(this.model),this.model=null);var e=this._graphicsUseSubMeshes.length;if(e>0){for(var n=0;n<e;++n)this._graphicsUseSubMeshes[n].destroy();this._graphicsUseSubMeshes.length=0}this.impl&&(this._isDrawing=!1,this.impl.clear(),this.impl=null),t.prototype.onDestroy.call(this)},n.moveTo=function(t,e){this.impl&&this.impl.moveTo(t,e)},n.lineTo=function(t,e){this.impl&&this.impl.lineTo(t,e)},n.bezierCurveTo=function(t,e,n,i,r,a){this.impl&&this.impl.bezierCurveTo(t,e,n,i,r,a)},n.quadraticCurveTo=function(t,e,n,i){this.impl&&this.impl.quadraticCurveTo(t,e,n,i)},n.arc=function(t,e,n,i,r,a){this.impl&&this.impl.arc(t,e,n,i,r,a)},n.ellipse=function(t,e,n,i){this.impl&&this.impl.ellipse(t,e,n,i)},n.circle=function(t,e,n){this.impl&&this.impl.circle(t,e,n)},n.rect=function(t,e,n,i){this.impl&&this.impl.rect(t,e,n,i)},n.roundRect=function(t,e,n,i,r){this.impl&&this.impl.roundRect(t,e,n,i,r)},n.fillRect=function(t,e,n,i){this.rect(t,e,n,i),this.fill()},n.clear=function(){if(this.impl){if(this.impl.clear(),this._isDrawing=!1,this.model)for(var t=0;t<this.model.subModels.length;t++)this.model.subModels[t].inputAssembler.indexCount=0;this.markForUpdateRenderData()}},n.close=function(){this.impl&&this.impl.close()},n.stroke=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.stroke(this)},n.fill=function(){this._assembler||this._flushAssembler(),this._isDrawing=!0,this._isNeedUploadData=!0,this._assembler.fill(this)},n._updateMtlForGraphics=function(){var t;this._customMaterial?t=this.getMaterialInstance(0):(t=Uv.get("ui-graphics-material"),this.setMaterial(t,0),(t=this.getMaterialInstance(0)).recompileShaders({USE_LOCAL:!0}))},n.activeSubModel=function(t){if(this.model){if(this.model.subModels.length<=t){var e=h.director.root.device,n=e.createBuffer(new gr(yi.VERTEX|yi.TRANSFER_DST,Ai.DEVICE,65535*OU,OU)),i=e.createBuffer(new gr(yi.INDEX|yi.TRANSFER_DST,Ai.DEVICE,131070*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),r=new Aw([n],RU,Gi.TRIANGLE_LIST,i);r.subMeshIdx=0,this.model.initSubModel(t,r,this.getMaterialInstance(0)),this._graphicsUseSubMeshes.push(r)}}else R(4500,this.node.name)},n._uploadData=function(){var t=this.impl;if(t){var e=t&&t.getRenderDataList();if(!(e.length<=0)&&this.model){for(var n=this.model.subModels,i=0;i<e.length;i++){var r=e[i],a=n[i].inputAssembler;if(r.lastFilledVertex!==r.vertexStart){var o=new Float32Array(r.vData.buffer,0,r.vertexStart*MU);a.vertexBuffers[0].update(o),a.vertexCount=r.vertexStart;var s=new Uint16Array(r.iData.buffer,0,r.indexStart);a.indexBuffer.update(s),a.indexCount=r.indexStart,r.lastFilledVertex=r.vertexStart,r.lastFilledIndex=r.indexStart}}this._isNeedUploadData=!1}}},n._render=function(t){if(this._isNeedUploadData){if(this.impl){var e=this.impl.getRenderDataList(),n=this.model.subModels.length;if(e.length>n)for(var i=n;i<e.length;i++)this.activeSubModel(i)}this._uploadData()}t.commitModel(this,this.model,this.getMaterialInstance(0))},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t)},n._canRender=function(){return!!t.prototype._canRender.call(this)&&!!this.model&&this._isDrawing},Q(e,[{key:"lineWidth",get:function(){return this._lineWidth},set:function(t){this._lineWidth=t,this.impl&&(this.impl.lineWidth=t)}},{key:"lineJoin",get:function(){return this._lineJoin},set:function(t){this._lineJoin=t,this.impl&&(this.impl.lineJoin=t)}},{key:"lineCap",get:function(){return this._lineCap},set:function(t){this._lineCap=t,this.impl&&(this.impl.lineCap=t)}},{key:"strokeColor",get:function(){return this._strokeColor},set:function(t){this.impl&&(this._strokeColor.set(t),this.impl.strokeColor=this._strokeColor)}},{key:"fillColor",get:function(){return this._fillColor},set:function(t){this.impl&&(this._fillColor.set(t),this.impl.fillColor=this._fillColor)}},{key:"miterLimit",get:function(){return this._miterLimit},set:function(t){this._miterLimit=t}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(){}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(){}}]),e}(xk),nU.LineJoin=Ak,nU.LineCap=Sk,lt((Kk=iU).prototype,"lineWidth",[Wc,zk],Object.getOwnPropertyDescriptor(Kk.prototype,"lineWidth"),Kk.prototype),lt(Kk.prototype,"lineJoin",[kk,Uk],Object.getOwnPropertyDescriptor(Kk.prototype,"lineJoin"),Kk.prototype),lt(Kk.prototype,"lineCap",[Gk,Hk],Object.getOwnPropertyDescriptor(Kk.prototype,"lineCap"),Kk.prototype),lt(Kk.prototype,"strokeColor",[jk],Object.getOwnPropertyDescriptor(Kk.prototype,"strokeColor"),Kk.prototype),lt(Kk.prototype,"fillColor",[Wk],Object.getOwnPropertyDescriptor(Kk.prototype,"fillColor"),Kk.prototype),lt(Kk.prototype,"miterLimit",[qk],Object.getOwnPropertyDescriptor(Kk.prototype,"miterLimit"),Kk.prototype),lt(Kk.prototype,"color",[hl,Xk],Object.getOwnPropertyDescriptor(Kk.prototype,"color"),Kk.prototype),Jk=lt(Kk.prototype,"_lineWidth",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Qk=lt(Kk.prototype,"_strokeColor",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Dn.BLACK.clone()}}),Zk=lt(Kk.prototype,"_lineJoin",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ak.MITER}}),$k=lt(Kk.prototype,"_lineCap",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Sk.BUTT}}),tU=lt(Kk.prototype,"_fillColor",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Dn.WHITE.clone()}}),eU=lt(Kk.prototype,"_miterLimit",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),Yk=Kk))||Yk)||Yk)||Yk)||Yk));h.Graphics=NU;var BU,LU=new Xn,FU=new Qn,VU=new Xn,zU=[];!function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.GRAPHICS_STENCIL=2]="GRAPHICS_STENCIL",t[t.IMAGE_STENCIL=3]="IMAGE_STENCIL"}(BU||(BU={})),he(BU);var kU=function(e){return t({Mask:e,MaskComponent:e}),e}((rU=Ec("cc.Mask"),aU=jc(),oU=Ic(110),sU=kc(),cU=cl(BU),lU=Kc(),hU=el(),uU=Kc(),_U=qc(),fU=cl(oF),dU=qc(),pU=qc(),mU=Jc(),vU=qc(),gU=qc(),rU(yU=aU(yU=oU(yU=sU((wU=EU=function(t){function e(){var e;return(e=t.call(this)||this)._clearStencilMtl=null,e._clearModel=null,ct(e,"_type",SU,at(e)),ct(e,"_inverted",AU,at(e)),ct(e,"_segments",bU,at(e)),ct(e,"_spriteFrame",CU,at(e)),ct(e,"_alphaThreshold",TU,at(e)),e._graphics=null,e._clearModelMesh=null,e._instanceMaterialType=nz.ADD_COLOR,e}$(e,t);var n=e.prototype;return n.onLoad=function(){this._createClearModel(),this._createGraphics(),this._graphics&&this._graphics.onLoad()},n.onEnable=function(){t.prototype.onEnable.call(this),this._updateGraphics(),this._enableGraphics()},n.onRestore=function(){this._createGraphics(),t.prototype.updateMaterial.call(this),this._updateGraphics(),this._renderFlag=this._canRender()},n.onDisable=function(){t.prototype.onDisable.call(this),this._disableGraphics()},n.onDestroy=function(){this._clearModel&&this._clearModelMesh&&(TO.root.destroyModel(this._clearModel),this._clearModelMesh.destroy()),this._clearStencilMtl&&this._clearStencilMtl.destroy(),this._removeGraphics(),t.prototype.onDestroy.call(this)},n.isHit=function(t){var e=this.node._uiProps.uiTransformComp,n=e.contentSize,i=n.width,r=n.height,a=FU;this.node.getWorldMatrix(LU),Xn.invert(VU,LU),Qn.transformMat4(a,t,VU);var o=e.anchorPoint;a.x+=o.x*i,a.y+=o.y*r;var s=!1;if(this.type===BU.RECT||this.type===BU.GRAPHICS_STENCIL||this.type===BU.IMAGE_STENCIL)s=a.x>=0&&a.y>=0&&a.x<=i&&a.y<=r;else if(this.type===BU.ELLIPSE){var c=i/2,l=r/2,h=a.x-.5*i,u=a.y-.5*r;s=h*h/(c*c)+u*u/(l*l)<1}return this._inverted&&(s=!s),s},n._render=function(t){t.commitComp(this,this.renderData,null,this._assembler,null)},n._postRender=function(t){this._postAssembler&&t.commitComp(this,null,null,this._postAssembler,null)},n._nodeStateChange=function(e){t.prototype._nodeStateChange.call(this,e),this._updateGraphics()},n._canRender=function(){return!!t.prototype._canRender.call(this)&&null!==this._graphics&&(this._type!==BU.IMAGE_STENCIL||null!==this._spriteFrame)},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this),n=e.PostAssembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._postAssembler!==n&&(this._postAssembler=n),this._useRenderData()},n._createGraphics=function(){if(!this._graphics){var t=this._graphics=new NU;t._objFlags|=ml.Flags.IsOnLoadCalled,t.node=this.node,t.node.getWorldMatrix(),t.lineWidth=0;var e=Dn.WHITE.clone();e.a=0,t.fillColor=e}this._updateMaterial()},n._updateGraphics=function(){if(this._graphics&&(this._type===BU.RECT||this._type===BU.ELLIPSE)){var t=this.node._uiProps.uiTransformComp,e=this._graphics;e.clear();var n=t.contentSize,i=n.width,r=n.height,a=t.anchorPoint,o=-i*a.x,s=-r*a.y;if(this._type===BU.RECT)e.rect(o,s,i,r);else if(this._type===BU.ELLIPSE){for(var c=function(t,e,n){zU.length=0;for(var i=2*Math.PI/n,r=0;r<n;++r)zU.push(new Mn(e.x*Math.cos(i*r)+t.x,e.y*Math.sin(i*r)+t.y,0));return zU}(new Mn(o+i/2,s+r/2,0),new Mn(i/2,r/2,0),this._segments),l=0;l<c.length;++l){var h=c[l];0===l?e.moveTo(h.x,h.y):e.lineTo(h.x,h.y)}e.close()}e.fill()}},n._createClearModel=function(){if(!this._clearModel){var t=Uv.get("default-clear-stencil");this._clearStencilMtl=new wy({parent:t,owner:this,subModelIdx:0}),this._clearModel=TO.root.createModel(Cy),this._clearModel.node=this._clearModel.transform=this.node;var e=aV(tV),n=h.director.root.device,i=n.createBuffer(new gr(yi.VERTEX|yi.TRANSFER_DST,Ai.DEVICE,4*e,e)),r=new Float32Array([-1,-1,0,1,-1,0,-1,1,0,1,1,0]);i.update(r);var a=n.createBuffer(new gr(yi.INDEX|yi.TRANSFER_DST,Ai.DEVICE,6*Uint16Array.BYTES_PER_ELEMENT,Uint16Array.BYTES_PER_ELEMENT)),o=new Uint16Array([0,1,2,2,1,3]);a.update(o),this._clearModelMesh=new Aw([i],tV,Gi.TRIANGLE_LIST,a),this._clearModelMesh.subMeshIdx=0,this._clearModel.initSubModel(0,this._clearModelMesh,this._clearStencilMtl)}},n._updateMaterial=function(){if(this._graphics){var t,e=this._graphics;e.stencilStage=xV.DISABLED,this._type===BU.IMAGE_STENCIL?(t=Uv.get("ui-alpha-test-material"),e.setMaterial(t,0),(t=e.getMaterialInstance(0)).setProperty("alphaThreshold",this._alphaThreshold)):(t=Uv.get("ui-graphics-material"),e.setMaterial(t,0),e.getMaterialInstance(0))}},n._enableGraphics=function(){this._graphics&&(this._graphics._renderFlag=this._graphics._canRender())},n._disableGraphics=function(){this._graphics&&this._graphics.onDisable()},n._removeGraphics=function(){this._graphics&&(this._graphics.destroy(),this._graphics._destroyImmediate(),this._graphics=null)},n._useRenderData=function(){this._type!==BU.IMAGE_STENCIL||this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData())},Q(e,[{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this.markForUpdateRenderData(!1),this._updateMaterial(),this._type!==BU.IMAGE_STENCIL?(this._spriteFrame=null,this._updateGraphics(),this._renderData&&(this.destroyRenderData(),this._renderData=null)):(this._useRenderData(),this._graphics&&this._graphics.clear()))}},{key:"inverted",get:function(){return this._inverted},set:function(t){this._inverted=t,this.stencilStage=xV.DISABLED,this._graphics&&(this._graphics.stencilStage=xV.DISABLED)}},{key:"segments",get:function(){return this._segments},set:function(t){this._segments!==t&&(this._segments=un(t,3,1e4),this._updateGraphics())}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var e=this._spriteFrame;this._spriteFrame=t,this._type===BU.IMAGE_STENCIL&&!e&&t&&this.markForUpdateRenderData()}}},{key:"alphaThreshold",get:function(){return this._alphaThreshold},set:function(t){this._alphaThreshold!==t&&(this._alphaThreshold=t,this.type===BU.IMAGE_STENCIL&&this._graphics&&this._graphics.getMaterialInstance(0).setProperty("alphaThreshold",this._alphaThreshold))}},{key:"graphics",get:function(){return this._graphics}},{key:"dstBlendFactor",get:function(){return this._dstBlendFactor},set:function(t){this._dstBlendFactor!==t&&(this._dstBlendFactor=t,this._updateBlendFunc())}},{key:"srcBlendFactor",get:function(){return this._srcBlendFactor},set:function(t){this._srcBlendFactor!==t&&(this._srcBlendFactor=t,this._updateBlendFunc())}},{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this.markForUpdateRenderData())}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(){}}]),e}(xk),EU.Type=BU,lt((xU=wU).prototype,"type",[cU,lU],Object.getOwnPropertyDescriptor(xU.prototype,"type"),xU.prototype),lt(xU.prototype,"inverted",[hU,uU],Object.getOwnPropertyDescriptor(xU.prototype,"inverted"),xU.prototype),lt(xU.prototype,"segments",[_U],Object.getOwnPropertyDescriptor(xU.prototype,"segments"),xU.prototype),lt(xU.prototype,"spriteFrame",[fU,dU],Object.getOwnPropertyDescriptor(xU.prototype,"spriteFrame"),xU.prototype),lt(xU.prototype,"alphaThreshold",[pU,mU,tl],Object.getOwnPropertyDescriptor(xU.prototype,"alphaThreshold"),xU.prototype),lt(xU.prototype,"color",[hl,vU],Object.getOwnPropertyDescriptor(xU.prototype,"color"),xU.prototype),lt(xU.prototype,"customMaterial",[hl,gU],Object.getOwnPropertyDescriptor(xU.prototype,"customMaterial"),xU.prototype),SU=lt(xU.prototype,"_type",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return BU.RECT}}),AU=lt(xU.prototype,"_inverted",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),bU=lt(xU.prototype,"_segments",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),CU=lt(xU.prototype,"_spriteFrame",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),TU=lt(xU.prototype,"_alphaThreshold",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),yU=xU))||yU)||yU)||yU)||yU));sD._maskComp=kU,h.Mask=kU;var UU,GU,HU,jU,WU,qU,XU,YU,KU,JU,QU,ZU,$U,tG,eG,nG,iG,rG,aG,oG,sG,cG,lG,hG,uG,_G,fG,dG,pG,mG,vG,gG,yG,xG,SG,AG,bG,CG,TG,EG,wG,IG,PG,DG,RG,MG,OG,NG,BG,LG,FG,VG,zG,kG,UG,GG,HG,jG,WG,qG,XG,YG,KG=/^(click)(\s)*=|(param)(\s)*=/,JG=/(\s)*src(\s)*=|(\s)*height(\s)*=|(\s)*width(\s)*=|(\s)*align(\s)*=|(\s)*offset(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/,QG=t("HtmlTextParser",function(){function t(){this._specialSymbolArray=[],this._stack=[],this._resultObjectArray=[],this._specialSymbolArray.push([/&lt;/g,"<"]),this._specialSymbolArray.push([/&gt;/g,">"]),this._specialSymbolArray.push([/&amp;/g,"&"]),this._specialSymbolArray.push([/&quot;/g,'"']),this._specialSymbolArray.push([/&apos;/g,"'"])}var e=t.prototype;return e.parse=function(t){this._resultObjectArray.length=0,this._stack.length=0;for(var e=0,n=t.length;e<n;){var i=t.indexOf(">",e),r=-1;if(i>=0&&(r=t.lastIndexOf("<",i))<e-1&&(r=t.indexOf("<",i+1),i=t.indexOf(">",r+1)),r<0)this._stack.pop(),this._processResult(t.substring(e)),e=n;else{var a=t.substring(e,r),o=t.substring(r+1,i);""===o&&(a=t.substring(e,i+1)),this._processResult(a),-1===i?i=r:"/"===t.charAt(r+1)?this._stack.pop():this._addToStack(o),e=i+1}}return this._resultObjectArray},e._attributeToObject=function(t){t=t.trim();var e={},n=/^(color|size)(\s)*=/.exec(t),i="",r=0,a="";if(n){if(i=n[0],""===(t=t.substring(i.length).trim()))return e;switch(r=t.indexOf(" "),i[0]){case"c":e.color=r>-1?t.substring(0,r).trim():t;break;case"s":e.size=parseInt(t)}return r>-1&&(a=t.substring(r+1).trim(),e.event=this._processEventHandler(a)),e}if((n=/^(br(\s)*\/)/.exec(t))&&n[0].length>0&&(i=n[0].trim()).startsWith("br")&&"/"===i[i.length-1])return e.isNewLine=!0,this._resultObjectArray.push({text:"",style:{isNewLine:!0}}),e;var o="",s=-1;if((n=/^(img(\s)*src(\s)*=[^>]+\/)/.exec(t))&&n[0].length>0&&(i=n[0].trim()).startsWith("img")&&"/"===i[i.length-1]){var c;n=JG.exec(t);for(var l=!1;n;){var h=(i=(t=t.substring(t.indexOf(n[0]))).substr(0,n[0].length)).length;if(i=(i=i.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),o=t.substring(h).trim(),s="src"===i?this.getRightQuotationIndex(o):-1,c=(r=o.indexOf(" ",s+1>=o.length?-1:s+1))>-1?o.substr(0,r):o,t=o.substring(r).trim(),c.endsWith("/")&&(c=c.slice(0,-1)),"src"===i){switch(c.charCodeAt(0)){case 34:case 39:l=!0,c=c.slice(1,-1)}e.isImage=!0,e.src=c}else if("height"===i)e.imageHeight=parseInt(c);else if("width"===i)e.imageWidth=parseInt(c);else if("align"===i){switch(c.charCodeAt(0)){case 34:case 39:c=c.slice(1,-1)}e.imageAlign=c.toLowerCase()}else"offset"===i?e.imageOffset=c:"click"===i&&(e.event=this._processEventHandler(i+"="+c));e.event&&"param"===i&&(e.event[i]=c.replace(/^"|"$/g,"")),n=JG.exec(t)}return l&&e.isImage&&this._resultObjectArray.push({text:"",style:e}),{}}if(n=/^(outline(\s)*[^>]*)/.exec(t)){var u={color:"#ffffff",width:1};if(t=n[0].substring("outline".length).trim()){var _,f=/(\s)*color(\s)*=|(\s)*width(\s)*=|(\s)*click(\s)*=|(\s)*param(\s)*=/;for(n=f.exec(t);n;)i=(t=t.substring(t.indexOf(n[0]))).substr(0,n[0].length),_=(r=(o=t.substring(i.length).trim()).indexOf(" "))>-1?o.substr(0,r):o,i=(i=i.replace(/[^a-zA-Z]/g,"").trim()).toLowerCase(),t=o.substring(r).trim(),"click"===i?e.event=this._processEventHandler(i+"="+_):"color"===i?u.color=_:"width"===i&&(u.width=parseInt(_)),e.event&&"param"===i&&(e.event[i]=_.replace(/^"|"$/g,"")),n=f.exec(t)}e.outline=u}if((n=/^(on|u|b|i)(\s)*/.exec(t))&&n[0].length>0){switch(i=n[0],t=t.substring(i.length).trim(),i[0]){case"u":e.underline=!0;break;case"i":e.italic=!0;break;case"b":e.bold=!0}if(""===t)return e;e.event=this._processEventHandler(t)}return e},e.getRightQuotationIndex=function(t){var e=-1,n=-1,i=t.indexOf("'"),r=t.indexOf('"'),a=r>-1&&(r<i||-1===i);return i>-1&&(i<r||-1===r)?(e=i,n=t.indexOf("'",e+1>=t.length?-1:e+1)):a&&(e=r,n=t.indexOf('"',e+1>=t.length?-1:e+1)),n},e._processEventHandler=function(t){for(var e={},n=0,i=!1,r=KG.exec(t);r;){var a=r[0],o="";if(i=!1,'"'===(t=t.substring(a.length).trim()).charAt(0))(n=t.indexOf('"',1))>-1&&(o=t.substring(1,n).trim(),i=!0),n++;else if("'"===t.charAt(0))(n=t.indexOf("'",1))>-1&&(o=t.substring(1,n).trim(),i=!0),n++;else{var s=/(\S)+/.exec(t);n=(o=s?s[0]:"").length}i&&(e[a=a.substring(0,a.length-1).trim()]=o),t=t.substring(n).trim(),r=KG.exec(t)}return e},e._addToStack=function(t){var e=this._attributeToObject(t);if(0===this._stack.length)this._stack.push(e);else{if(e.isNewLine||e.isImage)return;var n=this._stack[this._stack.length-1];for(var i in n)e[i]||(e[i]=n[i]);this._stack.push(e)}},e._processResult=function(t){0!==t.length&&(t=this._escapeSpecialSymbol(t),this._stack.length>0?this._resultObjectArray.push({text:t,style:this._stack[this._stack.length-1]}):this._resultObjectArray.push({text:t}))},e._escapeSpecialSymbol=function(t){for(var e,n=st(this._specialSymbolArray);!(e=n()).done;){var i=e.value,r=i[0],a=i[1];t=t.replace(r,a)}return t},t}()),ZG=function(e){return t({LabelOutline:e,LabelOutlineComponent:e}),e}((UU=Ec("cc.LabelOutline"),GU=jc(),HU=Ic(110),jU=kc(),WU=wc(Ck),qU=Kc(),XU=Kc(),UU(YU=GU(YU=HU(YU=jU(YU=WU(YU=zc((ZU=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_color",JU,at(e)),ct(e,"_width",QU,at(e)),e}$(e,t);var n=e.prototype;return n.onEnable=function(){this._updateRenderData()},n.onDisable=function(){this._updateRenderData()},n._updateRenderData=function(){var t=this.node.getComponent(Ck);t&&t.updateRenderData(!0)},Q(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"width",get:function(){return this._width},set:function(t){this._width!==t&&(this._width=t,this._updateRenderData())}}]),e}(xu),JU=lt((KU=ZU).prototype,"_color",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn(0,0,0,255)}}),QU=lt(KU.prototype,"_width",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),lt(KU.prototype,"color",[qU],Object.getOwnPropertyDescriptor(KU.prototype,"color"),KU.prototype),lt(KU.prototype,"width",[XU],Object.getOwnPropertyDescriptor(KU.prototype,"width"),KU.prototype),YU=KU))||YU)||YU)||YU)||YU)||YU)||YU));h.LabelOutline=ZG,function(t){t[t.SIMPLE=0]="SIMPLE",t[t.SLICED=1]="SLICED",t[t.TILED=2]="TILED",t[t.FILLED=3]="FILLED"}(WG||(WG={})),he(WG),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.RADIAL=2]="RADIAL"}(qG||(qG={})),he(qG),function(t){t[t.CUSTOM=0]="CUSTOM",t[t.TRIMMED=1]="TRIMMED",t[t.RAW=2]="RAW"}(XG||(XG={})),he(XG),function(t){t.SPRITE_FRAME_CHANGED="spriteframe-changed"}(YG||(YG={}));var $G,tH=function(e){return t({Sprite:e,SpriteComponent:e}),e}(($U=Ec("cc.Sprite"),tG=jc(),eG=Ic(110),nG=kc(),iG=cl(cF),rG=el(),aG=Kc(),oG=cl(oF),sG=el(),cG=Kc(),lG=cl(WG),hG=el(),uG=Kc(),_G=cl(qG),fG=el(),dG=Kc(),pG=el(),mG=Kc(),vG=Jc(),gG=el(),yG=Kc(),xG=Jc(),SG=el(),AG=Kc(),bG=qc(),CG=el(),TG=Kc(),EG=el(),wG=Kc(),IG=cl(XG),PG=el(),DG=Kc(),$U(RG=tG(RG=eG(RG=nG((jG=HG=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_spriteFrame",OG,at(e)),ct(e,"_type",NG,at(e)),ct(e,"_fillType",BG,at(e)),ct(e,"_sizeMode",LG,at(e)),ct(e,"_fillCenter",FG,at(e)),ct(e,"_fillStart",VG,at(e)),ct(e,"_fillRange",zG,at(e)),ct(e,"_isTrimmedMode",kG,at(e)),ct(e,"_useGrayscale",UG,at(e)),ct(e,"_atlas",GG,at(e)),e}$(e,t);var n=e.prototype;return n.__preload=function(){this.changeMaterialForDefine(),t.prototype.__preload.call(this)},n.onEnable=function(){t.prototype.onEnable.call(this),this._activateMaterial();var e=this._spriteFrame;e&&(this._updateUVs(),this._type===WG.SLICED&&e.on(oF.EVENT_UV_UPDATED,this._updateUVs,this))},n.onDisable=function(){this._spriteFrame&&this._type===WG.SLICED&&this._spriteFrame.off(oF.EVENT_UV_UPDATED,this._updateUVs,this)},n.onDestroy=function(){t.prototype.onDestroy.call(this)},n.changeSpriteFrameFromAtlas=function(t){if(this._atlas){var e=this._atlas.getSpriteFrame(t);this.spriteFrame=e}else console.warn("SpriteAtlas is null.")},n.changeMaterialForDefine=function(){var t,e=this._instanceMaterialType;this._spriteFrame&&(t=this._spriteFrame.texture);var n=!1;if(t instanceof sv){var i=t.getPixelFormat();n=i===km.RGBA_ETC1||i===km.RGB_A_PVRTC_4BPPV1||i===km.RGB_A_PVRTC_2BPPV1}n&&this.grayscale?this._instanceMaterialType=nz.USE_ALPHA_SEPARATED_AND_GRAY:n?this._instanceMaterialType=nz.USE_ALPHA_SEPARATED:this.grayscale?this._instanceMaterialType=nz.GRAYSCALE:this._instanceMaterialType=nz.ADD_COLOR_AND_TEXTURE,e!==this._instanceMaterialType&&this.updateMaterial()},n._updateBuiltinMaterial=function(){var e=t.prototype._updateBuiltinMaterial.call(this);if(this.spriteFrame&&this.spriteFrame.texture instanceof tb){var n=Z({SAMPLE_FROM_RT:!0},e.passes[0].defines),i=new vg;i.initialize({effectAsset:e.effectAsset,defines:n}),e=i}return e},n._render=function(t){t.commitComp(this,this.renderData,this._spriteFrame,this._assembler,null)},n._canRender=function(){if(!t.prototype._canRender.call(this))return!1;var e=this._spriteFrame;return!(!e||!e.texture)},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this.destroyRenderData(),this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.getRenderMaterial(0),this.markForUpdateRenderData(),this.spriteFrame&&this._assembler.updateUVs(this),this._updateColor()),this._spriteFrame&&(this._type===WG.SLICED?this._spriteFrame.on(oF.EVENT_UV_UPDATED,this._updateUVs,this):this._spriteFrame.off(oF.EVENT_UV_UPDATED,this._updateUVs,this))},n._applySpriteSize=function(){if(this._spriteFrame){if(!this._spriteFrame.isDefault)if(XG.RAW===this._sizeMode){var t=this._spriteFrame.originalSize;this.node._uiProps.uiTransformComp.setContentSize(t)}else if(XG.TRIMMED===this._sizeMode){var e=this._spriteFrame.rect;this.node._uiProps.uiTransformComp.setContentSize(e.width,e.height)}this._activateMaterial()}},n._resized=function(){},n._activateMaterial=function(){var t=this._spriteFrame,e=this.getRenderMaterial(0);t&&e&&this.markForUpdateRenderData(),this._renderData&&(this._renderData.material=e)},n._updateUVs=function(){this._assembler&&this._assembler.updateUVs(this)},n._applySpriteFrame=function(t){var e=this._spriteFrame;t&&this._type===WG.SLICED&&t.off(oF.EVENT_UV_UPDATED,this._updateUVs,this),this._updateUVs();var n=!1;e&&(t&&t.texture===e.texture||(n=!0),n&&(this._renderData&&(this._renderData.textureDirty=!0),this.changeMaterialForDefine()),this._applySpriteSize(),this._type===WG.SLICED&&e.on(oF.EVENT_UV_UPDATED,this._updateUVs,this))},Q(e,[{key:"spriteAtlas",get:function(){return this._atlas},set:function(t){this._atlas!==t&&(this._atlas=t)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){if(this._spriteFrame!==t){var e=this._spriteFrame;this._spriteFrame=t,this.markForUpdateRenderData(!1),this._applySpriteFrame(e)}}},{key:"type",get:function(){return this._type},set:function(t){this._type!==t&&(this._type=t,this._flushAssembler())}},{key:"fillType",get:function(){return this._fillType},set:function(t){this._fillType!==t&&(t===qG.RADIAL||this._fillType===qG.RADIAL?(this.destroyRenderData(),this._renderData=null):this._renderData&&this.markForUpdateRenderData(!0)),this._fillType=t,this._flushAssembler()}},{key:"fillCenter",get:function(){return this._fillCenter},set:function(t){this._fillCenter.x=t.x,this._fillCenter.y=t.y,this._type===WG.FILLED&&this._renderData&&this.markForUpdateRenderData()}},{key:"fillStart",get:function(){return this._fillStart},set:function(t){this._fillStart=un(t,0,1),this._type===WG.FILLED&&this._renderData&&(this.markForUpdateRenderData(),this._updateUVs())}},{key:"fillRange",get:function(){return this._fillRange},set:function(t){this._fillRange=un(t,-1,1),this._type===WG.FILLED&&this._renderData&&(this.markForUpdateRenderData(),this._updateUVs())}},{key:"trim",get:function(){return this._isTrimmedMode},set:function(t){this._isTrimmedMode!==t&&(this._isTrimmedMode=t,this._type===WG.SIMPLE&&this._renderData&&this.markForUpdateRenderData(!0))}},{key:"grayscale",get:function(){return this._useGrayscale},set:function(t){this._useGrayscale!==t&&(this._useGrayscale=t,this.changeMaterialForDefine(),this.updateMaterial())}},{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,t!==XG.CUSTOM&&this._applySpriteSize())}}]),e}(xk),HG.FillType=qG,HG.Type=WG,HG.SizeMode=XG,HG.EventType=YG,lt((MG=jG).prototype,"spriteAtlas",[iG,rG,aG],Object.getOwnPropertyDescriptor(MG.prototype,"spriteAtlas"),MG.prototype),lt(MG.prototype,"spriteFrame",[oG,sG,cG],Object.getOwnPropertyDescriptor(MG.prototype,"spriteFrame"),MG.prototype),lt(MG.prototype,"type",[lG,hG,uG],Object.getOwnPropertyDescriptor(MG.prototype,"type"),MG.prototype),lt(MG.prototype,"fillType",[_G,fG,dG],Object.getOwnPropertyDescriptor(MG.prototype,"fillType"),MG.prototype),lt(MG.prototype,"fillCenter",[pG,mG],Object.getOwnPropertyDescriptor(MG.prototype,"fillCenter"),MG.prototype),lt(MG.prototype,"fillStart",[vG,gG,yG],Object.getOwnPropertyDescriptor(MG.prototype,"fillStart"),MG.prototype),lt(MG.prototype,"fillRange",[xG,SG,AG],Object.getOwnPropertyDescriptor(MG.prototype,"fillRange"),MG.prototype),lt(MG.prototype,"trim",[bG,CG,TG],Object.getOwnPropertyDescriptor(MG.prototype,"trim"),MG.prototype),lt(MG.prototype,"grayscale",[Wc,EG,wG],Object.getOwnPropertyDescriptor(MG.prototype,"grayscale"),MG.prototype),lt(MG.prototype,"sizeMode",[IG,PG,DG],Object.getOwnPropertyDescriptor(MG.prototype,"sizeMode"),MG.prototype),OG=lt(MG.prototype,"_spriteFrame",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),NG=lt(MG.prototype,"_type",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return WG.SIMPLE}}),BG=lt(MG.prototype,"_fillType",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return qG.HORIZONTAL}}),LG=lt(MG.prototype,"_sizeMode",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return XG.TRIMMED}}),FG=lt(MG.prototype,"_fillCenter",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn(0,0)}}),VG=lt(MG.prototype,"_fillStart",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zG=lt(MG.prototype,"_fillRange",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kG=lt(MG.prototype,"_isTrimmedMode",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),UG=lt(MG.prototype,"_useGrayscale",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),GG=lt(MG.prototype,"_atlas",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),RG=MG))||RG)||RG)||RG)||RG));h.Sprite=tH;var eH,nH,iH,rH,aH,oH,sH,cH,lH,hH,uH,_H,fH,dH,pH,mH,vH,gH,yH,xH,SH,AH,bH,CH,TH,EH,wH,IH,PH,DH,RH,MH,OH,NH,BH,LH,FH,VH,zH,kH,UH,GH,HH,jH,WH,qH,XH,YH,KH,JH,QH,ZH,$H=t("RenderRoot2D",Ec("cc.RenderRoot2D")($G=Ic(100)($G=kc()($G=wc(LV)($G=Pc($G=zc($G=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.onEnable=function(){h.director.root.batcher2D.addScreen(this)},n.onDisable=function(){h.director.root.batcher2D.removeScreen(this)},n.onDestroy=function(){h.director.root.batcher2D.removeScreen(this)},e}(xu))||$G)||$G)||$G)||$G)||$G)||$G),tj=new Mn,ej=se({OVERLAY:0,INTERSPERSE:1}),nj=function(e){return t({Canvas:e,CanvasComponent:e}),e}((eH=Ec("cc.Canvas"),nH=jc(),iH=Ic(100),rH=kc(),aH=cl(GL),oH=Kc(),sH=Kc(),cH=cl(GL),eH(lH=nH(lH=iH(lH=rH(lH=zc(lH=Pc((lt((hH=function(t){function e(){var e;return ct(e=t.call(this)||this,"_cameraComponent",uH,at(e)),ct(e,"_alignCanvasWithScreen",_H,at(e)),e._thisOnCameraResized=void 0,e._fitDesignResolution=void 0,e._pos=new Mn,e._renderMode=ej.OVERLAY,e._thisOnCameraResized=e._onResizeCamera.bind(at(e)),e}$(e,t);var n=e.prototype;return n.__preload=function(){var t=this.getComponent("cc.Widget");t&&t.updateAlignment(),this._cameraComponent&&(this._cameraComponent._createCamera(),this._cameraComponent.node.on(GL.TARGET_TEXTURE_CHANGE,this._thisOnCameraResized)),this._onResizeCamera(),this.node.on(bC.TRANSFORM_CHANGED,this._thisOnCameraResized)},n.onEnable=function(){t.prototype.onEnable.call(this),this._cameraComponent&&this._cameraComponent.node.on(GL.TARGET_TEXTURE_CHANGE,this._thisOnCameraResized)},n.onDisable=function(){t.prototype.onDisable.call(this),this._cameraComponent&&this._cameraComponent.node.off(GL.TARGET_TEXTURE_CHANGE,this._thisOnCameraResized)},n.onDestroy=function(){t.prototype.onDestroy.call(this),this.node.off(bC.TRANSFORM_CHANGED,this._thisOnCameraResized)},n._onResizeCamera=function(){if(this._cameraComponent&&this._alignCanvasWithScreen){if(this._cameraComponent.targetTexture)this._cameraComponent.orthoHeight=IO.height/2;else{var t=Eu.windowSize;this._cameraComponent.orthoHeight=t.height/BO.getScaleY()/2}this.node.getWorldPosition(tj),this._cameraComponent.node.setWorldPosition(tj.x,tj.y,1e3)}},n._getViewPriority=function(){if(this._cameraComponent){var t,e=null===(t=this.cameraComponent)||void 0===t?void 0:t.priority;return this._renderMode===ej.OVERLAY?e|1<<30:e&~(1<<30)}return 0},Q(e,[{key:"renderMode",get:function(){return this._renderMode},set:function(t){this._renderMode=t,this._cameraComponent&&(this._cameraComponent.priority=this._getViewPriority())}},{key:"cameraComponent",get:function(){return this._cameraComponent},set:function(t){this._cameraComponent!==t&&(this._cameraComponent=t,this._onResizeCamera())}},{key:"alignCanvasWithScreen",get:function(){return this._alignCanvasWithScreen},set:function(t){this._alignCanvasWithScreen=t,this._onResizeCamera()}}]),e}($H)).prototype,"cameraComponent",[aH,oH],Object.getOwnPropertyDescriptor(hH.prototype,"cameraComponent"),hH.prototype),lt(hH.prototype,"alignCanvasWithScreen",[sH],Object.getOwnPropertyDescriptor(hH.prototype,"alignCanvasWithScreen"),hH.prototype),uH=lt(hH.prototype,"_cameraComponent",[cH],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_H=lt(hH.prototype,"_alignCanvasWithScreen",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),lH=hH))||lH)||lH)||lH)||lH)||lH)||lH));h.Canvas=nj,U(t("UIComponent",Ec("cc.UIComponent")(fH=wc(LV)(fH=Ic(110)(fH=Pc(fH=zc(fH=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._lastParent=null,e.stencilStage=xV.DISABLED,e}$(e,t);var n=e.prototype;return n.__preload=function(){this.node._uiProps.uiComp=this},n.onEnable=function(){},n.onDisable=function(){},n.onDestroy=function(){this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null)},n.updateAssembler=function(){},n.postUpdateAssembler=function(){},n.markForUpdateRenderData=function(){},n.setNodeDirty=function(){},n.setTextureDirty=function(){},e}(xu))||fH)||fH)||fH)||fH)||fH).prototype,"UIComponent",[{name:"_visibility"},{name:"setVisibility"}]),U(xk.prototype,"Renderable2D.prototype",[{name:"srcBlendFactor"},{name:"dstBlendFactor"}]),k(nj.prototype,"Canvas.prototype",[{name:"camera",newName:"cameraComponent.camera",customGetter:function(){return this._cameraComponent.camera}},{name:"clearFlag",newName:"cameraComponent.clearFlags",customGetter:function(){return this._cameraComponent?this._cameraComponent.clearFlags:0},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.clearFlags=t)}},{name:"color",newName:"cameraComponent.clearColor",customGetter:function(){return this._cameraComponent?this._cameraComponent.clearColor:Dn.BLACK},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.clearColor=t)}},{name:"priority",newName:"cameraComponent.priority",customGetter:function(){return this._cameraComponent?this._cameraComponent.priority:0},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.priority=t)}},{name:"targetTexture",newName:"cameraComponent.targetTexture",customGetter:function(){return this._cameraComponent?this._cameraComponent.targetTexture:null},customSetter:function(t){this._cameraComponent&&(this._cameraComponent.targetTexture=t)}},{name:"visibility",newName:"cameraComponent.visibility",customGetter:function(){return this._cameraComponent?this._cameraComponent.visibility:0}}]),G(LV.prototype,"UITransform.prototype",[{name:"priority",suggest:"Please use setSiblingIndex to change index of the current node in its parent's children array."}]),h.UITransformComponent=LV,re.setClassAlias(LV,"cc.UITransformComponent"),re.setClassAlias(xk,"cc.RenderComponent"),h.CanvasComponent=nj,re.setClassAlias(nj,"cc.CanvasComponent");var ij=new QG,rj="RICHTEXT_CHILD",aj="RICHTEXT_Image_CHILD",oj=new ne((function(t){if(!h.isValid(t.node))return!1;var e=t.node.getComponent(ZG);return e&&(e.width=0),!0}),20),sj=new ne((function(t){return h.isValid(t.node)}),10);function cj(t){return{node:new TE(t),comp:null,lineCount:0,styleIndex:0,imageOffset:"",clickParam:"",clickHandler:"",type:t}}function lj(t,e){var n;t===rj?n=oj._get():t===aj&&(n=sj._get());var i=(n=n||cj(t)).node;return i||(i=new TE(t)),i.hideFlags|=ml.Flags.DontSave|ml.Flags.HideInHierarchy,t===aj?(n.comp=i.getComponent(tH)||i.addComponent(tH),n.comp.spriteFrame=e,n.comp.type=tH.Type.SLICED,n.comp.sizeMode=tH.SizeMode.CUSTOM):(n.comp=i.getComponent(Ck)||i.addComponent(Ck),n.comp.string=e,n.comp.horizontalAlign=mk.LEFT,n.comp.verticalAlign=vk.TOP,n.comp.underlineHeight=2),i.setPosition(0,0,0),i._uiProps.uiTransformComp.setAnchorPoint(.5,.5),n.node=i,n.lineCount=0,n.styleIndex=0,n.imageOffset="",n.clickParam="",n.clickHandler="",n}var hj,uj=function(e){return t({RichText:e,RichTextComponent:e}),e}((dH=Ec("cc.RichText"),pH=jc(),mH=Ic(110),vH=kc(),gH=Kc(),yH=cl(mk),xH=Kc(),SH=cl(vk),AH=Kc(),bH=Kc(),CH=Kc(),TH=cl(fF),EH=Kc(),wH=Kc(),IH=el(),PH=cl(yk),DH=Kc(),RH=Kc(),MH=Kc(),OH=cl(cF),NH=Kc(),BH=Kc(),dH(LH=pH(LH=mH(LH=vH(LH=zc((ZH=QH=function(t){function e(){var e;return ct(e=t.call(this)||this,"_lineHeight",VH,at(e)),ct(e,"_string",zH,at(e)),ct(e,"_horizontalAlign",kH,at(e)),ct(e,"_verticalAlign",UH,at(e)),ct(e,"_fontSize",GH,at(e)),ct(e,"_maxWidth",HH,at(e)),ct(e,"_fontFamily",jH,at(e)),ct(e,"_font",WH,at(e)),ct(e,"_isSystemFontUsed",qH,at(e)),ct(e,"_userDefinedFont",XH,at(e)),ct(e,"_cacheMode",YH,at(e)),ct(e,"_imageAtlas",KH,at(e)),ct(e,"_handleTouchEvent",JH,at(e)),e._textArray=[],e._segments=[],e._labelSegmentsCache=[],e._linesWidth=[],e._lineCount=1,e._labelWidth=0,e._labelHeight=0,e._layoutDirty=!0,e._lineOffsetX=0,e._updateRichTextStatus=void 0,e._labelChildrenNum=0,e._updateRichTextStatus=e._updateRichText,e}$(e,t);var n=e.prototype;return n.onLoad=function(){this.node.on(bC.LAYER_CHANGED,this._applyLayer,this)},n.onEnable=function(){this.handleTouchEvent&&this._addEventListeners(),this._updateRichText(),this._activateChildren(!0)},n.onDisable=function(){this.handleTouchEvent&&this._removeEventListeners(),this._activateChildren(!1)},n.start=function(){this._onTTFLoaded(),this.node.on(bC.ANCHOR_CHANGED,this._updateRichTextPosition,this)},n.onRestore=function(){},n.onDestroy=function(){for(var t,e=st(this._segments);!(t=e()).done;){var n=t.value;n.node.removeFromParent(),n.type===rj?oj.put(n):n.type===aj&&sj.put(n)}this.node.off(bC.ANCHOR_CHANGED,this._updateRichTextPosition,this),this.node.off(bC.LAYER_CHANGED,this._applyLayer,this)},n._addEventListeners=function(){this.node.on(bC.TOUCH_END,this._onTouchEnded,this)},n._removeEventListeners=function(){this.node.off(bC.TOUCH_END,this._onTouchEnded,this)},n._updateLabelSegmentTextAttributes=function(){var t=this;this._segments.forEach((function(e){t._applyTextAttribute(e)}))},n._createFontLabel=function(t){return lj(rj,t)},n._createImage=function(t){return lj(aj,t)},n._onTTFLoaded=function(){this._font,this._layoutDirty=!0,this._updateRichText()},n.SplitLongStringApproximatelyIn2048=function(t,e){var n=[];if(this._calculateSize(e,t).x<2048)n.push(t);else for(var i=t.split("\n"),r=0;r<i.length;r++)if(this._calculateSize(e,i[r]).x<2048)n.push(i[r]);else{var a=this.splitLongStringOver2048(i[r],e);n.push.apply(n,a)}return n},n.splitLongStringOver2048=function(t,e){for(var n=[],i=t,r=0,a=i.length/2,o=i.substring(r,a),s=i.substring(a),c=this._calculateSize(e,o),l=(this._calculateSize(e,s),1*this.maxWidth);c.x>l;){if((a/=2)<1){a*=2;break}o=o.substring(r,a),s=i.substring(a),c=this._calculateSize(e,o)}for(var h=1e3,u=1;h&&r<t.length;){for(;h&&c.x<l;){var _=HF(s);_&&_.length>0&&(u=_[0].length),a+=u,o=i.substring(r,a),s=i.substring(a),c=this._calculateSize(e,o),h--}for(;h&&o.length>=2&&c.x>l;)a-=u,o=i.substring(r,a),c=this._calculateSize(e,o),u=1,h--;if(o.length>=2){var f=jF(o);f&&f.length>0&&o!==f[0]&&(a-=f[0].length,o=i.substring(r,a))}if(n.push(o),r=a,a+=o.length,o=i.substring(r,a),s=i.substring(a),h--,this._calculateSize(e,s).x<2048){r=t.length,a=t.length,o=s,n.push(o);break}c=this._calculateSize(e,o)}return n},n._measureText=function(t,e){var n=this,i=function(e){return n._calculateSize(t,e).width};return e?i(e):i},n._calculateSize=function(t,e){var n;return 0===this._labelSegmentsCache.length?(n=this._createFontLabel(e),this._labelSegmentsCache.push(n)):(n=this._labelSegmentsCache[0]).node.getComponent(Ck).string=e,n.styleIndex=t,this._applyTextAttribute(n),n.node._uiProps.uiTransformComp.contentSize},n._onTouchEnded=function(t){for(var e,n=this,i=this.node.getComponents(xu),r=function(){var r=e.value,a=r.clickHandler,o=r.clickParam;a&&n._containsTouchLocation(r,t.touch.getUILocation())&&(i.forEach((function(e){var n=e[a];e.enabledInHierarchy&&n&&n.call(e,t,o)})),t.propagationStopped=!0)},a=st(this._segments);!(e=a()).done;)r()},n._containsTouchLocation=function(t,e){var n=t.node.getComponent(LV);return!!n&&n.getBoundingBoxToWorld().contains(e)},n._resetState=function(){for(var t=this.node.children,e=t.length-1;e>=0;e--){var n=t[e];if(n.name===rj||n.name===aj){n.parent===this.node?n.parent=null:t.splice(e,1);var i=cj(n.name);i.node=n,n.name===rj?(i.comp=n.getComponent(Ck),oj.put(i)):(i.comp=n.getComponent(tH),sj.put(i)),this._labelChildrenNum--}}this._segments.length=0,this._labelSegmentsCache.length=0,this._linesWidth.length=0,this._lineOffsetX=0,this._lineCount=1,this._labelWidth=0,this._labelHeight=0,this._layoutDirty=!0},n._activateChildren=function(t){for(var e=this.node.children.length-1;e>=0;e--){var n=this.node.children[e];n.name!==rj&&n.name!==aj||(n.active=t)}},n._addLabelSegment=function(t,e){var n;if(0===this._labelSegmentsCache.length)n=this._createFontLabel(t);else{var i=(n=this._labelSegmentsCache.pop()).node.getComponent(Ck);i&&(i.string=t)}var r=n.comp;return r.verticalAlign!==this._verticalAlign&&(r.verticalAlign=this._verticalAlign),n.styleIndex=e,n.lineCount=this._lineCount,n.node._uiProps.uiTransformComp.setAnchorPoint(0,0),n.node.layer=this.node.layer,this.node.insertChild(n.node,this._labelChildrenNum++),this._applyTextAttribute(n),this._segments.push(n),n},n._updateRichTextWithMaxWidth=function(t,e,n){var i=e;if(this._lineOffsetX>0&&i+this._lineOffsetX>this._maxWidth)for(var r=0;this._lineOffsetX<=this._maxWidth;){var a=this._getFirstWordLen(t,r,t.length),o=t.substr(r,a),s=this._measureText(n,o);if(!(this._lineOffsetX+s<=this._maxWidth)){if(r>0){var c=t.substr(0,r);this._addLabelSegment(c,n),t=t.substr(r,t.length),i=this._measureText(n,t)}this._updateLineInfo();break}this._lineOffsetX+=s,r+=a}if(i>this._maxWidth)for(var l=WF(t,i,this._maxWidth,this._measureText(n)),h=0;h<l.length;++h){var u=l[h],_=this._addLabelSegment(u,n).node._uiProps.uiTransformComp.contentSize;this._lineOffsetX+=_.width,l.length>1&&h<l.length-1&&this._updateLineInfo()}else this._lineOffsetX+=i,this._addLabelSegment(t,n)},n._isLastComponentCR=function(t){return t.length-1===t.lastIndexOf("\n")},n._updateLineInfo=function(){this._linesWidth.push(this._lineOffsetX),this._lineOffsetX=0,this._lineCount++},n._needsUpdateTextLayout=function(t){if(this._layoutDirty||!this._textArray||!t)return!0;if(this._textArray.length!==t.length)return!0;for(var e=0;e<this._textArray.length;e++){var n=this._textArray[e],i=t[e];if(n.text!==i.text)return!0;var r=n.style,a=i.style;if(r){if(a){if(!!a.outline!=!!r.outline)return!0;if(r.size!==a.size||r.italic!==a.italic||r.isImage!==a.isImage)return!0;if(r.src!==a.src||r.imageAlign!==a.imageAlign||r.imageHeight!==a.imageHeight||r.imageWidth!==a.imageWidth||r.imageOffset!==a.imageOffset)return!0}else if(r.size||r.italic||r.isImage||r.outline)return!0}else if(a&&(a.size||a.italic||a.isImage||a.outline))return!0}return!1},n._addRichTextImageElement=function(t){if(t.style){var e=t.style,n=e.src,i=this._imageAtlas&&n&&this._imageAtlas.getSpriteFrame(n);if(i){var r=this._createImage(i);switch(r.comp,e.imageAlign){case"top":r.node._uiProps.uiTransformComp.setAnchorPoint(0,1);break;case"center":r.node._uiProps.uiTransformComp.setAnchorPoint(0,.5);break;default:r.node._uiProps.uiTransformComp.setAnchorPoint(0,0)}e.imageOffset&&(r.imageOffset=e.imageOffset),r.node.layer=this.node.layer,this.node.insertChild(r.node,this._labelChildrenNum++),this._segments.push(r);var a=i.rect.clone(),o=1,s=a.width,c=a.height,l=e.imageWidth||0,h=e.imageHeight||0;h>0?(s*=o=h/c,c*=o):(s*=o=this._lineHeight/c,c*=o),l>0&&(s=l),this._maxWidth>0?(this._lineOffsetX+s>this._maxWidth&&this._updateLineInfo(),this._lineOffsetX+=s):(this._lineOffsetX+=s,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX)),r.node._uiProps.uiTransformComp.setContentSize(s,c),r.lineCount=this._lineCount,r.clickHandler="",r.clickParam="";var u=e.event;u&&(r.clickHandler=u.click,r.clickParam=u.param)}else R(4400)}},n._updateRichText=function(){if(this.enabledInHierarchy){var t=ij.parse(this._string);if(!this._needsUpdateTextLayout(t))return this._textArray=t.slice(),void this._updateLabelSegmentTextAttributes();this._textArray=t.slice(),this._resetState();for(var e,n=!1,i=0;i<this._textArray.length;++i){var r=this._textArray[i],a=r.text;if(void 0!==a){if(""===a){if(r.style&&r.style.isNewLine){this._updateLineInfo();continue}if(r.style&&r.style.isImage&&this._imageAtlas){this._addRichTextImageElement(r);continue}}for(var o=(a=this.SplitLongStringApproximatelyIn2048(a,i).join("\n")).split("\n"),s=0;s<o.length;++s){var c=o[s];if(""!==c)if(n=!1,this._maxWidth>0){var l=this._measureText(i,c);this._updateRichTextWithMaxWidth(c,l,i),o.length>1&&s<o.length-1&&this._updateLineInfo()}else e=this._addLabelSegment(c,i),this._lineOffsetX+=e.node._uiProps.uiTransformComp.width,this._lineOffsetX>this._labelWidth&&(this._labelWidth=this._lineOffsetX),o.length>1&&s<o.length-1&&this._updateLineInfo();else{if(this._isLastComponentCR(a)&&s===o.length-1)continue;this._updateLineInfo(),n=!0}}}}n||this._linesWidth.push(this._lineOffsetX),this._maxWidth>0&&(this._labelWidth=this._maxWidth),this._labelHeight=(this._lineCount+PF)*this._lineHeight,this.node._uiProps.uiTransformComp.setContentSize(this._labelWidth,this._labelHeight),this._updateRichTextPosition(),this._layoutDirty=!1}},n._getFirstWordLen=function(t,e,n){var i=t.charAt(e);if(zF(i)||kF(i))return 1;for(var r=1,a=e+1;a<n&&!kF(i=t.charAt(a))&&!zF(i);++a)r++;return r},n._updateRichTextPosition=function(){for(var t=0,e=1,n=this._lineCount,i=this.node._uiProps.uiTransformComp,r=i.anchorX,a=i.anchorY,o=0;o<this._segments.length;++o){var s=this._segments[o],c=s.lineCount;c>e&&(t=0,e=c);var l=this._labelWidth*(.5*this._horizontalAlign-r);switch(this._horizontalAlign){case mk.LEFT:break;case mk.CENTER:l-=this._linesWidth[c-1]/2;break;case mk.RIGHT:l-=this._linesWidth[c-1]}var h=s.node.position;if(s.node.setPosition(t+l,this._lineHeight*(n-c)-this._labelHeight*a,h.z),c===e&&(t+=s.node._uiProps.uiTransformComp.width),s.node.getComponent(tH)){var u=s.node.position.clone(),_=this._lineHeight,f=this._lineHeight*(1+PF);switch(s.node._uiProps.uiTransformComp.anchorY){case 1:u.y+=_+(f-_)/2;break;case.5:u.y+=f/2;break;default:u.y+=(f-_)/2}if(s.imageOffset){var d=s.imageOffset.split(",");if(1===d.length&&d[0]){var p=parseFloat(d[0]);Number.isInteger(p)&&(u.y+=p)}else if(2===d.length){var m=parseFloat(d[0]),v=parseFloat(d[1]);Number.isInteger(m)&&(u.x+=m),Number.isInteger(v)&&(u.y+=v)}}s.node.position=u}var g=s.node.getComponent(ZG);if(g){var y=s.node.position.clone();y.y-=g.width,s.node.position=y}}},n._convertLiteralColorValue=function(t){var e=t.toUpperCase();return Dn[e]?Dn[e]:(new Dn).fromHEX(t)},n._applyTextAttribute=function(t){var e=t.node.getComponent(Ck);if(e){this._resetLabelState(e);var n,i=t.styleIndex;if(this._textArray[i]&&(n=this._textArray[i].style),n){if(e.color=this._convertLiteralColorValue(n.color||"white"),e.isBold=!!n.bold,e.isItalic=!!n.italic,e.isUnderline=!!n.underline,n.outline){var r=t.node.getComponent(ZG);r||(r=t.node.addComponent(ZG)),r.color=this._convertLiteralColorValue(n.outline.color),r.width=n.outline.width}e.fontSize=n.size||this._fontSize,t.clickHandler="",t.clickParam="";var a=n.event;a&&(t.clickHandler=a.click||"",t.clickParam=a.param||"")}e.cacheMode=this._cacheMode,this._font instanceof fF&&!this._isSystemFontUsed?e.font=this._font:e.fontFamily=this._fontFamily,e.useSystemFont=this._isSystemFontUsed,e.lineHeight=this._lineHeight,e.updateRenderData(!0);var o=e._assembler;o&&o.updateRenderData(e)}},n._applyLayer=function(){for(var t,e=st(this._segments);!(t=e()).done;)t.value.node.layer=this.node.layer},n._resetLabelState=function(t){t.fontSize=this._fontSize,t.color=Dn.WHITE,t.isBold=!1,t.isItalic=!1,t.isUnderline=!1},Q(e,[{key:"string",get:function(){return this._string},set:function(t){this._string!==t&&(this._string=t,this._updateRichTextStatus())}},{key:"horizontalAlign",get:function(){return this._horizontalAlign},set:function(t){this.horizontalAlign!==t&&(this._horizontalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"verticalAlign",get:function(){return this._verticalAlign},set:function(t){this._verticalAlign!==t&&(this._verticalAlign=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontSize",get:function(){return this._fontSize},set:function(t){this._fontSize!==t&&(this._fontSize=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"fontFamily",get:function(){return this._fontFamily},set:function(t){this._fontFamily!==t&&(this._fontFamily=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"font",get:function(){return this._font},set:function(t){this._font!==t&&(this._font=t,this._layoutDirty=!0,this._font?(this.useSystemFont=!1,this._onTTFLoaded()):this.useSystemFont=!0,this._updateRichTextStatus())}},{key:"useSystemFont",get:function(){return this._isSystemFontUsed},set:function(t){this._isSystemFontUsed!==t&&(this._isSystemFontUsed=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"cacheMode",get:function(){return this._cacheMode},set:function(t){this._cacheMode!==t&&(this._cacheMode=t,this._updateRichTextStatus())}},{key:"maxWidth",get:function(){return this._maxWidth},set:function(t){this._maxWidth!==t&&(this._maxWidth=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"lineHeight",get:function(){return this._lineHeight},set:function(t){this._lineHeight!==t&&(this._lineHeight=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"imageAtlas",get:function(){return this._imageAtlas},set:function(t){this._imageAtlas!==t&&(this._imageAtlas=t,this._layoutDirty=!0,this._updateRichTextStatus())}},{key:"handleTouchEvent",get:function(){return this._handleTouchEvent},set:function(t){this._handleTouchEvent!==t&&(this._handleTouchEvent=t,this.enabledInHierarchy&&(this.handleTouchEvent?this._addEventListeners():this._removeEventListeners()))}}]),e}(xu),QH.HorizontalAlign=mk,QH.VerticalAlign=vk,lt((FH=ZH).prototype,"string",[nl,gH],Object.getOwnPropertyDescriptor(FH.prototype,"string"),FH.prototype),lt(FH.prototype,"horizontalAlign",[yH,xH],Object.getOwnPropertyDescriptor(FH.prototype,"horizontalAlign"),FH.prototype),lt(FH.prototype,"verticalAlign",[SH,AH],Object.getOwnPropertyDescriptor(FH.prototype,"verticalAlign"),FH.prototype),lt(FH.prototype,"fontSize",[bH],Object.getOwnPropertyDescriptor(FH.prototype,"fontSize"),FH.prototype),lt(FH.prototype,"fontFamily",[CH],Object.getOwnPropertyDescriptor(FH.prototype,"fontFamily"),FH.prototype),lt(FH.prototype,"font",[TH,EH],Object.getOwnPropertyDescriptor(FH.prototype,"font"),FH.prototype),lt(FH.prototype,"useSystemFont",[wH,IH],Object.getOwnPropertyDescriptor(FH.prototype,"useSystemFont"),FH.prototype),lt(FH.prototype,"cacheMode",[PH,DH],Object.getOwnPropertyDescriptor(FH.prototype,"cacheMode"),FH.prototype),lt(FH.prototype,"maxWidth",[RH],Object.getOwnPropertyDescriptor(FH.prototype,"maxWidth"),FH.prototype),lt(FH.prototype,"lineHeight",[MH],Object.getOwnPropertyDescriptor(FH.prototype,"lineHeight"),FH.prototype),lt(FH.prototype,"imageAtlas",[OH,NH],Object.getOwnPropertyDescriptor(FH.prototype,"imageAtlas"),FH.prototype),lt(FH.prototype,"handleTouchEvent",[BH],Object.getOwnPropertyDescriptor(FH.prototype,"handleTouchEvent"),FH.prototype),VH=lt(FH.prototype,"_lineHeight",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),zH=lt(FH.prototype,"_string",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"<color=#00ff00>Rich</color><color=#0fffff>Text</color>"}}),kH=lt(FH.prototype,"_horizontalAlign",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return mk.LEFT}}),UH=lt(FH.prototype,"_verticalAlign",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return vk.TOP}}),GH=lt(FH.prototype,"_fontSize",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),HH=lt(FH.prototype,"_maxWidth",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jH=lt(FH.prototype,"_fontFamily",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"Arial"}}),WH=lt(FH.prototype,"_font",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qH=lt(FH.prototype,"_isSystemFontUsed",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),XH=lt(FH.prototype,"_userDefinedFont",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),YH=lt(FH.prototype,"_cacheMode",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return yk.NONE}}),KH=lt(FH.prototype,"_imageAtlas",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),JH=lt(FH.prototype,"_handleTouchEvent",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),LH=FH))||LH)||LH)||LH)||LH)||LH));h.RichText=uj;var _j=function(e){return t({UIMeshRenderer:e,UIModelComponent:e}),e}(Ec("cc.UIMeshRenderer")(hj=jc()(hj=Ic(110)(hj=kc()(hj=zc(hj=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._modelComponent=null,e.stencilStage=xV.DISABLED,e}$(e,t);var n=e.prototype;return n.__preload=function(){this.node._uiProps.uiComp=this},n.onLoad=function(){this.node._uiProps.uiTransformComp||this.node.addComponent("cc.UITransform"),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent||console.warn("node '"+(this.node&&this.node.name)+"' doesn't have any renderable component")},n.onDestroy=function(){this.node._uiProps.uiComp===this&&(this.node._uiProps.uiComp=null),this._modelComponent=this.getComponent("cc.RenderableComponent"),this._modelComponent&&(this._modelComponent._sceneGetter=null)},n.updateAssembler=function(t){if(this._modelComponent){var e=this._modelComponent._collectModels();this._modelComponent._detachFromScene();for(var n=0;n<e.length;n++)e[n].enabled&&t.commitModel(this,e[n],this._modelComponent.material);return!0}return!1},n.postUpdateAssembler=function(){},n.update=function(){this._fitUIRenderQueue()},n._fitUIRenderQueue=function(){if(this._modelComponent)for(var t=this._modelComponent.sharedMaterials.length,e=0;e<t;e++){var n=this._modelComponent.getMaterialInstance(e);if(null!=n)for(var i=n.passes,r=i.length,a=0;a<r;a++)i[a]._priority=Wd.MAX-11,n.recompileShaders({CC_FORCE_FORWARD_SHADING:!0},a)}},n.markForUpdateRenderData=function(){},n.setNodeDirty=function(){},n.setTextureDirty=function(){},Q(e,[{key:"modelComponent",get:function(){return this._modelComponent}}]),e}(xu))||hj)||hj)||hj)||hj)||hj);h.UIMeshRenderer=_j;var fj,dj,pj,mj,vj,gj,yj,xj,Sj,Aj,bj,Cj,Tj,Ej,wj,Ij,Pj,Dj,Rj,Mj,Oj,Nj,Bj,Lj,Fj,Vj,zj,kj,Uj,Gj=Hd.Enum.NONE|Hd.Enum.UI_3D,Hj=t("UIDrawBatch",function(){function t(){this.bufferBatch=null,this.camera=null,this.renderScene=null,this.model=null,this.texture=null,this.sampler=null,this.useLocalData=null,this.isStatic=!1,this.textureHash=0,this.samplerHash=0,this._passes=[],this._shaders=[],this._visFlags=Gj,this._inputAssembler=null,this._descriptorSet=null}var e=t.prototype;return e.destroy=function(){this._passes=[]},e.clear=function(){this.bufferBatch=null,this.inputAssembler=null,this.descriptorSet=null,this.camera=null,this.texture=null,this.sampler=null,this.textureHash=0,this.samplerHash=0,this.model=null,this.isStatic=!1,this.useLocalData=null,this.visFlags=Gj,this.renderScene=null},e.fillPasses=function(t,e,n,i,r,a){if(t){var o=t.passes;if(!o)return;var s=0;this._shaders.length=o.length;for(var c=0;c<o.length;c++){this._passes[c]||(this._passes[c]=new Yv(h.director.root));var l=o[c],u=this._passes[c];l.update(),e||(e=l.depthStencilState,n=0),i||(i=l.blendState,r=0),-1===r&&(r=0),s=n<<16|r,u._initPassFromTarget(l,e,i,s),this._shaders[c]=u.getShaderVariant(a)}}},Q(t,[{key:"native",get:function(){return this._nativeObj}},{key:"inputAssembler",get:function(){return this._inputAssembler},set:function(t){this._inputAssembler=t}},{key:"descriptorSet",get:function(){return this._descriptorSet},set:function(t){this._descriptorSet=t}},{key:"visFlags",get:function(){return this._visFlags},set:function(t){this._visFlags=t}},{key:"passes",get:function(){return this._passes}},{key:"shaders",get:function(){return this._shaders}}]),t}()),jj=function(e){return t({UIStaticBatch:e,UIStaticBatchComponent:e}),e}((fj=Ec("cc.UIStaticBatch"),dj=jc(),pj=kc(),mj=Ic(110),vj=qc(),fj(gj=dj(gj=pj(gj=mj((lt((yj=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._init=!1,e._bufferAccessor=null,e._dirty=!0,e._uiDrawBatchList=[],e}$(e,t);var n=e.prototype;return n.onLoad=function(){},n.onDestroy=function(){},n.updateAssembler=function(){},n.postUpdateAssembler=function(){},n.markAsDirty=function(){},n._requireDrawBatch=function(){var t=new Hj;return t.isStatic=!0,this._uiDrawBatchList.push(t),t},n._clearData=function(){if(this._bufferAccessor){this._bufferAccessor.reset();for(var t=this._getBatcher(),e=0;e<this._uiDrawBatchList.length;e++)this._uiDrawBatchList[e].destroy(t)}this._uiDrawBatchList.length=0,this._init=!1},n._getBatcher=function(){return TO.root&&TO.root.batcher2D?TO.root.batcher2D:(R(9301),null)},Q(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&this._color.set(t)}},{key:"drawBatchList",get:function(){return this._uiDrawBatchList}}]),e}(xk)).prototype,"color",[hl,vj],Object.getOwnPropertyDescriptor(yj.prototype,"color"),yj.prototype),gj=yj))||gj)||gj)||gj)||gj)),Wj=t("LabelShadow",(xj=Ec("cc.LabelShadow"),Sj=jc(),Aj=Ic(110),bj=kc(),Cj=wc(Ck),Tj=Kc(),Ej=Kc(),wj=Kc(),xj(Ij=Sj(Ij=Aj(Ij=bj(Ij=Cj(Ij=zc((Oj=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_color",Dj,at(e)),ct(e,"_offset",Rj,at(e)),ct(e,"_blur",Mj,at(e)),e}$(e,t);var n=e.prototype;return n.onEnable=function(){this._updateRenderData()},n.onDisable=function(){this._updateRenderData()},n._updateRenderData=function(){var t=this.node.getComponent(Ck);t&&t.updateRenderData(!0)},Q(e,[{key:"color",get:function(){return this._color},set:function(t){this._color!==t&&(this._color.set(t),this._updateRenderData())}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset=t,this._updateRenderData()}},{key:"blur",get:function(){return this._blur},set:function(t){this._blur=t,this._updateRenderData()}}]),e}(xu),Dj=lt((Pj=Oj).prototype,"_color",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn(0,0,0,255)}}),Rj=lt(Pj.prototype,"_offset",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn(2,2)}}),Mj=lt(Pj.prototype,"_blur",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),lt(Pj.prototype,"color",[Tj],Object.getOwnPropertyDescriptor(Pj.prototype,"color"),Pj.prototype),lt(Pj.prototype,"offset",[Ej],Object.getOwnPropertyDescriptor(Pj.prototype,"offset"),Pj.prototype),lt(Pj.prototype,"blur",[wj],Object.getOwnPropertyDescriptor(Pj.prototype,"blur"),Pj.prototype),Ij=Pj))||Ij)||Ij)||Ij)||Ij)||Ij)||Ij)),qj=function(e){return t({UIOpacity:e,UIOpacityComponent:e}),e}((Nj=Ec("cc.UIOpacity"),Bj=jc(),Lj=Ic(110),Fj=kc(),Vj=Kc(),Nj(zj=Bj(zj=Lj(zj=Fj(zj=zc(zj=Pc((lt((kj=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_opacity",Uj,at(e)),e}$(e,t);var n=e.prototype;return n.onEnable=function(){this.node._uiProps.localOpacity=this._opacity/255},n.onDisable=function(){this.node._uiProps.localOpacity=1},Q(e,[{key:"opacity",get:function(){return this._opacity},set:function(t){this._opacity!==t&&(t=Ce(t,0,255),this._opacity=t,this.node._uiProps.localOpacity=t/255)}}]),e}(xu)).prototype,"opacity",[Wc,Vj],Object.getOwnPropertyDescriptor(kj.prototype,"opacity"),kj.prototype),Uj=lt(kj.prototype,"_opacity",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 255}}),zj=kj))||zj)||zj)||zj)||zj)||zj)||zj));h.MaskComponent=kU,re.setClassAlias(kU,"cc.MaskComponent"),h.LabelComponent=Ck,re.setClassAlias(Ck,"cc.LabelComponent"),h.LabelOutlineComponent=ZG,re.setClassAlias(ZG,"cc.LabelOutlineComponent"),h.RichTextComponent=uj,re.setClassAlias(uj,"cc.RichTextComponent"),h.SpriteComponent=tH,re.setClassAlias(tH,"cc.SpriteComponent"),h.UIModelComponent=_j,re.setClassAlias(_j,"cc.UIModelComponent"),h.GraphicsComponent=NU,re.setClassAlias(NU,"cc.GraphicsComponent"),re.setClassAlias(jj,"cc.UIStaticBatchComponent"),re.setClassAlias(qj,"cc.UIOpacityComponent");var Xj=function(t,e,n){this.i=void 0,this.x=void 0,this.y=void 0,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1,this.i=t,this.x=e,this.y=n};function Yj(t,e,n,i,r){var a=0,o=null;if(r===function(t,e,n,i){for(var r=0,a=e,o=n-i;a<n;a+=i)r+=(t[o]-t[a])*(t[a+1]+t[o+1]),o=a;return r}(t,e,n,i)>0)for(a=e;a<n;a+=i)o=_W(a,t[a],t[a+1],o);else for(a=n-i;a>=e;a-=i)o=_W(a,t[a],t[a+1],o);return o&&cW(o,o.next)&&(fW(o),o=o.next),o}function Kj(t,e){if(void 0===e&&(e=null),!t)return t;e||(e=t);var n=t,i=!1;do{if(i=!1,n.steiner||!cW(n,n.next)&&0!==sW(n.prev,n,n.next))n=n.next;else{if(fW(n),(n=e=n.prev)===n.next)return null;i=!0}}while(i||n!==e);return e}function Jj(t,e,n,i,r,a,o){if(void 0===o&&(o=0),t){!o&&a&&function(t,e,n,i){var r=t;do{null===r.z&&(r.z=iW(r.x,r.y,e,n,i)),r.prevZ=r.prev,r.nextZ=r.next,r=r.next}while(r!==t);r.prevZ.nextZ=null,r.prevZ=null,function(t){var e=0,n=null,i=null,r=null,a=null,o=0,s=0,c=0,l=1;do{for(n=t,t=null,a=null,o=0;n;){for(o++,i=n,s=0,e=0;e<l&&(s++,i=i.nextZ);e++);for(c=l;s>0||c>0&&i;)0===s?(r=i,i=i.nextZ,c--):0!==c&&i?n.z<=i.z?(r=n,n=n.nextZ,s--):(r=i,i=i.nextZ,c--):(r=n,n=n.nextZ,s--),a?a.nextZ=r:t=r,r.prevZ=a,a=r;n=i}a.nextZ=null,l*=2}while(o>1)}(r)}(t,i,r,a);for(var s=t,c=null,l=null;t.prev!==t.next;)if(c=t.prev,l=t.next,a?Zj(t,i,r,a):Qj(t))e.push(c.i/n),e.push(t.i/n),e.push(l.i/n),fW(t),t=l.next,s=l.next;else if((t=l)===s){o?1===o?Jj(t=$j(t,e,n),e,n,i,r,a,2):2===o&&tW(t,e,n,i,r,a):Jj(Kj(t),e,n,i,r,a,1);break}}}function Qj(t){var e=t.prev,n=t,i=t.next;if(sW(e,n,i)>=0)return!1;for(var r=t.next.next;r!==t.prev;){if(aW(e.x,e.y,n.x,n.y,i.x,i.y,r.x,r.y)&&sW(r.prev,r,r.next)>=0)return!1;r=r.next}return!0}function Zj(t,e,n,i){var r=t.prev,a=t,o=t.next;if(sW(r,a,o)>=0)return!1;for(var s=r.x<a.x?r.x<o.x?r.x:o.x:a.x<o.x?a.x:o.x,c=r.y<a.y?r.y<o.y?r.y:o.y:a.y<o.y?a.y:o.y,l=r.x>a.x?r.x>o.x?r.x:o.x:a.x>o.x?a.x:o.x,h=r.y>a.y?r.y>o.y?r.y:o.y:a.y>o.y?a.y:o.y,u=iW(s,c,e,n,i),_=iW(l,h,e,n,i),f=t.nextZ;f&&f.z<=_;){if(f!==t.prev&&f!==t.next&&aW(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&sW(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(f=t.prevZ;f&&f.z>=u;){if(f!==t.prev&&f!==t.next&&aW(r.x,r.y,a.x,a.y,o.x,o.y,f.x,f.y)&&sW(f.prev,f,f.next)>=0)return!1;f=f.prevZ}return!0}function $j(t,e,n){var i=t;do{var r=i.prev,a=i.next.next;!cW(r,a)&&lW(r,i,i.next,a)&&hW(r,a)&&hW(a,r)&&(e.push(r.i/n),e.push(i.i/n),e.push(a.i/n),fW(i),fW(i.next),i=t=a),i=i.next}while(i!==t);return i}function tW(t,e,n,i,r,a){var o=t;do{for(var s=o.next.next;s!==o.prev;){if(o.i!==s.i&&oW(o,s)){var c=uW(o,s);return o=Kj(o,o.next),c=Kj(c,c.next),Jj(o,e,n,i,r,a),void Jj(c,e,n,i,r,a)}s=s.next}o=o.next}while(o!==t)}function eW(t,e){return t.x-e.x}function nW(t,e){if(e=function(t,e){var n=e,i=t.x,r=t.y,a=-1/0,o=null;do{if(r<=n.y&&r>=n.next.y){var s=n.x+(r-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(s<=i&&s>a){if(a=s,s===i){if(r===n.y)return n;if(r===n.next.y)return n.next}o=n.x<n.next.x?n:n.next}}n=n.next}while(n!==e);if(!o)return null;if(i===a)return o.prev;var c,l=o,h=o.x,u=o.y,_=1/0;for(n=o.next;n!==l;)i>=n.x&&n.x>=h&&aW(r<u?i:a,r,h,u,r<u?a:i,r,n.x,n.y)&&((c=Math.abs(r-n.y)/(i-n.x))<_||c===_&&n.x>o.x)&&hW(n,t)&&(o=n,_=c),n=n.next;return o}(t,e)){var n=uW(e,t);Kj(n,n.next)}}function iW(t,e,n,i,r){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)/r)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-i)/r)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function rW(t){var e=t,n=t;do{e.x<n.x&&(n=e),e=e.next}while(e!==t);return n}function aW(t,e,n,i,r,a,o,s){return(r-o)*(e-s)-(t-o)*(a-s)>=0&&(t-o)*(i-s)-(n-o)*(e-s)>=0&&(n-o)*(a-s)-(r-o)*(i-s)>=0}function oW(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&lW(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&hW(t,e)&&hW(e,t)&&function(t,e){var n=t,i=!1,r=(t.x+e.x)/2,a=(t.y+e.y)/2;do{n.y>a!=n.next.y>a&&r<(n.next.x-n.x)*(a-n.y)/(n.next.y-n.y)+n.x&&(i=!i),n=n.next}while(n!==t);return i}(t,e)}function sW(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function cW(t,e){return t.x===e.x&&t.y===e.y}function lW(t,e,n,i){return!!(cW(t,e)&&cW(n,i)||cW(t,i)&&cW(n,e))||sW(t,e,n)>0!=sW(t,e,i)>0&&sW(n,i,t)>0!=sW(n,i,e)>0}function hW(t,e){return sW(t.prev,t,t.next)<0?sW(t,e,t.next)>=0&&sW(t,t.prev,e)>=0:sW(t,e,t.prev)<0||sW(t,t.next,e)<0}function uW(t,e){var n=new Xj(t.i,t.x,t.y),i=new Xj(e.i,e.x,e.y),r=t.next,a=e.prev;return t.next=e,e.prev=t,n.next=r,r.prev=n,i.next=n,n.prev=i,a.next=i,i.prev=a,i}function _W(t,e,n,i){var r=new Xj(t,e,n);return i?(r.next=i.next,r.prev=i,i.next.prev=r,i.next=r):(r.prev=r,r.next=r),r}function fW(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function dW(t,e,n){n=n||3;var i=e?e.length:0,r=i?e[0]*n:t.length,a=Yj(t,0,r,n,!0),o=[];if(!a)return o;var s=0,c=0,l=0,h=0,u=0,_=0,f=0;if(i&&(a=function(t,e,n,i){var r,a=[],o=0,s=null;for(o=0,r=e.length;o<r;o++)(s=Yj(t,e[o]*i,o<r-1?e[o+1]*i:t.length,i,!1))&&(s===s.next&&(s.steiner=!0),a.push(rW(s)));if(a.sort(eW),!n)return n;for(o=0;o<a.length;o++)nW(a[o],n),n=Kj(n,n.next);return n}(t,e,a,n)),t.length>80*n){s=l=t[0],c=h=t[1];for(var d=n;d<r;d+=n)(u=t[d])<s&&(s=u),(_=t[d+1])<c&&(c=_),u>l&&(l=u),_>h&&(h=_);f=Math.max(l-s,h-c)}return Jj(a,o,n,s,c,f),o}for(var pW=Math.PI,mW=Math.min,vW=Math.max,gW=Math.ceil,yW=Math.acos,xW=Math.cos,SW=Math.sin,AW=Math.atan2,bW=null,CW=null,TW=new Dn,EW=[],wW=0;wW<4;wW++)EW.push(new Mn);function IW(t,e,n){return t<e?e:t>n?n:t}var PW={useModel:!0,updateRenderData:function(){},fillBuffers:function(){},renderIA:function(){},getRenderData:function(t,e){if(!CW)return null;var n=CW.getRenderDataList(),i=n[CW.dataOffset];if(!i)return null;var r=i,a=r?r.vertexStart+e:0;return(a>65535||3*a>131070)&&(++CW.dataOffset,CW.dataOffset<n.length?i=n[CW.dataOffset]:(i=CW.requestRenderData(),n[CW.dataOffset]=i),r=i),r&&r.vertexCount<a&&r.request(e,3*e),i},stroke:function(t){Dn.copy(TW,t.strokeColor),t.impl&&(this._flattenPaths(t.impl),this._expandStroke(t),t.impl.updatePathOffset=!0,this.end(t))},fill:function(t){Dn.copy(TW,t.fillColor),this._expandFill(t),t.impl&&(t.impl.updatePathOffset=!0),this.end(t)},end:function(t){t.markForUpdateRenderData()},_expandStroke:function(t){var e,n,i,r,a=.5*t.lineWidth,o=t.lineCap,s=t.lineJoin,c=t.miterLimit;if(CW=t.impl){var l=(e=a,n=pW,i=CW.tessTol,r=2*yW(e/(e+i)),vW(2,gW(n/r)));this._calculateJoins(CW,a,s,c);for(var h=CW.paths,u=0,_=CW.pathOffset,f=CW.pathLength;_<f;_++){var d=h[_],p=d.points.length;s===Ak.ROUND?u+=2*(p+d.bevel*(l+2)+1):u+=2*(p+5*d.bevel+1),d.closed||(o===Sk.ROUND?u+=2*(2*l+2):u+=12)}var m=bW=this.getRenderData(t,u);if(m){for(var v=m.vData,g=m.iData,y=CW.pathOffset,x=CW.pathLength;y<x;y++){var S=h[y],A=S.points,b=A.length,C=m.vertexStart,T=void 0,E=void 0,w=0,I=0,P=S.closed;if(P?(T=A[b-1],E=A[0],w=0,I=b):(T=A[0],E=A[1],w=1,I=b-1),E=E||T,!P){var D=new IU(E.x,E.y);D.subtract(T),D.normalize();var R=D.x,M=D.y;o===Sk.BUTT?this._buttCapStart(T,R,M,a,0):o===Sk.SQUARE?this._buttCapStart(T,R,M,a,a):o===Sk.ROUND&&this._roundCapStart(T,R,M,a,l)}for(var O=w;O<I;++O)s===Ak.ROUND?this._roundJoin(T,E,a,a,l):0!=(E.flags&(bk.PT_BEVEL|bk.PT_INNERBEVEL))?this._bevelJoin(T,E,a,a):(this._vSet(E.x+E.dmx*a,E.y+E.dmy*a,1),this._vSet(E.x-E.dmx*a,E.y-E.dmy*a,-1)),T=E,E=A[O+1];if(P){var N=8*C;this._vSet(v[N],v[N+1],1),this._vSet(v[N+8],v[N+8+1],-1)}else{var B=new IU(E.x,E.y);B.subtract(T),B.normalize();var L=B.x,F=B.y;o===Sk.BUTT?this._buttCapEnd(E,L,F,a,0):o===Sk.SQUARE?this._buttCapEnd(E,L,F,a,a):o===Sk.ROUND&&this._roundCapEnd(E,L,F,a,l)}for(var V=m.indexStart,z=C+2,k=m.vertexStart;z<k;z++)g[V++]=z-2,g[V++]=z-1,g[V++]=z;m.indexStart=V}bW=null,CW=null}}},_expandFill:function(t){if(CW=t.impl){for(var e=CW.paths,n=0,i=CW.pathOffset,r=CW.pathLength;i<r;i++)n+=e[i].points.length;var a=bW=this.getRenderData(t,n);if(a){for(var o=a,s=o.vData,c=o.iData,l=CW.pathOffset,h=CW.pathLength;l<h;l++){var u=e[l],_=u.points,f=_.length;if(0!==f){for(var d=a.vertexStart,p=0;p<f;++p)this._vSet(_[p].x,_[p].y);var m=a.indexStart;if(u.complex){for(var v=[],g=d,y=a.vertexStart;g<y;g++){var x=8*g;v.push(s[x++]),v.push(s[x++]),v.push(s[x++])}var S=dW(v,null,3);if(!S||0===S.length)continue;for(var A=0,b=S.length;A<b;A++)c[m++]=S[A]+d}else for(var C=d,T=d+2,E=o.vertexStart;T<E;T++)c[m++]=C,c[m++]=T-1,c[m++]=T;o.indexStart=m}}bW=null,CW=null}}},_calculateJoins:function(t,e,n,i){var r=0;e>0&&(r=1/e);for(var a=t.paths,o=t.pathOffset,s=t.pathLength;o<s;o++){var c=a[o],l=c.points,h=l.length,u=l[h-1],_=l[0];c.bevel=0;for(var f=0;f<h;f++){var d,p,m=u.dy,v=-u.dx,g=_.dy,y=-_.dx;if(_.dmx=.5*(m+g),_.dmy=.5*(v+y),(d=_.dmx*_.dmx+_.dmy*_.dmy)>1e-6){var x=1/d;x>600&&(x=600),_.dmx*=x,_.dmy*=x}_.dx*u.dy-u.dx*_.dy>0&&(_.flags|=bk.PT_LEFT),d*(p=vW(11,mW(u.len,_.len)*r))*p<1&&(_.flags|=bk.PT_INNERBEVEL),_.flags&bk.PT_CORNER&&(d*i*i<1||n===Ak.BEVEL||n===Ak.ROUND)&&(_.flags|=bk.PT_BEVEL),0!=(_.flags&(bk.PT_BEVEL|bk.PT_INNERBEVEL))&&c.bevel++,u=_,_=l[f+1]}}},_flattenPaths:function(t){for(var e=t.paths,n=t.pathOffset,i=t.pathLength;n<i;n++){var r=e[n],a=r.points,o=a[a.length-1],s=a[0];a.length>2&&o.equals(s)&&(r.closed=!0,a.pop(),o=a[a.length-1]);for(var c=0,l=a.length;c<l;c++){var h=new IU(s.x,s.y);h.subtract(o),o.len=h.length(),(h.x||h.y)&&h.normalize(),o.dx=h.x,o.dy=h.y,o=s,s=a[c+1]}}},_chooseBevel:function(t,e,n,i){var r=n.x,a=n.y,o=0,s=0,c=0,l=0;return 0!==t?(o=r+e.dy*i,s=a-e.dx*i,c=r+n.dy*i,l=a-n.dx*i):(o=c=r+n.dmx*i,s=l=a+n.dmy*i),[o,s,c,l]},_buttCapStart:function(t,e,n,i,r){var a=t.x-e*r,o=t.y-n*r,s=n,c=-e;this._vSet(a+s*i,o+c*i,1),this._vSet(a-s*i,o-c*i,-1)},_buttCapEnd:function(t,e,n,i,r){var a=t.x+e*r,o=t.y+n*r,s=n,c=-e;this._vSet(a+s*i,o+c*i,1),this._vSet(a-s*i,o-c*i,-1)},_roundCapStart:function(t,e,n,i,r){for(var a=t.x,o=t.y,s=n,c=-e,l=0;l<r;l++){var h=l/(r-1)*pW,u=xW(h)*i,_=SW(h)*i;this._vSet(a-s*u-e*_,o-c*u-n*_,1),this._vSet(a,o,0)}this._vSet(a+s*i,o+c*i,1),this._vSet(a-s*i,o-c*i,-1)},_roundCapEnd:function(t,e,n,i,r){var a=t.x,o=t.y,s=n,c=-e;this._vSet(a+s*i,o+c*i,1),this._vSet(a-s*i,o-c*i,-1);for(var l=0;l<r;l++){var h=l/(r-1)*pW,u=xW(h)*i,_=SW(h)*i;this._vSet(a,o,0),this._vSet(a-s*u+e*_,o-c*u+n*_,1)}},_roundJoin:function(t,e,n,i,r){var a=t.dy,o=-t.dx,s=e.dy,c=-e.dx,l=e.x,h=e.y;if(0!=(e.flags&bk.PT_LEFT)){var u=this._chooseBevel(e.flags&bk.PT_INNERBEVEL,t,e,n),_=u[0],f=u[1],d=u[2],p=u[3],m=AW(-o,-a),v=AW(-c,-s);v>m&&(v-=2*pW),this._vSet(_,f,1),this._vSet(l-a*i,e.y-o*i,-1);for(var g=IW(gW((m-v)/pW)*r,2,r),y=0;y<g;y++){var x=m+y/(g-1)*(v-m),S=l+xW(x)*i,A=h+SW(x)*i;this._vSet(l,h,0),this._vSet(S,A,-1)}this._vSet(d,p,1),this._vSet(l-s*i,h-c*i,-1)}else{var b=this._chooseBevel(e.flags&bk.PT_INNERBEVEL,t,e,-i),C=b[0],T=b[1],E=b[2],w=b[3],I=AW(o,a),P=AW(c,s);P<I&&(P+=2*pW),this._vSet(l+a*i,h+o*i,1),this._vSet(C,T,-1);for(var D=IW(gW((P-I)/pW)*r,2,r),R=0;R<D;R++){var M=I+R/(D-1)*(P-I),O=l+xW(M)*n,N=h+SW(M)*n;this._vSet(O,N,1),this._vSet(l,h,0)}this._vSet(l+s*i,h+c*i,1),this._vSet(E,w,-1)}},_bevelJoin:function(t,e,n,i){var r=0,a=0,o=0,s=0,c=0,l=0,h=0,u=0,_=t.dy,f=-t.dx,d=e.dy,p=-e.dx;if(e.flags&bk.PT_LEFT){var m=this._chooseBevel(e.flags&bk.PT_INNERBEVEL,t,e,n);c=m[0],l=m[1],h=m[2],u=m[3],this._vSet(c,l,1),this._vSet(e.x-_*i,e.y-f*i,-1),this._vSet(h,u,1),this._vSet(e.x-d*i,e.y-p*i,-1)}else{var v=this._chooseBevel(e.flags&bk.PT_INNERBEVEL,t,e,-i);r=v[0],a=v[1],o=v[2],s=v[3],this._vSet(e.x+_*n,e.y+f*n,1),this._vSet(r,a,-1),this._vSet(e.x+d*n,e.y+p*n,1),this._vSet(o,s,-1)}},_vSet:function(t,e,n){if(void 0===n&&(n=0),bW){var i=bW,r=8*i.vertexStart,a=i.vData;a[r++]=t,a[r++]=e,a[r++]=0,Dn.toArray(a,TW,r),r+=4,a[r++]=n,i.vertexStart++}}},DW=t("graphicsAssembler",{getAssembler:function(){return PW}});NU.Assembler=DW;var RW=function(){this.char="",this.valid=!0,this.x=0,this.y=0,this.line=0,this.hash=""},MW=new oi,OW=null,NW=null,BW=[],LW=[],FW=[],VW=[],zW=new ri,kW=new ri,UW=new Qn,GW=null,HW=0,jW=0,WW=0,qW=0,XW=0,YW=1,KW=null,JW="",QW=0,ZW=0,$W=0,tq=0,eq=0,nq=0,iq=0,rq=!1,aq=0,oq=0,sq=0,cq={updateRenderData:function(t){t.renderData&&OW!==t&&(t.renderData.vertDirty&&(NW=(OW=t).node._uiProps.uiTransformComp,this._updateFontFamily(t),this._updateProperties(t),this._updateLabelInfo(t),this._updateContent(),OW.actualFontSize=QW,NW.setContentSize(kW),this.updateUVs(t),OW.renderData.vertDirty=!1,OW.markForUpdateRenderData(!1),OW=null,this._resetProperties()),t.spriteFrame&&t.renderData.updateRenderData(t,t.spriteFrame))},updateUVs:function(t){for(var e=t.renderData,n=e.chunk.vb,i=e.vertexCount,r=e.data,a=3,o=0;o<i;o++){var s=r[o];n[a]=s.u,n[a+1]=s.v,a+=9}},_updateFontScale:function(){YW=QW/ZW},_updateFontFamily:function(t){var e=t.font;KW=e.spriteFrame,GW=e.fntConfig,$F.fontAtlas=e.fontDefDictionary,tF.packToDynamicAtlas(t,KW)},_updateLabelInfo:function(){$F.hash="",$F.margin=0},_updateProperties:function(t){JW=t.string.toString(),QW=t.fontSize,ZW=GW?GW.fontSize:t.fontSize,$W=t.horizontalAlign,tq=t.verticalAlign,eq=t.spacingX,iq=t.overflow,nq=t._lineHeight;var e=NW.contentSize;kW.width=e.width,kW.height=e.height,iq===gk.NONE?(rq=!1,kW.width+=2*$F.margin,kW.height+=2*$F.margin):iq===gk.RESIZE_HEIGHT?(rq=!0,kW.height+=2*$F.margin):rq=t.enableWrapText,$F.lineHeight=nq,$F.fontSize=QW,this._setupBMFontOverflowMetrics()},_resetProperties:function(){GW=null,KW=null,$F.hash="",$F.margin=0},_updateContent:function(){this._updateFontScale(),this._computeHorizontalKerningForText(),this._alignText()},_computeHorizontalKerningForText:function(){for(var t=JW,e=t.length,n=GW.kerningDict,i=BW,r=-1,a=0;a<e;++a){var o=t.charCodeAt(a),s=n[r<<16|65535&o]||0;i[a]=a<e-1?s:0,r=o}},_multilineTextWrap:function(t){for(var e=JW.length,n=0,i=0,r=0,a=0,o=0,s=0,c=0,l=null,h=0;h<e;){var u=JW.charAt(h);if("\n"!==u){for(var _=t(JW,h,e),f=s,d=c,p=o,m=i,v=!1,g=0;g<_;++g){var y=h+g;if("\r"!==(u=JW.charAt(y)))if(l=$F.fontAtlas.getLetterDefinitionForChar(u,$F)){var x=m+l.offsetX*YW-$F.margin;if(rq&&sq>0&&i>0&&x+l.w*YW>sq&&!kF(u)){FW.push(o),o=0,n++,i=0,r-=nq*this._getFontScale()+0,v=!0;break}UW.x=x,UW.y=r-l.offsetY*YW,this._recordLetterInfo(UW,u,y,n),y+1<BW.length&&y<e-1&&(m+=BW[y+1]),m+=l.xAdvance*YW+eq,p=UW.x+l.w*YW,f<UW.y&&(f=UW.y),d>UW.y-l.h*YW&&(d=UW.y-l.h*YW)}else this._recordPlaceholderInfo(y,u),console.log("Can't find letter definition in texture atlas "+GW.atlasName+" for letter:"+u);else this._recordPlaceholderInfo(y,u)}v||(i=m,s<f&&(s=f),c>d&&(c=d),a<(o=p)&&(a=o),h+=_)}else FW.push(o),o=0,n++,i=0,r-=nq*this._getFontScale()+0,this._recordPlaceholderInfo(h,u),h++}return FW.push(o),jW=(HW=n+1)*nq*this._getFontScale(),HW>1&&(jW+=0*(HW-1)),kW.width=aq,kW.height=oq,aq<=0&&(kW.width=parseFloat(a.toFixed(2))+2*$F.margin),oq<=0&&(kW.height=parseFloat(jW.toFixed(2))+2*$F.margin),qW=kW.height,XW=0,s>0&&(qW=kW.height+s),c<-jW&&(XW=jW+c),!0},_getFirstCharLen:function(){return 1},_getFontScale:function(){return iq===gk.SHRINK?YW:1},_getFirstWordLen:function(t,e,n){var i=t.charAt(e);if(zF(i)||"\n"===i||kF(i))return 1;var r=1,a=$F.fontAtlas.getLetterDefinitionForChar(i,$F);if(!a)return r;for(var o=a.xAdvance*YW+eq,s=e+1;s<n&&(i=t.charAt(s),a=$F.fontAtlas.getLetterDefinitionForChar(i,$F));++s){if(o+a.offsetX*YW+a.w*YW>sq&&!kF(i)&&sq>0)return r;if(o+=a.xAdvance*YW+eq,"\n"===i||kF(i)||zF(i))break;r++}return r},_multilineTextWrapByWord:function(){return this._multilineTextWrap(this._getFirstWordLen)},_multilineTextWrapByChar:function(){return this._multilineTextWrap(this._getFirstCharLen)},_recordPlaceholderInfo:function(t,e){if(t>=LW.length){var n=new RW;LW.push(n)}LW[t].char=e,LW[t].hash=""+e.charCodeAt(0)+$F.hash,LW[t].valid=!1},_recordLetterInfo:function(t,e,n,i){if(n>=LW.length){var r=new RW;LW.push(r)}var a=""+e.charCodeAt(0)+$F.hash;LW[n].line=i,LW[n].char=e,LW[n].hash=a,LW[n].valid=$F.fontAtlas.getLetter(a).valid,LW[n].x=t.x,LW[n].y=t.y},_alignText:function(){jW=0,FW.length=0,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),iq===gk.SHRINK&&QW>0&&this._isVerticalClamp()&&this._shrinkLabelToContentSize(this._isVerticalClamp),this._updateQuads()||iq===gk.SHRINK&&this._shrinkLabelToContentSize(this._isHorizontalClamp)},_scaleFontSizeDown:function(t){var e=!0;t||(t=.1,e=!1),QW=t,e&&this._updateContent()},_shrinkLabelToContentSize:function(t){for(var e=0,n=0|QW,i=0;e<n;){var r=i=e+n+1>>1;if(r<=0)break;YW=r/ZW,this._multilineTextWrapByWord(),this._computeAlignmentOffset(),t()?n=i-1:e=i}e>=0&&this._scaleFontSizeDown(e)},_isVerticalClamp:function(){return jW>kW.height},_isHorizontalClamp:function(){for(var t=!1,e=0,n=JW.length;e<n;++e){var i=LW[e];if(i.valid){var r=$F.fontAtlas.getLetterDefinitionForChar(i.char,$F);if(!r)continue;var a=i.x+r.w*YW,o=i.line;if(aq>0)if(rq){if(FW[o]>kW.width&&(a>kW.width||a<0)){t=!0;break}}else if(a>kW.width){t=!0;break}}}return t},_isHorizontalClamped:function(t,e){var n=FW[e],i=t>kW.width||t<0;return rq?n>kW.width&&i:i},_updateQuads:function(){if(!OW)return!1;var t=KW?KW.texture:$F.fontAtlas.getTexture(),e=OW.renderData;e.dataLength=0,e.resize(0,0);for(var n=NW.anchorPoint,i=kW,r=n.x*i.width,a=n.y*i.height,o=!0,s=0,c=JW.length;s<c;++s){var l=LW[s];if(l.valid){var h=$F.fontAtlas.getLetter(l.hash);if(h){MW.height=h.h,MW.width=h.w,MW.x=h.u,MW.y=h.v;var u=l.y+WW;if(oq>0){if(u>qW){var _=u-qW;MW.y+=_,MW.height-=_,u-=_}u-h.h*YW<XW&&iq===gk.CLAMP&&(MW.height=u<XW?0:(u-XW)/YW)}var f=l.line,d=l.x+h.w/2*YW+VW[f];if(aq>0&&this._isHorizontalClamped(d,f))if(iq===gk.CLAMP)MW.width=0;else if(iq===gk.SHRINK){if(kW.width>h.w){o=!1;break}MW.width=0}if(MW.height>0&&MW.width>0){var p=this._determineRect(),m=l.x+VW[l.line];this.appendQuad(OW,t,MW,p,m-r,u-a,YW)}}else console.warn("Can't find letter in this bitmap-font")}}return o},appendQuad:function(){},_determineRect:function(){var t=KW.isRotated(),e=KW.getOriginalSize(),n=KW.getRect(),i=KW.getOffset(),r=i.x+(e.width-n.width)/2,a=i.y-(e.height-n.height)/2;if(t){var o=MW.x;MW.x=n.x+n.height-MW.y-MW.height-a,MW.y=o+n.y-r,MW.y<0&&(MW.height+=a)}else MW.x+=n.x-r,MW.y+=n.y+a;return t},_computeAlignmentOffset:function(){switch(VW.length=0,$W){case mk.LEFT:for(var t=0;t<HW;++t)VW.push(0);break;case mk.CENTER:for(var e=0,n=FW.length;e<n;e++)VW.push((kW.width-FW[e])/2);break;case mk.RIGHT:for(var i=0,r=FW.length;i<r;i++)VW.push(kW.width-FW[i])}if(WW=kW.height,tq!==vk.TOP){var a=kW.height-jW+nq*this._getFontScale()-ZW*YW;tq===vk.BOTTOM?WW-=a:WW-=a/2}},_setupBMFontOverflowMetrics:function(){var t=kW.width,e=kW.height;iq===gk.RESIZE_HEIGHT&&(e=0),iq===gk.NONE&&(t=0,e=0),aq=t,oq=e,zW.width=t,zW.height=e,sq=t}},lq=new Dn(255,255,255,255),hq={createData:function(t){return t.requestRenderData()},fillBuffers:function(t){var e=t.node;lq.set(t.color),lq.a=255*e._uiProps.opacity,XL(e,0,t.renderData,lq)},appendQuad:function(t,e,n,i,r,a,o){var s=t.renderData;if(s){var c=s.dataLength;s.dataLength+=4,s.resize(s.dataLength,s.dataLength/2*3);var l=s.data,h=e.width,u=e.height,_=n.width,f=n.height,d=0,p=0,m=0,v=0;i?(d=n.x/h,v=(n.x+f)/h,p=(n.y+_)/u,m=n.y/u,l[c].u=d,l[c].v=m,l[c+1].u=d,l[c+1].v=p,l[c+2].u=v,l[c+2].v=m,l[c+3].u=v,l[c+3].v=p):(d=n.x/h,v=(n.x+_)/h,p=(n.y+f)/u,m=n.y/u,l[c].u=d,l[c].v=p,l[c+1].u=v,l[c+1].v=p,l[c+2].u=d,l[c+2].v=m,l[c+3].u=v,l[c+3].v=m),l[c].x=r,l[c].y=a-f*o,l[c+1].x=r+_*o,l[c+1].y=a-f*o,l[c+2].x=r,l[c+2].y=a,l[c+3].x=r+_*o,l[c+3].y=a}},updateColor:function(){}};zt(hq,cq);var uq=null,_q=kt(cq,{getAssemblerData:function(){return uq||(uq=new ZF(1024,1024)),uq.getTexture()},_updateFontFamily:function(t){$F.fontAtlas=uq,$F.fontFamily=this._getFontFamily(t);var e=t.getComponent(ZG);e&&e.enabled?($F.isOutlined=!0,$F.margin=e.width,$F.out=e.color.clone(),$F.out.a=e.color.a*t.color.a/255):($F.isOutlined=!1,$F.margin=0)},_getFontFamily:function(t){var e="Arial";return t.useSystemFont?e=t.fontFamily||"Arial":t.font&&(e=t.font._nativeAsset||"Arial"),e},_updateLabelInfo:function(t){$F.fontDesc=this._getFontDesc(),$F.color=t.color,$F.hash=function(t){var e=t.color.toHEX(),n="";return t.isOutlined&&t.margin>0&&(n=n+t.margin+t.out.toHEX()),""+t.fontSize+t.fontFamily+e+n}($F)},_getFontDesc:function(){return $F.fontSize.toString()+"px "+$F.fontFamily},_computeHorizontalKerningForText:function(){},_determineRect:function(){return!1}}),fq=new Dn(255,255,255,255),dq={createData:function(t){return t.requestRenderData()},fillBuffers:function(t){if(t.renderData){var e=t.node;fq.a=255*e._uiProps.opacity,XL(e,0,t.renderData,fq)}},updateColor:function(){},appendQuad:hq.appendQuad};zt(dq,_q);var pq=Ck.Overflow,mq=(1/255).toFixed(3),vq=null,gq=null,yq=null,xq="",Sq="",Aq=0,bq=0,Cq=[],Tq=new ri,Eq=0,wq=0,Iq=0,Pq=new Dn,Dq="",Rq=pq.NONE,Mq=!1,Oq=null,Nq=Dn.BLACK.clone(),Bq=null,Lq=Dn.BLACK.clone(),Fq=new oi,Vq=ri.ZERO.clone(),zq=ri.ZERO.clone(),kq=Qn.ZERO.clone(),Uq=Qn.ZERO.clone(),Gq=0,Hq=0,jq=!1,Wq=!1,qq=!1,Xq=["left","center","right"],Yq={getAssemblerData:function(){return Ck._canvasPool.get()},resetAssemblerData:function(t){t&&Ck._canvasPool.put(t)},updateRenderData:function(t){if(t.renderData){if(t.renderData.vertDirty){var e=t.node._uiProps.uiTransformComp;this._updateFontFamily(t),this._updateProperties(t,e),this._calculateLabelFont(),this._updateLabelDimensions(),this._updateTexture(t),this._calDynamicAtlas(t),t.actualFontSize=Aq,e.setContentSize(Tq),this.updateVertexData(t),this.updateUVs(t),t.markForUpdateRenderData(!1),vq=null,gq=null,yq=null}t.spriteFrame&&t.renderData.updateRenderData(t,t.spriteFrame)}},updateVertexData:function(){},updateUVs:function(){},_updateFontFamily:function(t){Dq=t.useSystemFont?t.fontFamily||"Arial":t.font&&t.font._nativeAsset||"Arial"},_updateProperties:function(t,e){var n=t.assemblerData;n&&(vq=n.context,gq=n.canvas,yq=t.spriteFrame,Sq=t.string.toString(),Aq=t.fontSize,bq=Aq,Rq=t.overflow,zq.width=Tq.width=e.width,zq.height=Tq.height=e.height,Hq=t.underlineHeight,Eq=t.lineHeight,wq=t.horizontalAlign,Iq=t.verticalAlign,Pq=t.color,t.node._uiProps.opacity,jq=t.isBold,Wq=t.isItalic,qq=t.isUnderline,Mq=Rq!==pq.NONE&&(Rq===pq.RESIZE_HEIGHT||t.enableWrapText),(Oq=(Oq=ZG&&t.getComponent(ZG))&&Oq.enabled&&Oq.width>0?Oq:null)&&Nq.set(Oq.color),(Bq=(Bq=Wj&&t.getComponent(Wj))&&Bq.enabled?Bq:null)&&Lq.set(Bq.color),this._updatePaddingRect())},_updatePaddingRect:function(){var t=0,e=0,n=0,i=0,r=0;if(Vq.width=Vq.height=0,Oq&&(t=e=n=i=r=Oq.width,Vq.width=Vq.height=2*r),Bq){var a=Bq.blur+r,o=Bq.offset.x,s=Bq.offset.y;n=Math.max(n,-o+a),i=Math.max(i,o+a),t=Math.max(t,s+a),e=Math.max(e,-s+a)}if(Wq){var c=bq*Math.tan(.20943951);i+=c,Vq.width+=c}Fq.x=n,Fq.y=t,Fq.width=n+i,Fq.height=t+e},_calculateFillTextStartPosition:function(){var t=0;wq===mk.RIGHT?t=Tq.width-Fq.width:wq===mk.CENTER&&(t=(Tq.width-Fq.width)/2);var e=this._getLineHeight()*(Cq.length-1),n=Aq*(1-PF/2);if(Iq!==vk.TOP){var i=e+Fq.height+Aq-Tq.height;Iq===vk.BOTTOM?n-=i+=PF/2*Aq:n-=i/2}n+=0*Aq,kq.set(t+Fq.x,n+Fq.y)},_updateTexture:function(t){if(vq&&gq){vq.clearRect(0,0,gq.width,gq.height),vq.font=xq,this._calculateFillTextStartPosition();var e=this._getLineHeight();vq.lineJoin="round",Oq?(vq.fillStyle="rgba("+Nq.r+", "+Nq.g+", "+Nq.b+", "+mq+")",vq.fillRect(0,0,gq.width,gq.height)):t._srcBlendFactor===Oi.SRC_ALPHA&&(vq.fillStyle="rgba("+Pq.r+", "+Pq.g+", "+Pq.b+", "+mq+")",vq.fillRect(0,0,gq.width,gq.height)),vq.fillStyle="rgb("+Pq.r+", "+Pq.g+", "+Pq.b+")";var n=kq.x,i=0;this._drawTextEffect(kq,e);for(var r=0;r<Cq.length;++r)i=kq.y+r*e,Oq&&vq.strokeText(Cq[r],n,i),vq.fillText(Cq[r],n,i);Bq&&(vq.shadowColor="transparent"),this._uploadTexture(t)}},_uploadTexture:function(t){if(t.cacheMode===Ck.CacheMode.BITMAP){var e=t.ttfSpriteFrame;tF.deleteAtlasSpriteFrame(e),e._resetDynamicAtlasFrame()}var n;yq&&gq&&(n=yq instanceof oF?yq.texture:yq,0!==gq.width&&0!==gq.height&&(n.reset({width:gq.width,height:gq.height,mipmapLevel:1}),n.uploadData(gq),n.setWrapMode(Um.CLAMP_TO_EDGE,Um.CLAMP_TO_EDGE),yq instanceof oF&&(yq.rect=new oi(0,0,gq.width,gq.height),yq._calculateUV()),t.renderData&&(t.renderData.textureDirty=!0),h.director.root&&h.director.root.batcher2D&&h.director.root.batcher2D._releaseDescriptorSetCache(n.getHash())))},_calDynamicAtlas:function(t){if(!(t.cacheMode!==Ck.CacheMode.BITMAP||!gq||gq.width<=0||gq.height<=0)){var e=t.ttfSpriteFrame;tF.packToDynamicAtlas(t,e)}},_setupOutline:function(){vq.strokeStyle="rgba("+Nq.r+", "+Nq.g+", "+Nq.b+", "+Nq.a/255+")",vq.lineWidth=2*Oq.width},_setupShadow:function(){vq.shadowColor="rgba("+Lq.r+", "+Lq.g+", "+Lq.b+", "+Lq.a/255+")",vq.shadowBlur=Bq.blur,vq.shadowOffsetX=Bq.offset.x,vq.shadowOffsetY=-Bq.offset.y},_drawTextEffect:function(t,e){if(Bq||Oq||qq){var n=Cq.length>1&&Bq,i=this._measureText(vq,xq),r=0,a=0;Bq&&this._setupShadow(),Oq&&this._setupOutline();for(var o=0;o<Cq.length;++o)r=t.x,a=t.y+o*e,n&&(Oq&&vq.strokeText(Cq[o],r,a),vq.fillText(Cq[o],r,a)),qq&&(Gq=i(Cq[o]),wq===mk.RIGHT?Uq.x=t.x-Gq:wq===mk.CENTER?Uq.x=t.x-Gq/2:Uq.x=t.x,Uq.y=a+bq/8,vq.fillRect(Uq.x,Uq.y,Gq,Hq));n&&(vq.shadowColor="transparent")}},_updateLabelDimensions:function(){Tq.width=Math.min(Tq.width,2048),Tq.height=Math.min(Tq.height,2048);var t=!1;gq.width!==Tq.width&&(gq.width=Tq.width,t=!0),gq.height!==Tq.height&&(gq.height=Tq.height,t=!0),t&&(vq.font=xq),vq.textAlign=Xq[wq],vq.textBaseline="alphabetic"},_getFontDesc:function(){var t=Aq.toString()+"px ";return t+=Dq,jq&&(t="bold "+t),Wq&&(t="italic "+t),t},_getLineHeight:function(){return 0|(0===Eq?Aq:Eq*Aq/bq)},_calculateParagraphLength:function(t,e){for(var n,i=[],r=st(t);!(n=r()).done;){var a=UF(e,n.value,xq);i.push(a)}return i},_measureText:function(t,e){return function(n){return UF(t,n,e)}},_calculateShrinkFont:function(t){if(vq){var e=this._calculateParagraphLength(t,vq),n=0,i=0,r=0;if(Mq){var a=zq.width,o=zq.height;if(a<0||o<0)return;i=o+1;for(var s=0,c=0|Aq+1,l=0;s<c;){if((l=s+c+1>>1)<=0){P(4003);break}Aq=l,xq=this._getFontDesc(),vq.font=xq;var h=this._getLineHeight();for(i=0,n=0;n<t.length;++n){var u=UF(vq,t[n],xq);i+=WF(t[n],u,a,this._measureText(vq,xq)).length*h}i>o?c=l-1:s=l}0===s?P(4003):(Aq=s,xq=this._getFontDesc(),vq.font=xq)}else{for(i=t.length*this._getLineHeight(),n=0;n<t.length;++n)r<e[n]&&(r=e[n]);var _=(Tq.width-Fq.width)/r,f=Tq.height/i;Aq=bq*Math.min(1,_,f)|0,xq=this._getFontDesc(),vq.font=xq}}},_calculateWrapText:function(t){if(Mq&&vq){Cq=[];for(var e=zq.width,n=0;n<t.length;++n){var i=UF(vq,t[n],xq),r=WF(t[n],i,e,this._measureText(vq,xq));Cq=Cq.concat(r)}}},_calculateLabelFont:function(){if(vq){var t=Sq.split("\n");switch(Cq=t,xq=this._getFontDesc(),vq.font=xq,Rq){case pq.NONE:for(var e=0,n=0,i=0;i<t.length;++i){var r=UF(vq,t[i],xq);e=e>r?e:r}n=(Cq.length+PF)*this._getLineHeight();var a=parseFloat(e.toFixed(2)),o=parseFloat(n.toFixed(2));Tq.width=a+Fq.width,Tq.height=o+Fq.height,zq.width=a+Vq.width,zq.height=o+Vq.height;break;case pq.SHRINK:this._calculateShrinkFont(t),this._calculateWrapText(t);break;case pq.CLAMP:this._calculateWrapText(t);break;case pq.RESIZE_HEIGHT:this._calculateWrapText(t);var s=(Cq.length+PF)*this._getLineHeight();Tq.height=s+Fq.height,zq.height=s+Vq.height}}}},Kq=Dn.WHITE.clone(),Jq={createData:function(t){var e=t.requestRenderData();e.dataLength=2,e.resize(4,6);var n=e.chunk.vb;n[3]=n[21]=n[22]=n[31]=0,n[4]=n[12]=n[13]=n[30]=1;for(var i=5,r=0;r<4;r++)Dn.toArray(n,Kq,i),i+=9;return e},fillBuffers:function(t){var e=t.renderData.chunk,n=t.renderData.data,i=t.node,r=e.vb,a=n[0],o=n[1];i.updateWorldTransform();var s=i._pos,c=i._rot,l=i._scale,h=a.x*l.x,u=o.x*l.x,_=a.y*l.y,f=o.y*l.y,d=c.x,p=c.y,m=c.z,v=c.w,g=d*p,y=m*v,x=d*d-p*p,S=v*v-m*m,A=S+x,b=2*(g-y),C=S-x,T=2*(g+y),E=s.x,w=s.y;r[0]=A*h+b*_+E,r[1]=C*_+T*h+w,r[9]=A*u+b*_+E,r[10]=C*_+T*u+w,r[18]=A*h+b*f+E,r[19]=C*f+T*h+w,r[27]=A*u+b*f+E,r[28]=C*f+T*u+w;var I=e.bufferId,P=e.vertexOffset,D=e.vertexAccessor.getMeshBuffer(e.bufferId),R=e.vertexAccessor.getIndexBuffer(I),M=D.indexOffset;R[M++]=P,R[M++]=P+1,R[M++]=P+2,R[M++]=P+2,R[M++]=P+1,R[M++]=P+3,D.indexOffset+=6},updateVertexData:function(t){var e=t.renderData;if(e){var n=t.node._uiProps.uiTransformComp,i=n.width,r=n.height,a=n.anchorX*i,o=n.anchorY*r,s=e.data;s[0].x=-a,s[0].y=-o,s[1].x=i-a,s[1].y=r-o}},updateUVs:function(t){var e=t.renderData;if(e&&t.ttfSpriteFrame){var n=e.chunk.vb,i=t.ttfSpriteFrame.uv;n[3]=i[0],n[4]=i[1],n[12]=i[2],n[13]=i[3],n[21]=i[4],n[22]=i[5],n[30]=i[6],n[31]=i[7]}},updateColor:function(){}};zt(Jq,Yq);var Qq=t("labelAssembler",{getAssembler:function(t){var e=Jq;return t.font instanceof wF?e=hq:t.cacheMode===Ck.CacheMode.CHAR&&(e=dq),e}});Ck.Assembler=Qq;var Zq=tH.FillType,$q=new Xn,tX=new Mn,eX={updateRenderData:function(t){var e=t.spriteFrame;tF.packToDynamicAtlas(t,e);var n=t.renderData;if(n&&e){if(n.updateRenderData(t,e),!n.vertDirty)return;var i=t.fillStart,r=t.fillRange;r<0&&(i+=r,r=-r),r=(r=(r=i+r)>1?1:r)<0?0:r;var a=(i=(i=i>1?1:i)<0?0:i)+(r=(r-=i)<0?0:r);a=a>1?1:a,this.updateUVs(t,i,a),this.updateVertexData(t,i,a)}},updateUVs:function(t,e,n){var i=t.spriteFrame,r=t.renderData.chunk.vb,a=i.width,o=i.height,s=i.rect,c=0,l=0,h=0,u=0,_=0,f=0,d=0,p=0,m=0,v=0;switch(i.isRotated()?(c=s.x/a,l=(s.y+s.width)/o,h=_=c,d=m=(s.x+s.height)/a,f=v=l,u=p=s.y/o):(c=s.x/a,l=(s.y+s.height)/o,h=d=c,_=m=(s.x+s.width)/a,u=f=l,p=v=s.y/o),t.fillType){case Zq.HORIZONTAL:r[3]=h+(_-h)*e,r[4]=u+(f-u)*e,r[12]=h+(_-h)*n,r[13]=u+(f-u)*n,r[21]=d+(m-d)*e,r[22]=p+(v-p)*e,r[30]=d+(m-d)*n,r[31]=p+(v-p)*n;break;case Zq.VERTICAL:r[3]=h+(d-h)*e,r[4]=u+(p-u)*e,r[12]=_+(m-_)*e,r[13]=f+(v-f)*e,r[21]=h+(d-h)*n,r[22]=u+(p-u)*n,r[30]=_+(m-_)*n,r[31]=f+(v-f)*n;break;default:O(2626)}},updateVertexData:function(t,e,n){var i=t.renderData.data,r=t.node._uiProps.uiTransformComp,a=r.width,o=r.height,s=r.anchorX*a,c=r.anchorY*o,l=-s,h=-c,u=a-s,_=o-c,f=0;switch(t.fillType){case Zq.HORIZONTAL:f=l+(u-l)*n,l+=(u-l)*e,u=f;break;case Zq.VERTICAL:f=h+(_-h)*n,h+=(_-h)*e,_=f;break;default:O(2626)}i[0].x=l,i[0].y=h,i[1].x=u,i[1].y=h,i[2].x=l,i[2].y=_,i[3].x=u,i[3].y=_},createData:function(t){var e=t.requestRenderData();e.dataLength=4,e.resize(4,6);for(var n,i=st(e.data);!(n=i()).done;)n.value.z=0;return e},updateWorldVertexData:function(t,e){t.node.getWorldMatrix($q);for(var n=t.renderData.floatStride,i=t.renderData.data,r=e.vb,a=0,o=0;o<4;o++){var s=i[o];Mn.transformMat4(tX,s,$q),r[a=o*n]=tX.x,r[a+1]=tX.y,r[a+2]=tX.z}},fillBuffers:function(t){var e=t.renderData,n=e.chunk;(t.node.hasChangedFlags||e.vertDirty)&&(this.updateWorldVertexData(t,n),e.vertDirty=!1);var i=n.bufferId,r=n.vertexOffset,a=n.vertexAccessor.getMeshBuffer(n.bufferId),o=n.vertexAccessor.getIndexBuffer(i),s=a.indexOffset;o[s++]=r,o[s++]=r+1,o[s++]=r+2,o[s++]=r+2,o[s++]=r+1,o[s++]=r+3,a.indexOffset+=6},updateColor:function(t){for(var e=t.renderData,n=e.chunk.vb,i=e.floatStride,r=5,a=t.color,o=a.r/255,s=a.g/255,c=a.b/255,l=t.node._uiProps.opacity,h=0;h<4;h++)n[r]=o,n[r+1]=s,n[r+2]=c,n[r+3]=l,r+=i}},nX=2*Math.PI,iX=1e-6,rX=new Xn,aX=new Mn,oX=[new Qn,new Qn,new Qn,new Qn],sX=new Array(4),cX=new Array(8),lX=[new Qn,new Qn,new Qn,new Qn],hX=[new Qn,new Qn,new Qn,new Qn],uX=new Qn,_X=[new Qn,new Qn,new Qn,new Qn];function fX(t,e,n,i,r,a,o){var s=Math.sin(a);s=Math.abs(s)>iX?s:0;var c=Math.cos(a),l=0,h=0;if(0!==(c=Math.abs(c)>iX?c:0)){if(l=s/c,(t-r.x)*c>0){var u=r.y+l*(t-r.x);o[0].x=t,o[0].y=u}if((e-r.x)*c>0){var _=r.y+l*(e-r.x);o[2].x=e,o[2].y=_}}if(0!==s){if(h=c/s,(i-r.y)*s>0){var f=r.x+h*(i-r.y);o[3].x=f,o[3].y=i}if((n-r.y)*s>0){var d=r.x+h*(n-r.y);o[1].x=d,o[1].y=n}}}function dX(t,e){var n=e.x-t.x,i=e.y-t.y;if(0===n&&0===i)return 0;if(0===n)return i>0?.5*Math.PI:1.5*Math.PI;var r=Math.atan(i/n);return n<0&&(r+=Math.PI),r}function pX(t,e,n,i,r){var a=sX,o=a[0],s=a[1],c=a[2],l=a[3];t[e].x=n.x,t[e].y=n.y,t[e+1].x=i.x,t[e+1].y=i.y,t[e+2].x=r.x,t[e+2].y=r.y,mX((n.x-o)/(c-o),(n.y-s)/(l-s),t,e),mX((i.x-o)/(c-o),(i.y-s)/(l-s),t,e+1),mX((r.x-o)/(c-o),(r.y-s)/(l-s),t,e+2)}function mX(t,e,n,i){var r=cX,a=r[0]+(r[2]-r[0])*t,o=r[4]+(r[6]-r[4])*t,s=r[1]+(r[3]-r[1])*t,c=r[5]+(r[7]-r[5])*t,l=n[i];l.u=a+(o-a)*e,l.v=s+(c-s)*e}for(var vX={useModel:!1,createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.spriteFrame;tF.packToDynamicAtlas(t,e),this.updateUVs(t);var n=t.renderData;if(n&&e){if(!n.vertDirty)return;var i=n.data,r=t.fillStart,a=t.fillRange;for(a<0&&(r+=a,a=-a);r>=1;)r-=1;for(;r<0;)r+=1;var o=(r*=nX)+(a*=nX);!function(t){var e=t.node._uiProps.uiTransformComp,n=e.width,i=e.height,r=e.anchorX*n,a=e.anchorY*i,o=-r,s=-a,c=n-r,l=i-a,h=sX;h[0]=o,h[1]=s,h[2]=c,h[3]=l;var u=t.fillCenter,_=uX.x=Math.min(Math.max(0,u.x),1)*(c-o)+o,f=uX.y=Math.min(Math.max(0,u.y),1)*(l-s)+s;oX[0].x=oX[3].x=o,oX[1].x=oX[2].x=c,oX[0].y=oX[1].y=s,oX[2].y=oX[3].y=l;for(var d,p=st(_X);!(d=p()).done;){var m=d.value;Qn.set(m,0,0)}_!==h[0]&&Qn.set(_X[0],3,0),_!==h[2]&&Qn.set(_X[2],1,2),f!==h[1]&&Qn.set(_X[1],0,1),f!==h[3]&&Qn.set(_X[3],2,3)}(t),function(t){var e=t.width,n=t.height,i=t.getRect(),r=0,a=0,o=0,s=0,c=cX;t.isRotated()?(r=i.x/e,a=(i.x+i.height)/e,o=i.y/n,s=(i.y+i.width)/n,c[0]=c[2]=r,c[4]=c[6]=a,c[3]=c[7]=s,c[1]=c[5]=o):(r=i.x/e,a=(i.x+i.width)/e,o=i.y/n,s=(i.y+i.height)/n,c[0]=c[4]=r,c[2]=c[6]=a,c[1]=c[3]=s,c[5]=c[7]=o)}(e),fX(sX[0],sX[2],sX[1],sX[3],uX,r,lX),fX(sX[0],sX[2],sX[1],sX[3],uX,r+a,hX);for(var s=0,c=0;c<4;++c){var l=_X[c];if(l)if(a>=nX)n.dataLength=s+3,pX(i,s,uX,oX[l.x],oX[l.y]),s+=3;else{var h=dX(uX,oX[l.x]),u=dX(uX,oX[l.y]);u<h&&(u+=nX),h-=nX,u-=nX;for(var _=0;_<3;++_)h>=o||(h>=r?(n.dataLength=s+3,pX(i,s,uX,oX[l.x],u>=o?hX[c]:oX[l.y]),s+=3):u>r&&(u<=o?(n.dataLength=s+3,pX(i,s,uX,lX[c],oX[l.y]),s+=3):(n.dataLength=s+3,pX(i,s,uX,lX[c],hX[c]),s+=3))),h+=nX,u+=nX}}n.resize(s,s),n.updateRenderData(t,e)}},fillBuffers:function(t){var e=t.node,n=t.renderData,i=n.chunk;(e.hasChangedFlags||n.vertDirty)&&(this.updateWorldVertexAndUVData(t,i),n.vertDirty=!1),this.updataColorLate(t);for(var r=i.bufferId,a=i.vertexOffset,o=i.vertexAccessor.getMeshBuffer(i.bufferId),s=i.vertexAccessor.getIndexBuffer(r),c=o.indexOffset,l=0;l<n.indexCount;l++)s[c+l]=a+l;o.indexOffset+=n.indexCount,o.setDirty()},updateWorldVertexAndUVData:function(t,e){t.node.getWorldMatrix(rX);for(var n=t.renderData,i=n.floatStride,r=t.renderData.data,a=e.vb,o=n.vertexCount,s=0,c=0;c<o;c++){var l=r[c];Mn.set(aX,l.x,l.y,0),Mn.transformMat4(aX,aX,rX),a[s+0]=aX.x,a[s+1]=aX.y,a[s+2]=aX.z,a[s+3]=l.u,a[s+4]=l.v,s+=i}},updateUVs:function(t){t.renderData.vertDirty=!0,t.markForUpdateRenderData()},updataColorLate:function(t){for(var e=t.renderData,n=e.chunk.vb,i=e.floatStride,r=e.vertexCount,a=5,o=t.color,s=o.r/255,c=o.g/255,l=o.b/255,h=t.node._uiProps.opacity,u=0;u<r;u++)n[a]=s,n[a+1]=c,n[a+2]=l,n[a+3]=h,a+=i},updateColor:function(){}},gX=[],yX=0;yX<4;yX++)gX.push(new Mn);for(var xX={createData:function(t){var e=t.requestRenderData();return e.dataLength=2,e.resize(4,6),e},updateRenderData:function(t){var e=t.spriteFrame;tF.packToDynamicAtlas(t,e),this.updateUVs(t);var n=t.renderData;n&&e&&(n.vertDirty&&this.updateVertexData(t),n.updateRenderData(t,e))},updateWorldVerts:function(t,e){var n=t.renderData,i=e.vb,r=n.data,a=t.node,o=r[0],s=r[1],c=a.worldMatrix,l=c.m00,h=c.m01,u=c.m04,_=c.m05,f=1===l&&0===h&&0===u&&1===_,d=c.m12,p=c.m13,m=o.x,v=s.x,g=o.y,y=s.y;if(f){var x=m+d,S=v+d,A=g+p,b=y+p;i[0]=x,i[1]=A,i[9]=S,i[10]=A,i[18]=x,i[19]=b,i[27]=S,i[28]=b}else{var C=l*m,T=l*v,E=h*m,w=h*v,I=u*g+d,P=u*y+d,D=_*g+p,R=_*y+p;i[0]=C+I,i[1]=E+D,i[9]=T+I,i[10]=w+D,i[18]=C+P,i[19]=E+R,i[27]=T+P,i[28]=w+R}},fillBuffers:function(t){if(null!==t){var e=t.renderData,n=e.chunk;(t.node.hasChangedFlags||e.vertDirty)&&(this.updateWorldVerts(t,n),e.vertDirty=!1);var i=n.bufferId,r=n.vertexOffset,a=n.vertexAccessor.getMeshBuffer(i),o=n.vertexAccessor.getIndexBuffer(i),s=a.indexOffset;o[s++]=r,o[s++]=r+1,o[s++]=r+2,o[s++]=r+2,o[s++]=r+1,o[s++]=r+3,a.indexOffset+=6}},updateVertexData:function(t){var e=t.renderData;if(e){var n=t.node._uiProps.uiTransformComp,i=e.data,r=n.width,a=n.height,o=n.anchorX*r,s=n.anchorY*a,c=0,l=0,h=0,u=0;if(t.trim)c=-o,l=-s,h=r-o,u=a-s;else{var _=t.spriteFrame,f=_.getOriginalSize(),d=_.getRect(),p=f.width,m=f.height,v=d.width,g=d.height,y=_.getOffset(),x=r/p,S=a/m,A=y.x+(p-v)/2,b=y.x-(p-v)/2;c=A*x-o,l=(y.y+(m-g)/2)*S-s,h=r+b*x-o,u=a+(y.y-(m-g)/2)*S-s}i[0].x=c,i[0].y=l,i[1].x=h,i[1].y=u,e.vertDirty=!0}},updateUVs:function(t){if(t.spriteFrame){var e=t.renderData.chunk.vb,n=t.spriteFrame.uv;e[3]=n[0],e[4]=n[1],e[12]=n[2],e[13]=n[3],e[21]=n[4],e[22]=n[5],e[30]=n[6],e[31]=n[7]}},updateColor:function(t){for(var e=t.renderData,n=e.chunk.vb,i=5,r=t.color,a=r.r/255,o=r.g/255,s=r.b/255,c=r.a/255,l=0;l<4;l++,i+=e.floatStride)n[i]=a,n[i+1]=o,n[i+2]=s,n[i+3]=c}},SX=new Mn,AX=new Xn,bX={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.resize(16,54),e},updateRenderData:function(t){var e=t.spriteFrame;tF.packToDynamicAtlas(t,e),this.updateUVs(t);var n=t.renderData;n&&e&&(n.vertDirty&&this.updateVertexData(t),n.updateRenderData(t,e))},updateVertexData:function(t){var e=t.renderData.data,n=t.node._uiProps.uiTransformComp,i=n.width,r=n.height,a=n.anchorX*i,o=n.anchorY*r,s=t.spriteFrame,c=s.insetLeft,l=s.insetRight,h=s.insetTop,u=s.insetBottom,_=i-c-l,f=r-h-u,d=i/(c+l),p=r/(h+u);d=Number.isNaN(d)||d>1?1:d,p=Number.isNaN(p)||p>1?1:p,_=_<0?0:_,f=f<0?0:f,e[0].x=-a,e[0].y=-o,e[1].x=c*d-a,e[1].y=u*p-o,e[2].x=e[1].x+_,e[2].y=e[1].y+f,e[3].x=i-a,e[3].y=r-o},fillBuffers:function(t){var e=t.renderData,n=e.chunk;(t.node.hasChangedFlags||e.vertDirty)&&(this.updateWorldVertexData(t,n),e.vertDirty=!1);for(var i=n.bufferId,r=n.vertexOffset,a=n.vertexAccessor.getMeshBuffer(n.bufferId),o=n.vertexAccessor.getIndexBuffer(i),s=a.indexOffset,c=0;c<3;++c)for(var l=0;l<3;++l){var h=r+4*c+l;o[s++]=h,o[s++]=h+1,o[s++]=h+4,o[s++]=h+1,o[s++]=h+5,o[s++]=h+4}a.indexOffset=s},updateWorldVertexData:function(t,e){t.node.getWorldMatrix(AX);for(var n=t.renderData,i=n.floatStride,r=n.data,a=e.vb,o=0,s=0;s<4;++s)for(var c=r[s],l=0;l<4;++l){var h=r[l];Mn.set(SX,h.x,c.y,0),Mn.transformMat4(SX,SX,AX),o=(4*s+l)*i,a[o++]=SX.x,a[o++]=SX.y,a[o++]=SX.z}},updateUVs:function(t){if(t.spriteFrame)for(var e=t.renderData,n=e.chunk.vb,i=e.floatStride,r=t.spriteFrame.uvSliced,a=3,o=0;o<16;o++)n[a]=r[o].u,n[a+1]=r[o].v,a+=i},updateColor:function(t){for(var e=t.renderData,n=e.chunk.vb,i=e.floatStride,r=5,a=t.color,o=a.r/255,s=a.g/255,c=a.b/255,l=t.node._uiProps.opacity,h=0;h<16;h++)n[r]=o,n[r+1]=s,n[r+2]=c,n[r+3]=l,r+=i}},CX=[],TX=0;TX<4;TX++)CX.push(new Mn);var EX=new Xn,wX={createData:function(t){return t.requestRenderData()},updateRenderData:function(t){var e=t.renderData,n=t.spriteFrame;if(n&&e&&(e.updateRenderData(t,n),e.vertDirty)){var i=t.node._uiProps.uiTransformComp,r=Math.abs(i.width),a=Math.abs(i.height),o=n.getRect(),s=n.insetLeft,c=n.insetRight,l=o.width-s-c,h=n.insetTop,u=n.insetBottom,_=o.height-h-u,f=r-s-c,d=a-h-u;f=f>0?f:0,d=d>0?d:0;var p=0===l?f:f/l,m=0===_?d:d/_,v=Math.ceil(m+2),g=Math.ceil(p+2);e.dataLength=Math.max(8,v+1,g+1),this.updateVerts(t,f,d,v,g),e.resize(v*g*4,v*g*6)}},updateUVs:function(t){t.renderData.vertDirty=!0,t.markForUpdateRenderData()},fillBuffers:function(t){var e=t.node,n=t.renderData,i=n.chunk;(e.hasChangedFlags||n.vertDirty)&&(this.updateWorldVertexAndUVData(t,i),n.vertDirty=!1),this.updataColorLate(t);for(var r=i.bufferId,a=i.vertexOffset,o=i.vertexAccessor.getMeshBuffer(i.bufferId),s=i.vertexAccessor.getIndexBuffer(r),c=o.indexOffset,l=0;l<n.indexCount;l+=6)s[c++]=a,s[c++]=a+1,s[c++]=a+2,s[c++]=a+1,s[c++]=a+3,s[c++]=a+2,a+=4,o.indexOffset+=6;o.setDirty()},updateWorldVertexAndUVData:function(t,e){var n=t.node;n.getWorldMatrix(EX);var i=t.renderData,r=i.floatStride,a=i.data,o=e.vb,s=n._uiProps.uiTransformComp,c=Math.abs(s.width),l=Math.abs(s.height),h=t.spriteFrame,u=h.rotated,_=h.uv,f=h.uvSliced,d=h.rect,p=h.insetLeft,m=h.insetRight,v=d.width-p-m,g=h.insetTop,y=h.insetBottom,x=d.height-g-y,S=c-p-m,A=l-g-y;S=S>0?S:0,A=A>0?A:0;for(var b=0===v?S:S/v,C=0===x?A:A/x,T=Math.ceil(C+2),E=Math.ceil(b+2),w=0,I=0,P=0,D=0,R=0,M=0,O=T;M<O;++M){D=a[M].y,R=a[M+1].y;for(var N=0,B=E;N<B;++N){I=a[N].x,P=a[N+1].x,Mn.set(CX[0],I,D,0),Mn.set(CX[1],P,D,0),Mn.set(CX[2],I,R,0),Mn.set(CX[3],P,R,0);for(var L=0;L<4;L++){var F=CX[L];Mn.transformMat4(F,F,EX);var V=L*r;o[w+V]=F.x,o[w+V+1]=F.y,o[w+V+2]=F.z}w+=4*r}}w=0;for(var z=r,k=2*r,U=3*r,G=4*r,H=0,j=0,W=[],q=[],X=0,Y=T;X<Y;++X){j=A>x?A>=X*x?1:C%1:C;for(var K=0,J=E;K<J;++K){H=S>v?S>=K*v?1:b%1:b;var Q=w+3,Z=Q+1;u?(0===X?(W[0]=f[0].u,W[1]=f[0].u,W[2]=f[4].u+(f[8].u-f[4].u)*j):X<T-1?(W[0]=f[4].u,W[1]=f[4].u,W[2]=f[4].u+(f[8].u-f[4].u)*j):X===T-1&&(W[0]=f[8].u,W[1]=f[8].u,W[2]=f[12].u),0===K?(q[0]=f[0].v,q[1]=f[1].v+(f[2].v-f[1].v)*H,q[2]=f[0].v):K<E-1?(q[0]=f[1].v,q[1]=f[1].v+(f[2].v-f[1].v)*H,q[2]=f[1].v):K===E-1&&(q[0]=f[2].v,q[1]=f[3].v,q[2]=f[2].v),W[3]=W[2],q[3]=q[1]):(0===K?(W[0]=f[0].u,W[1]=f[1].u+(f[2].u-f[1].u)*H,W[2]=_[0]):K<E-1?(W[0]=f[1].u,W[1]=f[1].u+(f[2].u-f[1].u)*H,W[2]=f[1].u):K===E-1&&(W[0]=f[2].u,W[1]=f[3].u,W[2]=f[2].u),0===X?(q[0]=f[0].v,q[1]=f[0].v,q[2]=f[4].v+(f[8].v-f[4].v)*j):X<T-1?(q[0]=f[4].v,q[1]=f[4].v,q[2]=f[4].v+(f[8].v-f[4].v)*j):X===T-1&&(q[0]=f[8].v,q[1]=f[8].v,q[2]=f[12].v),W[3]=W[1],q[3]=q[2]),o[Q]=W[0],o[Z]=q[0],o[Q+z]=W[1],o[Z+z]=q[1],o[Q+k]=W[2],o[Z+k]=q[2],o[Q+U]=W[3],o[Z+U]=q[3],w+=G}}},updateVerts:function(t,e,n,i,r){var a,o,s=t.node._uiProps.uiTransformComp,c=t.renderData.data,l=t.spriteFrame,h=l.rect,u=Math.abs(s.width),_=Math.abs(s.height),f=s.anchorX*u,d=s.anchorY*_,p=l.insetLeft,m=l.insetRight,v=h.width-p-m,g=l.insetTop,y=l.insetBottom,x=h.height-g-y,S=s.width/(p+m)>1?1:s.width/(p+m),A=s.height/(g+y)>1?1:s.height/(g+y);a=v>0?Math.floor(1e3*e)/1e3%v==0?v:e%v:e,o=x>0?Math.floor(1e3*n)/1e3%x==0?x:n%x:n;for(var b=0;b<=r;b++)0===b?c[b].x=-f:b>0&&b<r?c[b].x=1===b?p*S+Math.min(v,e)-f:v>0?b===r-1?p+a+v*(b-2)-f:p+Math.min(v,e)+v*(b-2)-f:p+e-f:b===r&&(c[b].x=Math.min(p+e+m,u)-f);for(var C=0;C<=i;C++)0===C?c[C].y=-d:C>0&&C<i?c[C].y=1===C?y*A+Math.min(x,n)-d:x>0?C===i-1?y+o+(C-2)*x-d:y+Math.min(x,n)+(C-2)*x-d:y+n-d:C===i&&(c[C].y=Math.min(y+n+g,_)-d)},updataColorLate:function(t){for(var e=t.renderData,n=e.chunk.vb,i=e.floatStride,r=e.vertexCount,a=5,o=t.color,s=o.r/255,c=o.g/255,l=o.b/255,h=t.node._uiProps.opacity,u=0;u<r;u++)n[a]=s,n[a+1]=c,n[a+2]=l,n[a+3]=h,a+=i},updateColor:function(){}},IX=tH.Type,PX=tH.FillType,DX=t("spriteAssembler",{getAssembler:function(t){var e=xX,n=t;switch(n.type){case IX.SLICED:e=bX;break;case IX.TILED:e=wX;break;case IX.FILLED:e=n.fillType===PX.RADIAL?vX:eX}return e}});tH.Assembler=DX;var RX=iz.sharedManager,MX={createData:function(t){var e=t.requestRenderData();return e.dataLength=2,e.resize(4,6),e},updateRenderData:function(t){t.type===BU.IMAGE_STENCIL&&(xX.updateRenderData(t),xX.updateColor(t))},fillBuffers:function(t,e){(t.type!==BU.IMAGE_STENCIL||t.spriteFrame)&&(RX.pushMask(t),e.finishMergeBatches(),function(t,e){RX.clear(t),e.commitModel(t,t._clearModel,t._clearStencilMtl)}(t,e),function(t,e){if(RX.enterLevel(t),t.type===BU.IMAGE_STENCIL){xX.fillBuffers(t,e);var n=t.graphics.getMaterialInstance(0);e.forceMergeBatches(n,t.spriteFrame,t.graphics)}else t.graphics.updateAssembler(e)}(t,e),RX.enableMask())}},OX={fillBuffers:function(){RX.exitMask()}},NX={getAssembler:function(){return MX}},BX={getAssembler:function(){return OX}};kU.Assembler=NX,kU.PostAssembler=BX;var LX=t("MeshBuffer",function(){function t(){this.byteOffset=0,this.vertexOffset=0,this.indexOffset=0,this.vData=null,this.iData=null,this._dirty=!1,this._vertexFormatBytes=0,this._floatsPerVertex=0,this._initVDataCount=0,this._initIDataCount=0,this._attributes=null,this._iaPool=[],this._iaInfo=null,this._nextFreeIAHandle=0}var e=t.prototype;return e.initialize=function(t,e,n,i){this._initVDataCount=n,this._initIDataCount=i,this._attributes=e,this._floatsPerVertex=rV(e),this._initVDataCount,this._floatsPerVertex,F(9005),this.vData&&this.iData||(this.vData=new Float32Array(this._initVDataCount),this.iData=new Uint16Array(this._initIDataCount)),this._iaPool.push(this.createNewIA(t))},e.reset=function(){this._nextFreeIAHandle=0,this._dirty=!1},e.destroy=function(){this.reset(),this._attributes=null,this._iaInfo=null,this.vData=null,this.iData=null;for(var t=0;t<this._iaPool.length;++t){var e=this._iaPool[t];e.vertexBuffers[0]&&e.vertexBuffers[0].destroy(),e.indexBuffer&&e.indexBuffer.destroy(),e.ia.destroy()}this._iaPool.length=0},e.setDirty=function(){this._dirty=!0},e.request=function(){return R(9002),!1},e.requireFreeIA=function(t){return this._iaPool.length<=this._nextFreeIAHandle&&this._iaPool.push(this.createNewIA(t)),this._iaPool[this._nextFreeIAHandle++].ia},e.recycleIA=function(t){for(var e=this._iaPool,n=0;n<this._nextFreeIAHandle;++n)if(t===e[n].ia){var i=e[n];return e[n]=e[--this._nextFreeIAHandle],void(e[this._nextFreeIAHandle]=i)}},e.checkCapacity=function(t,e){var n=(this.vertexOffset+t)*this._floatsPerVertex,i=this.indexOffset+e;return!(n>this._initVDataCount||i>this._initIDataCount)},e.uploadBuffers=function(){if(0!==this.byteOffset&&this._dirty){for(var t=wu.__isWebIOS14OrIPadOS14Env?this._nextFreeIAHandle:1,e=this.byteOffset,n=this.indexOffset,i=0;i<t;++i){var r=this._iaPool[i],a=new Float32Array(this.vData.buffer,0,e>>2),o=new Uint16Array(this.iData.buffer,0,n),s=r.vertexBuffers[0];e>s.size&&s.resize(e),s.update(a),2*n>r.indexBuffer.size&&r.indexBuffer.resize(2*n),r.indexBuffer.update(o)}this._dirty=!1}},e.createNewIA=function(t){var e,n,i;if(wu.__isWebIOS14OrIPadOS14Env||!this._iaPool[0]){var r=this._vertexFormatBytes=this._floatsPerVertex*Float32Array.BYTES_PER_ELEMENT,a=Uint16Array.BYTES_PER_ELEMENT,o=t.createBuffer(new gr(yi.VERTEX|yi.TRANSFER_DST,Ai.HOST|Ai.DEVICE,r,r));i=t.createBuffer(new gr(yi.INDEX|yi.TRANSFER_DST,Ai.HOST|Ai.DEVICE,a,a)),n=[o],this._iaInfo=new Fr(this._attributes,n,i),e=t.createInputAssembler(this._iaInfo)}else e=t.createInputAssembler(this._iaInfo),n=this._iaInfo.vertexBuffers,i=this._iaInfo.indexBuffer;return{ia:e,vertexBuffers:n,indexBuffer:i}},Q(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}}]),t}()),FX=[WD.EventType.MOUSE_DOWN,WD.EventType.MOUSE_MOVE,WD.EventType.MOUSE_UP,WD.EventType.MOUSE_WHEEL],VX=[WD.EventType.TOUCH_START,WD.EventType.TOUCH_MOVE,WD.EventType.TOUCH_END,WD.EventType.TOUCH_CANCEL],zX=(new(function(){function t(){this.priority=FD.UI,this._isListDirty=!1,this._inDispatchCount=0,this._pointerEventProcessorList=[],this._processorListToAdd=[],this._processorListToRemove=[],qD._registerEventDispatcher(this),sD.callbacksInvoker.on(bw.ADD_POINTER_EVENT_PROCESSOR,this.addPointerEventProcessor,this),sD.callbacksInvoker.on(bw.REMOVE_POINTER_EVENT_PROCESSOR,this.removePointerEventProcessor,this),sD.callbacksInvoker.on(bw.MARK_LIST_DIRTY,this._markListDirty,this)}var e=t.prototype;return e.dispatchEvent=function(t){var e=t.type;return VX.includes(e)?this.dispatchEventTouch(t):!FX.includes(e)||this.dispatchEventMouse(t)},e.addPointerEventProcessor=function(t){0===this._inDispatchCount?this._pointerEventProcessorList.includes(t)||(this._pointerEventProcessorList.push(t),this._isListDirty=!0):this._processorListToAdd.includes(t)||this._processorListToAdd.push(t),re.array.remove(this._processorListToRemove,t)},e.removePointerEventProcessor=function(t){0===this._inDispatchCount?(re.array.remove(this._pointerEventProcessorList,t),this._isListDirty=!0):this._processorListToRemove.includes(t)||this._processorListToRemove.push(t),re.array.remove(this._processorListToAdd,t)},e.dispatchEventMouse=function(t){this._inDispatchCount++,this._sortPointerEventProcessorList();for(var e=this._pointerEventProcessorList,n=e.length,i=!0,r=0;r<n;++r){var a=e[r];if(a.isEnabled&&a.shouldHandleEventMouse&&a._handleEventMouse(t)){if(i=!1,!t.preventSwallow)break;t.preventSwallow=!1}}return--this._inDispatchCount<=0&&this._updatePointerEventProcessorList(),i},e.dispatchEventTouch=function(t){this._inDispatchCount++,this._sortPointerEventProcessorList();for(var e=this._pointerEventProcessorList,n=e.length,i=t.touch,r=!0,a=0;a<n;++a){var o=e[a];if(o.isEnabled&&o.shouldHandleEventTouch)if(t.type===Sw.TOUCH_START){if(o._handleEventTouch(t)){if(o.claimedTouchIdList.push(i.getID()),r=!1,!t.preventSwallow)break;t.preventSwallow=!1}}else if(o.claimedTouchIdList.length>0){var s=o.claimedTouchIdList.indexOf(i.getID());if(-1!==s){if(o._handleEventTouch(t),t.type!==Sw.TOUCH_END&&t.type!==Sw.TOUCH_CANCEL||re.array.removeAt(o.claimedTouchIdList,s),r=!1,!t.preventSwallow)break;t.preventSwallow=!1}}}return--this._inDispatchCount<=0&&this._updatePointerEventProcessorList(),r},e._updatePointerEventProcessorList=function(){for(var t=this._processorListToAdd,e=t.length,n=0;n<e;++n)this.addPointerEventProcessor(t[n]);t.length=0;for(var i=this._processorListToRemove,r=i.length,a=0;a<r;++a)this.removePointerEventProcessor(i[a]);i.length=0},e._sortPointerEventProcessorList=function(){if(this._isListDirty){for(var t=this._pointerEventProcessorList,e=t.length,n=0;n<e;++n){var i=t[n],r=i.node;if(r._uiProps){var a=r._uiProps.uiTransformComp;i.cachedCameraPriority=a.cameraPriority}}t.sort(this._sortByPriority),this._isListDirty=!1}},e._sortByPriority=function(t,e){var n=t.node,i=e.node;if(!(e&&i&&i.activeInHierarchy&&i._uiProps.uiTransformComp))return-1;if(!(t&&n&&n.activeInHierarchy&&n._uiProps.uiTransformComp))return 1;if(t.cachedCameraPriority!==e.cachedCameraPriority)return e.cachedCameraPriority-t.cachedCameraPriority;for(var r=n,a=i,o=!1;(null===(s=r.parent)||void 0===s?void 0:s._id)!==(null===(c=a.parent)||void 0===c?void 0:c._id);){var s,c,l,h,u,_;r=null===(null===(l=r)||void 0===l||null===(h=l.parent)||void 0===h?void 0:h.parent)?(o=!0)&&i:r&&r.parent,a=null===(null===(u=a)||void 0===u||null===(_=u.parent)||void 0===_?void 0:_.parent)?(o=!0)&&n:a&&a.parent}if(r._id===a._id){if(r._id===i._id)return-1;if(r._id===n._id)return 1}var f=r?r.getSiblingIndex():0,d=a?a.getSiblingIndex():0;return o?f-d:d-f},e._markListDirty=function(){this._isListDirty=!0},t}()),function(){function t(t,e){this._device=null,this._attributes=null,this._vertexFormatBytes=void 0,this._floatsPerVertex=void 0,this._buffers=[],this._device=t,this._attributes=e,this._floatsPerVertex=rV(e),this._vertexFormatBytes=this._floatsPerVertex*Float32Array.BYTES_PER_ELEMENT}var e=t.prototype;return e.initialize=function(){},e.reset=function(){},e.request=function(){},e.appendBuffers=function(){},e.uploadBuffers=function(){},e.destroy=function(){this._attributes.length=0},Q(t,[{key:"attributes",get:function(){return this._attributes}},{key:"vertexFormatBytes",get:function(){return this._vertexFormatBytes}},{key:"floatsPerVertex",get:function(){return this._floatsPerVertex}}]),t}()),kX=new ql((function(){return{offset:0,length:0}}),32),UX=function(t,e,n,i){this.vertexAccessor=t,this.bufferId=e,this.vertexOffset=n,this.vb=i},GX=function(t){function e(n,i,r,a){var o;return(o=t.call(this,n,i)||this)._freeLists=[],o._vCount=0,o._iCount=0,o._vCount=r||Math.floor(1024*_e.BATCHER2D_MEM_INCREMENT/o._vertexFormatBytes),o._iCount=a||o._vCount*e.IB_SCALE,o._allocateBuffer(),o}$(e,t);var n=e.prototype;return n.destroy=function(){for(var e=0;e<this._buffers.length;++e){this._buffers[e].destroy();for(var n=this._freeLists[e],i=0;i<n.length;++i)kX.free(n[i])}this._buffers.length=0,this._freeLists.length=0,t.prototype.destroy.call(this)},n.reset=function(){for(var t=0;t<this._buffers.length;++t){var e=this._buffers[t];e.indexOffset=0,e.reset()}},n.getVertexBuffer=function(t){return this._buffers[t].vData},n.getIndexBuffer=function(t){return this._buffers[t].iData},n.getMeshBuffer=function(t){return this._buffers[t]},n.uploadBuffers=function(){for(var t=0;t<this._buffers.length;++t){var e=this._freeLists[t][0],n=this._buffers[t];(!e||e.length<n.vData.byteLength)&&n.uploadBuffers()}},n.appendIndices=function(t,e){var n=this._buffers[t];e.length&&(n.iData.set(e,n.indexOffset),n.indexOffset+=e.length)},n.allocateChunk=function(t,e){for(var n,i=t*this.vertexFormatBytes,r=null,a=0,o=-1,s=null,c=0;c<this._buffers.length;++c){r=this._buffers[c],n=this._freeLists[c];for(var l=0;l<n.length;++l)if(n[l].length>=i){s=n[l],a=c,o=l;break}if(s)break}if(s||(a=this._allocateBuffer(),(r=this._buffers[a])&&r.checkCapacity(t,e)&&(o=0,s=this._freeLists[a][o])),s){var h=s.offset/this.vertexFormatBytes,u=new Float32Array(r.vData.buffer,s.offset,i>>2).fill(0);return this._allocateChunkFromEntry(a,o,s,i),new UX(this,a,h,u,e)}return O(9004,i),null},n.recycleChunk=function(t){var e=this._freeLists[t.bufferId],n=this._buffers[t.bufferId],i=t.vertexOffset*this.vertexFormatBytes,r=t.vb.byteLength;if(0!==r){for(var a=!1,o=0,s=null,c=e[o];c&&c.offset<i;)s=c,c=e[++o];if(s&&0==i-(s.offset+s.length)&&(s.length+=r,i=s.offset,r=s.length,c&&c.offset-(i+r)==0&&(s.length+=c.length,e.splice(o,1),kX.free(c),c=null),a=!0),!a&&c){if(0==c.offset-(i+r))c.offset=i,c.length+=r;else{var l=kX.alloc();l.offset=i,l.length=r,e.splice(o,0,l)}a=!0}if(a)i+r===n.byteOffset&&(n.byteOffset=i);else{var h=kX.alloc();h.offset=i,h.length=r,e.push(h)}}},n._allocateChunkFromEntry=function(t,e,n,i){var r=n.length-i,a=n.offset+i,o=this._buffers[t];o.byteOffset<a&&(o.byteOffset=a),L(r>=0,9004,t,n.offset,n.length),0===r?(this._freeLists[t].splice(e,1),kX.free(n)):(n.offset+=i,n.length=r)},n._allocateBuffer=function(){L(this._buffers.length===this._freeLists.length,9003);var t=new LX,e=this._vCount*this._floatsPerVertex;t.initialize(this._device,this._attributes,e,this._iCount),this._buffers.push(t);var n=kX.alloc();n.offset=0,n.length=t.vData.byteLength;var i=[n];return this._freeLists.push(i),this._buffers.length-1},e}(zX);GX.IB_SCALE=4;var HX=new Yr(null),jX=new Xn,WX=t("UI",function(){function t(t){var e=this;this.device=void 0,this._screens=[],this._staticVBBuffer=null,this._bufferAccessors=new Map,this._drawBatchPool=void 0,this._batches=void 0,this._currBID=-1,this._indexStart=0,this._emptyMaterial=new vg,this._currRenderData=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currStaticRoot=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0,this._currDepthStencilStateStage=null,this._currIsStatic=!1,this._currHash=0,this._pOpacity=1,this._opacityDirty=0,this._descriptorSetCache=new XX,this._meshDataArray=[],this._root=t,this.device=t.device,this._batches=new Yl(64),this._drawBatchPool=new ql((function(){return new Hj}),128,(function(t){return t.destroy(e)}))}var e=t.prototype;return e.initialize=function(){return!0},e.destroy=function(){for(var t=0;t<this._batches.length;t++)this._batches.array[t]&&this._batches.array[t].destroy(this);this._batches.destroy(),this._bufferAccessors.forEach((function(t){t.destroy()})),this._bufferAccessors.clear(),this._drawBatchPool&&this._drawBatchPool.destroy(),this._descriptorSetCache.destroy(),iz.sharedManager.destroy()},e.addScreen=function(t){this._screens.push(t),this._screens.sort(this._screenSort)},e.removeScreen=function(t){var e=this._screens.indexOf(t);-1!==e&&this._screens.splice(e,1)},e.sortScreens=function(){this._screens.sort(this._screenSort)},e.getFirstRenderCamera=function(t){if(t.scene&&t.scene.renderScene)for(var e=t.scene.renderScene.cameras,n=0;n<e.length;n++){var i=e[n];if(i.visibility&t.layer)return i}return null},e.update=function(){for(var t=this._screens,e=0,n=0;n<t.length;++n){var i=t[n],r=i._getRenderScene();if(i.enabledInHierarchy&&r){this._opacityDirty=0,this._pOpacity=1,this.walk(i.node),this.autoMergeBatches(this._currComponent),this.resetRenderStates();var a=0;if(this._batches.length>e)for(;e<this._batches.length;++e){var o=this._batches.array[e];if(o.model)for(var s=o.model.subModels,c=0;c<s.length;c++)s[c].priority=a++;else o.descriptorSet=this._descriptorSetCache.getDescriptorSet(o);r.addBatch(o)}}}},e.uploadBuffers=function(){this._batches.length>0&&(this._meshDataArray.forEach((function(t){t.uploadBuffers()})),this._bufferAccessors.forEach((function(t){t.uploadBuffers(),t.reset()})),this._descriptorSetCache.update())},e.reset=function(){for(var t=0;t<this._batches.length;++t){var e=this._batches.array[t];e.isStatic||(e.clear(),this._drawBatchPool.free(e))}this._bufferAccessors.forEach((function(t){t.reset()})),this._meshDataArray.forEach((function(t){t.freeIAPool()})),this._meshDataArray.length=0,this._staticVBBuffer=null,this._currBID=-1,this._indexStart=0,this._currHash=0,this._currLayer=0,this._currRenderData=null,this._currMaterial=this._emptyMaterial,this._currTexture=null,this._currSampler=null,this._currComponent=null,this._currTransform=null,this._batches.clear(),iz.sharedManager.reset()},e.switchBufferAccessor=function(t){void 0===t&&(t=nV);var e=t===nV?36:aV(t);if(!this._staticVBBuffer||this._staticVBBuffer.vertexFormatBytes!==e){var n=this._bufferAccessors.get(e);n||(n=new GX(this.device,t),this._bufferAccessors.set(e,n)),this._staticVBBuffer=n,this._currBID=-1}return this._staticVBBuffer},e.registerBufferAccessor=function(t,e){this._bufferAccessors.set(t,e)},e.updateBuffer=function(t,e){var n=this.switchBufferAccessor(t);this._currBID!==e&&(this._currBID=e,this._indexStart=n.getMeshBuffer(e).indexOffset)},e.commitComp=function(t,e,n,i,r){var a,o=0,s=-1;if(e&&e.chunk){if(!e.isValid())return;o=e.dataHash,a=e.material,s=e.chunk.bufferId}t.stencilStage=iz.sharedManager.stage;var c=t.stencilStage;this._currHash===o&&0!==o&&this._currMaterial===a&&this._currDepthStencilStateStage===c||(this.autoMergeBatches(this._currComponent),e&&!e.isMeshBuffer&&this.updateBuffer(e.vertexFormat,s),this._currRenderData=e,this._currHash=e?e.dataHash:0,this._currComponent=t,this._currTransform=r,this._currMaterial=t.getRenderMaterial(0),this._currDepthStencilStateStage=c,this._currLayer=t.node.layer,n?(this._currTexture=n.getGFXTexture(),this._currSampler=n.getGFXSampler(),this._currTextureHash=n.getHash(),this._currSamplerHash=this._currSampler.hash):(this._currTexture=null,this._currSampler=null,this._currTextureHash=0,this._currSamplerHash=0)),i.fillBuffers(t,this)},e.commitIA=function(t,e,n,i,r){var a,o;this._currMaterial!==this._emptyMaterial&&(this.autoMergeBatches(this._currComponent),this.resetRenderStates());var s=0,c=0;t&&(a=-1===t.blendHash?null:t.getBlendState(),c=t.blendHash,t.stencilStage=iz.sharedManager.stage,o=null!==t.customMaterial?iz.sharedManager.getStencilStage(t.stencilStage,i):iz.sharedManager.getStencilStage(t.stencilStage),s=iz.sharedManager.getStencilHash(t.stencilStage));var l=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();l.visFlags=t.node.layer,l.inputAssembler=e,l.useLocalData=r||null,n&&(l.texture=n.getGFXTexture(),l.sampler=n.getGFXSampler(),l.textureHash=n.getHash(),l.samplerHash=l.sampler.hash),l.fillPasses(i||null,o,s,a,c,null,this),this._batches.push(l)},e.commitModel=function(t,e,n){var i;this._currMaterial!==this._emptyMaterial&&(this.autoMergeBatches(this._currComponent),this.resetRenderStates());var r=0;n&&(t.stencilStage!==xV.ENABLED&&t.stencilStage!==xV.DISABLED||(t.stencilStage=iz.sharedManager.stage),i=iz.sharedManager.getStencilStage(t.stencilStage,n),r=iz.sharedManager.getStencilHash(t.stencilStage));var a=h.director.getTotalFrames();e&&(e.updateTransform(a),e.updateUBOs(a));for(var o=0;o<e.subModels.length;o++){var s=this._drawBatchPool.alloc(),c=e.subModels[o];s.visFlags=t.node.layer,s.model=e,s.texture=null,s.sampler=null,s.useLocalData=null,i||(i=null),s.fillPasses(n,i,r,null,0,c.patches,this),s.inputAssembler=c.inputAssembler,s.model.visFlags=s.visFlags,s.descriptorSet=c.descriptorSet,this._batches.push(s)}},e.setupStaticBatch=function(t,e){this.finishMergeBatches(),this._staticVBBuffer=e,this.currStaticRoot=t},e.endStaticBatch=function(){this.finishMergeBatches(),this.currStaticRoot=null,this._staticVBBuffer=null,this.switchBufferAccessor()},e.commitStaticBatch=function(t){this._batches.concat(t.drawBatchList),this.finishMergeBatches()},e.autoMergeBatches=function(t){var e=this._currMaterial;if(e){var n,i=this._currRenderData,r=this._staticVBBuffer;if(i&&i.isMeshBuffer)n=i.requestIA(this.device),-1===this._meshDataArray.indexOf(i)&&this._meshDataArray.push(i);else if(r){var a=this._currBID,o=r.getMeshBuffer(a);if(!o)return;var s=o.indexOffset-this._indexStart;if(s<=0)return;this._indexStart,o.indexOffset,o.setDirty(),(n=o.requireFreeIA(this.device)).firstIndex=this._indexStart,n.indexCount=s,this._indexStart=o.indexOffset}if(this._currBID=-1,n){var c,l,h=0,u=0;t&&(c=-1===t.blendHash?null:t.getBlendState(),u=t.blendHash,l=null!==t.customMaterial?iz.sharedManager.getStencilStage(t.stencilStage,e):iz.sharedManager.getStencilStage(t.stencilStage),h=iz.sharedManager.getStencilHash(t.stencilStage));var _=this._currStaticRoot?this._currStaticRoot._requireDrawBatch():this._drawBatchPool.alloc();_.visFlags=this._currLayer,_.texture=this._currTexture,_.sampler=this._currSampler,_.inputAssembler=n,_.useLocalData=this._currTransform,_.textureHash=this._currTextureHash,_.samplerHash=this._currSamplerHash,_.fillPasses(e,l,h,c,u,null,this),this._batches.push(_)}}},e.forceMergeBatches=function(t,e,n){this._currMaterial=t,e?(this._currTexture=e.getGFXTexture(),this._currSampler=e.getGFXSampler(),this._currTextureHash=e.getHash(),this._currSamplerHash=this._currSampler.hash):(this._currTexture=this._currSampler=null,this._currTextureHash=this._currSamplerHash=0),this._currLayer=n.node.layer,this.autoMergeBatches(n)},e.resetRenderStates=function(){this._currMaterial=this._emptyMaterial,this._currRenderData=null,this._currTexture=null,this._currComponent=null,this._currTransform=null,this._currTextureHash=0,this._currSamplerHash=0,this._currLayer=0},e.finishMergeBatches=function(){this.autoMergeBatches(),this.resetRenderStates()},e.flushMaterial=function(t){this._currMaterial=t},e.walk=function(t,e){if(void 0===e&&(e=0),t.activeInHierarchy){var n=t.children,i=t._uiProps,r=i.uiComp,a=this._pOpacity,o=a,s=r&&r.color?r.color.a/255:1;if(this._pOpacity=o*=s*i.localOpacity,i._opacity=o,i.colorDirty&&this._opacityDirty++,r&&r.enabledInHierarchy&&r.updateAssembler(this),this._opacityDirty&&r&&!r.useVertexOpacity&&r.renderData&&r.renderData.vertexCount>0){!function(t,e){for(var n,i,r,a=t.vertexFormat,o=t.chunk.vb,s=0,c=0;c<a.length;++c){if(n=a[c],(i=aa[n.format]).hasAlpha)if(r=t.floatStride,i.size/i.count==1)for(var l=~~un(Math.round(255*e),0,255),h=s;h<o.length;h+=r)o[h]=(4294967040&o[h]|l)>>>0;else if(i.size/i.count==4)for(var u=s+3;u<o.length;u+=r)o[u]=e;s+=i.size>>2}}(r.renderData,o);var c=r.renderData.getMeshBuffer();c&&c.setDirty()}if(n.length>0&&!t._static)for(var l=0;l<n.length;++l){var h=n[l];this.walk(h,e)}i.colorDirty&&(this._opacityDirty--,i.colorDirty=!1),this._pOpacity=a,r&&r.enabledInHierarchy&&r.postUpdateAssembler(this),e+=1}},e._screenSort=function(t,e){return t.node.getSiblingIndex()-e.node.getSiblingIndex()},e._releaseDescriptorSetCache=function(t){this._descriptorSetCache.releaseDescriptorSetCache(t)},Q(t,[{key:"currBufferAccessor",get:function(){return this._staticVBBuffer||(this._staticVBBuffer=this.switchBufferAccessor()),this._staticVBBuffer}},{key:"batches",get:function(){return this._batches}},{key:"currStaticRoot",set:function(t){this._currStaticRoot=t}},{key:"currIsStatic",set:function(t){this._currIsStatic=t}}]),t}()),qX=function(){function t(){this._descriptorSet=null,this._transform=null,this._textureHash=0,this._samplerHash=0,this._localBuffer=null,this._transformUpdate=!0;var t=h.director.root.device;this._localData=new Float32Array(Sp.COUNT),this._localBuffer=t.createBuffer(new gr(yi.UNIFORM|yi.TRANSFER_DST,Ai.HOST|Ai.DEVICE,Sp.SIZE,Sp.SIZE))}var e=t.prototype;return e.initialize=function(t){var e=h.director.root.device;this._transform=t.useLocalData,this._textureHash=t.textureHash,this._samplerHash=t.samplerHash,HX.layout=t.passes[0].localSetLayout,this._descriptorSet=e.createDescriptorSet(HX),this._descriptorSet.bindBuffer(Sp.BINDING,this._localBuffer);var n=Zd.SAMPLER_SPRITE;this._descriptorSet.bindTexture(n,t.texture),this._descriptorSet.bindSampler(n,t.sampler),this._descriptorSet.update(),this._transformUpdate=!0},e.updateTransform=function(t){t!==this._transform&&(this._transform=t,this._transformUpdate=!0,this.uploadLocalData())},e.equals=function(t,e,n){return this._transform===t&&this._textureHash===e&&this._samplerHash===n},e.reset=function(){this._transform=null,this._textureHash=0,this._samplerHash=0},e.destroy=function(){this._localBuffer&&(this._localBuffer.destroy(),this._localBuffer=null),this._descriptorSet&&(this._descriptorSet.destroy(),this._descriptorSet=null),this._localData=null},e.isValid=function(){return this._transform&&this._transform.isValid},e.uploadLocalData=function(){var t=this._transform;if((t.hasChangedFlags||t._dirtyFlags)&&(t.updateWorldTransform(),this._transformUpdate=!0),this._transformUpdate){var e=t.worldMatrix;Xn.toArray(this._localData,e,Sp.MAT_WORLD_OFFSET),Xn.inverseTranspose(jX,e);var n=Xn.determinant(jX),i=1/Math.sqrt(n);Xn.multiplyScalar(jX,jX,i),Xn.toArray(this._localData,jX,Sp.MAT_WORLD_IT_OFFSET),this._localBuffer.update(this._localData),this._transformUpdate=!1}},Q(t,[{key:"descriptorSet",get:function(){return this._descriptorSet}}]),t}(),XX=function(){function t(){this._descriptorSetCache=new Map,this._dsCacheHashByTexture=new Map,this._localDescriptorSetCache=[],this._localCachePool=void 0,this._localCachePool=new ql((function(){return new qX}),16,(function(t){return t.destroy()}))}var e=t.prototype;return e.getDescriptorSet=function(t){var e,n=h.director.root;if(t.useLocalData){for(var i=this._localDescriptorSetCache,r=0,a=i.length;r<a;r++){var o=i[r];if(o.equals(t.useLocalData,t.textureHash,t.samplerHash))return o.descriptorSet}var s=this._localCachePool.alloc();return s.initialize(t),this._localDescriptorSetCache.push(s),s.descriptorSet}if(e=t.textureHash^t.samplerHash,this._descriptorSetCache.has(e))return this._descriptorSetCache.get(e);HX.layout=t.passes[0].localSetLayout;var c=n.device.createDescriptorSet(HX),l=Zd.SAMPLER_SPRITE;return c.bindTexture(l,t.texture),c.bindSampler(l,t.sampler),c.update(),this._descriptorSetCache.set(e,c),this._dsCacheHashByTexture.set(t.textureHash,e),c},e.update=function(){var t=this._localDescriptorSetCache,e=[];t.forEach((function(n){if(n.isValid())n.uploadLocalData();else{n.reset();var i=t.indexOf(n);e.push(i)}}));for(var n=e.length-1;n>=0;n--)t.splice(e[n],1)},e.reset=function(){var t=this;this._localDescriptorSetCache.forEach((function(e){t._localCachePool.free(e)})),this._localDescriptorSetCache.length=0},e.releaseDescriptorSetCache=function(t){var e=this._dsCacheHashByTexture.get(t);e&&this._descriptorSetCache.has(e)&&(this._descriptorSetCache.get(e).destroy(),this._descriptorSetCache.delete(e),this._dsCacheHashByTexture.delete(t))},e.destroy=function(){this._descriptorSetCache.forEach((function(t){t.destroy()})),this._descriptorSetCache.clear(),this._dsCacheHashByTexture.clear(),this._localDescriptorSetCache.length=0,this._localCachePool.destroy()},t}();h.internal.Batcher2D=WX,G(LX.prototype,"MeshBuffer",["byteStart","vertexStart","indicesStart","request"].map((function(t){return{name:t,suggest:"please use meshBuffer.accessor."+t+" instead"}}))),k(LX.prototype,"MeshBuffer",[{name:"indicesOffset",newName:"indexOffset"}]),U(LX.prototype,"MeshBuffer",[{name:"vertexBuffers"},{name:"indexBuffer"}]),k(WX.prototype,"Batcher2D",[{name:"currBufferBatch",newName:"currBufferAccessor"},{name:"acquireBufferBatch",newName:"switchBufferAccessor"}]),U(EV.prototype,"MeshRenderData",[{name:"formatByte"},{name:"byteStart"},{name:"byteCount"}]),k(EV.prototype,"MeshRenderData",[{name:"indicesStart",newName:"indexStart"}]),t("QuadRenderData",function(t){function e(e){var n;return n=t.call(this,e)||this,R(9006),n}return $(e,t),e}(EV));var YX,KX,JX,QX,ZX,$X,tY,eY,nY,iY=null,rY=-1,aY="BES bswy:->@123",oY=Object.create(null),sY=[],cY=3e3;function lY(){for(var t=!0,e=Date.now(),n=sY.length-1;n>=0;n--){var i=sY[n],r=i.fontFamilyName;if(e-i.startTime>cY)R(4933,r),i.onComplete(null,r),sY.splice(n,1);else{var a=i.refWidth,o="40px "+r;iY.font=o,a!==UF(iY,aY,o)?(sY.splice(n,1),i.onComplete(null,r)):t=!1}}t&&(clearInterval(rY),rY=-1)}function hY(t,e,n){var i=function(t){var e=t.lastIndexOf(".ttf");if(-1===e)return t;var n,i=t.lastIndexOf("/");return-1!==(n=-1===i?t.substring(0,e)+"_LABEL":t.substring(i+1,e)+"_LABEL").indexOf(" ")&&(n='"'+n+'"'),n}(t);if(oY[i])n(null,i);else{if(!iY){var r=document.createElement("canvas");r.width=100,r.height=100,iY=r.getContext("2d")}var a=UF(iY,aY,"40px "+i),o=document.createElement("style");o.type="text/css";var s="";Number.isNaN(i)?s+="@font-face { font-family:"+i+"; src:":s+='@font-face { font-family:"'+i+'"; src:',s+='url("'+t+'");',o.textContent=s+"}",document.body.appendChild(o);var c=document.createElement("div"),l=c.style;if(l.fontFamily=i,c.innerHTML=".",l.position="absolute",l.left="-100px",l.top="-100px",document.body.appendChild(c),function(){if(void 0===YX)if("FontFace"in window){var t=/Gecko.*Firefox\/(\d+)/.exec(window.navigator.userAgent),e=/OS X.*Version\/10\..*Safari/.exec(window.navigator.userAgent)&&/Apple/.exec(window.navigator.vendor);YX=t?parseInt(t[1],10)>42:!e}else YX=!1;return YX}())!function(t,e,n){var i=new Promise((function(n,i){!function r(){Date.now()-t>=cY?i():document.fonts.load("40px "+e).then((function(t){t.length>=1?n():setTimeout(r,100)}),(function(){i()}))}()})),r=null,a=new Promise((function(t,e){r=setTimeout(e,cY)}));Promise.race([a,i]).then((function(){r&&(clearTimeout(r),r=null),n(null,e)}),(function(){R(4933,e),n(null,e)}))}(Date.now(),i,n);else{var h={fontFamilyName:i,refWidth:a,onComplete:n,startTime:Date.now()};sY.push(h),-1===rY&&(rY=setInterval(lY,100))}oY[i]=o}}function uY(t,e,n,i){var r=new bF;r._nativeUrl=t,r._nativeAsset=e,i(null,r)}function _Y(t){return"string"==typeof t||"number"==typeof t}pN.register({".font":hY,".eot":hY,".ttf":hY,".woff":hY,".svg":hY,".ttc":hY}),AN.register({".font":uY,".eot":uY,".ttf":uY,".woff":uY,".svg":uY,".ttc":uY}),h.UI={MeshBuffer:LX,spriteAssembler:DX,graphicsAssembler:DW,labelAssembler:Qq,RenderData:TV,MeshRenderData:EV};var fY,dY,pY,mY,vY,gY,yY,xY,SY,AY,bY,CY,TY,EY,wY,IY,PY,DY,RY,MY,OY,NY,BY=Ec("cc.animation.HierarchyPath")((ZX=function(){function t(t){ct(this,"path",QX,this),this.path=t||""}return t.prototype.get=function(t){return t instanceof TE?t.getChildByPath(this.path)||(R(3926,t.name,this.path),null):(R(3925),null)},t}(),QX=lt((JX=ZX).prototype,"path",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),KX=JX))||KX,LY=Ec("cc.animation.ComponentPath")((nY=function(){function t(t){ct(this,"component",eY,this),this.component=t||""}return t.prototype.get=function(t){return t instanceof TE?t.getComponent(this.component)||(R(3928,t.name,this.component),null):(R(3927),null)},t}(),eY=lt((tY=nY).prototype,"component",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),$X=tY))||$X,FY=Ec("cc.animation.UniformProxyFactory")((gY=function(){function t(t,e){ct(this,"passIndex",pY,this),ct(this,"uniformName",mY,this),ct(this,"channelIndex",vY,this),this.passIndex=e||0,this.uniformName=t||""}return t.prototype.forTarget=function(t){var e=t.passes[this.passIndex],n=e.getHandle(this.uniformName);if(!n)throw new Error('Material "'+t.name+'" has no uniform "'+this.uniformName+'"');if(Yv.getTypeFromHandle(n)<gi.SAMPLER1D){var i=void 0===this.channelIndex?n:e.getHandle(this.uniformName,this.channelIndex,gi.FLOAT);if(!i)throw new Error('Uniform "'+this.uniformName+" (in material "+t.name+") has no channel "+this.channelIndex+'"');return function(t,e){for(var n,i=st(t.shaderInfo.blocks);!(n=i()).done;)for(var r,a=st(n.value.members);!(r=a()).done;){var o=r.value;if(o.name===e)return o.count>1}return!1}(e,this.uniformName)?{set:function(t){e.setUniformArray(i,t)}}:{set:function(t){e.setUniform(i,t)}}}var r=Yv.getBindingFromHandle(n),a=e.properties[this.uniformName],o=a&&a.value?a.value+"-texture":Sm(a.type),s=Uv.get(o);return s||(S("Illegal texture default value: "+o+"."),s=Uv.get("default-texture")),{set:function(t){t||(t=s);var n=t.getGFXTexture();n&&n.width&&n.height&&(e.bindTexture(r,n),t instanceof sv&&e.bindSampler(r,h.game._gfxDevice.getSampler(t.getSamplerInfo())))}}},t}(),pY=lt((dY=gY).prototype,"passIndex",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),mY=lt(dY.prototype,"uniformName",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),vY=lt(dY.prototype,"channelIndex",[al],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){}}),fY=dY))||fY,VY=Ec("cc.animation.MorphWeightValueProxy")((bY=function(){function t(){ct(this,"subMeshIndex",SY,this),ct(this,"shapeIndex",AY,this)}return t.prototype.forTarget=function(t){var e=this;return{set:function(n){t.setWeight(n,e.subMeshIndex,e.shapeIndex)}}},t}(),SY=lt((xY=bY).prototype,"subMeshIndex",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),AY=lt(xY.prototype,"shapeIndex",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),yY=xY))||yY,zY=Ec("cc.animation.MorphWeightsValueProxy")((wY=function(){function t(){ct(this,"subMeshIndex",EY,this)}return t.prototype.forTarget=function(t){var e=this;return{set:function(n){t.setWeights(n,e.subMeshIndex)}}},t}(),EY=lt((TY=wY).prototype,"subMeshIndex",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),CY=TY))||CY,kY=Ec("cc.animation.MorphWeightsAllValueProxy")(IY=function(){function t(){}return t.prototype.forTarget=function(t){return{set:function(e){for(var n,i,r=null!==(n=null===(i=t.mesh)||void 0===i?void 0:i.struct.primitives.length)&&void 0!==n?n:0,a=0;a<r;++a)t.setWeights(e,a)}}},t}())||IY;function UY(t,e,n,i){var r,a,o,s,c,l,h=new e,u=new e,_=new e,f=Ec(t)((l=function(){function t(t,n,i){ct(this,"dataPoint",o,this),ct(this,"inTangent",s,this),ct(this,"outTangent",c,this),this.dataPoint=t||new e,this.inTangent=n||new e,this.outTangent=i||new e}var r=t.prototype;return r.lerp=function(t,e,r){var a=this.dataPoint,o=t.dataPoint;u=n(u,this.inTangent,r),_=n(_,t.outTangent,r);var s=e*e*e,c=e*e,l=s-2*c+e,f=-2*s+3*c,d=s-c;return h=n(h,a,2*s-3*c+1),h=i(h,h,u,l),h=i(h,h,o,f),h=i(h,h,_,d)},r.getNoLerp=function(){return this.dataPoint},t}(),o=lt((a=l).prototype,"dataPoint",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),s=lt(a.prototype,"inTangent",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),c=lt(a.prototype,"outTangent",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new e}}),r=a))||r;if(e===zn){var d=f.prototype.lerp;f.prototype.lerp=function(t,e,n){var i=d.call(this,t,e,n);return zn.normalize(i,i),i}}return f}var GY,HY,jY,WY,qY,XY,YY,KY,JY,QY,ZY,$Y,tK,eK,nK,iK,rK,aK,oK,sK,cK,lK,hK,uK,_K,fK,dK,pK=UY("cc.CubicSplineVec2Value",Qn,Qn.multiplyScalar,Qn.scaleAndAdd),mK=UY("cc.CubicSplineVec3Value",Mn,Mn.multiplyScalar,Mn.scaleAndAdd),vK=UY("cc.CubicSplineVec4Value",ei,ei.multiplyScalar,ei.scaleAndAdd),gK=UY("cc.CubicSplineQuatValue",zn,zn.multiplyScalar,zn.scaleAndAdd),yK=Ec("cc.CubicSplineNumberValue")((NY=function(){function t(t,e,n){ct(this,"dataPoint",RY,this),ct(this,"inTangent",MY,this),ct(this,"outTangent",OY,this),this.dataPoint=t,this.inTangent=e,this.outTangent=n}var e=t.prototype;return e.lerp=function(t,e,n){var i=this.dataPoint,r=t.dataPoint,a=e*e*e,o=e*e;return i*(2*a-3*o+1)+this.outTangent*n*(a-2*o+e)+r*(-2*a+3*o)+t.inTangent*n*(a-o)},e.getNoLerp=function(){return this.dataPoint},t}(),RY=lt((DY=NY).prototype,"dataPoint",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),MY=lt(DY.prototype,"inTangent",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),OY=lt(DY.prototype,"outTangent",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),PY=DY))||PY,xK=Symbol("CreateEval"),SK=Symbol("NormalizedFollow"),AK=Symbol("ConvertAsTrsPath"),bK=Symbol("TrackBinding"),CK=Ec("cc.animation.TrackPath")((WY=function(){function t(){ct(this,"_paths",jY,this)}var e=t.prototype;return e.toProperty=function(t){return this._paths.push(t),this},e.toElement=function(t){return this._paths.push(t),this},e.toHierarchy=function(t){return this._paths.push(new BY(t)),this},e.toComponent=function(t){var e=new LY("string"==typeof t?t:re.getClassName(t));return this._paths.push(e),this},e.toCustomized=function(t){return this._paths.push(t),this},e.append=function(){for(var t,e=arguments.length,n=new Array(e),i=0;i<e;i++)n[i]=arguments[i];var r=(t=this._paths).concat.apply(t,n.map((function(t){return t._paths})));return this._paths=r,this},e.isPropertyAt=function(t){return"string"==typeof this._paths[t]},e.parsePropertyAt=function(t){return this._paths[t]},e.isElementAt=function(t){return"number"==typeof this._paths[t]},e.parseElementAt=function(t){return this._paths[t]},e.isHierarchyAt=function(t){return this._paths[t]instanceof BY},e.parseHierarchyAt=function(t){return this.isHierarchyAt(t),this._paths[t].path},e.isComponentAt=function(t){return this._paths[t]instanceof LY},e.parseComponentAt=function(t){return this.isComponentAt(t),this._paths[t].component},e.slice=function(e,n){var i=new t;return i._paths=this._paths.slice(e,n),i},e.trace=function(t,e,n){var i,r;return null!==(i=e)&&void 0!==i||(e=0),null!==(r=n)&&void 0!==r||(n=this._paths.length),this[SK](t,e,n)},e[AK]=function(){for(var t,e=this._paths,n=e.length,i=0,r="";i<n;++i){var a=e[i];if(!(a instanceof BY))break;a.path&&(r?r+="/"+a.path:r=a.path)}if(i===n)return null;if(i!==n-1)return null;switch(e[i]){case"position":case"scale":case"rotation":case"eulerAngles":t=e[i];break;default:return null}return{node:r,property:t}},e[SK]=function(t,e,n){for(var i=this._paths,r=t,a=e;a<n;++a){var o=i[a];if(_Y(o)){if(!(o in r))return R(3929,o),null;r=r[o]}else r=o.get(r);if(null===r)break}return r},Q(t,[{key:"length",get:function(){return this._paths.length}}]),t}(),jY=lt((HY=WY).prototype,"_paths",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),GY=HY))||GY,TK=Ec("cc.animation.TrackBinding")(qY=Vc((JY=function(){function t(){ct(this,"path",YY,this),ct(this,"proxy",KY,this)}var e=t.prototype;return e.parseTrsPath=function(){return this.proxy?null:this.path[AK]()},e.createRuntimeBinding=function(t,e,n){var i=this.path,r=this.proxy,a=i.length,o=a-1;if(0===a||!i.isPropertyAt(o)&&!i.isElementAt(o)||r){if(r){var s=i[SK](t,0,a);if(null===s)return null;var c=r.forTarget(s),l={setValue:function(t){c.set(t)}},h=c.get;return h&&(l.getValue=function(){return h.call(c)}),l}return O(3921),null}var u=i.isPropertyAt(o)?i.parsePropertyAt(o):i.parseElementAt(o),_=i[SK](t,0,a-1);return null===_?null:e&&_ instanceof TE&&function(t){return"position"===t||"rotation"===t||"scale"===t||"eulerAngles"===t}(u)?e.createPoseWriter(_,u,n):{setValue:function(t){_[u]=t},getValue:function(){return _[u]}}},e.isMaskedOff=function(t){var e=this.parseTrsPath();if(!e)return!1;for(var n=t.joints[Symbol.iterator](),i=n.next();!i.done;i=n.next()){var r=i.value;if(r.path===e.node)return!r.enabled}return!1},t}(),YY=lt((XY=JY).prototype,"path",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new CK}}),KY=lt(XY.prototype,"proxy",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qY=XY))||qY)||qY,EK=Ec("cc.animation.Track")((tK=function(){function t(){ct(this,"_binding",$Y,this)}var e=t.prototype;return e.channels=function(){return[]},e.range=function(){for(var t,e={min:1/0,max:-1/0},n=st(this.channels());!(t=n()).done;){var i=t.value;e.min=Math.min(e.min,i.curve.rangeMin),e.max=Math.max(e.max,i.curve.rangeMax)}return e},Q(t,[{key:"path",get:function(){return this._binding.path},set:function(t){this._binding.path=t}},{key:"proxy",get:function(){return this._binding.proxy},set:function(t){this._binding.proxy=t}},{key:bK,get:function(){return this._binding}}]),t}(),$Y=lt((ZY=tK).prototype,"_binding",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new TK}}),QY=ZY))||QY,wK=Ec("cc.animation.Channel")((rK=function(){function t(t){this.name="",ct(this,"_curve",iK,this),this._curve=t}return Q(t,[{key:"curve",get:function(){return this._curve}}]),t}(),iK=lt((nK=rK).prototype,"_curve",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),eK=nK))||eK,IK=Ec("cc.animation.SingleChannelTrack")((cK=function(t){function e(){var e;return ct(e=t.call(this)||this,"_channel",sK,at(e)),e._channel=new wK(e.createCurve()),e}$(e,t);var n=e.prototype;return n.channels=function(){return[this._channel]},n.createCurve=function(){throw new Error("Not impl")},n[xK]=function(){var t=this._channel.curve;return new PK(t)},Q(e,[{key:"channel",get:function(){return this._channel}}]),e}(EK),sK=lt((oK=cK).prototype,"_channel",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),aK=oK))||aK,PK=function(){function t(t){this._curve=t}return t.prototype.evaluate=function(t){return this._curve.evaluate(t)},t}(),DK=Ec("cc.animation.RealTrack")(lK=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e.prototype.createCurve=function(){return new Pf},e}(IK))||lK;function RK(t){return 0===t.keyFramesCount?void 0:t}var MK,OK,NK,BK,LK,FK,VK,zK,kK,UK,GK,HK,jK=["X","Y","Z","W"],WK=Ec("cc.animation.VectorTrack")((dK=function(t){function e(){var e;ct(e=t.call(this)||this,"_channels",_K,at(e)),ct(e,"_nComponents",fK,at(e)),e._channels=new Array(4);for(var n=0;n<e._channels.length;++n){var i=new wK(new Pf);i.name=jK[n],e._channels[n]=i}return e}$(e,t);var n=e.prototype;return n.channels=function(){return this._channels},n[xK]=function(){switch(this._nComponents){default:case 2:return new qK(RK(this._channels[0].curve),RK(this._channels[1].curve));case 3:return new XK(RK(this._channels[0].curve),RK(this._channels[1].curve),RK(this._channels[2].curve));case 4:return new YK(RK(this._channels[0].curve),RK(this._channels[1].curve),RK(this._channels[2].curve),RK(this._channels[3].curve))}},Q(e,[{key:"componentsCount",get:function(){return this._nComponents},set:function(t){this._nComponents=t}}]),e}(EK),_K=lt((uK=dK).prototype,"_channels",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fK=lt(uK.prototype,"_nComponents",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),hK=uK))||hK,qK=function(){function t(t,e){this._result=new Qn,this._x=t,this._y=e}return t.prototype.evaluate=function(t,e){return this._x&&this._y||!e.getValue||Qn.copy(this._result,e.getValue()),this._x&&(this._result.x=this._x.evaluate(t)),this._y&&(this._result.y=this._y.evaluate(t)),this._result},t}(),XK=function(){function t(t,e,n){this._result=new Mn,this._x=t,this._y=e,this._z=n}return t.prototype.evaluate=function(t,e){return this._x&&this._y&&this._z||!e.getValue||Mn.copy(this._result,e.getValue()),this._x&&(this._result.x=this._x.evaluate(t)),this._y&&(this._result.y=this._y.evaluate(t)),this._z&&(this._result.z=this._z.evaluate(t)),this._result},t}(),YK=function(){function t(t,e,n,i){this._result=new ei,this._x=t,this._y=e,this._z=n,this._w=i}return t.prototype.evaluate=function(t,e){return this._x&&this._y&&this._z&&this._w||!e.getValue||ei.copy(this._result,e.getValue()),this._x&&(this._result.x=this._x.evaluate(t)),this._y&&(this._result.y=this._y.evaluate(t)),this._z&&(this._result.z=this._z.evaluate(t)),this._w&&(this._result.w=this._w.evaluate(t)),this._result},t}(),KK=Ec("cc.animation.QuatTrack")(MK=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.createCurve=function(){return new pd},n[xK]=function(){return new JK(this.channels()[0].curve)},e}(IK))||MK,JK=function(){function t(t){this._result=new zn,this._curve=t}return t.prototype.evaluate=function(t){return this._curve.evaluate(t,this._result),this._result},t}(),QK=["Red","Green","Blue","Alpha"],ZK=Ec("cc.animation.ColorTrack")((LK=function(t){function e(){var e;ct(e=t.call(this)||this,"_channels",BK,at(e)),e._channels=new Array(4);for(var n=0;n<e._channels.length;++n){var i=new wK(new Pf);i.name=QK[n],e._channels[n]=i}return e}$(e,t);var n=e.prototype;return n.channels=function(){return this._channels},n[xK]=function(){return new $K(RK(this._channels[0].curve),RK(this._channels[1].curve),RK(this._channels[2].curve),RK(this._channels[3].curve))},e}(EK),BK=lt((NK=LK).prototype,"_channels",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),OK=NK))||OK,$K=function(){function t(t,e,n,i){this._result=new Dn,this._x=t,this._y=e,this._z=n,this._w=i}return t.prototype.evaluate=function(t,e){return this._x&&this._y&&this._z&&this._w||!e.getValue||Dn.copy(this._result,e.getValue()),this._x&&(this._result.r=this._x.evaluate(t)),this._y&&(this._result.g=this._y.evaluate(t)),this._z&&(this._result.b=this._z.evaluate(t)),this._w&&(this._result.a=this._w.evaluate(t)),this._result},t}(),tJ=["Width","Height"],eJ=Ec("cc.animation.SizeTrack")((kK=function(t){function e(){var e;ct(e=t.call(this)||this,"_channels",zK,at(e)),e._channels=new Array(2);for(var n=0;n<e._channels.length;++n){var i=new wK(new Pf);i.name=tJ[n],e._channels[n]=i}return e}$(e,t);var n=e.prototype;return n.channels=function(){return this._channels},n[xK]=function(){return new nJ(RK(this._channels[0].curve),RK(this._channels[1].curve))},e}(EK),zK=lt((VK=kK).prototype,"_channels",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FK=VK))||FK,nJ=function(){function t(t,e){this._result=new ri,this._width=t,this._height=e}return t.prototype.evaluate=function(t,e){if((!this._width||!this._height)&&e.getValue){var n=e.getValue();this._result.x=n.x,this._result.y=n.y}return this._width&&(this._result.width=this._width.evaluate(t)),this._height&&(this._result.height=this._height.evaluate(t)),this._result},t}(),iJ=Ec("cc.animation.ObjectTrack")(UK=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e.prototype.createCurve=function(){return new Td},e}(IK))||UK,rJ=Symbol("[[Owner]]");function aJ(t){t[rJ]}!function(t){t[t.FLOAT=0]="FLOAT",t[t.BOOLEAN=1]="BOOLEAN",t[t.TRIGGER=2]="TRIGGER",t[t.INTEGER=3]="INTEGER"}(GK||(GK={})),function(t){t[t.AFTER_CONSUMED=0]="AFTER_CONSUMED",t[t.NEXT_FRAME_OR_AFTER_CONSUMED=1]="NEXT_FRAME_OR_AFTER_CONSUMED"}(HK||(HK={}));var oJ,sJ,cJ,lJ,hJ,uJ,_J,fJ,dJ,pJ,mJ,vJ,gJ,yJ,xJ,SJ,AJ,bJ,CJ,TJ,EJ,wJ,IJ,PJ,DJ,RJ,MJ,OJ,NJ,BJ,LJ,FJ,VJ,zJ,kJ,UJ,GJ,HJ,jJ,WJ,qJ,XJ,YJ,KJ,JJ,QJ,ZJ,$J,tQ,eQ,nQ,iQ,rQ,aQ,oQ,sQ,cQ,lQ,hQ,uQ,_Q,fQ,dQ,pQ,mQ,vQ,gQ,yQ=function(){function t(t,e){this.type=void 0,this.resetMode=HK.AFTER_CONSUMED,this._value=void 0,this._refs=[],this.type=t,this._value=e}return t.prototype.bind=function(t,e){for(var n=arguments.length,i=new Array(n>2?n-2:0),r=2;r<n;r++)i[r-2]=arguments[r];return this._refs.push({fn:t,thisArg:e,args:i}),this._value},Q(t,[{key:"value",get:function(){return this._value},set:function(t){this._value=t;for(var e,n=st(this._refs);!(e=n()).done;){var i=e.value,r=i.fn,a=i.thisArg,o=i.args;r.call.apply(r,[a,t].concat(o))}}}]),t}(),xQ=function(t){function e(e){var n;return(n=t.call(this,e+" transition is invalid")||this).name="TransitionRejectError",n}return $(e,t),e}(rt(Error)),SQ=function(t){function e(e){return t.call(this,"Graph variable "+e+" is not defined")||this}return $(e,t),e}(rt(Error)),AQ=function(t){function e(e,n,i){return t.call(this,"Expect graph variable "+e+" to have type '"+n+"' instead of received '"+(null!=i?i:typeof i)+"'")||this}return $(e,t),e}(rt(Error)),bQ=Symbol("[[createEval]]"),CQ=Symbol("[[Outgoing transitions]]"),TQ=Symbol("[[Incoming transitions]]"),EQ=Ec("cc.animation.State")((lJ=function(t){function e(){var e;return ct(e=t.call(this)||this,"name",cJ,at(e)),e[CQ]=[],e[TQ]=[],e}return $(e,t),e}(_l),cJ=lt((sJ=lJ).prototype,"name",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),oJ=sJ))||oJ,wQ=Ec("cc.animation.InteractiveState")((fJ=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_components",_J,at(e)),e}$(e,t);var n=e.prototype;return n.addComponent=function(t){var e=new t;return this._components.push(e),e},n.removeComponent=function(t){ft(this._components,t)},n.instantiateComponents=function(){return this._components.map((function(t){return m_(t)}))},Q(e,[{key:"components",get:function(){return this._components}}]),e}(EQ),_J=lt((uJ=fJ).prototype,"_components",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),hJ=uJ))||hJ,IQ=Ec("cc.animation.Motion")((xJ=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"motion",mJ,at(e)),ct(e,"speed",vJ,at(e)),ct(e,"speedMultiplier",gJ,at(e)),ct(e,"speedMultiplierEnabled",yJ,at(e)),e}return $(e,t),e.prototype.clone=function(){var t,n,i=new e;return i.motion=null!==(t=null===(n=this.motion)||void 0===n?void 0:n.clone())&&void 0!==t?t:null,i.speed=this.speed,i.speedMultiplier=this.speedMultiplier,i.speedMultiplierEnabled=this.speedMultiplierEnabled,i},e}(wQ),mJ=lt((pJ=xJ).prototype,"motion",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vJ=lt(pJ.prototype,"speed",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),gJ=lt(pJ.prototype,"speedMultiplier",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),yJ=lt(pJ.prototype,"speedMultiplierEnabled",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),dJ=pJ))||dJ,PQ=Symbol("[[OnAfterDeserialized]]"),DQ=Ec("cc.animation.Transition")((EJ=function(t){function e(e,n,i){var r;return ct(r=t.call(this)||this,"from",bJ,at(r)),ct(r,"to",CJ,at(r)),ct(r,"conditions",TJ,at(r)),r[rJ]=void 0,r.from=e,r.to=n,i&&(r.conditions=i),r}return $(e,t),e}(_l),bJ=lt((AJ=EJ).prototype,"from",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CJ=lt(AJ.prototype,"to",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),TJ=lt(AJ.prototype,"conditions",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),SJ=AJ))||SJ,RQ=Ec("cc.animation.AnimationTransition")((OJ=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"duration",PJ,at(e)),ct(e,"relativeDuration",DJ,at(e)),ct(e,"exitConditionEnabled",RJ,at(e)),ct(e,"_exitCondition",MJ,at(e)),e}return $(e,t),Q(e,[{key:"exitCondition",get:function(){return this._exitCondition},set:function(t){this._exitCondition=t}}]),e}(DQ),PJ=lt((IJ=OJ).prototype,"duration",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),DJ=lt(IJ.prototype,"relativeDuration",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),RJ=lt(IJ.prototype,"exitConditionEnabled",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),MJ=lt(IJ.prototype,"_exitCondition",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),wJ=IJ))||wJ,MQ=Ec("cc.animation.EmptyState")(NJ=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e}(EQ))||NJ,OQ=Ec("cc.animation.EmptyStateTransition")((VJ=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"duration",FJ,at(e)),e}return $(e,t),e}(DQ),FJ=lt((LJ=VJ).prototype,"duration",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),BJ=LJ))||BJ,NQ=Ec("cc.animation.StateMachine")((qJ=function(t){$(n,t);var e=n.prototype;function n(){var e;return ct(e=t.call(this)||this,"_states",UJ,at(e)),ct(e,"_transitions",GJ,at(e)),ct(e,"_entryState",HJ,at(e)),ct(e,"_exitState",jJ,at(e)),ct(e,"_anyState",WJ,at(e)),e._entryState=e._addState(new EQ),e._entryState.name="Entry",e._exitState=e._addState(new EQ),e._exitState.name="Exit",e._anyState=e._addState(new EQ),e._anyState.name="Any",e}return e.__callOnAfterDeserializeRecursive=function(){this[PQ]();for(var t=this._states.length,e=0;e<t;++e){var n=this._states[e];n instanceof BQ&&n.stateMachine.__callOnAfterDeserializeRecursive()}},e[PQ]=function(){this._states.forEach((function(){})),this._transitions.forEach((function(t){t.from[CQ].push(t),t.to[TQ].push(t)}))},e[bQ]=function(){throw new Error("Method not implemented.")},e.states=function(){return this._states},e.transitions=function(){return this._transitions},e.getTransitionsBetween=function(t,e){return aJ(t),aJ(e),t[CQ].filter((function(t){return t.to===e}))},e.getOutgoings=function(t){return aJ(t),t[CQ]},e.getIncomings=function(t){return aJ(t),t[TQ]},e.addMotion=function(){return this._addState(new IQ)},e.addSubStateMachine=function(){return this._addState(new BQ)},e.addEmpty=function(){return this._addState(new MQ)},e.remove=function(t){aJ(t),t!==this.entryState&&t!==this.exitState&&t!==this.anyState&&(this.eraseTransitionsIncludes(t),ft(this._states,t))},e.connect=function(t,e,n){if(aJ(t),aJ(e),e===this.entryState)throw new xQ("to-entry");if(e===this.anyState)throw new xQ("to-any");if(t===this.exitState)throw new xQ("from-exit");var i=t instanceof IQ||t===this._anyState?new RQ(t,e,n):t instanceof MQ?new OQ(t,e,n):new DQ(t,e,n);return this._transitions.push(i),t[CQ].push(i),e[TQ].push(i),i},e.disconnect=function(t,e){aJ(t),aJ(e);for(var n=t[CQ],i=e[TQ],r=this._transitions,a=n.filter((function(t){return t.to===e})),o=a.length,s=function(t){var e=a[t];ft(n,e),ft(r,e),dt(i,(function(t){return t===e}))},c=0;c<o;++c)s(c)},e.removeTransition=function(t){ft(this._transitions,t),dt(t.from[CQ],(function(e){return e===t})),dt(t.to[TQ],(function(e){return e===t}))},e.eraseOutgoings=function(t){var e=this;aJ(t);for(var n=t[CQ],i=function(t){var i=n[t],r=i.to;ft(e._transitions,i),dt(r[TQ],(function(t){return t===i}))},r=0;r<n.length;++r)i(r);n.length=0},e.eraseIncomings=function(t){var e=this;aJ(t);for(var n=t[TQ],i=function(t){var i=n[t],r=i.from;ft(e._transitions,i),dt(r[CQ],(function(t){return t===i}))},r=0;r<n.length;++r)i(r);n.length=0},e.eraseTransitionsIncludes=function(t){this.eraseIncomings(t),this.eraseOutgoings(t)},e.clone=function(){for(var t,e=new n,i=new Map,r=st(this._states);!(t=r()).done;){var a=t.value;switch(a){case this._entryState:i.set(a,e._entryState);break;case this._exitState:i.set(a,e._exitState);break;case this._anyState:i.set(a,e._anyState);break;default:if(a instanceof IQ||a instanceof BQ){var o=a.clone();e._addState(o),i.set(a,o)}}}for(var s,c=st(this._transitions);!(s=c()).done;){var l=s.value,h=i.get(l.from),u=i.get(l.to),_=e.connect(h,u);_.conditions=l.conditions.map((function(t){return t.clone()})),_ instanceof RQ&&(_.duration=l.duration,_.exitConditionEnabled=l.exitConditionEnabled,_.exitCondition=l.exitCondition)}return e},e._addState=function(t){return this._states.push(t),t},Q(n,[{key:"entryState",get:function(){return this._entryState}},{key:"exitState",get:function(){return this._exitState}},{key:"anyState",get:function(){return this._anyState}}]),n}(_l),UJ=lt((kJ=qJ).prototype,"_states",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),GJ=lt(kJ.prototype,"_transitions",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),HJ=lt(kJ.prototype,"_entryState",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jJ=lt(kJ.prototype,"_exitState",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),WJ=lt(kJ.prototype,"_anyState",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),zJ=kJ))||zJ,BQ=Ec("cc.animation.SubStateMachine")((JJ=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_stateMachine",KJ,at(e)),e}return $(e,t),e.prototype.clone=function(){var t=new e;return t._stateMachine=this._stateMachine.clone(),t},Q(e,[{key:"stateMachine",get:function(){return this._stateMachine}}]),e}(wQ),KJ=lt((YJ=JJ).prototype,"_stateMachine",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new NQ}}),XJ=YJ))||XJ,LQ=Ec("cc.animation.Layer")((iQ=function(){function t(){this[rJ]=void 0,ct(this,"_stateMachine",$J,this),ct(this,"name",tQ,this),ct(this,"weight",eQ,this),ct(this,"mask",nQ,this),this._stateMachine=new NQ}return Q(t,[{key:"stateMachine",get:function(){return this._stateMachine}}]),t}(),$J=lt((ZJ=iQ).prototype,"_stateMachine",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tQ=lt(ZJ.prototype,"name",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),eQ=lt(ZJ.prototype,"weight",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),nQ=lt(ZJ.prototype,"mask",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),QJ=ZJ))||QJ;!function(t){t[t.override=0]="override",t[t.additive=1]="additive"}(gQ||(gQ={})),HK.AFTER_CONSUMED;var FQ=Ec("cc.animation.PlainVariable")((cQ=function(){function t(t){if(ct(this,"_type",oQ,this),ct(this,"_value",sQ,this),void 0!==t)switch(this._type=t,t){default:break;case GK.FLOAT:case GK.INTEGER:this._value=0;break;case GK.BOOLEAN:this._value=!1}}return Q(t,[{key:"type",get:function(){return this._type}},{key:"value",get:function(){return this._value},set:function(t){this._value=t}}]),t}(),oQ=lt((aQ=cQ).prototype,"_type",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return GK.FLOAT}}),sQ=lt(aQ.prototype,"_value",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),rQ=aQ))||rQ,VQ=Ec("cc.animation.TriggerVariable")((_Q=function(){function t(){ct(this,"_flags",uQ,this)}return Q(t,[{key:"type",get:function(){return GK.TRIGGER}},{key:"value",get:function(){return!!((1&this._flags)>>0)},set:function(t){t?this._flags|=1:this._flags&=-2}},{key:"resetMode",get:function(){return(6&this._flags)>>1},set:function(t){this._flags&=-7,this._flags|=t<<1}}]),t}(),uQ=lt((hQ=_Q).prototype,"_flags",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),lQ=hQ))||lQ,zQ=Ec("cc.animation.AnimationGraph")((vQ=function(t){function e(){var e;return ct(e=t.call(this)||this,"_layers",pQ,at(e)),ct(e,"_variables",mQ,at(e)),e}$(e,t);var n=e.prototype;return n.onLoaded=function(){for(var t=this._layers,e=t.length,n=0;n<e;++n)t[n].stateMachine.__callOnAfterDeserializeRecursive()},n.addLayer=function(){var t=new LQ;return this._layers.push(t),t},n.removeLayer=function(t){ie.removeAt(this._layers,t)},n.moveLayer=function(t,e){!function(t,e,n){if(oe(t,e),oe(t,n),e===n)return t;var i=t[e];if(e<n)for(var r=e+1;r<=n;++r)t[r-1]=t[r];else for(var a=e;a!==n;--a)t[a]=t[a-1];t[n]=i}(this._layers,t,e)},n.addBoolean=function(t,e){void 0===e&&(e=!1);var n=new FQ(GK.BOOLEAN);n.value=e,this._variables[t]=n},n.addFloat=function(t,e){void 0===e&&(e=0);var n=new FQ(GK.FLOAT);n.value=e,this._variables[t]=n},n.addInteger=function(t,e){void 0===e&&(e=0);var n=new FQ(GK.INTEGER);n.value=e,this._variables[t]=n},n.addTrigger=function(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=HK.AFTER_CONSUMED);var i=new VQ;i.resetMode=n,i.value=e,this._variables[t]=i},n.removeVariable=function(t){delete this._variables[t]},n.getVariable=function(t){return this._variables[t]},Q(e,[{key:"layers",get:function(){return this._layers}},{key:"variables",get:function(){return Object.entries(this._variables)}}]),e}($h),pQ=lt((dQ=vQ).prototype,"_layers",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mQ=lt(dQ.prototype,"_variables",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),fQ=dQ))||fQ,kQ=Symbol("BakeNodeCurves"),UQ=t("SkelAnimDataHub",function(){function t(){}return t.getOrExtract=function(e){var n=t.pool.get(e);if(!n||n.samples!==e.sample){n&&h.director.root.dataPoolManager.releaseAnimationClip(e);var i=Math.ceil(e.sample*e.duration)+1,r=e.sample;n=e[kQ](0,r,i),t.pool.set(e,n)}return n},t.destroy=function(e){t.pool.delete(e)},t}());UQ.pool=new Map;var GQ=t("RatioSampler",function(){function t(t){var e,n;this.ratios=void 0,this._findRatio=void 0,this.ratios=t;for(var i=!0,r=1,a=t.length;r<a;r++)if(e=t[r]-t[r-1],1===r)n=e;else if(Math.abs(e-n)>1e-6){i=!1;break}this._findRatio=i?qQ:_c}return t.prototype.sample=function(t){return this._findRatio(this.ratios,t)},t}());h.RatioSampler=GQ;var HQ=t("AnimCurve",function(){function t(e,n){this.types=void 0,this.type=null,this._values=[],this._lerp=void 0,this._duration=void 0,this._array=void 0,this._duration=n,this._values=e.values;var i=function(e){return"string"==typeof e?e:Array.isArray(e)?e[0]===e[1]&&e[2]===e[3]?t.Linear:t.Bezier(e):t.Linear};if(void 0!==e.easingMethod)this.type=i(e.easingMethod);else if(Array.isArray(e.easingMethods))this.types=e.easingMethods.map(i);else if(void 0!==e.easingMethods){this.types=new Array(this._values.length).fill(null);for(var r=0,a=Object.keys(e.easingMethods);r<a.length;r++){var o=a[r];this.types[o]=i(e.easingMethods[o])}}else this.type=null;var s=e.values[0];(void 0===e.interpolate||e.interpolate)&&(this._lerp=eZ(s)),void 0!==e._arrayLength&&(this._array=new Array(e._arrayLength))}t.Bezier=function(t){return t};var e=t.prototype;return e.hasLerp=function(){return!!this._lerp},e.valueAt=function(t){if(void 0===this._array){var e=this._values[t];return e&&e.getNoLerp?e.getNoLerp():e}for(var n=0;n<this._array.length;++n)this._array[n]=this._values[this._array.length*t+n];return this._array},e.valueBetween=function(t,e,n,i,r){if(this._lerp){var a=this.types?this.types[e]:this.type,o=r-n,s=(t-n)/o;if(a&&(s=WQ(s,a)),void 0===this._array){var c=this._values[e],l=this._values[i];return this._lerp(c,l,s,o*this._duration)}for(var h=0;h<this._array.length;++h){var u=this._values[this._array.length*e+h],_=this._values[this._array.length*i+h];this._array[h]=this._lerp(u,_,s,o*this._duration)}return this._array}if(void 0===this._array)return this.valueAt(e);for(var f=0;f<this._array.length;++f)this._array[f]=this._values[this._array.length*e+f];return this._array},e.empty=function(){return 0===this._values.length},e.constant=function(){return 1===this._values.length},t}());function jQ(t,e,n){var i=e.sample(n);if(i<0)if((i=~i)<=0)i=0;else{if(!(i>=e.ratios.length))return t.valueBetween(n,i-1,e.ratios[i-1],i,e.ratios[i]);i=e.ratios.length-1}return t.valueAt(i)}function WQ(t,e){if("string"==typeof e){var n=gf[e];n?t=n(t):O(3906,e)}else Array.isArray(e)&&(t=ud(e,t));return t}function qQ(t,e){var n=t.length-1;if(0===n)return 0;var i=t[0];if(e<i)return 0;var r=t[n];if(e>r)return n;var a=(e=(e-i)/(r-i))/(1/n),o=0|a,s=1e-6;return a-o<s?o:o+1-a<s?o+1:~(o+1)}HQ.Linear=null,h.AnimCurve=HQ,t("EventInfo",function(){function t(){this.events=[]}return t.prototype.add=function(t,e){this.events.push({func:t||"",params:e||[]})},t}()),h.sampleAnimationCurve=jQ;var XQ,YQ,KQ,JQ,QQ,ZQ,$Q,tZ,eZ=function(){function t(t,e,n,i){return t.lerp(e,n,i)}return function(e){if(null!==e){if("number"==typeof e)return fn;if("object"==typeof e&&e.constructor){if(e instanceof zn)return n=new zn,function(t,e,i){return zn.slerp(n,t,e,i)};if(e instanceof ue)return function(t){var e=new t;return function(n,i,r){return t.lerp(e,n,i,r),e}}(e.constructor);if(e.constructor===Number)return fn;if("function"==typeof e.lerp)return t}var n}}}(),nZ=Ec("cc.animation.UntypedTrackChannel")((JQ=function(t){function e(){var e;return ct(e=t.call(this,new Pf)||this,"property",KQ,at(e)),e}return $(e,t),e}(wK),KQ=lt((YQ=JQ).prototype,"property",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),XQ=YQ))||XQ,iZ=Ec("cc.animation.UntypedTrack")((tZ=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_channels",$Q,at(e)),e}$(e,t);var n=e.prototype;return n.channels=function(){return this._channels},n[xK]=function(t){var e=this;if(!t.getValue)throw new Error(F(3930));var n=function(t){var n;return null===(n=e._channels.find((function(e){return e.property===t})))||void 0===n?void 0:n.curve},i=t.getValue();switch(!0){default:throw new Error(F(3931));case i instanceof Qn:return new qK(n("x"),n("y"));case i instanceof Mn:return new XK(n("x"),n("y"),n("z"));case i instanceof ei:return new YK(n("x"),n("y"),n("z"),n("w"));case i instanceof Dn:return new $K(n("r"),n("g"),n("b"),n("a"));case i instanceof ri:return new nJ(n("width"),n("height"))}},n.addChannel=function(t){var e=new nZ;return e.property=t,this._channels.push(e),e},n.upgrade=function(t){var e=this,n=function(t,n){var i=e.channels().find((function(e){return e.property===t}));i&&(n.name=i.name,n.curve.assignSorted(Array.from(i.curve.times()),Array.from(i.curve.values())))},i=t(this.path,this.proxy);switch(i){default:break;case"vec2":case"vec3":case"vec4":var r=new WK;r.path=this.path,r.proxy=this.proxy,r.componentsCount="vec2"===i?2:"vec3"===i?3:4;var a=r.channels(),o=a[0],s=a[1],c=a[2],l=a[3];switch(i){case"vec4":n("w",l);case"vec3":n("z",c);default:case"vec2":n("x",o),n("y",s)}return r;case"color":var h=new ZK,u=h.channels(),_=u[0],f=u[1],d=u[2],p=u[3];return n("r",_),n("g",f),n("b",d),n("a",p),n("x",_),n("y",f),n("z",d),n("w",p),h;case"size":}return null},e}(EK),$Q=lt((ZQ=tZ).prototype,"_channels",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),QQ=ZQ))||QQ,rZ=function(){function t(t){this._keys=[],this._curves=[],this._commonTargets=[],this._ratioSamplers=[],this._runtimeCurves=void 0,this._data=null,this._duration=void 0,this._duration=t}var e=t.prototype;return e.getPropertyCurves=function(){return this._runtimeCurves||this._createPropertyCurves(),this._runtimeCurves},e.toTracks=function(){for(var t,e=[],n=this.keys,i=this.curves,r=this.commonTargets,a=function(t,e,n){for(var i,r=new CK,a=st(e);!(i=a()).done;){var o=i.value;"string"==typeof o?r.toProperty(o):"number"==typeof o?r.toElement(o):o instanceof BY?r.toHierarchy(o.path):o instanceof LY?r.toComponent(o.component):r.toCustomized(o)}t.path=r,t.proxy=n},o=r.map((function(t){var n=new iZ;return a(n,t.modifiers,t.valueAdapter),e.push(n),n})),s=function(){var i,r=t.value,s=r.data,c=s.values;if(0===c.length)return"continue";var l=s.keys<0?[0]:n[s.keys],h=c[0],u=null===(i=s.interpolate)||void 0===i||i;s._arrayLength;var _=new oZ(s,l.length),f=function(t){a(t,r.modifiers,r.valueAdapter)},d=void 0;if("number"==typeof r.commonTarget){if(!c.every((function(t){return"number"==typeof t})))return R(3932),"continue";if(r.valueAdapter||1!==r.modifiers.length||"string"!=typeof r.modifiers[0])return R(3933),"continue";var p=r.modifiers[0],m=o[r.commonTarget].addChannel(p).curve;d=m}!function(){if("number"==typeof h){if(!c.every((function(t){return"number"==typeof t})))return void R(3934);var t;if(d)t=d;else{var n=new DK;f(n),e.push(n),t=n.channel.curve}var i=u?fc.LINEAR:fc.CONSTANT;return t.assignSorted(l,c.map((function(t){return{value:t,interpolationMode:i}}))),void _.convert(t)}if("object"==typeof h)switch(!0){default:break;case aZ(c,Qn):case aZ(c,Mn):case aZ(c,ei):var r=h instanceof Qn?2:h instanceof Mn?3:4,a=new WK;f(a),a.componentsCount=r;var o=a.channels(),s=o[0].curve,p=o[1].curve,m=o[2].curve,v=o[3].curve,g=u?fc.LINEAR:fc.CONSTANT,y=function(t){return{value:t,interpolationMode:g}};switch(r){case 4:v.assignSorted(l,c.map((function(t){return y(t.w)}))),_.convert(v);case 3:m.assignSorted(l,c.map((function(t){return y(t.z)}))),_.convert(m);default:s.assignSorted(l,c.map((function(t){return y(t.x)}))),_.convert(s),p.assignSorted(l,c.map((function(t){return y(t.y)}))),_.convert(p)}return void e.push(a);case aZ(c,zn):var x=new KK;f(x);var S=u?rd.SLERP:rd.CONSTANT;return x.channel.curve.assignSorted(l,c.map((function(t){return{value:zn.clone(t),interpolationMode:S}}))),_.convertQuatCurve(x.channel.curve),void e.push(x);case aZ(c,Dn):var A=new ZK;f(A);var b=A.channels(),C=b[0].curve,T=b[1].curve,E=b[2].curve,w=b[3].curve,I=u?fc.LINEAR:fc.CONSTANT,P=function(t){return{value:t,interpolationMode:I}};return C.assignSorted(l,c.map((function(t){return P(t.r)}))),_.convert(C),T.assignSorted(l,c.map((function(t){return P(t.g)}))),_.convert(T),E.assignSorted(l,c.map((function(t){return P(t.b)}))),_.convert(E),w.assignSorted(l,c.map((function(t){return P(t.a)}))),_.convert(w),void e.push(A);case aZ(c,ri):var D=new eJ;f(D);var M=D.channels(),O=M[0].curve,N=M[1].curve,B=u?fc.LINEAR:fc.CONSTANT,L=function(t){return{value:t,interpolationMode:B}};return O.assignSorted(l,c.map((function(t){return L(t.width)}))),_.convert(O),N.assignSorted(l,c.map((function(t){return L(t.height)}))),_.convert(N),void e.push(D);case aZ(c,yK):var F=new DK;f(F);var V=u?fc.CUBIC:fc.CONSTANT;return F.channel.curve.assignSorted(l,c.map((function(t){return{value:t.dataPoint,leftTangent:t.inTangent,rightTangent:t.outTangent,interpolationMode:V}}))),void e.push(F);case aZ(c,pK):case aZ(c,mK):case aZ(c,vK):var z=h instanceof pK?2:h instanceof mK?3:4,k=new WK;f(k),k.componentsCount=z;var U=k.channels(),G=U[0],H=U[1],j=U[2],W=U[3],q=u?fc.LINEAR:fc.CONSTANT,X=function(t,e,n){return{value:t,leftTangent:e,rightTangent:n,interpolationMode:q}};switch(z){case 4:W.curve.assignSorted(l,c.map((function(t){return X(t.dataPoint.w,t.inTangent.w,t.outTangent.w)})));case 3:j.curve.assignSorted(l,c.map((function(t){return X(t.dataPoint.z,t.inTangent.z,t.outTangent.z)})));default:G.curve.assignSorted(l,c.map((function(t){return X(t.dataPoint.y,t.inTangent.y,t.outTangent.y)}))),H.curve.assignSorted(l,c.map((function(t){return X(t.dataPoint.x,t.inTangent.x,t.outTangent.x)})))}return void e.push(k);case c.every((function(t){return t instanceof gK})):R(3935)}var Y=new iJ;f(Y),Y.channel.curve.assignSorted(l,c),e.push(Y)}()},c=st(i);!(t=c()).done;)s();return e},e._createPropertyCurves=function(){var t=this;this._ratioSamplers=this._keys.map((function(e){return new GQ(e.map((function(e){return e/t._duration})))})),this._runtimeCurves=this._curves.map((function(e){return{curve:new HQ(e.data,t._duration),modifiers:e.modifiers,valueAdapter:e.valueAdapter,sampler:t._ratioSamplers[e.data.keys],commonTarget:e.commonTarget}}))},Q(t,[{key:"keys",get:function(){return this._keys},set:function(t){this._keys=t}},{key:"curves",get:function(){return this._curves},set:function(t){this._curves=t,delete this._runtimeCurves}},{key:"commonTargets",get:function(){return this._commonTargets},set:function(t){this._commonTargets=t}},{key:"data",get:function(){return this._data}}]),t}();function aZ(t,e){return t.every((function(t){return t instanceof e}))}var oZ=function(){function t(t,e){this._easingMethods=void 0;var n=t.easingMethods;Array.isArray(n)?0===n.length&&0!==e?this._easingMethods=new Array(e).fill(null):this._easingMethods=n:this._easingMethods=void 0===n?new Array(e).fill(t.easingMethod):Array.from({length:e},(function(t,e){var i;return null!==(i=n[e])&&void 0!==i?i:null}))}var e=t.prototype;return e.convert=function(t){var e,n,i,r,a,o,s,c,l,h,u,_,f,d,p,m,v,g,y,x,S,A,b=this._easingMethods;if(b){var C=t.keyFramesCount;if(!(t.keyFramesCount<2)){Array.isArray(b)&&b.length;for(var T=C-1,E=0;E<T;++E){var w=b[E];w&&(Array.isArray(w)?(e=w,n=t.getKeyframeTime(E),i=t.getKeyframeValue(E),r=t.getKeyframeTime(E+1),a=t.getKeyframeValue(E+1),o=void 0,s=void 0,c=void 0,l=void 0,h=void 0,u=void 0,_=void 0,f=void 0,d=void 0,p=void 0,m=void 0,v=void 0,g=void 0,y=void 0,x=void 0,S=void 0,A=void 0,s=e[0],c=e[1],l=e[2],h=e[3],u=i.value,_=3*(r-n),f=3*(a.value-u),m=(1-l)*_,v=(1-h)*f,g=1/3,y=(p=c*f)/(d=s*_),x=Math.sqrt(d*d+p*p)*g,S=v/m,A=Math.sqrt(m*m+v*v)*g,i.interpolationMode=fc.CUBIC,i.tangentWeightMode=(o=i.tangentWeightMode)===pc.NONE?pc.RIGHT:o===pc.LEFT?pc.BOTH:o,i.rightTangent=y,i.rightTangentWeight=x,a.tangentWeightMode=function(t){return t===pc.NONE?pc.LEFT:t===pc.RIGHT?pc.BOTH:t}(a.tangentWeightMode),a.leftTangent=S,a.leftTangentWeight=A):sZ(w,t,E))}}}},e.convertQuatCurve=function(t){var e=this._easingMethods;if(e){var n=t.keyFramesCount;if(!(t.keyFramesCount<2)){Array.isArray(e)&&e.length;for(var i=n-1,r=0;r<i;++r){var a=e[r];a&&(Array.isArray(a)?t.getKeyframeValue(r).easingMethod=a.slice():cZ(a,t,r))}}}},Q(t,[{key:"nil",get:function(){return!this._easingMethods||this._easingMethods.every((function(t){return null==t}))}}]),t}();function sZ(t,e,n){e.keyFramesCount;var i=e.getKeyframeValue(n),r=VZ[t];r===vf.CONSTANT?i.interpolationMode=fc.CONSTANT:(i.interpolationMode=fc.LINEAR,i.easingMethod=r)}function cZ(t,e,n){e.keyFramesCount;var i=e.getKeyframeValue(n),r=VZ[t];i.easingMethod=r}var lZ,hZ,uZ,_Z,fZ,dZ,pZ,mZ,vZ,gZ,yZ,xZ,SZ,AZ,bZ,CZ,TZ,EZ,wZ,IZ,PZ,DZ,RZ,MZ,OZ,NZ,BZ,LZ,FZ,VZ={constant:vf.CONSTANT,linear:vf.LINEAR,quadIn:vf.QUAD_IN,quadOut:vf.QUAD_OUT,quadInOut:vf.QUAD_IN_OUT,quadOutIn:vf.QUAD_OUT_IN,cubicIn:vf.CUBIC_IN,cubicOut:vf.CUBIC_OUT,cubicInOut:vf.CUBIC_IN_OUT,cubicOutIn:vf.CUBIC_OUT_IN,quartIn:vf.QUART_IN,quartOut:vf.QUART_OUT,quartInOut:vf.QUART_IN_OUT,quartOutIn:vf.QUART_OUT_IN,quintIn:vf.QUINT_IN,quintOut:vf.QUINT_OUT,quintInOut:vf.QUINT_IN_OUT,quintOutIn:vf.QUINT_OUT_IN,sineIn:vf.SINE_IN,sineOut:vf.SINE_OUT,sineInOut:vf.SINE_IN_OUT,sineOutIn:vf.SINE_OUT_IN,expoIn:vf.EXPO_IN,expoOut:vf.EXPO_OUT,expoInOut:vf.EXPO_IN_OUT,expoOutIn:vf.EXPO_OUT_IN,circIn:vf.CIRC_IN,circOut:vf.CIRC_OUT,circInOut:vf.CIRC_IN_OUT,circOutIn:vf.CIRC_OUT_IN,elasticIn:vf.ELASTIC_IN,elasticOut:vf.ELASTIC_OUT,elasticInOut:vf.ELASTIC_IN_OUT,elasticOutIn:vf.ELASTIC_OUT_IN,backIn:vf.BACK_IN,backOut:vf.BACK_OUT,backInOut:vf.BACK_IN_OUT,backOutIn:vf.BACK_OUT_IN,bounceIn:vf.BOUNCE_IN,bounceOut:vf.BOUNCE_OUT,bounceInOut:vf.BOUNCE_IN_OUT,bounceOutIn:vf.BOUNCE_OUT_IN,smooth:vf.SMOOTH,fade:vf.FADE};function zZ(){throw new Error("split() only valid in Editor.")}Ec("cc.animation.ExoticAnimation")((uZ=function(){function t(){ct(this,"_nodeAnimations",hZ,this)}var e=t.prototype;return e.createEvaluator=function(t){return new KZ(this._nodeAnimations,t)},e.addNodeAnimation=function(t){var e=new kZ(t);return this._nodeAnimations.push(e),e},e.collectAnimatedJoints=function(){return Array.from(new Set(this._nodeAnimations.map((function(t){return t.path}))))},e.split=function(){return zZ()},e.toHashString=function(){return this._nodeAnimations.map((function(t){return t.toHashString()})).join("\n")},t}(),hZ=lt((lZ=uZ).prototype,"_nodeAnimations",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lZ));var kZ=Ec("cc.animation.ExoticNodeAnimation")((gZ=function(){function t(t){ct(this,"_path",dZ,this),ct(this,"_position",pZ,this),ct(this,"_rotation",mZ,this),ct(this,"_scale",vZ,this),this._path=t}var e=t.prototype;return e.createPosition=function(t,e){this._position=new qZ(t,new jZ(e))},e.createRotation=function(t,e){this._rotation=new qZ(t,new WZ(e))},e.createScale=function(t,e){this._scale=new qZ(t,new jZ(e))},e.createEvaluator=function(t){return new JZ(this._path,this._position,this._rotation,this._scale,t)},e.split=function(){return zZ()},e.toHashString=function(){var t,e,n,i,r,a;return this._path+"\n"+(null!==(t=null===(e=this._position)||void 0===e?void 0:e.toHashString())&&void 0!==t?t:"")+(null!==(n=null===(i=this._scale)||void 0===i?void 0:i.toHashString())&&void 0!==n?n:"")+(null!==(r=null===(a=this._rotation)||void 0===a?void 0:a.toHashString())&&void 0!==r?r:"")},Q(t,[{key:"path",get:function(){return this._path}}]),t}(),dZ=lt((fZ=gZ).prototype,"_path",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),pZ=lt(fZ.prototype,"_position",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mZ=lt(fZ.prototype,"_rotation",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vZ=lt(fZ.prototype,"_scale",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_Z=fZ))||_Z;function UZ(t){return t.toPrecision(2)}function GZ(t){return t.map(UZ).join(" ")}var HZ=Ec("cc.animation.ExoticVectorLikeTrackValues")((bZ=function(){function t(t){ct(this,"_values",SZ,this),ct(this,"_isQuantized",AZ,this),this._values=t,this._isQuantized=!1}var e=t.prototype;return e.quantize=function(t){this._isQuantized,this._values=function(t,e){var n=ZZ[e],i=1<<n.BYTES_PER_ELEMENT,r=Number.POSITIVE_INFINITY,a=Number.NEGATIVE_INFINITY;t.forEach((function(t){r=Math.min(t,r),a=Math.max(t,a)}));var o=a-r,s=n.from(t,(function(t){return(t-r)/o*i}));return new f$($Z(t),s,o,r)}(this._values,t),this._isQuantized=!0},e.toHashString=function(){var t=this._isQuantized,e=this._values;return t+" "+(t?e.toHashString():GZ(e))},Q(t,[{key:"precision",get:function(){return this._isQuantized?this._values.originalPrecision:$Z(this._values)}}]),t}(),SZ=lt((xZ=bZ).prototype,"_values",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),AZ=lt(xZ.prototype,"_isQuantized",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yZ=xZ))||yZ,jZ=Ec("cc.animation.ExoticVec3TrackValues")(CZ=function(t){function e(){return t.apply(this,arguments)||this}$(e,t),e.imitate=function(t,n){var i=new e(t);return n._isQuantized&&i.quantize(n._values.quantizationType),i};var n=e.prototype;return n.get=function(t,e){var n=this._values;this._isQuantized?m$(n,t,e):Mn.fromArray(e,n,3*t)},n.lerp=function(t,e,n,i,r,a){var o=this._values;this._isQuantized?(m$(o,t,i),m$(o,e,r)):(Mn.fromArray(i,o,3*t),Mn.fromArray(r,o,3*e)),Mn.lerp(a,i,r,n)},e}(HZ))||CZ,WZ=Ec("cc.animation.ExoticQuatTrackValues")(TZ=function(t){function e(){return t.apply(this,arguments)||this}$(e,t),e.imitate=function(t,n){var i=new e(t);return n._isQuantized&&i.quantize(n._values.quantizationType),i};var n=e.prototype;return n.get=function(t,e){var n=this._values;this._isQuantized?v$(n,t,e):zn.fromArray(e,n,4*t)},n.lerp=function(t,e,n,i,r,a){var o=this._values;this._isQuantized?(v$(o,t,i),v$(o,e,r)):(zn.fromArray(i,o,4*t),zn.fromArray(r,o,4*e)),zn.slerp(a,i,r,n)},e}(HZ))||TZ,qZ=Ec("cc.animation.ExoticTrack")((DZ=function(){function t(t,e){ct(this,"times",IZ,this),ct(this,"values",PZ,this),this.times=t,this.values=e}return t.prototype.toHashString=function(){var t=this.times,e=this.values;return"times: "+GZ(t)+"; values: "+e.toHashString()},t}(),IZ=lt((wZ=DZ).prototype,"times",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),PZ=lt(wZ.prototype,"values",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),EZ=wZ))||EZ;function XZ(t,e){t.length,t.length;var n=0,i=0,r=_c(t,e);if(r>=0)n=r;else{var a=~r,o=a-1;n=o;var s=t[a],c=t[o];i=(e-c)/(s-c)}return{index:n,ratio:i}}!function(){function t(){this._reset()}var e=t.prototype;e.transformTime=function(t){return t-this._timeOffset},e.calculate=function(t,e,n){this._reset();var i=t.length;if(i){var r=t[0],a=t[i-1],o=un(e,r,a),s=un(n,r,a);this._timeOffset=o;var c=function(t,e,n){var i=t.length;n>=e&&e>=t[0]&&t[i-1];var r=XZ(t,e),a=r.index,o=r.ratio,s=XZ(t,n);return{fromIndex:a,fromRatio:o,toIndex:s.index,toRatio:s.ratio}}(t,o,s),l=c.fromIndex,h=c.fromRatio,u=c.toIndex,_=c.toRatio,f=!h,d=!_;l!==u||h!==_?(f||(this.preLerpIndex=l,this.preLerpRatio=h),this.directKeyframesBegin=f?l:l+1,this.directKeyframesEnd=u+1,d||(this.postLerpIndex=u,this.postLerpRatio=_)):f?(this.directKeyframesBegin=l,this.directKeyframesEnd=l+1):(this.preLerpIndex=l,this.preLerpRatio=h)}},e._reset=function(){this.preLerpIndex=-1,this.preLerpRatio=0,this.directKeyframesBegin=0,this.directKeyframesEnd=0,this.postLerpIndex=-1,this.postLerpRatio=0,this._timeOffset=0},Q(t,[{key:"keyframesCount",get:function(){var t=this.preLerpIndex,e=this.directKeyframesBegin;return 0+(t<0?0:1)+(this.directKeyframesEnd-e)+(this.postLerpIndex<0?0:1)}}])}();var YZ,KZ=function(){function t(t,e){this._nodeEvaluations=void 0,this._nodeEvaluations=t.map((function(t){return t.createEvaluator(e)}))}return t.prototype.evaluate=function(t){this._nodeEvaluations.forEach((function(e){e.evaluate(t)}))},t}(),JZ=function(){function t(t,e,n,i,r){this._position=null,this._rotation=null,this._scale=null,e&&(this._position=p$(e.times,e.values,Mn,t,"position",r)),n&&(this._rotation=p$(n.times,n.values,zn,t,"rotation",r)),i&&(this._scale=p$(i.times,i.values,Mn,t,"scale",r))}return t.prototype.evaluate=function(t){if(this._position){var e=this._position.evaluator.evaluate(t);this._position.runtimeBinding.setValue(e)}if(this._rotation){var n=this._rotation.evaluator.evaluate(t);this._rotation.runtimeBinding.setValue(n)}if(this._scale){var i=this._scale.evaluator.evaluate(t);this._scale.runtimeBinding.setValue(i)}},t}(),QZ=function(){function t(t,e,n){this._times=void 0,this._inputSampleResultCache={just:!1,index:-1,nextIndex:-1,ratio:0},this._values=void 0,this._prevValue=void 0,this._nextValue=void 0,this._resultValue=void 0,this._times=t,this._values=e,this._prevValue=new n,this._nextValue=new n,this._resultValue=new n}return t.prototype.evaluate=function(t){var e=this._times,n=this._values,i=this._resultValue;if(0===e.length)return i;var r=function(t,e,n){var i=t.length,r=t[0],a=t[i-1];if(e<r)n.just=!0,n.index=0;else if(e>a)n.just=!0,n.index=i-1;else{var o=_c(t,e);if(o>=0)n.just=!0,n.index=o;else{var s=~o,c=s-1,l=t[c],h=t[s],u=(e-t[c])/(h-l);n.just=!1,n.index=c,n.nextIndex=s,n.ratio=u}}return n}(e,t,this._inputSampleResultCache);return r.just?n.get(r.index,i):n.lerp(r.index,r.nextIndex,r.ratio,this._prevValue,this._nextValue,i),i},t}(),ZZ={uint8:Uint8Array,uint16:Uint16Array};function $Z(t){switch(t.BYTES_PER_ELEMENT){default:case 4:return YZ.FLOAT_32;case 8:return YZ.FLOAT_64}}!function(t){t[t.FLOAT_32=0]="FLOAT_32",t[t.FLOAT_64=1]="FLOAT_64"}(YZ||(YZ={}));var t$,e$,n$,i$,r$,a$,o$,s$,c$,l$,h$,u$,_$,f$=Ec("cc.animation.QuantizedFloatArray")((FZ=function(){function t(t,e,n,i){void 0===i&&(i=0),ct(this,"originalPrecision",OZ,this),ct(this,"min",NZ,this),ct(this,"extent",BZ,this),ct(this,"values",LZ,this),this.originalPrecision=t,this.values=e,this.extent=n,this.min=i}return t.prototype.toHashString=function(){var t=this.originalPrecision,e=this.min,n=this.extent,i=this.values;return t+" "+UZ(e)+" "+UZ(n)+" "+i.join(" ")},Q(t,[{key:"quantizationType",get:function(){switch(this.values.BYTES_PER_ELEMENT){default:case 1:return"uint8";case 2:return"uint16"}}}]),t}(),OZ=lt((MZ=FZ).prototype,"originalPrecision",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),NZ=lt(MZ.prototype,"min",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),BZ=lt(MZ.prototype,"extent",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),LZ=lt(MZ.prototype,"values",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),RZ=MZ))||RZ;function d$(t,e){return t.values[e]/(1<<t.values.BYTES_PER_ELEMENT)*t.extent+t.min}function p$(t,e,n,i,r,a){var o=new TK;o.path=(new CK).toHierarchy(i).toProperty(r);var s=a(o);return s?{runtimeBinding:s,evaluator:new QZ(t,e,n)}:null}function m$(t,e,n){Mn.set(n,d$(t,3*e+0),d$(t,3*e+1),d$(t,3*e+2))}function v$(t,e,n){zn.set(n,d$(t,4*e+0),d$(t,4*e+1),d$(t,4*e+2),d$(t,4*e+3))}function g$(){return h.director.getAnimationManager()}var y$=Symbol("SearchForRootBonePath"),x$=Symbol("ExoticAnimation"),S$=t("AnimationClip",Ec("cc.AnimationClip")((_$=u$=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"sample",n$,at(e)),ct(e,"speed",i$,at(e)),ct(e,"wrapMode",r$,at(e)),ct(e,"enableTrsBlending",a$,at(e)),ct(e,"_duration",o$,at(e)),ct(e,"_hash",s$,at(e)),e.frameRate=0,ct(e,"_tracks",c$,at(e)),ct(e,"_exoticAnimation",l$,at(e)),e._legacyData=void 0,e._legacyDataDirty=!1,ct(e,"_events",h$,at(e)),e._runtimeEvents={ratios:[],eventGroups:[]},e}$(e,t),e.createWithSpriteFrames=function(t,n){var i=new e;i.sample=n||i.sample,i.duration=t.length/i.sample;var r=1/i.sample,a=new iJ;return a.path=(new CK).toComponent("cc.Sprite").toProperty("spriteFrame"),a.channels()[0].curve.assignSorted(t.map((function(t,e){return[r*e,t]}))),i.addTrack(a),i};var n=e.prototype;return n.onLoaded=function(){this.frameRate=this.sample,this.events=this._events},n.range=function(){for(var t={min:1/0,max:-1/0},e=this._tracks,n=e.length,i=0;i<n;++i){var r=e[i].range();t.min=Math.min(t.min,r.min),t.max=Math.max(t.max,r.max)}return t},n.getTrack=function(t){return this._tracks[t]},n.addTrack=function(t){var e=this._tracks.length;return this._tracks.push(t),e},n.removeTrack=function(t){this._tracks.splice(t,1)},n.clearTracks=function(){this._tracks.length=0},n.createEventEvaluator=function(t){return new P$(t,this._runtimeEvents.ratios,this._runtimeEvents.eventGroups,this.wrapMode)},n.createEvaluator=function(t){var e=this,n=t.target;return this._createEvalWithBinder(n,(function(i){if(!t.mask||!i.isMaskedOff(t.mask)){var r=i.createRuntimeBinding(n,e.enableTrsBlending?t.pose:void 0,!1);return null!=r?r:void 0}}),t.rootMotion)},n.destroy=function(){var e;return(null===(e=h.director.root)||void 0===e?void 0:e.dataPoolManager)&&h.director.root.dataPoolManager.releaseAnimationClip(this),UQ.destroy(this),t.prototype.destroy.call(this)},n[kQ]=function(t,e,n){for(var i=1/e,r=this._collectAnimatedJoints(),a=r.length,o={},s=0;s<a;++s)o[r[s]]={transforms:Array.from({length:n},(function(){return new Xn}))};var c=r.reduce((function(t,e){return t[e]=new C$,t}),{});for(var l in c){var h=c[l],u=l.lastIndexOf("/");if(u>=0){var _=l.substring(0,u),f=c[_];f&&(h.parent=f)}}for(var d=this._createEvalWithBinder(void 0,(function(t){var e=t.parseTrsPath();if(e){var n=c[e.node];if(n)return I$(n,e.property)}}),void 0),p=0;p<n;++p){var m=t+i*p;d.evaluate(m);for(var v=0;v<a;++v){var g=r[v];Xn.copy(o[g].transforms[p],c[g].globalTransform)}for(var y=0;y<a;++y){var x=r[y];c[x].invalidate()}}return{samples:e,frames:n,joints:o}},n.upgradeUntypedTracks=function(t){for(var e=[],n=[],i=this._tracks,r=i.length,a=0;a<r;++a){var o=i[a];if(o instanceof iZ){var s=o.upgrade(t);s&&(e.push(s),n.push(o))}}for(var c=n.length,l=0;l<c;++l)ie.remove(i,n[l]);i.push.apply(i,e)},n[y$]=function(){return this._searchForRootBonePath()},n.getPropertyCurves=function(){return this._getLegacyData().getPropertyCurves()},n.updateEventDatas=function(){this.events=this._events},n.hasEvents=function(){return 0!==this.events.length},n.syncLegacyData=function(){this._legacyData&&(this._fromLegacy(this._legacyData),this._legacyData=void 0)},n._createEvalWithBinder=function(t,e,n){this._legacyDataDirty&&(this._legacyDataDirty=!1,this.syncLegacyData());var i,r=[];n&&(i=this._createRootMotionEvaluation(t,n,r));for(var a,o=[],s=this._tracks,c=s.length,l=0;l<c;++l){var h=s[l];if(!r.includes(h)&&!Array.from(h.channels()).every((function(t){return 0===t.curve.keyFramesCount}))){var u=e(h[bK]);if(u){var _=h[xK](u);o.push({binding:u,trackEval:_})}}}return this._exoticAnimation&&(a=this._exoticAnimation.createEvaluator(e)),new A$(o,a,i)},n._createRootMotionEvaluation=function(t,e,n){if(t instanceof TE){var i=this._searchForRootBonePath();if(i){var r=t.getChildByPath(i);if(r){for(var a=new b$,o=[],s=this._tracks,c=s.length,l=0;l<c;++l){var h=s[l],u=h[bK].parseTrsPath();if(u&&u.node===i){n.push(h);var _=I$(a,u.property);if(_){var f=h[xK](_);o.push({binding:_,trackEval:f})}}}return new E$(r,this._duration,a,o)}R(3924)}else R(3923)}else O(3920)},n._searchForRootBonePath=function(){var t=this._tracks.map((function(t){var e=t[bK].parseTrsPath();if(e){var n=e.node;return{path:n,rank:n.split("/").length}}return{path:"",rank:0}}));t.sort((function(t,e){return t.rank-e.rank}));var e=t.findIndex((function(t){return 0!==t.rank}));if(e<0)return"";for(var n=t.length,i=t[e],r=!0,a=e+1;a<n;++a){var o=t[a];if(o.rank!==i.rank)break;if(o.path!==i.path){r=!1;break}}return r?i.path:""},n._getLegacyData=function(){return this._legacyData||(this._legacyData=this._toLegacy()),this._legacyData},n._toLegacy=function(){var t=new rZ(this._duration);return t.keys=[],t.curves=[],t.commonTargets=[],t},n._fromLegacy=function(t){for(var e=t.toTracks(),n=e.length,i=0;i<n;++i)this.addTrack(e[i])},n._collectAnimatedJoints=function(){for(var t=new Set,e=this._tracks,n=e.length,i=0;i<n;++i){var r=e[i][bK].parseTrsPath();r&&t.add(r.node)}if(this._exoticAnimation)for(var a=this._exoticAnimation.collectAnimatedJoints(),o=a.length,s=0;s<o;++s)t.add(a[s]);return Array.from(t)},Q(e,[{key:"duration",get:function(){return this._duration},set:function(t){this._duration=t}},{key:"tracksCount",get:function(){return this._tracks.length}},{key:"tracks",get:function(){return this._tracks}},{key:"hash",get:function(){var t,e;if(this._hash)return this._hash;var n="Exotic:"+(null!==(t=null===(e=this._exoticAnimation)||void 0===e?void 0:e.toHashString())&&void 0!==t?t:"");return this._hash=ba(n,666)}},{key:"events",get:function(){return this._events},set:function(t){var e=this;this._events=t;for(var n=[],i=[],r=this.events.sort((function(t,e){return t.frame-e.frame})),a=r.length,o=function(t){var a=r[t],o=a.frame/e._duration,s=n.findIndex((function(t){return t===o}));s<0&&(s=n.length,n.push(o),i.push({events:[]})),i[s].events.push({functionName:a.func,parameters:a.params})},s=0;s<a;++s)o(s);this._runtimeEvents={ratios:n,eventGroups:i}}},{key:x$,get:function(){return this._exoticAnimation}},{key:x$,set:function(t){this._exoticAnimation=t}},{key:"keys",get:function(){return this._getLegacyData().keys}},{key:"keys",set:function(t){this._legacyDataDirty=!0,this._getLegacyData().keys=t}},{key:"curves",get:function(){return this._legacyDataDirty=!0,this._getLegacyData().curves}},{key:"curves",set:function(t){this._getLegacyData().curves=t}},{key:"commonTargets",get:function(){return this._getLegacyData().commonTargets}},{key:"commonTargets",set:function(t){this._legacyDataDirty=!0,this._getLegacyData().commonTargets=t}},{key:"data",get:function(){return this._getLegacyData().data}},{key:"eventGroups",get:function(){return this._runtimeEvents.eventGroups}}]),e}($h),u$.WrapMode=ac,n$=lt((e$=_$).prototype,"sample",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),i$=lt(e$.prototype,"speed",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),r$=lt(e$.prototype,"wrapMode",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ac.Normal}}),a$=lt(e$.prototype,"enableTrsBlending",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),o$=lt(e$.prototype,"_duration",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),s$=lt(e$.prototype,"_hash",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),c$=lt(e$.prototype,"_tracks",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),l$=lt(e$.prototype,"_exoticAnimation",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h$=lt(e$.prototype,"_events",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),t$=e$))||t$);h.AnimationClip=S$;var A$=function(){function t(t,e,n){this._exoticAnimationEvaluator=void 0,this._trackEvalStatues=[],this._rootMotionEvaluation=void 0,this._trackEvalStatues=t,this._exoticAnimationEvaluator=e,this._rootMotionEvaluation=n}var e=t.prototype;return e.evaluate=function(t){for(var e=this._trackEvalStatues,n=this._exoticAnimationEvaluator,i=e.length,r=0;r<i;++r){var a=e[r],o=a.trackEval,s=a.binding,c=o.evaluate(t,s);s.setValue(c)}n&&n.evaluate(t)},e.evaluateRootMotion=function(t,e){var n=this._rootMotionEvaluation;n&&n.evaluate(t,e)},t}(),b$=function(){function t(){this.position=new Mn,this.scale=new Mn(1,1,1),this.rotation=new zn,this.eulerAngles=new Mn}return t.prototype.getTransform=function(t){Xn.fromRTS(t,this.rotation,this.position,this.scale)},t}(),C$=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).parent=null,e._dirty=!0,e._transform=new Xn,e}return $(e,t),e.prototype.invalidate=function(){this._dirty=!0},Q(e,[{key:"globalTransform",get:function(){var t=this._transform;return this._dirty&&(this._dirty=!1,Xn.fromRTS(t,this.rotation,this.position,this.scale),this.parent&&Xn.multiply(t,this.parent.globalTransform,t)),this._transform}}]),e}(b$),T$=new Xn,E$=function(){function t(t,e,n,i){this._initialTransformCache=new Xn,this._clipEndTransformCache=new Xn,this._startTransformCache=new Xn,this._endTransformCache=new Xn,this._motionTransformCache=new Xn,this._translationMotionCache=new Mn,this._rotationMotionCache=new zn,this._scaleMotionCache=new Mn,this._rootBone=t,this._duration=e,this._boneTransform=n,this._trackEvalStatuses=i}var e=t.prototype;return e.evaluate=function(t,e){var n=this._calcMotionTransform(t,e,this._motionTransformCache),i=this._translationMotionCache,r=this._rotationMotionCache,a=this._scaleMotionCache,o=this._rootBone;Xn.toRTS(n,r,i,a),Mn.add(i,i,o.position),o.setPosition(i),zn.multiply(r,r,o.rotation),o.setRotation(r),Mn.multiply(a,a,o.scale),o.setScale(a)},e._calcMotionTransform=function(t,e,n){var i=this._duration,r=i-t,a=this._evaluateAt(t,this._startTransformCache);if(e<r){var o=this._evaluateAt(t+e,this._endTransformCache);w$(n,a,o)}else{Xn.identity(n);var s=function(t,e){w$(T$,t,e),Xn.multiply(n,n,T$)},c=e-r,l=Math.floor(c/i),h=c-l*i,u=this._evaluateAt(0,this._initialTransformCache),_=this._evaluateAt(i,this._clipEndTransformCache),f=this._evaluateAt(h,this._endTransformCache);s(a,_),w$(T$,u,_);for(var d=0;d<l;++d)Xn.multiply(n,n,T$);s(u,f)}return n},e._evaluateAt=function(t,e){for(var n=this._trackEvalStatuses,i=n.length,r=0;r<i;++r){var a=n[r],o=a.trackEval,s=a.binding,c=o.evaluate(t,s);s.setValue(c)}return this._boneTransform.getTransform(e),e},t}();function w$(t,e,n){Xn.invert(t,e),Xn.multiply(t,n,t)}function I$(t,e){switch(e){default:return;case"position":return{setValue:function(e){Mn.copy(t.position,e)}};case"rotation":return{setValue:function(e){zn.copy(t.rotation,e)}};case"scale":return{setValue:function(e){Mn.copy(t.scale,e)}};case"eulerAngles":return{setValue:function(e){Mn.copy(t.eulerAngles,e)}}}}var P$=function(){function t(t,e,n,i){this._lastFrameIndex=-1,this._lastIterations=0,this._lastDirection=0,this._ignoreIndex=-1,this._sampled=!1,this._targetNode=t,this._ratios=e,this._eventGroups=n,this._wrapMode=i}var e=t.prototype;return e.setWrapMode=function(t){this._wrapMode=t},e.ignore=function(t,e){this._ignoreIndex=-1,this._sampled=!1;var n=R$(t,this._ratios);n<0&&(n=~n-1,e<0&&(n+=1),this._ignoreIndex=n)},e.sample=function(t,e,n){var i=this._eventGroups.length,r=R$(t,this._ratios);if(r<0&&(r=~r-1,e<0&&(r+=1)),this._ignoreIndex!==r&&(this._ignoreIndex=-1),!this._sampled)return this._sampled=!0,this._doFire(r,!1),this._lastFrameIndex=r,this._lastIterations=n,void(this._lastDirection=e);var a=this._wrapMode,o=D$(n),s=D$(this._lastIterations),c=this._lastFrameIndex,l=this._lastDirection,h=-1!==s&&o!==s;if(c===r&&h&&1===i)this._doFire(0,!1);else if(c!==r||h){e=l;do{if(c!==r){if(-1===e&&0===c&&r>0?((a&rc.PingPong)===rc.PingPong?e*=-1:c=i,s++):1===e&&c===i-1&&r<i-1&&((a&rc.PingPong)===rc.PingPong?e*=-1:c=-1,s++),c===r)break;if(s>o)break}c+=e,this._doFire(c,!0)}while(c!==r&&c>-1&&c<i)}this._lastFrameIndex=r,this._lastIterations=n,this._lastDirection=e},e._doFire=function(t,e){e?g$().pushDelayEvent(this._checkAndFire,this,[t]):this._checkAndFire(t)},e._checkAndFire=function(t){if(this._targetNode&&this._targetNode.isValid){var e=this._eventGroups;if(!(t<0||t>=e.length||this._ignoreIndex===t))for(var n=e[t],i=this._targetNode.components,r=n.events.length,a=0;a<r;++a)for(var o=n.events[a],s=o.functionName,c=i.length,l=0;l<c;++l){var h=i[l],u=h[s];"function"==typeof u&&u.apply(h,o.parameters)}}},t}();function D$(t){return t-(0|t)==0&&(t-=1),0|t}function R$(t,e){return _c(e,t)}var M$,O$=function(){function t(){this._isPlaying=!1,this._isPaused=!1,this._stepOnce=!1}var e=t.prototype;return e.play=function(){this._isPlaying?this._isPaused?(this._isPaused=!1,this.onResume()):this.onError(F(3912)):(this._isPlaying=!0,this.onPlay())},e.stop=function(){this._isPlaying&&(this._isPlaying=!1,this.onStop(),this._isPaused=!1)},e.pause=function(){this._isPlaying&&!this._isPaused&&(this._isPaused=!0,this.onPause())},e.resume=function(){this._isPlaying&&this._isPaused&&(this._isPaused=!1,this.onResume())},e.step=function(){this.pause(),this._stepOnce=!0,this._isPlaying||this.play()},e.update=function(){},e.onPlay=function(){},e.onPause=function(){},e.onResume=function(){},e.onStop=function(){},e.onError=function(){},Q(t,[{key:"isPlaying",get:function(){return this._isPlaying}},{key:"isPaused",get:function(){return this._isPaused}},{key:"isMotionless",get:function(){return!this.isPlaying||this.isPaused}}]),t}(),N$=function(){function t(t){this.weight=0,this._pose=void 0,this._blendStateWriters=[],this._pose=t}var e=t.prototype;return e.destroy=function(){for(var t=0;t<this._blendStateWriters.length;++t)this._pose.destroyWriter(this._blendStateWriters[t]);this._blendStateWriters.length=0},e.createPoseWriter=function(t,e,n){var i=this._pose.createWriter(t,e,this,n);return this._blendStateWriters.push(i),i},t}();!function(t){t.PLAY="play",t.STOP="stop",t.PAUSE="pause",t.RESUME="resume",t.LASTFRAME="lastframe",t.FINISHED="finished"}(M$||(M$={})),he(M$);var B$=t("AnimationState",function(t){function e(e,n){var i;return void 0===n&&(n=""),(i=t.call(this)||this).duration=1,i.speed=1,i.time=0,i.frameRate=0,i._targetNode=null,i._curveLoaded=!1,i._clip=void 0,i._useSimpleProcess=!1,i._target=null,i._wrapMode=ac.Normal,i._repeatCount=1,i._delay=0,i._delayTime=0,i._currentFramePlayed=!1,i._name=void 0,i._lastIterations=NaN,i._lastWrapInfo=null,i._wrappedInfo=new uc,i._allowLastFrame=!1,i._blendStateWriterHost={weight:0},i._playbackDuration=0,i._invDuration=1,i._poseOutput=null,i._weight=1,i._clipEval=void 0,i._clipEventEval=void 0,i._doNotCreateEval=!1,i._clip=e,i._name=n||e&&e.name,i._playbackRange={min:0,max:e.duration},i._playbackDuration=e.duration,e.duration||C("Clip "+e.name+" has zero duration."),i}$(e,t);var n=e.prototype;return n.initialize=function(t,e,n){if(!this._curveLoaded){this._curveLoaded=!0,this._poseOutput&&(this._poseOutput.destroy(),this._poseOutput=null),this._clipEval&&(this._clipEval=void 0),this._targetNode=t;var i=this._clip;if(this.duration=i.duration,this._invDuration=1/this.duration,this.speed=i.speed,this.wrapMode=i.wrapMode,this.frameRate=i.sample,this._playbackRange.min=0,this._playbackRange.max=i.duration,this._playbackDuration=i.duration,(this.wrapMode&rc.Loop)===rc.Loop?this.repeatCount=1/0:this.repeatCount=1,!this._doNotCreateEval){var r,a,o,s=null!==(r=null!=e?e:null===(a=g$())||void 0===a?void 0:a.blendState)&&void 0!==r?r:null;s&&(this._poseOutput=new N$(s)),this._clipEval=i.createEvaluator({target:t,pose:null!==(o=this._poseOutput)&&void 0!==o?o:void 0,mask:n})}this._clipEventEval=i.createEventEvaluator(this._targetNode)}},n.destroy=function(){this.isMotionless||g$().removeAnimation(this),this._poseOutput&&(this._poseOutput.destroy(),this._poseOutput=null),this._clipEval=void 0},n.emit=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];g$().pushDelayEvent(this._emit,this,e)},n.on=function(t,e,n){return this._target&&this._target.isValid?this._target.on(t,e,n):null},n.once=function(t,e,n){return this._target&&this._target.isValid?this._target.once(t,e,n):null},n.off=function(t,e,n){this._target&&this._target.isValid&&this._target.off(t,e,n)},n.allowLastFrameEvent=function(t){this._allowLastFrame=t},n._setEventTarget=function(t){this._target=t},n.setTime=function(t){this._currentFramePlayed=!1,this.time=t||0;var e,n=this.getWrappedInfo(t,this._wrappedInfo);null===(e=this._clipEventEval)||void 0===e||e.ignore(n.ratio,n.direction)},n.update=function(t){this._delayTime>0&&(this._delayTime-=t,this._delayTime>0)||(this._currentFramePlayed?this.time+=t*this.speed:this._currentFramePlayed=!0,this._process())},n.sample=function(){var t=this.getWrappedInfo(this.time,this._wrappedInfo);return this._sampleCurves(t.time),this._sampleEvents(t),t},n.onPlay=function(){this.setTime(this._getPlaybackStart()),this._delayTime=this._delay,this._onReplayOrResume(),this.emit(M$.PLAY,this)},n.onStop=function(){this.isPaused||this._onPauseOrStop(),this.emit(M$.STOP,this)},n.onResume=function(){this._onReplayOrResume(),this.emit(M$.RESUME,this)},n.onPause=function(){this._onPauseOrStop(),this.emit(M$.PAUSE,this)},n._sampleCurves=function(t){var e=this._poseOutput,n=this._clipEval;e&&(e.weight=this.weight),n&&n.evaluate(t)},n._process=function(){this._useSimpleProcess?this.simpleProcess():this.process()},n.process=function(){var t,e=this.sample();this._allowLastFrame&&(t=this._lastWrapInfo?this._lastWrapInfo:this._lastWrapInfo=new uc(e),this.repeatCount>1&&(0|e.iterations)>(0|t.iterations)&&this.emit(M$.LASTFRAME,this),t.set(e)),e.stopped&&(this.stop(),this.emit(M$.FINISHED,this))},n.simpleProcess=function(){var t=this._playbackRange.min,e=this._playbackDuration,n=this.time%e;n<0&&(n+=e);var i=(t+n)*this._invDuration;this._sampleCurves(t+n),this._sampleEvents(this.getWrappedInfo(this.time,this._wrappedInfo)),this._allowLastFrame&&(Number.isNaN(this._lastIterations)&&(this._lastIterations=i),(this.time>0&&this._lastIterations>i||this.time<0&&this._lastIterations<i)&&this.emit(M$.LASTFRAME,this),this._lastIterations=i)},n._needReverse=function(t){var e=this.wrapMode,n=!1;return(e&rc.PingPong)===rc.PingPong&&(t-(0|t)==0&&t>0&&(t-=1),1&t&&(n=!n)),(e&rc.Reverse)===rc.Reverse&&(n=!n),n},n.getWrappedInfo=function(t,e){e=e||new uc;var n=this._getPlaybackStart(),i=this._getPlaybackEnd()-n,r=!1,a=this.repeatCount,o=(t-=n)>0?t/i:-t/i;if(o>=a){o=a,r=!0;var s=a-(0|a);0===s&&(s=1),t=s*i*(t>0?1:-1)}if(t>i){var c=t%i;t=0===c?i:c}else t<0&&0!=(t%=i)&&(t+=i);var l=!1,h=this._wrapMode&rc.ShouldWrap;h&&(l=this._needReverse(o));var u=l?-1:1;return this.speed<0&&(u*=-1),h&&l&&(t=i-t),e.time=n+t,e.ratio=e.time/this.duration,e.direction=u,e.stopped=r,e.iterations=o,e},n._getPlaybackStart=function(){return this._playbackRange.min},n._getPlaybackEnd=function(){return this._playbackRange.max},n._sampleEvents=function(t){var e;null===(e=this._clipEventEval)||void 0===e||e.sample(t.ratio,t.direction,t.iterations)},n._emit=function(t,e){this._target&&this._target.isValid&&this._target.emit(t,t,e)},n._onReplayOrResume=function(){g$().addAnimation(this)},n._onPauseOrStop=function(){g$().removeAnimation(this)},Q(e,[{key:"clip",get:function(){return this._clip}},{key:"name",get:function(){return this._name}},{key:"length",get:function(){return this.duration}},{key:"wrapMode",get:function(){return this._wrapMode},set:function(t){var e;this._wrapMode=t,this.time=0,t&rc.Loop?this.repeatCount=1/0:this.repeatCount=1,null===(e=this._clipEventEval)||void 0===e||e.setWrapMode(t)}},{key:"repeatCount",get:function(){return this._repeatCount},set:function(t){this._repeatCount=t;var e=this._wrapMode&rc.ShouldWrap,n=(this.wrapMode&rc.Reverse)===rc.Reverse;this._useSimpleProcess=t===1/0&&!e&&!n}},{key:"delay",get:function(){return this._delay},set:function(t){this._delayTime=this._delay=t}},{key:"playbackRange",get:function(){return this._playbackRange},set:function(t){t.max,t.min,this._playbackRange.min=Math.max(t.min,0),this._playbackRange.max=Math.min(t.max,this.duration),this._playbackDuration=this._playbackRange.max-this._playbackRange.min,this.setTime(0)}},{key:"current",get:function(){return this.getWrappedInfo(this.time).time}},{key:"ratio",get:function(){return this.current/this.duration}},{key:"weight",get:function(){return this._weight},set:function(t){this._weight=t,this._poseOutput&&(this._poseOutput.weight=t)}},{key:"curveLoaded",get:function(){return this._curveLoaded}}]),e}(O$));h.AnimationState=B$;var L$,F$,V$,z$,k$,U$=H$,G$=H$;function H$(){}L$=Ec("cc.animation.ClipMotion"),F$=cl(S$),L$((k$=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"clip",z$,at(e)),e}$(e,t);var n=e.prototype;return n[bQ]=function(t){return this.clip?new c0(t,this.clip):null},n.clone=function(){var t=new e;return t.clip=this.clip,t},e}(_l),z$=lt((V$=k$).prototype,"clip",[F$],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),V$));var j$,W$,q$,X$,Y$,K$,J$,Q$,Z$,$$,t0,e0,n0,i0,r0,a0,o0,s0,c0=function(){function t(t,e){this.duration=e.duration/e.speed,this._state=new B$(e),this._state.initialize(t.node,t.blendBuffer,t.mask)}var e=t.prototype;return e.getClipStatuses=function(t){var e=this,n=!1;return{next:function(){return n?{done:!0,value:void 0}:(n=!0,{done:!1,value:{__DEBUG_ID__:e.__DEBUG__ID__,clip:e._state.clip,weight:t}})}}},e.sample=function(t,e){if(0!==e){var n=this._state.duration*t;this._state.time=n,this._state.weight=e,this._state.sample(),this._state.weight=0}},Q(t,[{key:"progress",get:function(){return this._state.time/this.duration}}]),t}(),l0=Ec("cc.animation.BindableNumber")((Y$=function(){function t(t){void 0===t&&(t=0),ct(this,"variable",q$,this),ct(this,"value",X$,this),this.value=t}return t.prototype.clone=function(){var e=new t;return e.value=this.value,e.variable=this.variable,e},t}(),q$=lt((W$=Y$).prototype,"variable",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),X$=lt(W$.prototype,"value",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),j$=W$))||j$,h0=Ec("cc.animation.BindableBoolean")(($$=function(){function t(t){void 0===t&&(t=!1),ct(this,"variable",Q$,this),ct(this,"value",Z$,this),this.value=t}return t.prototype.clone=function(){var e=new t;return e.value=this.value,e.variable=this.variable,e},t}(),Q$=lt((J$=$$).prototype,"variable",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Z$=lt(J$.prototype,"value",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),K$=J$))||K$;function u0(t,e,n,i,r){var a=e.variable,o=e.value;if(!a)return o;var s=t.getVar(a);if(!f0(s,a))return o;if(s.type!==n)throw new AQ(a,"number");for(var c=arguments.length,l=new Array(c>5?c-5:0),h=5;h<c;h++)l[h-5]=arguments[h];var u=s.bind.apply(s,[i,r].concat(l));return u}function _0(t,e,n,i,r){var a=e.variable,o=e.value;if(!a)return o;var s=t.getVar(a);if(!f0(s,a))return o;if(n!==GK.FLOAT&&n!==GK.INTEGER)throw new AQ(a,"number or integer");for(var c=arguments.length,l=new Array(c>5?c-5:0),h=5;h<c;h++)l[h-5]=arguments[h];var u=s.bind.apply(s,[i,r].concat(l));return u}function f0(t,e){if(t)return!0;throw new SQ(e)}var d0,p0,m0,v0,g0,y0,x0,S0,A0,b0,C0,T0=Ec("cc.animation.AnimationBlendItem")((i0=function(){function t(){ct(this,"motion",n0,this)}var e=t.prototype;return e.clone=function(){var e=new t;return this._assign(e),e},e._assign=function(t){var e,n;return t.motion=null!==(e=null===(n=this.motion)||void 0===n?void 0:n.clone())&&void 0!==e?e:null,t},t}(),n0=lt((e0=i0).prototype,"motion",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),t0=e0))||t0,E0=Ec("cc.animation.AnimationBlend")((s0=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"name",o0,at(e)),e}return $(e,t),e}(_l),o0=lt((a0=s0).prototype,"name",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),r0=a0))||r0,w0=function(){function t(t,e,n,i){this._childEvaluators=n.map((function(e){var n,i;return null!==(n=null===(i=e.motion)||void 0===i?void 0:i[bQ](t))&&void 0!==n?n:null})),this._weights=new Array(this._childEvaluators.length).fill(0),this._inputs=[].concat(i)}var e=t.prototype;return e.getChildWeight=function(t){return this._weights[t]},e.getChildMotionEval=function(t){return this._childEvaluators[t]},e.getClipStatuses=function(t){var e,n=this._childEvaluators,i=this._weights,r=n.length,a=0;return{next:function(){for(;;){if(e){var o=e.next();if(!o.done)return o}if(a>=r)return{done:!0,value:void 0};var s=n[a];e=null==s?void 0:s.getClipStatuses(t*i[a]),++a}}}},e.sample=function(t,e){for(var n=0;n<this._childEvaluators.length;++n){var i;null===(i=this._childEvaluators[n])||void 0===i||i.sample(t,e*this._weights[n])}},e.setInput=function(t,e){this._inputs[e]=t,this.doEval()},e.doEval=function(){this.eval(this._weights,this._inputs)},e.eval=function(){},Q(t,[{key:"childCount",get:function(){return this._weights.length}},{key:"duration",get:function(){for(var t=0,e=0;e<this._childEvaluators.length;++e){var n,i;t+=(null!==(n=null===(i=this._childEvaluators[e])||void 0===i?void 0:i.duration)&&void 0!==n?n:0)*this._weights[e]}return t}}]),t}(),I0=Ec("cc.animation.AnimationBlend1DItem")((v0=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"threshold",m0,at(e)),e}$(e,t);var n=e.prototype;return n.clone=function(){var t=new e;return this._assign(t),t},n._assign=function(e){return t.prototype._assign.call(this,e),e.threshold=this.threshold,e},e}(T0),m0=lt((p0=v0).prototype,"threshold",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),d0=p0))||d0,P0=(Ec("cc.animation.AnimationBlend1D")((A0=S0=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_items",y0,at(e)),ct(e,"param",x0,at(e)),e}$(e,t);var n=e.prototype;return n.clone=function(){var t=new e;return t._items=this._items.map((function(t){return t.clone()})),t.param=this.param.clone(),t},n[bQ]=function(t){var e=new P0(t,this,this._items,this._items.map((function(t){return t.threshold})),0),n=u0(t,this.param,GK.FLOAT,e.setInput,e,0);return e.setInput(n,0),e},Q(e,[{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t).sort((function(t,e){return t.threshold-e.threshold}))}}]),e}(E0),S0.Item=I0,y0=lt((g0=A0).prototype,"_items",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),x0=lt(g0.prototype,"param",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l0}}),g0)),function(t){function e(e,n,i,r,a){var o;return(o=t.call(this,e,n,i,[a])||this)._thresholds=r,o.doEval(),o}return $(e,t),e.prototype.eval=function(t,e){var n=e[0];!function(t,e,n){if(t.fill(0),0===e.length);else if(n<=e[0])t[0]=1;else if(n>=e[e.length-1])t[t.length-1]=1;else{for(var i=0,r=1;r<e.length;++r)if(e[r]>n){i=r;break}var a=e[i-1],o=e[i],s=o-a;t[i-1]=(o-n)/s,t[i]=(n-a)/s}}(t,this._thresholds,n)},e}(w0)),D0=(b0=new Qn,C0={wA:0,wB:0},function(t,e,n){if(t.length,e.length,0!==e.length)if(1!==e.length)if(Qn.strictEquals(n,Qn.ZERO)){var i=e.findIndex((function(t){return Qn.strictEquals(t,Qn.ZERO)}));i>=0?t[i]=1:t.fill(1/e.length)}else{for(var r=-1,a=-1,o=-1,s=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY,l=n.x,h=n.y,u=0;u<e.length;++u){var _=e[u];if(Qn.equals(_,Qn.ZERO))o=u;else{var f=Qn.normalize(b0,_),d=Qn.dot(f,n);f.x*h-f.y*l>0?d>=c&&(c=d,r=u):d>=s&&(s=d,a=u)}}var p=0;if(r<0||a<0)p=1;else{var m=(C=e[r],T=e[a],E=n,w=C0,(I=Qn.cross(C,T))?(w.wA=Qn.cross(E,T)/I,w.wB=Qn.cross(E,C)/-I):(w.wA=0,w.wB=0),w),v=m.wA,g=m.wB,y=0,x=0,S=v+g;S>1?(y=v/S,x=g/S):S<0?(y=0,x=0,p=1):(y=v,x=g,p=1-S),t[r]=y,t[a]=x}if(p>0)if(o>=0)t[o]=p;else for(var A=p/t.length,b=0;b<t.length;++b)t[b]+=A}else t[0]=1;var C,T,E,w,I});function R0(t,e,n,i){t.fill(0);for(var r=new Qn(0,0),a=new Qn(0,0),o=0,s=e.length,c=0;c<s;++c){for(var l=Number.MAX_VALUE,h=!1,u=0;u<s;++u)if(c!==u){i(e[c],e[u],n,r,a);var _=1-Qn.dot(r,a)/Qn.lengthSqr(a);if(_<0){h=!0;break}l=Math.min(l,_)}h||(t[c]=l,o+=l)}o>0&&t.forEach((function(e,n){return t[n]=e/o}))}var M0,O0,N0,B0,L0,F0,V0,z0,k0,U0,G0,H0,j0,W0,q0,X0,Y0,K0,J0=function(t,e,n,i,r){Qn.subtract(i,n,t),Qn.subtract(r,e,t)},Q0=(M0=new Mn(0,0,0),O0=new Mn(0,0,0),N0=new Mn(0,0,0),B0=new Mn(0,0,0),L0=new Mn(0,0,0),F0=new Mn(0,0,0),function(t,e,n,i,r){var a=0,o=0,s=2;Mn.set(N0,n.x,n.y,0),Qn.equals(t,Qn.ZERO)?(a=Qn.angle(n,e),o=0,s=1):Qn.equals(e,Qn.ZERO)?(o=a=Qn.angle(n,t),s=1):(a=Qn.angle(t,e))<=0?o=0:Qn.equals(n,Qn.ZERO)?o=a:(Mn.set(B0,t.x,t.y,0),Mn.set(L0,e.x,e.y,0),Mn.set(F0,n.x,n.y,0),Mn.cross(M0,B0,L0),Mn.projectOnPlane(N0,F0,M0),o=Mn.angle(B0,N0),a<.99*Math.PI&&Mn.dot(Mn.cross(O0,B0,N0),M0)<0&&(o=-o));var c=Qn.len(t),l=Qn.len(e),h=(l+c)/2;Qn.set(r,(l-c)/h,a*s),Qn.set(i,(Mn.len(N0)-c)/h,o*s)});!function(t){t[t.SIMPLE_DIRECTIONAL=0]="SIMPLE_DIRECTIONAL",t[t.FREEFORM_CARTESIAN=1]="FREEFORM_CARTESIAN",t[t.FREEFORM_DIRECTIONAL=2]="FREEFORM_DIRECTIONAL"}(K0||(K0={})),he(K0);var Z0,$0,t1,e1,n1,i1,r1,a1,o1,s1,c1,l1,h1,u1,_1,f1,d1,p1,m1,v1,g1,y1,x1,S1,A1,b1,C1,T1,E1,w1,I1,P1=Ec("cc.animation.AnimationBlend2DItem")((U0=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"threshold",k0,at(e)),e}$(e,t);var n=e.prototype;return n.clone=function(){var t=new e;return this._assign(t),t},n._assign=function(e){return t.prototype._assign.call(this,e),Qn.copy(e.threshold,this.threshold),e},e}(T0),k0=lt((z0=U0).prototype,"threshold",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn}}),V0=z0))||V0,D1=(Ec("cc.animation.AnimationBlend2D")((Y0=X0=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"algorithm",H0,at(e)),ct(e,"_items",j0,at(e)),ct(e,"paramX",W0,at(e)),ct(e,"paramY",q0,at(e)),e}$(e,t);var n=e.prototype;return n.clone=function(){var t=new e;return t._items=this._items.map((function(t){var e;return null!==(e=null==t?void 0:t.clone())&&void 0!==e?e:null})),t.paramX=this.paramX.clone(),t.paramY=this.paramY.clone(),t},n[bQ]=function(t){var e=new D1(t,this,this._items,this._items.map((function(t){return t.threshold})),this.algorithm,[0,0]),n=u0(t,this.paramX,GK.FLOAT,e.setInput,e,0),i=u0(t,this.paramY,GK.FLOAT,e.setInput,e,1);return e.setInput(n,0),e.setInput(i,1),e},Q(e,[{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t)}}]),e}(E0),X0.Algorithm=K0,X0.Item=P1,H0=lt((G0=Y0).prototype,"algorithm",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return K0.SIMPLE_DIRECTIONAL}}),j0=lt(G0.prototype,"_items",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),W0=lt(G0.prototype,"paramX",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l0}}),q0=lt(G0.prototype,"paramY",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l0}}),G0)),function(t){function e(e,n,i,r,a,o){var s;return(s=t.call(this,e,n,i,o)||this)._thresholds=void 0,s._algorithm=void 0,s._value=new Qn,s._thresholds=r,s._algorithm=a,s.doEval(),s}return $(e,t),e.prototype.eval=function(t,e){var n=e[0],i=e[1];switch(Qn.set(this._value,n,i),t.fill(0),this._algorithm){case K0.SIMPLE_DIRECTIONAL:D0(t,this._thresholds,this._value);break;case K0.FREEFORM_CARTESIAN:!function(t,e,n){R0(t,e,n,J0)}(t,this._thresholds,this._value);break;case K0.FREEFORM_DIRECTIONAL:!function(t,e,n){R0(t,e,n,Q0)}(t,this._thresholds,this._value)}},e}(w0)),R1=Ec("cc.animation.AnimationBlendDirectItem")((e1=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"weight",t1,at(e)),e}$(e,t);var n=e.prototype;return n.clone=function(){var t=new e;return this._assign(t),t},n._assign=function(e){return t.prototype._assign.call(this,e),e.weight=this.weight,e},e}(T0),t1=lt(($0=e1).prototype,"weight",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Z0=$0))||Z0,M1=(Ec("cc.animation.AnimationBlendDirect")((a1=r1=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_items",i1,at(e)),e}$(e,t);var n=e.prototype;return n.clone=function(){var t=new e;return t._items=this._items.map((function(t){var e;return null!==(e=null==t?void 0:t.clone())&&void 0!==e?e:null})),t},n[bQ]=function(t){return new M1(t,this,this._items,this._items.map((function(t){return t.weight})))},Q(e,[{key:"items",get:function(){return this._items},set:function(t){this._items=Array.from(t)}}]),e}(E0),r1.Item=R1,i1=lt((n1=a1).prototype,"_items",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),n1)),function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).doEval(),e}return $(e,t),e.prototype.eval=function(t,e){for(var n=t.length,i=0;i<n;++i)t[i]=e[i]},e}(w0)),O1=(Ec("cc.animation.AnimationMask")((c1=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_jointMasks",s1,at(e)),e}$(e,t);var n=e.prototype;return n.addJoint=function(t,e){var n=new O1;n.path=t,n.enabled=e,this._jointMasks.push(n)},n.removeJoint=function(t){dt(this._jointMasks,(function(e){return e.path===t}))},n.clear=function(){this._jointMasks.length=0},n.filterDisabledNodes=function(t){for(var e=this._jointMasks,n=e.length,i=new Set,r=0;r<n;++r){var a=e[r],o=a.path;if(!a.enabled){var s=t.getChildByPath(o);s&&i.add(s)}}return i},Q(e,[{key:"joints",get:function(){return this._jointMasks},set:function(t){this.clear();for(var e,n=st(t);!(e=n()).done;){var i=e.value;this.addJoint(i.path,i.enabled)}}}]),e}($h),s1=lt((o1=c1).prototype,"_jointMasks",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lt(o1.prototype,"joints",[Wc],Object.getOwnPropertyDescriptor(o1.prototype,"joints"),o1.prototype),o1)),Ec("cc.JointMask")((u1=lt((h1=function(){ct(this,"path",u1,this),ct(this,"enabled",_1,this)}).prototype,"path",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),_1=lt(h1.prototype,"enabled",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),l1=h1))||l1);!function(t){t[t.EQUAL_TO=0]="EQUAL_TO",t[t.NOT_EQUAL_TO=1]="NOT_EQUAL_TO",t[t.LESS_THAN=2]="LESS_THAN",t[t.LESS_THAN_OR_EQUAL_TO=3]="LESS_THAN_OR_EQUAL_TO",t[t.GREATER_THAN=4]="GREATER_THAN",t[t.GREATER_THAN_OR_EQUAL_TO=5]="GREATER_THAN_OR_EQUAL_TO"}(I1||(I1={})),Ec("cc.animation.BinaryCondition")((g1=v1=function(){function t(){ct(this,"operator",d1,this),ct(this,"lhs",p1,this),ct(this,"rhs",m1,this)}var e=t.prototype;return e.clone=function(){var e=new t;return e.operator=this.operator,e.lhs=this.lhs.clone(),e.rhs=this.rhs.clone(),e},e[bQ]=function(t){var e=this.operator,n=this.lhs,i=this.rhs,r=new B1(e,0,0),a=_0(t,n,GK.FLOAT,r.setLhs,r),o=_0(t,i,GK.FLOAT,r.setRhs,r);return r.reset(a,o),r},t}(),v1.Operator=I1,d1=lt((f1=g1).prototype,"operator",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return I1.EQUAL_TO}}),p1=lt(f1.prototype,"lhs",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l0}}),m1=lt(f1.prototype,"rhs",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new l0}}),f1));var N1,B1=function(){function t(t,e,n){this._operator=t,this._lhs=e,this._rhs=n,this._eval()}var e=t.prototype;return e.reset=function(t,e){this._lhs=t,this._rhs=e,this._eval()},e.setLhs=function(t){this._lhs=t,this._eval()},e.setRhs=function(t){this._rhs=t,this._eval()},e.eval=function(){return this._result},e._eval=function(){var t=this._lhs,e=this._rhs;switch(this._operator){default:case I1.EQUAL_TO:this._result=t===e;break;case I1.NOT_EQUAL_TO:this._result=t!==e;break;case I1.LESS_THAN:this._result=t<e;break;case I1.LESS_THAN_OR_EQUAL_TO:this._result=t<=e;break;case I1.GREATER_THAN:this._result=t>e;break;case I1.GREATER_THAN_OR_EQUAL_TO:this._result=t>=e}},t}();!function(t){t[t.TRUTHY=0]="TRUTHY",t[t.FALSY=1]="FALSY"}(N1||(N1={})),Ec("cc.animation.UnaryCondition")((b1=A1=function(){function t(){ct(this,"operator",x1,this),ct(this,"operand",S1,this)}var e=t.prototype;return e.clone=function(){var e=new t;return e.operator=this.operator,e.operand=this.operand.clone(),e},e[bQ]=function(t){var e=this.operator,n=this.operand,i=new F1(e,!1),r=u0(t,n,GK.BOOLEAN,i.setOperand,i);return i.reset(r),i},t}(),A1.Operator=N1,x1=lt((y1=b1).prototype,"operator",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return N1.TRUTHY}}),S1=lt(y1.prototype,"operand",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new h0}}),y1));var L1,F1=function(){function t(t,e){this._operator=t,this._operand=e,this._eval()}var e=t.prototype;return e.reset=function(t){this.setOperand(t)},e.setOperand=function(t){this._operand=t,this._eval()},e.eval=function(){return this._result},e._eval=function(){var t=this._operand;switch(this._operator){default:case N1.TRUTHY:this._result=!!t;break;case N1.FALSY:this._result=!t}},t}(),V1=Ec("cc.animation.TriggerCondition")((w1=function(){function t(){ct(this,"trigger",E1,this)}var e=t.prototype;return e.clone=function(){var e=new t;return e.trigger=this.trigger,e},e[bQ]=function(t){var e=new z1(!1),n=t.getVar(this.trigger);return f0(n,this.trigger)&&(function(t,e){if(t!==GK.TRIGGER)throw new AQ(e,"trigger")}(n.type,this.trigger),e.setTrigger(n.bind(e.setTrigger,e))),e},t}(),E1=lt((T1=w1).prototype,"trigger",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),C1=T1))||C1,z1=function(){function t(t){this._triggered=!1,this._triggered=t}var e=t.prototype;return e.setTrigger=function(t){this._triggered=t},e.eval=function(){return this._triggered},t}(),k1=function(){function t(){this._nodeBlendStates=new Map}var e=t.prototype;return e.createWriter=function(t,e,n,i){var r=this.ref(t,e);return new U1(t,e,r,n,i)},e.destroyWriter=function(t){var e=t;this.deRef(e.node,e.property)},e.ref=function(t,e){var n=this._nodeBlendStates.get(t);return n||(n=this.createNodeBlendState(),this._nodeBlendStates.set(t,n)),n.refProperty(t,e)},e.deRef=function(t,e){var n=this._nodeBlendStates.get(t);n&&(n.deRefProperty(e),n.empty&&this._nodeBlendStates.delete(t))},e.apply=function(){this._nodeBlendStates.forEach((function(t,e){t.apply(e)}))},t}(),U1=function(){function t(t,e,n,i,r){this._node=t,this._property=e,this._propertyBlendState=n,this._host=i,this._constants=r}var e=t.prototype;return e.getValue=function(){return this._node[this._property]},e.setValue=function(t){var e=this._propertyBlendState,n=this._host.weight;e.blend(t,n)},Q(t,[{key:"node",get:function(){return this._node}},{key:"property",get:function(){return this._property}}]),t}();!function(t){t[t.POSITION=1]="POSITION",t[t.ROTATION=2]="ROTATION",t[t.SCALE=4]="SCALE",t[t.EULER_ANGLES=8]="EULER_ANGLES"}(L1||(L1={}));var G1,H1=L1.POSITION|L1.ROTATION|L1.SCALE|L1.EULER_ANGLES,j1=function(){function t(){this.refCount=0,this.accumulatedWeight=0,this.result=new Mn}var e=t.prototype;return e.blend=function(t,e){this.accumulatedWeight=$1(this.result,this.result,this.accumulatedWeight,t,e)},e.reset=function(){this.accumulatedWeight=0,Mn.zero(this.result)},t}(),W1=function(){function t(){this.refCount=0,this.accumulatedWeight=0,this.result=new zn}var e=t.prototype;return e.blend=function(t,e){this.accumulatedWeight=t2(this.result,this.result,this.accumulatedWeight,t,e)},e.reset=function(){this.accumulatedWeight=0,zn.identity(this.result)},t}(),q1=function(){function t(){this._transformApplyFlags=0,this._properties={}}var e=t.prototype;return e.refProperty=function(t,e){var n,i,r,a=this._properties;switch(e){default:case"position":case"scale":case"eulerAngles":r=null!==(n=a[e])&&void 0!==n?n:a[e]=this._createVec3BlendState(t[e]);break;case"rotation":r=null!==(i=a[e])&&void 0!==i?i:a[e]=this._createQuatBlendState(t.rotation)}return++r.refCount,r},e.deRefProperty=function(t){var e=this._properties,n=e[t];n&&(--n.refCount,n.refCount>0||delete e[t])},e.apply=function(t){var e,n,i,r=this._transformApplyFlags,a=this._properties,o=a.position,s=a.scale,c=a.rotation,l=a.eulerAngles;r&&(o&&r&L1.POSITION&&(e=o.result),s&&r&L1.SCALE&&(n=s.result),l&&r&L1.EULER_ANGLES&&(i=l.result),c&&r&L1.ROTATION&&(i=c.result),(i||e||n)&&t.setRTS(i,e,n),this._transformApplyFlags=0)},Q(t,[{key:"empty",get:function(){var t=this._properties;return!(t.position||t.rotation||t.eulerAngles||t.scale)}}]),t}(),X1=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.apply=function(e){var n=this._properties,i=n.position,r=n.scale,a=n.rotation,o=n.eulerAngles;i&&i.accumulatedWeight&&(this._transformApplyFlags|=L1.POSITION,i.accumulatedWeight<1&&i.blend(e.position,1-i.accumulatedWeight)),r&&r.accumulatedWeight&&(this._transformApplyFlags|=L1.SCALE,r.accumulatedWeight<1&&r.blend(e.scale,1-r.accumulatedWeight)),o&&o.accumulatedWeight&&(this._transformApplyFlags|=L1.EULER_ANGLES,o.accumulatedWeight<1&&o.blend(e.eulerAngles,1-o.accumulatedWeight)),a&&a.accumulatedWeight&&(this._transformApplyFlags|=L1.ROTATION,a.accumulatedWeight<1&&a.blend(e.rotation,1-a.accumulatedWeight)),t.prototype.apply.call(this,e),null==i||i.reset(),null==r||r.reset(),null==a||a.reset(),null==o||o.reset()},n._createVec3BlendState=function(){return new j1},n._createQuatBlendState=function(){return new W1},e}(q1),Y1=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e.prototype.createNodeBlendState=function(){return new X1},e}(k1),K1=function(){function t(t){this.refCount=0,this.result=new Mn,this._defaultValue=new Mn,this._clipBlendResult=new Mn,this._accumulatedWeight=0,Mn.copy(this._defaultValue,t),Mn.copy(this.result,t)}var e=t.prototype;return e.blend=function(t,e){this._accumulatedWeight=$1(this._clipBlendResult,this._clipBlendResult,this._accumulatedWeight,t,e)},e.commitLayerChange=function(t){var e=this.result,n=this._clipBlendResult,i=this._accumulatedWeight;i<1&&this.blend(this._defaultValue,1-i),Mn.lerp(e,e,n,t),Mn.zero(this._clipBlendResult),this._accumulatedWeight=0},e.reset=function(){Mn.copy(this.result,this._defaultValue)},t}(),J1=function(){function t(t){this.refCount=0,this.result=new zn,this._defaultValue=new zn,this._clipBlendResult=new zn,this._accumulatedWeight=0,zn.copy(this._defaultValue,t),zn.copy(this.result,t)}var e=t.prototype;return e.blend=function(t,e){this._accumulatedWeight=t2(this._clipBlendResult,this._clipBlendResult,this._accumulatedWeight,t,e)},e.commitLayerChange=function(t){var e=this.result,n=this._clipBlendResult,i=this._accumulatedWeight;i<1&&this.blend(this._defaultValue,1-i),zn.slerp(e,e,n,t),zn.identity(this._clipBlendResult),this._accumulatedWeight=0},e.reset=function(){zn.copy(this.result,this._defaultValue)},t}(),Q1=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._layerMask=-1>>>0,e}$(e,t);var n=e.prototype;return n.setLayerMask=function(t){this._layerMask&=~(1<<t)},n.commitLayerChanges=function(t,e){if(this._layerMask&1<<t){var n=this._properties,i=n.position,r=n.scale,a=n.rotation,o=n.eulerAngles;i&&i.commitLayerChange(e),r&&r.commitLayerChange(e),a&&a.commitLayerChange(e),o&&o.commitLayerChange(e)}},n.apply=function(e){this._transformApplyFlags=H1,t.prototype.apply.call(this,e);var n=this._properties,i=n.position,r=n.scale,a=n.rotation,o=n.eulerAngles;null==i||i.reset(),null==r||r.reset(),null==a||a.reset(),null==o||o.reset()},n._createVec3BlendState=function(t){return new K1(t)},n._createQuatBlendState=function(t){return new J1(t)},e}(q1),Z1=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.setMask=function(t,e){this._nodeBlendStates.forEach((function(n,i){e.has(i)&&n.setLayerMask(t)}))},n.commitLayerChanges=function(t,e){this._nodeBlendStates.forEach((function(n){n.commitLayerChanges(t,e)}))},n.createNodeBlendState=function(){return new Q1},e}(k1);function $1(t,e,n,i,r){var a=n+r;if(1!==r||n){if(a){var o=r/a;Mn.lerp(t,t,i,o)}}else Mn.copy(t,i);return a}function t2(t,e,n,i,r){var a=n+r;if(1!==r||n){if(a){var o=r/a;zn.slerp(t,e,i,o)}}else zn.copy(t,i);return a}var e2,n2,i2=Ec("cc.animation.StateMachineComponent")(G1=function(){function t(){}var e=t.prototype;return e.onMotionStateEnter=function(){},e.onMotionStateExit=function(){},e.onMotionStateUpdate=function(){},e.onStateMachineEnter=function(){},e.onStateMachineExit=function(){},t}())||G1,r2=function(){function t(t,e,n){var i=this;this._blendBuffer=new Z1,this._currentTransitionCache={duration:0,time:0},this._varInstances={},this._hasAutoTrigger=!1;for(var r,a=st(t.variables);!(r=a()).done;){var o=r.value,s=o[0],c=o[1],l=this._varInstances[s]=new yQ(c.type,c.value);if(c.type===GK.TRIGGER){var h=c.resetMode;l.resetMode=h,h===HK.NEXT_FRAME_OR_AFTER_CONSUMED&&(this._hasAutoTrigger=!0)}}for(var u={controller:n,blendBuffer:this._blendBuffer,node:e,getVar:function(t){return i._varInstances[t]},triggerResetFn:function(t){i.setValue(t,!1)}},_=(this._layerEvaluations=t.layers.map((function(t){var e;return new a2(t,Z({},u,{mask:null!==(e=t.mask)&&void 0!==e?e:void 0}))}))).length,f=0;f<_;++f){var d=t.layers[f].mask;if(d){var p=d.filterDisabledNodes(u.node);this._blendBuffer.setMask(f,p)}}}var e=t.prototype;return e.update=function(t){for(var e=this._blendBuffer,n=this._layerEvaluations,i=n.length,r=0;r<i;++r){var a=n[r];a.update(t),e.commitLayerChanges(r,a.weight*a.passthroughWeight)}if(this._hasAutoTrigger){var o=this._varInstances;for(var s in o){var c=o[s];c.type===GK.TRIGGER&&c.resetMode===HK.NEXT_FRAME_OR_AFTER_CONSUMED&&(c.value=!1)}}this._blendBuffer.apply()},e.getVariables=function(){return Object.entries(this._varInstances)},e.getCurrentStateStatus=function(t){return this._layerEvaluations[t].getCurrentStateStatus()},e.getCurrentClipStatuses=function(t){return this._layerEvaluations[t].getCurrentClipStatuses()},e.getCurrentTransition=function(t){var e=this._layerEvaluations,n=this._currentTransitionCache;return e[t].getCurrentTransition(n)?n:null},e.getNextStateStatus=function(t){return this._layerEvaluations[t].getNextStateStatus()},e.getNextClipStatuses=function(t){return this.getCurrentTransition(t),this._layerEvaluations[t].getNextClipStatuses()},e.getValue=function(t){var e=this._varInstances[t];return e?e.value:void 0},e.setValue=function(t,e){var n=this._varInstances[t];n&&(n.value=e)},e.setLayerWeight=function(t,e){this._layerEvaluations[t].weight=e},t}(),a2=function(){function t(t,e){this.passthroughWeight=1,this._nodes=[],this._topLevelEntry=void 0,this._topLevelExit=void 0,this._currentNode=void 0,this._currentTransitionToNode=null,this._currentTransitionPath=[],this._transitionProgress=0,this._fromWeight=0,this._toWeight=0,this._fromUpdated=!1,this._toUpdated=!1,this.name=t.name,this._controller=e.controller,this.weight=t.weight;var n=this._addStateMachine(t.stateMachine,null,Z({},e),t.name),i=n.entry,r=n.exit;this._topLevelEntry=i,this._topLevelExit=r,this._currentNode=i,this._resetTrigger=e.triggerResetFn}var e=t.prototype;return e.update=function(t){this.exited||(this._fromWeight=1,this._toWeight=0,this._eval(t),this._sample())},e.getCurrentStateStatus=function(){var t=this._currentNode;return t.kind===n2.animation?t.getFromPortStatus():null},e.getCurrentClipStatuses=function(){var t=this._currentNode;return t.kind===n2.animation?t.getClipStatuses(this._fromWeight):s2},e.getCurrentTransition=function(t){var e=this._currentTransitionPath;if(0!==e.length){if(e[e.length-1].to.kind!==n2.animation)return!1;var n=e[0],i=n.duration,r=n.normalizedDuration,a=t.duration=r?i*(this._currentNode.kind===n2.animation?this._currentNode.duration:0):i;return t.time=this._transitionProgress*a,!0}return!1},e.getNextStateStatus=function(){return this._currentTransitionToNode&&(this._currentTransitionToNode.kind,n2.empty),this._currentTransitionToNode.getToPortStatus()},e.getNextClipStatuses=function(){var t,e=this._currentTransitionPath,n=e[e.length-1].to;return n.kind,n2.animation,null!==(t=n.getClipStatuses(this._toWeight))&&void 0!==t?t:s2},e._addStateMachine=function(t,e,n,i){for(var r,a,o,s=this,c=Array.from(t.states()),l=c.map((function(e){return e instanceof IQ?new d2(e,n):e===t.entryState?r=new C2(e,n2.entry,e.name):e===t.exitState?o=new C2(e,n2.exit,e.name):e===t.anyState?a=new C2(e,n2.any,e.name):e instanceof MQ?new T2(e):null})),h={components:null,parent:e,entry:r,exit:o,any:a},u=0;u<c.length;++u){var _=l[u];_&&(_.stateMachine=h)}for(var f=c.map((function(t){if(t instanceof BQ){var e=s._addStateMachine(t.stateMachine,h,n,i+"/"+t.name);return e.components=new f2(t),e}return null})),d=0;d<c.length;++d){var p=c[d],m=t.getOutgoings(p),v=[],g=void 0;g=p instanceof BQ?f[d].exit:l[d];for(var y,x=function(){var t=y.value,e=t.to,i=c.findIndex((function(e){return e===t.to})),r=void 0;r=e instanceof BQ?f[i].entry:l[i];var a={conditions:t.conditions.map((function(t){return t[bQ](n)})),to:r,triggers:void 0,duration:0,normalizedDuration:!1,exitCondition:0,exitConditionEnabled:!1};t instanceof RQ?(a.duration=t.duration,a.normalizedDuration=t.relativeDuration,a.exitConditionEnabled=t.exitConditionEnabled,a.exitCondition=t.exitCondition):t instanceof OQ&&(a.duration=t.duration),a.conditions.forEach((function(e,n){var i,r=t.conditions[n];r instanceof V1&&r.trigger&&(null!==(i=a.triggers)&&void 0!==i?i:a.triggers=[]).push(r.trigger)})),v.push(a)},S=st(m);!(y=S()).done;)x();g.outgoingTransitions=v}return h},e._eval=function(t){if(this.exited,G$("[Layer "+this.name+"]: UpdateStart "+t+"s"),this._continueDanglingTransition())return 0;for(var e=t,n=!0,i=0;n||e>0;){if(n=!1,100===i){R(14e3,100);break}if(++i,this._currentTransitionPath.length>0){if(e-=this._updateCurrentTransition(e),this._currentNode.kind===n2.exit)break;0===this._currentTransitionPath.length&&(n=!0)}else{var r=this._currentNode,a=this._matchCurrentNodeTransition(e);if(a){var o=a.transition,s=a.requires;if(U$("[SubStateMachine "+this.name+"]: CurrentNodeUpdate: "+r.name),e-=s,r.kind===n2.animation&&(r.updateFromPort(s),this._fromUpdated=!0),this._switchTo(o))break;n=!0}else U$("[SubStateMachine "+this.name+"]: CurrentNodeUpdate: "+r.name),r.kind===n2.animation?(r.updateFromPort(e),this._fromUpdated=!0,e=0):e=0}}return U$("[SubStateMachine "+this.name+"]: UpdateEnd"),this._fromUpdated&&this._currentNode.kind===n2.animation&&(this._fromUpdated=!1,this._currentNode.triggerFromPortUpdate(this._controller)),this._currentTransitionToNode&&this._toUpdated&&this._currentTransitionToNode.kind===n2.animation&&(this._toUpdated=!1,this._currentTransitionToNode.triggerToPortUpdate(this._controller)),e},e._sample=function(){var t=this._currentNode,e=this._currentTransitionToNode,n=this._fromWeight,i=this._toWeight;t.kind===n2.empty?(this.passthroughWeight=i,e&&e.kind===n2.animation&&e.sampleToPort(1)):e&&e.kind===n2.empty?(this.passthroughWeight=n,t.kind===n2.animation&&t.sampleFromPort(1)):(this.passthroughWeight=1,t.kind===n2.animation&&t.sampleFromPort(n),e&&e.kind===n2.animation&&e.sampleToPort(i))},e._matchCurrentNodeTransition=function(t){var e=this._currentNode,n=1/0,i=null,r=this._matchTransition(e,e,t,h2);if(r&&(n=r.requires,i=r.transition),e.kind===n2.animation)for(var a=e.stateMachine;null!==a;a=a.parent){var o=this._matchTransition(a.any,e,t,u2);o&&o.requires<n&&(n=o.requires,i=o.transition)}return i?l2.set(i,n):null},e._matchTransition=function(t,e,n,i){t===e||(t.kind,n2.any);for(var r=t.outgoingTransitions,a=r.length,o=1/0,s=null,c=0;c<a;++c){var l=r[c],h=l.conditions,u=h.length;if(0===u){if(t.kind===n2.entry||t.kind===n2.exit)return i.set(l,0);if(!l.exitConditionEnabled)continue}var _=0;if(e.kind===n2.animation&&l.exitConditionEnabled){var f=e.duration*l.exitCondition;if((_=Math.max(f-e.fromPortTime,0))>n)continue}for(var d=!0,p=0;p<u;++p)if(!h[p].eval()){d=!1;break}if(d){if(0===_)return i.set(l,0);_<o&&(o=_,s=l)}}return s?i.set(s,o):null},e._switchTo=function(t){var e=this._currentNode;G$("[SubStateMachine "+this.name+"]: STARTED "+e.name+" -> "+t.to.name+".");var n=this._currentTransitionPath;this._consumeTransition(t),n.push(t);var i=this._matchTransitionPathUntilMotion();return!i||(this._doTransitionToMotion(i),!1)},e._continueDanglingTransition=function(){var t=this._currentTransitionPath,e=t.length;if(0===e)return!1;var n=t[e-1].to;if(n.kind!==n2.animation&&n.kind!==n2.empty){var i=this._matchTransitionPathUntilMotion();return!i||(this._doTransitionToMotion(i),!1)}return!1},e._matchTransitionPathUntilMotion=function(){for(var t=this._currentTransitionPath,e=t[t.length-1].to;e.kind!==n2.animation&&e.kind!==n2.empty;){var n=this._matchTransition(e,e,0,l2);if(!n)break;var i=n.transition;this._consumeTransition(i),t.push(i),e=i.to}return e.kind===n2.animation||e.kind===n2.empty?e:null},e._consumeTransition=function(t){var e=t.to;e.kind===n2.entry&&this._callEnterMethods(e)},e._resetTriggersAlongThePath=function(){for(var t=this._currentTransitionPath,e=t.length,n=0;n<e;++n){var i=t[n];this._resetTriggersOnTransition(i)}},e._doTransitionToMotion=function(t){this._resetTriggersAlongThePath(),this._transitionProgress=0,this._currentTransitionToNode=t,this._toUpdated=!1,t.kind===n2.animation&&t.resetToPort(),this._callEnterMethods(t)},e._updateCurrentTransition=function(t){var e,n=this._currentTransitionPath,i=this._currentTransitionToNode;n.length;var r=n[0],a=r.duration,o=r.normalizedDuration,s=this._currentNode,c=i,l=0,h=0;if(a<=0)l=0,h=1;else{s.kind===n2.animation||(s.kind,n2.empty);var u=this._transitionProgress,_=s.kind===n2.empty?a:o?a*s.duration:a,f=u*_,d=_-f;l=Math.min(d,t),h=this._transitionProgress=(f+l)/_}var p=null!==(e=null==c?void 0:c.name)&&void 0!==e?e:"<Empty>";this._fromWeight=1-h,this._toWeight=h;var m=0!==l,v=1===h;if(s.kind===n2.animation&&m&&(G$("Update "+s.name),s.updateFromPort(l),this._fromUpdated=!0),c.kind===n2.animation&&m&&(G$("Update "+c.name),c.updateToPort(l),this._toUpdated=!0),v){U$("[SubStateMachine "+this.name+"]: Transition finished:  "+s.name+" -> "+p+"."),this._callExitMethods(s);for(var g=this._currentTransitionPath,y=g.length,x=0;x<y;++x){var S=g[x].to;S.kind===n2.exit&&this._callExitMethods(S)}this._fromUpdated=this._toUpdated,this._toUpdated=!1,c.kind===n2.animation&&c.finishTransition(),this._currentNode=c,this._currentTransitionToNode=null,this._currentTransitionPath.length=0,this._fromWeight=1,this._toWeight=0}return l},e._resetTriggersOnTransition=function(t){var e=t.triggers;if(e)for(var n=e.length,i=0;i<n;++i){var r=e[i];this._resetTrigger(r)}},e._resetTrigger=function(t){(0,this._triggerReset)(t)},e._callEnterMethods=function(t){var e,n=this._controller;switch(t.kind){default:break;case n2.animation:t.components.callMotionStateEnterMethods(n,t.getToPortStatus());break;case n2.entry:null===(e=t.stateMachine.components)||void 0===e||e.callStateMachineEnterMethods(n)}},e._callExitMethods=function(t){var e,n=this._controller;switch(t.kind){default:break;case n2.animation:t.components.callMotionStateExitMethods(n,t.getFromPortStatus());break;case n2.exit:null===(e=t.stateMachine.components)||void 0===e||e.callStateMachineExitMethods(n)}},Q(t,[{key:"exited",get:function(){return this._currentNode===this._topLevelExit}}]),t}(),o2=Object.freeze({next:function(){return{done:!0,value:void 0}}}),s2=Object.freeze(((e2={})[Symbol.iterator]=function(){return o2},e2)),c2=function(){function t(){this.transition=null,this.requires=0}return t.prototype.set=function(t,e){return this.transition=t,this.requires=e,this},t}(),l2=new c2,h2=new c2,u2=new c2;!function(t){t[t.entry=0]="entry",t[t.exit=1]="exit",t[t.any=2]="any",t[t.animation=3]="animation",t[t.empty=4]="empty"}(n2||(n2={}));var _2=function(t){this.name=void 0,this.outgoingTransitions=[],this.name=t.name},f2=function(){function t(t){this._components=t.instantiateComponents()}var e=t.prototype;return e.callMotionStateEnterMethods=function(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateEnter",t,e)},e.callMotionStateUpdateMethods=function(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateUpdate",t,e)},e.callMotionStateExitMethods=function(t,e){this._callMotionStateCallbackIfNonDefault("onMotionStateExit",t,e)},e.callStateMachineEnterMethods=function(t){this._callStateMachineCallbackIfNonDefault("onStateMachineEnter",t)},e.callStateMachineExitMethods=function(t){this._callStateMachineCallbackIfNonDefault("onStateMachineExit",t)},e._callMotionStateCallbackIfNonDefault=function(t,e,n){for(var i=this._components,r=i.length,a=0;a<r;++a){var o=i[a];o[t]!==i2.prototype[t]&&o[t](e,n)}},e._callStateMachineCallbackIfNonDefault=function(t,e){for(var n=this._components,i=n.length,r=0;r<i;++r){var a=n[r];a[t]!==i2.prototype[t]&&a[t](e)}},t}(),d2=function(t){function e(e,n){var i,r,a;if((a=t.call(this,e)||this).kind=n2.animation,a._source=null,a._baseSpeed=1,a._speed=1,a._fromPort={progress:0,statusCache:{progress:0}},a._toPort={progress:0,statusCache:{progress:0}},a._baseSpeed=e.speed,a._setSpeedMultiplier(1),e.speedMultiplierEnabled&&e.speedMultiplier){var o=e.speedMultiplier,s=n.getVar(o);if(f0(s,o)){!function(t,e,n){if(t!==e)throw new AQ(n,"number")}(s.type,GK.FLOAT,o),s.bind(a._setSpeedMultiplier,at(a));var c=s.value;a._setSpeedMultiplier(c)}}var l=Z({},n),h=null!==(i=null===(r=e.motion)||void 0===r?void 0:r[bQ](l))&&void 0!==i?i:null;return h&&Object.defineProperty(h,"__DEBUG_ID__",{value:a.name}),a._source=h,a.components=new f2(e),a}$(e,t);var n=e.prototype;return n.updateFromPort=function(t){this._fromPort.progress=p2(this._fromPort.progress,this.duration,t*this._speed)},n.updateToPort=function(t){this._toPort.progress=p2(this._toPort.progress,this.duration,t*this._speed)},n.triggerFromPortUpdate=function(t){this.components.callMotionStateUpdateMethods(t,this.getFromPortStatus())},n.triggerToPortUpdate=function(t){this.components.callMotionStateUpdateMethods(t,this.getToPortStatus())},n.getFromPortStatus=function(){var t=this._fromPort.statusCache;return t.progress=m2(this._fromPort.progress),t},n.getToPortStatus=function(){var t=this._toPort.statusCache;return t.progress=m2(this._toPort.progress),t},n.resetToPort=function(){this._toPort.progress=0},n.finishTransition=function(){this._fromPort.progress=this._toPort.progress},n.sampleFromPort=function(t){var e;null===(e=this._source)||void 0===e||e.sample(this._fromPort.progress,t)},n.sampleToPort=function(t){var e;null===(e=this._source)||void 0===e||e.sample(this._toPort.progress,t)},n.getClipStatuses=function(t){var e,n=this._source;return n?((e={})[Symbol.iterator]=function(){return n.getClipStatuses(t)},e):s2},n._setSpeedMultiplier=function(t){this._speed=this._baseSpeed*t},Q(e,[{key:"duration",get:function(){var t,e;return null!==(t=null===(e=this._source)||void 0===e?void 0:e.duration)&&void 0!==t?t:0}},{key:"fromPortTime",get:function(){return this._fromPort.progress*this.duration}}]),e}(_2);function p2(t,e,n){return 0===e?0:t+n/e}function m2(t){return t-Math.trunc(t)}var v2,g2,y2,x2,S2,A2,b2,C2=function(t){function e(e,n){var i;return(i=t.call(this,e)||this).kind=void 0,i.kind=n,i}return $(e,t),e}(_2),T2=function(t){function e(e){var n;return(n=t.call(this,e)||this).kind=n2.empty,n}return $(e,t),e}(_2),E2=(v2=Ec("cc.animation.AnimationController"),g2=kc(),y2=Dc(zQ),v2(x2=g2((b2=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"graph",A2,at(e)),e._graphEval=null,e}$(e,t);var n=e.prototype;return n.__preload=function(){this.graph&&(this._graphEval=new r2(this.graph,this.node,this))},n.update=function(t){var e;null===(e=this._graphEval)||void 0===e||e.update(t)},n.getVariables=function(){return this._graphEval.getVariables()},n.setValue=function(t,e){this._graphEval.setValue(t,e)},n.getValue=function(t){return this._graphEval.getValue(t)},n.getCurrentStateStatus=function(t){return this._graphEval.getCurrentStateStatus(t)},n.getCurrentClipStatuses=function(t){return this._graphEval.getCurrentClipStatuses(t)},n.getCurrentTransition=function(t){return this._graphEval.getCurrentTransition(t)},n.getNextStateStatus=function(t){return this._graphEval.getNextStateStatus(t)},n.getNextClipStatuses=function(t){return this._graphEval.getNextClipStatuses(t)},n.setLayerWeight=function(t,e){return this._graphEval.setLayerWeight(t,e)},e}(xu),A2=lt((S2=b2).prototype,"graph",[y2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),x2=S2))||x2)||x2);t("animation",Object.freeze({__proto__:null,UniformProxyFactory:FY,MorphWeightValueProxy:VY,MorphWeightsValueProxy:zY,MorphWeightsAllValueProxy:kY,Track:EK,TrackPath:CK,RealTrack:DK,VectorTrack:WK,QuatTrack:KK,ColorTrack:ZK,SizeTrack:eJ,ObjectTrack:iJ,isPropertyPath:_Y,isCustomPath:function(t,e){return t instanceof e},HierarchyPath:BY,ComponentPath:LY,CubicSplineVec2Value:pK,CubicSplineVec3Value:mK,CubicSplineVec4Value:vK,CubicSplineQuatValue:gK,CubicSplineNumberValue:yK,AnimationController:E2,get VariableType(){return GK},StateMachineComponent:i2}));var w2,I2,P2,D2=[],R2=new Map;function M2(t,e){for(var n=0,i=Xn.IDENTITY;t;){if(t.stamp===e||t.stamp+1===e&&!t.node.hasChangedFlags){i=t.world,t.stamp=e;break}t.stamp=e,D2[n++]=t,t=t.parent}for(;n>0;){t=D2[--n],D2[n]=null;var r=t.node;Xn.fromRTS(t.local,r.rotation,r.position,r.scale),i=Xn.multiply(t.world,i,t.local)}return i}function O2(t,e){for(var n,i=null,r=0;t!==e;){var a=t.uuid;if(R2.has(a)){i=R2.get(a);break}i={node:t,local:new Xn,world:new Xn,stamp:-1,parent:null},R2.set(a,i),D2[r++]=i,t=t.parent,i=null}for(;r>0;)n=D2[--r],D2[r]=null,n.parent=i,i=n;return i}function N2(t){for(var e=R2.get(t.uuid)||null;e;)R2.delete(e.node.uuid),e=e.parent}var B2=t("AnimationManager",Ec((P2=I2=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._anims=new ht([]),e._crossFades=new ht([]),e._delayEvents=[],e._blendStateBuffer=new Y1,e._sockets=[],e}$(e,t);var n=e.prototype;return n.addCrossFade=function(t){-1===this._crossFades.array.indexOf(t)&&this._crossFades.push(t)},n.removeCrossFade=function(t){var e=this._crossFades.array.indexOf(t);e>=0?this._crossFades.fastRemoveAt(e):O(3907)},n.update=function(t){var e=this._delayEvents,n=this._crossFades,i=this._sockets,r=n.array;for(n.i=0;n.i<r.length;++n.i)r[n.i].update(t);var a=this._anims,o=a.array;for(a.i=0;a.i<o.length;++a.i){var s=o[a.i];s.isMotionless||s.update(t)}this._blendStateBuffer.apply();for(var c=h.director.getTotalFrames(),l=0,u=i.length;l<u;l++){var _=i[l],f=_.target,d=_.transform;f.matrix=M2(d,c)}for(var p=0,m=e.length;p<m;p++){var v=e[p];v.fn.apply(v.thisArg,v.args)}e.length=0},n.destruct=function(){},n.addAnimation=function(t){-1===this._anims.array.indexOf(t)&&this._anims.push(t)},n.removeAnimation=function(t){var e=this._anims.array.indexOf(t);e>=0?this._anims.fastRemoveAt(e):O(3907)},n.pushDelayEvent=function(t,e,n){this._delayEvents.push({fn:t,thisArg:e,args:n})},n.addSockets=function(t,e){for(var n=this,i=function(i){var r=e[i];if(n._sockets.find((function(t){return t.target===r.target})))return"continue";var a=t.getChildByPath(r.path),o=r.target&&a&&O2(a,t);o&&n._sockets.push({target:r.target,transform:o})},r=0;r<e.length;++r)i(r)},n.removeSockets=function(t,e){for(var n=0;n<e.length;++n)for(var i=e[n],r=0;r<this._sockets.length;++r){var a=this._sockets[r];if(a.target===i.target){N2(a.transform.node),this._sockets[r]=this._sockets[this._sockets.length-1],this._sockets.length--;break}}},Q(e,[{key:"blendState",get:function(){return this._blendStateBuffer}}]),e}(uO),I2.ID="animation",w2=P2))||w2);TO.on(CO.EVENT_INIT,(function(){var t=new B2;TO.registerSystem(B2.ID,t,uO.Priority.HIGH)})),h.AnimationManager=B2;var L2,F2,V2,z2,k2,U2,G2,H2,j2,W2,q2,X2,Y2,K2,J2,Q2,Z2,$2=function(t){function e(e){var n;return(n=t.call(this)||this)._managedStates=[],n._fadings=[],n._scheduled=!1,n._scheduler=null!=e?e:g$(),n}$(e,t);var n=e.prototype;return n.update=function(t){if(!this.isMotionless){var e=this._managedStates,n=this._fadings;if(1===e.length&&1===n.length){var i=e[0].state;i&&(i.weight=1)}else this._calculateWeights(t);1===e.length&&1===n.length&&this._unscheduleThis()}},n.crossFade=function(t,e){var n;0===this._managedStates.length&&(e=0),0===e&&this.clear();var i=this._managedStates.find((function(e){return e.state===t}));i?(null===(n=i.state)||void 0===n?void 0:n.isMotionless)&&i.state.play():(i={state:t,reference:0},t&&t.play(),this._managedStates.push(i)),++i.reference,this._fadings.unshift({easeDuration:e,easeTime:0,target:i}),this.isMotionless||this._scheduleThis()},n.clear=function(){for(var t=0;t<this._managedStates.length;++t){var e=this._managedStates[t].state;e&&e.stop()}this._managedStates.length=0,this._fadings.length=0},n.onPlay=function(){t.prototype.onPlay.call(this),this._scheduleThis()},n.onPause=function(){t.prototype.onPause.call(this);for(var e=0;e<this._managedStates.length;++e){var n=this._managedStates[e].state;n&&n.pause()}this._unscheduleThis()},n.onResume=function(){t.prototype.onResume.call(this);for(var e=0;e<this._managedStates.length;++e){var n=this._managedStates[e].state;n&&n.resume()}this._scheduleThis()},n.onStop=function(){t.prototype.onStop.call(this),this.clear()},n._calculateWeights=function(t){for(var e=this._managedStates,n=this._fadings,i=0;i<e.length;++i){var r=e[i].state;r&&(r.weight=0)}for(var a=1,o=n.length,s=0;s<n.length;++s){var c=n[s];c.easeTime+=t;var l=0===c.easeDuration?1:_n(c.easeTime/c.easeDuration),h=l*a;if(a*=1-l,c.target.state&&(c.target.state.weight+=h),c.easeTime>=c.easeDuration){o=s+1,c.easeTime=c.easeDuration;break}}if(o!==n.length){for(var u=o;u<n.length;++u){var _=n[u];--_.target.reference,_.target.reference<=0&&(_.target.state&&_.target.state.stop(),ft(this._managedStates,_.target))}n.splice(o)}},n._scheduleThis=function(){this._scheduled||(this._scheduler.addCrossFade(this),this._scheduled=!0)},n._unscheduleThis=function(){this._scheduled&&(this._scheduler.removeCrossFade(this),this._scheduled=!1)},e}(O$),t4=function(e){return t({Animation:e,AnimationComponent:e}),e}((L2=Ec("cc.Animation"),F2=jc(),V2=Ic(99),z2=kc(),k2=cl([S$]),U2=Kc(),G2=cl(S$),H2=Kc(),j2=Kc(),W2=cl([S$]),L2(q2=F2(q2=V2(q2=zc(q2=z2((Z2=Q2=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"playOnLoad",Y2,at(e)),e._crossFade=new $2,e._nameToState=Pt(!0),ct(e,"_clips",K2,at(e)),ct(e,"_defaultClip",J2,at(e)),e._hasBeenPlayed=!1,e}$(e,t);var n=e.prototype;return n.onLoad=function(){for(var t in this.clips=this._clips,this._nameToState)this._nameToState[t].initialize(this.node)},n.start=function(){this.playOnLoad&&!this._hasBeenPlayed&&this._defaultClip&&this.crossFade(this._defaultClip.name,0)},n.onEnable=function(){this._crossFade.resume()},n.onDisable=function(){this._crossFade.pause()},n.onDestroy=function(){for(var t in this._crossFade.stop(),this._nameToState)this._nameToState[t].destroy();this._nameToState=Pt(!0)},n.play=function(t){if(this._hasBeenPlayed=!0,!t){if(!this._defaultClip)return;t=this._defaultClip.name}this.crossFade(t,0)},n.crossFade=function(t,e){void 0===e&&(e=.3),this._hasBeenPlayed=!0;var n=this._nameToState[t];n&&this.doPlayOrCrossFade(n,e)},n.pause=function(){this._crossFade.pause()},n.resume=function(){this._crossFade.resume()},n.stop=function(){this._crossFade.stop()},n.getState=function(t){var e=this._nameToState[t];return e&&!e.curveLoaded&&e.initialize(this.node),e||null},n.createState=function(t,e){return e=e||t.name,this.removeState(e),this._doCreateState(t,e)},n.removeState=function(t){var e=this._nameToState[t];e&&(e.allowLastFrameEvent(!1),e.stop(),delete this._nameToState[t])},n.addClip=function(t,e){return pt(this._clips,t)||this._clips.push(t),this.createState(t,e)},n.removeClip=function(t,e){var n;for(var i in this._nameToState){var r=this._nameToState[i];if(r.clip===t){n=r;break}}if(t===this._defaultClip){if(!e)return void R(3902);this._defaultClip=null}if(n&&n.isPlaying){if(!e)return void R(3903);n.stop()}this._clips=this._clips.filter((function(e){return e!==t})),n&&delete this._nameToState[n.name]},n.on=function(e,n,i,r){var a=t.prototype.on.call(this,e,n,i,r);return e===M$.LASTFRAME&&this._syncAllowLastFrameEvent(),a},n.once=function(e,n,i){var r=t.prototype.once.call(this,e,n,i);return e===M$.LASTFRAME&&this._syncAllowLastFrameEvent(),r},n.off=function(e,n,i){t.prototype.off.call(this,e,n,i),e===M$.LASTFRAME&&this._syncDisallowLastFrameEvent()},n._createState=function(t,e){return new B$(t,e)},n._doCreateState=function(t,e){var n=this._createState(t,e);return n._setEventTarget(this),n.allowLastFrameEvent(this.hasEventListener(M$.LASTFRAME)),this.node&&n.initialize(this.node),this._nameToState[n.name]=n,n},n.doPlayOrCrossFade=function(t,e){this._crossFade.play(),this._crossFade.crossFade(t,e)},n._removeStateOfAutomaticClip=function(t){for(var e in this._nameToState){var n=this._nameToState[e];e4(t,n.clip)&&(n.stop(),delete this._nameToState[e])}},n._syncAllowLastFrameEvent=function(){if(this.hasEventListener(M$.LASTFRAME))for(var t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!0)},n._syncDisallowLastFrameEvent=function(){if(!this.hasEventListener(M$.LASTFRAME))for(var t in this._nameToState)this._nameToState[t].allowLastFrameEvent(!1)},Q(e,[{key:"clips",get:function(){return this._clips},set:function(t){var e=this;this._crossFade&&this._crossFade.clear();for(var n,i=st(this._clips);!(n=i()).done;){var r=n.value;r&&this._removeStateOfAutomaticClip(r)}for(var a,o=st(t);!(a=o()).done;){var s=a.value;s&&this.createState(s)}var c=t.find((function(t){return e4(t,e._defaultClip)}));this._defaultClip=c||null,this._clips=t}},{key:"defaultClip",get:function(){return this._defaultClip},set:function(t){this._defaultClip=t,t&&(this._clips.findIndex((function(e){return e4(e,t)}))>=0||(this._clips.push(t),this.createState(t)))}}]),e}(nh(xu)),Q2.EventType=M$,lt((X2=Z2).prototype,"clips",[k2,U2],Object.getOwnPropertyDescriptor(X2.prototype,"clips"),X2.prototype),lt(X2.prototype,"defaultClip",[G2,H2],Object.getOwnPropertyDescriptor(X2.prototype,"defaultClip"),X2.prototype),Y2=lt(X2.prototype,"playOnLoad",[Nc,j2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),K2=lt(X2.prototype,"_clips",[W2],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),J2=lt(X2.prototype,"_defaultClip",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),q2=X2))||q2)||q2)||q2)||q2)||q2));function e4(t,e){return t===e||!!t&&!!e&&t._uuid===e._uuid&&t._uuid}h.Animation=t4,h.AnimationComponent=t4,re.setClassAlias(t4,"cc.AnimationComponent");var n4,i4,r4,a4=new Xn;function o4(t,e,n){for(Xn.identity(n);t!==e;)Xn.fromRTS(a4,t.rotation,t.position,t.scale),Xn.multiply(n,a4,n),t=t.parent;return n}h.easing=gf,function(t){t.PLAYED="play",t.PAUSED="pause",t.STOPPED="stop",t.SEEKED="seeked",t.ENDED="ended",t.INTERRUPTION_BEGIN="interruptionBegin",t.INTERRUPTION_END="interruptionEnd",t.USER_GESTURE="on_gesture"}(n4||(n4={})),function(t){t[t.DOM_AUDIO=0]="DOM_AUDIO",t[t.WEB_AUDIO=1]="WEB_AUDIO",t[t.MINIGAME_AUDIO=2]="MINIGAME_AUDIO",t[t.NATIVE_AUDIO=3]="NATIVE_AUDIO",t[t.UNKNOWN_AUDIO=4]="UNKNOWN_AUDIO"}(i4||(i4={})),function(t){t[t.INIT=0]="INIT",t[t.PLAYING=1]="PLAYING",t[t.PAUSED=2]="PAUSED",t[t.STOPPED=3]="STOPPED",t[t.INTERRUPTED=4]="INTERRUPTED"}(r4||(r4={}));var s4=0;function c4(t,e){var n;e.invoking||(e.invoking=!0,(n=e.func).call.apply(n,[t].concat(e.args)).then((function(){e.invoking=!1,t._operationQueue.shift(),t._eventTarget.emit(e.id.toString());var n=t._operationQueue[0];n&&c4(t,n)})).catch((function(){})))}function l4(t,e,n){var i=n.value;n.value=function(){for(var t=this,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return new Promise((function(e){var r=s4++,a=t;a._operationQueue.push({id:r,func:i,args:n,invoking:!1}),a._eventTarget.once(r.toString(),e),c4(a,a._operationQueue[0])}))}}var h4,u4,_4,f4,d4,p4,m4,v4,g4,y4=function(){function t(t){this._nativeAudio=void 0,this._startTime=0,this._startOffset=0,this._isPaused=!0,this._nativeAudio=t}var e=t.prototype;return e.destroy=function(){this._nativeAudio=void 0},e._now=function(){return performance.now()/1e3},e._calculateCurrentTime=function(){var t=this._now()-this._startTime,e=this._startOffset+t;return e>=this.duration&&(this._startTime=this._now(),this._startOffset=0),e%this.duration},e.start=function(){this._isPaused=!1,this._startTime=this._now()},e.pause=function(){this._isPaused||(this._isPaused=!0,this._startOffset=this._calculateCurrentTime())},e.stop=function(){this._isPaused=!0,this._startOffset=0},e.seek=function(t){this._startTime=this._now(),this._startOffset=un(t,0,this.duration)},Q(t,[{key:"duration",get:function(){return this._nativeAudio.duration}},{key:"currentTime",get:function(){return this._isPaused?this._startOffset:this._calculateCurrentTime()}}]),t}(),x4=function(){function t(t,e){var n=this;this._innerAudioContext=void 0,this._onPlayCb=void 0,this._onEndCb=void 0,this._innerAudioContext=t,t.volume=e,t.onPlay((function(){var t;null===(t=n._onPlayCb)||void 0===t||t.call(n)})),t.onEnded((function(){var e;null===(e=n._onEndCb)||void 0===e||e.call(n),t.destroy(),n._innerAudioContext=null}))}var e=t.prototype;return e.play=function(){this._innerAudioContext.play()},e.stop=function(){this._innerAudioContext.stop()},Q(t,[{key:"onPlay",get:function(){return this._onPlayCb},set:function(t){this._onPlayCb=t}},{key:"onEnd",get:function(){return this._onEndCb},set:function(t){this._onEndCb=t}}]),t}(),S4=(lt((h4=function(){function t(t){var e=this;this._innerAudioContext=void 0,this._state=r4.INIT,this._onPlay=void 0,this._onPause=void 0,this._onStop=void 0,this._onSeeked=void 0,this._onEnded=void 0,this._audioTimer=void 0,this._readyToHandleOnShow=!1,this._eventTarget=new uh,this._operationQueue=[],this._innerAudioContext=t,this._audioTimer=new y4(t),this._eventTarget=new uh,Lh.on("hide",this._onHide,this),Lh.on("show",this._onShow,this);var n=this._eventTarget;this._onPlay=function(){e._state=r4.PLAYING,n.emit(n4.PLAYED)},t.onPlay(this._onPlay),this._onPause=function(){e._state=r4.PAUSED,n.emit(n4.PAUSED)},t.onPause(this._onPause),this._onStop=function(){e._state=r4.STOPPED,n.emit(n4.STOPPED)},t.onStop(this._onStop),this._onSeeked=function(){n.emit(n4.SEEKED)},t.onSeeked(this._onSeeked),this._onEnded=function(){e._audioTimer.stop(),e._state=r4.INIT,n.emit(n4.ENDED)},t.onEnded(this._onEnded)}var e=t.prototype;return e.destroy=function(){var t=this;this._audioTimer.destroy(),Lh.off("hide",this._onHide,this),Lh.off("show",this._onShow,this),this._innerAudioContext&&(["Play","Pause","Stop","Seeked","Ended"].forEach((function(e){t._offEvent(e)})),this._innerAudioContext.destroy(),this._innerAudioContext=null)},e._onHide=function(){var t=this;this._state===r4.PLAYING&&this.pause().then((function(){t._state=r4.INTERRUPTED,t._readyToHandleOnShow=!0,t._eventTarget.emit(n4.INTERRUPTION_BEGIN)})).catch((function(){}))},e._onShow=function(){var t=this;this._readyToHandleOnShow?(this._state===r4.INTERRUPTED&&this.play().then((function(){t._eventTarget.emit(n4.INTERRUPTION_END)})).catch((function(){})),this._readyToHandleOnShow=!1):this._eventTarget.once(n4.INTERRUPTION_BEGIN,this._onShow,this)},e._offEvent=function(t){this["_on"+t]&&(this._innerAudioContext["off"+t](this["_on"+t]),this["_on"+t]=null)},t.load=function(e){return new Promise((function(n){t.loadNative(e).then((function(e){n(new t(e))})).catch((function(){}))}))},t.loadNative=function(t){return new Promise((function(e,n){var i=dh.createInnerAudioContext(),r=setTimeout((function(){a(),e(i)}),8e3);function a(){i.offCanplay(o),i.offError(s)}function o(){a(),clearTimeout(r),e(i)}function s(t){a(),clearTimeout(r),console.error("failed to load innerAudioContext"),n(new Error(t))}i.onCanplay(o),i.onError(s),i.src=t}))},t.loadOneShotAudio=function(e,n){return new Promise((function(i,r){t.loadNative(e).then((function(t){i(new x4(t,n))})).catch(r)}))},e.seek=function(t){var e=this;return new Promise((function(n){t=un(t,0,e.duration),e._eventTarget.once(n4.SEEKED,n),e._innerAudioContext.seek(t),e._audioTimer.seek(t)}))},e.play=function(){var t=this;return new Promise((function(e){t._eventTarget.once(n4.PLAYED,e),t._innerAudioContext.play(),t._audioTimer.start()}))},e.pause=function(){var t=this;return new Promise((function(e){t._eventTarget.once(n4.PAUSED,e),t._innerAudioContext.pause(),t._audioTimer.pause()}))},e.stop=function(){var t=this;return new Promise((function(e){t._eventTarget.once(n4.STOPPED,e),t._innerAudioContext.stop(),t._audioTimer.stop()}))},e.onInterruptionBegin=function(t){this._eventTarget.on(n4.INTERRUPTION_BEGIN,t)},e.offInterruptionBegin=function(t){this._eventTarget.off(n4.INTERRUPTION_BEGIN,t)},e.onInterruptionEnd=function(t){this._eventTarget.on(n4.INTERRUPTION_END,t)},e.offInterruptionEnd=function(t){this._eventTarget.off(n4.INTERRUPTION_END,t)},e.onEnded=function(t){this._eventTarget.on(n4.ENDED,t)},e.offEnded=function(t){this._eventTarget.off(n4.ENDED,t)},Q(t,[{key:"src",get:function(){return this._innerAudioContext?this._innerAudioContext.src:""}},{key:"type",get:function(){return i4.MINIGAME_AUDIO}},{key:"state",get:function(){return this._state}},{key:"loop",get:function(){return this._innerAudioContext.loop},set:function(t){this._innerAudioContext.loop=t}},{key:"volume",get:function(){return this._innerAudioContext.volume},set:function(t){t=_n(t),this._innerAudioContext.volume=t}},{key:"duration",get:function(){return this._innerAudioContext.duration}},{key:"currentTime",get:function(){return this._audioTimer?this._audioTimer.currentTime:0}}]),t}()).prototype,"seek",[l4],Object.getOwnPropertyDescriptor(h4.prototype,"seek"),h4.prototype),lt(h4.prototype,"play",[l4],Object.getOwnPropertyDescriptor(h4.prototype,"play"),h4.prototype),lt(h4.prototype,"pause",[l4],Object.getOwnPropertyDescriptor(h4.prototype,"pause"),h4.prototype),lt(h4.prototype,"stop",[l4],Object.getOwnPropertyDescriptor(h4.prototype,"stop"),h4.prototype),h4),A4=new(function(){function t(){this._audioBufferDataMap={}}var e=t.prototype;return e.addCache=function(t,e){this._audioBufferDataMap[t]?console.warn("Audio buffer "+t+" has been cached"):this._audioBufferDataMap[t]={usedCount:1,audioBuffer:e}},e.retainCache=function(t){var e=this._audioBufferDataMap[t];e?e.usedCount++:console.warn("Audio buffer cache "+t+" has not been added.")},e.getCache=function(t){var e=this._audioBufferDataMap[t];return null==e?void 0:e.audioBuffer},e.tryReleasingCache=function(t){var e=this._audioBufferDataMap[t];e?--e.usedCount<=0&&delete this._audioBufferDataMap[t]:console.warn("Audio buffer cache "+t+" has not been added.")},t}()),b4=null===(u4=dh.tt)||void 0===u4||null===(_4=u4.getAudioContext)||void 0===_4?void 0:_4.call(u4),C4=function(){function t(t,e,n){this._bufferSourceNode=void 0,this._onPlayCb=void 0,this._url=void 0,this._onEndCb=void 0,this._bufferSourceNode=b4.createBufferSource(),this._bufferSourceNode.buffer=t,this._bufferSourceNode.loop=!1,this._url=n;var i=b4.createGain();i.gain.value=e,this._bufferSourceNode.connect(i),i.connect(b4.destination)}var e=t.prototype;return e.play=function(){var t,e=this;this._bufferSourceNode.start(),null===(t=this.onPlay)||void 0===t||t.call(this),this._bufferSourceNode.onended=function(){var t;A4.tryReleasingCache(e._url),null===(t=e._onEndCb)||void 0===t||t.call(e)}},e.stop=function(){this._bufferSourceNode.onended=null,A4.tryReleasingCache(this._url),this._bufferSourceNode.stop(),this._bufferSourceNode.buffer=null},Q(t,[{key:"onPlay",get:function(){return this._onPlayCb},set:function(t){this._onPlayCb=t}},{key:"onEnd",get:function(){return this._onEndCb},set:function(t){this._onEndCb=t}}]),t}(),T4=(lt((f4=function(){function t(t,e){this._src=void 0,this._audioBuffer=void 0,this._sourceNode=void 0,this._gainNode=void 0,this._volume=1,this._loop=!1,this._state=r4.INIT,this._audioTimer=void 0,this._readyToHandleOnShow=!1,this._eventTarget=new uh,this._operationQueue=[],this._audioBuffer=t,this._audioTimer=new y4(t),this._gainNode=b4.createGain(),this._gainNode.connect(b4.destination),this._src=e,Lh.on("hide",this._onHide,this),Lh.on("show",this._onShow,this)}var e=t.prototype;return e.destroy=function(){this._audioTimer.destroy(),this._audioBuffer&&(this._audioBuffer=null),A4.tryReleasingCache(this._src),Lh.off("hide",this._onHide,this),Lh.off("show",this._onShow,this)},e._onHide=function(){var t=this;this._state===r4.PLAYING&&this.pause().then((function(){t._state=r4.INTERRUPTED,t._readyToHandleOnShow=!0,t._eventTarget.emit(n4.INTERRUPTION_BEGIN)})).catch((function(){}))},e._onShow=function(){var t=this;this._readyToHandleOnShow?(this._state===r4.INTERRUPTED&&this.play().then((function(){t._eventTarget.emit(n4.INTERRUPTION_END)})).catch((function(){})),this._readyToHandleOnShow=!1):this._eventTarget.once(n4.INTERRUPTION_BEGIN,this._onShow,this)},t.load=function(e){return new Promise((function(n){t.loadNative(e).then((function(i){n(new t(i,e))})).catch((function(){}))}))},t.loadNative=function(t){return new Promise((function(e,n){var i=A4.getCache(t);if(i)return A4.retainCache(t),void e(i);fsUtils.readArrayBuffer(t,(function(i,r){i?n(i):b4.decodeAudioData(r).then((function(n){A4.addCache(t,n),e(n)})).catch((function(){}))}))}))},t.loadOneShotAudio=function(e,n){return new Promise((function(i,r){t.loadNative(e).then((function(t){var r=new C4(t,n,e);i(r)})).catch(r)}))},e.seek=function(t){var e=this;return new Promise((function(n){e._audioTimer.seek(t),e._state===r4.PLAYING?e._doPlay().then(n).catch((function(){})):n()}))},e.play=function(){return this._doPlay()},e._doPlay=function(){var t=this;return new Promise((function(e){t._stopSourceNode(),t._sourceNode=b4.createBufferSource(),t._sourceNode.buffer=t._audioBuffer,t._sourceNode.loop=t._loop,t._sourceNode.connect(t._gainNode),t._sourceNode.start(0,t._audioTimer.currentTime),t._state=r4.PLAYING,t._audioTimer.start(),t._sourceNode.onended=function(){t._audioTimer.stop(),t._eventTarget.emit(n4.ENDED),t._state=r4.INIT},e()}))},e._stopSourceNode=function(){try{this._sourceNode&&(this._sourceNode.onended=null,this._sourceNode.stop(),this._sourceNode.buffer=null)}catch(t){}},e.pause=function(){return this._state===r4.PLAYING&&this._sourceNode?(this._audioTimer.pause(),this._state=r4.PAUSED,this._stopSourceNode(),Promise.resolve()):Promise.resolve()},e.stop=function(){return this._sourceNode?(this._audioTimer.stop(),this._state=r4.STOPPED,this._stopSourceNode(),Promise.resolve()):Promise.resolve()},e.onInterruptionBegin=function(t){this._eventTarget.on(n4.INTERRUPTION_BEGIN,t)},e.offInterruptionBegin=function(t){this._eventTarget.off(n4.INTERRUPTION_BEGIN,t)},e.onInterruptionEnd=function(t){this._eventTarget.on(n4.INTERRUPTION_END,t)},e.offInterruptionEnd=function(t){this._eventTarget.off(n4.INTERRUPTION_END,t)},e.onEnded=function(t){this._eventTarget.on(n4.ENDED,t)},e.offEnded=function(t){this._eventTarget.off(n4.ENDED,t)},Q(t,[{key:"src",get:function(){return this._src}},{key:"type",get:function(){return i4.WEB_AUDIO}},{key:"state",get:function(){return this._state}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._sourceNode&&(this._sourceNode.loop=t)}},{key:"volume",get:function(){return this._volume},set:function(t){t=_n(t),this._volume=t,this._gainNode.gain.value=t}},{key:"duration",get:function(){return this._audioBuffer.duration}},{key:"currentTime",get:function(){return this._audioTimer.currentTime}}]),t}()).prototype,"seek",[l4],Object.getOwnPropertyDescriptor(f4.prototype,"seek"),f4.prototype),lt(f4.prototype,"play",[l4],Object.getOwnPropertyDescriptor(f4.prototype,"play"),f4.prototype),lt(f4.prototype,"pause",[l4],Object.getOwnPropertyDescriptor(f4.prototype,"pause"),f4.prototype),lt(f4.prototype,"stop",[l4],Object.getOwnPropertyDescriptor(f4.prototype,"stop"),f4.prototype),f4),E4=function(){function t(t){this._audio=void 0,this._audio=t}var e=t.prototype;return e.play=function(){this._audio.play()},e.stop=function(){this._audio.stop()},Q(t,[{key:"onPlay",get:function(){return this._audio.onPlay},set:function(t){this._audio.onPlay=t}},{key:"onEnd",get:function(){return this._audio.onEnd},set:function(t){this._audio.onEnd=t}}]),t}(),w4=function(){function t(t){this._player=void 0,this._player=t}t.load=function(e){return new Promise((function(n){"object"==typeof dh.tt&&void 0!==dh.tt.getAudioContext?T4.load(e).then((function(e){n(new t(e))})).catch((function(){})):S4.load(e).then((function(e){n(new t(e))})).catch((function(){}))}))};var e=t.prototype;return e.destroy=function(){this._player.destroy()},t.loadNative=function(t){return"object"==typeof dh.tt&&void 0!==dh.tt.getAudioContext?T4.loadNative(t):S4.loadNative(t)},t.loadOneShotAudio=function(t,e){return new Promise((function(n,i){"object"==typeof dh.tt&&void 0!==dh.tt.getAudioContext?T4.loadOneShotAudio(t,e).then((function(t){n(new E4(t))})).catch(i):S4.loadOneShotAudio(t,e).then((function(t){n(new E4(t))})).catch(i)}))},e.seek=function(t){return this._player.seek(t)},e.play=function(){return this._player.play()},e.pause=function(){return this._player.pause()},e.stop=function(){return this._player.stop()},e.onInterruptionBegin=function(t){this._player.onInterruptionBegin(t)},e.offInterruptionBegin=function(t){this._player.offInterruptionBegin(t)},e.onInterruptionEnd=function(t){this._player.onInterruptionEnd(t)},e.offInterruptionEnd=function(t){this._player.offInterruptionEnd(t)},e.onEnded=function(t){this._player.onEnded(t)},e.offEnded=function(t){this._player.offEnded(t)},Q(t,[{key:"src",get:function(){return this._player.src}},{key:"type",get:function(){return this._player.type}},{key:"state",get:function(){return this._player.state}},{key:"loop",get:function(){return this._player.loop},set:function(t){this._player.loop=t}},{key:"volume",get:function(){return this._player.volume},set:function(t){this._player.volume=t}},{key:"duration",get:function(){return this._player.duration}},{key:"currentTime",get:function(){return this._player.currentTime}}]),t}();w4.maxAudioChannel=10,h.AudioPlayer=w4;var I4=t("AudioClip",Ec("cc.AudioClip")((g4=v4=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_duration",m4,at(e)),e._loadMode=i4.UNKNOWN_AUDIO,e._meta=null,e._player=null,e}$(e,t);var n=e.prototype;return n.destroy=function(){var e,n=t.prototype.destroy.call(this);return null===(e=this._player)||void 0===e||e.destroy(),this._player=null,this._meta&&(this._meta.player=null),n},n.validate=function(){return!!this._meta},n.getDuration=function(){return this._duration?this._duration:this._meta?this._meta.duration:0},n.getCurrentTime=function(){return this._player?this._player.currentTime:0},n.getVolume=function(){return this._player?this._player.volume:0},n.getLoop=function(){return!!this._player&&this._player.loop},n.setCurrentTime=function(t){var e;null===(e=this._player)||void 0===e||e.seek(t).catch((function(){}))},n.setVolume=function(t){this._player&&(this._player.volume=t)},n.setLoop=function(t){this._player&&(this._player.loop=t)},n.play=function(){var t;null===(t=this._player)||void 0===t||t.play().catch((function(){}))},n.pause=function(){var t;null===(t=this._player)||void 0===t||t.pause().catch((function(){}))},n.stop=function(){var t;null===(t=this._player)||void 0===t||t.stop().catch((function(){}))},n.playOneShot=function(t){void 0===t&&(t=1),this._nativeAsset&&w4.loadOneShotAudio(this._nativeAsset.url,t).then((function(t){t.play()})).catch((function(){}))},Q(e,[{key:"_nativeAsset",get:function(){return this._meta},set:function(t){this._meta=t,t?(this._loadMode=t.type,this._player=t.player):(this._meta=null,this._loadMode=i4.UNKNOWN_AUDIO,this._duration=0)}},{key:"_nativeDep",get:function(){return{uuid:this._uuid,audioLoadMode:this.loadMode,ext:this._native,__isNative__:!0}}},{key:"loadMode",get:function(){return this._loadMode}},{key:"state",get:function(){return this._player?this._player.state:r4.INIT}}]),e}($h),v4.AudioType=i4,m4=lt((p4=g4).prototype,"_duration",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),lt(p4.prototype,"_nativeDep",[hl],Object.getOwnPropertyDescriptor(p4.prototype,"_nativeDep"),p4.prototype),d4=p4))||d4);function P4(t,e,n){w4.load(t,{audioLoadMode:e.audioLoadMode}).then((function(e){var i={player:e,url:t,duration:e.duration,type:e.type};n(null,i)})).catch((function(t){n(t)}))}function D4(t,e,n,i){var r=new I4;r._nativeUrl=t,r._nativeAsset=e,r._duration=e.duration,i(null,r)}h.AudioClip=I4,pN.register({".mp3":P4,".ogg":P4,".wav":P4,".m4a":P4}),AN.register({".mp3":D4,".ogg":D4,".wav":D4,".m4a":D4});var R4,M4,O4,N4,B4,L4,F4,V4,z4,k4,U4,G4,H4,j4,W4,q4,X4,Y4,K4,J4=new(function(){function t(){this._oneShotAudioInfoList=[],this._audioPlayerInfoList=[]}var e=t.prototype;return e._findIndex=function(t,e){return t.findIndex((function(t){return t.audio===e}))},e._tryAddPlaying=function(t,e){var n=this._findIndex(t,e);return n>-1?(t[n].playTime=performance.now(),!1):(t.push({audio:e,playTime:performance.now()}),!0)},e.addPlaying=function(t){if(t instanceof w4){if(this._tryAddPlaying(this._audioPlayerInfoList,t))return}else this._tryAddPlaying(this._oneShotAudioInfoList,t)},e._tryRemovePlaying=function(t,e){var n=this._findIndex(t,e);return-1!==n&&(_t(t,n),!0)},e.removePlaying=function(t){if(t instanceof w4){if(this._tryRemovePlaying(this._audioPlayerInfoList,t))return}else this._tryRemovePlaying(this._oneShotAudioInfoList,t)},e.discardOnePlayingIfNeeded=function(){var t;this._audioPlayerInfoList.length+this._oneShotAudioInfoList.length<w4.maxAudioChannel||(this._oneShotAudioInfoList.length>0?this._oneShotAudioInfoList.forEach((function(e){(!t||e.playTime<t.playTime)&&(t=e)})):this._audioPlayerInfoList.forEach((function(e){(!t||e.playTime<t.playTime)&&(t=e)})),t&&(t.audio.stop(),this.removePlaying(t.audio)))},t}());!function(t){t.STARTED="started",t.ENDED="ended"}(K4||(K4={}));var Q4=function(e){return t({AudioSource:e,AudioSourceComponent:e}),e}((R4=Ec("cc.AudioSource"),M4=jc(),O4=kc(),N4=cl(I4),B4=cl(I4),L4=Kc(),F4=Kc(),V4=Kc(),z4=Jc(),k4=Kc(),R4(U4=M4(U4=O4((Y4=X4=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_clip",H4,at(e)),e._player=null,ct(e,"_loop",j4,at(e)),ct(e,"_playOnAwake",W4,at(e)),ct(e,"_volume",q4,at(e)),e._cachedCurrentTime=0,e._operationsBeforeLoading=[],e._isLoaded=!1,e._lastSetClip=null,e}$(e,t);var n=e.prototype;return n._syncPlayer=function(){var t=this,e=this._clip;this._isLoaded=!1,this._lastSetClip!==e&&(e?e._nativeAsset?(this._lastSetClip=e,w4.load(e._nativeAsset.url,{audioLoadMode:e.loadMode}).then((function(n){t._lastSetClip===e?(t._isLoaded=!0,t._player&&(J4.removePlaying(t._player),t._player.offEnded(),t._player.offInterruptionBegin(),t._player.offInterruptionEnd(),t._player.destroy()),t._player=n,n.onEnded((function(){J4.removePlaying(n),t.node.emit(K4.ENDED,t)})),n.onInterruptionBegin((function(){J4.removePlaying(n)})),n.onInterruptionEnd((function(){J4.addPlaying(n)})),t._syncStates()):n.destroy()})).catch((function(){}))):console.error("Invalid audio clip"):this._lastSetClip=null)},n.onLoad=function(){this._syncPlayer()},n.onEnable=function(){this._playOnAwake&&!this.playing&&this.play()},n.onDisable=function(){var t=this._getRootNode();(null==t?void 0:t._persistNode)||this.pause()},n.onDestroy=function(){var t;this.stop(),null===(t=this._player)||void 0===t||t.destroy(),this._player=null},n._getRootNode=function(){for(var t,e,n=this.node,i=null===(t=n)||void 0===t||null===(e=t.parent)||void 0===e?void 0:e.parent;i;){var r,a,o;i=null===(a=n=null===(r=n)||void 0===r?void 0:r.parent)||void 0===a||null===(o=a.parent)||void 0===o?void 0:o.parent}return n},n.play=function(){var t,e,n=this;this._isLoaded?(J4.discardOnePlayingIfNeeded(),this.state===r4.PLAYING&&(null===(e=this._player)||void 0===e||e.stop().catch((function(){}))),null===(t=this._player)||void 0===t||t.play().then((function(){J4.addPlaying(n._player),n.node.emit(K4.STARTED,n)})).catch((function(){}))):this._operationsBeforeLoading.push("play")},n.pause=function(){var t,e=this;this._isLoaded?null===(t=this._player)||void 0===t||t.pause().then((function(){J4.removePlaying(e._player)})).catch((function(){})):this._operationsBeforeLoading.push("pause")},n.stop=function(){var t,e=this;this._isLoaded?null===(t=this._player)||void 0===t||t.stop().then((function(){J4.removePlaying(e._player)})).catch((function(){})):this._operationsBeforeLoading.push("stop")},n.playOneShot=function(t,e){void 0===e&&(e=1),t._nativeAsset?w4.loadOneShotAudio(t._nativeAsset.url,this._volume*e,{audioLoadMode:t.loadMode}).then((function(t){J4.discardOnePlayingIfNeeded(),t.onPlay=function(){J4.addPlaying(t)},t.onEnd=function(){J4.removePlaying(t)},t.play()})).catch((function(){})):console.error("Invalid audio clip")},n._syncStates=function(){var t=this;this._player&&this._player.seek(this._cachedCurrentTime).then((function(){t._player&&(t._player.loop=t._loop,t._player.volume=t._volume,t._operationsBeforeLoading.forEach((function(e){var n;null===(n=t[e])||void 0===n||n.call(t)})),t._operationsBeforeLoading.length=0)})).catch((function(){}))},Q(e,[{key:"clip",get:function(){return this._clip},set:function(t){t!==this._clip&&(this._clip=t,this._syncPlayer())}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._player&&(this._player.loop=t)}},{key:"playOnAwake",get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}},{key:"volume",get:function(){return this._volume},set:function(t){Number.isNaN(t)?console.warn("illegal audio volume!"):(t=un(t,0,1),this._player?(this._player.volume=t,this._volume=this._player.volume):this._volume=t)}},{key:"currentTime",get:function(){return this._player?this._player.currentTime:this._cachedCurrentTime},set:function(t){var e;Number.isNaN(t)?console.warn("illegal audio time!"):(t=un(t,0,this.duration),this._cachedCurrentTime=t,null===(e=this._player)||void 0===e||e.seek(this._cachedCurrentTime).catch((function(){})))}},{key:"duration",get:function(){var t,e;return null!==(t=null===(e=this._clip)||void 0===e?void 0:e.getDuration())&&void 0!==t?t:this._player?this._player.duration:0}},{key:"state",get:function(){return this._player?this._player.state:r4.INIT}},{key:"playing",get:function(){return this.state===e.AudioState.PLAYING}}],[{key:"maxAudioChannel",get:function(){return w4.maxAudioChannel}}]),e}(xu),X4.AudioState=r4,X4.EventType=K4,H4=lt((G4=Y4).prototype,"_clip",[N4],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j4=lt(G4.prototype,"_loop",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),W4=lt(G4.prototype,"_playOnAwake",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),q4=lt(G4.prototype,"_volume",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),lt(G4.prototype,"clip",[B4,L4],Object.getOwnPropertyDescriptor(G4.prototype,"clip"),G4.prototype),lt(G4.prototype,"loop",[F4],Object.getOwnPropertyDescriptor(G4.prototype,"loop"),G4.prototype),lt(G4.prototype,"playOnAwake",[V4],Object.getOwnPropertyDescriptor(G4.prototype,"playOnAwake"),G4.prototype),lt(G4.prototype,"volume",[z4,k4],Object.getOwnPropertyDescriptor(G4.prototype,"volume"),G4.prototype),U4=G4))||U4)||U4)||U4));k(I4,"AudioClip",[{name:"PlayingState",newName:"AudioState",target:Q4,targetName:"AudioSource"}]),G(I4.prototype,"AudioClip.prototype",["state","play","pause","stop","playOneShot","setCurrentTime","setVolume","setLoop","getCurrentTime","getVolume","getLoop"].map((function(t){return{name:t,suggest:"please use AudioSource.prototype."+t+" instead"}}))),h.AudioSourceComponent=Q4,re.setClassAlias(Q4,"cc.AudioSourceComponent"),h.log=x,h.warn=S,h.error=A,h.assert=b,h._throw=E,h.logID=P,h.warnID=R,h.errorID=O,h.assertID=L,h.debug=q,h.path={join:kh,extname:Uh,mainFileName:Gh,basename:Hh,dirname:jh,changeExtname:Wh,changeBasename:qh,_normalize:Xh,stripSep:Yh,get sep(){return Kh()}};var Z4=t("NodePool",function(){function t(t){this.poolHandlerComp=void 0,this._pool=void 0,this.poolHandlerComp=t,this._pool=[]}var e=t.prototype;return e.size=function(){return this._pool.length},e.clear=function(){for(var t=this._pool.length,e=0;e<t;++e)this._pool[e].destroy();this._pool.length=0},e.put=function(t){if(t&&-1===this._pool.indexOf(t)){t.removeFromParent();var e=this.poolHandlerComp?t.getComponent(this.poolHandlerComp):null;e&&e.unuse&&e.unuse(),this._pool.push(t)}},e.get=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var i=this._pool.length-1;if(i<0)return null;var r=this._pool[i];this._pool.length=i;var a=this.poolHandlerComp?r.getComponent(this.poolHandlerComp):null;return a&&a.reuse&&a.reuse(arguments),r},t}());h.NodePool=Z4,h.renderer=hx;var $4=Object.setPrototypeOf,t3={};t3||(t3={}),function(t){var e=function(){function e(n){this._clock=new t.WorldClock,this._events=[],this._objects=[],this._eventManager=null,this._eventManager=n,console.info("DragonBones: "+e.VERSION+"\nWebsite: http://dragonbones.com/\nSource and Demo: https://github.com/DragonBones/")}return e.prototype.advanceTime=function(e){if(this._objects.length>0){for(var n=0,i=this._objects;n<i.length;n++)i[n].returnToPool();this._objects.length=0}if(this._clock.advanceTime(e),this._events.length>0){for(var r=0;r<this._events.length;++r){var a=this._events[r],o=a.armature;null!==o._armatureData&&(o.eventDispatcher.dispatchDBEvent(a.type,a),a.type===t.EventObject.SOUND_EVENT&&this._eventManager.dispatchDBEvent(a.type,a)),this.bufferObject(a)}this._events.length=0}},e.prototype.bufferEvent=function(t){this._events.indexOf(t)<0&&this._events.push(t)},e.prototype.bufferObject=function(t){this._objects.indexOf(t)<0&&this._objects.push(t)},Object.defineProperty(e.prototype,"clock",{get:function(){return this._clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"eventManager",{get:function(){return this._eventManager},enumerable:!0,configurable:!0}),e.VERSION="5.6.300",e.yDown=!1,e.debug=!1,e.debugDraw=!1,e.webAssembly=!1,e}();t.DragonBones=e}(t3||(t3={})),console.warn||(console.warn=function(){}),console.assert||(console.assert=function(){}),Date.now||(Date.now=function(){return(new Date).getTime()}),$4=function(t,e){function n(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);n.prototype=e.prototype,t.prototype=new n},function(t){var e=function(){function t(){this.hashCode=t._hashCode++,this._isInPool=!1}return t._returnObject=function(e){var n=String(e.constructor),i=n in t._maxCountMap?t._maxCountMap[n]:t._defaultMaxCount,r=t._poolsMap[n]=t._poolsMap[n]||[];r.length<i&&(e._isInPool?console.warn("The object is already in the pool."):(e._isInPool=!0,r.push(e)))},t.toString=function(){throw new Error},t.setMaxCount=function(e,n){if((n<0||n!=n)&&(n=0),null!==e)null!==(r=(i=String(e))in t._poolsMap?t._poolsMap[i]:null)&&r.length>n&&(r.length=n),t._maxCountMap[i]=n;else for(var i in t._defaultMaxCount=n,t._poolsMap){var r;(r=t._poolsMap[i]).length>n&&(r.length=n),i in t._maxCountMap&&(t._maxCountMap[i]=n)}},t.clearPool=function(e){if(void 0===e&&(e=null),null!==e){var n=String(e);null!==(r=n in t._poolsMap?t._poolsMap[n]:null)&&r.length>0&&(r.length=0)}else for(var i in t._poolsMap){var r;(r=t._poolsMap[i]).length=0}},t.borrowObject=function(e){var n=String(e),i=n in t._poolsMap?t._poolsMap[n]:null;if(null!==i&&i.length>0){var r=i.pop();return r._isInPool=!1,r}var a=new e;return a._onClear(),a},t.prototype.returnToPool=function(){this._onClear(),t._returnObject(this)},t._hashCode=0,t._defaultMaxCount=3e3,t._maxCountMap={},t._poolsMap={},t}();t.BaseObject=e}(t3||(t3={})),function(t){var e=function(){function t(t,e,n,i,r,a){void 0===t&&(t=1),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=1),void 0===r&&(r=0),void 0===a&&(a=0),this.a=t,this.b=e,this.c=n,this.d=i,this.tx=r,this.ty=a}return t.prototype.toString=function(){return"[object dragonBones.Matrix] a:"+this.a+" b:"+this.b+" c:"+this.c+" d:"+this.d+" tx:"+this.tx+" ty:"+this.ty},t.prototype.copyFrom=function(t){return this.a=t.a,this.b=t.b,this.c=t.c,this.d=t.d,this.tx=t.tx,this.ty=t.ty,this},t.prototype.copyFromArray=function(t,e){return void 0===e&&(e=0),this.a=t[e],this.b=t[e+1],this.c=t[e+2],this.d=t[e+3],this.tx=t[e+4],this.ty=t[e+5],this},t.prototype.identity=function(){return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this},t.prototype.concat=function(t){var e=this.a*t.a,n=0,i=0,r=this.d*t.d,a=this.tx*t.a+t.tx,o=this.ty*t.d+t.ty;return 0===this.b&&0===this.c||(e+=this.b*t.c,n+=this.b*t.d,i+=this.c*t.a,r+=this.c*t.b),0===t.b&&0===t.c||(n+=this.a*t.b,i+=this.d*t.c,a+=this.ty*t.c,o+=this.tx*t.b),this.a=e,this.b=n,this.c=i,this.d=r,this.tx=a,this.ty=o,this},t.prototype.invert=function(){var t=this.a,e=this.b,n=this.c,i=this.d,r=this.tx,a=this.ty;if(0===e&&0===n)return this.b=this.c=0,0===t||0===i?this.a=this.b=this.tx=this.ty=0:(t=this.a=1/t,i=this.d=1/i,this.tx=-t*r,this.ty=-i*a),this;var o=t*i-e*n;if(0===o)return this.a=this.d=1,this.b=this.c=0,this.tx=this.ty=0,this;o=1/o;var s=this.a=i*o;return e=this.b=-e*o,n=this.c=-n*o,i=this.d=t*o,this.tx=-(s*r+n*a),this.ty=-(e*r+i*a),this},t.prototype.transformPoint=function(t,e,n,i){void 0===i&&(i=!1),n.x=this.a*t+this.c*e,n.y=this.b*t+this.d*e,i||(n.x+=this.tx,n.y+=this.ty)},t.prototype.transformRectangle=function(t,e){void 0===e&&(e=!1);var n=this.a,i=this.b,r=this.c,a=this.d,o=e?0:this.tx,s=e?0:this.ty,c=t.x,l=t.y,h=c+t.width,u=l+t.height,_=n*c+r*l+o,f=i*c+a*l+s,d=n*h+r*l+o,p=i*h+a*l+s,m=n*h+r*u+o,v=i*h+a*u+s,g=n*c+r*u+o,y=i*c+a*u+s,x=0;_>d&&(x=_,_=d,d=x),m>g&&(x=m,m=g,g=x),t.x=Math.floor(_<m?_:m),t.width=Math.ceil((d>g?d:g)-t.x),f>p&&(x=f,f=p,p=x),v>y&&(x=v,v=y,y=x),t.y=Math.floor(f<v?f:v),t.height=Math.ceil((p>y?p:y)-t.y)},t}();t.Matrix=e}(t3||(t3={})),function(t){var e=function(){function t(t,e,n,i,r,a){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),void 0===r&&(r=1),void 0===a&&(a=1),this.x=t,this.y=e,this.skew=n,this.rotation=i,this.scaleX=r,this.scaleY=a}return t.normalizeRadian=function(t){return(t=(t+Math.PI)%(2*Math.PI))+(t>0?-Math.PI:Math.PI)},t.prototype.toString=function(){return"[object dragonBones.Transform] x:"+this.x+" y:"+this.y+" skewX:"+180*this.skew/Math.PI+" skewY:"+180*this.rotation/Math.PI+" scaleX:"+this.scaleX+" scaleY:"+this.scaleY},t.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.skew=t.skew,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this},t.prototype.identity=function(){return this.x=this.y=0,this.skew=this.rotation=0,this.scaleX=this.scaleY=1,this},t.prototype.add=function(t){return this.x+=t.x,this.y+=t.y,this.skew+=t.skew,this.rotation+=t.rotation,this.scaleX*=t.scaleX,this.scaleY*=t.scaleY,this},t.prototype.minus=function(t){return this.x-=t.x,this.y-=t.y,this.skew-=t.skew,this.rotation-=t.rotation,this.scaleX/=t.scaleX,this.scaleY/=t.scaleY,this},t.prototype.fromMatrix=function(e){var n=this.scaleX,i=this.scaleY,r=t.PI_Q;this.x=e.tx,this.y=e.ty,this.rotation=Math.atan(e.b/e.a);var a=Math.atan(-e.c/e.d);return this.scaleX=this.rotation>-r&&this.rotation<r?e.a/Math.cos(this.rotation):e.b/Math.sin(this.rotation),this.scaleY=a>-r&&a<r?e.d/Math.cos(a):-e.c/Math.sin(a),n>=0&&this.scaleX<0&&(this.scaleX=-this.scaleX,this.rotation=this.rotation-Math.PI),i>=0&&this.scaleY<0&&(this.scaleY=-this.scaleY,a-=Math.PI),this.skew=a-this.rotation,this},t.prototype.toMatrix=function(t){return 0===this.rotation?(t.a=1,t.b=0):(t.a=Math.cos(this.rotation),t.b=Math.sin(this.rotation)),0===this.skew?(t.c=-t.b,t.d=t.a):(t.c=-Math.sin(this.skew+this.rotation),t.d=Math.cos(this.skew+this.rotation)),1!==this.scaleX&&(t.a*=this.scaleX,t.b*=this.scaleX),1!==this.scaleY&&(t.c*=this.scaleY,t.d*=this.scaleY),t.tx=this.x,t.ty=this.y,this},t.PI=Math.PI,t.PI_D=2*Math.PI,t.PI_H=Math.PI/2,t.PI_Q=Math.PI/4,t.RAD_DEG=180/Math.PI,t.DEG_RAD=Math.PI/180,t}();t.Transform=e}(t3||(t3={})),function(t){var e=function(){function t(t,e,n,i,r,a,o,s){void 0===t&&(t=1),void 0===e&&(e=1),void 0===n&&(n=1),void 0===i&&(i=1),void 0===r&&(r=0),void 0===a&&(a=0),void 0===o&&(o=0),void 0===s&&(s=0),this.alphaMultiplier=t,this.redMultiplier=e,this.greenMultiplier=n,this.blueMultiplier=i,this.alphaOffset=r,this.redOffset=a,this.greenOffset=o,this.blueOffset=s}return t.prototype.copyFrom=function(t){this.alphaMultiplier=t.alphaMultiplier,this.redMultiplier=t.redMultiplier,this.greenMultiplier=t.greenMultiplier,this.blueMultiplier=t.blueMultiplier,this.alphaOffset=t.alphaOffset,this.redOffset=t.redOffset,this.greenOffset=t.greenOffset,this.blueOffset=t.blueOffset},t.prototype.identity=function(){this.alphaMultiplier=this.redMultiplier=this.greenMultiplier=this.blueMultiplier=1,this.alphaOffset=this.redOffset=this.greenOffset=this.blueOffset=0},t}();t.ColorTransform=e}(t3||(t3={})),function(t){var e=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y},t.prototype.clear=function(){this.x=this.y=0},t}();t.Point=e}(t3||(t3={})),function(t){var e=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.x=t,this.y=e,this.width=n,this.height=i}return t.prototype.copyFrom=function(t){this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height},t.prototype.clear=function(){this.x=this.y=0,this.width=this.height=0},t}();t.Rectangle=e}(t3||(t3={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.ints=[],e.floats=[],e.strings=[],e}return $4(e,t),e.toString=function(){return"[class dragonBones.UserData]"},e.prototype._onClear=function(){this.ints.length=0,this.floats.length=0,this.strings.length=0},e.prototype.addInt=function(t){this.ints.push(t)},e.prototype.addFloat=function(t){this.floats.push(t)},e.prototype.addString=function(t){this.strings.push(t)},e.prototype.getInt=function(t){return void 0===t&&(t=0),t>=0&&t<this.ints.length?this.ints[t]:0},e.prototype.getFloat=function(t){return void 0===t&&(t=0),t>=0&&t<this.floats.length?this.floats[t]:0},e.prototype.getString=function(t){return void 0===t&&(t=0),t>=0&&t<this.strings.length?this.strings[t]:""},e}(t.BaseObject);t.UserData=e;var n=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.data=null,e}return $4(e,t),e.toString=function(){return"[class dragonBones.ActionData]"},e.prototype._onClear=function(){null!==this.data&&this.data.returnToPool(),this.type=0,this.name="",this.bone=null,this.slot=null,this.data=null},e}(t.BaseObject);t.ActionData=n}(t3||(t3={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.frameIndices=[],e.cachedFrames=[],e.armatureNames=[],e.armatures={},e.userData=null,e}return $4(e,t),e.toString=function(){return"[class dragonBones.DragonBonesData]"},e.prototype._onClear=function(){for(var t in this.armatures)this.armatures[t].returnToPool(),delete this.armatures[t];null!==this.userData&&this.userData.returnToPool(),this.autoSearch=!1,this.frameRate=0,this.version="",this.name="",this.stage=null,this.frameIndices.length=0,this.cachedFrames.length=0,this.armatureNames.length=0,this.binary=null,this.intArray=null,this.floatArray=null,this.frameIntArray=null,this.frameFloatArray=null,this.frameArray=null,this.timelineArray=null,this.userData=null},e.prototype.addArmature=function(t){t.name in this.armatures?console.warn("Same armature: "+t.name):(t.parent=this,this.armatures[t.name]=t,this.armatureNames.push(t.name))},e.prototype.getArmature=function(t){return t in this.armatures?this.armatures[t]:null},e.prototype.dispose=function(){console.warn(""),this.returnToPool()},e}(t.BaseObject);t.DragonBonesData=e}(t3||(t3={})),function(t){var e=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.aabb=new t.Rectangle,n.animationNames=[],n.sortedBones=[],n.sortedSlots=[],n.defaultActions=[],n.actions=[],n.bones={},n.slots={},n.constraints={},n.skins={},n.animations={},n.canvas=null,n.userData=null,n}return $4(n,e),n.toString=function(){return"[class dragonBones.ArmatureData]"},n.prototype._onClear=function(){for(var t=0,e=this.defaultActions;t<e.length;t++)e[t].returnToPool();for(var n=0,i=this.actions;n<i.length;n++)i[n].returnToPool();for(var r in this.bones)this.bones[r].returnToPool(),delete this.bones[r];for(var r in this.slots)this.slots[r].returnToPool(),delete this.slots[r];for(var r in this.constraints)this.constraints[r].returnToPool(),delete this.constraints[r];for(var r in this.skins)this.skins[r].returnToPool(),delete this.skins[r];for(var r in this.animations)this.animations[r].returnToPool(),delete this.animations[r];null!==this.canvas&&this.canvas.returnToPool(),null!==this.userData&&this.userData.returnToPool(),this.type=0,this.frameRate=0,this.cacheFrameRate=0,this.scale=1,this.name="",this.aabb.clear(),this.animationNames.length=0,this.sortedBones.length=0,this.sortedSlots.length=0,this.defaultActions.length=0,this.actions.length=0,this.defaultSkin=null,this.defaultAnimation=null,this.canvas=null,this.userData=null,this.parent=null},n.prototype.sortBones=function(){var t=this.sortedBones.length;if(!(t<=0)){var e=this.sortedBones.concat(),n=0,i=0;for(this.sortedBones.length=0;i<t;){var r=e[n++];if(n>=t&&(n=0),!(this.sortedBones.indexOf(r)>=0)){var a=!1;for(var o in this.constraints){var s=this.constraints[o];if(s.root===r&&this.sortedBones.indexOf(s.target)<0){a=!0;break}}a||null!==r.parent&&this.sortedBones.indexOf(r.parent)<0||(this.sortedBones.push(r),i++)}}}},n.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0))for(var e in this.cacheFrameRate=t,this.animations)this.animations[e].cacheFrames(this.cacheFrameRate)},n.prototype.setCacheFrame=function(t,e){var n=this.parent.cachedFrames,i=n.length;return n.length+=10,n[i]=t.a,n[i+1]=t.b,n[i+2]=t.c,n[i+3]=t.d,n[i+4]=t.tx,n[i+5]=t.ty,n[i+6]=e.rotation,n[i+7]=e.skew,n[i+8]=e.scaleX,n[i+9]=e.scaleY,i},n.prototype.getCacheFrame=function(t,e,n){var i=this.parent.cachedFrames;t.a=i[n],t.b=i[n+1],t.c=i[n+2],t.d=i[n+3],t.tx=i[n+4],t.ty=i[n+5],e.rotation=i[n+6],e.skew=i[n+7],e.scaleX=i[n+8],e.scaleY=i[n+9],e.x=t.tx,e.y=t.ty},n.prototype.addBone=function(t){t.name in this.bones?console.warn("Same bone: "+t.name):(this.bones[t.name]=t,this.sortedBones.push(t))},n.prototype.addSlot=function(t){t.name in this.slots?console.warn("Same slot: "+t.name):(this.slots[t.name]=t,this.sortedSlots.push(t))},n.prototype.addConstraint=function(t){t.name in this.constraints?console.warn("Same constraint: "+t.name):this.constraints[t.name]=t},n.prototype.addSkin=function(t){t.name in this.skins?console.warn("Same skin: "+t.name):(t.parent=this,this.skins[t.name]=t,null===this.defaultSkin&&(this.defaultSkin=t),"default"===t.name&&(this.defaultSkin=t))},n.prototype.addAnimation=function(t){t.name in this.animations?console.warn("Same animation: "+t.name):(t.parent=this,this.animations[t.name]=t,this.animationNames.push(t.name),null===this.defaultAnimation&&(this.defaultAnimation=t))},n.prototype.addAction=function(t,e){e?this.defaultActions.push(t):this.actions.push(t)},n.prototype.getBone=function(t){return t in this.bones?this.bones[t]:null},n.prototype.getSlot=function(t){return t in this.slots?this.slots[t]:null},n.prototype.getConstraint=function(t){return t in this.constraints?this.constraints[t]:null},n.prototype.getSkin=function(t){return t in this.skins?this.skins[t]:null},n.prototype.getMesh=function(t,e,n){var i=this.getSkin(t);return null===i?null:i.getDisplay(e,n)},n.prototype.getAnimation=function(t){return t in this.animations?this.animations[t]:null},n}(t.BaseObject);t.ArmatureData=e;var n=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.transform=new t.Transform,n.userData=null,n}return $4(n,e),n.toString=function(){return"[class dragonBones.BoneData]"},n.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.inheritTranslation=!1,this.inheritRotation=!1,this.inheritScale=!1,this.inheritReflection=!1,this.type=0,this.length=0,this.name="",this.transform.identity(),this.userData=null,this.parent=null},n}(t.BaseObject);t.BoneData=n;var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e}return $4(e,t),e.toString=function(){return"[class dragonBones.SurfaceData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=1,this.segmentX=0,this.segmentY=0,this.vertices.length=0},e}(n);t.SurfaceData=i;var r=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=null,t.userData=null,t}return $4(n,e),n.createColor=function(){return new t.ColorTransform},n.toString=function(){return"[class dragonBones.SlotData]"},n.prototype._onClear=function(){null!==this.userData&&this.userData.returnToPool(),this.blendMode=0,this.displayIndex=0,this.zOrder=0,this.name="",this.color=null,this.userData=null,this.parent=null},n.DEFAULT_COLOR=new t.ColorTransform,n}(t.BaseObject);t.SlotData=r}(t3||(t3={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $4(e,t),e.prototype._onClear=function(){this.order=0,this.name="",this.type=0,this.target=null,this.root=null,this.bone=null},e}(t.BaseObject);t.ConstraintData=e;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $4(e,t),e.toString=function(){return"[class dragonBones.IKConstraintData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.scaleEnabled=!1,this.bendPositive=!1,this.weight=1},e}(e);t.IKConstraintData=n;var i=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return $4(e,t),e.toString=function(){return"[class dragonBones.PathConstraintData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.pathSlot=null,this.pathDisplayData=null,this.bones.length=0,this.positionMode=0,this.spacingMode=1,this.rotateMode=1,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=0,this.translateMix=0},e.prototype.AddBone=function(t){this.bones.push(t)},e}(e);t.PathConstraintData=i}(t3||(t3={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $4(e,t),e.toString=function(){return"[class dragonBones.CanvasData]"},e.prototype._onClear=function(){this.hasBackground=!1,this.color=0,this.x=0,this.y=0,this.width=0,this.height=0},e}(t.BaseObject);t.CanvasData=e}(t3||(t3={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.displays={},e}return $4(e,t),e.toString=function(){return"[class dragonBones.SkinData]"},e.prototype._onClear=function(){for(var t in this.displays){for(var e=0,n=this.displays[t];e<n.length;e++){var i=n[e];null!==i&&i.returnToPool()}delete this.displays[t]}this.name="",this.parent=null},e.prototype.addDisplay=function(t,e){t in this.displays||(this.displays[t]=[]),null!==e&&(e.parent=this),this.displays[t].push(e)},e.prototype.getDisplay=function(t,e){var n=this.getDisplays(t);if(null!==n)for(var i=0,r=n;i<r.length;i++){var a=r[i];if(null!==a&&a.name===e)return a}return null},e.prototype.getDisplays=function(t){return t in this.displays?this.displays[t]:null},e}(t.BaseObject);t.SkinData=e}(t3||(t3={})),function(t){var e=function(){function t(){this.weight=null}return t.prototype.clear=function(){this.isShared||null===this.weight||this.weight.returnToPool(),this.isShared=!1,this.inheritDeform=!1,this.offset=0,this.data=null,this.weight=null},t.prototype.shareFrom=function(t){this.isShared=!0,this.offset=t.offset,this.weight=t.weight},t}();t.VerticesData=e;var n=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.transform=new t.Transform,n}return $4(n,e),n.prototype._onClear=function(){this.name="",this.path="",this.transform.identity(),this.parent=null},n}(t.BaseObject);t.DisplayData=n;var i=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.pivot=new t.Point,n}return $4(n,e),n.toString=function(){return"[class dragonBones.ImageDisplayData]"},n.prototype._onClear=function(){e.prototype._onClear.call(this),this.type=0,this.pivot.clear(),this.texture=null},n}(n);t.ImageDisplayData=i;var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.actions=[],e}return $4(e,t),e.toString=function(){return"[class dragonBones.ArmatureDisplayData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this);for(var e=0,n=this.actions;e<n.length;e++)n[e].returnToPool();this.type=1,this.inheritAnimation=!1,this.actions.length=0,this.armature=null},e.prototype.addAction=function(t){this.actions.push(t)},e}(n);t.ArmatureDisplayData=r;var a=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.vertices=new e,n}return $4(n,t),n.toString=function(){return"[class dragonBones.MeshDisplayData]"},n.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.vertices.clear(),this.texture=null},n}(n);t.MeshDisplayData=a;var o=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boundingBox=null,e}return $4(e,t),e.toString=function(){return"[class dragonBones.BoundingBoxDisplayData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),null!==this.boundingBox&&this.boundingBox.returnToPool(),this.type=3,this.boundingBox=null},e}(n);t.BoundingBoxDisplayData=o;var s=function(t){function n(){var n=null!==t&&t.apply(this,arguments)||this;return n.vertices=new e,n.curveLengths=[],n}return $4(n,t),n.toString=function(){return"[class dragonBones.PathDisplayData]"},n.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=4,this.closed=!1,this.constantSpeed=!1,this.vertices.clear(),this.curveLengths.length=0},n}(n);t.PathDisplayData=s;var c=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.bones=[],e}return $4(e,t),e.toString=function(){return"[class dragonBones.WeightData]"},e.prototype._onClear=function(){this.count=0,this.offset=0,this.bones.length=0},e.prototype.addBone=function(t){this.bones.push(t)},e}(t.BaseObject);t.WeightData=c}(t3||(t3={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $4(e,t),e.prototype._onClear=function(){this.color=0,this.width=0,this.height=0},e}(t.BaseObject);t.BoundingBoxData=e;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $4(e,t),e.toString=function(){return"[class dragonBones.RectangleBoundingBoxData]"},e._computeOutCode=function(t,e,n,i,r,a){var o=0;return t<n?o|=1:t>r&&(o|=2),e<i?o|=4:e>a&&(o|=8),o},e.rectangleIntersectsSegment=function(t,n,i,r,a,o,s,c,l,h,u){void 0===l&&(l=null),void 0===h&&(h=null),void 0===u&&(u=null);var _=t>a&&t<s&&n>o&&n<c,f=i>a&&i<s&&r>o&&r<c;if(_&&f)return-1;for(var d=0,p=e._computeOutCode(t,n,a,o,s,c),m=e._computeOutCode(i,r,a,o,s,c);;){if(0==(p|m)){d=2;break}if(0!=(p&m))break;var v=0,g=0,y=0,x=0!==p?p:m;0!=(4&x)?(v=t+(i-t)*(o-n)/(r-n),g=o,null!==u&&(y=.5*-Math.PI)):0!=(8&x)?(v=t+(i-t)*(c-n)/(r-n),g=c,null!==u&&(y=.5*Math.PI)):0!=(2&x)?(g=n+(r-n)*(s-t)/(i-t),v=s,null!==u&&(y=0)):0!=(1&x)&&(g=n+(r-n)*(a-t)/(i-t),v=a,null!==u&&(y=Math.PI)),x===p?(t=v,n=g,p=e._computeOutCode(t,n,a,o,s,c),null!==u&&(u.x=y)):(i=v,r=g,m=e._computeOutCode(i,r,a,o,s,c),null!==u&&(u.y=y))}return d&&(_?(d=2,null!==l&&(l.x=i,l.y=r),null!==h&&(h.x=i,h.y=i),null!==u&&(u.x=u.y+Math.PI)):f?(d=1,null!==l&&(l.x=t,l.y=n),null!==h&&(h.x=t,h.y=n),null!==u&&(u.y=u.x+Math.PI)):(d=3,null!==l&&(l.x=t,l.y=n),null!==h&&(h.x=i,h.y=r))),d},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=0},e.prototype.containsPoint=function(t,e){var n=.5*this.width;if(t>=-n&&t<=n){var i=.5*this.height;if(e>=-i&&e<=i)return!0}return!1},e.prototype.intersectsSegment=function(t,n,i,r,a,o,s){void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null);var c=.5*this.width,l=.5*this.height;return e.rectangleIntersectsSegment(t,n,i,r,-c,-l,c,l,a,o,s)},e}(e);t.RectangleBoundingBoxData=n;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $4(e,t),e.toString=function(){return"[class dragonBones.EllipseData]"},e.ellipseIntersectsSegment=function(t,e,n,i,r,a,o,s,c,l,h){void 0===c&&(c=null),void 0===l&&(l=null),void 0===h&&(h=null);var u=o/s,_=u*u,f=n-t,d=(i*=u)-(e*=u),p=Math.sqrt(f*f+d*d),m=f/p,v=d/p,g=(r-t)*m+(a-e)*v,y=o*o,x=y-(t*t+e*e)+g*g,S=0;if(x>=0){var A=Math.sqrt(x),b=g-A,C=g+A,T=b<0?-1:b<=p?0:1,E=C<0?-1:C<=p?0:1,w=T*E;if(w<0)return-1;0===w&&(-1===T?(S=2,n=t+C*m,i=(e+C*v)/u,null!==c&&(c.x=n,c.y=i),null!==l&&(l.x=n,l.y=i),null!==h&&(h.x=Math.atan2(i/y*_,n/y),h.y=h.x+Math.PI)):1===E?(S=1,t+=b*m,e=(e+b*v)/u,null!==c&&(c.x=t,c.y=e),null!==l&&(l.x=t,l.y=e),null!==h&&(h.x=Math.atan2(e/y*_,t/y),h.y=h.x+Math.PI)):(S=3,null!==c&&(c.x=t+b*m,c.y=(e+b*v)/u,null!==h&&(h.x=Math.atan2(c.y/y*_,c.x/y))),null!==l&&(l.x=t+C*m,l.y=(e+C*v)/u,null!==h&&(h.y=Math.atan2(l.y/y*_,l.x/y)))))}return S},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=1},e.prototype.containsPoint=function(t,e){var n=.5*this.width;if(t>=-n&&t<=n){var i=.5*this.height;if(e>=-i&&e<=i)return e*=n/i,Math.sqrt(t*t+e*e)<=n}return!1},e.prototype.intersectsSegment=function(t,n,i,r,a,o,s){return void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null),e.ellipseIntersectsSegment(t,n,i,r,0,0,.5*this.width,.5*this.height,a,o,s)},e}(e);t.EllipseBoundingBoxData=i;var r=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e}return $4(e,t),e.toString=function(){return"[class dragonBones.PolygonBoundingBoxData]"},e.polygonIntersectsSegment=function(t,e,n,i,r,a,o,s){void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null),t===n&&(t=n+1e-6),e===i&&(e=i+1e-6);for(var c=r.length,l=t-n,h=e-i,u=t*i-e*n,_=0,f=r[c-2],d=r[c-1],p=0,m=0,v=0,g=0,y=0,x=0,S=0;S<c;S+=2){var A=r[S],b=r[S+1];f===A&&(f=A+1e-4),d===b&&(d=b+1e-4);var C=f-A,T=d-b,E=f*b-d*A,w=l*T-h*C,I=(u*C-l*E)/w;if((I>=f&&I<=A||I>=A&&I<=f)&&(0===l||I>=t&&I<=n||I>=n&&I<=t)){var P=(u*T-h*E)/w;if((P>=d&&P<=b||P>=b&&P<=d)&&(0===h||P>=e&&P<=i||P>=i&&P<=e)){if(null===o){v=I,g=P,y=I,x=P,_++,null!==s&&(s.x=Math.atan2(b-d,A-f)-.5*Math.PI,s.y=s.x);break}var D=I-t;D<0&&(D=-D),0===_?(p=D,m=D,v=I,g=P,y=I,x=P,null!==s&&(s.x=Math.atan2(b-d,A-f)-.5*Math.PI,s.y=s.x)):(D<p&&(p=D,v=I,g=P,null!==s&&(s.x=Math.atan2(b-d,A-f)-.5*Math.PI)),D>m&&(m=D,y=I,x=P,null!==s&&(s.y=Math.atan2(b-d,A-f)-.5*Math.PI))),_++}}f=A,d=b}return 1===_?(null!==a&&(a.x=v,a.y=g),null!==o&&(o.x=v,o.y=g),null!==s&&(s.y=s.x+Math.PI)):_>1&&(_++,null!==a&&(a.x=v,a.y=g),null!==o&&(o.x=y,o.y=x)),_},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.type=2,this.x=0,this.y=0,this.vertices.length=0},e.prototype.containsPoint=function(t,e){var n=!1;if(t>=this.x&&t<=this.width&&e>=this.y&&e<=this.height)for(var i=0,r=this.vertices.length,a=r-2;i<r;i+=2){var o=this.vertices[a+1],s=this.vertices[i+1];if(s<e&&o>=e||o<e&&s>=e){var c=this.vertices[a],l=this.vertices[i];(e-s)*(c-l)/(o-s)+l<t&&(n=!n)}a=i}return n},e.prototype.intersectsSegment=function(t,i,r,a,o,s,c){void 0===o&&(o=null),void 0===s&&(s=null),void 0===c&&(c=null);var l=0;return 0!==n.rectangleIntersectsSegment(t,i,r,a,this.x,this.y,this.x+this.width,this.y+this.height,null,null,null)&&(l=e.polygonIntersectsSegment(t,i,r,a,this.vertices,o,s,c)),l},e}(e);t.PolygonBoundingBoxData=r}(t3||(t3={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cachedFrames=[],e.boneTimelines={},e.surfaceTimelines={},e.slotTimelines={},e.constraintTimelines={},e.animationTimelines={},e.boneCachedFrameIndices={},e.slotCachedFrameIndices={},e.actionTimeline=null,e.zOrderTimeline=null,e}return $4(e,t),e.toString=function(){return"[class dragonBones.AnimationData]"},e.prototype._onClear=function(){for(var t in this.boneTimelines){for(var e=0,n=this.boneTimelines[t];e<n.length;e++)n[e].returnToPool();delete this.boneTimelines[t]}for(var t in this.surfaceTimelines){for(var i=0,r=this.surfaceTimelines[t];i<r.length;i++)r[i].returnToPool();delete this.surfaceTimelines[t]}for(var t in this.slotTimelines){for(var a=0,o=this.slotTimelines[t];a<o.length;a++)o[a].returnToPool();delete this.slotTimelines[t]}for(var t in this.constraintTimelines){for(var s=0,c=this.constraintTimelines[t];s<c.length;s++)c[s].returnToPool();delete this.constraintTimelines[t]}for(var t in this.animationTimelines){for(var l=0,h=this.animationTimelines[t];l<h.length;l++)h[l].returnToPool();delete this.animationTimelines[t]}for(var t in this.boneCachedFrameIndices)delete this.boneCachedFrameIndices[t];for(var t in this.slotCachedFrameIndices)delete this.slotCachedFrameIndices[t];null!==this.actionTimeline&&this.actionTimeline.returnToPool(),null!==this.zOrderTimeline&&this.zOrderTimeline.returnToPool(),this.frameIntOffset=0,this.frameFloatOffset=0,this.frameOffset=0,this.frameCount=0,this.playTimes=0,this.duration=0,this.scale=1,this.fadeInTime=0,this.cacheFrameRate=0,this.name="",this.cachedFrames.length=0,this.actionTimeline=null,this.zOrderTimeline=null,this.parent=null},e.prototype.cacheFrames=function(t){if(!(this.cacheFrameRate>0)){this.cacheFrameRate=Math.max(Math.ceil(t*this.scale),1);var e=Math.ceil(this.cacheFrameRate*this.duration)+1;this.cachedFrames.length=e;for(var n=0,i=this.cacheFrames.length;n<i;++n)this.cachedFrames[n]=!1;for(var r=0,a=this.parent.sortedBones;r<a.length;r++){var o=a[r];for(n=0,i=(l=new Array(e)).length;n<i;++n)l[n]=-1;this.boneCachedFrameIndices[o.name]=l}for(var s=0,c=this.parent.sortedSlots;s<c.length;s++){var l,h=c[s];for(n=0,i=(l=new Array(e)).length;n<i;++n)l[n]=-1;this.slotCachedFrameIndices[h.name]=l}}},e.prototype.addBoneTimeline=function(t,e){var n=t.name in this.boneTimelines?this.boneTimelines[t.name]:this.boneTimelines[t.name]=[];n.indexOf(e)<0&&n.push(e)},e.prototype.addSurfaceTimeline=function(t,e){var n=t.name in this.surfaceTimelines?this.surfaceTimelines[t.name]:this.surfaceTimelines[t.name]=[];n.indexOf(e)<0&&n.push(e)},e.prototype.addSlotTimeline=function(t,e){var n=t.name in this.slotTimelines?this.slotTimelines[t.name]:this.slotTimelines[t.name]=[];n.indexOf(e)<0&&n.push(e)},e.prototype.addConstraintTimeline=function(t,e){var n=t.name in this.constraintTimelines?this.constraintTimelines[t.name]:this.constraintTimelines[t.name]=[];n.indexOf(e)<0&&n.push(e)},e.prototype.addAnimationTimeline=function(t,e){var n=t in this.animationTimelines?this.animationTimelines[t]:this.animationTimelines[t]=[];n.indexOf(e)<0&&n.push(e)},e.prototype.getBoneTimelines=function(t){return t in this.boneTimelines?this.boneTimelines[t]:null},e.prototype.getSurfaceTimelines=function(t){return t in this.surfaceTimelines?this.surfaceTimelines[t]:null},e.prototype.getSlotTimelines=function(t){return t in this.slotTimelines?this.slotTimelines[t]:null},e.prototype.getConstraintTimelines=function(t){return t in this.constraintTimelines?this.constraintTimelines[t]:null},e.prototype.getAnimationTimelines=function(t){return t in this.animationTimelines?this.animationTimelines[t]:null},e.prototype.getBoneCachedFrameIndices=function(t){return t in this.boneCachedFrameIndices?this.boneCachedFrameIndices[t]:null},e.prototype.getSlotCachedFrameIndices=function(t){return t in this.slotCachedFrameIndices?this.slotCachedFrameIndices[t]:null},e}(t.BaseObject);t.AnimationData=e;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $4(e,t),e.toString=function(){return"[class dragonBones.TimelineData]"},e.prototype._onClear=function(){this.type=10,this.offset=0,this.frameIndicesOffset=-1},e}(t.BaseObject);t.TimelineData=n}(t3||(t3={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.boneMask=[],e}return $4(e,t),e.toString=function(){return"[class dragonBones.AnimationConfig]"},e.prototype._onClear=function(){this.pauseFadeOut=!0,this.fadeOutMode=4,this.fadeOutTweenType=1,this.fadeOutTime=-1,this.actionEnabled=!0,this.additiveBlending=!1,this.displayControl=!0,this.pauseFadeIn=!0,this.resetToPose=!0,this.fadeInTweenType=1,this.playTimes=-1,this.layer=0,this.position=0,this.duration=-1,this.timeScale=-100,this.weight=1,this.fadeInTime=-1,this.autoFadeOutTime=-1,this.name="",this.animation="",this.group="",this.boneMask.length=0},e.prototype.clear=function(){this._onClear()},e.prototype.copyFrom=function(t){this.pauseFadeOut=t.pauseFadeOut,this.fadeOutMode=t.fadeOutMode,this.autoFadeOutTime=t.autoFadeOutTime,this.fadeOutTweenType=t.fadeOutTweenType,this.actionEnabled=t.actionEnabled,this.additiveBlending=t.additiveBlending,this.displayControl=t.displayControl,this.pauseFadeIn=t.pauseFadeIn,this.resetToPose=t.resetToPose,this.playTimes=t.playTimes,this.layer=t.layer,this.position=t.position,this.duration=t.duration,this.timeScale=t.timeScale,this.fadeInTime=t.fadeInTime,this.fadeOutTime=t.fadeOutTime,this.fadeInTweenType=t.fadeInTweenType,this.weight=t.weight,this.name=t.name,this.animation=t.animation,this.group=t.group,this.boneMask.length=t.boneMask.length;for(var e=0,n=this.boneMask.length;e<n;++e)this.boneMask[e]=t.boneMask[e]},e.prototype.containsBoneMask=function(t){return 0===this.boneMask.length||this.boneMask.indexOf(t)>=0},e.prototype.addBoneMask=function(t,e,n){void 0===n&&(n=!0);var i=t.getBone(e);if(null!==i&&(this.boneMask.indexOf(e)<0&&this.boneMask.push(e),n))for(var r=0,a=t.getBones();r<a.length;r++){var o=a[r];this.boneMask.indexOf(o.name)<0&&i.contains(o)&&this.boneMask.push(o.name)}},e.prototype.removeBoneMask=function(t,e,n){void 0===n&&(n=!0);var i=this.boneMask.indexOf(e);if(i>=0&&this.boneMask.splice(i,1),n){var r=t.getBone(e);if(null!==r)if(this.boneMask.length>0)for(var a=0,o=t.getBones();a<o.length;a++){var s=o[a],c=this.boneMask.indexOf(s.name);c>=0&&r.contains(s)&&this.boneMask.splice(c,1)}else for(var l=0,h=t.getBones();l<h.length;l++)(s=h[l])!==r&&(r.contains(s)||this.boneMask.push(s.name))}},e}(t.BaseObject);t.AnimationConfig=e}(t3||(t3={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.textures={},e}return $4(e,t),e.prototype._onClear=function(){for(var t in this.textures)this.textures[t].returnToPool(),delete this.textures[t];this.autoSearch=!1,this.width=0,this.height=0,this.scale=1,this.name="",this.imagePath=""},e.prototype.copyFrom=function(t){for(var e in this.autoSearch=t.autoSearch,this.scale=t.scale,this.width=t.width,this.height=t.height,this.name=t.name,this.imagePath=t.imagePath,this.textures)this.textures[e].returnToPool(),delete this.textures[e];for(var e in t.textures){var n=this.createTexture();n.copyFrom(t.textures[e]),this.textures[e]=n}},e.prototype.addTexture=function(t){t.name in this.textures?console.warn("Same texture: "+t.name):(t.parent=this,this.textures[t.name]=t)},e.prototype.getTexture=function(t){return t in this.textures?this.textures[t]:null},e}(t.BaseObject);t.TextureAtlasData=e;var n=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.region=new t.Rectangle,n.frame=null,n}return $4(n,e),n.createRectangle=function(){return new t.Rectangle},n.prototype._onClear=function(){this.rotated=!1,this.name="",this.region.clear(),this.parent=null,this.frame=null},n.prototype.copyFrom=function(t){this.rotated=t.rotated,this.name=t.name,this.region.copyFrom(t.region),this.parent=t.parent,null===this.frame&&null!==t.frame?this.frame=n.createRectangle():null!==this.frame&&null===t.frame&&(this.frame=null),null!==this.frame&&null!==t.frame&&this.frame.copyFrom(t.frame)},n}(t.BaseObject);t.TextureData=n}(t3||(t3={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.vertices=[],e.bones=[],e}return $4(e,t),e.toString=function(){return"[class dragonBones.DeformVertices]"},e.prototype._onClear=function(){this.verticesDirty=!1,this.vertices.length=0,this.bones.length=0,this.verticesData=null},e.prototype.init=function(t,e){if(this.verticesData=t,null!==this.verticesData){var n;n=null!==this.verticesData.weight?2*this.verticesData.weight.count:2*this.verticesData.data.intArray[this.verticesData.offset+0],this.verticesDirty=!0,this.vertices.length=n,this.bones.length=0;for(var i=0,r=this.vertices.length;i<r;++i)this.vertices[i]=0;if(null!==this.verticesData.weight)for(i=0,r=this.verticesData.weight.bones.length;i<r;++i){var a=e.getBone(this.verticesData.weight.bones[i].name);this.bones.push(a)}}else this.verticesDirty=!1,this.vertices.length=0,this.bones.length=0,this.verticesData=null},e.prototype.isBonesUpdate=function(){for(var t=0,e=this.bones;t<e.length;t++){var n=e[t];if(null!==n&&n._childrenTransformDirty)return!0}return!1},e}(t.BaseObject);t.DeformVertices=e}(t3||(t3={})),function(t){var e=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._bones=[],t._slots=[],t._constraints=[],t._actions=[],t._animation=null,t._proxy=null,t._replaceTextureAtlasData=null,t._clock=null,t}return $4(n,e),n.toString=function(){return"[class dragonBones.Armature]"},n._onSortSlots=function(t,e){return t._zOrder>e._zOrder?1:-1},n.prototype._onClear=function(){null!==this._clock&&this._clock.remove(this);for(var t=0,e=this._bones;t<e.length;t++)e[t].returnToPool();for(var n=0,i=this._slots;n<i.length;n++)i[n].returnToPool();for(var r=0,a=this._constraints;r<a.length;r++)a[r].returnToPool();for(var o=0,s=this._actions;o<s.length;o++)s[o].returnToPool();null!==this._animation&&this._animation.returnToPool(),null!==this._proxy&&this._proxy.dbClear(),null!==this._replaceTextureAtlasData&&this._replaceTextureAtlasData.returnToPool(),this.inheritAnimation=!0,this.userData=null,this._lockUpdate=!1,this._slotsDirty=!0,this._zOrderDirty=!1,this._flipX=!1,this._flipY=!1,this._cacheFrameIndex=-1,this._bones.length=0,this._slots.length=0,this._constraints.length=0,this._actions.length=0,this._armatureData=null,this._animation=null,this._proxy=null,this._display=null,this._replaceTextureAtlasData=null,this._replacedTexture=null,this._dragonBones=null,this._clock=null,this._parent=null},n.prototype._sortZOrder=function(t,e){var n=this._armatureData.sortedSlots,i=null===t;if(this._zOrderDirty||!i){for(var r=0,a=n.length;r<a;++r){var o=i?r:t[e+r];if(!(o<0||o>=a)){var s=n[o],c=this.getSlot(s.name);null!==c&&c._setZorder(r)}}this._slotsDirty=!0,this._zOrderDirty=!i}},n.prototype._addBone=function(t){this._bones.indexOf(t)<0&&this._bones.push(t)},n.prototype._addSlot=function(t){this._slots.indexOf(t)<0&&this._slots.push(t)},n.prototype._addConstraint=function(t){this._constraints.indexOf(t)<0&&this._constraints.push(t)},n.prototype._bufferAction=function(t,e){this._actions.indexOf(t)<0&&(e?this._actions.push(t):this._actions.unshift(t))},n.prototype.dispose=function(){null!==this._armatureData&&(this._lockUpdate=!0,this._dragonBones.bufferObject(this))},n.prototype.init=function(e,n,i,r){null===this._armatureData&&(this._armatureData=e,this._animation=t.BaseObject.borrowObject(t.Animation),this._proxy=n,this._display=i,this._dragonBones=r,this._proxy.dbInit(this),this._animation.init(this),this._animation.animations=this._armatureData.animations)},n.prototype.advanceTime=function(t){if(!this._lockUpdate)if(null!==this._armatureData)if(null!==this._armatureData.parent){var e=this._cacheFrameIndex;if(this._animation.advanceTime(t),this._slotsDirty&&(this._slotsDirty=!1,this._slots.sort(n._onSortSlots)),this._cacheFrameIndex<0||this._cacheFrameIndex!==e){var i=0,r=0;for(i=0,r=this._bones.length;i<r;++i)this._bones[i].update(this._cacheFrameIndex);for(i=0,r=this._slots.length;i<r;++i)this._slots[i].update(this._cacheFrameIndex)}if(this._actions.length>0){this._lockUpdate=!0;for(var a=0,o=this._actions;a<o.length;a++){var s=o[a],c=s.actionData;if(null!==c&&0===c.type)if(null!==s.slot)null!==(u=s.slot.childArmature)&&u.animation.fadeIn(c.name);else if(null!==s.bone)for(var l=0,h=this.getSlots();l<h.length;l++){var u,_=h[l];_.parent===s.bone&&null!==(u=_.childArmature)&&u.animation.fadeIn(c.name)}else this._animation.fadeIn(c.name);s.returnToPool()}this._actions.length=0,this._lockUpdate=!1}this._proxy.dbUpdate()}else console.warn("The armature data has been disposed.\nPlease make sure dispose armature before call factory.clear().");else console.warn("The armature has been disposed.")},n.prototype.invalidUpdate=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=!1),null!==t&&t.length>0){if(null!==(o=this.getBone(t))&&(o.invalidUpdate(),e))for(var n=0,i=this._slots;n<i.length;n++)(l=i[n]).parent===o&&l.invalidUpdate()}else{for(var r=0,a=this._bones;r<a.length;r++){var o;(o=a[r]).invalidUpdate()}if(e)for(var s=0,c=this._slots;s<c.length;s++){var l;(l=c[s]).invalidUpdate()}}},n.prototype.containsPoint=function(t,e){for(var n=0,i=this._slots;n<i.length;n++){var r=i[n];if(r.containsPoint(t,e))return r}return null},n.prototype.intersectsSegment=function(t,e,n,i,r,a,o){void 0===r&&(r=null),void 0===a&&(a=null),void 0===o&&(o=null);for(var s=t===n,c=0,l=0,h=0,u=0,_=0,f=0,d=0,p=0,m=null,v=null,g=0,y=this._slots;g<y.length;g++){var x=y[g];if(x.intersectsSegment(t,e,n,i,r,a,o)>0){if(null===r&&null===a){m=x;break}var S;null!==r&&((S=s?r.y-e:r.x-t)<0&&(S=-S),(null===m||S<c)&&(c=S,h=r.x,u=r.y,m=x,o&&(d=o.x))),null!==a&&((S=a.x-t)<0&&(S=-S),(null===v||S>l)&&(l=S,_=a.x,f=a.y,v=x,null!==o&&(p=o.y)))}}return null!==m&&null!==r&&(r.x=h,r.y=u,null!==o&&(o.x=d)),null!==v&&null!==a&&(a.x=_,a.y=f,null!==o&&(o.y=p)),m},n.prototype.getBone=function(t){for(var e=0,n=this._bones;e<n.length;e++){var i=n[e];if(i.name===t)return i}return null},n.prototype.getBoneByDisplay=function(t){var e=this.getSlotByDisplay(t);return null!==e?e.parent:null},n.prototype.getSlot=function(t){for(var e=0,n=this._slots;e<n.length;e++){var i=n[e];if(i.name===t)return i}return null},n.prototype.getSlotByDisplay=function(t){if(null!==t)for(var e=0,n=this._slots;e<n.length;e++){var i=n[e];if(i.display===t)return i}return null},n.prototype.getBones=function(){return this._bones},n.prototype.getSlots=function(){return this._slots},Object.defineProperty(n.prototype,"flipX",{get:function(){return this._flipX},set:function(t){this._flipX!==t&&(this._flipX=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"flipY",{get:function(){return this._flipY},set:function(t){this._flipY!==t&&(this._flipY=t,this.invalidUpdate())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"cacheFrameRate",{get:function(){return this._armatureData.cacheFrameRate},set:function(t){if(this._armatureData.cacheFrameRate!==t){this._armatureData.cacheFrames(t);for(var e=0,n=this._slots;e<n.length;e++){var i=n[e].childArmature;null!==i&&(i.cacheFrameRate=t)}}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._armatureData.name},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"armatureData",{get:function(){return this._armatureData},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animation",{get:function(){return this._animation},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"proxy",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"eventDispatcher",{get:function(){return this._proxy},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"display",{get:function(){return this._display},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"replacedTexture",{get:function(){return this._replacedTexture},set:function(t){if(this._replacedTexture!==t){null!==this._replaceTextureAtlasData&&(this._replaceTextureAtlasData.returnToPool(),this._replaceTextureAtlasData=null),this._replacedTexture=t;for(var e=0,n=this._slots;e<n.length;e++){var i=n[e];i.invalidUpdate(),i.update(-1)}}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"clock",{get:function(){return this._clock},set:function(t){if(this._clock!==t){null!==this._clock&&this._clock.remove(this),this._clock=t,this._clock&&this._clock.add(this);for(var e=0,n=this._slots;e<n.length;e++){var i=n[e].childArmature;null!==i&&(i.clock=this._clock)}}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),n.prototype.replaceTexture=function(t){this.replacedTexture=t},n.prototype.hasEventListener=function(t){return this._proxy.hasDBEventListener(t)},n.prototype.addEventListener=function(t,e,n){this._proxy.addDBEventListener(t,e,n)},n.prototype.removeEventListener=function(t,e,n){this._proxy.removeDBEventListener(t,e,n)},n.prototype.enableAnimationCache=function(t){console.warn("Deprecated."),this.cacheFrameRate=t},n.prototype.getDisplay=function(){return this._display},n}(t.BaseObject);t.Armature=e}(t3||(t3={})),function(t){var e=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.globalTransformMatrix=new t.Matrix,n.global=new t.Transform,n.offset=new t.Transform,n}return $4(n,e),n.prototype._onClear=function(){this.globalTransformMatrix.identity(),this.global.identity(),this.offset.identity(),this.origin=null,this.userData=null,this._globalDirty=!1,this._armature=null},n.prototype.updateGlobalTransform=function(){this._globalDirty&&(this._globalDirty=!1,this.global.fromMatrix(this.globalTransformMatrix))},Object.defineProperty(n.prototype,"armature",{get:function(){return this._armature},enumerable:!0,configurable:!0}),n._helpMatrix=new t.Matrix,n._helpTransform=new t.Transform,n._helpPoint=new t.Point,n}(t.BaseObject);t.TransformObject=e}(t3||(t3={})),function(t){var e=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.animationPose=new t.Transform,n._blendState=new t.BlendState,n}return $4(n,e),n.toString=function(){return"[class dragonBones.Bone]"},n.prototype._onClear=function(){e.prototype._onClear.call(this),this.offsetMode=1,this.animationPose.identity(),this._transformDirty=!1,this._childrenTransformDirty=!1,this._localDirty=!0,this._hasConstraint=!1,this._visible=!0,this._cachedFrameIndex=-1,this._blendState.clear(),this._boneData=null,this._parent=null,this._cachedFrameIndices=null},n.prototype._updateGlobalTransformMatrix=function(e){var n=this._boneData,i=this.global,r=this.globalTransformMatrix,a=this.origin,o=this.offset,s=this.animationPose,c=this._parent,l=this._armature.flipX,h=this._armature.flipY===t.DragonBones.yDown,u=null!==c,_=0;if(1===this.offsetMode?null!==a?(i.x=a.x+o.x+s.x,i.scaleX=a.scaleX*o.scaleX*s.scaleX,i.scaleY=a.scaleY*o.scaleY*s.scaleY,t.DragonBones.yDown?(i.y=a.y+o.y+s.y,i.skew=a.skew+o.skew+s.skew,i.rotation=a.rotation+o.rotation+s.rotation):(i.y=a.y-o.y+s.y,i.skew=a.skew-o.skew+s.skew,i.rotation=a.rotation-o.rotation+s.rotation)):(i.copyFrom(o),t.DragonBones.yDown||(i.y=-i.y,i.skew=-i.skew,i.rotation=-i.rotation),i.add(s)):0===this.offsetMode?null!==a?i.copyFrom(a).add(s):i.copyFrom(s):(u=!1,i.copyFrom(o),t.DragonBones.yDown||(i.y=-i.y,i.skew=-i.skew,i.rotation=-i.rotation)),u){var f=0===c._boneData.type?c.globalTransformMatrix:c._getGlobalTransformMatrix(i.x,i.y);if(n.inheritScale)n.inheritRotation||(c.updateGlobalTransform(),_=l&&h?i.rotation-(c.global.rotation+Math.PI):l?i.rotation+c.global.rotation+Math.PI:h?i.rotation+c.global.rotation:i.rotation-c.global.rotation,i.rotation=_),i.toMatrix(r),r.concat(f),n.inheritTranslation?(i.x=r.tx,i.y=r.ty):(r.tx=i.x,r.ty=i.y),e?i.fromMatrix(r):this._globalDirty=!0;else{if(n.inheritTranslation){var d=i.x,p=i.y;i.x=f.a*d+f.c*p+f.tx,i.y=f.b*d+f.d*p+f.ty}else l&&(i.x=-i.x),h&&(i.y=-i.y);n.inheritRotation?(c.updateGlobalTransform(),_=c.global.scaleX<0?i.rotation+c.global.rotation+Math.PI:i.rotation+c.global.rotation,f.a*f.d-f.b*f.c<0&&(_-=2*i.rotation,(l!==h||n.inheritReflection)&&(i.skew+=Math.PI),t.DragonBones.yDown||(i.skew=-i.skew)),i.rotation=_):(l||h)&&(l&&h?_=i.rotation+Math.PI:(_=l?Math.PI-i.rotation:-i.rotation,i.skew+=Math.PI),i.rotation=_),i.toMatrix(r)}}else(l||h)&&(l&&(i.x=-i.x),h&&(i.y=-i.y),l&&h?_=i.rotation+Math.PI:(_=l?Math.PI-i.rotation:-i.rotation,i.skew+=Math.PI),i.rotation=_),i.toMatrix(r)},n.prototype.init=function(t,e){null===this._boneData&&(this._boneData=t,this._armature=e,null!==this._boneData.parent&&(this._parent=this._armature.getBone(this._boneData.parent.name)),this._armature._addBone(this),this.origin=this._boneData.transform)},n.prototype.update=function(t){if(this._blendState.dirty=!1,t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];if(e>=0&&this._cachedFrameIndex===e)this._transformDirty=!1;else if(e>=0)this._transformDirty=!0,this._cachedFrameIndex=e;else{if(this._hasConstraint)for(var n=0,i=this._armature._constraints;n<i.length;n++)(o=i[n])._root===this&&o.update();this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var r=0,a=this._armature._constraints;r<a.length;r++){var o;(o=a[r])._root===this&&o.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty)if(this._transformDirty=!1,this._childrenTransformDirty=!0,this._cachedFrameIndex<0){var s=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(s),s&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},n.prototype.updateByConstraint=function(){this._localDirty&&(this._localDirty=!1,(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&this._updateGlobalTransformMatrix(!0),this._transformDirty=!0)},n.prototype.invalidUpdate=function(){this._transformDirty=!0},n.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.parent;return e===this},Object.defineProperty(n.prototype,"boneData",{get:function(){return this._boneData},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"visible",{get:function(){return this._visible},set:function(t){if(this._visible!==t){this._visible=t;for(var e=0,n=this._armature.getSlots();e<n.length;e++){var i=n[e];i.parent===this&&i._updateVisible()}}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._boneData.name},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),n.prototype.getBones=function(){console.warn("Deprecated.");for(var t=new Array,e=0,n=this._armature.getBones();e<n.length;e++){var i=n[e];i.parent===this&&t.push(i)}return t},n.prototype.getSlots=function(){console.warn("Deprecated.");for(var t=new Array,e=0,n=this._armature.getSlots();e<n.length;e++){var i=n[e];i.parent===this&&t.push(i)}return t},Object.defineProperty(n.prototype,"slot",{get:function(){console.warn("Deprecated.");for(var t=0,e=this._armature.getSlots();t<e.length;t++){var n=e[t];if(n.parent===this)return n}return null},enumerable:!0,configurable:!0}),n}(t.TransformObject);t.Bone=e}(t3||(t3={})),function(t){var e=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._vertices=[],e._deformVertices=[],e._hullCache=[],e._matrixCahce=[],e}return $4(e,t),e.toString=function(){return"[class dragonBones.Surface]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._dX=0,this._dY=0,this._k=0,this._kX=0,this._kY=0,this._vertices.length=0,this._deformVertices.length=0,this._matrixCahce.length=0,this._hullCache.length=0},e.prototype._getAffineTransform=function(t,e,n,i,r,a,o,s,c,l,h,u,_){var f=o-r,d=s-a,p=c-r,m=l-a;h.rotation=Math.atan2(d,f),h.skew=Math.atan2(m,p)-.5*Math.PI-h.rotation,_&&(h.rotation+=Math.PI),h.scaleX=Math.sqrt(f*f+d*d)/n,h.scaleY=Math.sqrt(p*p+m*m)/i,h.toMatrix(u),h.x=u.tx=r-(u.a*t+u.c*e),h.y=u.ty=a-(u.b*t+u.d*e)},e.prototype._updateVertices=function(){var t=this._boneData.vertices,e=this._vertices,n=this._deformVertices;if(null!==this._parent)if(1===this._parent._boneData.type)for(var i=0,r=t.length;i<r;i+=2){var a=t[i]+n[i],o=t[i+1]+n[i],s=this._parent._getGlobalTransformMatrix(a,o);e[i]=s.a*a+s.c*o+s.tx,e[i+1]=s.b*a+s.d*o+s.ty}else{var c=this._parent.globalTransformMatrix;for(i=0,r=t.length;i<r;i+=2)a=t[i]+n[i],o=t[i+1]+n[i+1],e[i]=c.a*a+c.c*o+c.tx,e[i+1]=c.b*a+c.d*o+c.ty}else for(i=0,r=t.length;i<r;i+=2)e[i]=t[i]+n[i],e[i+1]=t[i+1]+n[i+1]},e.prototype._updateGlobalTransformMatrix=function(){var t=2*this._boneData.segmentX,e=this._vertices.length-2,n=this._vertices[0],i=this._vertices[1],r=this._vertices[t],a=this._vertices[t+1],o=this._vertices[e],s=this._vertices[e+1],c=this._vertices[e-t],l=this._vertices[e-t+1],h=n+.5*(o-n),u=i+.5*(s-i),_=h+.5*(r+.5*(c-r)-h),f=u+.5*(a+.5*(l-a)-u),d=r+.5*(o-r),p=a+.5*(s-a),m=c+.5*(o-c),v=l+.5*(s-l);this._globalDirty=!1,this._getAffineTransform(0,0,200,200,_,f,d,p,m,v,this.global,this.globalTransformMatrix,!1)},e.prototype._getGlobalTransformMatrix=function(t,n){var i=1e3;if(t<-i||i<t||n<-i||i<n)return this.globalTransformMatrix;var r=!1,a=200,o=this._boneData,s=o.segmentX,c=o.segmentY,l=2*o.segmentX,h=this._dX,u=this._dY,_=Math.floor((t+a)/h),f=Math.floor((n+a)/u),d=0,p=_*h-a,m=f*u-a,v=this._matrixCahce,g=e._helpMatrix;if(t<-a){if(n<-a||n>=a)return this.globalTransformMatrix;if(d=7*(2*(s*(c+1)+2*s+c+f)+((r=n>this._kX*(t+a)+m)?1:0)),this._matrixCahce[d]>0)g.copyFromArray(v,d+1);else{var y=f*(l+2),x=this._hullCache[4],S=this._hullCache[5],A=this._hullCache[2]-(c-f)*x,b=this._hullCache[3]-(c-f)*S,C=this._vertices;r?this._getAffineTransform(-a,m+u,800,u,C[y+l+2],C[y+l+3],A+x,b+S,C[y],C[y+1],e._helpTransform,g,!0):this._getAffineTransform(-i,m,800,u,A,b,C[y],C[y+1],A+x,b+S,e._helpTransform,g,!1),v[d]=1,v[d+1]=g.a,v[d+2]=g.b,v[d+3]=g.c,v[d+4]=g.d,v[d+5]=g.tx,v[d+6]=g.ty}}else if(t>=a){if(n<-a||n>=a)return this.globalTransformMatrix;d=7*(2*(s*(c+1)+s+f)+((r=n>this._kX*(t-i)+m)?1:0)),this._matrixCahce[d]>0?g.copyFromArray(v,d+1):(y=(f+1)*(l+2)-2,x=this._hullCache[4],S=this._hullCache[5],A=this._hullCache[0]+f*x,b=this._hullCache[1]+f*S,C=this._vertices,r?this._getAffineTransform(i,m+u,800,u,A+x,b+S,C[y+l+2],C[y+l+3],A,b,e._helpTransform,g,!0):this._getAffineTransform(a,m,800,u,C[y],C[y+1],A,b,C[y+l+2],C[y+l+3],e._helpTransform,g,!1),v[d]=1,v[d+1]=g.a,v[d+2]=g.b,v[d+3]=g.c,v[d+4]=g.d,v[d+5]=g.tx,v[d+6]=g.ty)}else if(n<-a){if(t<-a||t>=a)return this.globalTransformMatrix;d=7*(s*(c+1)+2*_+((r=n>this._kY*(t-p-h)-i)?1:0)),this._matrixCahce[d]>0?g.copyFromArray(v,d+1):(y=2*_,x=this._hullCache[10],S=this._hullCache[11],A=this._hullCache[8]+_*x,b=this._hullCache[9]+_*S,C=this._vertices,r?this._getAffineTransform(p+h,-a,h,800,C[y+2],C[y+3],C[y],C[y+1],A+x,b+S,e._helpTransform,g,!0):this._getAffineTransform(p,-i,h,800,A,b,A+x,b+S,C[y],C[y+1],e._helpTransform,g,!1),v[d]=1,v[d+1]=g.a,v[d+2]=g.b,v[d+3]=g.c,v[d+4]=g.d,v[d+5]=g.tx,v[d+6]=g.ty)}else if(n>=a){if(t<-a||t>=a)return this.globalTransformMatrix;d=7*(2*(s*(c+1)+s+c+f)+((r=n>this._kY*(t-p-h)+a)?1:0)),this._matrixCahce[d]>0?g.copyFromArray(v,d+1):(y=c*(l+2)+2*_,x=this._hullCache[10],S=this._hullCache[11],A=this._hullCache[6]-(s-_)*x,b=this._hullCache[7]-(s-_)*S,C=this._vertices,r?this._getAffineTransform(p+h,i,h,800,A+x,b+S,A,b,C[y+2],C[y+3],e._helpTransform,g,!0):this._getAffineTransform(p,a,h,800,C[y],C[y+1],C[y+2],C[y+3],A,b,e._helpTransform,g,!1),v[d]=1,v[d+1]=g.a,v[d+2]=g.b,v[d+3]=g.c,v[d+4]=g.d,v[d+5]=g.tx,v[d+6]=g.ty)}else d=7*(2*(s*f+_)+((r=n>this._k*(t-p-h)+m)?1:0)),this._matrixCahce[d]>0?g.copyFromArray(v,d+1):(y=2*_+f*(l+2),C=this._vertices,r?this._getAffineTransform(p+h,m+u,h,u,C[y+l+4],C[y+l+5],C[y+l+2],C[y+l+3],C[y+2],C[y+3],e._helpTransform,g,!0):this._getAffineTransform(p,m,h,u,C[y],C[y+1],C[y+2],C[y+3],C[y+l+2],C[y+l+3],e._helpTransform,g,!1),v[d]=1,v[d+1]=g.a,v[d+2]=g.b,v[d+3]=g.c,v[d+4]=g.d,v[d+5]=g.tx,v[d+6]=g.ty);return g},e.prototype.init=function(e,n){if(null===this._boneData){t.prototype.init.call(this,e,n);var i=e.segmentX,r=e.segmentY,a=e.vertices.length;this._dX=400/i,this._dY=400/r,this._k=-this._dY/this._dX,this._kX=-this._dY/800,this._kY=-800/this._dX,this._vertices.length=a,this._deformVertices.length=a,this._matrixCahce.length=14*(i*r+2*i+2*r),this._hullCache.length=10;for(var o=0;o<a;++o)this._deformVertices[o]=0}},e.prototype.update=function(t){if(this._blendState.dirty=!1,t>=0&&null!==this._cachedFrameIndices){var n=this._cachedFrameIndices[t];if(n>=0&&this._cachedFrameIndex===n)this._transformDirty=!1;else if(n>=0)this._transformDirty=!0,this._cachedFrameIndex=n;else{if(this._hasConstraint)for(var i=0,r=this._armature._constraints;i<r.length;i++)(s=r[i])._root===this&&s.update();this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}}else{if(this._hasConstraint)for(var a=0,o=this._armature._constraints;a<o.length;a++){var s;(s=o[a])._root===this&&s.update()}(this._transformDirty||null!==this._parent&&this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1)}if(this._transformDirty){this._transformDirty=!1,this._childrenTransformDirty=!0;for(var c=0,l=this._matrixCahce.length;c<l;c+=7)this._matrixCahce[c]=-1;if(this._updateVertices(),this._cachedFrameIndex<0){var h=t>=0;this._localDirty&&this._updateGlobalTransformMatrix(h),h&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);var u=2*this.global.x,_=2*this.global.y,f=e._helpPoint;this.globalTransformMatrix.transformPoint(1e3,-200,f),this._hullCache[0]=f.x,this._hullCache[1]=f.y,this._hullCache[2]=u-f.x,this._hullCache[3]=_-f.y,this.globalTransformMatrix.transformPoint(0,this._dY,f,!0),this._hullCache[4]=f.x,this._hullCache[5]=f.y,this.globalTransformMatrix.transformPoint(200,1e3,f),this._hullCache[6]=f.x,this._hullCache[7]=f.y,this._hullCache[8]=u-f.x,this._hullCache[9]=_-f.y,this.globalTransformMatrix.transformPoint(this._dX,0,f,!0),this._hullCache[10]=f.x,this._hullCache[11]=f.y}else this._childrenTransformDirty&&(this._childrenTransformDirty=!1);this._localDirty=!0},e}(t.Bone);t.Surface=e}(t3||(t3={})),function(t){var e=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n._localMatrix=new t.Matrix,n._colorTransform=new t.ColorTransform,n._displayDatas=[],n._displayList=[],n._deformVertices=null,n._rawDisplay=null,n._meshDisplay=null,n}return $4(n,e),n.prototype._onClear=function(){e.prototype._onClear.call(this);for(var n=[],i=0,r=this._displayList;i<r.length;i++)null!==(s=r[i])&&s!==this._rawDisplay&&s!==this._meshDisplay&&n.indexOf(s)<0&&n.push(s);for(var a=0,o=n;a<o.length;a++){var s;(s=o[a])instanceof t.Armature?s.dispose():this._disposeDisplay(s,!0)}null!==this._deformVertices&&this._deformVertices.returnToPool(),null!==this._meshDisplay&&this._meshDisplay!==this._rawDisplay&&this._disposeDisplay(this._meshDisplay,!1),null!==this._rawDisplay&&this._disposeDisplay(this._rawDisplay,!1),this.displayController=null,this._displayDirty=!1,this._zOrderDirty=!1,this._blendModeDirty=!1,this._colorDirty=!1,this._transformDirty=!1,this._visible=!0,this._blendMode=0,this._displayIndex=-1,this._animationDisplayIndex=-1,this._zOrder=0,this._cachedFrameIndex=-1,this._pivotX=0,this._pivotY=0,this._localMatrix.identity(),this._colorTransform.identity(),this._displayList.length=0,this._displayDatas.length=0,this._slotData=null,this._rawDisplayDatas=null,this._displayData=null,this._boundingBoxData=null,this._textureData=null,this._deformVertices=null,this._rawDisplay=null,this._meshDisplay=null,this._display=null,this._childArmature=null,this._parent=null,this._cachedFrameIndices=null},n.prototype._getDefaultRawDisplayData=function(t){var e=this._armature._armatureData.defaultSkin;if(null!==e){var n=e.getDisplays(this._slotData.name);if(null!==n)return t<n.length?n[t]:null}return null},n.prototype._updateDisplayData=function(){var e=this._displayData,i=null!==this._deformVertices?this._deformVertices.verticesData:null,r=this._textureData,a=null,o=null;if(this._displayData=null,this._boundingBoxData=null,this._textureData=null,this._displayIndex>=0&&(null!==this._rawDisplayDatas&&(a=this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null),null===a&&(a=this._getDefaultRawDisplayData(this._displayIndex)),this._displayIndex<this._displayDatas.length&&(this._displayData=this._displayDatas[this._displayIndex])),null!==this._displayData&&(2===this._displayData.type||4===this._displayData.type?o=this._displayData.vertices:null!==a&&(2===a.type||4===a.type)&&(o=a.vertices),3===this._displayData.type?this._boundingBoxData=this._displayData.boundingBox:null!==a&&3===a.type&&(this._boundingBoxData=a.boundingBox),(0===this._displayData.type||2===this._displayData.type)&&(this._textureData=this._displayData.texture)),this._displayData!==e||o!==i||this._textureData!==r){if(null===o&&null!==this._textureData){var s=this._displayData,c=this._textureData.parent.scale*this._armature._armatureData.scale,l=this._textureData.frame;this._pivotX=s.pivot.x,this._pivotY=s.pivot.y;var h=null!==l?l:this._textureData.region,u=h.width,_=h.height;this._textureData.rotated&&null===l&&(u=h.height,_=h.width),this._pivotX*=u*c,this._pivotY*=_*c,null!==l&&(this._pivotX+=l.x*c,this._pivotY+=l.y*c),null!==this._displayData&&null!==a&&this._displayData!==a&&(a.transform.toMatrix(n._helpMatrix),n._helpMatrix.invert(),n._helpMatrix.transformPoint(0,0,n._helpPoint),this._pivotX-=n._helpPoint.x,this._pivotY-=n._helpPoint.y,this._displayData.transform.toMatrix(n._helpMatrix),n._helpMatrix.invert(),n._helpMatrix.transformPoint(0,0,n._helpPoint),this._pivotX+=n._helpPoint.x,this._pivotY+=n._helpPoint.y),t.DragonBones.yDown||(this._pivotY=(this._textureData.rotated?this._textureData.region.width:this._textureData.region.height)*c-this._pivotY)}else this._pivotX=0,this._pivotY=0;null!==a?this.origin=a.transform:null!==this._displayData?this.origin=this._displayData.transform:this.origin=null,o!==i?(null===this._deformVertices&&(this._deformVertices=t.BaseObject.borrowObject(t.DeformVertices)),this._deformVertices.init(o,this._armature)):null!==this._deformVertices&&this._textureData!==r&&(this._deformVertices.verticesDirty=!0),this._displayDirty=!0,this._transformDirty=!0}},n.prototype._updateDisplay=function(){var e=null!==this._display?this._display:this._rawDisplay,n=this._childArmature;this._displayIndex>=0&&this._displayIndex<this._displayList.length?(this._display=this._displayList[this._displayIndex],null!==this._display&&this._display instanceof t.Armature?(this._childArmature=this._display,this._display=this._childArmature.display):this._childArmature=null):(this._display=null,this._childArmature=null);var i=null!==this._display?this._display:this._rawDisplay;if(i!==e&&(this._onUpdateDisplay(),this._replaceDisplay(e),this._transformDirty=!0,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0),i!==this._rawDisplay&&i!==this._meshDisplay||this._updateFrame(),this._childArmature!==n&&(null!==n&&(n._parent=null,n.clock=null,n.inheritAnimation&&n.animation.reset()),null!==this._childArmature&&(this._childArmature._parent=this,this._childArmature.clock=this._armature.clock,this._childArmature.inheritAnimation))){if(0===this._childArmature.cacheFrameRate){var r=this._armature.cacheFrameRate;0!==r&&(this._childArmature.cacheFrameRate=r)}var a=null;if(null!==this._displayData&&1===this._displayData.type)a=this._displayData.actions;else if(this._displayIndex>=0&&null!==this._rawDisplayDatas){var o=this._displayIndex<this._rawDisplayDatas.length?this._rawDisplayDatas[this._displayIndex]:null;null===o&&(o=this._getDefaultRawDisplayData(this._displayIndex)),null!==o&&1===o.type&&(a=o.actions)}if(null!==a&&a.length>0)for(var s=0,c=a;s<c.length;s++){var l=c[s],h=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(l,h,this._armature),h.slot=this,this._armature._bufferAction(h,!1)}else this._childArmature.animation.play()}},n.prototype._updateGlobalTransformMatrix=function(t){var e=0===this._parent._boneData.type?this._parent.globalTransformMatrix:this._parent._getGlobalTransformMatrix(this.global.x,this.global.y);this.globalTransformMatrix.copyFrom(this._localMatrix),this.globalTransformMatrix.concat(e),t?this.global.fromMatrix(this.globalTransformMatrix):this._globalDirty=!0},n.prototype._setDisplayIndex=function(t,e){if(void 0===e&&(e=!1),e){if(this._animationDisplayIndex===t)return!1;this._animationDisplayIndex=t}return this._displayIndex!==t&&(this._displayIndex=t,this._displayDirty=!0,this._updateDisplayData(),this._displayDirty)},n.prototype._setZorder=function(t){return this._zOrder,this._zOrder=t,this._zOrderDirty=!0,this._zOrderDirty},n.prototype._setColor=function(t){return this._colorTransform.copyFrom(t),this._colorDirty=!0,this._colorDirty},n.prototype._setDisplayList=function(e){if(null!==e&&e.length>0){this._displayList.length!==e.length&&(this._displayList.length=e.length);for(var n=0,i=e.length;n<i;++n){var r=e[n];null!==r&&r!==this._rawDisplay&&r!==this._meshDisplay&&!(r instanceof t.Armature)&&this._displayList.indexOf(r)<0&&this._initDisplay(r,!0),this._displayList[n]=r}}else this._displayList.length>0&&(this._displayList.length=0);return this._displayIndex>=0&&this._displayIndex<this._displayList.length?this._displayDirty=this._display!==this._displayList[this._displayIndex]:this._displayDirty=null!==this._display,this._updateDisplayData(),this._displayDirty},n.prototype.init=function(t,e,n,i){if(null===this._slotData){this._slotData=t,this._isFromCache=!1,this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0,this._blendMode=this._slotData.blendMode,this._zOrder=this._slotData.zOrder,this._colorTransform.copyFrom(this._slotData.color),this._rawDisplay=n,this._meshDisplay=i,this._armature=e;var r=this._armature.getBone(this._slotData.parent.name);null!==r&&(this._parent=r),this._armature._addSlot(this),this._initDisplay(this._rawDisplay,!1),this._rawDisplay!==this._meshDisplay&&this._initDisplay(this._meshDisplay,!1),this._onUpdateDisplay(),this._addDisplay()}},n.prototype.update=function(t){if(this._isFromCache=!1,this._displayDirty&&(this._displayDirty=!1,this._updateDisplay(),this._transformDirty&&(null!==this.origin?this.global.copyFrom(this.origin).add(this.offset).toMatrix(this._localMatrix):this.global.copyFrom(this.offset).toMatrix(this._localMatrix))),this._zOrderDirty&&(this._zOrderDirty=!1,this._updateZOrder()),t>=0&&null!==this._cachedFrameIndices){var e=this._cachedFrameIndices[t];e>=0&&this._cachedFrameIndex===e?this._transformDirty=!1:e>=0?(this._transformDirty=!0,this._cachedFrameIndex=e):this._transformDirty||this._parent._childrenTransformDirty?(this._transformDirty=!0,this._cachedFrameIndex=-1):this._cachedFrameIndex>=0?(this._transformDirty=!1,this._cachedFrameIndices[t]=this._cachedFrameIndex):(this._transformDirty=!0,this._cachedFrameIndex=-1)}else(this._transformDirty||this._parent._childrenTransformDirty)&&(t=-1,this._transformDirty=!0,this._cachedFrameIndex=-1);if(null!==this._display){if(this._visibleDirty&&(this._visibleDirty=!1,this._updateVisible()),this._blendModeDirty&&(this._blendModeDirty=!1,this._updateBlendMode()),this._colorDirty&&(this._colorDirty=!1,this._updateColor()),null!==this._deformVertices&&null!==this._deformVertices.verticesData&&this._display===this._meshDisplay){var n=null!==this._deformVertices.verticesData.weight,i=0!==this._parent._boneData.type;if((this._deformVertices.verticesDirty||n&&this._deformVertices.isBonesUpdate()||i&&this._parent._childrenTransformDirty)&&(this._deformVertices.verticesDirty=!1,this._updateMesh()),n||i)return}if(this._transformDirty){if(this._transformDirty=!1,this._cachedFrameIndex<0){var r=t>=0;this._updateGlobalTransformMatrix(r),r&&null!==this._cachedFrameIndices&&(this._cachedFrameIndex=this._cachedFrameIndices[t]=this._armature._armatureData.setCacheFrame(this.globalTransformMatrix,this.global))}else this._isFromCache=!0,this._armature._armatureData.getCacheFrame(this.globalTransformMatrix,this.global,this._cachedFrameIndex);this._updateTransform()}}},n.prototype.updateTransformAndMatrix=function(){this._transformDirty&&(this._transformDirty=!1,this._updateGlobalTransformMatrix(!1))},n.prototype.replaceDisplayData=function(t,e){if(void 0===e&&(e=-1),e<0&&(e=this._displayIndex<0?0:this._displayIndex),this._displayDatas.length<=e){this._displayDatas.length=e+1;for(var n=0,i=this._displayDatas.length;n<i;++n)this._displayDatas[n]||(this._displayDatas[n]=null)}this._displayDatas[e]=t},n.prototype.containsPoint=function(t,e){return null!==this._boundingBoxData&&(this.updateTransformAndMatrix(),n._helpMatrix.copyFrom(this.globalTransformMatrix),n._helpMatrix.invert(),n._helpMatrix.transformPoint(t,e,n._helpPoint),this._boundingBoxData.containsPoint(n._helpPoint.x,n._helpPoint.y))},n.prototype.intersectsSegment=function(t,e,i,r,a,o,s){if(void 0===a&&(a=null),void 0===o&&(o=null),void 0===s&&(s=null),null===this._boundingBoxData)return 0;this.updateTransformAndMatrix(),n._helpMatrix.copyFrom(this.globalTransformMatrix),n._helpMatrix.invert(),n._helpMatrix.transformPoint(t,e,n._helpPoint),t=n._helpPoint.x,e=n._helpPoint.y,n._helpMatrix.transformPoint(i,r,n._helpPoint),i=n._helpPoint.x,r=n._helpPoint.y;var c=this._boundingBoxData.intersectsSegment(t,e,i,r,a,o,s);return c>0&&(1===c||2===c?null!==a?(this.globalTransformMatrix.transformPoint(a.x,a.y,a),null!==o&&(o.x=a.x,o.y=a.y)):null!==o&&this.globalTransformMatrix.transformPoint(o.x,o.y,o):(null!==a&&this.globalTransformMatrix.transformPoint(a.x,a.y,a),null!==o&&this.globalTransformMatrix.transformPoint(o.x,o.y,o)),null!==s&&(this.globalTransformMatrix.transformPoint(Math.cos(s.x),Math.sin(s.x),n._helpPoint,!0),s.x=Math.atan2(n._helpPoint.y,n._helpPoint.x),this.globalTransformMatrix.transformPoint(Math.cos(s.y),Math.sin(s.y),n._helpPoint,!0),s.y=Math.atan2(n._helpPoint.y,n._helpPoint.x))),c},n.prototype.invalidUpdate=function(){this._displayDirty=!0,this._transformDirty=!0},Object.defineProperty(n.prototype,"visible",{get:function(){return this._visible},set:function(t){this._visible!==t&&(this._visible=t,this._updateVisible())},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"displayIndex",{get:function(){return this._displayIndex},set:function(t){this._setDisplayIndex(t)&&this.update(-1)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"name",{get:function(){return this._slotData.name},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"displayList",{get:function(){return this._displayList.concat()},set:function(e){var n=this._displayList.concat(),i=new Array;this._setDisplayList(e)&&this.update(-1);for(var r=0,a=n;r<a.length;r++)null!==(c=a[r])&&c!==this._rawDisplay&&c!==this._meshDisplay&&this._displayList.indexOf(c)<0&&i.indexOf(c)<0&&i.push(c);for(var o=0,s=i;o<s.length;o++){var c;(c=s[o])instanceof t.Armature||this._disposeDisplay(c,!0)}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"slotData",{get:function(){return this._slotData},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rawDisplayDatas",{get:function(){return this._rawDisplayDatas},set:function(t){if(this._rawDisplayDatas!==t)if(this._displayDirty=!0,this._rawDisplayDatas=t,null!==this._rawDisplayDatas){this._displayDatas.length=this._rawDisplayDatas.length;for(var e=0,n=this._displayDatas.length;e<n;++e){var i=this._rawDisplayDatas[e];null===i&&(i=this._getDefaultRawDisplayData(e)),this._displayDatas[e]=i}}else this._displayDatas.length=0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"displayData",{get:function(){return this._displayData},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"boundingBoxData",{get:function(){return this._boundingBoxData},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"rawDisplay",{get:function(){return this._rawDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"meshDisplay",{get:function(){return this._meshDisplay},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"display",{get:function(){return this._display},set:function(t){if(this._display!==t){var e=this._displayList.length;if(this._displayIndex<0&&0===e&&(this._displayIndex=0),!(this._displayIndex<0)){var n=this.displayList;e<=this._displayIndex&&(n.length=this._displayIndex+1),n[this._displayIndex]=t,this.displayList=n}}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"childArmature",{get:function(){return this._childArmature},set:function(t){this._childArmature!==t&&(this.display=t)},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"parent",{get:function(){return this._parent},enumerable:!0,configurable:!0}),n.prototype.getDisplay=function(){return this._display},n.prototype.setDisplay=function(t){this.display=t},n}(t.TransformObject);t.Slot=e}(t3||(t3={})),function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return $4(n,e),n.prototype._onClear=function(){this._armature=null,this._target=null,this._root=null,this._bone=null},Object.defineProperty(n.prototype,"name",{get:function(){return this._constraintData.name},enumerable:!0,configurable:!0}),n._helpMatrix=new t.Matrix,n._helpTransform=new t.Transform,n._helpPoint=new t.Point,n}(t.BaseObject);t.Constraint=e;var n=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return $4(n,e),n.toString=function(){return"[class dragonBones.IKConstraint]"},n.prototype._onClear=function(){e.prototype._onClear.call(this),this._scaleEnabled=!1,this._bendPositive=!1,this._weight=1,this._constraintData=null},n.prototype._computeA=function(){var e=this._target.global,n=this._root.global,i=this._root.globalTransformMatrix,r=Math.atan2(e.y-n.y,e.x-n.x);n.scaleX<0&&(r+=Math.PI),n.rotation+=t.Transform.normalizeRadian(r-n.rotation)*this._weight,n.toMatrix(i)},n.prototype._computeB=function(){var e=this._bone._boneData.length,n=this._root,i=this._target.global,r=n.global,a=this._bone.global,o=this._bone.globalTransformMatrix,s=o.a*e,c=o.b*e,l=s*s+c*c,h=Math.sqrt(l),u=a.x-r.x,_=a.y-r.y,f=u*u+_*_,d=Math.sqrt(f),p=a.rotation,m=r.rotation,v=Math.atan2(_,u),g=(u=i.x-r.x)*u+(_=i.y-r.y)*_,y=Math.sqrt(g),x=0;if(h+d<=y||y+h<=d||y+d<=h)x=Math.atan2(i.y-r.y,i.x-r.x),h+d<=y||d<h&&(x+=Math.PI);else{var S=(f-l+g)/(2*g),A=Math.sqrt(f-S*S*g)/y,b=r.x+u*S,C=r.y+_*S,T=-_*A,E=u*A,w=!1,I=n.parent;if(null!==I){var P=I.globalTransformMatrix;w=P.a*P.d-P.b*P.c<0}w!==this._bendPositive?(a.x=b-T,a.y=C-E):(a.x=b+T,a.y=C+E),x=Math.atan2(a.y-r.y,a.x-r.x)}var D=t.Transform.normalizeRadian(x-v);r.rotation=m+D*this._weight,r.toMatrix(n.globalTransformMatrix);var R=v+D*this._weight;a.x=r.x+Math.cos(R)*d,a.y=r.y+Math.sin(R)*d;var M=Math.atan2(i.y-a.y,i.x-a.x);a.scaleX<0&&(M+=Math.PI),a.rotation=r.rotation+p-m+t.Transform.normalizeRadian(M-D-p)*this._weight,a.toMatrix(o)},n.prototype.init=function(t,e){if(null===this._constraintData){this._constraintData=t,this._armature=e,this._target=this._armature.getBone(this._constraintData.target.name),this._root=this._armature.getBone(this._constraintData.root.name),this._bone=null!==this._constraintData.bone?this._armature.getBone(this._constraintData.bone.name):null;var n=this._constraintData;this._scaleEnabled=n.scaleEnabled,this._bendPositive=n.bendPositive,this._weight=n.weight,this._root._hasConstraint=!0}},n.prototype.update=function(){this._root.updateByConstraint(),null!==this._bone?(this._bone.updateByConstraint(),this._computeB()):this._computeA()},n.prototype.invalidUpdate=function(){this._root.invalidUpdate(),null!==this._bone&&this._bone.invalidUpdate()},n}(e);t.IKConstraint=n;var i=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._bones=[],t._spaces=[],t._positions=[],t._curves=[],t._boneLengths=[],t._pathGlobalVertices=[],t._segments=[10],t}return $4(n,e),n.toString=function(){return"[class dragonBones.PathConstraint]"},n.prototype._onClear=function(){e.prototype._onClear.call(this),this.dirty=!1,this.pathOffset=0,this.position=0,this.spacing=0,this.rotateOffset=0,this.rotateMix=1,this.translateMix=1,this._pathSlot=null,this._bones.length=0,this._spaces.length=0,this._positions.length=0,this._curves.length=0,this._boneLengths.length=0,this._pathGlobalVertices.length=0},n.prototype._updatePathVertices=function(t){var e=this._armature,n=e.armatureData.parent,i=e.armatureData.scale,r=n.intArray,a=n.floatArray,o=t.offset,s=r[o+0],c=r[o+2];this._pathGlobalVertices.length=2*s;var l=t.weight;if(null!==l)for(var h=this._pathSlot._deformVertices.bones,u=l.bones.length,_=l.offset,f=r[_+1],d=_+2+u,p=(C=0,0);C<s;C++){for(var m=0,v=0,g=0,y=r[d++];g<y;g++){var x=h[r[d++]];if(null!==x){x.updateByConstraint(),b=x.globalTransformMatrix;var S=a[f++];E=a[f++]*i,w=a[f++]*i,m+=(b.a*E+b.c*w+b.tx)*S,v+=(b.b*E+b.d*w+b.ty)*S}}this._pathGlobalVertices[p++]=m,this._pathGlobalVertices[p++]=v}else{var A=this._pathSlot.parent;A.updateByConstraint();for(var b=A.globalTransformMatrix,C=0,T=c;C<s;C+=2){var E=a[T++]*i,w=a[T++]*i,I=b.a*E+b.c*w+b.tx,P=b.b*E+b.d*w+b.ty;this._pathGlobalVertices[C]=I,this._pathGlobalVertices[C+1]=P}}},n.prototype._computeVertices=function(t,e,n,i){for(var r=n,a=t;r<e;r+=2)i[r]=this._pathGlobalVertices[a++],i[r+1]=this._pathGlobalVertices[a++]},n.prototype._computeBezierCurve=function(t,e,n,i,r){var a=this._armature.armatureData.parent.intArray[t.vertices.offset+0],o=this._positions,s=this._spaces,c=t.closed,l=Array(),h=2*a,u=h/6,_=-1,f=this.position;o.length=3*e+2;var d=0;if(t.constantSpeed){c?(h+=2,l.length=a,this._computeVertices(2,h-4,0,l),this._computeVertices(0,2,h-4,l),l[h-2]=l[0],l[h-1]=l[1]):(u--,h-=4,l.length=h,this._computeVertices(2,h,0,l));var p=new Array(u);d=0;for(var m,v,g,y,x,S,A,b,C=l[0],T=l[1],E=0,w=0,I=0,P=0,D=0,R=0,M=(G=0,2);G<u;G++,M+=6)E=l[M],w=l[M+1],I=l[M+2],P=l[M+3],x=2*(m=.1875*(C-2*E+I))+(g=.09375*(3*(E-I)-C+(D=l[M+4]))),S=2*(v=.1875*(T-2*w+P))+(y=.09375*(3*(w-P)-T+(R=l[M+5]))),A=.75*(E-C)+m+.16666667*g,b=.75*(w-T)+v+.16666667*y,d+=Math.sqrt(A*A+b*b),A+=x,b+=S,x+=g,S+=y,d+=Math.sqrt(A*A+b*b),A+=x,b+=S,d+=Math.sqrt(A*A+b*b),A+=x+g,b+=S+y,d+=Math.sqrt(A*A+b*b),p[G]=d,C=D,T=R;if(i&&(f*=d),r)for(G=0;G<e;G++)s[G]*=d;for(var O=this._segments,N=0,B=(G=0,H=0,j=0,0);G<e;G++,H+=3){var L=f+=s[G];if(c)(L%=d)<0&&(L+=d),j=0;else{if(L<0)continue;if(L>d)continue}for(;;j++){var F=p[j];if(!(L>F)){0===j?L/=F:L=(L-(k=p[j-1]))/(F-k);break}}if(j!==_){_=j;var V=6*j;for(C=l[V],T=l[V+1],E=l[V+2],w=l[V+3],I=l[V+4],P=l[V+5],x=2*(m=.03*(C-2*E+I))+(g=.006*(3*(E-I)-C+(D=l[V+6]))),S=2*(v=.03*(T-2*w+P))+(y=.006*(3*(w-P)-T+(R=l[V+7]))),A=.3*(E-C)+m+.16666667*g,b=.3*(w-T)+v+.16666667*y,N=Math.sqrt(A*A+b*b),O[0]=N,V=1;V<8;V++)A+=x,b+=S,x+=g,S+=y,N+=Math.sqrt(A*A+b*b),O[V]=N;A+=x,b+=S,N+=Math.sqrt(A*A+b*b),O[8]=N,A+=x+g,b+=S+y,N+=Math.sqrt(A*A+b*b),O[9]=N,B=0}for(L*=N;;B++){var z=O[B];if(!(L>z)){var k;0===B?L/=z:L=B+(L-(k=O[B-1]))/(z-k);break}}this.addCurvePosition(.1*L,C,T,E,w,I,P,D,R,o,H,n)}}else{var U=t.curveLengths;if(d=U[u-=c?1:2],i&&(f*=d),r)for(var G=0;G<e;G++)s[G]*=d;l.length=8;G=0;for(var H=0,j=0;G<e;G++,H+=3){if(f+=s[G],c)(f%=d)<0&&(f+=d),j=0;else{if(f<0)continue;if(f>d)continue}for(var W=0;;j++){var q=U[j];if(!(f>q)){if(0===j)W=f/q;else{var X=U[j-1];W=(f-X)/(q-X)}break}}j!==_&&(_=j,c&&j===u?(this._computeVertices(h-4,4,0,l),this._computeVertices(0,4,4,l)):this._computeVertices(6*j+2,8,0,l)),this.addCurvePosition(W,l[0],l[1],l[2],l[3],l[4],l[5],l[6],l[7],o,H,n)}}},n.prototype.addCurvePosition=function(t,e,n,i,r,a,o,s,c,l,h,u){if(0===t)return l[h]=e,l[h+1]=n,void(l[h+2]=0);if(1===t)return l[h]=s,l[h+1]=c,void(l[h+2]=0);var _=1-t,f=_*_,d=t*t,p=f*_,m=f*t*3,v=_*d*3,g=t*d,y=p*e+m*i+v*a+g*s,x=p*n+m*r+v*o+g*c;l[h]=y,l[h+1]=x,l[h+2]=u?Math.atan2(x-(p*n+m*r+v*o),y-(p*e+m*i+v*a)):0},n.prototype.init=function(t,e){this._constraintData=t,this._armature=e;var n=t;this.pathOffset=n.pathDisplayData.vertices.offset,this.position=n.position,this.spacing=n.spacing,this.rotateOffset=n.rotateOffset,this.rotateMix=n.rotateMix,this.translateMix=n.translateMix,this._root=this._armature.getBone(n.root.name),this._target=this._armature.getBone(n.target.name),this._pathSlot=this._armature.getSlot(n.pathSlot.name);for(var i=0,r=n.bones.length;i<r;i++){var a=this._armature.getBone(n.bones[i].name);null!==a&&this._bones.push(a)}2===n.rotateMode&&(this._boneLengths.length=this._bones.length),this._root._hasConstraint=!0},n.prototype.update=function(){var e=this._pathSlot;if(null!==e._deformVertices&&null!==e._deformVertices.verticesData&&e._deformVertices.verticesData.offset===this.pathOffset){var n=this._constraintData,i=e._displayData,r=!1,a=e._deformVertices;if(this._root._childrenTransformDirty?(this._updatePathVertices(i.vertices),r=!0):null!==a&&(a.verticesDirty||a.isBonesUpdate())&&(this._updatePathVertices(i.vertices),a.verticesDirty=!1,r=!0),r||this.dirty){var o=n.positionMode,s=n.spacingMode,c=n.rotateMode,l=this._bones,h=0===s,u=2===c,_=0===c,f=l.length,d=_?f:f+1,p=this.spacing,m=this._spaces;if(m.length=d,u||h){m[0]=0;for(var v=0,g=d-1;v<g;v++){(R=l[v]).updateByConstraint();var y=R._boneData.length,x=y*(M=R.globalTransformMatrix).a,S=y*M.b,A=Math.sqrt(x*x+S*S);u&&(this._boneLengths[v]=A),m[v+1]=(y+p)*A/y}}else for(v=0;v<d;v++)m[v]=p;this._computeBezierCurve(i,d,_,1===o,2===s);var b,C=this._positions,T=this.rotateOffset,E=C[0],w=C[1];0===T?b=1===c:(b=!1,null!==(R=e.parent)&&(T*=(M=R.globalTransformMatrix).a*M.d-M.b*M.c>0?t.Transform.DEG_RAD:-t.Transform.DEG_RAD));for(var I=this.rotateMix,P=this.translateMix,D=(v=0,3);v<f;v++,D+=3){var R,M;(R=l[v]).updateByConstraint(),(M=R.globalTransformMatrix).tx+=(E-M.tx)*P,M.ty+=(w-M.ty)*P;var O=(x=C[D])-E,N=(S=C[D+1])-w;if(u){var B=this._boneLengths[v],L=(Math.sqrt(O*O+N*N)/B-1)*I+1;M.a*=L,M.b*=L}if(E=x,w=S,I>0){var F=M.a,V=M.b,z=M.c,k=M.d,U=void 0,G=void 0,H=void 0;if(U=_?C[D-1]:Math.atan2(N,O),U-=Math.atan2(V,F),b){G=Math.cos(U),H=Math.sin(U);var j=R._boneData.length;E+=(j*(G*F-H*V)-O)*I,w+=(j*(H*F+G*V)-N)*I}else U+=T;U>t.Transform.PI?U-=t.Transform.PI_D:U<-t.Transform.PI&&(U+=t.Transform.PI_D),U*=I,G=Math.cos(U),H=Math.sin(U),M.a=G*F-H*V,M.b=H*F+G*V,M.c=G*z-H*k,M.d=H*z+G*k}R.global.fromMatrix(M)}this.dirty=!1}}},n.prototype.invalidUpdate=function(){},n}(e);t.PathConstraint=i}(t3||(t3={})),function(t){var e=function(){function t(t){void 0===t&&(t=0),this.time=0,this.timeScale=1,this._systemTime=0,this._animatebles=[],this._clock=null,this.time=t,this._systemTime=.001*(new Date).getTime()}return t.prototype.advanceTime=function(t){t!=t&&(t=0);var e=.001*Date.now();if(t<0&&(t=e-this._systemTime),this._systemTime=e,1!==this.timeScale&&(t*=this.timeScale),0!==t){t<0?this.time-=t:this.time+=t;for(var n=0,i=0,r=this._animatebles.length;n<r;++n){var a=this._animatebles[n];null!==a?(i>0&&(this._animatebles[n-i]=a,this._animatebles[n]=null),a.advanceTime(t)):i++}if(i>0){for(r=this._animatebles.length;n<r;++n){var o=this._animatebles[n];null!==o?this._animatebles[n-i]=o:i++}this._animatebles.length-=i}}},t.prototype.contains=function(t){if(t===this)return!1;for(var e=t;e!==this&&null!==e;)e=e.clock;return e===this},t.prototype.add=function(t){this._animatebles.indexOf(t)<0&&(this._animatebles.push(t),t.clock=this)},t.prototype.remove=function(t){var e=this._animatebles.indexOf(t);e>=0&&(this._animatebles[e]=null,t.clock=null)},t.prototype.clear=function(){for(var t=0,e=this._animatebles;t<e.length;t++){var n=e[t];null!==n&&(n.clock=null)}},Object.defineProperty(t.prototype,"clock",{get:function(){return this._clock},set:function(t){this._clock!==t&&(null!==this._clock&&this._clock.remove(this),this._clock=t,null!==this._clock&&this._clock.add(this))},enumerable:!0,configurable:!0}),t.clock=new t,t}();t.WorldClock=e}(t3||(t3={})),function(t){var e=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._animationNames=[],t._animationStates=[],t._animations={},t._animationConfig=null,t}return $4(n,e),n.toString=function(){return"[class dragonBones.Animation]"},n.prototype._onClear=function(){for(var t=0,e=this._animationStates;t<e.length;t++)e[t].returnToPool();for(var n in this._animations)delete this._animations[n];null!==this._animationConfig&&this._animationConfig.returnToPool(),this.timeScale=1,this._lockUpdate=!1,this._animationDirty=!1,this._inheritTimeScale=1,this._animationNames.length=0,this._animationStates.length=0,this._armature=null,this._animationConfig=null,this._lastAnimationState=null},n.prototype._fadeOut=function(t){switch(t.fadeOutMode){case 1:for(var e=0,n=this._animationStates;e<n.length;e++)null===(l=n[e])._parent&&l.layer===t.layer&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 2:for(var i=0,r=this._animationStates;i<r.length;i++)null===(l=r[i])._parent&&l.group===t.group&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 3:for(var a=0,o=this._animationStates;a<o.length;a++)null===(l=o[a])._parent&&l.layer===t.layer&&l.group===t.group&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut);break;case 4:for(var s=0,c=this._animationStates;s<c.length;s++){var l;null===(l=c[s])._parent&&l.fadeOut(t.fadeOutTime,t.pauseFadeOut)}}},n.prototype.init=function(e){null===this._armature&&(this._armature=e,this._animationConfig=t.BaseObject.borrowObject(t.AnimationConfig))},n.prototype.advanceTime=function(t){t<0&&(t=-t),this._armature.inheritAnimation&&null!==this._armature._parent?this._inheritTimeScale=this._armature._parent._armature.animation._inheritTimeScale*this.timeScale:this._inheritTimeScale=this.timeScale,1!==this._inheritTimeScale&&(t*=this._inheritTimeScale);var e=this._animationStates.length;if(1===e)if((d=this._animationStates[0])._fadeState>0&&d._subFadeState>0)this._armature._dragonBones.bufferObject(d),this._animationStates.length=0,this._lastAnimationState=null;else{var n=d._animationData,i=n.cacheFrameRate;if(this._animationDirty&&i>0){this._animationDirty=!1;for(var r=0,a=this._armature.getBones();r<a.length;r++){var o=a[r];o._cachedFrameIndices=n.getBoneCachedFrameIndices(o.name)}for(var s=0,c=this._armature.getSlots();s<c.length;s++){var l=c[s],h=l.rawDisplayDatas;if(null!==h&&h.length>0){var u=h[0];if(null!==u&&u.parent===this._armature.armatureData.defaultSkin){l._cachedFrameIndices=n.getSlotCachedFrameIndices(l.name);continue}}l._cachedFrameIndices=null}}d.advanceTime(t,i)}else if(e>1){for(var _=0,f=0;_<e;++_){var d;(d=this._animationStates[_])._fadeState>0&&d._subFadeState>0?(f++,this._armature._dragonBones.bufferObject(d),this._animationDirty=!0,this._lastAnimationState===d&&(this._lastAnimationState=null)):(f>0&&(this._animationStates[_-f]=d),d.advanceTime(t,0)),_===e-1&&f>0&&(this._animationStates.length-=f,null===this._lastAnimationState&&this._animationStates.length>0&&(this._lastAnimationState=this._animationStates[this._animationStates.length-1]))}this._armature._cacheFrameIndex=-1}else this._armature._cacheFrameIndex=-1},n.prototype.reset=function(){for(var t=0,e=this._animationStates;t<e.length;t++)e[t].returnToPool();this._animationDirty=!1,this._animationConfig.clear(),this._animationStates.length=0,this._lastAnimationState=null},n.prototype.stop=function(t){if(void 0===t&&(t=null),null!==t)null!==(i=this.getState(t))&&i.stop();else for(var e=0,n=this._animationStates;e<n.length;e++){var i;(i=n[e]).stop()}},n.prototype.playConfig=function(e){var n=e.animation;if(!(n in this._animations))return console.warn("Non-existent animation.\n","DragonBones name: "+this._armature.armatureData.parent.name,"Armature name: "+this._armature.name,"Animation name: "+n),null;var i=this._animations[n];if(5===e.fadeOutMode)for(var r=0,a=this._animationStates;r<a.length;r++){var o=a[r];if(o._animationData===i)return o}0===this._animationStates.length?e.fadeInTime=0:e.fadeInTime<0&&(e.fadeInTime=i.fadeInTime),e.fadeOutTime<0&&(e.fadeOutTime=e.fadeInTime),e.timeScale<=-100&&(e.timeScale=1/i.scale),i.frameCount>1?(e.position<0?(e.position%=i.duration,e.position=i.duration-e.position):e.position===i.duration?e.position-=1e-6:e.position>i.duration&&(e.position%=i.duration),e.duration>0&&e.position+e.duration>i.duration&&(e.duration=i.duration-e.position),e.playTimes<0&&(e.playTimes=i.playTimes)):(e.playTimes=1,e.position=0,e.duration>0&&(e.duration=0)),0===e.duration&&(e.duration=-1),this._fadeOut(e);var s=t.BaseObject.borrowObject(t.AnimationState);if(s.init(this._armature,i,e),this._animationDirty=!0,this._armature._cacheFrameIndex=-1,this._animationStates.length>0){for(var c=!1,l=0,h=this._animationStates.length;l<h;++l){if(s.layer>this._animationStates[l].layer){c=!0,this._animationStates.splice(l,0,s);break}if(l!==h-1&&s.layer>this._animationStates[l+1].layer){c=!0,this._animationStates.splice(l+1,0,s);break}}c||this._animationStates.push(s)}else this._animationStates.push(s);for(var u=0,_=this._armature.getSlots();u<_.length;u++){var f=_[u].childArmature;null!==f&&f.inheritAnimation&&f.animation.hasAnimation(n)&&null===f.animation.getState(n)&&f.animation.fadeIn(n)}var d=!1;for(var p in i.animationTimelines){this._lockUpdate||(d=!0,this._lockUpdate=!0);var m=this.fadeIn(p,e.fadeInTime,1,s.layer,null,0);null!==m&&(m.resetToPose=!1,m._parent=s,m.stop())}return d&&(this._lockUpdate=!1),this._lockUpdate||(e.fadeInTime<=0&&this._armature.advanceTime(0),this._lastAnimationState=s),s},n.prototype.play=function(t,e){if(void 0===t&&(t=null),void 0===e&&(e=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=null!==t?t:"",null!==t&&t.length>0)this.playConfig(this._animationConfig);else if(null===this._lastAnimationState){var n=this._armature.armatureData.defaultAnimation;null!==n&&(this._animationConfig.animation=n.name,this.playConfig(this._animationConfig))}else this._lastAnimationState.isPlaying||this._lastAnimationState.isCompleted?(this._animationConfig.animation=this._lastAnimationState.name,this.playConfig(this._animationConfig)):this._lastAnimationState.play();return this._lastAnimationState},n.prototype.fadeIn=function(t,e,n,i,r,a){return void 0===e&&(e=-1),void 0===n&&(n=-1),void 0===i&&(i=0),void 0===r&&(r=null),void 0===a&&(a=3),this._animationConfig.clear(),this._animationConfig.fadeOutMode=a,this._animationConfig.playTimes=n,this._animationConfig.layer=i,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==r?r:"",this.playConfig(this._animationConfig)},n.prototype.gotoAndPlayByTime=function(t,e,n){return void 0===e&&(e=0),void 0===n&&(n=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=n,this._animationConfig.position=e,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t,this.playConfig(this._animationConfig)},n.prototype.gotoAndPlayByFrame=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=n,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var i=t in this._animations?this._animations[t]:null;return null!==i&&(this._animationConfig.position=i.duration*e/i.frameCount),this.playConfig(this._animationConfig)},n.prototype.gotoAndPlayByProgress=function(t,e,n){void 0===e&&(e=0),void 0===n&&(n=-1),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.playTimes=n,this._animationConfig.fadeInTime=0,this._animationConfig.animation=t;var i=t in this._animations?this._animations[t]:null;return null!==i&&(this._animationConfig.position=i.duration*(e>0?e:0)),this.playConfig(this._animationConfig)},n.prototype.gotoAndStopByTime=function(t,e){void 0===e&&(e=0);var n=this.gotoAndPlayByTime(t,e,1);return null!==n&&n.stop(),n},n.prototype.gotoAndStopByFrame=function(t,e){void 0===e&&(e=0);var n=this.gotoAndPlayByFrame(t,e,1);return null!==n&&n.stop(),n},n.prototype.gotoAndStopByProgress=function(t,e){void 0===e&&(e=0);var n=this.gotoAndPlayByProgress(t,e,1);return null!==n&&n.stop(),n},n.prototype.getState=function(t){for(var e=this._animationStates.length;e--;){var n=this._animationStates[e];if(n.name===t)return n}return null},n.prototype.hasAnimation=function(t){return t in this._animations},n.prototype.getStates=function(){return this._animationStates},Object.defineProperty(n.prototype,"isPlaying",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++)if(e[t].isPlaying)return!0;return!1},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"isCompleted",{get:function(){for(var t=0,e=this._animationStates;t<e.length;t++)if(!e[t].isCompleted)return!1;return this._animationStates.length>0},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lastAnimationName",{get:function(){return null!==this._lastAnimationState?this._lastAnimationState.name:""},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animationNames",{get:function(){return this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animations",{get:function(){return this._animations},set:function(t){if(this._animations!==t){for(var e in this._animationNames.length=0,this._animations)delete this._animations[e];for(var e in t)this._animationNames.push(e),this._animations[e]=t[e]}},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animationConfig",{get:function(){return this._animationConfig.clear(),this._animationConfig},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"lastAnimationState",{get:function(){return this._lastAnimationState},enumerable:!0,configurable:!0}),n.prototype.gotoAndPlay=function(t,e,n,i,r,a,o){void 0===e&&(e=-1),void 0===n&&(n=-1),void 0===i&&(i=-1),void 0===r&&(r=0),void 0===a&&(a=null),void 0===o&&(o=3),console.warn("Deprecated."),this._animationConfig.clear(),this._animationConfig.resetToPose=!0,this._animationConfig.fadeOutMode=o,this._animationConfig.playTimes=i,this._animationConfig.layer=r,this._animationConfig.fadeInTime=e,this._animationConfig.animation=t,this._animationConfig.group=null!==a?a:"";var s=this._animations[t];return s&&n>0&&(this._animationConfig.timeScale=s.duration/n),this.playConfig(this._animationConfig)},n.prototype.gotoAndStop=function(t,e){return void 0===e&&(e=0),console.warn("Deprecated."),this.gotoAndStopByTime(t,e)},Object.defineProperty(n.prototype,"animationList",{get:function(){return console.warn("Deprecated."),this._animationNames},enumerable:!0,configurable:!0}),Object.defineProperty(n.prototype,"animationDataList",{get:function(){console.warn("Deprecated.");for(var t=[],e=0,n=this._animationNames.length;e<n;++e)t.push(this._animations[this._animationNames[e]]);return t},enumerable:!0,configurable:!0}),n}(t.BaseObject);t.Animation=e}(t3||(t3={})),function(t){var e=function(e){function r(){var t=null!==e&&e.apply(this,arguments)||this;return t._blendState=new i,t._boneMask=[],t._boneTimelines=[],t._surfaceTimelines=[],t._slotTimelines=[],t._constraintTimelines=[],t._animationTimelines=[],t._poseTimelines=[],t._bonePoses={},t._actionTimeline=null,t._zOrderTimeline=null,t._parent=null,t}return $4(r,e),r.toString=function(){return"[class dragonBones.AnimationState]"},r.prototype._onClear=function(){for(var t=0,e=this._boneTimelines;t<e.length;t++)e[t].returnToPool();for(var n=0,i=this._surfaceTimelines;n<i.length;n++)i[n].returnToPool();for(var r=0,a=this._slotTimelines;r<a.length;r++)a[r].returnToPool();for(var o=0,s=this._constraintTimelines;o<s.length;o++)s[o].returnToPool();for(var c=0,l=this._animationTimelines;c<l.length;c++)l[c].returnToPool();for(var h in this._bonePoses)this._bonePoses[h].returnToPool(),delete this._bonePoses[h];null!==this._actionTimeline&&this._actionTimeline.returnToPool(),null!==this._zOrderTimeline&&this._zOrderTimeline.returnToPool(),this.actionEnabled=!1,this.additiveBlending=!1,this.displayControl=!1,this.resetToPose=!1,this.playTimes=1,this.layer=0,this.timeScale=1,this.weight=1,this.autoFadeOutTime=0,this.fadeTotalTime=0,this.name="",this.group="",this._timelineDirty=2,this._playheadState=0,this._fadeState=-1,this._subFadeState=-1,this._position=0,this._duration=0,this._fadeTime=0,this._time=0,this._fadeProgress=0,this._weightResult=0,this._blendState.clear(),this._boneMask.length=0,this._boneTimelines.length=0,this._surfaceTimelines.length=0,this._slotTimelines.length=0,this._constraintTimelines.length=0,this._animationTimelines.length=0,this._poseTimelines.length=0,this._animationData=null,this._armature=null,this._actionTimeline=null,this._zOrderTimeline=null,this._parent=null},r.prototype._updateTimelines=function(){for(var e=0,n=this._armature._constraints;e<n.length;e++){var i=n[e];if(null!==(c=this._animationData.getConstraintTimelines(i.name)))for(var r=0,a=c;r<a.length;r++)switch((_=a[r]).type){case 30:(f=t.BaseObject.borrowObject(t.IKConstraintTimelineState)).constraint=i,f.init(this._armature,this,_),this._constraintTimelines.push(f)}else this.resetToPose&&((f=t.BaseObject.borrowObject(t.IKConstraintTimelineState)).constraint=i,f.init(this._armature,this,null),this._constraintTimelines.push(f),this._poseTimelines.push(f))}for(var o=0,s=this._armature.animation.getStates();o<s.length;o++){var c,l=s[o];if(l._parent===this&&null!==(c=this._animationData.getAnimationTimelines(l.name)))for(var h=0,u=c;h<u.length;h++){var _;switch((_=u[h]).type){case 40:var f;(f=t.BaseObject.borrowObject(t.AnimationTimelineState)).animationState=l,f.init(this._armature,this,_),this._animationTimelines.push(f)}}}},r.prototype._updateBoneAndSlotTimelines=function(){for(var e={},i=0,r=this._boneTimelines;i<r.length;i++)(c=(g=r[i]).bone.name)in e||(e[c]=[]),e[c].push(g);for(var a=0,o=this._armature.getBones();a<o.length;a++){var s=o[a],c=s.name;if(this.containsBoneMask(c))if(c in e)delete e[c];else if(0===s._boneData.type){var l=this._animationData.getBoneTimelines(c),h=c in this._bonePoses?this._bonePoses[c]:this._bonePoses[c]=t.BaseObject.borrowObject(n);if(null!==l)for(var u=0,_=l;u<_.length;u++)switch((R=_[u]).type){case 10:(g=t.BaseObject.borrowObject(t.BoneAllTimelineState)).bone=s,g.bonePose=h,g.init(this._armature,this,R),this._boneTimelines.push(g);break;case 11:(g=t.BaseObject.borrowObject(t.BoneTranslateTimelineState)).bone=s,g.bonePose=h,g.init(this._armature,this,R),this._boneTimelines.push(g);break;case 12:(g=t.BaseObject.borrowObject(t.BoneRotateTimelineState)).bone=s,g.bonePose=h,g.init(this._armature,this,R),this._boneTimelines.push(g);break;case 13:(g=t.BaseObject.borrowObject(t.BoneScaleTimelineState)).bone=s,g.bonePose=h,g.init(this._armature,this,R),this._boneTimelines.push(g)}else this.resetToPose&&((g=t.BaseObject.borrowObject(t.BoneAllTimelineState)).bone=s,g.bonePose=h,g.init(this._armature,this,null),this._boneTimelines.push(g),this._poseTimelines.push(g))}else if(1===s._boneData.type)if(null!==(l=this._animationData.getSurfaceTimelines(c)))for(var f=0,d=l;f<d.length;f++)switch((R=d[f]).type){case 50:(g=t.BaseObject.borrowObject(t.SurfaceTimelineState)).surface=s,g.init(this._armature,this,R),this._surfaceTimelines.push(g)}else this.resetToPose&&((g=t.BaseObject.borrowObject(t.SurfaceTimelineState)).surface=s,g.init(this._armature,this,null),this._surfaceTimelines.push(g),this._poseTimelines.push(g))}for(var p in e)for(var m=0,v=e[p];m<v.length;m++){var g=v[m];this._boneTimelines.splice(this._boneTimelines.indexOf(g),1),g.returnToPool()}for(var y={},x=[],S=0,A=this._slotTimelines;S<A.length;S++)(c=(g=A[S]).slot.name)in y||(y[c]=[]),y[c].push(g);for(var b=0,C=this._armature.getSlots();b<C.length;b++){var T=C[b],E=T.parent.name;if(this.containsBoneMask(E))if(c=T.name,l=this._animationData.getSlotTimelines(c),c in y)delete y[c];else{var w=!1,I=!1;if(x.length=0,null!==l)for(var P=0,D=l;P<D.length;P++){var R;switch((R=D[P]).type){case 20:(g=t.BaseObject.borrowObject(t.SlotDislayTimelineState)).slot=T,g.init(this._armature,this,R),this._slotTimelines.push(g),w=!0;break;case 21:(g=t.BaseObject.borrowObject(t.SlotColorTimelineState)).slot=T,g.init(this._armature,this,R),this._slotTimelines.push(g),I=!0;break;case 22:(g=t.BaseObject.borrowObject(t.DeformTimelineState)).slot=T,g.init(this._armature,this,R),this._slotTimelines.push(g),x.push(g.vertexOffset)}}if(this.resetToPose&&(w||((g=t.BaseObject.borrowObject(t.SlotDislayTimelineState)).slot=T,g.init(this._armature,this,null),this._slotTimelines.push(g),this._poseTimelines.push(g)),I||((g=t.BaseObject.borrowObject(t.SlotColorTimelineState)).slot=T,g.init(this._armature,this,null),this._slotTimelines.push(g),this._poseTimelines.push(g)),null!==T.rawDisplayDatas))for(var M=0,O=T.rawDisplayDatas;M<O.length;M++){var N=O[M];if(null!==N&&2===N.type){var B=N.vertices.offset;x.indexOf(B)<0&&((g=t.BaseObject.borrowObject(t.DeformTimelineState)).vertexOffset=B,g.slot=T,g.init(this._armature,this,null),this._slotTimelines.push(g),this._poseTimelines.push(g))}}}}for(var p in y)for(var L=0,F=y[p];L<F.length;L++)g=F[L],this._slotTimelines.splice(this._slotTimelines.indexOf(g),1),g.returnToPool()},r.prototype._advanceFadeTime=function(e){var n,i=this._fadeState>0;if(this._subFadeState<0){this._subFadeState=0;var r=i?t.EventObject.FADE_OUT:t.EventObject.FADE_IN;this._armature.eventDispatcher.hasDBEventListener(r)&&((n=t.BaseObject.borrowObject(t.EventObject)).type=r,n.armature=this._armature,n.animationState=this,this._armature._dragonBones.bufferEvent(n))}(e<0&&(e=-e),this._fadeTime+=e,this._fadeTime>=this.fadeTotalTime?(this._subFadeState=1,this._fadeProgress=i?0:1):this._fadeTime>0?this._fadeProgress=i?1-this._fadeTime/this.fadeTotalTime:this._fadeTime/this.fadeTotalTime:this._fadeProgress=i?1:0,this._subFadeState>0)&&(i||(this._playheadState|=1,this._fadeState=0),r=i?t.EventObject.FADE_OUT_COMPLETE:t.EventObject.FADE_IN_COMPLETE,this._armature.eventDispatcher.hasDBEventListener(r)&&((n=t.BaseObject.borrowObject(t.EventObject)).type=r,n.armature=this._armature,n.animationState=this,this._armature._dragonBones.bufferEvent(n)))},r.prototype.init=function(e,n,i){if(null===this._armature){if(this._armature=e,this._animationData=n,this.resetToPose=i.resetToPose,this.additiveBlending=i.additiveBlending,this.displayControl=i.displayControl,this.actionEnabled=i.actionEnabled,this.layer=i.layer,this.playTimes=i.playTimes,this.timeScale=i.timeScale,this.fadeTotalTime=i.fadeInTime,this.autoFadeOutTime=i.autoFadeOutTime,this.weight=i.weight,this.name=i.name.length>0?i.name:i.animation,this.group=i.group,i.pauseFadeIn?this._playheadState=2:this._playheadState=3,i.duration<0?(this._position=0,this._duration=this._animationData.duration,0!==i.position?this.timeScale>=0?this._time=i.position:this._time=i.position-this._duration:this._time=0):(this._position=i.position,this._duration=i.duration,this._time=0),this.timeScale<0&&0===this._time&&(this._time=-1e-6),this.fadeTotalTime<=0&&(this._fadeProgress=.999999),i.boneMask.length>0){this._boneMask.length=i.boneMask.length;for(var r=0,a=this._boneMask.length;r<a;++r)this._boneMask[r]=i.boneMask[r]}this._actionTimeline=t.BaseObject.borrowObject(t.ActionTimelineState),this._actionTimeline.init(this._armature,this,this._animationData.actionTimeline),this._actionTimeline.currentTime=this._time,this._actionTimeline.currentTime<0&&(this._actionTimeline.currentTime=this._duration-this._actionTimeline.currentTime),null!==this._animationData.zOrderTimeline&&(this._zOrderTimeline=t.BaseObject.borrowObject(t.ZOrderTimelineState),this._zOrderTimeline.init(this._armature,this,this._animationData.zOrderTimeline))}},r.prototype.advanceTime=function(e,n){if(this._blendState.dirty=!1,0===this._fadeState&&0===this._subFadeState||this._advanceFadeTime(e),3===this._playheadState&&(1!==this.timeScale&&(e*=this.timeScale),this._time+=e),0!==this._timelineDirty&&(2===this._timelineDirty&&this._updateTimelines(),this._timelineDirty=0,this._updateBoneAndSlotTimelines()),0!==this.weight){var i=0===this._fadeState&&n>0,r=!0,a=!0,o=this._time;if(this._weightResult=this.weight*this._fadeProgress,null!==this._parent&&(this._weightResult*=this._parent._weightResult/this._parent._fadeProgress),this._actionTimeline.playState<=0&&this._actionTimeline.update(o),i){var s=2*n;this._actionTimeline.currentTime=Math.floor(this._actionTimeline.currentTime*s)/s}if(null!==this._zOrderTimeline&&this._zOrderTimeline.playState<=0&&this._zOrderTimeline.update(o),i){var c=Math.floor(this._actionTimeline.currentTime*n);this._armature._cacheFrameIndex===c?(r=!1,a=!1):(this._armature._cacheFrameIndex=c,this._animationData.cachedFrames[c]?a=!1:this._animationData.cachedFrames[c]=!0)}if(r){if(a)for(var l=0,h=this._boneTimelines.length;l<h;++l)(p=this._boneTimelines[l]).playState<=0&&p.update(o),(l===h-1||p.bone!==this._boneTimelines[l+1].bone)&&0!==(u=p.bone._blendState.update(this._weightResult,this.layer))&&p.blend(u);for(l=0,h=this._surfaceTimelines.length;l<h;++l){var u=(p=this._surfaceTimelines[l]).surface._blendState.update(this._weightResult,this.layer);p.playState<=0&&p.update(o),0!==u&&p.blend(u)}if(this.displayControl)for(l=0,h=this._slotTimelines.length;l<h;++l){var _=(p=this._slotTimelines[l]).slot.displayController;null!==_&&_!==this.name&&_!==this.group||p.playState<=0&&p.update(o)}for(l=0,h=this._constraintTimelines.length;l<h;++l)(p=this._constraintTimelines[l]).playState<=0&&p.update(o);for(l=0,h=this._animationTimelines.length;l<h;++l)u=(p=this._animationTimelines[l]).animationState._blendState.update(this._weightResult,this.layer),p.playState<=0&&p.update(o),0!==u&&p.blend(u)}if(0===this._fadeState){if(this._subFadeState>0&&(this._subFadeState=0,this._poseTimelines.length>0)){for(var f=0,d=this._poseTimelines;f<d.length;f++){var p;(p=d[f])instanceof t.BoneTimelineState?this._boneTimelines.splice(this._boneTimelines.indexOf(p),1):p instanceof t.SurfaceTimelineState?this._surfaceTimelines.splice(this._surfaceTimelines.indexOf(p),1):p instanceof t.SlotTimelineState?this._slotTimelines.splice(this._slotTimelines.indexOf(p),1):p instanceof t.ConstraintTimelineState&&this._constraintTimelines.splice(this._constraintTimelines.indexOf(p),1),p.returnToPool()}this._poseTimelines.length=0}this._actionTimeline.playState>0&&this.autoFadeOutTime>=0&&this.fadeOut(this.autoFadeOutTime)}}},r.prototype.play=function(){this._playheadState=3},r.prototype.stop=function(){this._playheadState&=1},r.prototype.fadeOut=function(t,e){if(void 0===e&&(e=!0),t<0&&(t=0),e&&(this._playheadState&=2),this._fadeState>0){if(t>this.fadeTotalTime-this._fadeTime)return}else{this._fadeState=1,this._subFadeState=-1,(t<=0||this._fadeProgress<=0)&&(this._fadeProgress=1e-6);for(var n=0,i=this._boneTimelines;n<i.length;n++)(_=i[n]).fadeOut();for(var r=0,a=this._surfaceTimelines;r<a.length;r++)(_=a[r]).fadeOut();for(var o=0,s=this._slotTimelines;o<s.length;o++)(_=s[o]).fadeOut();for(var c=0,l=this._constraintTimelines;c<l.length;c++)(_=l[c]).fadeOut();for(var h=0,u=this._animationTimelines;h<u.length;h++){var _;(_=u[h]).animationState.fadeOut(t,e),_.fadeOut()}}this.displayControl=!1,this.fadeTotalTime=this._fadeProgress>1e-6?t/this._fadeProgress:0,this._fadeTime=this.fadeTotalTime*(1-this._fadeProgress)},r.prototype.containsBoneMask=function(t){return 0===this._boneMask.length||this._boneMask.indexOf(t)>=0},r.prototype.addBoneMask=function(t,e){void 0===e&&(e=!0);var n=this._armature.getBone(t);if(null!==n){if(this._boneMask.indexOf(t)<0&&this._boneMask.push(t),e)for(var i=0,r=this._armature.getBones();i<r.length;i++){var a=r[i];this._boneMask.indexOf(a.name)<0&&n.contains(a)&&this._boneMask.push(a.name)}this._timelineDirty=1}},r.prototype.removeBoneMask=function(t,e){void 0===e&&(e=!0);var n=this._boneMask.indexOf(t);if(n>=0&&this._boneMask.splice(n,1),e){var i=this._armature.getBone(t);if(null!==i){var r=this._armature.getBones();if(this._boneMask.length>0)for(var a=0,o=r;a<o.length;a++){var s=o[a],c=this._boneMask.indexOf(s.name);c>=0&&i.contains(s)&&this._boneMask.splice(c,1)}else for(var l=0,h=r;l<h.length;l++)(s=h[l])!==i&&(i.contains(s)||this._boneMask.push(s.name))}}this._timelineDirty=1},r.prototype.removeAllBoneMask=function(){this._boneMask.length=0,this._timelineDirty=1},Object.defineProperty(r.prototype,"isFadeIn",{get:function(){return this._fadeState<0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isFadeOut",{get:function(){return this._fadeState>0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isFadeComplete",{get:function(){return 0===this._fadeState},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isPlaying",{get:function(){return 0!=(2&this._playheadState)&&this._actionTimeline.playState<=0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"isCompleted",{get:function(){return this._actionTimeline.playState>0},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentPlayTimes",{get:function(){return this._actionTimeline.currentPlayTimes},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"totalTime",{get:function(){return this._duration},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"currentTime",{get:function(){return this._actionTimeline.currentTime},set:function(t){var e=this._actionTimeline.currentPlayTimes-(this._actionTimeline.playState>0?1:0);if((t<0||this._duration<t)&&(t=t%this._duration+e*this._duration)<0&&(t+=this._duration),this.playTimes>0&&e===this.playTimes-1&&t===this._duration&&(t=this._duration-1e-6),this._time!==t){this._time=t,this._actionTimeline.setCurrentTime(this._time),null!==this._zOrderTimeline&&(this._zOrderTimeline.playState=-1);for(var n=0,i=this._boneTimelines;n<i.length;n++)i[n].playState=-1;for(var r=0,a=this._slotTimelines;r<a.length;r++)a[r].playState=-1}},enumerable:!0,configurable:!0}),Object.defineProperty(r.prototype,"animationData",{get:function(){return this._animationData},enumerable:!0,configurable:!0}),r}(t.BaseObject);t.AnimationState=e;var n=function(e){function n(){var n=null!==e&&e.apply(this,arguments)||this;return n.current=new t.Transform,n.delta=new t.Transform,n.result=new t.Transform,n}return $4(n,e),n.toString=function(){return"[class dragonBones.BonePose]"},n.prototype._onClear=function(){this.current.identity(),this.delta.identity(),this.result.identity()},n}(t.BaseObject);t.BonePose=n;var i=function(){function t(){}return t.prototype.update=function(t,e){if(this.dirty){if(!(this.leftWeight>0))return 0;if(this.layer!==e){if(this.layerWeight>=this.leftWeight)return this.leftWeight=0,0;this.layer=e,this.leftWeight-=this.layerWeight,this.layerWeight=0}return t*=this.leftWeight,this.layerWeight+=t,this.blendWeight=t,2}return this.dirty=!0,this.layer=e,this.layerWeight=t,this.leftWeight=1,this.blendWeight=t,1},t.prototype.clear=function(){this.dirty=!1,this.layer=0,this.leftWeight=0,this.layerWeight=0,this.blendWeight=0},t}();t.BlendState=i}(t3||(t3={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $4(e,t),e.prototype._onClear=function(){this.playState=-1,this.currentPlayTimes=-1,this.currentTime=-1,this._tweenState=0,this._frameRate=0,this._frameValueOffset=0,this._frameCount=0,this._frameOffset=0,this._frameIndex=-1,this._frameRateR=0,this._position=0,this._duration=0,this._timeScale=1,this._timeOffset=0,this._dragonBonesData=null,this._animationData=null,this._timelineData=null,this._armature=null,this._animationState=null,this._actionTimeline=null,this._frameArray=null,this._frameIntArray=null,this._frameFloatArray=null,this._timelineArray=null,this._frameIndices=null},e.prototype._setCurrentTime=function(t){var e=this.playState,n=this.currentPlayTimes,i=this.currentTime;if(null!==this._actionTimeline&&this._frameCount<=1)this.playState=this._actionTimeline.playState>=0?1:-1,this.currentPlayTimes=1,this.currentTime=this._actionTimeline.currentTime;else if(null===this._actionTimeline||1!==this._timeScale||0!==this._timeOffset){var r=this._animationState.playTimes,a=r*this._duration;t*=this._timeScale,0!==this._timeOffset&&(t+=this._timeOffset*this._animationData.duration),r>0&&(t>=a||t<=-a)?(this.playState<=0&&3===this._animationState._playheadState&&(this.playState=1),this.currentPlayTimes=r,this.currentTime=t<0?0:this._duration+1e-6):(0!==this.playState&&3===this._animationState._playheadState&&(this.playState=0),t<0?(t=-t,this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=this._duration-t%this._duration):(this.currentPlayTimes=Math.floor(t/this._duration),this.currentTime=t%this._duration)),this.currentTime+=this._position}else this.playState=this._actionTimeline.playState,this.currentPlayTimes=this._actionTimeline.currentPlayTimes,this.currentTime=this._actionTimeline.currentTime;return(this.currentPlayTimes!==n||this.currentTime!==i)&&((e<0&&this.playState!==e||this.playState<=0&&this.currentPlayTimes!==n)&&(this._frameIndex=-1),!0)},e.prototype.init=function(t,e,n){this._armature=t,this._animationState=e,this._timelineData=n,this._actionTimeline=this._animationState._actionTimeline,this===this._actionTimeline&&(this._actionTimeline=null),this._animationData=this._animationState._animationData,this._frameRate=this._animationData.parent.frameRate,this._frameRateR=1/this._frameRate,this._position=this._animationState._position,this._duration=this._animationState._duration,this._dragonBonesData=this._animationData.parent.parent,null!==this._timelineData&&(this._frameIntArray=this._dragonBonesData.frameIntArray,this._frameFloatArray=this._dragonBonesData.frameFloatArray,this._frameArray=this._dragonBonesData.frameArray,this._timelineArray=this._dragonBonesData.timelineArray,this._frameIndices=this._dragonBonesData.frameIndices,this._frameCount=this._timelineArray[this._timelineData.offset+2],this._frameValueOffset=this._timelineArray[this._timelineData.offset+4],this._timeScale=100/this._timelineArray[this._timelineData.offset+0],this._timeOffset=.01*this._timelineArray[this._timelineData.offset+1])},e.prototype.fadeOut=function(){},e.prototype.update=function(t){if(this._setCurrentTime(t)){if(this._frameCount>1){var e=Math.floor(this.currentTime*this._frameRate),n=this._frameIndices[this._timelineData.frameIndicesOffset+e];this._frameIndex!==n&&(this._frameIndex=n,this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex],this._onArriveAtFrame())}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5]),this._onArriveAtFrame());0!==this._tweenState&&this._onUpdateFrame()}},e}(t.BaseObject);t.TimelineState=e;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $4(e,t),e._getEasingValue=function(t,e,n){var i=e;switch(t){case 3:i=Math.pow(e,2);break;case 4:i=1-Math.pow(1-e,2);break;case 5:i=.5*(1-Math.cos(e*Math.PI))}return(i-e)*n+e},e._getEasingCurveValue=function(t,e,n,i){if(t<=0)return 0;if(t>=1)return 1;var r=n+1,a=Math.floor(t*r),o=0===a?0:e[i+a-1];return 1e-4*(o+((a===r-1?1e4:e[i+a])-o)*(t*r-a))},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._tweenType=0,this._curveCount=0,this._framePosition=0,this._frameDurationR=0,this._tweenProgress=0,this._tweenEasing=0},e.prototype._onArriveAtFrame=function(){if(this._frameCount>1&&(this._frameIndex!==this._frameCount-1||0===this._animationState.playTimes||this._animationState.currentPlayTimes<this._animationState.playTimes-1))if(this._tweenType=this._frameArray[this._frameOffset+1],this._tweenState=0===this._tweenType?1:2,2===this._tweenType?this._curveCount=this._frameArray[this._frameOffset+2]:0!==this._tweenType&&1!==this._tweenType&&(this._tweenEasing=.01*this._frameArray[this._frameOffset+2]),this._framePosition=this._frameArray[this._frameOffset]*this._frameRateR,this._frameIndex===this._frameCount-1)this._frameDurationR=1/(this._animationData.duration-this._framePosition);else{var t=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+this._frameIndex+1],e=this._frameArray[t]*this._frameRateR-this._framePosition;this._frameDurationR=e>0?1/e:0}else this._tweenState=1},e.prototype._onUpdateFrame=function(){2===this._tweenState?(this._tweenProgress=(this.currentTime-this._framePosition)*this._frameDurationR,2===this._tweenType?this._tweenProgress=e._getEasingCurveValue(this._tweenProgress,this._frameArray,this._curveCount,this._frameOffset+3):1!==this._tweenType&&(this._tweenProgress=e._getEasingValue(this._tweenType,this._tweenProgress,this._tweenEasing))):this._tweenProgress=0},e}(e);t.TweenTimelineState=n;var i=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $4(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.bone=null,this.bonePose=null},e.prototype.blend=function(t){var e=this.bone._blendState.blendWeight,n=this.bone.animationPose,i=this.bonePose.result;2===t?(n.x+=i.x*e,n.y+=i.y*e,n.rotation+=i.rotation*e,n.skew+=i.skew*e,n.scaleX+=(i.scaleX-1)*e,n.scaleY+=(i.scaleY-1)*e):1!==e?(n.x=i.x*e,n.y=i.y*e,n.rotation=i.rotation*e,n.skew=i.skew*e,n.scaleX=(i.scaleX-1)*e+1,n.scaleY=(i.scaleY-1)*e+1):(n.x=i.x,n.y=i.y,n.rotation=i.rotation,n.skew=i.skew,n.scaleX=i.scaleX,n.scaleY=i.scaleY),0===this._animationState._fadeState&&0===this._animationState._subFadeState||(this.bone._transformDirty=!0)},e}(n);t.BoneTimelineState=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $4(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.slot=null},e}(n);t.SlotTimelineState=r;var a=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $4(e,t),e.prototype._onClear=function(){t.prototype._onClear.call(this),this.constraint=null},e}(n);t.ConstraintTimelineState=a}(t3||(t3={})),function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return $4(n,e),n.toString=function(){return"[class dragonBones.ActionTimelineState]"},n.prototype._onCrossFrame=function(e){var n=this._armature.eventDispatcher;if(this._animationState.actionEnabled)for(var i=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5+e],r=this._frameArray[i+1],a=this._animationData.parent.actions,o=0;o<r;++o){var s=a[this._frameArray[i+2+o]];if(0===s.type)(c=t.BaseObject.borrowObject(t.EventObject)).time=this._frameArray[i]/this._frameRate,c.animationState=this._animationState,t.EventObject.actionDataToInstance(s,c,this._armature),this._armature._bufferAction(c,!0);else{var c,l=10===s.type?t.EventObject.FRAME_EVENT:t.EventObject.SOUND_EVENT;(11===s.type||n.hasDBEventListener(l))&&((c=t.BaseObject.borrowObject(t.EventObject)).time=this._frameArray[i]/this._frameRate,c.animationState=this._animationState,t.EventObject.actionDataToInstance(s,c,this._armature),this._armature._dragonBones.bufferEvent(c))}}},n.prototype._onArriveAtFrame=function(){},n.prototype._onUpdateFrame=function(){},n.prototype.update=function(e){var n=this.playState,i=this.currentPlayTimes,r=this.currentTime;if(this._setCurrentTime(e)){var a=this._armature.eventDispatcher;if(n<0){if(this.playState===n)return;if(this._animationState.displayControl&&this._animationState.resetToPose&&this._armature._sortZOrder(null,0),i=this.currentPlayTimes,a.hasDBEventListener(t.EventObject.START)){var o=t.BaseObject.borrowObject(t.EventObject);o.type=t.EventObject.START,o.armature=this._armature,o.animationState=this._animationState,this._armature._dragonBones.bufferEvent(o)}}var s=this._animationState.timeScale<0,c=null,l=null;if(this.currentPlayTimes!==i&&(a.hasDBEventListener(t.EventObject.LOOP_COMPLETE)&&((c=t.BaseObject.borrowObject(t.EventObject)).type=t.EventObject.LOOP_COMPLETE,c.armature=this._armature,c.animationState=this._animationState),this.playState>0&&a.hasDBEventListener(t.EventObject.COMPLETE)&&((l=t.BaseObject.borrowObject(t.EventObject)).type=t.EventObject.COMPLETE,l.armature=this._armature,l.animationState=this._animationState)),this._frameCount>1){var h=this._timelineData,u=Math.floor(this.currentTime*this._frameRate),_=this._frameIndices[h.frameIndicesOffset+u];if(this._frameIndex!==_){var f=this._frameIndex;if(this._frameIndex=_,null!==this._timelineArray)if(this._frameOffset=this._animationData.frameOffset+this._timelineArray[h.offset+5+this._frameIndex],s){if(f<0){var d=Math.floor(r*this._frameRate);f=this._frameIndices[h.frameIndicesOffset+d],this.currentPlayTimes===i&&f===_&&(f=-1)}for(;f>=0;){var p=this._animationData.frameOffset+this._timelineArray[h.offset+5+f],m=this._frameArray[p]/this._frameRate;if(this._position<=m&&m<=this._position+this._duration&&this._onCrossFrame(f),null!==c&&0===f&&(this._armature._dragonBones.bufferEvent(c),c=null),f>0?f--:f=this._frameCount-1,f===_)break}}else for(f<0&&(d=Math.floor(r*this._frameRate),f=this._frameIndices[h.frameIndicesOffset+d],p=this._animationData.frameOffset+this._timelineArray[h.offset+5+f],m=this._frameArray[p]/this._frameRate,this.currentPlayTimes===i&&(r<=m?f>0?f--:f=this._frameCount-1:f===_&&(f=-1)));f>=0&&(f<this._frameCount-1?f++:f=0,p=this._animationData.frameOffset+this._timelineArray[h.offset+5+f],m=this._frameArray[p]/this._frameRate,this._position<=m&&m<=this._position+this._duration&&this._onCrossFrame(f),null!==c&&0===f&&(this._armature._dragonBones.bufferEvent(c),c=null),f!==_););}}else this._frameIndex<0&&(this._frameIndex=0,null!==this._timelineData)&&(this._frameOffset=this._animationData.frameOffset+this._timelineArray[this._timelineData.offset+5],m=this._frameArray[this._frameOffset]/this._frameRate,this.currentPlayTimes===i?r<=m&&this._onCrossFrame(this._frameIndex):this._position<=m&&(s||null===c||(this._armature._dragonBones.bufferEvent(c),c=null),this._onCrossFrame(this._frameIndex)));null!==c&&this._armature._dragonBones.bufferEvent(c),null!==l&&this._armature._dragonBones.bufferEvent(l)}},n.prototype.setCurrentTime=function(t){this._setCurrentTime(t),this._frameIndex=-1},n}(t.TimelineState);t.ActionTimelineState=e;var n=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $4(e,t),e.toString=function(){return"[class dragonBones.ZOrderTimelineState]"},e.prototype._onArriveAtFrame=function(){this.playState>=0&&(this._frameArray[this._frameOffset+1]>0?this._armature._sortZOrder(this._frameArray,this._frameOffset+2):this._armature._sortZOrder(null,0))},e.prototype._onUpdateFrame=function(){},e}(t.TimelineState);t.ZOrderTimelineState=n;var i=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return $4(n,e),n.toString=function(){return"[class dragonBones.BoneAllTimelineState]"},n.prototype._onArriveAtFrame=function(){if(e.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var t=this._animationData.frameFloatOffset+this._frameValueOffset+6*this._frameIndex,n=this._armature._armatureData.scale,i=this._frameFloatArray,r=this.bonePose.current,a=this.bonePose.delta;r.x=i[t++]*n,r.y=i[t++]*n,r.rotation=i[t++],r.skew=i[t++],r.scaleX=i[t++],r.scaleY=i[t++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(t=this._animationData.frameFloatOffset+this._frameValueOffset),a.x=i[t++]*n-r.x,a.y=i[t++]*n-r.y,a.rotation=i[t++]-r.rotation,a.skew=i[t++]-r.skew,a.scaleX=i[t++]-r.scaleX,a.scaleY=i[t++]-r.scaleY):(a.x=0,a.y=0,a.rotation=0,a.skew=0,a.scaleX=0,a.scaleY=0)}else r=this.bonePose.current,a=this.bonePose.delta,r.x=0,r.y=0,r.rotation=0,r.skew=0,r.scaleX=1,r.scaleY=1,a.x=0,a.y=0,a.rotation=0,a.skew=0,a.scaleX=0,a.scaleY=0},n.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,n=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.x=t.x+n.x*this._tweenProgress,i.y=t.y+n.y*this._tweenProgress,i.rotation=t.rotation+n.rotation*this._tweenProgress,i.skew=t.skew+n.skew*this._tweenProgress,i.scaleX=t.scaleX+n.scaleX*this._tweenProgress,i.scaleY=t.scaleY+n.scaleY*this._tweenProgress},n.prototype.fadeOut=function(){var e=this.bonePose.result;e.rotation=t.Transform.normalizeRadian(e.rotation),e.skew=t.Transform.normalizeRadian(e.skew)},n}(t.BoneTimelineState);t.BoneAllTimelineState=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $4(e,t),e.toString=function(){return"[class dragonBones.BoneTranslateTimelineState]"},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,n=this._armature._armatureData.scale,i=this._frameFloatArray,r=this.bonePose.current,a=this.bonePose.delta;r.x=i[e++]*n,r.y=i[e++]*n,2===this._tweenState?(this._frameIndex===this._frameCount-1&&(e=this._animationData.frameFloatOffset+this._frameValueOffset),a.x=i[e++]*n-r.x,a.y=i[e++]*n-r.y):(a.x=0,a.y=0)}else r=this.bonePose.current,a=this.bonePose.delta,r.x=0,r.y=0,a.x=0,a.y=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.bonePose.current,n=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.x=e.x+n.x*this._tweenProgress,i.y=e.y+n.y*this._tweenProgress},e}(t.BoneTimelineState);t.BoneTranslateTimelineState=r;var a=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return $4(n,e),n.toString=function(){return"[class dragonBones.BoneRotateTimelineState]"},n.prototype._onArriveAtFrame=function(){if(e.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var n=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,i=this._frameFloatArray,r=this.bonePose.current,a=this.bonePose.delta;r.rotation=i[n++],r.skew=i[n++],2===this._tweenState?(this._frameIndex===this._frameCount-1?(n=this._animationData.frameFloatOffset+this._frameValueOffset,a.rotation=t.Transform.normalizeRadian(i[n++]-r.rotation)):a.rotation=i[n++]-r.rotation,a.skew=i[n++]-r.skew):(a.rotation=0,a.skew=0)}else r=this.bonePose.current,a=this.bonePose.delta,r.rotation=0,r.skew=0,a.rotation=0,a.skew=0},n.prototype._onUpdateFrame=function(){e.prototype._onUpdateFrame.call(this);var t=this.bonePose.current,n=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.rotation=t.rotation+n.rotation*this._tweenProgress,i.skew=t.skew+n.skew*this._tweenProgress},n.prototype.fadeOut=function(){var e=this.bonePose.result;e.rotation=t.Transform.normalizeRadian(e.rotation),e.skew=t.Transform.normalizeRadian(e.skew)},n}(t.BoneTimelineState);t.BoneRotateTimelineState=a;var o=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $4(e,t),e.toString=function(){return"[class dragonBones.BoneScaleTimelineState]"},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+2*this._frameIndex,n=this._frameFloatArray,i=this.bonePose.current,r=this.bonePose.delta;i.scaleX=n[e++],i.scaleY=n[e++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(e=this._animationData.frameFloatOffset+this._frameValueOffset),r.scaleX=n[e++]-i.scaleX,r.scaleY=n[e++]-i.scaleY):(r.scaleX=0,r.scaleY=0)}else i=this.bonePose.current,r=this.bonePose.delta,i.scaleX=1,i.scaleY=1,r.scaleX=0,r.scaleY=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this);var e=this.bonePose.current,n=this.bonePose.delta,i=this.bonePose.result;this.bone._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0),i.scaleX=e.scaleX+n.scaleX*this._tweenProgress,i.scaleY=e.scaleY+n.scaleY*this._tweenProgress},e}(t.BoneTimelineState);t.BoneScaleTimelineState=o;var s=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[],e._delta=[],e._result=[],e}return $4(e,t),e.toString=function(){return"[class dragonBones.SurfaceTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.surface=null,this._frameFloatOffset=0,this._valueCount=0,this._deformCount=0,this._valueOffset=0,this._current.length=0,this._delta.length=0,this._result.length=0},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+this._frameIndex*this._valueCount,n=this._armature._armatureData.scale,i=this._frameFloatArray;if(2===this._tweenState){var r=e+this._valueCount;this._frameIndex===this._frameCount-1&&(r=this._animationData.frameFloatOffset+this._frameValueOffset);for(var a=0;a<this._valueCount;++a)this._delta[a]=i[r+a]*n-(this._current[a]=i[e+a]*n)}else for(a=0;a<this._valueCount;++a)this._current[a]=i[e+a]*n}else for(a=0;a<this._valueCount;++a)this._current[a]=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this.surface._transformDirty=!0,2!==this._tweenState&&(this._tweenState=0);for(var e=0;e<this._valueCount;++e)this._result[e]=this._current[e]+this._delta[e]*this._tweenProgress},e.prototype.init=function(e,n,i){if(t.prototype.init.call(this,e,n,i),null!==this._timelineData){var r=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this._deformCount=this._frameIntArray[r+1],this._valueCount=this._frameIntArray[r+2],this._valueOffset=this._frameIntArray[r+3],this._frameFloatOffset=this._frameIntArray[r+4]+this._animationData.frameFloatOffset}else this._deformCount=this.surface._deformVertices.length,this._valueCount=this._deformCount,this._valueOffset=0,this._frameFloatOffset=0;this._current.length=this._valueCount,this._delta.length=this._valueCount,this._result.length=this._valueCount;for(var a=0;a<this._valueCount;++a)this._delta[a]=0},e.prototype.blend=function(t){for(var e=this.surface._blendState.blendWeight,n=this.surface._deformVertices,i=0;i<this._deformCount;++i){var r;r=i<this._valueOffset?this._frameFloatArray[this._frameFloatOffset+i]:i<this._valueOffset+this._valueCount?this._result[i-this._valueOffset]:this._frameFloatArray[this._frameFloatOffset+i-this._valueCount],2===t?n[i]+=r*e:n[i]=1!==e?r*e:r}0===this._animationState._fadeState&&0===this._animationState._subFadeState||(this.surface._transformDirty=!0)},e}(t.TweenTimelineState);t.SurfaceTimelineState=s;var c=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $4(e,t),e.toString=function(){return"[class dragonBones.SlotDislayTimelineState]"},e.prototype._onArriveAtFrame=function(){if(this.playState>=0){var t=null!==this._timelineData?this._frameArray[this._frameOffset+1]:this.slot._slotData.displayIndex;this.slot.displayIndex!==t&&this.slot._setDisplayIndex(t,!0)}},e}(t.SlotTimelineState);t.SlotDislayTimelineState=c;var l=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[0,0,0,0,0,0,0,0],e._delta=[0,0,0,0,0,0,0,0],e._result=[0,0,0,0,0,0,0,0],e}return $4(e,t),e.toString=function(){return"[class dragonBones.SlotColorTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._dirty=!1},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._dragonBonesData.intArray,n=this._frameIntArray,i=this._animationData.frameIntOffset+this._frameValueOffset+1*this._frameIndex,r=n[i];r<0&&(r+=65536),this._current[0]=e[r++],this._current[1]=e[r++],this._current[2]=e[r++],this._current[3]=e[r++],this._current[4]=e[r++],this._current[5]=e[r++],this._current[6]=e[r++],this._current[7]=e[r++],2===this._tweenState&&((r=this._frameIndex===this._frameCount-1?n[this._animationData.frameIntOffset+this._frameValueOffset]:n[i+1])<0&&(r+=65536),this._delta[0]=e[r++]-this._current[0],this._delta[1]=e[r++]-this._current[1],this._delta[2]=e[r++]-this._current[2],this._delta[3]=e[r++]-this._current[3],this._delta[4]=e[r++]-this._current[4],this._delta[5]=e[r++]-this._current[5],this._delta[6]=e[r++]-this._current[6],this._delta[7]=e[r++]-this._current[7])}else{var a=this.slot._slotData.color;this._current[0]=100*a.alphaMultiplier,this._current[1]=100*a.redMultiplier,this._current[2]=100*a.greenMultiplier,this._current[3]=100*a.blueMultiplier,this._current[4]=a.alphaOffset,this._current[5]=a.redOffset,this._current[6]=a.greenOffset,this._current[7]=a.blueOffset}},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._dirty=!0,2!==this._tweenState&&(this._tweenState=0),this._result[0]=.01*(this._current[0]+this._delta[0]*this._tweenProgress),this._result[1]=.01*(this._current[1]+this._delta[1]*this._tweenProgress),this._result[2]=.01*(this._current[2]+this._delta[2]*this._tweenProgress),this._result[3]=.01*(this._current[3]+this._delta[3]*this._tweenProgress),this._result[4]=this._current[4]+this._delta[4]*this._tweenProgress,this._result[5]=this._current[5]+this._delta[5]*this._tweenProgress,this._result[6]=this._current[6]+this._delta[6]*this._tweenProgress,this._result[7]=this._current[7]+this._delta[7]*this._tweenProgress},e.prototype.fadeOut=function(){this._tweenState=0,this._dirty=!1},e.prototype.update=function(e){if(t.prototype.update.call(this,e),0!==this._tweenState||this._dirty){var n=this.slot._colorTransform;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){if(n.alphaMultiplier!==this._result[0]||n.redMultiplier!==this._result[1]||n.greenMultiplier!==this._result[2]||n.blueMultiplier!==this._result[3]||n.alphaOffset!==this._result[4]||n.redOffset!==this._result[5]||n.greenOffset!==this._result[6]||n.blueOffset!==this._result[7]){var i=Math.pow(this._animationState._fadeProgress,4);n.alphaMultiplier+=(this._result[0]-n.alphaMultiplier)*i,n.redMultiplier+=(this._result[1]-n.redMultiplier)*i,n.greenMultiplier+=(this._result[2]-n.greenMultiplier)*i,n.blueMultiplier+=(this._result[3]-n.blueMultiplier)*i,n.alphaOffset+=(this._result[4]-n.alphaOffset)*i,n.redOffset+=(this._result[5]-n.redOffset)*i,n.greenOffset+=(this._result[6]-n.greenOffset)*i,n.blueOffset+=(this._result[7]-n.blueOffset)*i,this.slot._colorDirty=!0}}else this._dirty&&(this._dirty=!1,n.alphaMultiplier===this._result[0]&&n.redMultiplier===this._result[1]&&n.greenMultiplier===this._result[2]&&n.blueMultiplier===this._result[3]&&n.alphaOffset===this._result[4]&&n.redOffset===this._result[5]&&n.greenOffset===this._result[6]&&n.blueOffset===this._result[7]||(n.alphaMultiplier=this._result[0],n.redMultiplier=this._result[1],n.greenMultiplier=this._result[2],n.blueMultiplier=this._result[3],n.alphaOffset=this._result[4],n.redOffset=this._result[5],n.greenOffset=this._result[6],n.blueOffset=this._result[7],this.slot._colorDirty=!0))}},e}(t.SlotTimelineState);t.SlotColorTimelineState=l;var h=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._current=[],e._delta=[],e._result=[],e}return $4(e,t),e.toString=function(){return"[class dragonBones.DeformTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.vertexOffset=0,this._dirty=!1,this._frameFloatOffset=0,this._valueCount=0,this._deformCount=0,this._valueOffset=0,this._current.length=0,this._delta.length=0,this._result.length=0},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameFloatOffset+this._frameValueOffset+this._frameIndex*this._valueCount,n=this._armature._armatureData.scale,i=this._frameFloatArray;if(2===this._tweenState){var r=e+this._valueCount;this._frameIndex===this._frameCount-1&&(r=this._animationData.frameFloatOffset+this._frameValueOffset);for(var a=0;a<this._valueCount;++a)this._delta[a]=i[r+a]*n-(this._current[a]=i[e+a]*n)}else for(a=0;a<this._valueCount;++a)this._current[a]=i[e+a]*n}else for(a=0;a<this._valueCount;++a)this._current[a]=0},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),this._dirty=!0,2!==this._tweenState&&(this._tweenState=0);for(var e=0;e<this._valueCount;++e)this._result[e]=this._current[e]+this._delta[e]*this._tweenProgress},e.prototype.init=function(e,n,i){if(t.prototype.init.call(this,e,n,i),null!==this._timelineData){var r=this._animationData.frameIntOffset+this._timelineArray[this._timelineData.offset+3];this.vertexOffset=this._frameIntArray[r+0],this.vertexOffset<0&&(this.vertexOffset+=65536),this._deformCount=this._frameIntArray[r+1],this._valueCount=this._frameIntArray[r+2],this._valueOffset=this._frameIntArray[r+3],this._frameFloatOffset=this._frameIntArray[r+4]+this._animationData.frameFloatOffset}else{var a=this.slot._deformVertices;this._deformCount=null!==a?a.vertices.length:0,this._valueCount=this._deformCount,this._valueOffset=0,this._frameFloatOffset=0}this._current.length=this._valueCount,this._delta.length=this._valueCount,this._result.length=this._valueCount;for(var o=0;o<this._valueCount;++o)this._delta[o]=0},e.prototype.fadeOut=function(){this._tweenState=0,this._dirty=!1},e.prototype.update=function(e){var n=this.slot._deformVertices;if(null!==n&&null!==n.verticesData&&n.verticesData.offset===this.vertexOffset&&(t.prototype.update.call(this,e),0!==this._tweenState||this._dirty)){var i=n.vertices;if(0!==this._animationState._fadeState||0!==this._animationState._subFadeState){for(var r=Math.pow(this._animationState._fadeProgress,2),a=0;a<this._deformCount;++a)a<this._valueOffset?i[a]+=(this._frameFloatArray[this._frameFloatOffset+a]-i[a])*r:a<this._valueOffset+this._valueCount?i[a]+=(this._result[a-this._valueOffset]-i[a])*r:i[a]+=(this._frameFloatArray[this._frameFloatOffset+a-this._valueCount]-i[a])*r;n.verticesDirty=!0}else if(this._dirty){for(this._dirty=!1,a=0;a<this._deformCount;++a)a<this._valueOffset?i[a]=this._frameFloatArray[this._frameFloatOffset+a]:a<this._valueOffset+this._valueCount?i[a]=this._result[a-this._valueOffset]:i[a]=this._frameFloatArray[this._frameFloatOffset+a-this._valueCount];n.verticesDirty=!0}}},e}(t.SlotTimelineState);t.DeformTimelineState=h;var u=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $4(e,t),e.toString=function(){return"[class dragonBones.IKConstraintTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this._current=0,this._delta=0},e.prototype._onArriveAtFrame=function(){t.prototype._onArriveAtFrame.call(this);var e=this.constraint;if(null!==this._timelineData){var n=this._animationData.frameIntOffset+this._frameValueOffset+2*this._frameIndex,i=this._frameIntArray,r=0!==i[n++];this._current=.01*i[n++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(n=this._animationData.frameIntOffset+this._frameValueOffset),this._delta=.01*i[n+1]-this._current):this._delta=0,e._bendPositive=r}else{var a=e._constraintData;this._current=a.weight,this._delta=0,e._bendPositive=a.bendPositive}e.invalidUpdate()},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),2!==this._tweenState&&(this._tweenState=0);var e=this.constraint;e._weight=this._current+this._delta*this._tweenProgress,e.invalidUpdate()},e}(t.ConstraintTimelineState);t.IKConstraintTimelineState=u;var _=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._floats=[0,0,0,0,0,0],e}return $4(e,t),e.toString=function(){return"[class dragonBones.AnimationTimelineState]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.animationState=null},e.prototype._onArriveAtFrame=function(){if(t.prototype._onArriveAtFrame.call(this),null!==this._timelineData){var e=this._animationData.frameIntOffset+this._frameValueOffset+2*this._frameIndex,n=1/this.animationState._animationData.parent.frameRate,i=this._frameIntArray;this._floats[0]=i[e++]*n,this._floats[3]=.01*i[e++],2===this._tweenState?(this._frameIndex===this._frameCount-1&&(e=this._animationData.frameIntOffset+this._frameValueOffset),this._floats[1]=i[e++]*n-this._floats[0],this._floats[4]=.01*i[e++]-this._floats[3]):(this._floats[1]=0,this._floats[4]=0)}},e.prototype._onUpdateFrame=function(){t.prototype._onUpdateFrame.call(this),2!==this._tweenState&&(this._tweenState=0),this._floats[0]>=0&&(this._floats[2]=this._floats[0]+this._floats[1]*this._tweenProgress),this._floats[5]=this._floats[3]+this._floats[4]*this._tweenProgress},e.prototype.blend=function(t){var e=this.animationState,n=e._blendState.blendWeight;2===t?(e.weight+=this._floats[5]*n,e.currentTime+=this._floats[2]*n):(e.weight=this._floats[5]*n,e.currentTime=this._floats[2]*n)},e}(t.TweenTimelineState);t.AnimationTimelineState=_}(t3||(t3={})),function(t){var e=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return $4(e,t),e.actionDataToInstance=function(t,n,i){0===t.type?n.type=e.FRAME_EVENT:n.type=10===t.type?e.FRAME_EVENT:e.SOUND_EVENT,n.name=t.name,n.armature=i,n.actionData=t,n.data=t.data,null!==t.bone&&(n.bone=i.getBone(t.bone.name)),null!==t.slot&&(n.slot=i.getSlot(t.slot.name))},e.toString=function(){return"[class dragonBones.EventObject]"},e.prototype._onClear=function(){this.time=0,this.type="",this.name="",this.armature=null,this.bone=null,this.slot=null,this.animationState=null,this.actionData=null,this.data=null},e.START="start",e.LOOP_COMPLETE="loopComplete",e.COMPLETE="complete",e.FADE_IN="fadeIn",e.FADE_IN_COMPLETE="fadeInComplete",e.FADE_OUT="fadeOut",e.FADE_OUT_COMPLETE="fadeOutComplete",e.FRAME_EVENT="frameEvent",e.SOUND_EVENT="soundEvent",e}(t.BaseObject);t.EventObject=e}(t3||(t3={})),function(t){var e=function(){function e(){}return e._getArmatureType=function(t){switch(t.toLowerCase()){case"stage":return 2;case"armature":return 0;case"movieclip":return 1;default:return 0}},e._getBoneType=function(t){switch(t.toLowerCase()){case"bone":return 0;case"surface":return 1;default:return 0}},e._getDisplayType=function(t){switch(t.toLowerCase()){case"image":return 0;case"mesh":return 2;case"armature":return 1;case"boundingbox":return 3;case"path":return 4;default:return 0}},e._getBoundingBoxType=function(t){switch(t.toLowerCase()){case"rectangle":return 0;case"ellipse":return 1;case"polygon":return 2;default:return 0}},e._getActionType=function(t){switch(t.toLowerCase()){case"play":return 0;case"frame":return 10;case"sound":return 11;default:return 0}},e._getBlendMode=function(t){switch(t.toLowerCase()){case"normal":return 0;case"add":return 1;case"alpha":return 2;case"darken":return 3;case"difference":return 4;case"erase":return 5;case"hardlight":return 6;case"invert":return 7;case"layer":return 8;case"lighten":return 9;case"multiply":return 10;case"overlay":return 11;case"screen":return 12;case"subtract":return 13;default:return 0}},e._getPositionMode=function(t){switch(t.toLocaleLowerCase()){case"percent":return 1;case"fixed":return 0;default:return 1}},e._getSpacingMode=function(t){switch(t.toLocaleLowerCase()){case"length":return 0;case"percent":return 2;case"fixed":return 1;default:return 0}},e._getRotateMode=function(t){switch(t.toLocaleLowerCase()){case"tangent":return 0;case"chain":return 1;case"chainscale":return 2;default:return 0}},e.parseDragonBonesData=function(e){return console.warn("Deprecated."),e instanceof ArrayBuffer?t.BinaryDataParser.getInstance().parseDragonBonesData(e):t.ObjectDataParser.getInstance().parseDragonBonesData(e)},e.parseTextureAtlasData=function(n,i){void 0===i&&(i=1),console.warn("");for(var r={},a=n[e.SUB_TEXTURE],o=0,s=a.length;o<s;o++){var c=a[o],l=c[e.NAME],h=new t.Rectangle,u=null;h.x=c[e.X]/i,h.y=c[e.Y]/i,h.width=c[e.WIDTH]/i,h.height=c[e.HEIGHT]/i,e.FRAME_WIDTH in c&&((u=new t.Rectangle).x=c[e.FRAME_X]/i,u.y=c[e.FRAME_Y]/i,u.width=c[e.FRAME_WIDTH]/i,u.height=c[e.FRAME_HEIGHT]/i),r[l]={region:h,frame:u,rotated:!1}}return r},e.DATA_VERSION_2_3="2.3",e.DATA_VERSION_3_0="3.0",e.DATA_VERSION_4_0="4.0",e.DATA_VERSION_4_5="4.5",e.DATA_VERSION_5_0="5.0",e.DATA_VERSION_5_5="5.5",e.DATA_VERSION=e.DATA_VERSION_5_5,e.DATA_VERSIONS=[e.DATA_VERSION_4_0,e.DATA_VERSION_4_5,e.DATA_VERSION_5_0,e.DATA_VERSION_5_5],e.TEXTURE_ATLAS="textureAtlas",e.SUB_TEXTURE="SubTexture",e.FORMAT="format",e.IMAGE_PATH="imagePath",e.WIDTH="width",e.HEIGHT="height",e.ROTATED="rotated",e.FRAME_X="frameX",e.FRAME_Y="frameY",e.FRAME_WIDTH="frameWidth",e.FRAME_HEIGHT="frameHeight",e.DRADON_BONES="dragonBones",e.USER_DATA="userData",e.ARMATURE="armature",e.BONE="bone",e.SURFACE="surface",e.SLOT="slot",e.CONSTRAINT="constraint",e.IK="ik",e.PATH_CONSTRAINT="path",e.SKIN="skin",e.DISPLAY="display",e.ANIMATION="animation",e.Z_ORDER="zOrder",e.FFD="ffd",e.FRAME="frame",e.TRANSLATE_FRAME="translateFrame",e.ROTATE_FRAME="rotateFrame",e.SCALE_FRAME="scaleFrame",e.DISPLAY_FRAME="displayFrame",e.COLOR_FRAME="colorFrame",e.DEFAULT_ACTIONS="defaultActions",e.ACTIONS="actions",e.EVENTS="events",e.INTS="ints",e.FLOATS="floats",e.STRINGS="strings",e.CANVAS="canvas",e.TRANSFORM="transform",e.PIVOT="pivot",e.AABB="aabb",e.COLOR="color",e.VERSION="version",e.COMPATIBLE_VERSION="compatibleVersion",e.FRAME_RATE="frameRate",e.TYPE="type",e.SUB_TYPE="subType",e.NAME="name",e.PARENT="parent",e.TARGET="target",e.STAGE="stage",e.SHARE="share",e.PATH="path",e.LENGTH="length",e.DISPLAY_INDEX="displayIndex",e.BLEND_MODE="blendMode",e.INHERIT_TRANSLATION="inheritTranslation",e.INHERIT_ROTATION="inheritRotation",e.INHERIT_SCALE="inheritScale",e.INHERIT_REFLECTION="inheritReflection",e.INHERIT_ANIMATION="inheritAnimation",e.INHERIT_DEFORM="inheritDeform",e.SEGMENT_X="segmentX",e.SEGMENT_Y="segmentY",e.BEND_POSITIVE="bendPositive",e.CHAIN="chain",e.WEIGHT="weight",e.FADE_IN_TIME="fadeInTime",e.PLAY_TIMES="playTimes",e.SCALE="scale",e.OFFSET="offset",e.POSITION="position",e.DURATION="duration",e.TWEEN_EASING="tweenEasing",e.TWEEN_ROTATE="tweenRotate",e.TWEEN_SCALE="tweenScale",e.CLOCK_WISE="clockwise",e.CURVE="curve",e.SOUND="sound",e.EVENT="event",e.ACTION="action",e.X="x",e.Y="y",e.SKEW_X="skX",e.SKEW_Y="skY",e.SCALE_X="scX",e.SCALE_Y="scY",e.VALUE="value",e.ROTATE="rotate",e.SKEW="skew",e.ALPHA_OFFSET="aO",e.RED_OFFSET="rO",e.GREEN_OFFSET="gO",e.BLUE_OFFSET="bO",e.ALPHA_MULTIPLIER="aM",e.RED_MULTIPLIER="rM",e.GREEN_MULTIPLIER="gM",e.BLUE_MULTIPLIER="bM",e.UVS="uvs",e.VERTICES="vertices",e.TRIANGLES="triangles",e.WEIGHTS="weights",e.SLOT_POSE="slotPose",e.BONE_POSE="bonePose",e.GLUE_WEIGHTS="glueWeights",e.GLUE_MESHES="glueMeshes",e.BONES="bones",e.POSITION_MODE="positionMode",e.SPACING_MODE="spacingMode",e.ROTATE_MODE="rotateMode",e.SPACING="spacing",e.ROTATE_OFFSET="rotateOffset",e.ROTATE_MIX="rotateMix",e.TRANSLATE_MIX="translateMix",e.TARGET_DISPLAY="targetDisplay",e.CLOSED="closed",e.CONSTANT_SPEED="constantSpeed",e.VERTEX_COUNT="vertexCount",e.LENGTHS="lengths",e.GOTO_AND_PLAY="gotoAndPlay",e.DEFAULT_NAME="default",e}();t.DataParser=e}(t3||(t3={})),function(t){var e=function(e){function i(){var n=null!==e&&e.apply(this,arguments)||this;return n._rawTextureAtlasIndex=0,n._rawBones=[],n._data=null,n._armature=null,n._bone=null,n._surface=null,n._slot=null,n._skin=null,n._mesh=null,n._animation=null,n._timeline=null,n._rawTextureAtlases=null,n._defaultColorOffset=-1,n._prevClockwise=0,n._prevRotation=0,n._helpMatrixA=new t.Matrix,n._helpMatrixB=new t.Matrix,n._helpTransform=new t.Transform,n._helpColorTransform=new t.ColorTransform,n._helpPoint=new t.Point,n._helpArray=[],n._intArray=[],n._floatArray=[],n._frameIntArray=[],n._frameFloatArray=[],n._frameArray=[],n._timelineArray=[],n._cacheRawMeshes=[],n._cacheMeshes=[],n._actionFrames=[],n._weightSlotPose={},n._weightBonePoses={},n._cacheBones={},n._slotChildActions={},n}return $4(i,e),i._getBoolean=function(t,e,n){if(e in t){var i=t[e],r=typeof i;if("boolean"===r)return i;if("string"!==r)return!!i;switch(i){case"0":case"NaN":case"":case"false":case"null":case"undefined":return!1;default:return!0}}return n},i._getNumber=function(t,e,n){if(e in t){var i=t[e];return null===i||"NaN"===i?n:+i||0}return n},i._getString=function(e,n,i){if(n in e){var r=e[n];if("string"==typeof r){if(t.DragonBones.webAssembly)for(var a=0,o=r.length;a<o;++a)if(r.charCodeAt(a)>255)return encodeURI(r);return r}return String(r)}return i},i.prototype._getCurvePoint=function(t,e,n,i,r,a,o,s,c,l){var h=1-c,u=h*h,_=c*c,f=h*u,d=3*c*u,p=3*h*_,m=c*_;l.x=f*t+d*n+p*r+m*o,l.y=f*e+d*i+p*a+m*s},i.prototype._samplingEasingCurve=function(t,e){for(var n=t.length,i=-2,r=0,a=e.length;r<a;++r){for(var o=(r+1)/(a+1);(i+6<n?t[i+6]:1)<o;)i+=6;for(var s=i>=0&&i+6<n,c=s?t[i]:0,l=s?t[i+1]:0,h=t[i+2],u=t[i+3],_=t[i+4],f=t[i+5],d=s?t[i+6]:1,p=s?t[i+7]:1,m=0,v=1;v-m>1e-4;){var g=.5*(v+m);this._getCurvePoint(c,l,h,u,_,f,d,p,g,this._helpPoint),o-this._helpPoint.x>0?m=g:v=g}e[r]=this._helpPoint.y}},i.prototype._parseActionDataInFrame=function(e,n,i,r){t.DataParser.EVENT in e&&this._mergeActionFrame(e[t.DataParser.EVENT],n,10,i,r),t.DataParser.SOUND in e&&this._mergeActionFrame(e[t.DataParser.SOUND],n,11,i,r),t.DataParser.ACTION in e&&this._mergeActionFrame(e[t.DataParser.ACTION],n,0,i,r),t.DataParser.EVENTS in e&&this._mergeActionFrame(e[t.DataParser.EVENTS],n,10,i,r),t.DataParser.ACTIONS in e&&this._mergeActionFrame(e[t.DataParser.ACTIONS],n,0,i,r)},i.prototype._mergeActionFrame=function(e,i,r,a,o){for(var s=t.DragonBones.webAssembly?this._armature.actions.size():this._armature.actions.length,c=this._parseActionData(e,r,a,o),l=0,h=null,u=0,_=c;u<_.length;u++){var f=_[u];this._armature.addAction(f,!1)}0===this._actionFrames.length&&((h=new n).frameStart=0,this._actionFrames.push(h),h=null);for(var d=0,p=this._actionFrames;d<p.length;d++){var m=p[d];if(m.frameStart===i){h=m;break}if(m.frameStart>i)break;l++}null===h&&((h=new n).frameStart=i,this._actionFrames.splice(l+1,0,h));for(var v=0;v<c.length;++v)h.actions.push(s+v)},i.prototype._parseArmature=function(e,n){var r=t.BaseObject.borrowObject(t.ArmatureData);if(r.name=i._getString(e,t.DataParser.NAME,""),r.frameRate=i._getNumber(e,t.DataParser.FRAME_RATE,this._data.frameRate),r.scale=n,t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?r.type=t.DataParser._getArmatureType(e[t.DataParser.TYPE]):r.type=i._getNumber(e,t.DataParser.TYPE,0),0===r.frameRate&&(r.frameRate=24),this._armature=r,t.DataParser.CANVAS in e){var a=e[t.DataParser.CANVAS],o=t.BaseObject.borrowObject(t.CanvasData);t.DataParser.COLOR in a?o.hasBackground=!0:o.hasBackground=!1,o.color=i._getNumber(a,t.DataParser.COLOR,0),o.x=i._getNumber(a,t.DataParser.X,0)*r.scale,o.y=i._getNumber(a,t.DataParser.Y,0)*r.scale,o.width=i._getNumber(a,t.DataParser.WIDTH,0)*r.scale,o.height=i._getNumber(a,t.DataParser.HEIGHT,0)*r.scale,r.canvas=o}if(t.DataParser.AABB in e){var s=e[t.DataParser.AABB];r.aabb.x=i._getNumber(s,t.DataParser.X,0)*r.scale,r.aabb.y=i._getNumber(s,t.DataParser.Y,0)*r.scale,r.aabb.width=i._getNumber(s,t.DataParser.WIDTH,0)*r.scale,r.aabb.height=i._getNumber(s,t.DataParser.HEIGHT,0)*r.scale}if(t.DataParser.BONE in e)for(var c=0,l=e[t.DataParser.BONE];c<l.length;c++){var h=l[c],u=i._getString(h,t.DataParser.PARENT,""),_=this._parseBone(h);if(u.length>0){var f=r.getBone(u);null!==f?_.parent=f:(u in this._cacheBones||(this._cacheBones[u]=[]),this._cacheBones[u].push(_))}if(_.name in this._cacheBones){for(var d=0,p=this._cacheBones[_.name];d<p.length;d++)p[d].parent=_;delete this._cacheBones[_.name]}r.addBone(_),this._rawBones.push(_)}if(t.DataParser.IK in e)for(var m=0,v=e[t.DataParser.IK];m<v.length;m++){var g=v[m];(I=this._parseIKConstraint(g))&&r.addConstraint(I)}if(r.sortBones(),t.DataParser.SLOT in e)for(var y=0,x=0,S=e[t.DataParser.SLOT];x<S.length;x++){var A=S[x];r.addSlot(this._parseSlot(A,y++))}if(t.DataParser.SKIN in e)for(var b=0,C=e[t.DataParser.SKIN];b<C.length;b++){var T=C[b];r.addSkin(this._parseSkin(T))}if(t.DataParser.PATH_CONSTRAINT in e)for(var E=0,w=e[t.DataParser.PATH_CONSTRAINT];E<w.length;E++){var I,P=w[E];(I=this._parsePathConstraint(P))&&r.addConstraint(I)}for(var D=0,R=this._cacheRawMeshes.length;D<R;++D){var M=this._cacheRawMeshes[D];t.DataParser.GLUE_WEIGHTS in M&&t.DataParser.GLUE_MESHES in M&&this._parseMeshGlue(M,this._cacheMeshes[D])}for(D=0,R=this._cacheRawMeshes.length;D<R;++D){var O=this._cacheRawMeshes[D],N=i._getString(O,t.DataParser.SHARE,"");if(0!==N.length){var B=i._getString(O,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME);0===B.length&&(B=t.DataParser.DEFAULT_NAME);var L=r.getMesh(B,"",N);null!==L&&this._cacheMeshes[D].vertices.shareFrom(L.vertices)}}if(t.DataParser.ANIMATION in e)for(var F=0,V=e[t.DataParser.ANIMATION];F<V.length;F++){var z=V[F],k=this._parseAnimation(z);r.addAnimation(k)}if(t.DataParser.DEFAULT_ACTIONS in e)for(var U=0,G=this._parseActionData(e[t.DataParser.DEFAULT_ACTIONS],0,null,null);U<G.length;U++){var H=G[U];r.addAction(H,!0),0===H.type&&null!==(k=r.getAnimation(H.name))&&(r.defaultAnimation=k)}if(t.DataParser.ACTIONS in e)for(var j=0,W=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);j<W.length;j++)H=W[j],r.addAction(H,!1);for(var q in this._rawBones.length=0,this._cacheRawMeshes.length=0,this._cacheMeshes.length=0,this._armature=null,this._weightSlotPose)delete this._weightSlotPose[q];for(var q in this._weightBonePoses)delete this._weightBonePoses[q];for(var q in this._cacheBones)delete this._cacheBones[q];for(var q in this._slotChildActions)delete this._slotChildActions[q];return r},i.prototype._parseBone=function(e){var n=this._armature.scale;if(0===(t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getBoneType(e[t.DataParser.TYPE]):i._getNumber(e,t.DataParser.TYPE,0))){var r=t.BaseObject.borrowObject(t.BoneData);return r.inheritTranslation=i._getBoolean(e,t.DataParser.INHERIT_TRANSLATION,!0),r.inheritRotation=i._getBoolean(e,t.DataParser.INHERIT_ROTATION,!0),r.inheritScale=i._getBoolean(e,t.DataParser.INHERIT_SCALE,!0),r.inheritReflection=i._getBoolean(e,t.DataParser.INHERIT_REFLECTION,!0),r.length=i._getNumber(e,t.DataParser.LENGTH,0)*n,r.name=i._getString(e,t.DataParser.NAME,""),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],r.transform,n),r}var a=t.BaseObject.borrowObject(t.SurfaceData);if(a.name=i._getString(e,t.DataParser.NAME,""),a.segmentX=i._getNumber(e,t.DataParser.SEGMENT_X,0),a.segmentY=i._getNumber(e,t.DataParser.SEGMENT_Y,0),a.vertices.length=(a.segmentX+1)*(a.segmentY+1)*2,t.DataParser.VERTICES in e)for(var o=e[t.DataParser.VERTICES],s=0,c=a.vertices.length;s<c;++s)s<o.length?a.vertices[s]=o[s]*n:a.vertices[s]=0;return a},i.prototype._parseIKConstraint=function(e){var n=this._armature.getBone(i._getString(e,t.DataParser.BONE,""));if(null===n)return null;var r=this._armature.getBone(i._getString(e,t.DataParser.TARGET,""));if(null===r)return null;var a=t.BaseObject.borrowObject(t.IKConstraintData);return a.scaleEnabled=i._getBoolean(e,t.DataParser.SCALE,!1),a.bendPositive=i._getBoolean(e,t.DataParser.BEND_POSITIVE,!0),a.weight=i._getNumber(e,t.DataParser.WEIGHT,1),a.name=i._getString(e,t.DataParser.NAME,""),a.type=0,a.target=r,i._getNumber(e,t.DataParser.CHAIN,0)>0&&null!==n.parent?(a.root=n.parent,a.bone=n):(a.root=n,a.bone=null),a},i.prototype._parsePathConstraint=function(e){var n=this._armature.getSlot(i._getString(e,t.DataParser.TARGET,""));if(null===n)return null;var r=this._armature.defaultSkin;if(null===r)return null;var a=r.getDisplay(n.name,i._getString(e,t.DataParser.TARGET_DISPLAY,n.name));if(null===a||!(a instanceof t.PathDisplayData))return null;var o=e[t.DataParser.BONES];if(null===o||0===o.length)return null;var s=t.BaseObject.borrowObject(t.PathConstraintData);s.name=i._getString(e,t.DataParser.NAME,""),s.type=1,s.pathSlot=n,s.pathDisplayData=a,s.target=n.parent,s.positionMode=t.DataParser._getPositionMode(i._getString(e,t.DataParser.POSITION_MODE,"")),s.spacingMode=t.DataParser._getSpacingMode(i._getString(e,t.DataParser.SPACING_MODE,"")),s.rotateMode=t.DataParser._getRotateMode(i._getString(e,t.DataParser.ROTATE_MODE,"")),s.position=i._getNumber(e,t.DataParser.POSITION,0),s.spacing=i._getNumber(e,t.DataParser.SPACING,0),s.rotateOffset=i._getNumber(e,t.DataParser.ROTATE_OFFSET,0),s.rotateMix=i._getNumber(e,t.DataParser.ROTATE_MIX,1),s.translateMix=i._getNumber(e,t.DataParser.TRANSLATE_MIX,1);for(var c=0,l=o;c<l.length;c++){var h=l[c],u=this._armature.getBone(h);null!==u&&(s.AddBone(u),null===s.root&&(s.root=u))}return s},i.prototype._parseSlot=function(e,n){var r=t.BaseObject.borrowObject(t.SlotData);return r.displayIndex=i._getNumber(e,t.DataParser.DISPLAY_INDEX,0),r.zOrder=n,r.name=i._getString(e,t.DataParser.NAME,""),r.parent=this._armature.getBone(i._getString(e,t.DataParser.PARENT,"")),t.DataParser.BLEND_MODE in e&&"string"==typeof e[t.DataParser.BLEND_MODE]?r.blendMode=t.DataParser._getBlendMode(e[t.DataParser.BLEND_MODE]):r.blendMode=i._getNumber(e,t.DataParser.BLEND_MODE,0),t.DataParser.COLOR in e?(r.color=t.SlotData.createColor(),this._parseColorTransform(e[t.DataParser.COLOR],r.color)):r.color=t.SlotData.DEFAULT_COLOR,t.DataParser.ACTIONS in e&&(this._slotChildActions[r.name]=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null)),r},i.prototype._parseSkin=function(e){var n=t.BaseObject.borrowObject(t.SkinData);if(n.name=i._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===n.name.length&&(n.name=t.DataParser.DEFAULT_NAME),t.DataParser.SLOT in e){var r=e[t.DataParser.SLOT];this._skin=n;for(var a=0,o=r;a<o.length;a++){var s=o[a],c=i._getString(s,t.DataParser.NAME,""),l=this._armature.getSlot(c);if(null!==l){if(this._slot=l,t.DataParser.DISPLAY in s)for(var h=0,u=s[t.DataParser.DISPLAY];h<u.length;h++){var _=u[h];_?n.addDisplay(c,this._parseDisplay(_)):n.addDisplay(c,null)}this._slot=null}}this._skin=null}return n},i.prototype._parseDisplay=function(e){var n=i._getString(e,t.DataParser.NAME,""),r=i._getString(e,t.DataParser.PATH,""),a=0,o=null;switch(a=t.DataParser.TYPE in e&&"string"==typeof e[t.DataParser.TYPE]?t.DataParser._getDisplayType(e[t.DataParser.TYPE]):i._getNumber(e,t.DataParser.TYPE,a)){case 0:var s=o=t.BaseObject.borrowObject(t.ImageDisplayData);s.name=n,s.path=r.length>0?r:n,this._parsePivot(e,s);break;case 1:var c=o=t.BaseObject.borrowObject(t.ArmatureDisplayData);if(c.name=n,c.path=r.length>0?r:n,c.inheritAnimation=!0,t.DataParser.ACTIONS in e)for(var l=0,h=this._parseActionData(e[t.DataParser.ACTIONS],0,null,null);l<h.length;l++){var u=h[l];c.addAction(u)}else if(this._slot.name in this._slotChildActions){var _=this._skin.getDisplays(this._slot.name);if(null===_?0===this._slot.displayIndex:this._slot.displayIndex===_.length){for(var f=0,d=this._slotChildActions[this._slot.name];f<d.length;f++)u=d[f],c.addAction(u);delete this._slotChildActions[this._slot.name]}}break;case 2:var p=o=t.BaseObject.borrowObject(t.MeshDisplayData);p.vertices.inheritDeform=i._getBoolean(e,t.DataParser.INHERIT_DEFORM,!0),p.name=n,p.path=r.length>0?r:n,p.vertices.data=this._data,t.DataParser.SHARE in e?(this._cacheRawMeshes.push(e),this._cacheMeshes.push(p)):this._parseMesh(e,p),t.DataParser.GLUE_WEIGHTS in e&&t.DataParser.GLUE_MESHES in e&&(this._cacheRawMeshes.push(e),this._cacheMeshes.push(p));break;case 3:var m=this._parseBoundingBox(e);if(null!==m){var v=o=t.BaseObject.borrowObject(t.BoundingBoxDisplayData);v.name=n,v.path=r.length>0?r:n,v.boundingBox=m}break;case 4:var g=e[t.DataParser.LENGTHS],y=o=t.BaseObject.borrowObject(t.PathDisplayData);y.closed=i._getBoolean(e,t.DataParser.CLOSED,!1),y.constantSpeed=i._getBoolean(e,t.DataParser.CONSTANT_SPEED,!1),y.name=n,y.path=r.length>0?r:n,y.vertices.data=this._data,y.curveLengths.length=g.length;for(var x=0,S=g.length;x<S;++x)y.curveLengths[x]=g[x];this._parsePath(e,y)}return null!==o&&t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],o.transform,this._armature.scale),o},i.prototype._parsePath=function(e,n){var r=e[t.DataParser.VERTICES],a=i._getNumber(e,t.DataParser.VERTEX_COUNT,0),o=this._floatArray.length,s=this._intArray.length;if(n.vertices.offset=s,this._intArray.length+=2,this._intArray[s+0]=a,this._intArray[s+2]=o,t.DataParser.WEIGHTS in e){var c=e[t.DataParser.WEIGHTS],l=e[t.DataParser.BONES],h=l.length,u=Math.floor(c.length-a)/2,_=this._intArray.length,f=this._floatArray.length,d=this._armature.sortedBones,p=t.BaseObject.borrowObject(t.WeightData);for(p.count=u,p.offset=_,this._intArray.length+=2+h+a+u,this._intArray[_+0]=h,this._intArray[_+1]=f,I=0;I<h;I++){var m=l[I],v=this._rawBones[m];p.addBone(v),this._intArray[_+2+I]=d.indexOf(v)}this._floatArray.length+=3*u,I=0;for(var g=0,y=0,x=_+2+h,S=f;I<u;I++){var A=c[g++];this._intArray[x++]=A;for(var b=0;b<A;b++){var C=c[g++],T=c[g++],E=r[y++],w=r[y++];this._intArray[x++]=l.indexOf(C),this._floatArray[S++]=T,this._floatArray[S++]=E,this._floatArray[S++]=w}}n.vertices.weight=p}else{this._floatArray.length+=r.length;for(var I=0,P=r.length;I<P;++I)this._floatArray[o+I]=r[I]}},i.prototype._parsePivot=function(e,n){if(t.DataParser.PIVOT in e){var r=e[t.DataParser.PIVOT];n.pivot.x=i._getNumber(r,t.DataParser.X,0),n.pivot.y=i._getNumber(r,t.DataParser.Y,0)}else n.pivot.x=.5,n.pivot.y=.5},i.prototype._parseMesh=function(e,n){var i=e[t.DataParser.VERTICES],r=e[t.DataParser.UVS],a=e[t.DataParser.TRIANGLES],o=Math.floor(i.length/2),s=Math.floor(a.length/3),c=this._floatArray.length,l=c+2*o,h=this._intArray.length,u=this._skin.name+"_"+this._slot.name+"_"+n.name;n.vertices.offset=h,this._intArray.length+=4+3*s,this._intArray[h+0]=o,this._intArray[h+1]=s,this._intArray[h+2]=c;for(var _=0,f=3*s;_<f;++_)this._intArray[h+4+_]=a[_];for(this._floatArray.length+=2*o+2*o,_=0,f=2*o;_<f;++_)this._floatArray[c+_]=i[_],this._floatArray[l+_]=r[_];if(t.DataParser.WEIGHTS in e){var d=e[t.DataParser.WEIGHTS],p=e[t.DataParser.SLOT_POSE],m=e[t.DataParser.BONE_POSE],v=this._armature.sortedBones,g=new Array,y=Math.floor(m.length/7),x=this._floatArray.length,S=Math.floor(d.length-o)/2,A=this._intArray.length,b=t.BaseObject.borrowObject(t.WeightData);for(b.count=S,b.offset=A,g.length=y,this._intArray.length+=2+y+o+S,this._intArray[A+1]=x,_=0;_<y;++_){var C=m[7*_],T=this._rawBones[C];b.addBone(T),g[_]=C,this._intArray[A+2+_]=v.indexOf(T)}this._floatArray.length+=3*S,this._helpMatrixA.copyFromArray(p,0),_=0;for(var E=0,w=A+2+y,I=x;_<o;++_){var P=2*_,D=this._intArray[w++]=d[E++],R=this._floatArray[c+P],M=this._floatArray[c+P+1];this._helpMatrixA.transformPoint(R,M,this._helpPoint),R=this._helpPoint.x,M=this._helpPoint.y;for(var O=0;O<D;++O){C=d[E++];var N=g.indexOf(C);this._helpMatrixB.copyFromArray(m,7*N+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(R,M,this._helpPoint),this._intArray[w++]=N,this._floatArray[I++]=d[E++],this._floatArray[I++]=this._helpPoint.x,this._floatArray[I++]=this._helpPoint.y}}n.vertices.weight=b,this._weightSlotPose[u]=p,this._weightBonePoses[u]=m}},i.prototype._parseMeshGlue=function(){},i.prototype._parseBoundingBox=function(e){var n=null,r=0;switch(r=t.DataParser.SUB_TYPE in e&&"string"==typeof e[t.DataParser.SUB_TYPE]?t.DataParser._getBoundingBoxType(e[t.DataParser.SUB_TYPE]):i._getNumber(e,t.DataParser.SUB_TYPE,r)){case 0:n=t.BaseObject.borrowObject(t.RectangleBoundingBoxData);break;case 1:n=t.BaseObject.borrowObject(t.EllipseBoundingBoxData);break;case 2:n=this._parsePolygonBoundingBox(e)}return null!==n&&(n.color=i._getNumber(e,t.DataParser.COLOR,0),0!==n.type&&1!==n.type||(n.width=i._getNumber(e,t.DataParser.WIDTH,0),n.height=i._getNumber(e,t.DataParser.HEIGHT,0))),n},i.prototype._parsePolygonBoundingBox=function(e){var n=t.BaseObject.borrowObject(t.PolygonBoundingBoxData);if(t.DataParser.VERTICES in e){var i=this._armature.scale,r=e[t.DataParser.VERTICES],a=n.vertices;t.DragonBones.webAssembly?a.resize(r.length,0):a.length=r.length;for(var o=0,s=r.length;o<s;o+=2){var c=r[o]*i,l=r[o+1]*i;t.DragonBones.webAssembly?(a.set(o,c),a.set(o+1,l)):(a[o]=c,a[o+1]=l),0===o?(n.x=c,n.y=l,n.width=c,n.height=l):(c<n.x?n.x=c:c>n.width&&(n.width=c),l<n.y?n.y=l:l>n.height&&(n.height=l))}n.width-=n.x,n.height-=n.y}else console.warn("Data error.\n Please reexport DragonBones Data to fixed the bug.");return n},i.prototype._parseAnimation=function(e){var n=t.BaseObject.borrowObject(t.AnimationData);if(n.frameCount=Math.max(i._getNumber(e,t.DataParser.DURATION,1),1),n.playTimes=i._getNumber(e,t.DataParser.PLAY_TIMES,1),n.duration=n.frameCount/this._armature.frameRate,n.fadeInTime=i._getNumber(e,t.DataParser.FADE_IN_TIME,0),n.scale=i._getNumber(e,t.DataParser.SCALE,1),n.name=i._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===n.name.length&&(n.name=t.DataParser.DEFAULT_NAME),n.frameIntOffset=this._frameIntArray.length,n.frameFloatOffset=this._frameFloatArray.length,n.frameOffset=this._frameArray.length,this._animation=n,t.DataParser.FRAME in e){var r=e[t.DataParser.FRAME],a=r.length;if(a>0)for(var o=0,s=0;o<a;++o){var c=r[o];this._parseActionDataInFrame(c,s,null,null),s+=i._getNumber(c,t.DataParser.DURATION,1)}}if(t.DataParser.Z_ORDER in e&&(this._animation.zOrderTimeline=this._parseTimeline(e[t.DataParser.Z_ORDER],null,t.DataParser.FRAME,1,!1,!1,0,this._parseZOrderFrame)),t.DataParser.BONE in e)for(var l=0,h=e[t.DataParser.BONE];l<h.length;l++){var u=h[l];this._parseBoneTimeline(u)}if(t.DataParser.SURFACE in e)for(var _=0,f=e[t.DataParser.SURFACE];_<f.length;_++){u=f[_];var d=i._getString(u,t.DataParser.NAME,"");this._surface=this._armature.getBone(d),null!==this._surface&&(null!==(I=this._parseTimeline(u,null,t.DataParser.FRAME,50,!1,!0,0,this._parseSurfaceFrame))&&this._animation.addSurfaceTimeline(this._surface,I),this._surface=null)}if(t.DataParser.SLOT in e)for(var p=0,m=e[t.DataParser.SLOT];p<m.length;p++)u=m[p],this._parseSlotTimeline(u);if(t.DataParser.FFD in e)for(var v=0,g=e[t.DataParser.FFD];v<g.length;v++){u=g[v];var y=i._getString(u,t.DataParser.SKIN,t.DataParser.DEFAULT_NAME),x=i._getString(u,t.DataParser.SLOT,""),S=i._getString(u,t.DataParser.NAME,"");0===y.length&&(y=t.DataParser.DEFAULT_NAME),this._slot=this._armature.getSlot(x),this._mesh=this._armature.getMesh(y,x,S),null!==this._slot&&null!==this._mesh&&(null!==(I=this._parseTimeline(u,null,t.DataParser.FRAME,22,!1,!0,0,this._parseSlotFFDFrame))&&this._animation.addSlotTimeline(this._slot,I),this._slot=null,this._mesh=null)}if(t.DataParser.IK in e)for(var A=0,b=e[t.DataParser.IK];A<b.length;A++){u=b[A];var C=i._getString(u,t.DataParser.NAME,""),T=this._armature.getConstraint(C);null!==T&&null!==(I=this._parseTimeline(u,null,t.DataParser.FRAME,30,!0,!1,2,this._parseIKConstraintFrame))&&this._animation.addConstraintTimeline(T,I)}if(t.DataParser.ANIMATION in e)for(var E=0,w=e[t.DataParser.ANIMATION];E<w.length;E++){u=w[E];var I,P=i._getString(u,t.DataParser.NAME,"");null!==(I=this._parseTimeline(u,null,t.DataParser.FRAME,40,!0,!1,2,this._parseAnimationFrame))&&this._animation.addAnimationTimeline(P,I)}return this._actionFrames.length>0&&(this._animation.actionTimeline=this._parseTimeline(null,this._actionFrames,"",0,!1,!1,0,this._parseActionFrame),this._actionFrames.length=0),this._animation=null,n},i.prototype._parseTimeline=function(e,r,a,o,s,c,l,h){if(null!==e&&a.length>0&&a in e&&(r=e[a]),null===r)return null;var u=r.length;if(0===u)return null;var _=this._frameIntArray.length,f=this._frameFloatArray.length,d=t.BaseObject.borrowObject(t.TimelineData),p=this._timelineArray.length;if(this._timelineArray.length+=5+u,null!==e?(this._timelineArray[p+0]=Math.round(100*i._getNumber(e,t.DataParser.SCALE,1)),this._timelineArray[p+1]=Math.round(100*i._getNumber(e,t.DataParser.OFFSET,0))):(this._timelineArray[p+0]=100,this._timelineArray[p+1]=0),this._timelineArray[p+2]=u,this._timelineArray[p+3]=l,this._timelineArray[p+4]=s?_-this._animation.frameIntOffset:c?f-this._animation.frameFloatOffset:0,this._timeline=d,d.type=o,d.offset=p,1===u)d.frameIndicesOffset=-1,this._timelineArray[p+5+0]=h.call(this,r[0],0,0)-this._animation.frameOffset;else{var m=this._animation.frameCount+1,v=this._data.frameIndices,g=0;t.DragonBones.webAssembly?(g=v.size(),v.resize(g+m,0)):(g=v.length,v.length+=m),d.frameIndicesOffset=g;for(var y=0,x=0,S=0,A=0;y<m;++y){if(S+A<=y&&x<u){var b=r[x];S=y,A=x===u-1?this._animation.frameCount-S:b instanceof n?this._actionFrames[x+1].frameStart-S:i._getNumber(b,t.DataParser.DURATION,1),this._timelineArray[p+5+x]=h.call(this,b,S,A)-this._animation.frameOffset,x++}t.DragonBones.webAssembly?v.set(g+y,x-1):v[g+y]=x-1}}return this._timeline=null,d},i.prototype._parseBoneTimeline=function(e){var n,r=this._armature.getBone(i._getString(e,t.DataParser.NAME,""));null!==r&&(this._bone=r,this._slot=this._armature.getSlot(this._bone.name),t.DataParser.TRANSLATE_FRAME in e&&null!==(n=this._parseTimeline(e,null,t.DataParser.TRANSLATE_FRAME,11,!1,!0,2,this._parseBoneTranslateFrame))&&this._animation.addBoneTimeline(r,n),t.DataParser.ROTATE_FRAME in e&&null!==(n=this._parseTimeline(e,null,t.DataParser.ROTATE_FRAME,12,!1,!0,2,this._parseBoneRotateFrame))&&this._animation.addBoneTimeline(r,n),t.DataParser.SCALE_FRAME in e&&null!==(n=this._parseTimeline(e,null,t.DataParser.SCALE_FRAME,13,!1,!0,2,this._parseBoneScaleFrame))&&this._animation.addBoneTimeline(r,n),t.DataParser.FRAME in e&&null!==(n=this._parseTimeline(e,null,t.DataParser.FRAME,10,!1,!0,6,this._parseBoneAllFrame))&&this._animation.addBoneTimeline(r,n),this._bone=null,this._slot=null)},i.prototype._parseSlotTimeline=function(e){var n=this._armature.getSlot(i._getString(e,t.DataParser.NAME,""));if(null!==n){this._slot=n;var r;null!==(r=t.DataParser.DISPLAY_FRAME in e?this._parseTimeline(e,null,t.DataParser.DISPLAY_FRAME,20,!1,!1,0,this._parseSlotDisplayFrame):this._parseTimeline(e,null,t.DataParser.FRAME,20,!1,!1,0,this._parseSlotDisplayFrame))&&this._animation.addSlotTimeline(n,r);var a;null!==(a=t.DataParser.COLOR_FRAME in e?this._parseTimeline(e,null,t.DataParser.COLOR_FRAME,21,!0,!1,1,this._parseSlotColorFrame):this._parseTimeline(e,null,t.DataParser.FRAME,21,!0,!1,1,this._parseSlotColorFrame))&&this._animation.addSlotTimeline(n,a),this._slot=null}},i.prototype._parseFrame=function(t,e){var n=this._frameArray.length;return this._frameArray.length+=1,this._frameArray[n+0]=e,n},i.prototype._parseTweenFrame=function(e,n,r){var a=this._parseFrame(e,n,r);if(r>0)if(t.DataParser.CURVE in e){var o=r+1;this._helpArray.length=o,this._samplingEasingCurve(e[t.DataParser.CURVE],this._helpArray),this._frameArray.length+=2+this._helpArray.length,this._frameArray[a+1]=2,this._frameArray[a+2]=o;for(var s=0;s<o;++s)this._frameArray[a+3+s]=Math.round(1e4*this._helpArray[s])}else{var c=-2;t.DataParser.TWEEN_EASING in e&&(c=i._getNumber(e,t.DataParser.TWEEN_EASING,-2)),-2===c?(this._frameArray.length+=1,this._frameArray[a+1]=0):0===c?(this._frameArray.length+=1,this._frameArray[a+1]=1):c<0?(this._frameArray.length+=2,this._frameArray[a+1]=3,this._frameArray[a+2]=Math.round(100*-c)):c<=1?(this._frameArray.length+=2,this._frameArray[a+1]=4,this._frameArray[a+2]=Math.round(100*c)):(this._frameArray.length+=2,this._frameArray[a+1]=5,this._frameArray[a+2]=Math.round(100*c-100))}else this._frameArray.length+=1,this._frameArray[a+1]=0;return a},i.prototype._parseActionFrame=function(t,e){var n=this._frameArray.length,i=t.actions.length;this._frameArray.length+=2+i,this._frameArray[n+0]=e,this._frameArray[n+0+1]=i;for(var r=0;r<i;++r)this._frameArray[n+0+2+r]=t.actions[r];return n},i.prototype._parseZOrderFrame=function(e,n,i){var r=this._parseFrame(e,n,i);if(t.DataParser.Z_ORDER in e){var a=e[t.DataParser.Z_ORDER];if(a.length>0){for(var o=this._armature.sortedSlots.length,s=new Array(o-a.length/2),c=new Array(o),l=0;l<s.length;++l)s[l]=0;for(var h=0;h<o;++h)c[h]=-1;for(var u=0,_=0,f=0,d=a.length;f<d;f+=2){for(var p=a[f],m=a[f+1];u!==p;)s[_++]=u++;c[u+m]=u++}for(;u<o;)s[_++]=u++;this._frameArray.length+=1+o,this._frameArray[r+1]=o;for(var v=o;v--;)-1===c[v]?this._frameArray[r+2+v]=s[--_]||0:this._frameArray[r+2+v]=c[v]||0;return r}}return this._frameArray.length+=1,this._frameArray[r+1]=0,r},i.prototype._parseBoneAllFrame=function(e,n,r){this._helpTransform.identity(),t.DataParser.TRANSFORM in e&&this._parseTransform(e[t.DataParser.TRANSFORM],this._helpTransform,1);var a=this._helpTransform.rotation;0!==n&&(0===this._prevClockwise?a=this._prevRotation+t.Transform.normalizeRadian(a-this._prevRotation):((this._prevClockwise>0?a>=this._prevRotation:a<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),a=this._prevRotation+a-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=i._getNumber(e,t.DataParser.TWEEN_ROTATE,0),this._prevRotation=a;var o=this._parseTweenFrame(e,n,r),s=this._frameFloatArray.length;return this._frameFloatArray.length+=6,this._frameFloatArray[s++]=this._helpTransform.x,this._frameFloatArray[s++]=this._helpTransform.y,this._frameFloatArray[s++]=a,this._frameFloatArray[s++]=this._helpTransform.skew,this._frameFloatArray[s++]=this._helpTransform.scaleX,this._frameFloatArray[s++]=this._helpTransform.scaleY,this._parseActionDataInFrame(e,n,this._bone,this._slot),o},i.prototype._parseBoneTranslateFrame=function(e,n,r){var a=this._parseTweenFrame(e,n,r),o=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[o++]=i._getNumber(e,t.DataParser.X,0),this._frameFloatArray[o++]=i._getNumber(e,t.DataParser.Y,0),a},i.prototype._parseBoneRotateFrame=function(e,n,r){var a=i._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD;0!==n&&(0===this._prevClockwise?a=this._prevRotation+t.Transform.normalizeRadian(a-this._prevRotation):((this._prevClockwise>0?a>=this._prevRotation:a<=this._prevRotation)&&(this._prevClockwise=this._prevClockwise>0?this._prevClockwise-1:this._prevClockwise+1),a=this._prevRotation+a-this._prevRotation+t.Transform.PI_D*this._prevClockwise)),this._prevClockwise=i._getNumber(e,t.DataParser.CLOCK_WISE,0),this._prevRotation=a;var o=this._parseTweenFrame(e,n,r),s=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[s++]=a,this._frameFloatArray[s++]=i._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD,o},i.prototype._parseBoneScaleFrame=function(e,n,r){var a=this._parseTweenFrame(e,n,r),o=this._frameFloatArray.length;return this._frameFloatArray.length+=2,this._frameFloatArray[o++]=i._getNumber(e,t.DataParser.X,1),this._frameFloatArray[o++]=i._getNumber(e,t.DataParser.Y,1),a},i.prototype._parseSurfaceFrame=function(e,n,r){var a=this._frameFloatArray.length,o=this._parseTweenFrame(e,n,r),s=e[t.DataParser.VERTICES],c=i._getNumber(e,t.DataParser.OFFSET,0),l=this._surface.vertices.length/2,h=0,u=0;this._frameFloatArray.length+=2*l;for(var _=0;_<2*l;_+=2)h=_<c||_-c>=s.length?0:s[_-c],u=_+1<c||_+1-c>=s.length?0:s[_+1-c],this._frameFloatArray[a+_]=h,this._frameFloatArray[a+_+1]=u;if(0===n){var f=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[f+0]=0,this._frameIntArray[f+1]=this._frameFloatArray.length-a,this._frameIntArray[f+2]=this._frameFloatArray.length-a,this._frameIntArray[f+3]=0,this._frameIntArray[f+4]=a-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=f-this._animation.frameIntOffset}return o},i.prototype._parseSlotDisplayFrame=function(e,n,r){var a=this._parseFrame(e,n,r);return this._frameArray.length+=1,t.DataParser.VALUE in e?this._frameArray[a+1]=i._getNumber(e,t.DataParser.VALUE,0):this._frameArray[a+1]=i._getNumber(e,t.DataParser.DISPLAY_INDEX,0),this._parseActionDataInFrame(e,n,this._slot.parent,this._slot),a},i.prototype._parseSlotColorFrame=function(e,n,i){var r=this._parseTweenFrame(e,n,i),a=-1;if(t.DataParser.VALUE in e||t.DataParser.COLOR in e){var o=t.DataParser.VALUE in e?e[t.DataParser.VALUE]:e[t.DataParser.COLOR];for(var s in o){this._parseColorTransform(o,this._helpColorTransform),a=this._intArray.length,this._intArray.length+=8,this._intArray[a++]=Math.round(100*this._helpColorTransform.alphaMultiplier),this._intArray[a++]=Math.round(100*this._helpColorTransform.redMultiplier),this._intArray[a++]=Math.round(100*this._helpColorTransform.greenMultiplier),this._intArray[a++]=Math.round(100*this._helpColorTransform.blueMultiplier),this._intArray[a++]=Math.round(this._helpColorTransform.alphaOffset),this._intArray[a++]=Math.round(this._helpColorTransform.redOffset),this._intArray[a++]=Math.round(this._helpColorTransform.greenOffset),this._intArray[a++]=Math.round(this._helpColorTransform.blueOffset),a-=8;break}}a<0&&(this._defaultColorOffset<0&&(this._defaultColorOffset=a=this._intArray.length,this._intArray.length+=8,this._intArray[a++]=100,this._intArray[a++]=100,this._intArray[a++]=100,this._intArray[a++]=100,this._intArray[a++]=0,this._intArray[a++]=0,this._intArray[a++]=0,this._intArray[a++]=0),a=this._defaultColorOffset);var c=this._frameIntArray.length;return this._frameIntArray.length+=1,this._frameIntArray[c]=a,r},i.prototype._parseSlotFFDFrame=function(e,n,r){var a=this._frameFloatArray.length,o=this._parseTweenFrame(e,n,r),s=t.DataParser.VERTICES in e?e[t.DataParser.VERTICES]:null,c=i._getNumber(e,t.DataParser.OFFSET,0),l=this._intArray[this._mesh.vertices.offset+0],h=this._mesh.parent.name+"_"+this._slot.name+"_"+this._mesh.name,u=this._mesh.vertices.weight,_=0,f=0,d=0,p=0;if(null!==u){var m=this._weightSlotPose[h];this._helpMatrixA.copyFromArray(m,0),this._frameFloatArray.length+=2*u.count,d=u.offset+2+u.bones.length}else this._frameFloatArray.length+=2*l;for(var v=0;v<2*l;v+=2)if(null===s?(_=0,f=0):(_=v<c||v-c>=s.length?0:s[v-c],f=v+1<c||v+1-c>=s.length?0:s[v+1-c]),null!==u){var g=this._weightBonePoses[h],y=this._intArray[d++];this._helpMatrixA.transformPoint(_,f,this._helpPoint,!0),_=this._helpPoint.x,f=this._helpPoint.y;for(var x=0;x<y;++x){var S=this._intArray[d++];this._helpMatrixB.copyFromArray(g,7*S+1),this._helpMatrixB.invert(),this._helpMatrixB.transformPoint(_,f,this._helpPoint,!0),this._frameFloatArray[a+p++]=this._helpPoint.x,this._frameFloatArray[a+p++]=this._helpPoint.y}}else this._frameFloatArray[a+v]=_,this._frameFloatArray[a+v+1]=f;if(0===n){var A=this._frameIntArray.length;this._frameIntArray.length+=5,this._frameIntArray[A+0]=this._mesh.vertices.offset,this._frameIntArray[A+1]=this._frameFloatArray.length-a,this._frameIntArray[A+2]=this._frameFloatArray.length-a,this._frameIntArray[A+3]=0,this._frameIntArray[A+4]=a-this._animation.frameFloatOffset,this._timelineArray[this._timeline.offset+3]=A-this._animation.frameIntOffset}return o},i.prototype._parseIKConstraintFrame=function(e,n,r){var a=this._parseTweenFrame(e,n,r),o=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[o++]=i._getBoolean(e,t.DataParser.BEND_POSITIVE,!0)?1:0,this._frameIntArray[o++]=Math.round(100*i._getNumber(e,t.DataParser.WEIGHT,1)),a},i.prototype._parseAnimationFrame=function(e,n,r){var a=this._parseTweenFrame(e,n,r),o=this._frameIntArray.length;return this._frameIntArray.length+=2,this._frameIntArray[o++]=i._getNumber(e,t.DataParser.VALUE,0),this._frameIntArray[o++]=Math.round(100*i._getNumber(e,t.DataParser.WEIGHT,1)),a},i.prototype._parseActionData=function(e,n,r,a){var o=new Array;if("string"==typeof e)(h=t.BaseObject.borrowObject(t.ActionData)).type=n,h.name=e,h.bone=r,h.slot=a,o.push(h);else if(e instanceof Array)for(var s=0,c=e;s<c.length;s++){var l=c[s],h=t.BaseObject.borrowObject(t.ActionData);if(t.DataParser.GOTO_AND_PLAY in l?(h.type=0,h.name=i._getString(l,t.DataParser.GOTO_AND_PLAY,"")):(t.DataParser.TYPE in l&&"string"==typeof l[t.DataParser.TYPE]?h.type=t.DataParser._getActionType(l[t.DataParser.TYPE]):h.type=i._getNumber(l,t.DataParser.TYPE,n),h.name=i._getString(l,t.DataParser.NAME,"")),t.DataParser.BONE in l){var u=i._getString(l,t.DataParser.BONE,"");h.bone=this._armature.getBone(u)}else h.bone=r;if(t.DataParser.SLOT in l){var _=i._getString(l,t.DataParser.SLOT,"");h.slot=this._armature.getSlot(_)}else h.slot=a;var f=null;if(t.DataParser.INTS in l){null===f&&(f=t.BaseObject.borrowObject(t.UserData));for(var d=0,p=l[t.DataParser.INTS];d<p.length;d++){var m=p[d];f.addInt(m)}}if(t.DataParser.FLOATS in l){null===f&&(f=t.BaseObject.borrowObject(t.UserData));for(var v=0,g=l[t.DataParser.FLOATS];v<g.length;v++)m=g[v],f.addFloat(m)}if(t.DataParser.STRINGS in l){null===f&&(f=t.BaseObject.borrowObject(t.UserData));for(var y=0,x=l[t.DataParser.STRINGS];y<x.length;y++)m=x[y],f.addString(m)}h.data=f,o.push(h)}return o},i.prototype._parseTransform=function(e,n,r){n.x=i._getNumber(e,t.DataParser.X,0)*r,n.y=i._getNumber(e,t.DataParser.Y,0)*r,t.DataParser.ROTATE in e||t.DataParser.SKEW in e?(n.rotation=t.Transform.normalizeRadian(i._getNumber(e,t.DataParser.ROTATE,0)*t.Transform.DEG_RAD),n.skew=t.Transform.normalizeRadian(i._getNumber(e,t.DataParser.SKEW,0)*t.Transform.DEG_RAD)):(t.DataParser.SKEW_X in e||t.DataParser.SKEW_Y in e)&&(n.rotation=t.Transform.normalizeRadian(i._getNumber(e,t.DataParser.SKEW_Y,0)*t.Transform.DEG_RAD),n.skew=t.Transform.normalizeRadian(i._getNumber(e,t.DataParser.SKEW_X,0)*t.Transform.DEG_RAD)-n.rotation),n.scaleX=i._getNumber(e,t.DataParser.SCALE_X,1),n.scaleY=i._getNumber(e,t.DataParser.SCALE_Y,1)},i.prototype._parseColorTransform=function(e,n){n.alphaMultiplier=.01*i._getNumber(e,t.DataParser.ALPHA_MULTIPLIER,100),n.redMultiplier=.01*i._getNumber(e,t.DataParser.RED_MULTIPLIER,100),n.greenMultiplier=.01*i._getNumber(e,t.DataParser.GREEN_MULTIPLIER,100),n.blueMultiplier=.01*i._getNumber(e,t.DataParser.BLUE_MULTIPLIER,100),n.alphaOffset=i._getNumber(e,t.DataParser.ALPHA_OFFSET,0),n.redOffset=i._getNumber(e,t.DataParser.RED_OFFSET,0),n.greenOffset=i._getNumber(e,t.DataParser.GREEN_OFFSET,0),n.blueOffset=i._getNumber(e,t.DataParser.BLUE_OFFSET,0)},i.prototype._parseArray=function(){this._intArray.length=0,this._floatArray.length=0,this._frameIntArray.length=0,this._frameFloatArray.length=0,this._frameArray.length=0,this._timelineArray.length=0},i.prototype._modifyArray=function(){this._intArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._intArray.push(0),this._frameIntArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameIntArray.push(0),this._frameArray.length%Int16Array.BYTES_PER_ELEMENT!=0&&this._frameArray.push(0),this._timelineArray.length%Uint16Array.BYTES_PER_ELEMENT!=0&&this._timelineArray.push(0);var e=this._intArray.length*Int16Array.BYTES_PER_ELEMENT,n=this._floatArray.length*Float32Array.BYTES_PER_ELEMENT,i=this._frameIntArray.length*Int16Array.BYTES_PER_ELEMENT,r=this._frameFloatArray.length*Float32Array.BYTES_PER_ELEMENT,a=this._frameArray.length*Int16Array.BYTES_PER_ELEMENT,o=this._timelineArray.length*Uint16Array.BYTES_PER_ELEMENT,s=e+n+i+r+a+o;if(t.DragonBones.webAssembly){for(var c=t.webAssemblyModule.HEAP16.buffer,l=t.webAssemblyModule._malloc(s),h=new Int16Array(c,l,this._intArray.length),u=new Float32Array(c,l+e,this._floatArray.length),_=new Int16Array(c,l+e+n,this._frameIntArray.length),f=new Float32Array(c,l+e+n+i,this._frameFloatArray.length),d=new Int16Array(c,l+e+n+i+r,this._frameArray.length),p=new Uint16Array(c,l+e+n+i+r+a,this._timelineArray.length),m=0,v=this._intArray.length;m<v;++m)h[m]=this._intArray[m];for(m=0,v=this._floatArray.length;m<v;++m)u[m]=this._floatArray[m];for(m=0,v=this._frameIntArray.length;m<v;++m)_[m]=this._frameIntArray[m];for(m=0,v=this._frameFloatArray.length;m<v;++m)f[m]=this._frameFloatArray[m];for(m=0,v=this._frameArray.length;m<v;++m)d[m]=this._frameArray[m];for(m=0,v=this._timelineArray.length;m<v;++m)p[m]=this._timelineArray[m];t.webAssemblyModule.setDataBinary(this._data,l,e,n,i,r,a,o)}else{var g=new ArrayBuffer(s);for(h=new Int16Array(g,0,this._intArray.length),u=new Float32Array(g,e,this._floatArray.length),_=new Int16Array(g,e+n,this._frameIntArray.length),f=new Float32Array(g,e+n+i,this._frameFloatArray.length),d=new Int16Array(g,e+n+i+r,this._frameArray.length),p=new Uint16Array(g,e+n+i+r+a,this._timelineArray.length),m=0,v=this._intArray.length;m<v;++m)h[m]=this._intArray[m];for(m=0,v=this._floatArray.length;m<v;++m)u[m]=this._floatArray[m];for(m=0,v=this._frameIntArray.length;m<v;++m)_[m]=this._frameIntArray[m];for(m=0,v=this._frameFloatArray.length;m<v;++m)f[m]=this._frameFloatArray[m];for(m=0,v=this._frameArray.length;m<v;++m)d[m]=this._frameArray[m];for(m=0,v=this._timelineArray.length;m<v;++m)p[m]=this._timelineArray[m];this._data.binary=g,this._data.intArray=h,this._data.floatArray=u,this._data.frameIntArray=_,this._data.frameFloatArray=f,this._data.frameArray=d,this._data.timelineArray=p}this._defaultColorOffset=-1},i.prototype.parseDragonBonesData=function(e,n){void 0===n&&(n=1),console.assert(null!=e,"Data error.");var r=i._getString(e,t.DataParser.VERSION,""),a=i._getString(e,t.DataParser.COMPATIBLE_VERSION,"");if(t.DataParser.DATA_VERSIONS.indexOf(r)>=0||t.DataParser.DATA_VERSIONS.indexOf(a)>=0){var o=t.BaseObject.borrowObject(t.DragonBonesData);if(o.version=r,o.name=i._getString(e,t.DataParser.NAME,""),o.frameRate=i._getNumber(e,t.DataParser.FRAME_RATE,24),0===o.frameRate&&(o.frameRate=24),t.DataParser.ARMATURE in e){this._data=o,this._parseArray(e);for(var s=0,c=e[t.DataParser.ARMATURE];s<c.length;s++){var l=c[s];o.addArmature(this._parseArmature(l,n))}this._data.binary||this._modifyArray(),t.DataParser.STAGE in e?o.stage=o.getArmature(i._getString(e,t.DataParser.STAGE,"")):o.armatureNames.length>0&&(o.stage=o.getArmature(o.armatureNames[0])),this._data=null}return t.DataParser.TEXTURE_ATLAS in e&&(this._rawTextureAtlases=e[t.DataParser.TEXTURE_ATLAS]),o}return console.assert(!1,"Nonsupport data version: "+r+"\nPlease convert DragonBones data to support version.\nRead more: https://github.com/DragonBones/Tools/"),null},i.prototype.parseTextureAtlasData=function(e,n,r){if(void 0===r&&(r=1),console.assert(void 0!==e),null===e){if(null===this._rawTextureAtlases||0===this._rawTextureAtlases.length)return!1;var a=this._rawTextureAtlases[this._rawTextureAtlasIndex++];return this.parseTextureAtlasData(a,n,r),this._rawTextureAtlasIndex>=this._rawTextureAtlases.length&&(this._rawTextureAtlasIndex=0,this._rawTextureAtlases=null),!0}if(n.width=i._getNumber(e,t.DataParser.WIDTH,0),n.height=i._getNumber(e,t.DataParser.HEIGHT,0),n.scale=1===r?1/i._getNumber(e,t.DataParser.SCALE,1):r,n.name=i._getString(e,t.DataParser.NAME,""),n.imagePath=i._getString(e,t.DataParser.IMAGE_PATH,""),t.DataParser.SUB_TEXTURE in e)for(var o=e[t.DataParser.SUB_TEXTURE],s=0,c=o.length;s<c;++s){var l=o[s],h=n.createTexture();h.rotated=i._getBoolean(l,t.DataParser.ROTATED,!1),h.name=i._getString(l,t.DataParser.NAME,""),h.region.x=i._getNumber(l,t.DataParser.X,0),h.region.y=i._getNumber(l,t.DataParser.Y,0),h.region.width=i._getNumber(l,t.DataParser.WIDTH,0),h.region.height=i._getNumber(l,t.DataParser.HEIGHT,0);var u=i._getNumber(l,t.DataParser.FRAME_WIDTH,-1),_=i._getNumber(l,t.DataParser.FRAME_HEIGHT,-1);u>0&&_>0&&(h.frame=t.TextureData.createRectangle(),h.frame.x=i._getNumber(l,t.DataParser.FRAME_X,0),h.frame.y=i._getNumber(l,t.DataParser.FRAME_Y,0),h.frame.width=u,h.frame.height=_),n.addTexture(h)}return!0},i.getInstance=function(){return null===i._objectDataParserInstance&&(i._objectDataParserInstance=new i),i._objectDataParserInstance},i._objectDataParserInstance=null,i}(t.DataParser);t.ObjectDataParser=e;var n=function(){this.frameStart=0,this.actions=[]};t.ActionFrame=n}(t3||(t3={})),function(t){var e=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return $4(n,e),n.prototype._inRange=function(t,e,n){return e<=t&&t<=n},n.prototype._decodeUTF8=function(t){for(var e,n=0,i="",r=0,a=0,o=0,s=0;t.length>n;){var c=t[n++];if(-1===c)e=0!==a?65533:-1;else if(0===a)this._inRange(c,0,127)?e=c:(this._inRange(c,194,223)?(a=1,s=128,r=c-192):this._inRange(c,224,239)?(a=2,s=2048,r=c-224):this._inRange(c,240,244)&&(a=3,s=65536,r=c-240),r*=Math.pow(64,a),e=null);else if(this._inRange(c,128,191))if(o+=1,r+=(c-128)*Math.pow(64,a-o),o!==a)e=null;else{var l=r,h=s;r=0,a=0,o=0,s=0,e=this._inRange(l,h,1114111)&&!this._inRange(l,55296,57343)?l:c}else r=0,a=0,o=0,s=0,n--,e=c;null!==e&&-1!==e&&(e<=65535?e>0&&(i+=String.fromCharCode(e)):(e-=65536,i+=String.fromCharCode(55296+(e>>10&1023)),i+=String.fromCharCode(56320+(1023&e))))}return i},n.prototype._getUTF16Key=function(t){for(var e=0,n=t.length;e<n;++e)if(t.charCodeAt(e)>255)return encodeURI(t);return t},n.prototype._parseBinaryTimeline=function(e,n,i){void 0===i&&(i=null);var r=null!==i?i:t.BaseObject.borrowObject(t.TimelineData);r.type=e,r.offset=n,this._timeline=r;var a=this._timelineArrayBuffer[r.offset+2];if(1===a)r.frameIndicesOffset=-1;else{var o=0,s=this._animation.frameCount+1,c=this._data.frameIndices;t.DragonBones.webAssembly?(o=c.size(),c.resize(o+s,0)):(o=c.length,c.length+=s),r.frameIndicesOffset=o;for(var l=0,h=0,u=0,_=0;l<s;++l)u+_<=l&&h<a&&(u=this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[r.offset+5+h]],_=h===a-1?this._animation.frameCount-u:this._frameArrayBuffer[this._animation.frameOffset+this._timelineArrayBuffer[r.offset+5+h+1]]-u,h++),t.DragonBones.webAssembly?c.set(o+l,h-1):c[o+l]=h-1}return this._timeline=null,r},n.prototype._parseVertices=function(e,n){n.offset=e[t.DataParser.OFFSET];var i=this._intArrayBuffer[n.offset+3];if(i>=0){var r=t.BaseObject.borrowObject(t.WeightData),a=this._intArrayBuffer[n.offset+0],o=this._intArrayBuffer[i+0];r.offset=i;for(var s=0;s<o;++s){var c=this._intArrayBuffer[i+2+s];r.addBone(this._rawBones[c])}for(var l=i+2+o,h=0,u=(s=0,a);s<u;++s){var _=this._intArrayBuffer[l++];h+=_,l+=_}r.count=h,n.weight=r}},n.prototype._parseMesh=function(t,e){this._parseVertices(t,e.vertices)},n.prototype._parsePath=function(t,e){this._parseVertices(t,e.vertices)},n.prototype._parseAnimation=function(e){var n=t.BaseObject.borrowObject(t.AnimationData);n.frameCount=Math.max(t.ObjectDataParser._getNumber(e,t.DataParser.DURATION,1),1),n.playTimes=t.ObjectDataParser._getNumber(e,t.DataParser.PLAY_TIMES,1),n.duration=n.frameCount/this._armature.frameRate,n.fadeInTime=t.ObjectDataParser._getNumber(e,t.DataParser.FADE_IN_TIME,0),n.scale=t.ObjectDataParser._getNumber(e,t.DataParser.SCALE,1),n.name=t.ObjectDataParser._getString(e,t.DataParser.NAME,t.DataParser.DEFAULT_NAME),0===n.name.length&&(n.name=t.DataParser.DEFAULT_NAME);var i=e[t.DataParser.OFFSET];if(n.frameIntOffset=i[0],n.frameFloatOffset=i[1],n.frameOffset=i[2],this._animation=n,t.DataParser.ACTION in e&&(n.actionTimeline=this._parseBinaryTimeline(0,e[t.DataParser.ACTION])),t.DataParser.Z_ORDER in e&&(n.zOrderTimeline=this._parseBinaryTimeline(1,e[t.DataParser.Z_ORDER])),t.DataParser.BONE in e){var r=e[t.DataParser.BONE];for(var a in r){var o=r[a];t.DragonBones.webAssembly&&(a=this._getUTF16Key(a));var s=this._armature.getBone(a);if(null!==s)for(var c=0,l=o.length;c<l;c+=2){var h=o[c],u=o[c+1],_=this._parseBinaryTimeline(h,u);this._animation.addBoneTimeline(s,_)}}}if(t.DataParser.SURFACE in e)for(var a in r=e[t.DataParser.SURFACE]){o=r[a],t.DragonBones.webAssembly&&(a=this._getUTF16Key(a));var f=this._armature.getBone(a);if(null!==f)for(c=0,l=o.length;c<l;c+=2)h=o[c],u=o[c+1],_=this._parseBinaryTimeline(h,u),this._animation.addSurfaceTimeline(f,_)}if(t.DataParser.SLOT in e)for(var a in r=e[t.DataParser.SLOT]){o=r[a],t.DragonBones.webAssembly&&(a=this._getUTF16Key(a));var d=this._armature.getSlot(a);if(null!==d)for(c=0,l=o.length;c<l;c+=2)h=o[c],u=o[c+1],_=this._parseBinaryTimeline(h,u),this._animation.addSlotTimeline(d,_)}if(t.DataParser.CONSTRAINT in e)for(var a in r=e[t.DataParser.CONSTRAINT]){o=r[a],t.DragonBones.webAssembly&&(a=this._getUTF16Key(a));var p=this._armature.getConstraint(a);if(null!==p)for(c=0,l=o.length;c<l;c+=2)h=o[c],u=o[c+1],_=this._parseBinaryTimeline(h,u),this._animation.addConstraintTimeline(p,_)}if(t.DataParser.ANIMATION in e)for(var a in r=e[t.DataParser.ANIMATION])for(o=r[a],t.DragonBones.webAssembly&&(a=this._getUTF16Key(a)),c=0,l=o.length;c<l;c+=2)h=o[c],u=o[c+1],_=this._parseBinaryTimeline(h,u),this._animation.addAnimationTimeline(a,_);return this._animation=null,n},n.prototype._parseArray=function(e){var n=e[t.DataParser.OFFSET],i=n[1],r=n[3],a=n[5],o=n[7],s=n[9],c=n[11],l=new Int16Array(this._binary,this._binaryOffset+n[0],i/Int16Array.BYTES_PER_ELEMENT),h=new Float32Array(this._binary,this._binaryOffset+n[2],r/Float32Array.BYTES_PER_ELEMENT),u=new Int16Array(this._binary,this._binaryOffset+n[4],a/Int16Array.BYTES_PER_ELEMENT),_=new Float32Array(this._binary,this._binaryOffset+n[6],o/Float32Array.BYTES_PER_ELEMENT),f=new Int16Array(this._binary,this._binaryOffset+n[8],s/Int16Array.BYTES_PER_ELEMENT),d=new Uint16Array(this._binary,this._binaryOffset+n[10],c/Uint16Array.BYTES_PER_ELEMENT);if(t.DragonBones.webAssembly){for(var p=i+r+a+o+s+c,m=t.webAssemblyModule._malloc(p),v=new Uint8Array(this._binary,this._binaryOffset,p/Uint8Array.BYTES_PER_ELEMENT),g=new Uint8Array(t.webAssemblyModule.HEAP16.buffer,m,v.length),y=0,x=v.length;y<x;++y)g[y]=v[y];t.webAssemblyModule.setDataBinary(this._data,m,i,r,a,o,s,c),this._intArrayBuffer=l,this._floatArrayBuffer=h,this._frameIntArrayBuffer=u,this._frameFloatArrayBuffer=_,this._frameArrayBuffer=f,this._timelineArrayBuffer=d}else this._data.binary=this._binary,this._data.intArray=this._intArrayBuffer=l,this._data.floatArray=this._floatArrayBuffer=h,this._data.frameIntArray=this._frameIntArrayBuffer=u,this._data.frameFloatArray=this._frameFloatArrayBuffer=_,this._data.frameArray=this._frameArrayBuffer=f,this._data.timelineArray=this._timelineArrayBuffer=d},n.prototype.parseDragonBonesData=function(t,n){void 0===n&&(n=1),console.assert(null!=t&&t instanceof ArrayBuffer,"Data error.");var i=new Uint8Array(t,0,8);if(i[0]!=="D".charCodeAt(0)||i[1]!=="B".charCodeAt(0)||i[2]!=="D".charCodeAt(0)||i[3]!=="T".charCodeAt(0))return console.assert(!1,"Nonsupport data."),null;var r=new Uint32Array(t,8,1)[0],a=new Uint8Array(t,12,r),o=this._decodeUTF8(a),s=JSON.parse(o);return this._binaryOffset=12+r,this._binary=t,e.prototype.parseDragonBonesData.call(this,s,n)},n.getInstance=function(){return null===n._binaryDataParserInstance&&(n._binaryDataParserInstance=new n),n._binaryDataParserInstance},n._binaryDataParserInstance=null,n}(t.ObjectDataParser);t.BinaryDataParser=e}(t3||(t3={})),function(t){var e=function(){function e(n){void 0===n&&(n=null),this.autoSearch=!1,this._dragonBonesDataMap={},this._textureAtlasDataMap={},this._dragonBones=null,this._dataParser=null,null===e._objectParser&&(e._objectParser=new t.ObjectDataParser),null===e._binaryParser&&(e._binaryParser=new t.BinaryDataParser),this._dataParser=null!==n?n:e._objectParser}return e.prototype._isSupportMesh=function(){return!0},e.prototype._getTextureData=function(t,e){if(t in this._textureAtlasDataMap)for(var n=0,i=this._textureAtlasDataMap[t];n<i.length;n++)if(null!==(c=(s=i[n]).getTexture(e)))return c;if(this.autoSearch)for(var r in this._textureAtlasDataMap)for(var a=0,o=this._textureAtlasDataMap[r];a<o.length;a++){var s,c;if((s=o[a]).autoSearch&&null!==(c=s.getTexture(e)))return c}return null},e.prototype._fillBuildArmaturePackage=function(t,e,n,i,r){var a=null,o=null;if(e.length>0&&e in this._dragonBonesDataMap&&(o=(a=this._dragonBonesDataMap[e]).getArmature(n)),null===o&&(0===e.length||this.autoSearch))for(var s in this._dragonBonesDataMap)if(a=this._dragonBonesDataMap[s],(0===e.length||a.autoSearch)&&null!==(o=a.getArmature(n))){e=s;break}if(null!==o){if(t.dataName=e,t.textureAtlasName=r,t.data=a,t.armature=o,t.skin=null,i.length>0&&(t.skin=o.getSkin(i),null===t.skin&&this.autoSearch))for(var s in this._dragonBonesDataMap){var c=this._dragonBonesDataMap[s].getArmature(i);if(null!==c){t.skin=c.defaultSkin;break}}return null===t.skin&&(t.skin=o.defaultSkin),!0}return!1},e.prototype._buildBones=function(e,n){for(var i=0,r=e.armature.sortedBones;i<r.length;i++){var a=r[i];t.BaseObject.borrowObject(0===a.type?t.Bone:t.Surface).init(a,n)}},e.prototype._buildSlots=function(e,n){var i=e.skin,r=e.armature.defaultSkin;if(null!==i&&null!==r){var a={};for(var o in r.displays){var s=r.getDisplays(o);a[o]=s}if(i!==r)for(var o in i.displays)s=i.getDisplays(o),a[o]=s;for(var c=0,l=e.armature.sortedSlots;c<l.length;c++){var h=l[c],u=h.name in a?a[h.name]:null,_=this._buildSlot(e,h,n);if(_.rawDisplayDatas=u,null!==u){for(var f=new Array,d=0,p=t.DragonBones.webAssembly?u.size():u.length;d<p;++d){var m=t.DragonBones.webAssembly?u.get(d):u[d];null!==m?f.push(this._getSlotDisplay(e,m,null,_)):f.push(null)}_._setDisplayList(f)}_._setDisplayIndex(h.displayIndex,!0)}}},e.prototype._buildConstraints=function(e,n){var i=e.armature.constraints;for(var r in i){var a=i[r];switch(a.type){case 0:var o=t.BaseObject.borrowObject(t.IKConstraint);o.init(a,n),n._addConstraint(o);break;case 1:var s=t.BaseObject.borrowObject(t.PathConstraint);s.init(a,n),n._addConstraint(s);break;default:var c=t.BaseObject.borrowObject(t.IKConstraint);c.init(a,n),n._addConstraint(c)}}},e.prototype._buildChildArmature=function(t,e,n){return this.buildArmature(n.path,null!==t?t.dataName:"","",null!==t?t.textureAtlasName:"")},e.prototype._getSlotDisplay=function(e,n,i,r){var a=null!==e?e.dataName:n.parent.parent.parent.name,o=null;switch(n.type){case 0:var s=n;null!==e&&e.textureAtlasName.length>0&&(s.texture=this._getTextureData(e.textureAtlasName,n.path)),null===s.texture&&(s.texture=this._getTextureData(a,n.path)),o=null!==i&&2===i.type&&this._isSupportMesh()?r.meshDisplay:r.rawDisplay;break;case 2:var c=n;null!==e&&e.textureAtlasName.length>0&&(c.texture=this._getTextureData(e.textureAtlasName,c.path)),null===c.texture&&(c.texture=this._getTextureData(a,c.path)),o=this._isSupportMesh()?r.meshDisplay:r.rawDisplay;break;case 1:var l=n,h=this._buildChildArmature(e,r,n);if(null!==h){if(h.inheritAnimation=l.inheritAnimation,!h.inheritAnimation){var u=l.actions.length>0?l.actions:h.armatureData.defaultActions;if(u.length>0)for(var _=0,f=u;_<f.length;_++){var d=f[_],p=t.BaseObject.borrowObject(t.EventObject);t.EventObject.actionDataToInstance(d,p,r.armature),p.slot=r,r.armature._bufferAction(p,!1)}else h.animation.play()}l.armature=h.armatureData}o=h}return o},e.prototype.parseDragonBonesData=function(t,n,i){void 0===n&&(n=null),void 0===i&&(i=1);for(var r=t instanceof ArrayBuffer?e._binaryParser:this._dataParser,a=r.parseDragonBonesData(t,i);;){var o=this._buildTextureAtlasData(null,null);if(!r.parseTextureAtlasData(null,o,i)){o.returnToPool();break}this.addTextureAtlasData(o,n)}return null!==a&&this.addDragonBonesData(a,n),a},e.prototype.parseTextureAtlasData=function(t,e,n,i){void 0===n&&(n=null),void 0===i&&(i=1);var r=this._buildTextureAtlasData(null,null);return this._dataParser.parseTextureAtlasData(t,r,i),this._buildTextureAtlasData(r,e||null),this.addTextureAtlasData(r,n),r},e.prototype.updateTextureAtlasData=function(t,e){var n=this.getTextureAtlasData(t);if(null!==n)for(var i=0,r=n.length;i<r;++i)i<e.length&&this._buildTextureAtlasData(n[i],e[i])},e.prototype.getDragonBonesData=function(t){return t in this._dragonBonesDataMap?this._dragonBonesDataMap[t]:null},e.prototype.addDragonBonesData=function(t,e){if(void 0===e&&(e=null),(e=null!==e?e:t.name)in this._dragonBonesDataMap){if(this._dragonBonesDataMap[e]===t)return;console.warn("Can not add same name data: "+e)}else this._dragonBonesDataMap[e]=t},e.prototype.removeDragonBonesData=function(t,e){void 0===e&&(e=!0),t in this._dragonBonesDataMap&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[t]),delete this._dragonBonesDataMap[t])},e.prototype.getTextureAtlasData=function(t){return t in this._textureAtlasDataMap?this._textureAtlasDataMap[t]:null},e.prototype.addTextureAtlasData=function(t,e){void 0===e&&(e=null);var n=(e=null!==e?e:t.name)in this._textureAtlasDataMap?this._textureAtlasDataMap[e]:this._textureAtlasDataMap[e]=[];n.indexOf(t)<0&&n.push(t)},e.prototype.removeTextureAtlasData=function(t,e){if(void 0===e&&(e=!0),t in this._textureAtlasDataMap){var n=this._textureAtlasDataMap[t];if(e)for(var i=0,r=n;i<r.length;i++){var a=r[i];this._dragonBones.bufferObject(a)}delete this._textureAtlasDataMap[t]}},e.prototype.getArmatureData=function(t,e){void 0===e&&(e="");var i=new n;return this._fillBuildArmaturePackage(i,e,t,"","")?i.armature:null},e.prototype.clear=function(t){for(var e in void 0===t&&(t=!0),this._dragonBonesDataMap)t&&this._dragonBones.bufferObject(this._dragonBonesDataMap[e]),delete this._dragonBonesDataMap[e];for(var e in this._textureAtlasDataMap){if(t)for(var n=0,i=this._textureAtlasDataMap[e];n<i.length;n++){var r=i[n];this._dragonBones.bufferObject(r)}delete this._textureAtlasDataMap[e]}},e.prototype.buildArmature=function(t,e,i,r){void 0===e&&(e=""),void 0===i&&(i=""),void 0===r&&(r="");var a=new n;if(!this._fillBuildArmaturePackage(a,e||"",t,i||"",r||""))return console.warn("No armature data: "+t+", "+(null!==e?e:"")),null;var o=this._buildArmature(a);return this._buildBones(a,o),this._buildSlots(a,o),this._buildConstraints(a,o),o.invalidUpdate(null,!0),o.advanceTime(0),o},e.prototype.replaceDisplay=function(e,n,i){void 0===i&&(i=-1),i<0&&(i=e.displayIndex),i<0&&(i=0),e.replaceDisplayData(n,i);var r=e.displayList;if(r.length<=i){r.length=i+1;for(var a=0,o=r.length;a<o;++a)r[a]||(r[a]=null)}if(null!==n){var s=e.rawDisplayDatas,c=null;s&&(t.DragonBones.webAssembly?i<s.size()&&(c=s.get(i)):i<s.length&&(c=s[i])),r[i]=this._getSlotDisplay(null,n,c,e)}else r[i]=null;e.displayList=r},e.prototype.replaceSlotDisplay=function(t,e,n,i,r,a){void 0===a&&(a=-1);var o=this.getArmatureData(e,t||"");if(!o||!o.defaultSkin)return!1;var s=o.defaultSkin.getDisplay(n,i);return!!s&&(this.replaceDisplay(r,s,a),!0)},e.prototype.replaceSlotDisplayList=function(e,n,i,r){var a=this.getArmatureData(n,e||"");if(!a||!a.defaultSkin)return!1;var o=a.defaultSkin.getDisplays(i);if(!o)return!1;for(var s=0,c=0,l=t.DragonBones.webAssembly?o.size():o.length;c<l;++c){var h=t.DragonBones.webAssembly?o.get(c):o[c];this.replaceDisplay(r,h,s++)}return!0},e.prototype.replaceSkin=function(e,n,i,r){void 0===i&&(i=!1),void 0===r&&(r=null);for(var a=!1,o=n.parent.defaultSkin,s=0,c=e.getSlots();s<c.length;s++){var l=c[s];if(!(null!==r&&r.indexOf(l.name)>=0)){var h=n.getDisplays(l.name);if(h||(null!==o&&n!==o&&(h=o.getDisplays(l.name)),h)){var u=t.DragonBones.webAssembly?h.size():h.length,_=l.displayList;_.length=u;for(var f=0,d=u;f<d;++f){var p=t.DragonBones.webAssembly?h.get(f):h[f];_[f]=null!==p?this._getSlotDisplay(null,p,null,l):null}a=!0,l.rawDisplayDatas=h,l.displayList=_}else i&&(l.rawDisplayDatas=null,l.displayList=[])}}return a},e.prototype.replaceAnimation=function(e,n,i){void 0===i&&(i=!0);var r=n.defaultSkin;if(null===r)return!1;if(i)e.animation.animations=n.animations;else{var a=e.animation.animations,o={};for(var s in a)o[s]=a[s];for(var s in n.animations)o[s]=n.animations[s];e.animation.animations=o}for(var c=0,l=e.getSlots();c<l.length;c++)for(var h=l[c],u=0,_=0,f=h.displayList;_<f.length;_++){var d=f[_];if(d instanceof t.Armature){var p=r.getDisplays(h.name);if(null!==p&&u<(t.DragonBones.webAssembly?p.size():p.length)){var m=t.DragonBones.webAssembly?p.get(u):p[u];if(null!==m&&1===m.type){var v=this.getArmatureData(m.path,m.parent.parent.parent.name);v&&this.replaceAnimation(d,v,i)}}}u++}return!0},e.prototype.getAllDragonBonesData=function(){return this._dragonBonesDataMap},e.prototype.getAllTextureAtlasData=function(){return this._textureAtlasDataMap},Object.defineProperty(e.prototype,"clock",{get:function(){return this._dragonBones.clock},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"dragonBones",{get:function(){return this._dragonBones},enumerable:!0,configurable:!0}),e.prototype.changeSkin=function(t,e,n){return void 0===n&&(n=null),this.replaceSkin(t,e,!1,n)},e.prototype.copyAnimationsToArmature=function(t,e,n,i,r){void 0===i&&(i=""),void 0===r&&(r=!0);var a=this.getArmatureData(e,i);return!!a&&this.replaceAnimation(t,a,r)},e._objectParser=null,e._binaryParser=null,e}();t.BaseFactory=e;var n=function(){this.dataName="",this.textureAtlasName="",this.skin=null};t.BuildArmaturePackage=n}(t3||(t3={})),function(t){t.BinaryOffset={WeigthBoneCount:0,WeigthFloatOffset:1,WeigthBoneIndices:2,MeshVertexCount:0,MeshTriangleCount:1,MeshFloatOffset:2,MeshWeightOffset:3,MeshVertexIndices:4,TimelineScale:0,TimelineOffset:1,TimelineKeyFrameCount:2,TimelineFrameValueCount:3,TimelineFrameValueOffset:4,TimelineFrameOffset:5,FramePosition:0,FrameTweenType:1,FrameTweenEasingOrCurveSampleCount:2,FrameCurveSamples:3,DeformMeshOffset:0,DeformCount:1,DeformValueCount:2,DeformValueOffset:3,DeformFloatOffset:4},t.ArmatureType={Armature:0,MovieClip:1,Stage:2},t.BoneType={Bone:0,Surface:1},t.DisplayType={Image:0,Armature:1,Mesh:2,BoundingBox:3},t.BoundingBoxType={Rectangle:0,Ellipse:1,Polygon:2},t.ActionType={Play:0,Stop:1,GotoAndPlay:2,GotoAndStop:3,FadeIn:4,FadeOut:5,Frame:10,Sound:11},t.BlendMode={Normal:0,Add:1,Alpha:2,Darken:3,Difference:4,Erase:5,HardLight:6,Invert:7,Layer:8,Lighten:9,Multiply:10,Overlay:11,Screen:12,Subtract:13},t.TweenType={None:0,Line:1,Curve:2,QuadIn:3,QuadOut:4,QuadInOut:5},t.TimelineType={Action:0,ZOrder:1,BoneAll:10,BoneTranslate:11,BoneRotate:12,BoneScale:13,Surface:50,SlotDisplay:20,SlotColor:21,SlotFFD:22,IKConstraint:30,AnimationTime:40,AnimationWeight:41}}(t3||(t3={}));var e3,n3,i3,r3,a3,o3,s3,c3,l3,h3,u3,_3,f3,d3=t3.DragonBones,p3=t3.BaseObject,m3=t3.Matrix,v3=t3.Transform,g3=t3.ColorTransform,y3=t3.Point,x3=t3.Rectangle,S3=t3.UserData,A3=t3.ActionData,b3=t3.DragonBonesData,C3=t3.ArmatureData,T3=t3.BoneData,E3=t3.SurfaceData,w3=t3.SlotData,I3=t3.ConstraintData,P3=t3.IKConstraintData,D3=t3.PathConstraintData,R3=t3.CanvasData,M3=t3.SkinData,O3=t3.VerticesData,N3=t3.DisplayData,B3=t3.ImageDisplayData,L3=t3.ArmatureDisplayData,F3=t3.MeshDisplayData,V3=t3.BoundingBoxDisplayData,z3=t3.PathDisplayData,k3=t3.WeightData,U3=t3.BoundingBoxData,G3=t3.RectangleBoundingBoxData,H3=t3.EllipseBoundingBoxData,j3=t3.PolygonBoundingBoxData,W3=t3.AnimationData,q3=t3.TimelineData,X3=t3.AnimationConfig,Y3=t3.TextureAtlasData,K3=t3.TextureData,J3=t3.DeformVertices,Q3=t3.Armature,Z3=t3.TransformObject,$3=t3.Bone,t5=t3.Surface,e5=t3.Slot,n5=t3.Constraint,i5=t3.IKConstraint,r5=t3.PathConstraint,a5=t3.WorldClock,o5=t3.Animation,s5=t3.AnimationState,c5=t3.BonePose,l5=t3.BlendState,h5=t3.TimelineState,u5=t3.TweenTimelineState,_5=t3.BoneTimelineState,f5=t3.SlotTimelineState,d5=t3.ConstraintTimelineState,p5=t3.ActionTimelineState,m5=t3.ZOrderTimelineState,v5=t3.BoneAllTimelineState,g5=t3.BoneTranslateTimelineState,y5=t3.BoneRotateTimelineState,x5=t3.BoneScaleTimelineState,S5=t3.SurfaceTimelineState,A5=t3.SlotDislayTimelineState,b5=t3.SlotColorTimelineState,C5=t3.DeformTimelineState,T5=t3.IKConstraintTimelineState,E5=t3.AnimationTimelineState,w5=t3.EventObject,I5=t3.DataParser,P5=t3.ObjectDataParser,D5=t3.ActionFrame,R5=t3.BinaryDataParser,M5=t3.BaseFactory,O5=t3.BuildArmaturePackage,N5=t3.BinaryOffset,B5=t3.ArmatureType,L5=t3.BoneType,F5=t3.DisplayType,V5=t3.BoundingBoxType,z5=t3.ActionType,k5=t3.BlendMode,U5=t3.TweenType,G5=t3.TimelineType,H5=Ec("dragonBones.CCTextureAtlasData")(e3=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._renderTexture=null,e}$(e,t),e.toString=function(){return"[class dragonBones.CCTextureAtlasData]"};var n=e.prototype;return n.createTexture=function(){return p3.borrowObject(j5)},n._onClear=function(){t.prototype._onClear.call(this),this.renderTexture=null},Q(e,[{key:"renderTexture",get:function(){return this._renderTexture},set:function(t){if(this._renderTexture=t,t)for(var e in this.textures){var n=this.textures[e];if(!n.spriteFrame){var i=null;n.rotated?i=new oi(n.region.x,n.region.y,n.region.height,n.region.width):(i=new oi(n.region.x,n.region.y,n.region.width,n.region.height),n.spriteFrame=new oF,n.spriteFrame.texture=t,n.spriteFrame.rect=i)}}else for(var r in this.textures)this.textures[r].spriteFrame=null}}]),e}(Y3))||e3,j5=Ec("dragonBones.CCTextureData")(n3=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).spriteFrame=null,e}return $(e,t),e.toString=function(){return"[class dragonBones.CCTextureData]"},e.prototype._onClear=function(){t.prototype._onClear.call(this),this.spriteFrame=null},e}(K3))||n3,W5=Ec("dragonBones.CCSlot")(i3=function(t){function e(){var e;return(e=t.call(this)||this)._localVertices=void 0,e._indices=void 0,e._matrix=void 0,e._worldMatrix=void 0,e._worldMatrixDirty=void 0,e._color=void 0,e._localVertices=[],e._indices=[],e._matrix=new Xn,e._worldMatrix=new Xn,e._worldMatrixDirty=!0,e._visible=!1,e._color=new Dn,e}$(e,t),e.toString=function(){return"[class dragonBones.CCSlot]"};var n=e.prototype;return n.getTexture=function(){return this._textureData?this._textureData.spriteFrame.texture:null},n.calculWorldMatrix=function(){var t=this._armature._parent;t?this._mulMat(this._worldMatrix,t._worldMatrix,this._matrix):Xn.copy(this._worldMatrix,this._matrix),this._worldMatrixDirty=!1},n._onClear=function(){t.prototype._onClear.call(this),this._localVertices.length=0,this._indices.length=0,Xn.identity(this._matrix),Xn.identity(this._worldMatrix),this._worldMatrixDirty=!0,this._color=new Dn,this._visible=!1},n._onUpdateDisplay=function(){},n._initDisplay=function(){},n._addDisplay=function(){this._visible=!0},n._replaceDisplay=function(){},n._removeDisplay=function(){this._visible=!1},n._disposeDisplay=function(){},n._updateVisible=function(){this._visible=this.parent.visible},n._updateGlueMesh=function(){},n._updateZOrder=function(){},n._updateBlendMode=function(){if(this._childArmature)for(var t=this._childArmature.getSlots(),e=0,n=t.length;e<n;e++){var i=t[e];i._blendMode=this._blendMode,i._updateBlendMode()}},n._updateColor=function(){var t=this._color;t.r=255*this._colorTransform.redMultiplier,t.g=255*this._colorTransform.greenMultiplier,t.b=255*this._colorTransform.blueMultiplier,t.a=255*this._colorTransform.alphaMultiplier},n._updateFrame=function(){this._indices.length=0;var t=this._indices,e=this._localVertices,n=0,i=0,r=this._textureData;if(this._display&&!(this._displayIndex<0)&&r&&r.spriteFrame){var a=r.spriteFrame.texture,o=a.width,s=a.height,c=r.region;if(0!==o&&0!==s){var l=null!==this._deformVertices&&this._display===this._meshDisplay?this._deformVertices.verticesData:null;if(l){var h=l.data,u=h.intArray,_=h.floatArray,f=u[l.offset+N5.MeshVertexCount],d=u[l.offset+N5.MeshTriangleCount],p=u[l.offset+N5.MeshFloatOffset];p<0&&(p+=65536);for(var m=p+2*f,v=this._armature._armatureData.scale,g=0,y=2*f;g<y;g+=2)e[i++]=_[p+g]*v,e[i++]=-_[p+g+1]*v,l.rotated?(e[i++]=(c.x+(1-_[m+g])*c.width)/o,e[i++]=(c.y+_[m+g+1]*c.height)/s):(e[i++]=(c.x+_[m+g]*c.width)/o,e[i++]=(c.y+_[m+g+1]*c.height)/s);for(var x=0;x<3*d;++x)t[n++]=u[l.offset+N5.MeshVertexIndices+x];e.length=i,t.length=n,l.weight&&this._identityTransform()}else{var S=c.x/o,A=(c.y+c.height)/s,b=(c.x+c.width)/o,C=c.y/s;e[i++]=0,e[i++]=0,e[i++]=S,e[i++]=A,e[i++]=c.width,e[i++]=0,e[i++]=b,e[i++]=A,e[i++]=0,e[i++]=c.height,e[i++]=S,e[i++]=C,e[i++]=c.width,e[i++]=c.height,e[i++]=b,e[i++]=C,t[0]=0,t[1]=1,t[2]=2,t[3]=1,t[4]=3,t[5]=2,e.length=i,t.length=6}this._visibleDirty=!0,this._blendModeDirty=!0,this._colorDirty=!0}else console.error("SpriteFrame "+r.spriteFrame.name+" incorrect size "+o+" x "+s)}},n._updateMesh=function(){var t=this._armature._armatureData.scale,e=this._deformVertices.vertices,n=this._deformVertices.bones,i=this._deformVertices.verticesData,r=i.weight,a=e.length>0&&i.inheritDeform,o=this._localVertices;if(r){var s=i.data,c=s.intArray,l=s.floatArray,h=c[i.offset+N5.MeshVertexCount],u=c[r.offset+N5.WeigthFloatOffset];u<0&&(u+=65536);for(var _=0,f=r.offset+N5.WeigthBoneIndices+n.length,d=u,p=0,m=0;_<h;_++,m+=4){for(var v=c[f++],g=0,y=0,x=0;x<v;++x){var S=n[c[f++]];if(null!==S){var A=S.globalTransformMatrix,b=l[d++],C=l[d++]*t,T=l[d++]*t;a&&(C+=e[p++],T+=e[p++]),g+=(A.a*C+A.c*T+A.tx)*b,y+=(A.b*C+A.d*T+A.ty)*b}}o[m]=g,o[m+1]=-y}}else if(a){var E=this._parent._boneData.type!==L5.Bone,w=i.data,I=w.intArray,P=w.floatArray,D=I[i.offset+N5.MeshVertexCount],R=I[i.offset+N5.MeshFloatOffset];R<0&&(R+=65536);for(var M=0,O=D,N=0;M<O;M++,N+=4){var B=P[R+2*M]*t+e[2*M],L=P[R+2*M+1]*t+e[2*M+1];if(E){var F=this._parent._getGlobalTransformMatrix(B,L);o[N]=F.a*B+F.c*L+F.tx,o[N+1]=-F.b*B+F.d*L+F.ty}else o[N]=B,o[N+1]=-L}}r&&this._identityTransform()},n._identityTransform=function(){var t=this._matrix;t.m00=1,t.m01=0,t.m04=-0,t.m05=-1,t.m12=0,t.m13=0,this._worldMatrixDirty=!0},n._updateTransform=function(){var t=this._matrix;t.m00=this.globalTransformMatrix.a,t.m01=this.globalTransformMatrix.b,t.m04=-this.globalTransformMatrix.c,t.m05=-this.globalTransformMatrix.d,this._childArmature?(t.m12=this.globalTransformMatrix.tx,t.m13=this.globalTransformMatrix.ty):(t.m12=this.globalTransformMatrix.tx-(this.globalTransformMatrix.a*this._pivotX-this.globalTransformMatrix.c*this._pivotY),t.m13=this.globalTransformMatrix.ty-(this.globalTransformMatrix.b*this._pivotX-this.globalTransformMatrix.d*this._pivotY)),this._worldMatrixDirty=!0},n.updateWorldMatrix=function(){if(this._armature){var t=this._armature._parent;if(t&&t.updateWorldMatrix(),this._worldMatrixDirty){this.calculWorldMatrix();var e=this.childArmature;if(!e)return;for(var n=e.getSlots(),i=0,r=n.length;i<r;i++){var a=n[i];a&&(a._worldMatrixDirty=!0)}}}},n._mulMat=function(t,e,n){var i=e.m00,r=e.m01,a=e.m04,o=e.m05,s=e.m12,c=e.m13,l=n.m00,h=n.m01,u=n.m04,_=n.m05,f=n.m12,d=n.m13;0!==r||0!==a?(t.m00=l*i+h*a,t.m01=l*r+h*o,t.m04=u*i+_*a,t.m05=u*r+_*o,t.m12=i*f+a*d+s,t.m13=r*f+o*d+c):(t.m00=l*i,t.m01=h*o,t.m04=u*i,t.m05=_*o,t.m12=i*f+s,t.m13=o*d+c)},e}(e5))||i3,q5=Ec("dragonBones.CCArmatureDisplay")(r3=function(t){function e(){var e;return(e=t.call(this)||this).shouldAdvanced=!1,e._ccNode=null,e._ccComponent=null,e._eventTarget=void 0,e._armature=null,e._eventTarget=new uh,e}$(e,t);var n=e.prototype;return n.hasEvent=function(){return console.warn("Method not implemented."),!1},n.addEvent=function(){console.warn("Method not implemented.")},n.removeEvent=function(){console.warn("Method not implemented.")},n.setEventTarget=function(t){this._eventTarget=t},n.getRootDisplay=function(){var t,e=this._armature._parent;if(!e)return this;for(;e;)t=e,e=e._armature._parent;return t._armature.display},n.convertToRootSpace=function(t){var e=this._armature._parent;if(!e)return t;e.updateWorldMatrix();var n=e._worldMatrix,i=new Mn(0,0);return i.x=t.x*n.m00+t.y*n.m04+n.m12,i.y=t.x*n.m01+t.y*n.m05+n.m13,i},n.convertToWorldSpace=function(t){var e,n=this.convertToRootSpace(t),i=this.getRootNode();return null==i||null===(e=i._uiProps.uiTransformComp)||void 0===e?void 0:e.convertToWorldSpaceAR(n)},n.getRootNode=function(){var t=this.getRootDisplay();return t&&t._ccNode},n.dbInit=function(t){this._armature=t},n.dbClear=function(){this._armature=null},n.dbUpdate=function(){this._ccComponent&&this._ccComponent.markForUpdateRenderData()},n.advanceTimeBySelf=function(t){this.shouldAdvanced=!!t},n.hasDBEventListener=function(t){return this._eventTarget.hasEventListener(t)},n.addDBEventListener=function(t,e,n){this._eventTarget.on(t,e,n)},n.removeDBEventListener=function(t,e,n){this._eventTarget.off(t,e,n)},n.dispatchDBEvent=function(t,e){this._eventTarget.emit(t,e)},Q(e,[{key:"node",get:function(){return this}}]),e}(N3))||r3,X5=Ec("CCFactory")((s3=o3=function(t){function e(){var e;(e=t.call(this)||this).id=void 0,e.uuid=void 0,e._slots=void 0;var n=new q5;return e._dragonBones=new d3(n),TO.getScheduler()&&(bO.on(AO.EVENT_RESTART,e.onRestart,at(e)),e.initUpdate()),e.id=e.uuid="CCFactory",e}$(e,t),e.getInstance=function(){return e._factory||(e._factory=new e),e._factory};var n=e.prototype;return n.onRestart=function(){e._factory=null},n.initUpdate=function(){gO.enableForTarget(this),TO.getScheduler().scheduleUpdate(this,uO.Priority.HIGH,!1)},n.update=function(t){this._dragonBones.advanceTime(t)},n.getDragonBonesDataByRawData=function(t){return(t instanceof ArrayBuffer?M5._binaryParser:this._dataParser).parseDragonBonesData(t,1)},n.buildArmatureDisplay=function(t,e,n,i){var r=this.buildArmature(t,e,n,i);return r?r._display:null},n.createArmatureNode=function(t,e,n){var i=(n=n||new TE).getComponent("dragonBones.ArmatureDisplay");return i||(i=n.addComponent("dragonBones.ArmatureDisplay")),n.name=e,i._armatureName=e,i._dragonAsset=t.dragonAsset,i._dragonAtlasAsset=t.dragonAtlasAsset,i._init(),i},n._buildTextureAtlasData=function(t,e){return t?t.renderTexture=e:t=p3.borrowObject(H5),t},n._sortSlots=function(){for(var t=this._slots,e=[],n=0,i=t.length;n<i;n++){for(var r=t[n],a=r._zOrder,o=!1,s=e.length-1;s>=0;s--)if(a>=e[s]._zOrder){e.splice(s+1,0,r),o=!0;break}o||e.unshift(r)}this._slots=e},n._buildArmature=function(t){var e=p3.borrowObject(Q3);e._skinData=t.skin,e._animation=p3.borrowObject(o5),e._animation._armature=e,e._animation.animations=t.armature.animations,e._isChildArmature=!1;var n=new q5;return e.init(t.armature,n,n,this._dragonBones),e},n._buildSlot=function(t,e,n){var i=p3.borrowObject(W5),r=i;return i.init(e,n,r,r),i},n.getDragonBonesDataByUUID=function(t){for(var e in this._dragonBonesDataMap)if(-1!==e.indexOf(t))return this._dragonBonesDataMap[e];return null},n.removeDragonBonesDataByUUID=function(t,e){for(var n in void 0===e&&(e=!0),this._dragonBonesDataMap)-1!==n.indexOf(t)&&(e&&this._dragonBones.bufferObject(this._dragonBonesDataMap[n]),delete this._dragonBonesDataMap[n])},e}(M5),o3._factory=null,a3=s3))||a3,Y5=1/60,K5=[],J5=[],Q5=0,Z5=0,$5=0,t6=null,e6=null,n6=0,i6=0,r6=0,a6=0,o6=0,s6=function(){function t(){this.maxVertexCount=0,this.maxIndexCount=0,this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this.frames=[],this.totalTime=0,this.isCompleted=!1,this._frameIdx=-1,this._armatureInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null}var e=t.prototype;return e.init=function(t,e){this._inited=!0,this._armatureInfo=t,this._animationName=e},e.clear=function(){this._inited=!1;for(var t=0,e=this.frames.length;t<e;t++)this.frames[t].segments.length=0;this.invalidAllFrame()},e.begin=function(){if(this._invalid){var t=this._armatureInfo,e=t.curAnimationCache;e&&e!==this&&(this._privateMode?e.invalidAllFrame():e.updateToFrame()),t.armature.animation.play(this._animationName,1),t.curAnimationCache=this,this._invalid=!1,this._frameIdx=-1,this.totalTime=0,this.isCompleted=!1}},e.end=function(){this._needToUpdate()||(this._armatureInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0)},e._needToUpdate=function(t){return!this._armatureInfo.armature.animation.isCompleted&&this.totalTime<30&&(void 0===t||this._frameIdx<t)},e.updateToFrame=function(t){if(this._inited&&(this.begin(),this._needToUpdate(t))){var e=this._armatureInfo.armature;do{e.advanceTime(Y5),this._frameIdx++,this.updateFrame(e,this._frameIdx),this.totalTime+=Y5}while(this._needToUpdate(t));this.end()}},e.isInited=function(){return this._inited},e.isInvalid=function(){return this._invalid},e.invalidAllFrame=function(){this.isCompleted=!1,this._invalid=!0},e.updateAllFrame=function(){this.invalidAllFrame(),this.updateToFrame()},e.enableCacheAttachedInfo=function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},e.updateFrame=function(t,e){$5=0,Q5=0,Z5=0,t6=null,e6=null,n6=0,i6=0,r6=0,a6=0,o6=0,this.frames[e]=this.frames[e]||{segments:[],colors:[],boneInfos:[],vertices:null,uintVert:null,indices:null};var n=this.frames[e],i=this._tempSegments=n.segments,r=this._tempColors=n.colors,a=this._tempBoneInfos=n.boneInfos;this._traverseArmature(t,1),a6>0&&(r[a6-1].vfOffset=$5),r.length=a6,a.length=Q5;var o=r6-1;if(o>=0)if(i6>0){var s=i[o];s.indexCount=i6,s.vfCount=9*n6,s.vertexCount=n6,i.length=r6}else i.length=r6-1;if(0!==i.length){var c,l=n.vertices,h=$5/5,u=9*h;(!l||l.length<$5)&&(l=n.vertices=new Float32Array(u));for(var _=0,f=0;_<u;)l[_]=K5[f++],l[_+1]=K5[f++],l[_+3]=K5[f++],l[_+4]=K5[f++],c=K5[f++],l[_+5]=(255&c)/255,l[_+6]=(c>>8&255)/255,l[_+7]=(c>>16&255)/255,l[_+8]=(c>>24&255)/255,_+=9;var d=n.indices;(!d||d.length<Z5)&&(d=n.indices=new Uint16Array(Z5));for(var p=0;p<Z5;p++)d[p]=J5[p];n.vertices=l,n.indices=d,this.maxVertexCount=h>this.maxVertexCount?h:this.maxVertexCount,this.maxIndexCount=d.length>this.maxIndexCount?d.length:this.maxIndexCount}},e._traverseArmature=function(t,e){var n,i,r,a,o,s,c,l,h,u=this._tempColors,_=this._tempSegments,f=this._tempBoneInfos,d=t._slots,p=t._bones;if(this._enableCacheAttachedInfo)for(var m=0,v=p.length;m<v;m++,Q5++){var g=p[m],y=f[Q5];y||(y=f[Q5]={globalTransformMatrix:new m3});var x=g.globalTransformMatrix;y.globalTransformMatrix.copyFrom(x)}for(var S=0,A=d.length;S<A;S++)if((r=d[S])._visible&&r._displayData)if(r.updateWorldMatrix(),o=r._color,r.childArmature)this._traverseArmature(r.childArmature,e*o.a/255);else if(c=r.getTexture()){t6===c.nativeUrl&&e6===r._blendMode||(t6=c.nativeUrl,e6=r._blendMode,(l=r6-1)>=0&&(i6>0?((h=_[l]).indexCount=i6,h.vertexCount=n6,h.vfCount=9*n6):r6--),_[r6]={tex:c,blendMode:r._blendMode,indexCount:0,vertexCount:0,vfCount:0},r6++,i6=0,n6=0),s=(o.a*e<<24>>>0)+(o.b<<16)+(o.g<<8)+o.r,o6!==s&&(o6=s,a6>0&&(u[a6-1].vfOffset=$5),u[a6++]={r:o.r,g:o.g,b:o.b,a:o.a*e,vfOffset:0}),n=r._localVertices,i=r._indices,a=r._worldMatrix;for(var b=0,C=n.length;b<C;)c3=n[b++],l3=n[b++],K5[$5++]=c3*a.m00+l3*a.m04+a.m12,K5[$5++]=c3*a.m01+l3*a.m05+a.m13,K5[$5++]=n[b++],K5[$5++]=n[b++],K5[$5++]=s;for(var T=0,E=i.length;T<E;T++)J5[Z5++]=n6+i[T];i6+=i.length,n6+=n.length/4}},t}(),c6=function(){function t(){this._privateMode=!1,this._animationPool={},this._armatureCache={}}var e=t.prototype;return e.enablePrivateMode=function(){this._privateMode=!0},e.dispose=function(){for(var t in this._armatureCache){var e=this._armatureCache[t];if(e){var n=e.armature;n&&n.dispose()}}this._armatureCache={},this._animationPool={}},e._removeArmature=function(t){var e=this._armatureCache[t],n=e.animationsCache;for(var i in n){var r=n[i];r&&(this._animationPool[t+"#"+i]=r,r.clear())}var a=e.armature;a&&a.dispose(),delete this._armatureCache[t]},e.resetArmature=function(t){for(var e in this._armatureCache)-1!==e.indexOf(t)&&this._removeArmature(e)},e.getArmatureCache=function(e,n,i){var r,a=this._armatureCache[n];if(a)r=a.armature;else{var o=X5.getInstance().buildArmatureDisplay(e,n,"",i);if(!o||!o._armature)return null;if(r=o._armature,!t.canCache(r))return r.dispose(),null;this._armatureCache[n]={armature:r,animationsCache:{},curAnimationCache:null}}return r},e.getAnimationCache=function(t,e){var n=this._armatureCache[t];return n?n.animationsCache[e]:null},e.initAnimationCache=function(t,e){if(!e)return null;var n=this._armatureCache[t],i=n&&n.armature;if(!i)return null;if(!i.animation.hasAnimation(e))return null;var r=n.animationsCache,a=r[e];if(!a){var o=t+"#"+e;(a=this._animationPool[o])?delete this._animationPool[o]:(a=new s6)._privateMode=this._privateMode,a.init(n,e),r[e]=a}return a},e.invalidAnimationCache=function(t){var e=this._armatureCache[t];if(e&&e.armature){var n=e.animationsCache;for(var i in n)n[i].invalidAllFrame()}},e.updateAnimationCache=function(t,e){if(e){var n=this.initAnimationCache(t,e);if(!n)return;n.updateAllFrame()}else{var i=this._armatureCache[t];if(!i||!i.armature)return;var r=i.animationsCache;for(var a in r)r[a].updateAllFrame()}},t.canCache=function(t){for(var e=t._slots,n=0,i=e.length;n<i;n++)if(e[n].childArmature)return!1;return!0},t}();c6.FrameTime=Y5,c6.sharedCache=new c6;var l6,h6,u6,_6,f6,d6,p6,m6,v6,g6=Ec("dragonBones.DragonBonesAsset")((f3=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_dragonBonesJson",_3,at(e)),e._factory=null,e._dragonBonesJsonData=void 0,e._armaturesEnum=null,e}$(e,t);var n=e.prototype;return n.constructctor=function(){this.reset()},n.createNode=function(t){var e=new TE(this.name);return e.addComponent("dragonBones.ArmatureDisplay").dragonAsset=this,t(null,e)},n.reset=function(){this._clear()},n.init=function(t,e){this._factory=t,!this._dragonBonesJsonData&&this.dragonBonesJson&&(this._dragonBonesJsonData=JSON.parse(this.dragonBonesJson));var n;if(n=this._dragonBonesJsonData?this._dragonBonesJsonData:this._nativeAsset,!this._uuid){var i=this._factory.getDragonBonesDataByRawData(n);i?this._uuid=i.name:console.warn("dragonbones name is empty")}var r=this._uuid+"#"+e;return this._factory.getDragonBonesData(r)||this._factory.parseDragonBonesData(n instanceof ArrayBuffer?n:n.buffer instanceof ArrayBuffer?n.buffer:n,r),r},n.getArmatureEnum=function(){if(this._armaturesEnum)return this._armaturesEnum;this.init();var t=this._factory.getDragonBonesDataByUUID(this._uuid);if(t){for(var e=t.armatureNames,n={},i=0;i<e.length;i++)n[e[i]]=i;return this._armaturesEnum=se(n)}return null},n.getAnimsEnum=function(t){this.init();var e=this._factory.getDragonBonesDataByUUID(this._uuid);if(e){var n=e.getArmature(t);if(!n)return null;var i={"<None>":0},r=n.animations,a=0;for(var o in r)r.hasOwnProperty(o)&&(i[o]=a+1,a++);return se(i)}return null},n.destroy=function(){return this._clear(),t.prototype.destroy.call(this)},n._clear=function(){this._factory&&(c6.sharedCache.resetArmature(this._uuid),this._factory.removeDragonBonesDataByUUID(this._uuid,!0))},Q(e,[{key:"dragonBonesJson",get:function(){return this._dragonBonesJson},set:function(t){this._dragonBonesJson=t,this._dragonBonesJsonData=JSON.parse(t),this.reset()}}]),e}($h),_3=lt((u3=f3).prototype,"_dragonBonesJson",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),h3=u3))||h3;h.internal.DragonBonesAsset=g6;var y6,x6=(l6=Ec("dragonBones.DragonBonesAtlasAsset"),h6=cl(Mv),l6((v6=function(t){function e(){var e;return ct(e=t.call(this)||this,"_atlasJson",f6,at(e)),ct(e,"_texture",d6,at(e)),ct(e,"_atlasJsonData",p6,at(e)),e._factory=null,ct(e,"_textureAtlasData",m6,at(e)),e._clear(),e}$(e,t);var n=e.prototype;return n.createNode=function(t){var e=new TE(this.name);return e.addComponent("dragonBones.ArmatureDisplay").dragonAtlasAsset=this,t(null,e)},n.init=function(t){this._factory=t,this._atlasJsonData||(this._atlasJsonData=JSON.parse(this.atlasJson));var e=this._atlasJsonData;this._uuid=this._uuid||e.name,this._textureAtlasData?t.addTextureAtlasData(this._textureAtlasData,this._uuid):this._textureAtlasData=t.parseTextureAtlasData(e,this.texture,this._uuid)},n.destroy=function(){return this._clear(),t.prototype.destroy.call(this)},n._clear=function(){this._factory&&(c6.sharedCache.resetArmature(this._uuid),this._factory.removeTextureAtlasData(this._uuid,!0),this._factory.removeDragonBonesDataByUUID(this._uuid,!0)),this._textureAtlasData=null},Q(e,[{key:"atlasJson",get:function(){return this._atlasJson},set:function(t){this._atlasJson=t,this._atlasJsonData=JSON.parse(this.atlasJson),this._clear()}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture=t,this._clear()}}]),e}($h),f6=lt((_6=v6).prototype,"_atlasJson",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),d6=lt(_6.prototype,"_texture",[Nc,h6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p6=lt(_6.prototype,"_atlasJsonData",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{}}}),m6=lt(_6.prototype,"_textureAtlasData",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u6=_6))||u6);h.internal.DragonBonesAtlasAsset=x6;var S6,A6,b6,C6,T6,E6,w6,I6,P6,D6,R6,M6,O6,N6,B6,L6,F6,V6,z6,k6,U6,G6,H6,j6,W6,q6,X6,Y6,K6,J6,Q6,Z6,$6,t8,e8,n8,i8,r8,a8,o8,s8,c8,l8,h8,u8,_8,f8,d8,p8,m8,v8=new Xn,g8=Ec("dragonBones.AttachUtil")(y6=function(){function t(){this._inited=!1,this._armature=null,this._armatureNode=null,this._armatureDisplay=null}var e=t.prototype;return e.init=function(t){this._inited=!0,this._armature=t._armature,this._armatureNode=t.node,this._armatureDisplay=t},e.reset=function(){this._inited=!1,this._armature=null,this._armatureNode=null,this._armatureDisplay=null},e._syncAttachedNode=function(){if(this._inited){this._armatureNode.worldMatrix;var t=null,e=this._armatureDisplay.isAnimationCached();if(!e||!this._armatureDisplay||(t=this._armatureDisplay._curFrame&&this._armatureDisplay._curFrame.boneInfos))for(var n,i,r,a=this._armatureDisplay.sockets,o=this._armatureDisplay.socketNodes,s=this._armature.getBones(),c=a.length-1;c>=0;c--){var l=a[c],h=l.target;if(h)if(h.isValid){var u=e?t[l.boneIndex]:s[l.boneIndex];u&&(n=h,i=u.globalTransformMatrix,r=void 0,(r=v8).m00=i.a,r.m01=i.b,r.m04=-i.c,r.m05=-i.d,r.m12=i.tx,r.m13=i.ty,n.matrix=v8)}else o.delete(l.path),a.splice(c,1)}}},t}())||y6,y8=function(t){function e(){var e;return(e=t.call(this)||this)._armatures=new Set,e}$(e,t),e.getInstance=function(){return e._instance||(e._instance=new e,TO.registerSystem(e.ID,e._instance,uO.Priority.HIGH)),e._instance};var n=e.prototype;return n.add=function(t){t&&(this._armatures.has(t)||this._armatures.add(t))},n.remove=function(t){t&&this._armatures.has(t)&&this._armatures.delete(t)},n.postUpdate=function(t){this._armatures&&this._armatures.forEach((function(e){e.updateAnimation(t)}))},e}(uO);function x8(t,e,n){en.Attr.setClassAttr(t,e,"type","Enum"),en.Attr.setClassAttr(t,e,"enumList",se.getList(n))}y8.ID="ARMATURE",y8._instance=void 0,h.internal.ArmatureSystem=y8,function(t){t[t.default=-1]="default"}(f8||(f8={})),he(f8),function(t){t[t["<None>"]=0]="<None>"}(d8||(d8={})),he(d8),function(t){t[t.REALTIME=0]="REALTIME"}(p8||(p8={})),he(d8),function(t){t[t.REALTIME=0]="REALTIME",t[t.SHARED_CACHE=1]="SHARED_CACHE",t[t.PRIVATE_CACHE=2]="PRIVATE_CACHE"}(m8||(m8={})),he(m8);var S8=(S6=Ec("dragonBones.ArmatureDisplay.DragonBoneSocket"),A6=cl(TE),S6((T6=lt((C6=function(t,e){void 0===t&&(t=""),void 0===e&&(e=null),ct(this,"path",T6,this),ct(this,"target",E6,this),this.boneIndex=null,this.path=t,this.target=e}).prototype,"path",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),E6=lt(C6.prototype,"target",[A6,Wc,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b6=C6))||b6);Qt(S8,"dragonBones.ArmatureDisplay.DragonBoneSocket");var A8=(w6=Ec("dragonBones.ArmatureDisplay"),I6=jc(),P6=kc(),D6=cl(g6),R6=Kc(),M6=cl(x6),O6=Kc(),N6=qc(),B6=qc(),L6=Yc(),F6=cl(f8),V6=Kc(),z6=cl(d8),k6=Yc(),U6=Kc(),G6=Yc(),H6=Kc(),j6=Kc(),W6=Kc(),q6=Kc(),X6=Kc(),Y6=cl([S8]),K6=Kc(),w6(J6=I6(J6=P6(J6=zc((_8=u8=function(t){function e(){var e;return ct(e=t.call(this)||this,"playTimes",Z6,at(e)),ct(e,"premultipliedAlpha",$6,at(e)),e._armature=null,e.attachUtil=void 0,ct(e,"_defaultArmatureIndexValue",t8,at(e)),ct(e,"_dragonAsset",e8,at(e)),ct(e,"_dragonAtlasAsset",n8,at(e)),ct(e,"_armatureName",i8,at(e)),ct(e,"_animationName",r8,at(e)),ct(e,"_animationIndexValue",a8,at(e)),e._preCacheMode=-1,e._cacheMode=m8.REALTIME,ct(e,"_defaultCacheModeValue",o8,at(e)),ct(e,"_timeScale",s8,at(e)),ct(e,"_playTimes",c8,at(e)),ct(e,"_debugBones",l8,at(e)),e._debugDraw=null,e._armatureKey="",e._accTime=0,e._playCount=0,e._frameCache=null,e._curFrame=null,e._playing=!1,e._armatureCache=null,e._eventTarget=void 0,e._factory=null,e._displayProxy=null,e._drawIdx=0,e._drawList=new Xl((function(){return{material:null,texture:null,indexOffset:0,indexCount:0}}),1),e.maxVertexCount=0,e.maxIndexCount=0,e._materialCache={},e._enumArmatures=se({}),e._enumAnimations=se({}),e._socketNodes=new Map,e._cachedSockets=new Map,ct(e,"_sockets",h8,at(e)),e._inited=void 0,e._cacheModeEnum=void 0,e._eventTarget=new uh,e._inited=!1,e.attachUtil=new g8,e.initFactory(),x8(at(e),"_animationIndex",e._enumAnimations),x8(at(e),"_defaultArmatureIndex",e._enumArmatures),e._useVertexOpacity=!0,e}$(e,t);var n=e.prototype;return n.initFactory=function(){this._factory=X5.getInstance()},n.onLoad=function(){for(var t=this.node.children,e=0,n=t.length;e<n;e++){var i=t[e];0===(i.name&&i.name.search("CHILD_ARMATURE-"))&&i.destroy()}},n._requestDrawData=function(t,e,n,i){var r=this._drawList.add();return r.material=t,r.texture=e,r.indexOffset=n,r.indexCount=i,r},n.destroyRenderData=function(){this._drawList.reset(),t.prototype.destroyRenderData.call(this)},n.getMaterialForBlend=function(t,e){var n=t+"/"+e,i=this._materialCache[n];if(i)return i;var r=this.getMaterial(0);return(i=new wy({parent:r,subModelIdx:0,owner:this})).recompileShaders({USE_LOCAL:!0},0),this._materialCache[n]=i,i.overridePipelineStates({blendState:{targets:[{blendSrc:t,blendDst:e}]}}),i},n._render=function(t){if(this._renderData&&this._drawList){var e=this._renderData,n=e.chunk,i=n.vertexAccessor,r=e.getMeshBuffer(),a=r.indexOffset;i.appendIndices(n.bufferId,e.indices);for(var o=0;o<this._drawList.length;o++){this._drawIdx=o;var s=this._drawList.data[o];if(s.texture){var c=r.requireFreeIA(t.device);c.firstIndex=a+s.indexOffset,c.indexCount=s.indexCount,t.commitIA(this,c,s.texture,s.material,this.node)}}}},n.__preload=function(){t.prototype.__preload.call(this),this._init()},n._init=function(){if(this._cacheMode=this._defaultCacheMode,!this._inited){this._inited=!0,this._parseDragonAtlasAsset(),this._refresh();for(var t=this.node.children,e=0,n=t.length;e<n;e++){var i=t[e];i&&"DEBUG_DRAW_NODE"===i.name&&i.destroy()}this._updateDebugDraw(),this._indexBoneSockets(),this._updateSocketBindings()}},n.getArmatureKey=function(){return this._armatureKey},n.setAnimationCacheMode=function(t){this._preCacheMode!==t&&(this._cacheMode=t,this._buildArmature(),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature),this._updateSocketBindings(),this.markForUpdateRenderData())},n.isAnimationCached=function(){return this._cacheMode!==m8.REALTIME},n.onEnable=function(){t.prototype.onEnable.call(this),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature),this._flushAssembler(),y8.getInstance().add(this)},n.onDisable=function(){t.prototype.onDisable.call(this),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.remove(this._armature),y8.getInstance().remove(this)},n._emitCacheCompleteEvent=function(){this._eventTarget.emit(w5.LOOP_COMPLETE),this._eventTarget.emit(w5.COMPLETE)},n.updateAnimation=function(t){if(this.isAnimationCached()&&this._frameCache){this.markForUpdateRenderData();var e=this._frameCache;if(e.isInited()){var n=e.frames;if(this._playing){var i=c6.FrameTime;0===this._accTime&&0===this._playCount&&this._eventTarget.emit(w5.START),this._accTime+=t*this.timeScale*1;var r=Math.floor(this._accTime/i);if(e.isCompleted||(e.updateToFrame(r),this._renderData&&(this._renderData.vertexCount<e.maxVertexCount||this._renderData.indexCount<e.maxIndexCount)&&(this.maxVertexCount=e.maxVertexCount>this.maxVertexCount?e.maxVertexCount:this.maxVertexCount,this.maxIndexCount=e.maxIndexCount>this.maxIndexCount?e.maxIndexCount:this.maxIndexCount,this._renderData.resize(this.maxVertexCount,this.maxIndexCount),(!this._renderData.indices||this.maxIndexCount>this._renderData.indices.length)&&(this._renderData.indices=new Uint16Array(this.maxIndexCount)))),e.isCompleted&&r>=n.length){if(this._playCount++,this.playTimes>0&&this._playCount>=this.playTimes)return this._curFrame=n[n.length-1],this._accTime=0,this._playing=!1,this._playCount=0,this._emitCacheCompleteEvent(),void this.attachUtil._syncAttachedNode();this._accTime=0,r=0,this._emitCacheCompleteEvent()}this._curFrame=n[r],this.attachUtil._syncAttachedNode()}else e.isInvalid()&&(e.updateToFrame(),this._curFrame=n[n.length-1],this._renderData&&(this._renderData.vertexCount<e.maxVertexCount||this._renderData.indexCount<e.maxIndexCount)&&(this.maxVertexCount=e.maxVertexCount>this.maxVertexCount?e.maxVertexCount:this.maxVertexCount,this.maxIndexCount=e.maxIndexCount>this.maxIndexCount?e.maxIndexCount:this.maxIndexCount,this._renderData.resize(this.maxVertexCount,this.maxIndexCount),(!this._renderData.indices||this.maxIndexCount>this._renderData.indices.length)&&(this._renderData.indices=new Uint16Array(this.maxIndexCount))))}}},n.onDestroy=function(){this._materialInstances=this._materialInstances.filter((function(t){return!!t})),this._inited=!1,this._cacheMode===m8.PRIVATE_CACHE?(this._armatureCache.dispose(),this._armatureCache=null,this._armature=null):this._cacheMode===m8.SHARED_CACHE?(this._armatureCache=null,this._armature=null):this._armature&&(this._armature.dispose(),this._armature=null),this._drawList.destroy(),t.prototype.onDestroy.call(this)},n._updateDebugDraw=function(){if(this.debugBones){if(!this._debugDraw){var t=new TE("DEBUG_DRAW_NODE");t.hideFlags|=ml.Flags.DontSave|ml.Flags.HideInHierarchy;var e=t.addComponent(NU);e.lineWidth=1,e.strokeColor=new Dn(255,0,0,255),this._debugDraw=e}this._debugDraw.node.parent=this.node}else this._debugDraw&&(this._debugDraw.node.parent=null);this.markForUpdateRenderData()},n._buildArmature=function(){if(this.dragonAsset&&this.dragonAtlasAsset&&this.armatureName){this._armature&&(this._preCacheMode===m8.PRIVATE_CACHE?this._armatureCache.dispose():this._preCacheMode===m8.REALTIME&&this._armature.dispose(),this._armatureCache=null,this._armature=null,this._displayProxy=null,this._frameCache=null,this._curFrame=null,this._playing=!1,this._preCacheMode=-1),this._cacheMode===m8.SHARED_CACHE?this._armatureCache=c6.sharedCache:this._cacheMode===m8.PRIVATE_CACHE&&(this._armatureCache=new c6,this._armatureCache.enablePrivateMode());var t=this.dragonAtlasAsset._uuid;if(this._armatureKey=this.dragonAsset.init(this._factory,t),this.isAnimationCached()&&(this._armature=this._armatureCache.getArmatureCache(this.armatureName,this._armatureKey,t),this._armature||(this._cacheMode=m8.REALTIME)),this._preCacheMode=this._cacheMode,this._cacheMode===m8.REALTIME){if(this._displayProxy=this._factory.buildArmatureDisplay(this.armatureName,this._armatureKey,"",t),!this._displayProxy)return;this._displayProxy._ccNode=this.node,this._displayProxy._ccComponent=this,this._displayProxy.setEventTarget(this._eventTarget),this._armature=this._displayProxy._armature,this._armature.animation.timeScale=this.timeScale}if(this._cacheMode!==m8.REALTIME&&this.debugBones&&console.warn("Debug bones is invalid in cached mode"),this._armature){var e=this._armature.armatureData.aabb;this.node._uiProps.uiTransformComp.setContentSize(e.width,e.height)}this.attachUtil.init(this),this.animationName&&this.playAnimation(this.animationName,this.playTimes),this._flushAssembler()}},n.querySockets=function(){return this._armature?(0===this._cachedSockets.size&&this._indexBoneSockets(),Array.from(this._cachedSockets.keys()).sort()):[]},n.setBlendHash=function(){-1!==this._blendHash&&(this._blendHash=-1)},n.querySocketPathByName=function(t){for(var e,n=[],i=st(this._cachedSockets.keys());!(e=i()).done;){var r=e.value;r.endsWith(t)&&n.push(r)}return n},n._parseDragonAtlasAsset=function(){this.dragonAtlasAsset&&this.dragonAtlasAsset.init(this._factory)},n._refresh=function(){this._buildArmature(),this._indexBoneSockets(),this.markForUpdateRenderData()},n._updateCacheModeEnum=function(){this._cacheModeEnum=se({}),this._armature?Object.assign(this._cacheModeEnum,m8):Object.assign(this._cacheModeEnum,p8),x8(this,"_defaultCacheMode",this._cacheModeEnum)},n._updateAnimEnum=function(){var t;t=this.dragonAsset?this.dragonAsset.getAnimsEnum(this.armatureName):d8,this._enumAnimations=se({}),Object.assign(this._enumAnimations,t||d8),se.update(this._enumAnimations),x8(this,"_animationIndex",this._enumAnimations)},n._updateArmatureEnum=function(){var t;t=this.dragonAsset?this.dragonAsset.getArmatureEnum():f8,this._enumArmatures=se({}),Object.assign(this._enumArmatures,t||f8),se.update(this._enumArmatures),x8(this,"_defaultArmatureIndex",this._enumArmatures)},n._indexBoneSockets=function(){if(this._armature){this._cachedSockets.clear();var t=this._cachedSockets,e=function t(e,n,i){if(i.has(e))return i.get(e);var r=n[e];if(!r.parent)return i.set(e,r.name),r.path=r.name,r.name;var a=t(r.parent._boneIndex,n,i)+"/"+r.name;return i.set(e,a),r.path=a,a};!function n(i,r){for(var a=r.getBones(),o=new Map,s=0;s<a.length;s++)a[s]._boneIndex=s;for(var c=0;c<a.length;c++)e(c,a,o);for(var l,h=st(o.keys());!(l=h()).done;){var u=l.value;t.set(""+i+o.get(u),u)}for(var _=r.getSlots(),f=0;f<_.length;f++)_[f].childArmature&&n(_[f].name,_[f].childArmature)}("",this._armature)}},n.playAnimation=function(t,e){if(this.playTimes=void 0===e?-1:e,this.animationName=t,this.isAnimationCached()){var n=this._armatureCache.getAnimationCache(this._armatureKey,t);n||(n=this._armatureCache.initAnimationCache(this._armatureKey,t)),n&&(this._accTime=0,this._playCount=0,this._frameCache=n,this._sockets.length>0&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._playing=!0,this._curFrame=this._frameCache.frames[0])}else if(this._armature)return this._armature.animation.play(t,this.playTimes);return this.markForUpdateRenderData(),null},n.updateAnimationCache=function(t){this.isAnimationCached()&&this._armatureCache.updateAnimationCache(this._armatureKey,t)},n.invalidAnimationCache=function(){this.isAnimationCached()&&this._armatureCache.invalidAnimationCache(this._armatureKey)},n.getArmatureNames=function(){var t=this._factory.getDragonBonesData(this._armatureKey);return t&&t.armatureNames||[]},n.getAnimationNames=function(t){var e=[],n=this._factory.getDragonBonesData(this._armatureKey);if(n){var i=n.getArmature(t);if(i)for(var r in i.animations)i.animations.hasOwnProperty(r)&&e.push(r)}return e},n.on=function(t,e,n){this.addEventListener(t,e,n)},n.off=function(t,e,n){this.removeEventListener(t,e,n)},n.once=function(t,e,n){this._eventTarget.once(t,e,n)},n.addEventListener=function(t,e,n){this._eventTarget.on(t,e,n)},n.removeEventListener=function(t,e,n){this._eventTarget.off(t,e,n)},n.buildArmature=function(t,e){return this._factory.createArmatureNode(this,t,e)},n.armature=function(){return this._armature},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._armature&&this._assembler&&(this._renderData=this._assembler.createData(this),this._renderData&&(this.maxVertexCount=this._renderData.vertexCount,this.maxIndexCount=this._renderData.indexCount),this.markForUpdateRenderData(),this._updateColor())},n._updateSocketBindings=function(){if(this._armature){this._socketNodes.clear();for(var t=0,e=this._sockets.length;t<e;t++){var n=this._sockets[t];if(n.path&&n.target){var i=this._cachedSockets.get(n.path);if(!i){console.error("Skeleton data does not contain path "+n.path);continue}n.boneIndex=i,this._socketNodes.set(n.path,n.target)}}}},n._verifySockets=function(t){for(var e=0,n=t.length;e<n;e++){var i=t[e].target;!i||i.parent&&i.parent===this.node||console.error("Target node "+i.name+" is expected to be a direct child of "+this.node.name)}},Q(e,[{key:"dragonAsset",get:function(){return this._dragonAsset},set:function(t){this._dragonAsset=t,this.destroyRenderData(),this._refresh()}},{key:"dragonAtlasAsset",get:function(){return this._dragonAtlasAsset},set:function(t){this._dragonAtlasAsset=t,this._parseDragonAtlasAsset(),this._refresh()}},{key:"armatureName",get:function(){return this._armatureName},set:function(t){this._armatureName=t;var e=this.getAnimationNames(this._armatureName);(!this.animationName||e.indexOf(this.animationName)<0)&&(this.animationName=""),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.remove(this._armature),this._refresh(),this._armature&&!this.isAnimationCached()&&this._factory._dragonBones.clock.add(this._armature)}},{key:"animationName",get:function(){return this._animationName},set:function(t){this._animationName=t}},{key:"_defaultArmatureIndex",get:function(){return this._defaultArmatureIndexValue},set:function(t){this._defaultArmatureIndexValue=t;var e="";if(this.dragonAsset){var n;if(this.dragonAsset&&(n=this.dragonAsset.getArmatureEnum()),!n)return void O(7400,this.name);e=n[this._defaultArmatureIndex]}void 0!==e?this.armatureName=e:O(7401,this.name),this.markForUpdateRenderData()}},{key:"_animationIndex",get:function(){return this._animationIndexValue},set:function(t){var e;if(this._animationIndexValue=t,0!==this._animationIndex){if(this.dragonAsset&&(e=this.dragonAsset.getAnimsEnum(this.armatureName)),e){var n=e[this._animationIndex];void 0!==n?this.playAnimation(n,this.playTimes):O(7402,this.name)}}else this.animationName=""}},{key:"_defaultCacheMode",get:function(){return this._defaultCacheModeValue},set:function(t){if(this._defaultCacheModeValue=t,this._defaultCacheMode!==m8.REALTIME&&this._armature&&!c6.canCache(this._armature))return this._defaultCacheMode=m8.REALTIME,void console.warn("Animation cache mode doesn't support skeletal nesting");this.setAnimationCacheMode(this._defaultCacheMode)}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){this._timeScale=t,this._armature&&!this.isAnimationCached()&&(this._armature.animation.timeScale=this.timeScale)}},{key:"debugBones",get:function(){return this._debugBones},set:function(t){this._debugBones=t,this._updateDebugDraw()}},{key:"sockets",get:function(){return this._sockets},set:function(t){this._verifySockets(t),this._sockets=t,this._updateSocketBindings(),t.length>0&&this._frameCache&&this._frameCache.enableCacheAttachedInfo()}},{key:"socketNodes",get:function(){return this._socketNodes}},{key:"drawList",get:function(){return this._drawList}}]),e}(xk),u8.AnimationCacheMode=m8,lt((Q6=_8).prototype,"dragonAsset",[Wc,D6,R6],Object.getOwnPropertyDescriptor(Q6.prototype,"dragonAsset"),Q6.prototype),lt(Q6.prototype,"dragonAtlasAsset",[Wc,M6,O6],Object.getOwnPropertyDescriptor(Q6.prototype,"dragonAtlasAsset"),Q6.prototype),lt(Q6.prototype,"armatureName",[N6],Object.getOwnPropertyDescriptor(Q6.prototype,"armatureName"),Q6.prototype),lt(Q6.prototype,"animationName",[B6],Object.getOwnPropertyDescriptor(Q6.prototype,"animationName"),Q6.prototype),lt(Q6.prototype,"_defaultArmatureIndex",[L6,Wc,F6,V6],Object.getOwnPropertyDescriptor(Q6.prototype,"_defaultArmatureIndex"),Q6.prototype),lt(Q6.prototype,"_animationIndex",[Wc,z6,k6,U6],Object.getOwnPropertyDescriptor(Q6.prototype,"_animationIndex"),Q6.prototype),lt(Q6.prototype,"_defaultCacheMode",[Wc,G6,H6],Object.getOwnPropertyDescriptor(Q6.prototype,"_defaultCacheMode"),Q6.prototype),lt(Q6.prototype,"timeScale",[Wc,j6,Nc],Object.getOwnPropertyDescriptor(Q6.prototype,"timeScale"),Q6.prototype),Z6=lt(Q6.prototype,"playTimes",[W6,Wc,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),$6=lt(Q6.prototype,"premultipliedAlpha",[Nc,Wc,q6],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),lt(Q6.prototype,"debugBones",[X6,Wc],Object.getOwnPropertyDescriptor(Q6.prototype,"debugBones"),Q6.prototype),lt(Q6.prototype,"sockets",[Y6,K6],Object.getOwnPropertyDescriptor(Q6.prototype,"sockets"),Q6.prototype),t8=lt(Q6.prototype,"_defaultArmatureIndexValue",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return f8.default}}),e8=lt(Q6.prototype,"_dragonAsset",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),n8=lt(Q6.prototype,"_dragonAtlasAsset",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),i8=lt(Q6.prototype,"_armatureName",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),r8=lt(Q6.prototype,"_animationName",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),a8=lt(Q6.prototype,"_animationIndexValue",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),o8=lt(Q6.prototype,"_defaultCacheModeValue",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m8.REALTIME}}),s8=lt(Q6.prototype,"_timeScale",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),c8=lt(Q6.prototype,"_playTimes",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),l8=lt(Q6.prototype,"_debugBones",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),h8=lt(Q6.prototype,"_sockets",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),J6=Q6))||J6)||J6)||J6)||J6);h.internal.ArmatureDisplay=A8;var b8,C8,T8,E8,w8,I8,P8,D8,R8,M8,O8,N8,B8,L8,F8,V8,z8,k8,U8,G8=new Dn(255,0,0,255),H8=new Dn(0,0,255,255),j8=new Dn(0,255,0,255),W8=0,q8=0,X8=0,Y8=0,K8=0,J8=0,Q8=0,Z8=0,$8=0,t7=new Float32Array(4),e7=new Xn,n7=null,i7=null;function r7(t,e){if(!t)return null;var n,i;switch(e){case 1:n=w8?Oi.ONE:Oi.SRC_ALPHA,i=Oi.ONE;break;case 10:n=Oi.DST_COLOR,i=Oi.ONE_MINUS_SRC_ALPHA;break;case 12:n=Oi.ONE,i=Oi.ONE_MINUS_SRC_COLOR;break;case 0:default:n=w8?Oi.ONE:Oi.SRC_ALPHA,i=Oi.ONE_MINUS_SRC_ALPHA}return M8.setBlendHash(),M8.getMaterialForBlend(n,i)}function a7(t,e){var n=t.a*e*E8,i=w8?n/255:1,r=t.r*b8*i/255,a=t.g*C8*i/255,o=t.b*T8*i/255;t7[0]=r,t7[1]=a,t7[2]=o,t7[3]=w8?1:n/255}var o7=null,s7={accessor:o7,vCount:32767,ensureAccessor:function(){if(!o7){var t=TO.root.device,e=TO.root.batcher2D,n=nV;this.accessor=o7=new GX(t,n,this.vCount),e.registerBufferAccessor(Number.parseInt("DRAGONBONES",36),o7)}return this.accessor},createData:function(t){var e=t.renderData;if(!e){this.ensureAccessor();for(var n=t._armature._slots,i=0,r=0,a=0;a<n.length;++a){var o=n[a];i+=o._localVertices.length/4,r+=o._indices.length}(e=TV.add(nV,this.accessor)).resize(i,r),e.indices&&r===e.indices.length||(e.indices=new Uint16Array(r))}return e},updateRenderData:function(t){M8=t,t._armature&&function(t){var e=t._armature;if(e){I8=!0,w8=t.premultipliedAlpha,t.drawList.reset(),M8=t,t.node,P8=t.renderData,M8=t,B8=0,n7=null;var n,i=t.color;if(b8=i.r/255,C8=i.g/255,T8=i.b/255,E8=t.node._uiProps.opacity,4294967295!==i._val&&(B8|=1),W8=0,X8=0,Y8=0,K8=0,J8=0,$8=0,Q8=M8.maxVertexCount,Z8=M8.maxIndexCount,t.isAnimationCached())!function(t){if(t){var e=t.segments;if(0!==e.length){var n=null,i=t.vertices,r=t.indices,a=0,o=0,s=0,c=0,l=0,h=t.colors,u=h[l++],_=u.vfOffset;a7(u,1);for(var f=P8,d=f.chunk.vb,p=f.indices,m=0,v=e.length;m<v;m++){var g=e[m];if(n=r7(g.tex,g.blendMode)){if(n7||(n7=n),I8||n.hash!==n7.hash||g.tex&&g.tex!==i7){I8=!1;var y=J8-$8;y>0&&(M8._requestDrawData(n7,i7,$8,y),$8=J8),n7=n,i7=g.tex}q8=g.vertexCount,K8=g.indexCount,a=f.chunk.vertexOffset;for(var x=J8,S=J8+K8;x<S;x++)p[x]=a+X8+r[s++];c=g.vfCount;var A=i.subarray(o,c);d.set(A,o);if(1&B8)for(var b=o/9*5,C=o,T=o+c;C<T;C+=9,b+=5)b>=_&&(a7(u=h[l++],1),_=u.vfOffset),d.set(t7,C+5);o+=c,X8+=q8,J8+=K8,q8=0,K8=0}}var E=J8-$8;i7&&E>0&&M8._requestDrawData(n7,i7,$8,E)}}}(t._curFrame);else{c7(e,1,n);var r=t._debugDraw;if(t.debugBones&&r){r.clear(),r.lineWidth=5,r.strokeColor=G8,r.fillColor=H8;for(var a=e.getBones(),o=0,s=a.length;o<s;o++){var c=a[o],l=Math.max(c.boneData.length,5),h=c.globalTransformMatrix.tx,u=c.globalTransformMatrix.ty,_=h+c.globalTransformMatrix.a*l,f=u+c.globalTransformMatrix.b*l;r.moveTo(h,u),r.lineTo(_,f),r.stroke(),r.circle(h,u,2*Math.PI),r.fill(),0===o&&(r.fillColor=j8)}}}o7.getMeshBuffer(P8.chunk.bufferId).setDirty(),t.attachUtil._syncAttachedNode(),M8=void 0}}(t)},updateColor:function(t){t&&(M8=t).markForUpdateRenderData()}};function c7(t,e,n){var i=P8;R8=i.chunk.vb,D8=i.indices;for(var r,a,o,s,c,l,h=t._slots,u=0,_=h.length;u<_;u++)if(s=(c=h[u])._color,c._visible&&c._displayData)if(n?c._mulMat(c._worldMatrix,n,c._matrix):Xn.copy(c._worldMatrix,c._matrix),c.childArmature)c7(c.childArmature,s.a/255,c._worldMatrix);else if(r=r7(c.getTexture(),c._blendMode)){n7||(n7=r);var f=c.getTexture();if(I8||r.hash!==n7.hash||f&&i7!==f){I8=!1;var d=J8-$8;d>0&&(M8._requestDrawData(n7,i7,$8,d),$8=J8),i7=f,n7=r}a7(s,e),e7.set(c._worldMatrix),a=c._localVertices,q8=a.length/4,W8=9*q8,o=c._indices,K8=o.length;var p=!1;if(X8+q8>Q8&&(Q8=X8+q8,p=!0),J8+K8>Z8&&(Z8=J8+K8,p=!0),p){var m=D8,v=i.chunk.vertexOffset;i.resizeAndCopy(Q8,Z8>i.indexCount?Z8:i.indexCount),R8=i.chunk.vb,Z8>D8.length&&(D8=i.indices=new Uint16Array(Z8));for(var g=i.chunk.vertexOffset-v,y=0;y<J8;++y)D8[y]=m[y]+g}L8=e7.m00,F8=e7.m04,V8=e7.m12,z8=e7.m01,k8=e7.m05,U8=e7.m13;for(var x=0,S=a.length,A=Y8;x<S;A+=9)O8=a[x++],N8=a[x++],R8[A]=O8*L8+N8*F8+V8,R8[A+1]=O8*z8+N8*k8+U8,R8[A+3]=a[x++],R8[A+4]=a[x++],R8.set(t7,A+5);for(var b=i.chunk.vertexOffset,C=0,T=o.length,E=J8;C<T;C++,E++)D8[E]=X8+o[C]+b;Y8+=W8,X8+=q8,J8+=K8,q8=0,K8=0}l=J8-$8,i7&&l>0&&(M8._requestDrawData(n7,i7,$8,l),$8=J8),M8.maxIndexCount<Z8&&(M8.maxIndexCount=Z8),M8.maxVertexCount<Q8&&(M8.maxVertexCount=Q8)}h.internal.DragonBonesAssembler=s7;var l7,h7,u7,_7={getAssembler:function(){return s7}};A8.Assembler=_7,U(A8.prototype,"ArmatureDisplay",[{name:"_enableBatch",suggest:"Not support batch render mode"}]),function(t){t[t.FFD=0]="FFD",t[t.AdjustColor=10]="AdjustColor",t[t.BevelFilter=11]="BevelFilter",t[t.BlurFilter=12]="BlurFilter",t[t.DropShadowFilter=13]="DropShadowFilter",t[t.GlowFilter=14]="GlowFilter",t[t.GradientBevelFilter=15]="GradientBevelFilter",t[t.GradientGlowFilter=16]="GradientGlowFilter"}(l7||(l7={})),function(t){t[t.Frame=0]="Frame",t[t.Sound=1]="Sound"}(h7||(h7={})),function(t){t[t.None=0]="None",t[t.SameLayer=1]="SameLayer",t[t.SameGroup=2]="SameGroup",t[t.SameLayerAndGroup=3]="SameLayerAndGroup",t[t.All=4]="All"}(u7||(u7={})),t("dragonBones",Object.freeze({__proto__:null,get ExtensionType(){return l7},get EventType(){return h7},get AnimationFadeOutMode(){return u7},CCFactory:X5,CCSlot:W5,CCTextureAtlasData:H5,CCTextureData:j5,CCArmatureDisplay:q5,AnimationCache:s6,ArmatureCache:c6,DragonBonesAsset:g6,DragonBonesAtlasAsset:x6,timeScale:1,get AnimationCacheMode(){return m8},DragonBoneSocket:S8,ArmatureDisplay:A8,AttachUtil:g8,simpleDragonBoneAssembler:_7,DragonBones:d3,BaseObject:p3,Matrix:m3,Transform:v3,ColorTransform:g3,Point:y3,Rectangle:x3,UserData:S3,ActionData:A3,DragonBonesData:b3,ArmatureData:C3,BoneData:T3,SurfaceData:E3,SlotData:w3,ConstraintData:I3,IKConstraintData:P3,PathConstraintData:D3,CanvasData:R3,SkinData:M3,VerticesData:O3,DisplayData:N3,ImageDisplayData:B3,ArmatureDisplayData:L3,MeshDisplayData:F3,BoundingBoxDisplayData:V3,PathDisplayData:z3,WeightData:k3,BoundingBoxData:U3,RectangleBoundingBoxData:G3,EllipseBoundingBoxData:H3,PolygonBoundingBoxData:j3,AnimationData:W3,TimelineData:q3,AnimationConfig:X3,TextureAtlasData:Y3,TextureData:K3,DeformVertices:J3,Armature:Q3,TransformObject:Z3,Bone:$3,Surface:t5,Slot:e5,Constraint:n5,IKConstraint:i5,PathConstraint:r5,WorldClock:a5,Animation:o5,AnimationState:s5,BonePose:c5,BlendState:l5,TimelineState:h5,TweenTimelineState:u5,BoneTimelineState:_5,SlotTimelineState:f5,ConstraintTimelineState:d5,ActionTimelineState:p5,ZOrderTimelineState:m5,BoneAllTimelineState:v5,BoneTranslateTimelineState:g5,BoneRotateTimelineState:y5,BoneScaleTimelineState:x5,SurfaceTimelineState:S5,SlotDislayTimelineState:A5,SlotColorTimelineState:b5,DeformTimelineState:C5,IKConstraintTimelineState:T5,AnimationTimelineState:E5,EventObject:w5,DataParser:I5,ObjectDataParser:P5,ActionFrame:D5,BinaryDataParser:R5,BaseFactory:M5,BuildArmaturePackage:O5,BinaryOffset:N5,ArmatureType:B5,BoneType:L5,DisplayType:F5,BoundingBoxType:V5,ActionType:z5,BlendMode:k5,TweenType:U5,TimelineType:G5}));var f7,d7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuDescriptorSet=null,e}$(e,t);var n=e.prototype;return n.initialize=function(t){this._layout=t.layout;var e=t.layout.gpuDescriptorSetLayout,n=e.bindings,i=e.descriptorIndices,r=e.descriptorCount;this._buffers=Array(r).fill(null),this._textures=Array(r).fill(null),this._samplers=Array(r).fill(null);var a=[];this._gpuDescriptorSet={gpuDescriptors:a,descriptorIndices:i};for(var o=0;o<n.length;++o)for(var s=n[o],c=0;c<s.count;c++)a.push({type:s.descriptorType,gpuBuffer:null,gpuTexture:null,gpuSampler:null})},n.destroy=function(){this._layout=null,this._gpuDescriptorSet=null},n.update=function(){if(this._isDirty&&this._gpuDescriptorSet){for(var t=this._gpuDescriptorSet.gpuDescriptors,e=0;e<t.length;++e)if(t[e].type&oa){var n=this._buffers[e];n&&(t[e].gpuBuffer=n.gpuBuffer||n.gpuBufferView)}else t[e].type&sa&&(this._textures[e]&&(t[e].gpuTexture=this._textures[e].gpuTexture),this._samplers[e]&&(t[e].gpuSampler=this._samplers[e].gpuSampler));this._isDirty=!1}},Q(e,[{key:"gpuDescriptorSet",get:function(){return this._gpuDescriptorSet}}]),e}(Ta);!function(t){t[t.RGBA16F_EXT=34842]="RGBA16F_EXT",t[t.RGB16F_EXT=34843]="RGB16F_EXT",t[t.RGBA32F_EXT=34836]="RGBA32F_EXT",t[t.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",t[t.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",t[t.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",t[t.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",t[t.SRGB_EXT=35904]="SRGB_EXT",t[t.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",t[t.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",t[t.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",t[t.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",t[t.COMPRESSED_SRGB_S3TC_DXT1_EXT=35916]="COMPRESSED_SRGB_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT=35917]="COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT=35918]="COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT",t[t.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT=35919]="COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT",t[t.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",t[t.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",t[t.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",t[t.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",t[t.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",t[t.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",t[t.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",t[t.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",t[t.COMPRESSED_SRGB8_ETC2=37493]="COMPRESSED_SRGB8_ETC2",t[t.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37494]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37495]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",t[t.COMPRESSED_RGBA8_ETC2_EAC=37496]="COMPRESSED_RGBA8_ETC2_EAC",t[t.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37497]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",t[t.COMPRESSED_RGBA_ASTC_4x4_KHR=37808]="COMPRESSED_RGBA_ASTC_4x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x4_KHR=37809]="COMPRESSED_RGBA_ASTC_5x4_KHR",t[t.COMPRESSED_RGBA_ASTC_5x5_KHR=37810]="COMPRESSED_RGBA_ASTC_5x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x5_KHR=37811]="COMPRESSED_RGBA_ASTC_6x5_KHR",t[t.COMPRESSED_RGBA_ASTC_6x6_KHR=37812]="COMPRESSED_RGBA_ASTC_6x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x5_KHR=37813]="COMPRESSED_RGBA_ASTC_8x5_KHR",t[t.COMPRESSED_RGBA_ASTC_8x6_KHR=37814]="COMPRESSED_RGBA_ASTC_8x6_KHR",t[t.COMPRESSED_RGBA_ASTC_8x8_KHR=37815]="COMPRESSED_RGBA_ASTC_8x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x5_KHR=37816]="COMPRESSED_RGBA_ASTC_10x5_KHR",t[t.COMPRESSED_RGBA_ASTC_10x6_KHR=37817]="COMPRESSED_RGBA_ASTC_10x6_KHR",t[t.COMPRESSED_RGBA_ASTC_10x8_KHR=37818]="COMPRESSED_RGBA_ASTC_10x8_KHR",t[t.COMPRESSED_RGBA_ASTC_10x10_KHR=37819]="COMPRESSED_RGBA_ASTC_10x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x10_KHR=37820]="COMPRESSED_RGBA_ASTC_12x10_KHR",t[t.COMPRESSED_RGBA_ASTC_12x12_KHR=37821]="COMPRESSED_RGBA_ASTC_12x12_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR=37840]="COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR=37841]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR=37842]="COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR=37843]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR=37844]="COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR=37845]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR=37846]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR=37847]="COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR=37848]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR=37849]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR=37850]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR=37851]="COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR=37852]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR",t[t.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR=37853]="COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR"}(f7||(f7={}));var p7=function(){function t(){}return t.setInstance=function(e){t._instance=e},Q(t,null,[{key:"instance",get:function(){return t._instance}}]),t}();function m7(t,e){switch(t){case mi.R8:return e.UNSIGNED_BYTE;case mi.R8SN:return e.BYTE;case mi.R8UI:return e.UNSIGNED_BYTE;case mi.R8I:return e.BYTE;case mi.R16F:return f7.HALF_FLOAT_OES;case mi.R16UI:return e.UNSIGNED_SHORT;case mi.R16I:return e.SHORT;case mi.R32F:return e.FLOAT;case mi.R32UI:return e.UNSIGNED_INT;case mi.R32I:return e.INT;case mi.RG8:return e.UNSIGNED_BYTE;case mi.RG8SN:return e.BYTE;case mi.RG8UI:return e.UNSIGNED_BYTE;case mi.RG8I:return e.BYTE;case mi.RG16F:return f7.HALF_FLOAT_OES;case mi.RG16UI:return e.UNSIGNED_SHORT;case mi.RG16I:return e.SHORT;case mi.RG32F:return e.FLOAT;case mi.RG32UI:return e.UNSIGNED_INT;case mi.RG32I:return e.INT;case mi.RGB8:case mi.SRGB8:return e.UNSIGNED_BYTE;case mi.RGB8SN:return e.BYTE;case mi.RGB8UI:return e.UNSIGNED_BYTE;case mi.RGB8I:return e.BYTE;case mi.RGB16F:return f7.HALF_FLOAT_OES;case mi.RGB16UI:return e.UNSIGNED_SHORT;case mi.RGB16I:return e.SHORT;case mi.RGB32F:return e.FLOAT;case mi.RGB32UI:return e.UNSIGNED_INT;case mi.RGB32I:return e.INT;case mi.BGRA8:case mi.RGBA8:case mi.SRGB8_A8:return e.UNSIGNED_BYTE;case mi.RGBA8SN:return e.BYTE;case mi.RGBA8UI:return e.UNSIGNED_BYTE;case mi.RGBA8I:return e.BYTE;case mi.RGBA16F:return f7.HALF_FLOAT_OES;case mi.RGBA16UI:return e.UNSIGNED_SHORT;case mi.RGBA16I:return e.SHORT;case mi.RGBA32F:return e.FLOAT;case mi.RGBA32UI:return e.UNSIGNED_INT;case mi.RGBA32I:return e.INT;case mi.R5G6B5:return e.UNSIGNED_SHORT_5_6_5;case mi.R11G11B10F:return e.FLOAT;case mi.RGB5A1:return e.UNSIGNED_SHORT_5_5_5_1;case mi.RGBA4:return e.UNSIGNED_SHORT_4_4_4_4;case mi.RGB10A2:return e.UNSIGNED_BYTE;case mi.RGB10A2UI:return e.UNSIGNED_INT;case mi.RGB9E5:return e.UNSIGNED_BYTE;case mi.DEPTH:return e.UNSIGNED_INT;case mi.DEPTH_STENCIL:return f7.UNSIGNED_INT_24_8_WEBGL;case mi.BC1:case mi.BC1_SRGB:case mi.BC2:case mi.BC2_SRGB:case mi.BC3:case mi.BC3_SRGB:case mi.BC4:return e.UNSIGNED_BYTE;case mi.BC4_SNORM:return e.BYTE;case mi.BC5:return e.UNSIGNED_BYTE;case mi.BC5_SNORM:return e.BYTE;case mi.BC6H_SF16:case mi.BC6H_UF16:return e.FLOAT;case mi.BC7:case mi.BC7_SRGB:case mi.ETC_RGB8:case mi.ETC2_RGB8:case mi.ETC2_SRGB8:case mi.ETC2_RGB8_A1:case mi.ETC2_SRGB8_A1:case mi.EAC_R11:return e.UNSIGNED_BYTE;case mi.EAC_R11SN:return e.BYTE;case mi.EAC_RG11:return e.UNSIGNED_BYTE;case mi.EAC_RG11SN:return e.BYTE;case mi.PVRTC_RGB2:case mi.PVRTC_RGBA2:case mi.PVRTC_RGB4:case mi.PVRTC_RGBA4:case mi.PVRTC2_2BPP:case mi.PVRTC2_4BPP:return e.UNSIGNED_BYTE;case mi.ASTC_RGBA_4X4:case mi.ASTC_RGBA_5X4:case mi.ASTC_RGBA_5X5:case mi.ASTC_RGBA_6X5:case mi.ASTC_RGBA_6X6:case mi.ASTC_RGBA_8X5:case mi.ASTC_RGBA_8X6:case mi.ASTC_RGBA_8X8:case mi.ASTC_RGBA_10X5:case mi.ASTC_RGBA_10X6:case mi.ASTC_RGBA_10X8:case mi.ASTC_RGBA_10X10:case mi.ASTC_RGBA_12X10:case mi.ASTC_RGBA_12X12:case mi.ASTC_SRGBA_4X4:case mi.ASTC_SRGBA_5X4:case mi.ASTC_SRGBA_5X5:case mi.ASTC_SRGBA_6X5:case mi.ASTC_SRGBA_6X6:case mi.ASTC_SRGBA_8X5:case mi.ASTC_SRGBA_8X6:case mi.ASTC_SRGBA_8X8:case mi.ASTC_SRGBA_10X5:case mi.ASTC_SRGBA_10X6:case mi.ASTC_SRGBA_10X8:case mi.ASTC_SRGBA_10X10:case mi.ASTC_SRGBA_12X10:case mi.ASTC_SRGBA_12X12:default:return e.UNSIGNED_BYTE}}function v7(t,e){switch(t){case gi.BOOL:return e.BOOL;case gi.BOOL2:return e.BOOL_VEC2;case gi.BOOL3:return e.BOOL_VEC3;case gi.BOOL4:return e.BOOL_VEC4;case gi.INT:return e.INT;case gi.INT2:return e.INT_VEC2;case gi.INT3:return e.INT_VEC3;case gi.INT4:return e.INT_VEC4;case gi.UINT:return e.UNSIGNED_INT;case gi.FLOAT:return e.FLOAT;case gi.FLOAT2:return e.FLOAT_VEC2;case gi.FLOAT3:return e.FLOAT_VEC3;case gi.FLOAT4:return e.FLOAT_VEC4;case gi.MAT2:return e.FLOAT_MAT2;case gi.MAT3:return e.FLOAT_MAT3;case gi.MAT4:return e.FLOAT_MAT4;case gi.SAMPLER2D:return e.SAMPLER_2D;case gi.SAMPLER_CUBE:return e.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to GL type failed."),gi.UNKNOWN}}function g7(t){switch(t){case gi.BOOL:case gi.BOOL2:case gi.BOOL3:case gi.BOOL4:case gi.INT:case gi.INT2:case gi.INT3:case gi.INT4:case gi.UINT:return Int32Array;case gi.FLOAT:case gi.FLOAT2:case gi.FLOAT3:case gi.FLOAT4:case gi.MAT2:case gi.MAT3:case gi.MAT4:return Float32Array;default:return console.error("Unsupported GLType, convert to TypedArrayConstructor failed."),Float32Array}}function y7(t,e){switch(t){case e.BOOL:return gi.BOOL;case e.BOOL_VEC2:return gi.BOOL2;case e.BOOL_VEC3:return gi.BOOL3;case e.BOOL_VEC4:return gi.BOOL4;case e.INT:return gi.INT;case e.INT_VEC2:return gi.INT2;case e.INT_VEC3:return gi.INT3;case e.INT_VEC4:return gi.INT4;case e.UNSIGNED_INT:return gi.UINT;case e.FLOAT:return gi.FLOAT;case e.FLOAT_VEC2:return gi.FLOAT2;case e.FLOAT_VEC3:return gi.FLOAT3;case e.FLOAT_VEC4:return gi.FLOAT4;case e.FLOAT_MAT2:return gi.MAT2;case e.FLOAT_MAT3:return gi.MAT3;case e.FLOAT_MAT4:return gi.MAT4;case e.SAMPLER_2D:return gi.SAMPLER2D;case e.SAMPLER_CUBE:return gi.SAMPLER_CUBE;default:return console.error("Unsupported GLType, convert to Type failed."),gi.UNKNOWN}}function x7(t,e){switch(t){case e.BOOL:return 4;case e.BOOL_VEC2:return 8;case e.BOOL_VEC3:return 12;case e.BOOL_VEC4:return 16;case e.INT:return 4;case e.INT_VEC2:return 8;case e.INT_VEC3:return 12;case e.INT_VEC4:return 16;case e.UNSIGNED_INT:case e.FLOAT:return 4;case e.FLOAT_VEC2:return 8;case e.FLOAT_VEC3:return 12;case e.FLOAT_VEC4:case e.FLOAT_MAT2:return 16;case e.FLOAT_MAT3:return 36;case e.FLOAT_MAT4:return 64;case e.SAMPLER_2D:case e.SAMPLER_CUBE:return 4;default:return console.error("Unsupported GLType, get type failed."),0}}function S7(t,e){switch(t){case e.FLOAT_MAT2:return 2;case e.FLOAT_MAT3:return 3;case e.FLOAT_MAT4:return 4;default:return 1}}p7._instance=null;var A7,b7=[512,513,514,515,516,517,518,519],C7=[0,7680,7681,7682,7683,5386,34055,34056],T7=[32774,32778,32779,32775,32776],E7=[0,1,770,772,771,773,768,774,769,775,776,32769,32770,32771,32772];!function(t){t[t.BEGIN_RENDER_PASS=0]="BEGIN_RENDER_PASS",t[t.END_RENDER_PASS=1]="END_RENDER_PASS",t[t.BIND_STATES=2]="BIND_STATES",t[t.DRAW=3]="DRAW",t[t.UPDATE_BUFFER=4]="UPDATE_BUFFER",t[t.COPY_BUFFER_TO_TEXTURE=5]="COPY_BUFFER_TO_TEXTURE",t[t.COUNT=6]="COUNT"}(A7||(A7={}));var w7=function(t){this.cmdType=void 0,this.refCount=0,this.cmdType=t},I7=function(t){function e(){var e;return(e=t.call(this,A7.BEGIN_RENDER_PASS)||this).gpuRenderPass=null,e.gpuFramebuffer=null,e.renderArea=new or,e.clearFlag=Zi.NONE,e.clearColors=[],e.clearDepth=1,e.clearStencil=0,e}return $(e,t),e.prototype.clear=function(){this.gpuFramebuffer=null,this.clearColors.length=0},e}(w7),P7=function(t){function e(){var e;return(e=t.call(this,A7.BIND_STATES)||this).gpuPipelineState=null,e.gpuInputAssembler=null,e.gpuDescriptorSets=[],e.dynamicOffsets=[],e.dynamicStates=new ia,e}return $(e,t),e.prototype.clear=function(){this.gpuPipelineState=null,this.gpuDescriptorSets.length=0,this.gpuInputAssembler=null,this.dynamicOffsets.length=0},e}(w7),D7=function(t){function e(){var e;return(e=t.call(this,A7.DRAW)||this).drawInfo=new xr,e}return $(e,t),e.prototype.clear=function(){},e}(w7),R7=function(t){function e(){var e;return(e=t.call(this,A7.UPDATE_BUFFER)||this).gpuBuffer=null,e.buffer=null,e.offset=0,e.size=0,e}return $(e,t),e.prototype.clear=function(){this.gpuBuffer=null,this.buffer=null},e}(w7),M7=function(t){function e(){var e;return(e=t.call(this,A7.COPY_BUFFER_TO_TEXTURE)||this).gpuTexture=null,e.buffers=[],e.regions=[],e}return $(e,t),e.prototype.clear=function(){this.gpuTexture=null,this.buffers.length=0,this.regions.length=0},e}(w7),O7=function(){function t(){this.cmds=new Yl(1),this.beginRenderPassCmds=new Yl(1),this.bindStatesCmds=new Yl(1),this.drawCmds=new Yl(1),this.updateBufferCmds=new Yl(1),this.copyBufferToTextureCmds=new Yl(1)}return t.prototype.clearCmds=function(t){this.beginRenderPassCmds.length&&(t.beginRenderPassCmdPool.freeCmds(this.beginRenderPassCmds),this.beginRenderPassCmds.clear()),this.bindStatesCmds.length&&(t.bindStatesCmdPool.freeCmds(this.bindStatesCmds),this.bindStatesCmds.clear()),this.drawCmds.length&&(t.drawCmdPool.freeCmds(this.drawCmds),this.drawCmds.clear()),this.updateBufferCmds.length&&(t.updateBufferCmdPool.freeCmds(this.updateBufferCmds),this.updateBufferCmds.clear()),this.copyBufferToTextureCmds.length&&(t.copyBufferToTextureCmdPool.freeCmds(this.copyBufferToTextureCmds),this.copyBufferToTextureCmds.clear()),this.cmds.clear()},t}();function N7(t,e,n,i,r){if(e.usage&yi.UNIFORM)ArrayBuffer.isView(n)?e.vf32.set(n,i/Float32Array.BYTES_PER_ELEMENT):e.vf32.set(new Float32Array(n),i/Float32Array.BYTES_PER_ELEMENT);else if(e.usage&yi.INDIRECT){e.indirects.clearDraws();for(var a=n.drawInfos,o=0;o<a.length;++o)e.indirects.setDrawInfo(i+o,a[o])}else{var s=n,c=t.gl,l=t.stateCache;switch(e.glTarget){case c.ARRAY_BUFFER:t.extensions.useVAO&&l.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),l.glVAO=null),B7.gpuInputAssembler=null,t.stateCache.glArrayBuffer!==e.glBuffer&&(c.bindBuffer(c.ARRAY_BUFFER,e.glBuffer),t.stateCache.glArrayBuffer=e.glBuffer);break;case c.ELEMENT_ARRAY_BUFFER:t.extensions.useVAO&&l.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),l.glVAO=null),B7.gpuInputAssembler=null,t.stateCache.glElementArrayBuffer!==e.glBuffer&&(c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,e.glBuffer),t.stateCache.glElementArrayBuffer=e.glBuffer);break;default:return void console.error("Unsupported BufferType, update buffer failed.")}r===s.byteLength?c.bufferSubData(e.glTarget,i,s):c.bufferSubData(e.glTarget,i,s.slice(0,r))}}var B7={gpuPipelineState:null,gpuInputAssembler:null,glPrimitive:0},L7=new or;function F7(t,e,n,i,r,a,o){var s=t.gl,c=t.stateCache,l=0;if(n&&(L7.x=i.x<<n.lodLevel,L7.y=i.y<<n.lodLevel,L7.width=i.width<<n.lodLevel,L7.height=i.height<<n.lodLevel),n&&e){c.glFramebuffer!==n.glFramebuffer&&(s.bindFramebuffer(s.FRAMEBUFFER,n.glFramebuffer),c.glFramebuffer=n.glFramebuffer),c.viewport.left===L7.x&&c.viewport.top===L7.y&&c.viewport.width===L7.width&&c.viewport.height===L7.height||(s.viewport(L7.x,L7.y,L7.width,L7.height),c.viewport.left=L7.x,c.viewport.top=L7.y,c.viewport.width=L7.width,c.viewport.height=L7.height),c.scissorRect.x===L7.x&&c.scissorRect.y===L7.y&&c.scissorRect.width===L7.width&&c.scissorRect.height===L7.height||(s.scissor(L7.x,L7.y,L7.width,L7.height),c.scissorRect.x=L7.x,c.scissorRect.y=L7.y,c.scissorRect.width=L7.width,c.scissorRect.height=L7.height);var h=r.length;t.extensions.WEBGL_draw_buffers||(h=1);for(var u=0;u<h;++u){var _=e.colorAttachments[u];if(_.format!==mi.UNKNOWN)switch(_.loadOp){case Fi.LOAD:break;case Fi.CLEAR:c.bs.targets[0].blendColorMask!==Bi.ALL&&s.colorMask(!0,!0,!0,!0);var f=r[0];s.clearColor(f.x,f.y,f.z,f.w),l|=s.COLOR_BUFFER_BIT;break;case Fi.DISCARD:}}if(e.depthStencilAttachment&&e.depthStencilAttachment.format!==mi.UNKNOWN){switch(e.depthStencilAttachment.depthLoadOp){case Fi.LOAD:break;case Fi.CLEAR:c.dss.depthWrite||s.depthMask(!0),s.clearDepth(a),l|=s.DEPTH_BUFFER_BIT;break;case Fi.DISCARD:}if(aa[e.depthStencilAttachment.format].hasStencil)switch(e.depthStencilAttachment.stencilLoadOp){case Fi.LOAD:break;case Fi.CLEAR:c.dss.stencilWriteMaskFront||s.stencilMaskSeparate(s.FRONT,65535),c.dss.stencilWriteMaskBack||s.stencilMaskSeparate(s.BACK,65535),s.clearStencil(o),l|=s.STENCIL_BUFFER_BIT;break;case Fi.DISCARD:}}if(l&&s.clear(l),l&s.COLOR_BUFFER_BIT){var d=c.bs.targets[0].blendColorMask;if(d!==Bi.ALL){var p=(d&Bi.R)!==Bi.NONE,m=(d&Bi.G)!==Bi.NONE,v=(d&Bi.B)!==Bi.NONE,g=(d&Bi.A)!==Bi.NONE;s.colorMask(p,m,v,g)}}l&s.DEPTH_BUFFER_BIT&&!c.dss.depthWrite&&s.depthMask(!1),l&s.STENCIL_BUFFER_BIT&&(c.dss.stencilWriteMaskFront||s.stencilMaskSeparate(s.FRONT,0),c.dss.stencilWriteMaskBack||s.stencilMaskSeparate(s.BACK,0))}}function V7(t,e,n,i,r,a){var o,s,c,l=t.gl,h=t.stateCache,u=e&&e.gpuShader,_=!1;if(e&&B7.gpuPipelineState!==e){if(B7.gpuPipelineState=e,B7.glPrimitive=e.glPrimitive,e.gpuShader){var f=e.gpuShader.glProgram;h.glProgram!==f&&(l.useProgram(f),h.glProgram=f,_=!0)}var d=e.rs;if(d){if(h.rs.cullMode!==d.cullMode){switch(d.cullMode){case Wi.NONE:l.disable(l.CULL_FACE);break;case Wi.FRONT:l.enable(l.CULL_FACE),l.cullFace(l.FRONT);break;case Wi.BACK:l.enable(l.CULL_FACE),l.cullFace(l.BACK)}h.rs.cullMode=d.cullMode}var p=d.isFrontFaceCCW;h.rs.isFrontFaceCCW!==p&&(l.frontFace(p?l.CCW:l.CW),h.rs.isFrontFaceCCW=p),h.rs.depthBias===d.depthBias&&h.rs.depthBiasSlop===d.depthBiasSlop||(l.polygonOffset(d.depthBias,d.depthBiasSlop),h.rs.depthBias=d.depthBias,h.rs.depthBiasSlop=d.depthBiasSlop),h.rs.lineWidth!==d.lineWidth&&(l.lineWidth(d.lineWidth),h.rs.lineWidth=d.lineWidth)}var m=e.dss;m&&(h.dss.depthTest!==m.depthTest&&(m.depthTest?l.enable(l.DEPTH_TEST):l.disable(l.DEPTH_TEST),h.dss.depthTest=m.depthTest),h.dss.depthWrite!==m.depthWrite&&(l.depthMask(m.depthWrite),h.dss.depthWrite=m.depthWrite),h.dss.depthFunc!==m.depthFunc&&(l.depthFunc(b7[m.depthFunc]),h.dss.depthFunc=m.depthFunc),h.dss.stencilTestFront===m.stencilTestFront&&h.dss.stencilTestBack===m.stencilTestBack||(m.stencilTestFront||m.stencilTestBack?l.enable(l.STENCIL_TEST):l.disable(l.STENCIL_TEST),h.dss.stencilTestFront=m.stencilTestFront,h.dss.stencilTestBack=m.stencilTestBack),h.dss.stencilFuncFront===m.stencilFuncFront&&h.dss.stencilRefFront===m.stencilRefFront&&h.dss.stencilReadMaskFront===m.stencilReadMaskFront||(l.stencilFuncSeparate(l.FRONT,b7[m.stencilFuncFront],m.stencilRefFront,m.stencilReadMaskFront),h.dss.stencilFuncFront=m.stencilFuncFront,h.dss.stencilRefFront=m.stencilRefFront,h.dss.stencilReadMaskFront=m.stencilReadMaskFront),h.dss.stencilFailOpFront===m.stencilFailOpFront&&h.dss.stencilZFailOpFront===m.stencilZFailOpFront&&h.dss.stencilPassOpFront===m.stencilPassOpFront||(l.stencilOpSeparate(l.FRONT,C7[m.stencilFailOpFront],C7[m.stencilZFailOpFront],C7[m.stencilPassOpFront]),h.dss.stencilFailOpFront=m.stencilFailOpFront,h.dss.stencilZFailOpFront=m.stencilZFailOpFront,h.dss.stencilPassOpFront=m.stencilPassOpFront),h.dss.stencilWriteMaskFront!==m.stencilWriteMaskFront&&(l.stencilMaskSeparate(l.FRONT,m.stencilWriteMaskFront),h.dss.stencilWriteMaskFront=m.stencilWriteMaskFront),h.dss.stencilFuncBack===m.stencilFuncBack&&h.dss.stencilRefBack===m.stencilRefBack&&h.dss.stencilReadMaskBack===m.stencilReadMaskBack||(l.stencilFuncSeparate(l.BACK,b7[m.stencilFuncBack],m.stencilRefBack,m.stencilReadMaskBack),h.dss.stencilFuncBack=m.stencilFuncBack,h.dss.stencilRefBack=m.stencilRefBack,h.dss.stencilReadMaskBack=m.stencilReadMaskBack),h.dss.stencilFailOpBack===m.stencilFailOpBack&&h.dss.stencilZFailOpBack===m.stencilZFailOpBack&&h.dss.stencilPassOpBack===m.stencilPassOpBack||(l.stencilOpSeparate(l.BACK,C7[m.stencilFailOpBack],C7[m.stencilZFailOpBack],C7[m.stencilPassOpBack]),h.dss.stencilFailOpBack=m.stencilFailOpBack,h.dss.stencilZFailOpBack=m.stencilZFailOpBack,h.dss.stencilPassOpBack=m.stencilPassOpBack),h.dss.stencilWriteMaskBack!==m.stencilWriteMaskBack&&(l.stencilMaskSeparate(l.BACK,m.stencilWriteMaskBack),h.dss.stencilWriteMaskBack=m.stencilWriteMaskBack));var v=e.bs;if(v){h.bs.isA2C!==v.isA2C&&(v.isA2C?l.enable(l.SAMPLE_ALPHA_TO_COVERAGE):l.disable(l.SAMPLE_ALPHA_TO_COVERAGE),h.bs.isA2C=v.isA2C),h.bs.blendColor.x===v.blendColor.x&&h.bs.blendColor.y===v.blendColor.y&&h.bs.blendColor.z===v.blendColor.z&&h.bs.blendColor.w===v.blendColor.w||(l.blendColor(v.blendColor.x,v.blendColor.y,v.blendColor.z,v.blendColor.w),h.bs.blendColor.x=v.blendColor.x,h.bs.blendColor.y=v.blendColor.y,h.bs.blendColor.z=v.blendColor.z,h.bs.blendColor.w=v.blendColor.w);var g=v.targets[0],y=h.bs.targets[0];y.blend!==g.blend&&(g.blend?l.enable(l.BLEND):l.disable(l.BLEND),y.blend=g.blend),y.blendEq===g.blendEq&&y.blendAlphaEq===g.blendAlphaEq||(l.blendEquationSeparate(T7[g.blendEq],T7[g.blendAlphaEq]),y.blendEq=g.blendEq,y.blendAlphaEq=g.blendAlphaEq),y.blendSrc===g.blendSrc&&y.blendDst===g.blendDst&&y.blendSrcAlpha===g.blendSrcAlpha&&y.blendDstAlpha===g.blendDstAlpha||(l.blendFuncSeparate(E7[g.blendSrc],E7[g.blendDst],E7[g.blendSrcAlpha],E7[g.blendDstAlpha]),y.blendSrc=g.blendSrc,y.blendDst=g.blendDst,y.blendSrcAlpha=g.blendSrcAlpha,y.blendDstAlpha=g.blendDstAlpha),y.blendColorMask!==g.blendColorMask&&(l.colorMask((g.blendColorMask&Bi.R)!==Bi.NONE,(g.blendColorMask&Bi.G)!==Bi.NONE,(g.blendColorMask&Bi.B)!==Bi.NONE,(g.blendColorMask&Bi.A)!==Bi.NONE),y.blendColorMask=g.blendColorMask)}}if(e&&e.gpuPipelineLayout&&u){for(var x=u.glBlocks.length,S=e.gpuPipelineLayout.dynamicOffsetIndices,b=0;b<x;b++){var C=u.glBlocks[b],T=i[C.set],E=T&&T.descriptorIndices[C.binding],w=E>=0&&T.gpuDescriptors[E],I=null,P=0;if(w&&w.gpuBuffer){var D=w.gpuBuffer,R=S[C.set],M=R&&R[C.binding];M>=0&&(P=r[M]),"vf32"in D?I=D.vf32:(P+=D.offset,I=D.gpuBuffer.vf32),P>>=2}if(I)for(var O=C.glActiveUniforms.length,N=0;N<O;N++){var B=C.glActiveUniforms[N];switch(B.glType){case l.BOOL:case l.INT:for(var L=0;L<B.array.length;++L){var F=B.offset+P+L;if(I[F]!==B.array[L]){for(var V=L,z=F;V<B.array.length;++V,++z)B.array[V]=I[z];l.uniform1iv(B.glLoc,B.array);break}}break;case l.BOOL_VEC2:case l.INT_VEC2:for(var k=0;k<B.array.length;++k){var U=B.offset+P+k;if(I[U]!==B.array[k]){for(var G=k,H=U;G<B.array.length;++G,++H)B.array[G]=I[H];l.uniform2iv(B.glLoc,B.array);break}}break;case l.BOOL_VEC3:case l.INT_VEC3:for(var j=0;j<B.array.length;++j){var W=B.offset+P+j;if(I[W]!==B.array[j]){for(var q=j,X=W;q<B.array.length;++q,++X)B.array[q]=I[X];l.uniform3iv(B.glLoc,B.array);break}}break;case l.BOOL_VEC4:case l.INT_VEC4:for(var Y=0;Y<B.array.length;++Y){var K=B.offset+P+Y;if(I[K]!==B.array[Y]){for(var J=Y,Q=K;J<B.array.length;++J,++Q)B.array[J]=I[Q];l.uniform4iv(B.glLoc,B.array);break}}break;case l.FLOAT:for(var Z=0;Z<B.array.length;++Z){var $=B.offset+P+Z;if(I[$]!==B.array[Z]){for(var tt=Z,et=$;tt<B.array.length;++tt,++et)B.array[tt]=I[et];l.uniform1fv(B.glLoc,B.array);break}}break;case l.FLOAT_VEC2:for(var nt=0;nt<B.array.length;++nt){var it=B.offset+P+nt;if(I[it]!==B.array[nt]){for(var rt=nt,at=it;rt<B.array.length;++rt,++at)B.array[rt]=I[at];l.uniform2fv(B.glLoc,B.array);break}}break;case l.FLOAT_VEC3:for(var ot=0;ot<B.array.length;++ot){var st=B.offset+P+ot;if(I[st]!==B.array[ot]){for(var ct=ot,lt=st;ct<B.array.length;++ct,++lt)B.array[ct]=I[lt];l.uniform3fv(B.glLoc,B.array);break}}break;case l.FLOAT_VEC4:for(var ht=0;ht<B.array.length;++ht){var ut=B.offset+P+ht;if(I[ut]!==B.array[ht]){for(var _t=ht,ft=ut;_t<B.array.length;++_t,++ft)B.array[_t]=I[ft];l.uniform4fv(B.glLoc,B.array);break}}break;case l.FLOAT_MAT2:for(var dt=0;dt<B.array.length;++dt){var pt=B.offset+P+dt;if(I[pt]!==B.array[dt]){for(var mt=dt,vt=pt;mt<B.array.length;++mt,++vt)B.array[mt]=I[vt];l.uniformMatrix2fv(B.glLoc,!1,B.array);break}}break;case l.FLOAT_MAT3:for(var gt=0;gt<B.array.length;++gt){var yt=B.offset+P+gt;if(I[yt]!==B.array[gt]){for(var xt=gt,St=yt;xt<B.array.length;++xt,++St)B.array[xt]=I[St];l.uniformMatrix3fv(B.glLoc,!1,B.array);break}}break;case l.FLOAT_MAT4:for(var At=0;At<B.array.length;++At){var bt=B.offset+P+At;if(I[bt]!==B.array[At]){for(var Ct=At,Tt=bt;Ct<B.array.length;++Ct,++Tt)B.array[Ct]=I[Tt];l.uniformMatrix4fv(B.glLoc,!1,B.array);break}}}}else A("Buffer binding '"+C.name+"' at set "+C.set+" binding "+C.binding+" is not bounded")}for(var Et=u.glSamplerTextures.length,wt=0;wt<Et;wt++)for(var It=u.glSamplerTextures[wt],Pt=i[It.set],Dt=Pt&&Pt.descriptorIndices[It.binding],Rt=Dt>=0&&Pt.gpuDescriptors[Dt],Mt=It.units.length,Ot=0;Ot<Mt;Ot++){var Nt=It.units[Ot];if(Rt&&Rt.gpuSampler){if(Rt.gpuTexture&&Rt.gpuTexture.size>0){var Bt=Rt.gpuTexture,Lt=h.glTexUnits[Nt];Lt.glTexture!==Bt.glTexture&&(h.texUnit!==Nt&&(l.activeTexture(l.TEXTURE0+Nt),h.texUnit=Nt),Bt.glTexture?l.bindTexture(Bt.glTarget,Bt.glTexture):l.bindTexture(Bt.glTarget,t.nullTex2D.gpuTexture.glTexture),Lt.glTexture=Bt.glTexture);var Ft=Rt.gpuSampler;Bt.isPowerOf2?(o=Ft.glWrapS,s=Ft.glWrapT):(o=l.CLAMP_TO_EDGE,s=l.CLAMP_TO_EDGE),c=Bt.isPowerOf2?Bt.mipLevel<=1&&(Ft.glMinFilter===l.LINEAR_MIPMAP_NEAREST||Ft.glMinFilter===l.LINEAR_MIPMAP_LINEAR)?l.LINEAR:Ft.glMinFilter:Ft.glMinFilter===l.LINEAR||Ft.glMinFilter===l.LINEAR_MIPMAP_NEAREST||Ft.glMinFilter===l.LINEAR_MIPMAP_LINEAR?l.LINEAR:l.NEAREST,Bt.glWrapS!==o&&(h.texUnit!==Nt&&(l.activeTexture(l.TEXTURE0+Nt),h.texUnit=Nt),l.texParameteri(Bt.glTarget,l.TEXTURE_WRAP_S,o),Bt.glWrapS=o),Bt.glWrapT!==s&&(h.texUnit!==Nt&&(l.activeTexture(l.TEXTURE0+Nt),h.texUnit=Nt),l.texParameteri(Bt.glTarget,l.TEXTURE_WRAP_T,s),Bt.glWrapT=s),Bt.glMinFilter!==c&&(h.texUnit!==Nt&&(l.activeTexture(l.TEXTURE0+Nt),h.texUnit=Nt),l.texParameteri(Bt.glTarget,l.TEXTURE_MIN_FILTER,c),Bt.glMinFilter=c),Bt.glMagFilter!==Ft.glMagFilter&&(h.texUnit!==Nt&&(l.activeTexture(l.TEXTURE0+Nt),h.texUnit=Nt),l.texParameteri(Bt.glTarget,l.TEXTURE_MAG_FILTER,Ft.glMagFilter),Bt.glMagFilter=Ft.glMagFilter)}Rt=Pt.gpuDescriptors[++Dt]}else A("Sampler binding '"+It.name+"' at set "+It.set+" binding "+It.binding+" index "+Ot+" is not bounded")}}if(n&&u&&(_||B7.gpuInputAssembler!==n)){B7.gpuInputAssembler=n;var Vt=t.extensions.ANGLE_instanced_arrays;if(t.extensions.useVAO){var zt=t.extensions.OES_vertex_array_object,kt=n.glVAOs.get(u.glProgram);if(!kt){var Ut;kt=zt.createVertexArrayOES(),n.glVAOs.set(u.glProgram,kt),zt.bindVertexArrayOES(kt),l.bindBuffer(l.ARRAY_BUFFER,null),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,null),h.glArrayBuffer=null,h.glElementArrayBuffer=null;for(var Gt=u.glInputs.length,Ht=0;Ht<Gt;Ht++){var jt=u.glInputs[Ht];Ut=null;for(var Wt=n.glAttribs.length,qt=0;qt<Wt;qt++){var Xt=n.glAttribs[qt];if(Xt.name===jt.name){Ut=Xt;break}}if(Ut){h.glArrayBuffer!==Ut.glBuffer&&(l.bindBuffer(l.ARRAY_BUFFER,Ut.glBuffer),h.glArrayBuffer=Ut.glBuffer);for(var Yt=0;Yt<Ut.componentCount;++Yt){var Kt=jt.glLoc+Yt,Jt=Ut.offset+Ut.size*Yt;l.enableVertexAttribArray(Kt),h.glCurrentAttribLocs[Kt]=!0,l.vertexAttribPointer(Kt,Ut.count,Ut.glType,Ut.isNormalized,Ut.stride,Jt),Vt&&Vt.vertexAttribDivisorANGLE(Kt,Ut.isInstanced?1:0)}}}var Qt=n.gpuIndexBuffer;Qt&&l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,Qt.glBuffer),zt.bindVertexArrayOES(null),l.bindBuffer(l.ARRAY_BUFFER,null),l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,null),h.glArrayBuffer=null,h.glElementArrayBuffer=null}h.glVAO!==kt&&(zt.bindVertexArrayOES(kt),h.glVAO=kt)}else{for(var Zt=0;Zt<t.capabilities.maxVertexAttributes;++Zt)h.glCurrentAttribLocs[Zt]=!1;for(var $t=u.glInputs.length,te=0;te<$t;te++){for(var ee=u.glInputs[te],ne=null,ie=n.glAttribs.length,re=0;re<ie;re++){var ae=n.glAttribs[re];if(ae.name===ee.name){ne=ae;break}}if(ne){h.glArrayBuffer!==ne.glBuffer&&(l.bindBuffer(l.ARRAY_BUFFER,ne.glBuffer),h.glArrayBuffer=ne.glBuffer);for(var oe=0;oe<ne.componentCount;++oe){var se=ee.glLoc+oe,ce=ne.offset+ne.size*oe;!h.glEnabledAttribLocs[se]&&se>=0&&(l.enableVertexAttribArray(se),h.glEnabledAttribLocs[se]=!0),h.glCurrentAttribLocs[se]=!0,l.vertexAttribPointer(se,ne.count,ne.glType,ne.isNormalized,ne.stride,ce),Vt&&Vt.vertexAttribDivisorANGLE(se,ne.isInstanced?1:0)}}}var le=n.gpuIndexBuffer;le&&h.glElementArrayBuffer!==le.glBuffer&&(l.bindBuffer(l.ELEMENT_ARRAY_BUFFER,le.glBuffer),h.glElementArrayBuffer=le.glBuffer);for(var he=0;he<t.capabilities.maxVertexAttributes;++he)h.glEnabledAttribLocs[he]!==h.glCurrentAttribLocs[he]&&(l.disableVertexAttribArray(he),h.glEnabledAttribLocs[he]=!1)}}if(e&&e.dynamicStates.length)for(var ue=e.dynamicStates.length,_e=0;_e<ue;_e++)switch(e.dynamicStates[_e]){case qi.LINE_WIDTH:h.rs.lineWidth!==a.lineWidth&&(l.lineWidth(a.lineWidth),h.rs.lineWidth=a.lineWidth);break;case qi.DEPTH_BIAS:h.rs.depthBias===a.depthBiasConstant&&h.rs.depthBiasSlop===a.depthBiasSlope||(l.polygonOffset(a.depthBiasConstant,a.depthBiasSlope),h.rs.depthBias=a.depthBiasConstant,h.rs.depthBiasSlop=a.depthBiasSlope);break;case qi.BLEND_CONSTANTS:var fe=a.blendConstant;h.bs.blendColor.x===fe.x&&h.bs.blendColor.y===fe.y&&h.bs.blendColor.z===fe.z&&h.bs.blendColor.w===fe.w||(l.blendColor(fe.x,fe.y,fe.z,fe.w),h.bs.blendColor.copy(fe));break;case qi.STENCIL_WRITE_MASK:var de=a.stencilStatesFront,pe=a.stencilStatesBack;h.dss.stencilWriteMaskFront!==de.writeMask&&(l.stencilMaskSeparate(l.FRONT,de.writeMask),h.dss.stencilWriteMaskFront=de.writeMask),h.dss.stencilWriteMaskBack!==pe.writeMask&&(l.stencilMaskSeparate(l.BACK,pe.writeMask),h.dss.stencilWriteMaskBack=pe.writeMask);break;case qi.STENCIL_COMPARE_MASK:var me=a.stencilStatesFront,ve=a.stencilStatesBack;h.dss.stencilRefFront===me.reference&&h.dss.stencilReadMaskFront===me.compareMask||(l.stencilFuncSeparate(l.FRONT,b7[h.dss.stencilFuncFront],me.reference,me.compareMask),h.dss.stencilRefFront=me.reference,h.dss.stencilReadMaskFront=me.compareMask),h.dss.stencilRefBack===ve.reference&&h.dss.stencilReadMaskBack===ve.compareMask||(l.stencilFuncSeparate(l.BACK,b7[h.dss.stencilFuncBack],ve.reference,ve.compareMask),h.dss.stencilRefBack=ve.reference,h.dss.stencilReadMaskBack=ve.compareMask)}}function z7(t,e){var n=t.gl,i=t.extensions,r=i.ANGLE_instanced_arrays,a=i.WEBGL_multi_draw,o=B7.gpuInputAssembler,s=B7.glPrimitive;if(o){var c=o.gpuIndexBuffer;if(o.gpuIndirectBuffer){var l=o.gpuIndirectBuffer.indirects;if(l.drawByIndex){for(var h=0;h<l.drawCount;h++)l.byteOffsets[h]=l.offsets[h]*c.stride;if(a)l.instancedDraw?a.multiDrawElementsInstancedWEBGL(s,l.counts,0,o.glIndexType,l.byteOffsets,0,l.instances,0,l.drawCount):a.multiDrawElementsWEBGL(s,l.counts,0,o.glIndexType,l.byteOffsets,0,l.drawCount);else for(var u=0;u<l.drawCount;u++)l.instances[u]&&r?r.drawElementsInstancedANGLE(s,l.counts[u],o.glIndexType,l.byteOffsets[u],l.instances[u]):n.drawElements(s,l.counts[u],o.glIndexType,l.byteOffsets[u])}else if(a)l.instancedDraw?a.multiDrawArraysInstancedWEBGL(s,l.offsets,0,l.counts,0,l.instances,0,l.drawCount):a.multiDrawArraysWEBGL(s,l.offsets,0,l.counts,0,l.drawCount);else for(var _=0;_<l.drawCount;_++)l.instances[_]&&r?r.drawArraysInstancedANGLE(s,l.offsets[_],l.counts[_],l.instances[_]):n.drawArrays(s,l.offsets[_],l.counts[_])}else if(e.instanceCount&&r)if(c){if(e.indexCount>0){var f=e.firstIndex*c.stride;r.drawElementsInstancedANGLE(s,e.indexCount,o.glIndexType,f,e.instanceCount)}}else e.vertexCount>0&&r.drawArraysInstancedANGLE(s,e.firstVertex,e.vertexCount,e.instanceCount);else if(c){if(e.indexCount>0){var d=e.firstIndex*c.stride;n.drawElements(s,e.indexCount,o.glIndexType,d)}}else e.vertexCount>0&&n.drawArrays(s,e.firstVertex,e.vertexCount)}}var k7=new Array(A7.COUNT);function U7(t,e){k7.fill(0);for(var n=0;n<e.cmds.length;++n){var i=e.cmds.array[n],r=k7[i]++;switch(i){case A7.BEGIN_RENDER_PASS:var a=e.beginRenderPassCmds.array[r];F7(t,a.gpuRenderPass,a.gpuFramebuffer,a.renderArea,a.clearColors,a.clearDepth,a.clearStencil);break;case A7.BIND_STATES:var o=e.bindStatesCmds.array[r];V7(t,o.gpuPipelineState,o.gpuInputAssembler,o.gpuDescriptorSets,o.dynamicOffsets,o.dynamicStates);break;case A7.DRAW:z7(t,e.drawCmds.array[r].drawInfo);break;case A7.UPDATE_BUFFER:var s=e.updateBufferCmds.array[r];N7(t,s.gpuBuffer,s.buffer,s.offset,s.size);break;case A7.COPY_BUFFER_TO_TEXTURE:var c=e.copyBufferToTextureCmds.array[r];G7(t,c.buffers,c.gpuTexture,c.regions)}}}function G7(t,e,n,i){var r=t.gl,a=t.stateCache.glTexUnits[t.stateCache.texUnit];a.glTexture!==n.glTexture&&(r.bindTexture(n.glTarget,n.glTexture),a.glTexture=n.glTexture);var o=0,s=1,c=1,l=0,h=aa[n.format].isCompressed;switch(n.glTarget){case r.TEXTURE_2D:for(var u=0;u<i.length;u++){var _=i[u];s=_.texExtent.width,c=_.texExtent.height;var f=e[o++];h?n.glInternalFmt===f7.COMPRESSED_RGB_ETC1_WEBGL||t.extensions.noCompressedTexSubImage2D?r.compressedTexImage2D(r.TEXTURE_2D,_.texSubres.mipLevel,n.glInternalFmt,s,c,0,f):r.compressedTexSubImage2D(r.TEXTURE_2D,_.texSubres.mipLevel,_.texOffset.x,_.texOffset.y,s,c,n.glFormat,f):r.texSubImage2D(r.TEXTURE_2D,_.texSubres.mipLevel,_.texOffset.x,_.texOffset.y,s,c,n.glFormat,n.glType,f)}break;case r.TEXTURE_CUBE_MAP:for(var d=0;d<i.length;d++){var p=i[d],m=p.texSubres.baseArrayLayer+p.texSubres.layerCount;for(l=p.texSubres.baseArrayLayer;l<m;++l){s=p.texExtent.width,c=p.texExtent.height;var v=e[o++];h?n.glInternalFmt===f7.COMPRESSED_RGB_ETC1_WEBGL||t.extensions.noCompressedTexSubImage2D?r.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,p.texSubres.mipLevel,n.glInternalFmt,s,c,0,v):r.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,p.texSubres.mipLevel,p.texOffset.x,p.texOffset.y,s,c,n.glFormat,v):r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+l,p.texSubres.mipLevel,p.texOffset.x,p.texOffset.y,s,c,n.glFormat,n.glType,v)}}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}n.flags&Ti.GEN_MIPMAP&&r.generateMipmap(n.glTarget)}var H7=function(){function t(){this.counts=void 0,this.offsets=void 0,this.instances=void 0,this.drawCount=0,this.drawByIndex=!1,this.instancedDraw=!1,this.byteOffsets=void 0,this._capacity=4,this.counts=new Int32Array(this._capacity),this.offsets=new Int32Array(this._capacity),this.instances=new Int32Array(this._capacity),this.byteOffsets=new Int32Array(this._capacity)}var e=t.prototype;return e.clearDraws=function(){this.drawCount=0,this.drawByIndex=!1,this.instancedDraw=!1},e.setDrawInfo=function(t,e){this._ensureCapacity(t),this.drawByIndex=e.indexCount>0,this.instancedDraw=!!e.instanceCount,this.drawCount=Math.max(t+1,this.drawCount),this.drawByIndex?(this.counts[t]=e.indexCount,this.offsets[t]=e.firstIndex):(this.counts[t]=e.vertexCount,this.offsets[t]=e.firstVertex),this.instances[t]=Math.max(1,e.instanceCount)},e._ensureCapacity=function(t){if(!(this._capacity>t)){this._capacity=a(t);var e=new Int32Array(this._capacity),n=new Int32Array(this._capacity),i=new Int32Array(this._capacity);this.byteOffsets=new Int32Array(this._capacity),e.set(this.counts),n.set(this.offsets),i.set(this.instances),this.counts=e,this.offsets=n,this.instances=i}},t}(),j7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuBuffer=null,e._gpuBufferView=null,e._uniformBuffer=null,e}$(e,t);var n=e.prototype;return n.initialize=function(t){if("buffer"in t){this._isBufferView=!0;var e=t.buffer;this._usage=e.usage,this._memUsage=e.memUsage,this._size=this._stride=t.range,this._count=1,this._flags=e.flags,this._gpuBufferView={gpuBuffer:e.gpuBuffer,offset:t.offset,range:t.range}}else this._usage=t.usage,this._memUsage=t.memUsage,this._size=t.size,this._stride=Math.max(t.stride||this._size,1),this._count=this._size/this._stride,this._flags=t.flags,this._usage&yi.UNIFORM&&this._size>0&&(this._uniformBuffer=new Uint8Array(this._size)),this._gpuBuffer={usage:this._usage,memUsage:this._memUsage,size:this._size,stride:this._stride,buffer:null,vf32:null,indirects:new H7,glTarget:0,glBuffer:null},this._usage&yi.UNIFORM&&(this._gpuBuffer.buffer=this._uniformBuffer),function(t,e){var n=t.gl,i=t.stateCache,r=e.memUsage&Ai.HOST?n.DYNAMIC_DRAW:n.STATIC_DRAW;if(e.usage&yi.VERTEX){e.glTarget=n.ARRAY_BUFFER;var a=n.createBuffer();a&&(e.glBuffer=a,e.size>0&&(t.extensions.useVAO&&i.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),i.glVAO=null),B7.gpuInputAssembler=null,t.stateCache.glArrayBuffer!==e.glBuffer&&(n.bindBuffer(n.ARRAY_BUFFER,e.glBuffer),t.stateCache.glArrayBuffer=e.glBuffer),n.bufferData(n.ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null))}else if(e.usage&yi.INDEX){e.glTarget=n.ELEMENT_ARRAY_BUFFER;var o=n.createBuffer();o&&(e.glBuffer=o,e.size>0&&(t.extensions.useVAO&&i.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),i.glVAO=null),B7.gpuInputAssembler=null,t.stateCache.glElementArrayBuffer!==e.glBuffer&&(n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.glBuffer),t.stateCache.glElementArrayBuffer=e.glBuffer),n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null))}else e.usage&yi.UNIFORM?(e.glTarget=n.NONE,e.buffer&&(e.vf32=new Float32Array(e.buffer.buffer))):(e.usage&yi.INDIRECT||e.usage&yi.TRANSFER_DST||e.usage&yi.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=n.NONE)}(p7.instance,this._gpuBuffer),p7.instance.memoryStatus.bufferSize+=this._size},n.destroy=function(){this._gpuBuffer&&(function(t,e){var n=t.gl,i=t.stateCache;if(e.glBuffer){switch(e.glTarget){case n.ARRAY_BUFFER:t.extensions.useVAO&&i.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),t.stateCache.glVAO=null),B7.gpuInputAssembler=null,n.bindBuffer(n.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null;break;case n.ELEMENT_ARRAY_BUFFER:t.extensions.useVAO&&i.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),t.stateCache.glVAO=null),B7.gpuInputAssembler=null,n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null}n.deleteBuffer(e.glBuffer),e.glBuffer=null}}(p7.instance,this._gpuBuffer),p7.instance.memoryStatus.bufferSize-=this._size,this._gpuBuffer=null),this._gpuBufferView&&(this._gpuBufferView=null)},n.resize=function(t){if(this._isBufferView)console.warn("cannot resize buffer views!");else{var e=this._size;e!==t&&(this._size=t,this._count=this._size/this._stride,this._uniformBuffer&&(this._uniformBuffer=new Uint8Array(t)),this._gpuBuffer&&(this._uniformBuffer&&(this._gpuBuffer.buffer=this._uniformBuffer),this._gpuBuffer.size=t,t>0&&(function(t,e){var n=t.gl,i=t.stateCache,r=e.memUsage&Ai.HOST?n.DYNAMIC_DRAW:n.STATIC_DRAW;e.usage&yi.VERTEX?(t.extensions.useVAO&&i.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),i.glVAO=null),B7.gpuInputAssembler=null,t.stateCache.glArrayBuffer!==e.glBuffer&&n.bindBuffer(n.ARRAY_BUFFER,e.glBuffer),e.buffer?n.bufferData(n.ARRAY_BUFFER,e.buffer,r):n.bufferData(n.ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ARRAY_BUFFER,null),t.stateCache.glArrayBuffer=null):e.usage&yi.INDEX?(t.extensions.useVAO&&i.glVAO&&(t.extensions.OES_vertex_array_object.bindVertexArrayOES(null),i.glVAO=null),B7.gpuInputAssembler=null,t.stateCache.glElementArrayBuffer!==e.glBuffer&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,e.glBuffer),e.buffer?n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.buffer,r):n.bufferData(n.ELEMENT_ARRAY_BUFFER,e.size,r),n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,null),t.stateCache.glElementArrayBuffer=null):e.usage&yi.UNIFORM?e.buffer&&(e.vf32=new Float32Array(e.buffer.buffer)):(e.usage&yi.INDIRECT||e.usage&yi.TRANSFER_DST||e.usage&yi.TRANSFER_SRC||console.error("Unsupported BufferType, create buffer failed."),e.glTarget=n.NONE)}(p7.instance,this._gpuBuffer),p7.instance.memoryStatus.bufferSize-=e,p7.instance.memoryStatus.bufferSize+=t)))}},n.update=function(t,e){var n;this._isBufferView?console.warn("cannot update through buffer views!"):(n=void 0!==e?e:this._usage&yi.INDIRECT?0:t.byteLength,N7(p7.instance,this._gpuBuffer,t,0,n))},Q(e,[{key:"gpuBuffer",get:function(){return this._gpuBuffer}},{key:"gpuBufferView",get:function(){return this._gpuBufferView}}]),e}(ma),W7=function(){function t(t,e){this._frees=void 0,this._freeIdx=0,this._freeCmds=void 0,this._frees=new Array(e),this._freeCmds=new Yl(e);for(var n=0;n<e;++n)this._frees[n]=new t;this._freeIdx=e-1}var e=t.prototype;return e.alloc=function(t){if(this._freeIdx<0){var e=2*this._frees.length,n=this._frees;this._frees=new Array(e);for(var i=e-n.length,r=0;r<i;++r)this._frees[r]=new t;for(var a=i,o=0;a<e;++a,++o)this._frees[a]=n[o];this._freeIdx+=i}var s=this._frees[this._freeIdx];return this._frees[this._freeIdx--]=null,++s.refCount,s},e.free=function(t){0==--t.refCount&&this._freeCmds.push(t)},e.freeCmds=function(t){for(var e=0;e<t.length;++e)0==--t.array[e].refCount&&this._freeCmds.push(t.array[e])},e.release=function(){for(var t=0;t<this._freeCmds.length;++t){var e=this._freeCmds.array[t];e.clear(),this._frees[++this._freeIdx]=e}this._freeCmds.clear()},t}(),q7=function(){function t(){this.beginRenderPassCmdPool=void 0,this.bindStatesCmdPool=void 0,this.drawCmdPool=void 0,this.updateBufferCmdPool=void 0,this.copyBufferToTextureCmdPool=void 0,this.beginRenderPassCmdPool=new W7(I7,1),this.bindStatesCmdPool=new W7(P7,1),this.drawCmdPool=new W7(D7,1),this.updateBufferCmdPool=new W7(R7,1),this.copyBufferToTextureCmdPool=new W7(M7,1)}var e=t.prototype;return e.clearCmds=function(t){t.beginRenderPassCmds.length&&(this.beginRenderPassCmdPool.freeCmds(t.beginRenderPassCmds),t.beginRenderPassCmds.clear()),t.bindStatesCmds.length&&(this.bindStatesCmdPool.freeCmds(t.bindStatesCmds),t.bindStatesCmds.clear()),t.drawCmds.length&&(this.drawCmdPool.freeCmds(t.drawCmds),t.drawCmds.clear()),t.updateBufferCmds.length&&(this.updateBufferCmdPool.freeCmds(t.updateBufferCmds),t.updateBufferCmds.clear()),t.copyBufferToTextureCmds.length&&(this.copyBufferToTextureCmdPool.freeCmds(t.copyBufferToTextureCmds),t.copyBufferToTextureCmds.clear()),t.cmds.clear()},e.releaseCmds=function(){this.beginRenderPassCmdPool.release(),this.bindStatesCmdPool.release(),this.drawCmdPool.release(),this.updateBufferCmdPool.release(),this.copyBufferToTextureCmdPool.release()},t}(),X7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).cmdPackage=new O7,e._cmdAllocator=new q7,e._isInRenderPass=!1,e._curGPUPipelineState=null,e._curGPUInputAssembler=null,e._curGPUDescriptorSets=[],e._curDynamicOffsets=Array(8).fill(0),e._curDynamicStates=new ia,e._isStateInvalied=!1,e}$(e,t);var n=e.prototype;return n.initialize=function(t){this._type=t.type,this._queue=t.queue;for(var e=p7.instance.bindingMappings.blockOffsets.length,n=0;n<e;n++)this._curGPUDescriptorSets.push(null)},n.destroy=function(){this._cmdAllocator.clearCmds(this.cmdPackage)},n.begin=function(){this._cmdAllocator.clearCmds(this.cmdPackage),this._curGPUPipelineState=null,this._curGPUInputAssembler=null,this._curGPUDescriptorSets.length=0,this._numDrawCalls=0,this._numInstances=0,this._numTris=0},n.end=function(){this._isStateInvalied&&this.bindStates(),this._isInRenderPass=!1},n.beginRenderPass=function(t,e,n,i,r,a){var o=this._cmdAllocator.beginRenderPassCmdPool.alloc(I7);o.gpuRenderPass=t.gpuRenderPass,o.gpuFramebuffer=e.gpuFramebuffer,o.renderArea.copy(n),o.clearColors.length=i.length;for(var s=0;s<i.length;++s)o.clearColors[s]=i[s];o.clearDepth=r,o.clearStencil=a,this.cmdPackage.beginRenderPassCmds.push(o),this.cmdPackage.cmds.push(A7.BEGIN_RENDER_PASS),this._isInRenderPass=!0},n.endRenderPass=function(){this._isInRenderPass=!1},n.bindPipelineState=function(t){var e=t.gpuPipelineState;e!==this._curGPUPipelineState&&(this._curGPUPipelineState=e,this._isStateInvalied=!0)},n.bindDescriptorSet=function(t,e,n){var i=e.gpuDescriptorSet;if(i!==this._curGPUDescriptorSets[t]&&(this._curGPUDescriptorSets[t]=i,this._isStateInvalied=!0),n){var r,a=null===(r=this._curGPUPipelineState)||void 0===r?void 0:r.gpuPipelineLayout;if(a){for(var o=this._curDynamicOffsets,s=a.dynamicOffsetOffsets[t],c=0;c<n.length;c++)o[s+c]=n[c];this._isStateInvalied=!0}}},n.bindInputAssembler=function(t){var e=t.gpuInputAssembler;this._curGPUInputAssembler=e,this._isStateInvalied=!0},n.setViewport=function(t){var e=this._curDynamicStates.viewport;e.left===t.left&&e.top===t.top&&e.width===t.width&&e.height===t.height&&e.minDepth===t.minDepth&&e.maxDepth===t.maxDepth||(e.left=t.left,e.top=t.top,e.width=t.width,e.height=t.height,e.minDepth=t.minDepth,e.maxDepth=t.maxDepth,this._isStateInvalied=!0)},n.setScissor=function(t){var e=this._curDynamicStates.scissor;e.x===t.x&&e.y===t.y&&e.width===t.width&&e.height===t.height||(e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,this._isStateInvalied=!0)},n.setLineWidth=function(t){this._curDynamicStates.lineWidth!==t&&(this._curDynamicStates.lineWidth=t,this._isStateInvalied=!0)},n.setDepthBias=function(t,e,n){var i=this._curDynamicStates;i.depthBiasConstant===t&&i.depthBiasClamp===e&&i.depthBiasSlope===n||(i.depthBiasConstant=t,i.depthBiasClamp=e,i.depthBiasSlope=n,this._isStateInvalied=!0)},n.setBlendConstants=function(t){var e=this._curDynamicStates.blendConstant;e.x===t.x&&e.y===t.y&&e.z===t.z&&e.w===t.w||(e.copy(t),this._isStateInvalied=!0)},n.setDepthBound=function(t,e){var n=this._curDynamicStates;n.depthMinBounds===t&&n.depthMaxBounds===e||(n.depthMinBounds=t,n.depthMaxBounds=e,this._isStateInvalied=!0)},n.setStencilWriteMask=function(t,e){var n=this._curDynamicStates.stencilStatesFront,i=this._curDynamicStates.stencilStatesBack;t&Xi.FRONT&&n.writeMask!==e&&(n.writeMask=e,this._isStateInvalied=!0),t&Xi.BACK&&i.writeMask!==e&&(i.writeMask=e,this._isStateInvalied=!0)},n.setStencilCompareMask=function(t,e,n){var i=this._curDynamicStates.stencilStatesFront,r=this._curDynamicStates.stencilStatesBack;t&Xi.FRONT&&(i.compareMask===n&&i.reference===e||(i.reference=e,i.compareMask=n,this._isStateInvalied=!0)),t&Xi.BACK&&(r.compareMask===n&&r.reference===e||(r.reference=e,r.compareMask=n,this._isStateInvalied=!0))},n.draw=function(t){if(this._type===Qi.PRIMARY&&this._isInRenderPass||this._type===Qi.SECONDARY){this._isStateInvalied&&this.bindStates();var e="drawInfo"in t?t.drawInfo:t,n=this._cmdAllocator.drawCmdPool.alloc(D7);n.drawInfo.copy(e),this.cmdPackage.drawCmds.push(n),this.cmdPackage.cmds.push(A7.DRAW),++this._numDrawCalls,this._numInstances+=e.instanceCount;var i=e.indexCount||e.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=i/3*Math.max(e.instanceCount,1);break;case 5:case 6:this._numTris+=(i-2)*Math.max(e.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},n.updateBuffer=function(t,e,n){if(this._type===Qi.PRIMARY&&!this._isInRenderPass||this._type===Qi.SECONDARY){var i=t.gpuBuffer;if(i){var r,a=this._cmdAllocator.updateBufferCmdPool.alloc(R7),o=0;t.usage&yi.INDIRECT||(o=void 0!==n?n:e.byteLength),r=e,a.gpuBuffer=i,a.buffer=r,a.offset=0,a.size=o,this.cmdPackage.updateBufferCmds.push(a),this.cmdPackage.cmds.push(A7.UPDATE_BUFFER)}}else console.error("Command 'updateBuffer' must be recorded outside a render pass.")},n.copyBuffersToTexture=function(t,e,n){if(this._type===Qi.PRIMARY&&!this._isInRenderPass||this._type===Qi.SECONDARY){var i=e.gpuTexture;if(i){var r=this._cmdAllocator.copyBufferToTextureCmdPool.alloc(M7);r&&(r.gpuTexture=i,r.regions=n,r.buffers=t,this.cmdPackage.copyBufferToTextureCmds.push(r),this.cmdPackage.cmds.push(A7.COPY_BUFFER_TO_TEXTURE))}}else console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.")},n.execute=function(t,e){for(var n=0;n<e;++n){for(var i=t[n],r=0;r<i.cmdPackage.beginRenderPassCmds.length;++r){var a=i.cmdPackage.beginRenderPassCmds.array[r];++a.refCount,this.cmdPackage.beginRenderPassCmds.push(a)}for(var o=0;o<i.cmdPackage.bindStatesCmds.length;++o){var s=i.cmdPackage.bindStatesCmds.array[o];++s.refCount,this.cmdPackage.bindStatesCmds.push(s)}for(var c=0;c<i.cmdPackage.drawCmds.length;++c){var l=i.cmdPackage.drawCmds.array[c];++l.refCount,this.cmdPackage.drawCmds.push(l)}for(var h=0;h<i.cmdPackage.updateBufferCmds.length;++h){var u=i.cmdPackage.updateBufferCmds.array[h];++u.refCount,this.cmdPackage.updateBufferCmds.push(u)}for(var _=0;_<i.cmdPackage.copyBufferToTextureCmds.length;++_){var f=i.cmdPackage.copyBufferToTextureCmds.array[_];++f.refCount,this.cmdPackage.copyBufferToTextureCmds.push(f)}this.cmdPackage.cmds.concat(i.cmdPackage.cmds.array),this._numDrawCalls+=i._numDrawCalls,this._numInstances+=i._numInstances,this._numTris+=i._numTris}},n.pipelineBarrier=function(){},n.bindStates=function(){var t=this._cmdAllocator.bindStatesCmdPool.alloc(P7);t&&(t.gpuPipelineState=this._curGPUPipelineState,Array.prototype.push.apply(t.gpuDescriptorSets,this._curGPUDescriptorSets),Array.prototype.push.apply(t.dynamicOffsets,this._curDynamicOffsets),t.gpuInputAssembler=this._curGPUInputAssembler,t.dynamicStates.copy(this._curDynamicStates),this.cmdPackage.bindStatesCmds.push(t),this.cmdPackage.cmds.push(A7.BIND_STATES),this._isStateInvalied=!1)},e}(va),Y7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuFramebuffer=null,e}$(e,t);var n=e.prototype;return n.initialize=function(t){this._renderPass=t.renderPass,this._colorTextures=t.colorTextures||[],this._depthStencilTexture=t.depthStencilTexture||null;for(var e=0,n=[],i=0;i<t.colorTextures.length;++i){var r=t.colorTextures[i];r&&(n.push(r.gpuTexture),e=r.lodLevel)}var a=null;t.depthStencilTexture&&(a=t.depthStencilTexture.gpuTexture,e=t.depthStencilTexture.lodLevel);var o=Number.MAX_SAFE_INTEGER,s=Number.MAX_SAFE_INTEGER;this._gpuFramebuffer={gpuRenderPass:t.renderPass.gpuRenderPass,gpuColorTextures:n,gpuDepthStencilTexture:a,glFramebuffer:null,isOffscreen:!0,get width(){return this.isOffscreen?o:this.gpuColorTextures[0].width},set width(t){o=t},get height(){return this.isOffscreen?s:this.gpuColorTextures[0].height},set height(t){s=t},lodLevel:e},function(t,e){for(var n=0;n<e.gpuColorTextures.length;++n)if(e.gpuColorTextures[n].isSwapchainTexture)return void(e.isOffscreen=!1);var i=t.gl,r=[],a=i.createFramebuffer();if(a){e.glFramebuffer=a,t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,e.glFramebuffer);for(var o=0;o<e.gpuColorTextures.length;++o){var s=e.gpuColorTextures[o];s&&(s.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+o,s.glTarget,s.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,i.COLOR_ATTACHMENT0+o,i.RENDERBUFFER,s.glRenderbuffer),r.push(i.COLOR_ATTACHMENT0+o),e.width=Math.min(e.width,s.width),e.height=Math.min(e.height,s.height))}var c=e.gpuDepthStencilTexture;if(c){var l=aa[c.format].hasStencil?i.DEPTH_STENCIL_ATTACHMENT:i.DEPTH_ATTACHMENT;c.glTexture?i.framebufferTexture2D(i.FRAMEBUFFER,l,c.glTarget,c.glTexture,0):i.framebufferRenderbuffer(i.FRAMEBUFFER,l,i.RENDERBUFFER,c.glRenderbuffer),e.width=Math.min(e.width,c.width),e.height=Math.min(e.height,c.height)}t.extensions.WEBGL_draw_buffers&&t.extensions.WEBGL_draw_buffers.drawBuffersWEBGL(r);var h=i.checkFramebufferStatus(i.FRAMEBUFFER);if(h!==i.FRAMEBUFFER_COMPLETE)switch(h){case i.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT");break;case i.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_INCOMPLETE_DIMENSIONS");break;case i.FRAMEBUFFER_UNSUPPORTED:console.error("glCheckFramebufferStatus() - FRAMEBUFFER_UNSUPPORTED")}t.stateCache.glFramebuffer!==e.glFramebuffer&&i.bindFramebuffer(i.FRAMEBUFFER,t.stateCache.glFramebuffer)}}(p7.instance,this._gpuFramebuffer)},n.destroy=function(){var t,e;this._gpuFramebuffer&&(t=p7.instance,(e=this._gpuFramebuffer).glFramebuffer&&(t.gl.deleteFramebuffer(e.glFramebuffer),t.stateCache.glFramebuffer===e.glFramebuffer&&(t.gl.bindFramebuffer(t.gl.FRAMEBUFFER,null),t.stateCache.glFramebuffer=null),e.glFramebuffer=null),this._gpuFramebuffer=null)},Q(e,[{key:"gpuFramebuffer",get:function(){return this._gpuFramebuffer}}]),e}(xa),K7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuInputAssembler=null,e}$(e,t);var n=e.prototype;return n.initialize=function(t){if(0!==t.vertexBuffers.length){if(this._attributes=t.attributes,this._attributesHash=this.computeAttributesHash(),this._vertexBuffers=t.vertexBuffers,t.indexBuffer)this._indexBuffer=t.indexBuffer,this._drawInfo.indexCount=this._indexBuffer.size/this._indexBuffer.stride,this._drawInfo.firstIndex=0;else{var e=this._vertexBuffers[0];this._drawInfo.vertexCount=e.size/e.stride,this._drawInfo.firstVertex=0,this._drawInfo.vertexOffset=0}this._drawInfo.instanceCount=0,this._drawInfo.firstInstance=0,this._indirectBuffer=t.indirectBuffer||null;for(var n=new Array(t.vertexBuffers.length),i=0;i<t.vertexBuffers.length;++i){var r=t.vertexBuffers[i];r.gpuBuffer&&(n[i]=r.gpuBuffer)}var a=null,o=0;if(t.indexBuffer&&(a=t.indexBuffer.gpuBuffer))switch(a.stride){case 1:o=5121;break;case 2:o=5123;break;case 4:o=5125;break;default:console.error("Error index buffer stride.")}var s=null;t.indirectBuffer&&(s=t.indirectBuffer.gpuBuffer),this._gpuInputAssembler={attributes:t.attributes,gpuVertexBuffers:n,gpuIndexBuffer:a,gpuIndirectBuffer:s,glAttribs:[],glIndexType:o,glVAOs:new Map},function(t,e){var n=t.gl;e.glAttribs=new Array(e.attributes.length);for(var i=[0,0,0,0,0,0,0,0],r=0;r<e.attributes.length;++r){var a=e.attributes[r],o=void 0!==a.stream?a.stream:0,s=e.gpuVertexBuffers[o],c=m7(a.format,n),l=aa[a.format].size;e.glAttribs[r]={name:a.name,glBuffer:s.glBuffer,glType:c,size:l,count:aa[a.format].count,stride:s.stride,componentCount:S7(c,n),isNormalized:void 0!==a.isNormalized&&a.isNormalized,isInstanced:void 0!==a.isInstanced&&a.isInstanced,offset:i[o]},i[o]+=l}}(p7.instance,this._gpuInputAssembler)}else console.error("InputAssemblerInfo.vertexBuffers is null.")},n.destroy=function(){var t=p7.instance;this._gpuInputAssembler&&t.extensions.useVAO&&function(t,e){for(var n=e.glVAOs.values(),i=n.next(),r=t.extensions.OES_vertex_array_object,a=t.stateCache.glVAO;!i.done;)r.deleteVertexArrayOES(i.value),a===i.value&&(r.bindVertexArrayOES(null),a=null),i=n.next();t.stateCache.glVAO=a,e.glVAOs.clear()}(t,this._gpuInputAssembler),this._gpuInputAssembler=null},Q(e,[{key:"gpuInputAssembler",get:function(){return this._gpuInputAssembler}}]),e}(Ca),J7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuDescriptorSetLayout=null,e}$(e,t);var n=e.prototype;return n.initialize=function(t){Array.prototype.push.apply(this._bindings,t.bindings);for(var e=0,n=-1,i=[],r=0;r<this._bindings.length;r++){var a=this._bindings[r];i.push(e),e+=a.count,a.binding>n&&(n=a.binding)}this._bindingIndices=Array(n+1).fill(-1);for(var o=this._descriptorIndices=Array(n+1).fill(-1),s=0;s<this._bindings.length;s++){var c=this._bindings[s];this._bindingIndices[c.binding]=s,o[c.binding]=i[s]}for(var l=[],h=0;h<this._bindings.length;h++){var u=this._bindings[h];if(u.descriptorType&ca)for(var _=0;_<u.count;_++)l.push(u.binding)}this._gpuDescriptorSetLayout={bindings:this._bindings,dynamicBindings:l,descriptorIndices:o,descriptorCount:e}},n.destroy=function(){this._bindings.length=0},Q(e,[{key:"gpuDescriptorSetLayout",get:function(){return this._gpuDescriptorSetLayout}}]),e}(Ea),Q7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuPipelineLayout=null,e}$(e,t);var n=e.prototype;return n.initialize=function(t){Array.prototype.push.apply(this._setLayouts,t.setLayouts);for(var e=[],n=[],i=0,r=[],a=0;a<this._setLayouts.length;a++){for(var o=this._setLayouts[a],s=o.gpuDescriptorSetLayout.dynamicBindings,c=Array(o.bindingIndices.length).fill(-1),l=0;l<s.length;l++){var h=s[l];c[h]<0&&(c[h]=i+l)}n.push(o.gpuDescriptorSetLayout),e.push(c),r.push(i),i+=s.length}this._gpuPipelineLayout={gpuSetLayouts:n,dynamicOffsetIndices:e,dynamicOffsetCount:i,dynamicOffsetOffsets:r}},n.destroy=function(){this._setLayouts.length=0},Q(e,[{key:"gpuPipelineLayout",get:function(){return this._gpuPipelineLayout}}]),e}(wa),Z7=[0,1,3,2,0,0,0,4,5,6,0,0,0,0],$7=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuPipelineState=null,e}$(e,t);var n=e.prototype;return n.initialize=function(t){this._primitive=t.primitive,this._shader=t.shader,this._pipelineLayout=t.pipelineLayout;var e=this._bs;if(t.blendState){var n=t.blendState,i=n.targets;i&&i.forEach((function(t,n){e.setTarget(n,t)})),void 0!==n.isA2C&&(e.isA2C=n.isA2C),void 0!==n.isIndepend&&(e.isIndepend=n.isIndepend),void 0!==n.blendColor&&(e.blendColor=n.blendColor)}Object.assign(this._rs,t.rasterizerState),Object.assign(this._dss,t.depthStencilState),this._is=t.inputState,this._renderPass=t.renderPass,this._dynamicStates=t.dynamicStates;for(var r=[],a=0;a<31;a++)this._dynamicStates&1<<a&&r.push(1<<a);this._gpuPipelineState={glPrimitive:Z7[t.primitive],gpuShader:t.shader.gpuShader,gpuPipelineLayout:t.pipelineLayout.gpuPipelineLayout,rs:t.rasterizerState,dss:t.depthStencilState,bs:t.blendState,gpuRenderPass:t.renderPass.gpuRenderPass,dynamicStates:r}},n.destroy=function(){this._gpuPipelineState=null},Q(e,[{key:"gpuPipelineState",get:function(){return this._gpuPipelineState}}]),e}(Oa),t9=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.beginRenderPass=function(t,e,n,i,r,a){F7(p7.instance,t.gpuRenderPass,e.gpuFramebuffer,n,i,r,a),this._isInRenderPass=!0},n.draw=function(t){if(this._isInRenderPass){this._isStateInvalied&&this.bindStates();var e="drawInfo"in t?t.drawInfo:t;z7(p7.instance,e),++this._numDrawCalls,this._numInstances+=e.instanceCount;var n=e.indexCount||e.vertexCount;if(this._curGPUPipelineState)switch(this._curGPUPipelineState.glPrimitive){case 4:this._numTris+=n/3*Math.max(e.instanceCount,1);break;case 5:case 6:this._numTris+=(n-2)*Math.max(e.instanceCount,1)}}else console.error("Command 'draw' must be recorded inside a render pass.")},n.setViewport=function(t){var e=p7.instance,n=e.stateCache,i=e.gl;n.viewport.left===t.left&&n.viewport.top===t.top&&n.viewport.width===t.width&&n.viewport.height===t.height||(i.viewport(t.left,t.top,t.width,t.height),n.viewport.left=t.left,n.viewport.top=t.top,n.viewport.width=t.width,n.viewport.height=t.height)},n.setScissor=function(t){var e=p7.instance,n=e.stateCache,i=e.gl;n.scissorRect.x===t.x&&n.scissorRect.y===t.y&&n.scissorRect.width===t.width&&n.scissorRect.height===t.height||(i.scissor(t.x,t.y,t.width,t.height),n.scissorRect.x=t.x,n.scissorRect.y=t.y,n.scissorRect.width=t.width,n.scissorRect.height=t.height)},n.updateBuffer=function(t,e,n){if(this._isInRenderPass)console.error("Command 'updateBuffer' must be recorded outside a render pass.");else{var i,r=t.gpuBuffer;r&&(i=void 0!==n?n:t.usage&yi.INDIRECT?0:e.byteLength,N7(p7.instance,r,e,0,i))}},n.copyBuffersToTexture=function(t,e,n){if(this._isInRenderPass)console.error("Command 'copyBufferToTexture' must be recorded outside a render pass.");else{var i=e.gpuTexture;i&&G7(p7.instance,t,i,n)}},n.execute=function(t,e){for(var n=0;n<e;++n){var i=t[n];U7(p7.instance,i.cmdPackage),this._numDrawCalls+=i._numDrawCalls,this._numInstances+=i._numInstances,this._numTris+=i._numTris}},n.bindStates=function(){V7(p7.instance,this._curGPUPipelineState,this._curGPUInputAssembler,this._curGPUDescriptorSets,this._curDynamicOffsets,this._curDynamicStates),this._isStateInvalied=!1},e}(X7),e9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).numDrawCalls=0,e.numInstances=0,e.numTris=0,e}$(e,t);var n=e.prototype;return n.initialize=function(t){this._type=t.type},n.destroy=function(){},n.submit=function(t){for(var e=t.length,n=0;n<e;n++){var i=t[n];this.numDrawCalls+=i.numDrawCalls,this.numInstances+=i.numInstances,this.numTris+=i.numTris}},n.clear=function(){this.numDrawCalls=0,this.numInstances=0,this.numTris=0},e}(Na),n9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuRenderPass=null,e}$(e,t);var n=e.prototype;return n.initialize=function(t){this._colorInfos=t.colorAttachments,this._depthStencilInfo=t.depthStencilAttachment,this._subpasses=t.subpasses,this._gpuRenderPass={colorAttachments:this._colorInfos,depthStencilAttachment:this._depthStencilInfo},this._hash=this.computeHash()},n.destroy=function(){this._gpuRenderPass=null},Q(e,[{key:"gpuRenderPass",get:function(){return this._gpuRenderPass}}]),e}(Ba),i9=[10497,33648,33071,33071],r9=function(t){function e(e,n){var i;(i=t.call(this,e,n)||this)._gpuSampler=null;var r,a,o=i._info.minFilter,s=i._info.magFilter,c=i._info.mipFilter;r=o===Pi.LINEAR||o===Pi.ANISOTROPIC?c===Pi.LINEAR||c===Pi.ANISOTROPIC?9987:c===Pi.POINT?9985:9729:c===Pi.LINEAR||c===Pi.ANISOTROPIC?9986:c===Pi.POINT?9984:9728,a=s===Pi.LINEAR||s===Pi.ANISOTROPIC?9729:9728;var l=i9[i._info.addressU],h=i9[i._info.addressV],u=i9[i._info.addressW];return i._gpuSampler={glMinFilter:r,glMagFilter:a,glWrapS:l,glWrapT:h,glWrapR:u},i}return $(e,t),Q(e,[{key:"gpuSampler",get:function(){return this._gpuSampler}}]),e}(La),a9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuShader=null,e}$(e,t);var n=e.prototype;return n.initialize=function(t){this._name=t.name,this._stages=t.stages,this._attributes=t.attributes,this._blocks=t.blocks,this._samplers=t.samplers,this._gpuShader={name:t.name,blocks:t.blocks.slice(),samplerTextures:t.samplerTextures.slice(),subpassInputs:t.subpassInputs.slice(),gpuStages:new Array(t.stages.length),glProgram:null,glInputs:[],glUniforms:[],glBlocks:[],glSamplerTextures:[]};for(var e=0;e<t.stages.length;++e){var n=t.stages[e];this._gpuShader.gpuStages[e]={type:n.stage,source:n.source,glShader:null}}!function(t,e){for(var n=t.gl,i=function(t){var i=e.gpuStages[t],r=0,a="",o=1;switch(i.type){case Li.VERTEX:a="VertexShader",r=n.VERTEX_SHADER;break;case Li.FRAGMENT:a="FragmentShader",r=n.FRAGMENT_SHADER;break;default:return console.error("Unsupported ShaderType."),{v:void 0}}var s=n.createShader(r);if(s&&(i.glShader=s,n.shaderSource(i.glShader,i.source),n.compileShader(i.glShader),!n.getShaderParameter(i.glShader,n.COMPILE_STATUS))){console.error(a+" in '"+e.name+"' compilation failed."),console.error("Shader source dump:",i.source.replace(/^|\n/g,(function(){return"\n"+o+++" "}))),console.error(n.getShaderInfoLog(i.glShader));for(var c=0;c<e.gpuStages.length;c++){var l=e.gpuStages[t];l.glShader&&(n.deleteShader(l.glShader),l.glShader=null)}return{v:void 0}}},r=0;r<e.gpuStages.length;r++){var a=i(r);if("object"==typeof a)return a.v}var o=n.createProgram();if(o){e.glProgram=o;for(var s=0;s<e.gpuStages.length;s++){var c=e.gpuStages[s];n.attachShader(e.glProgram,c.glShader)}if(n.linkProgram(e.glProgram),t.extensions.destroyShadersImmediately)for(var l=0;l<e.gpuStages.length;l++){var h=e.gpuStages[l];h.glShader&&(n.detachShader(e.glProgram,h.glShader),n.deleteShader(h.glShader),h.glShader=null)}if(!n.getProgramParameter(e.glProgram,n.LINK_STATUS))return console.error("Failed to link shader '"+e.name+"'."),void console.error(n.getProgramInfoLog(e.glProgram));C("Shader '"+e.name+"' compilation succeeded.");var u=n.getProgramParameter(e.glProgram,n.ACTIVE_ATTRIBUTES);e.glInputs=new Array(u);for(var _=0;_<u;++_){var f=n.getActiveAttrib(e.glProgram,_);if(f){var d,p=f.name.indexOf("[");d=-1!==p?f.name.substr(0,p):f.name;var m=n.getAttribLocation(e.glProgram,d),v=y7(f.type,n),g=x7(f.type,n);e.glInputs[_]={binding:m,name:d,type:v,stride:g,count:f.size,size:g*f.size,glType:f.type,glLoc:m}}}if(e.blocks.length>0){e.glBlocks=new Array(e.blocks.length);for(var y=0;y<e.blocks.length;++y){var x=e.blocks[y],S={set:x.set,binding:x.binding,name:x.name,size:0,glUniforms:new Array(x.members.length),glActiveUniforms:[]};e.glBlocks[y]=S;for(var A=0;A<x.members.length;++A){var b=x.members[A],T=v7(b.type,n),E=x7(T,n),w=E*b.count;S.glUniforms[A]={binding:-1,name:b.name,type:b.type,stride:E,count:b.count,size:w,offset:0,glType:T,glLoc:null,array:null}}}}for(var I=0;I<e.subpassInputs.length;++I){var P=e.subpassInputs[I];e.samplerTextures.push(new Ir(P.set,P.binding,P.name,gi.SAMPLER2D,P.count))}if(e.samplerTextures.length>0){e.glSamplerTextures=new Array(e.samplerTextures.length);for(var D=0;D<e.samplerTextures.length;++D){var R=e.samplerTextures[D];e.glSamplerTextures[D]={set:R.set,binding:R.binding,name:R.name,type:R.type,count:R.count,units:[],glUnits:null,glType:v7(R.type,n),glLoc:null}}}for(var M=n.getProgramParameter(e.glProgram,n.ACTIVE_UNIFORMS),O=0;O<M;++O){var N=n.getActiveUniform(e.glProgram,O);if(N&&N.type!==n.SAMPLER_2D&&N.type!==n.SAMPLER_CUBE){var B=n.getUniformLocation(e.glProgram,N.name);if(t.extensions.isLocationActive(B)){var L,F=N.name.indexOf("[");L=-1!==F?N.name.substr(0,F):N.name;for(var V=0;V<e.glBlocks.length;V++)for(var z=e.glBlocks[V],k=0;k<z.glUniforms.length;k++){var U=z.glUniforms[k];if(U.name===L){U.glLoc=B,U.count=N.size,U.size=U.stride*U.count,U.array=new(g7(U.type))(U.size/4),z.glActiveUniforms.push(U);break}}}}}for(var G=0;G<e.glBlocks.length;G++)for(var H=e.glBlocks[G],j=0;j<H.glUniforms.length;j++){var W=H.glUniforms[j];W.offset=H.size/4,H.size+=W.size}for(var q=[],X=[],Y=t.bindingMappings,K=t.stateCache.texUnitCacheMap,J=0,Q=0;Q<e.blocks.length;++Q)e.blocks[Q].set===Y.flexibleSet&&J++;for(var Z=0,$=0;$<e.samplerTextures.length;++$){var tt=e.samplerTextures[$],et=n.getUniformLocation(e.glProgram,tt.name);if(t.extensions.isLocationActive(et)&&(q.push(e.glSamplerTextures[$]),X.push(et)),void 0===K[tt.name]){var nt=tt.binding+Y.samplerTextureOffsets[tt.set]+Z;tt.set===Y.flexibleSet&&(nt-=J),K[tt.name]=nt%t.capabilities.maxTextureUnits,Z+=tt.count-1}}if(q.length){for(var it=[],rt=0;rt<q.length;++rt){var at=q[rt],ot=K[at.name];if(void 0!==ot){at.glLoc=X[rt];for(var st=0;st<at.count;++st){for(;it[ot];)ot=(ot+1)%t.capabilities.maxTextureUnits;at.units.push(ot),it[ot]=!0}}}for(var ct=0,lt=0;lt<q.length;++lt){var ht=q[lt];if(!t.extensions.isLocationActive(ht.glLoc)){ht.glLoc=X[lt];for(var ut=0;ut<ht.count;++ut){for(;it[ct];)ct=(ct+1)%t.capabilities.maxTextureUnits;void 0===K[ht.name]&&(K[ht.name]=ct),ht.units.push(ct),it[ct]=!0}}}t.stateCache.glProgram!==e.glProgram&&n.useProgram(e.glProgram);for(var _t=0;_t<q.length;_t++){var ft=q[_t];ft.glUnits=new Int32Array(ft.units),n.uniform1iv(ft.glLoc,ft.glUnits)}t.stateCache.glProgram!==e.glProgram&&n.useProgram(t.stateCache.glProgram)}for(var dt=0;dt<e.glBlocks.length;)e.glBlocks[dt].glActiveUniforms.length?dt++:(e.glBlocks[dt]=e.glBlocks[e.glBlocks.length-1],e.glBlocks.length--);e.glSamplerTextures=q}}(p7.instance,this._gpuShader)},n.destroy=function(){this._gpuShader&&(function(t,e){if(e.glProgram){var n=t.gl;if(!t.extensions.destroyShadersImmediately)for(var i=0;i<e.gpuStages.length;i++){var r=e.gpuStages[i];r.glShader&&(n.detachShader(e.glProgram,r.glShader),n.deleteShader(r.glShader),r.glShader=null)}n.deleteProgram(e.glProgram),t.stateCache.glProgram===e.glProgram&&(t.gl.useProgram(null),t.stateCache.glProgram=null),e.glProgram=null}}(p7.instance,this._gpuShader),this._gpuShader=null)},Q(e,[{key:"gpuShader",get:function(){return this._gpuShader}}]),e}(Fa),o9=function(){function t(){this.glArrayBuffer=null,this.glElementArrayBuffer=null,this.glVAO=null,this.texUnit=0,this.glTexUnits=[],this.glRenderbuffer=null,this.glFramebuffer=null,this.viewport=new fr,this.scissorRect=new or(0,0,0,0),this.rs=new Ia,this.dss=new Pa,this.bs=new Ra,this.glProgram=null,this.glEnabledAttribLocs=[],this.glCurrentAttribLocs=[],this.texUnitCacheMap={}}return t.prototype.initialize=function(t,e){for(var n=0;n<t;++n)this.glTexUnits.push({glTexture:null});this.glEnabledAttribLocs.length=e,this.glEnabledAttribLocs.fill(!1),this.glCurrentAttribLocs.length=e,this.glCurrentAttribLocs.fill(!1)},t}(),s9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._gpuTexture=null,e._lodLevel=0,e}$(e,t);var n=e.prototype;return n.initialize=function(t,e){var n=t,i=t;"texture"in t&&(n=i.texture.info,this._isTextureView=!0),this._info.copy(n),this._isPowerOf2=la(this._info.width)&&la(this._info.height),this._size=ua(this._info.format,this.width,this.height,this.depth,this._info.levelCount)*this._info.layerCount,this._isTextureView?(this._viewInfo.copy(i),this._lodLevel=i.baseLevel,this._gpuTexture=i.texture._gpuTexture):(this._gpuTexture={type:n.type,format:n.format,usage:n.usage,width:n.width,height:n.height,depth:n.depth,size:this._size,arrayLayer:n.layerCount,mipLevel:n.levelCount,samples:n.samples,flags:n.flags,isPowerOf2:this._isPowerOf2,glTarget:0,glInternalFmt:0,glFormat:0,glType:0,glUsage:0,glTexture:null,glRenderbuffer:null,glWrapS:0,glWrapT:0,glMinFilter:0,glMagFilter:0,isSwapchainTexture:e||!1},function(t,e){var n=t.gl;e.glFormat=e.glInternalFmt=function(t,e){switch(t){case mi.A8:return e.ALPHA;case mi.L8:return e.LUMINANCE;case mi.LA8:return e.LUMINANCE_ALPHA;case mi.RGB8:case mi.RGB16F:case mi.RGB32F:return e.RGB;case mi.BGRA8:case mi.RGBA8:case mi.SRGB8_A8:case mi.RGBA16F:case mi.RGBA32F:return e.RGBA;case mi.R5G6B5:return e.RGB;case mi.RGB5A1:case mi.RGBA4:return e.RGBA;case mi.DEPTH:return e.DEPTH_COMPONENT;case mi.DEPTH_STENCIL:return e.DEPTH_STENCIL;case mi.BC1:return f7.COMPRESSED_RGB_S3TC_DXT1_EXT;case mi.BC1_ALPHA:return f7.COMPRESSED_RGBA_S3TC_DXT1_EXT;case mi.BC1_SRGB:return f7.COMPRESSED_SRGB_S3TC_DXT1_EXT;case mi.BC1_SRGB_ALPHA:return f7.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case mi.BC2:return f7.COMPRESSED_RGBA_S3TC_DXT3_EXT;case mi.BC2_SRGB:return f7.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case mi.BC3:return f7.COMPRESSED_RGBA_S3TC_DXT5_EXT;case mi.BC3_SRGB:return f7.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case mi.ETC_RGB8:return f7.COMPRESSED_RGB_ETC1_WEBGL;case mi.ETC2_RGB8:return f7.COMPRESSED_RGB8_ETC2;case mi.ETC2_SRGB8:return f7.COMPRESSED_SRGB8_ETC2;case mi.ETC2_RGB8_A1:return f7.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2;case mi.ETC2_SRGB8_A1:return f7.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2;case mi.ETC2_RGBA8:return f7.COMPRESSED_RGBA8_ETC2_EAC;case mi.ETC2_SRGB8_A8:return f7.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC;case mi.EAC_R11:return f7.COMPRESSED_R11_EAC;case mi.EAC_R11SN:return f7.COMPRESSED_SIGNED_R11_EAC;case mi.EAC_RG11:return f7.COMPRESSED_RG11_EAC;case mi.EAC_RG11SN:return f7.COMPRESSED_SIGNED_RG11_EAC;case mi.PVRTC_RGB2:return f7.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;case mi.PVRTC_RGBA2:return f7.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG;case mi.PVRTC_RGB4:return f7.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;case mi.PVRTC_RGBA4:return f7.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;case mi.ASTC_RGBA_4X4:return f7.COMPRESSED_RGBA_ASTC_4x4_KHR;case mi.ASTC_RGBA_5X4:return f7.COMPRESSED_RGBA_ASTC_5x4_KHR;case mi.ASTC_RGBA_5X5:return f7.COMPRESSED_RGBA_ASTC_5x5_KHR;case mi.ASTC_RGBA_6X5:return f7.COMPRESSED_RGBA_ASTC_6x5_KHR;case mi.ASTC_RGBA_6X6:return f7.COMPRESSED_RGBA_ASTC_6x6_KHR;case mi.ASTC_RGBA_8X5:return f7.COMPRESSED_RGBA_ASTC_8x5_KHR;case mi.ASTC_RGBA_8X6:return f7.COMPRESSED_RGBA_ASTC_8x6_KHR;case mi.ASTC_RGBA_8X8:return f7.COMPRESSED_RGBA_ASTC_8x8_KHR;case mi.ASTC_RGBA_10X5:return f7.COMPRESSED_RGBA_ASTC_10x5_KHR;case mi.ASTC_RGBA_10X6:return f7.COMPRESSED_RGBA_ASTC_10x6_KHR;case mi.ASTC_RGBA_10X8:return f7.COMPRESSED_RGBA_ASTC_10x8_KHR;case mi.ASTC_RGBA_10X10:return f7.COMPRESSED_RGBA_ASTC_10x10_KHR;case mi.ASTC_RGBA_12X10:return f7.COMPRESSED_RGBA_ASTC_12x10_KHR;case mi.ASTC_RGBA_12X12:return f7.COMPRESSED_RGBA_ASTC_12x12_KHR;case mi.ASTC_SRGBA_4X4:return f7.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR;case mi.ASTC_SRGBA_5X4:return f7.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR;case mi.ASTC_SRGBA_5X5:return f7.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR;case mi.ASTC_SRGBA_6X5:return f7.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR;case mi.ASTC_SRGBA_6X6:return f7.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR;case mi.ASTC_SRGBA_8X5:return f7.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR;case mi.ASTC_SRGBA_8X6:return f7.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR;case mi.ASTC_SRGBA_8X8:return f7.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR;case mi.ASTC_SRGBA_10X5:return f7.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR;case mi.ASTC_SRGBA_10X6:return f7.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR;case mi.ASTC_SRGBA_10X8:return f7.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR;case mi.ASTC_SRGBA_10X10:return f7.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR;case mi.ASTC_SRGBA_12X10:return f7.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR;case mi.ASTC_SRGBA_12X12:return f7.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR;default:return console.error("Unsupported Format, convert to WebGL format failed."),e.RGBA}}(e.format,n),e.glType=m7(e.format,n);var i=e.width,r=e.height;switch(e.type){case bi.TEX2D:if(e.glTarget=n.TEXTURE_2D,e.isSwapchainTexture)break;var a=Math.max(i,r);if(a>t.capabilities.maxTextureSize&&O(9100,a,t.capabilities.maxTextureSize),t.textureExclusive[e.format]||t.extensions.WEBGL_depth_texture||!aa[e.format].hasDepth){if(e.glTexture=n.createTexture(),e.size>0){var o=t.stateCache.glTexUnits[t.stateCache.texUnit];if(o.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_2D,e.glTexture),o.glTexture=e.glTexture),aa[e.format].isCompressed)for(var s=0;s<e.mipLevel;++s){var c=ha(e.format,i,r,1),l=new Uint8Array(c);n.compressedTexImage2D(n.TEXTURE_2D,s,e.glInternalFmt,i,r,0,l),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}else for(var h=0;h<e.mipLevel;++h)n.texImage2D(n.TEXTURE_2D,h,e.glInternalFmt,i,r,0,e.glFormat,e.glType,null),i=Math.max(1,i>>1),r=Math.max(1,r>>1);e.isPowerOf2?(e.glWrapS=n.REPEAT,e.glWrapT=n.REPEAT):(e.glWrapS=n.CLAMP_TO_EDGE,e.glWrapT=n.CLAMP_TO_EDGE),e.glMinFilter=n.LINEAR,e.glMagFilter=n.LINEAR,n.texParameteri(e.glTarget,n.TEXTURE_WRAP_S,e.glWrapS),n.texParameteri(e.glTarget,n.TEXTURE_WRAP_T,e.glWrapT),n.texParameteri(e.glTarget,n.TEXTURE_MIN_FILTER,e.glMinFilter),n.texParameteri(e.glTarget,n.TEXTURE_MAG_FILTER,e.glMagFilter)}}else e.glInternalFmt=function(t,e){switch(t){case mi.R5G6B5:return e.RGB565;case mi.RGB5A1:return e.RGB5_A1;case mi.RGBA4:return e.RGBA4;case mi.RGBA16F:return f7.RGBA16F_EXT;case mi.RGBA32F:return f7.RGBA32F_EXT;case mi.SRGB8_A8:return f7.SRGB8_ALPHA8_EXT;case mi.DEPTH:return e.DEPTH_COMPONENT16;case mi.DEPTH_STENCIL:return e.DEPTH_STENCIL;default:return console.error("Unsupported Format, convert to WebGL internal format failed."),e.RGBA}}(e.format,n),e.glRenderbuffer=n.createRenderbuffer(),e.size>0&&(t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),n.renderbufferStorage(n.RENDERBUFFER,e.glInternalFmt,i,r));break;case bi.CUBE:e.glTarget=n.TEXTURE_CUBE_MAP;var u=Math.max(i,r);if(u>t.capabilities.maxCubeMapTextureSize&&O(9100,u,t.capabilities.maxTextureSize),e.glTexture=n.createTexture(),e.size>0){var _=t.stateCache.glTexUnits[t.stateCache.texUnit];if(_.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_CUBE_MAP,e.glTexture),_.glTexture=e.glTexture),aa[e.format].isCompressed)for(var f=0;f<6;++f){i=e.width,r=e.height;for(var d=0;d<e.mipLevel;++d){var p=ha(e.format,i,r,1),m=new Uint8Array(p);n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+f,d,e.glInternalFmt,i,r,0,m),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}}else for(var v=0;v<6;++v){i=e.width,r=e.height;for(var g=0;g<e.mipLevel;++g)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+v,g,e.glInternalFmt,i,r,0,e.glFormat,e.glType,null),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}e.isPowerOf2?(e.glWrapS=n.REPEAT,e.glWrapT=n.REPEAT):(e.glWrapS=n.CLAMP_TO_EDGE,e.glWrapT=n.CLAMP_TO_EDGE),e.glMinFilter=n.LINEAR,e.glMagFilter=n.LINEAR,n.texParameteri(e.glTarget,n.TEXTURE_WRAP_S,e.glWrapS),n.texParameteri(e.glTarget,n.TEXTURE_WRAP_T,e.glWrapT),n.texParameteri(e.glTarget,n.TEXTURE_MIN_FILTER,e.glMinFilter),n.texParameteri(e.glTarget,n.TEXTURE_MAG_FILTER,e.glMagFilter)}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=bi.TEX2D,e.glTarget=n.TEXTURE_2D}}(p7.instance,this._gpuTexture),p7.instance.memoryStatus.textureSize+=this._size,this._viewInfo.texture=this,this._viewInfo.type=t.type,this._viewInfo.format=t.format,this._viewInfo.baseLevel=0,this._viewInfo.levelCount=t.levelCount,this._viewInfo.baseLayer=0,this._viewInfo.layerCount=t.layerCount)},n.destroy=function(){!this._isTextureView&&this._gpuTexture&&(function(t,e){var n=t.gl;if(e.glTexture){var i=t.stateCache.glTexUnits,r=t.stateCache.texUnit;n.deleteTexture(e.glTexture);for(var a=0;a<i.length;a++)i[a].glTexture===e.glTexture&&(n.activeTexture(n.TEXTURE0+a),r=a,n.bindTexture(e.glTarget,null),i[a].glTexture=null);t.stateCache.texUnit=r,e.glTexture=null}if(e.glRenderbuffer){var o=t.stateCache.glRenderbuffer;n.deleteRenderbuffer(e.glRenderbuffer),o===e.glRenderbuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,null),o=null),e.glRenderbuffer=null}}(p7.instance,this._gpuTexture),p7.instance.memoryStatus.textureSize-=this._size,this._gpuTexture=null)},n.resize=function(t,n){if(this._info.width!==t||this._info.height!==n){this._info.levelCount===e.getLevelCount(this._info.width,this._info.height)?this._info.levelCount=e.getLevelCount(t,n):this._info.levelCount>1&&(this._info.levelCount=Math.min(this._info.levelCount,e.getLevelCount(t,n)));var i=this._size;this._info.width=t,this._info.height=n,this._size=ua(this._info.format,this.width,this.height,this.depth,this._info.levelCount)*this._info.layerCount,!this._isTextureView&&this._gpuTexture&&(this._gpuTexture.width=t,this._gpuTexture.height=n,this._gpuTexture.size=this._size,function(t,e){if(e.size){var n=t.gl,i=e.width,r=e.height;switch(e.type){case bi.TEX2D:e.glTarget=n.TEXTURE_2D;var a=Math.max(i,r);if(a>t.capabilities.maxTextureSize&&O(9100,a,t.capabilities.maxTextureSize),e.glRenderbuffer)t.stateCache.glRenderbuffer!==e.glRenderbuffer&&(n.bindRenderbuffer(n.RENDERBUFFER,e.glRenderbuffer),t.stateCache.glRenderbuffer=e.glRenderbuffer),n.renderbufferStorage(n.RENDERBUFFER,e.glInternalFmt,i,r);else if(e.glTexture){var o=t.stateCache.glTexUnits[t.stateCache.texUnit];if(o.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_2D,e.glTexture),o.glTexture=e.glTexture),aa[e.format].isCompressed)for(var s=0;s<e.mipLevel;++s){var c=ha(e.format,i,r,1),l=new Uint8Array(c);n.compressedTexImage2D(n.TEXTURE_2D,s,e.glInternalFmt,i,r,0,l),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}else for(var h=0;h<e.mipLevel;++h)n.texImage2D(n.TEXTURE_2D,h,e.glInternalFmt,i,r,0,e.glFormat,e.glType,null),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}break;case bi.CUBE:e.glTarget=n.TEXTURE_CUBE_MAP;var u=Math.max(i,r);u>t.capabilities.maxCubeMapTextureSize&&O(9100,u,t.capabilities.maxTextureSize);var _=t.stateCache.glTexUnits[t.stateCache.texUnit];if(_.glTexture!==e.glTexture&&(n.bindTexture(n.TEXTURE_CUBE_MAP,e.glTexture),_.glTexture=e.glTexture),aa[e.format].isCompressed)for(var f=0;f<6;++f){i=e.width,r=e.height;for(var d=0;d<e.mipLevel;++d){var p=ha(e.format,i,r,1),m=new Uint8Array(p);n.compressedTexImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+f,d,e.glInternalFmt,i,r,0,m),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}}else for(var v=0;v<6;++v){i=e.width,r=e.height;for(var g=0;g<e.mipLevel;++g)n.texImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+v,g,e.glInternalFmt,i,r,0,e.glFormat,e.glType,null),i=Math.max(1,i>>1),r=Math.max(1,r>>1)}break;default:console.error("Unsupported TextureType, create texture failed."),e.type=bi.TEX2D,e.glTarget=n.TEXTURE_2D}}}(p7.instance,this._gpuTexture),p7.instance.memoryStatus.textureSize-=i,p7.instance.memoryStatus.textureSize+=this._size)}},n.initAsSwapchainTexture=function(t){var e=new br;e.format=t.format,e.usage=aa[t.format].hasDepth?Ci.DEPTH_STENCIL_ATTACHMENT:Ci.COLOR_ATTACHMENT,e.width=t.width,e.height=t.height,this.initialize(e,!0)},Q(e,[{key:"gpuTexture",get:function(){return this._gpuTexture}},{key:"lodLevel",get:function(){return this._lodLevel}}]),e}(Va),c9="webglcontextlost";function l9(t,e){for(var n=["","WEBKIT_","MOZ_"],i=0;i<n.length;++i){var r=t.getExtension(n[i]+e);if(r)return r}return null}function h9(t){var e={EXT_texture_filter_anisotropic:l9(t,"EXT_texture_filter_anisotropic"),EXT_blend_minmax:l9(t,"EXT_blend_minmax"),EXT_frag_depth:l9(t,"EXT_frag_depth"),EXT_shader_texture_lod:l9(t,"EXT_shader_texture_lod"),EXT_sRGB:l9(t,"EXT_sRGB"),OES_vertex_array_object:l9(t,"OES_vertex_array_object"),EXT_color_buffer_half_float:l9(t,"EXT_color_buffer_half_float"),WEBGL_color_buffer_float:l9(t,"WEBGL_color_buffer_float"),WEBGL_compressed_texture_etc1:l9(t,"WEBGL_compressed_texture_etc1"),WEBGL_compressed_texture_etc:l9(t,"WEBGL_compressed_texture_etc"),WEBGL_compressed_texture_pvrtc:l9(t,"WEBGL_compressed_texture_pvrtc"),WEBGL_compressed_texture_s3tc:l9(t,"WEBGL_compressed_texture_s3tc"),WEBGL_compressed_texture_s3tc_srgb:l9(t,"WEBGL_compressed_texture_s3tc_srgb"),WEBGL_debug_shaders:l9(t,"WEBGL_debug_shaders"),WEBGL_draw_buffers:l9(t,"WEBGL_draw_buffers"),WEBGL_lose_context:l9(t,"WEBGL_lose_context"),WEBGL_depth_texture:l9(t,"WEBGL_depth_texture"),OES_texture_half_float:l9(t,"OES_texture_half_float"),OES_texture_half_float_linear:l9(t,"OES_texture_half_float_linear"),OES_texture_float:l9(t,"OES_texture_float"),OES_texture_float_linear:l9(t,"OES_texture_float_linear"),OES_standard_derivatives:l9(t,"OES_standard_derivatives"),OES_element_index_uint:l9(t,"OES_element_index_uint"),ANGLE_instanced_arrays:l9(t,"ANGLE_instanced_arrays"),WEBGL_debug_renderer_info:l9(t,"WEBGL_debug_renderer_info"),WEBGL_multi_draw:null,WEBGL_compressed_texture_astc:null,destroyShadersImmediately:!0,noCompressedTexSubImage2D:!1,isLocationActive:function(t){return!!t},useVAO:!1};return Lh.os===Ch.IOS&&14===Lh.osMainVersion&&Lh.isBrowser||(e.WEBGL_compressed_texture_astc=l9(t,"WEBGL_compressed_texture_astc")),Lh.os!==Ch.ANDROID&&Lh.os!==Ch.IOS&&(e.WEBGL_multi_draw=l9(t,"WEBGL_multi_draw")),Lh.browserType===Sh.UC&&(e.ANGLE_instanced_arrays=null),(Lh.os===Ch.IOS&&Lh.osMainVersion<=10||Lh.os===Ch.ANDROID)&&(e.destroyShadersImmediately=!1),e.isLocationActive=function(t){return!!t&&-1!==t.id},e.noCompressedTexSubImage2D=!0,e.OES_vertex_array_object&&(e.useVAO=!0),e}var u9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).stateCache=new o9,e.cmdAllocator=new q7,e.nullTex2D=null,e.nullTexCube=null,e._canvas=null,e._webGLContextLostHandler=null,e._extensions=null,e}$(e,t);var n=e.prototype;return n.initialize=function(t){this._canvas=t.windowHandle,this._webGLContextLostHandler=this._onWebGLContextLost.bind(this),this._canvas.addEventListener(c9,this._onWebGLContextLost);var e=p7.instance.gl;this.stateCache.initialize(p7.instance.capabilities.maxTextureUnits,p7.instance.capabilities.maxVertexAttributes),this._extensions=h9(e),function(t){t.activeTexture(t.TEXTURE0),t.pixelStorei(t.PACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_ALIGNMENT,1),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.bindFramebuffer(t.FRAMEBUFFER,null),t.enable(t.SCISSOR_TEST),t.enable(t.CULL_FACE),t.cullFace(t.BACK),t.frontFace(t.CCW),t.disable(t.POLYGON_OFFSET_FILL),t.polygonOffset(0,0),t.enable(t.DEPTH_TEST),t.depthMask(!0),t.depthFunc(t.LESS),t.depthRange(0,1),t.stencilFuncSeparate(t.FRONT,t.ALWAYS,1,65535),t.stencilOpSeparate(t.FRONT,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.FRONT,65535),t.stencilFuncSeparate(t.BACK,t.ALWAYS,1,65535),t.stencilOpSeparate(t.BACK,t.KEEP,t.KEEP,t.KEEP),t.stencilMaskSeparate(t.BACK,65535),t.disable(t.STENCIL_TEST),t.disable(t.SAMPLE_ALPHA_TO_COVERAGE),t.disable(t.BLEND),t.blendEquationSeparate(t.FUNC_ADD,t.FUNC_ADD),t.blendFuncSeparate(t.ONE,t.ZERO,t.ONE,t.ZERO),t.colorMask(!0,!0,!0,!0),t.blendColor(0,0,0,0)}(e);var n=mi.RGBA8,i=mi.DEPTH_STENCIL,r=e.getParameter(e.DEPTH_BITS),a=e.getParameter(e.STENCIL_BITS);r&&a?i=mi.DEPTH_STENCIL:r&&(i=mi.DEPTH),this._colorTexture=new s9,this._colorTexture.initAsSwapchainTexture({swapchain:this,format:n,width:t.width,height:t.height}),this._depthStencilTexture=new s9,this._depthStencilTexture.initAsSwapchainTexture({swapchain:this,format:i,width:t.width,height:t.height}),this.nullTex2D=p7.instance.createTexture(new br(bi.TEX2D,Ci.SAMPLED,mi.RGBA8,2,2,Ti.GEN_MIPMAP)),this.nullTexCube=p7.instance.createTexture(new br(bi.CUBE,Ci.SAMPLED,mi.RGBA8,2,2,Ti.GEN_MIPMAP,6));var o=new _r;o.texExtent.width=2,o.texExtent.height=2;var s=new Uint8Array(this.nullTex2D.size);s.fill(0),p7.instance.copyBuffersToTexture([s],this.nullTex2D,[o]),o.texSubres.layerCount=6,p7.instance.copyBuffersToTexture([s,s,s,s,s,s],this.nullTexCube,[o])},n.destroy=function(){this._canvas&&this._webGLContextLostHandler&&(this._canvas.removeEventListener(c9,this._webGLContextLostHandler),this._webGLContextLostHandler=null),this.nullTex2D&&(this.nullTex2D.destroy(),this.nullTex2D=null),this.nullTexCube&&(this.nullTexCube.destroy(),this.nullTexCube=null),this._extensions=null,this._canvas=null},n.resize=function(t,e){this._colorTexture.width===t&&this._colorTexture.height===e||(C("Resizing swapchain: "+t+"x"+e),this._canvas.width=t,this._canvas.height=e,this._colorTexture.resize(t,e),this._depthStencilTexture.resize(t,e))},n._onWebGLContextLost=function(t){R(11e3),S(t)},Q(e,[{key:"extensions",get:function(){return this._extensions}}]),e}(ya),_9=t("WebGLDevice",function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._swapchain=null,e._context=null,e._bindingMappings=null,e._textureExclusive=new Array(mi.COUNT),e}$(e,t);var n=e.prototype;return n.initialize=function(t){p7.setInstance(this),this._gfxAPI=fi.WEBGL;var e=this._bindingMappingInfo=t.bindingMappingInfo,n=[],i=[],r=e.setIndices[0];n[r]=0,i[r]=0;for(var a=1;a<e.setIndices.length;++a){var o=e.setIndices[a],s=e.setIndices[a-1];n[o]=e.maxBlockCounts[s]+n[s],i[o]=e.maxSamplerTextureCounts[s]+i[s]}for(var c=0;c<e.setIndices.length;++c){var l=e.setIndices[c];i[l]-=e.maxBlockCounts[l]}this._bindingMappings={blockOffsets:n,samplerTextureOffsets:i,flexibleSet:e.setIndices[e.setIndices.length-1]};var h=this._context=function(t){var e=null;try{var n={alpha:_e.ENABLE_TRANSPARENT_CANVAS,antialias:_e.ENABLE_WEBGL_ANTIALIAS,depth:!0,stencil:!0,premultipliedAlpha:!1,preserveDrawingBuffer:!1,powerPreference:"default",failIfMajorPerformanceCaveat:!1};e=t.getContext("webgl",n)}catch(t){return null}return e}(ga.canvas);if(!h)return console.error("This device does not support WebGL."),!1;this._queue=this.createQueue(new Zr(Ki.GRAPHICS)),this._cmdBuff=this.createCommandBuffer(new Qr(this._queue)),this._caps.maxVertexAttributes=h.getParameter(h.MAX_VERTEX_ATTRIBS),this._caps.maxVertexUniformVectors=h.getParameter(h.MAX_VERTEX_UNIFORM_VECTORS),this._caps.maxFragmentUniformVectors=h.getParameter(h.MAX_FRAGMENT_UNIFORM_VECTORS),this._caps.maxTextureUnits=h.getParameter(h.MAX_TEXTURE_IMAGE_UNITS),this._caps.maxVertexTextureUnits=h.getParameter(h.MAX_VERTEX_TEXTURE_IMAGE_UNITS),this._caps.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE),this._caps.maxCubeMapTextureSize=h.getParameter(h.MAX_CUBE_MAP_TEXTURE_SIZE),this._caps.maxUniformBufferBindings=16;var u=h.getSupportedExtensions(),_="";if(u)for(var f,d=st(u);!(f=d()).done;)_+=f.value+" ";var p=h9(h);p.WEBGL_debug_renderer_info?(this._renderer=h.getParameter(p.WEBGL_debug_renderer_info.UNMASKED_RENDERER_WEBGL),this._vendor=h.getParameter(p.WEBGL_debug_renderer_info.UNMASKED_VENDOR_WEBGL)):(this._renderer=h.getParameter(h.RENDERER),this._vendor=h.getParameter(h.VENDOR));var m=h.getParameter(h.VERSION);this._features.fill(!1),this.initFormatFeatures(p),p.EXT_blend_minmax&&(this._features[pi.BLEND_MINMAX]=!0),p.OES_element_index_uint&&(this._features[pi.ELEMENT_INDEX_UINT]=!0),p.ANGLE_instanced_arrays&&(this._features[pi.INSTANCED_ARRAYS]=!0),p.WEBGL_draw_buffers&&(this._features[pi.MULTIPLE_RENDER_TARGETS]=!0);var v="";return this.getFormatFeatures(mi.ETC_RGB8)&&(v+="etc1 "),this.getFormatFeatures(mi.ETC2_RGB8)&&(v+="etc2 "),this.getFormatFeatures(mi.BC1)&&(v+="dxt "),this.getFormatFeatures(mi.PVRTC_RGB2)&&(v+="pvrtc "),this.getFormatFeatures(mi.ASTC_RGBA_4X4)&&(v+="astc "),C("WebGL device initialized."),C("RENDERER: "+this._renderer),C("VENDOR: "+this._vendor),C("VERSION: "+m),C("COMPRESSED_FORMAT: "+v),C("EXTENSIONS: "+_),!0},n.destroy=function(){this._queue&&(this._queue.destroy(),this._queue=null),this._cmdBuff&&(this._cmdBuff.destroy(),this._cmdBuff=null)},n.flushCommands=function(){},n.acquire=function(){},n.present=function(){var t=this._queue;this._numDrawCalls=t.numDrawCalls,this._numInstances=t.numInstances,this._numTris=t.numTris,t.clear()},n.initFormatFeatures=function(t){this._formatFeatures.fill(Ei.NONE),this._textureExclusive.fill(!0);var e=Ei.RENDER_TARGET|Ei.SAMPLED_TEXTURE|Ei.LINEAR_FILTER;this._formatFeatures[mi.RGB8]=e,this._formatFeatures[mi.R5G6B5]=e,this._textureExclusive[mi.R5G6B5]=!1,this._formatFeatures[mi.RGBA8]=e,this._formatFeatures[mi.RGBA4]=e,this._textureExclusive[mi.RGBA4]=!1,this._formatFeatures[mi.RGB5A1]=e,this._textureExclusive[mi.RGB5A1]=!1,this._formatFeatures[mi.DEPTH]=Ei.RENDER_TARGET,this._textureExclusive[mi.DEPTH]=!1,this._formatFeatures[mi.DEPTH_STENCIL]=Ei.RENDER_TARGET,this._textureExclusive[mi.DEPTH_STENCIL]=!1,this._formatFeatures[mi.R8I]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.RG8I]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.RGB8I]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.RGBA8I]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.R8UI]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.RG8UI]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.RGB8UI]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.RGBA8UI]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.R8I]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.RG8I]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.RGB8I]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.RGBA8I]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.R8UI]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.RG8UI]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.RGB8UI]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.RGBA8UI]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.R32F]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.RG32F]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.RGB32F]|=Ei.VERTEX_ATTRIBUTE,this._formatFeatures[mi.RGBA32F]|=Ei.VERTEX_ATTRIBUTE,t.EXT_sRGB&&(this._formatFeatures[mi.SRGB8]=e,this._formatFeatures[mi.SRGB8_A8]=e,this._textureExclusive[mi.SRGB8_A8]=!1),t.WEBGL_depth_texture&&(this._formatFeatures[mi.DEPTH]|=e,this._formatFeatures[mi.DEPTH_STENCIL]|=e),t.WEBGL_color_buffer_float&&(this._formatFeatures[mi.RGB32F]|=Ei.RENDER_TARGET,this._formatFeatures[mi.RGBA32F]|=Ei.RENDER_TARGET,this._textureExclusive[mi.RGB32F]=!1,this._textureExclusive[mi.RGBA32F]=!1),t.EXT_color_buffer_half_float&&(this._formatFeatures[mi.RGB16F]|=Ei.RENDER_TARGET,this._formatFeatures[mi.RGBA16F]|=Ei.RENDER_TARGET,this._textureExclusive[mi.RGB16F]=!1,this._textureExclusive[mi.RGBA16F]=!1),t.OES_texture_float&&(this._formatFeatures[mi.RGB32F]|=Ei.RENDER_TARGET|Ei.SAMPLED_TEXTURE,this._formatFeatures[mi.RGBA32F]|=Ei.RENDER_TARGET|Ei.SAMPLED_TEXTURE),t.OES_texture_half_float&&(this._formatFeatures[mi.RGB16F]|=Ei.RENDER_TARGET|Ei.SAMPLED_TEXTURE,this._formatFeatures[mi.RGBA16F]|=Ei.RENDER_TARGET|Ei.SAMPLED_TEXTURE),t.OES_texture_float_linear&&(this._formatFeatures[mi.RGB32F]|=Ei.LINEAR_FILTER,this._formatFeatures[mi.RGBA32F]|=Ei.LINEAR_FILTER),t.OES_texture_half_float_linear&&(this._formatFeatures[mi.RGB16F]|=Ei.LINEAR_FILTER,this._formatFeatures[mi.RGBA16F]|=Ei.LINEAR_FILTER);var n=Ei.SAMPLED_TEXTURE|Ei.LINEAR_FILTER;t.WEBGL_compressed_texture_etc1&&(this._formatFeatures[mi.ETC_RGB8]=n),t.WEBGL_compressed_texture_etc&&(this._formatFeatures[mi.ETC2_RGB8]=n,this._formatFeatures[mi.ETC2_RGBA8]=n,this._formatFeatures[mi.ETC2_SRGB8]=n,this._formatFeatures[mi.ETC2_SRGB8_A8]=n,this._formatFeatures[mi.ETC2_RGB8_A1]=n,this._formatFeatures[mi.ETC2_SRGB8_A1]=n),t.WEBGL_compressed_texture_s3tc&&(this._formatFeatures[mi.BC1]=n,this._formatFeatures[mi.BC1_ALPHA]=n,this._formatFeatures[mi.BC1_SRGB]=n,this._formatFeatures[mi.BC1_SRGB_ALPHA]=n,this._formatFeatures[mi.BC2]=n,this._formatFeatures[mi.BC2_SRGB]=n,this._formatFeatures[mi.BC3]=n,this._formatFeatures[mi.BC3_SRGB]=n),t.WEBGL_compressed_texture_pvrtc&&(this._formatFeatures[mi.PVRTC_RGB2]|=n,this._formatFeatures[mi.PVRTC_RGBA2]|=n,this._formatFeatures[mi.PVRTC_RGB4]|=n,this._formatFeatures[mi.PVRTC_RGBA4]|=n),t.WEBGL_compressed_texture_astc&&(this._formatFeatures[mi.ASTC_RGBA_4X4]|=n,this._formatFeatures[mi.ASTC_RGBA_5X4]|=n,this._formatFeatures[mi.ASTC_RGBA_5X5]|=n,this._formatFeatures[mi.ASTC_RGBA_6X5]|=n,this._formatFeatures[mi.ASTC_RGBA_6X6]|=n,this._formatFeatures[mi.ASTC_RGBA_8X5]|=n,this._formatFeatures[mi.ASTC_RGBA_8X6]|=n,this._formatFeatures[mi.ASTC_RGBA_8X8]|=n,this._formatFeatures[mi.ASTC_RGBA_10X5]|=n,this._formatFeatures[mi.ASTC_RGBA_10X6]|=n,this._formatFeatures[mi.ASTC_RGBA_10X8]|=n,this._formatFeatures[mi.ASTC_RGBA_10X10]|=n,this._formatFeatures[mi.ASTC_RGBA_12X10]|=n,this._formatFeatures[mi.ASTC_RGBA_12X12]|=n,this._formatFeatures[mi.ASTC_SRGBA_4X4]|=n,this._formatFeatures[mi.ASTC_SRGBA_5X4]|=n,this._formatFeatures[mi.ASTC_SRGBA_5X5]|=n,this._formatFeatures[mi.ASTC_SRGBA_6X5]|=n,this._formatFeatures[mi.ASTC_SRGBA_6X6]|=n,this._formatFeatures[mi.ASTC_SRGBA_8X5]|=n,this._formatFeatures[mi.ASTC_SRGBA_8X6]|=n,this._formatFeatures[mi.ASTC_SRGBA_8X8]|=n,this._formatFeatures[mi.ASTC_SRGBA_10X5]|=n,this._formatFeatures[mi.ASTC_SRGBA_10X6]|=n,this._formatFeatures[mi.ASTC_SRGBA_10X8]|=n,this._formatFeatures[mi.ASTC_SRGBA_10X10]|=n,this._formatFeatures[mi.ASTC_SRGBA_12X10]|=n,this._formatFeatures[mi.ASTC_SRGBA_12X12]|=n)},n.createCommandBuffer=function(t){var e=new(t.type===Qi.PRIMARY?t9:X7);return e.initialize(t),e},n.createSwapchain=function(t){var e=new u9;return this._swapchain=e,e.initialize(t),e},n.createBuffer=function(t){var e=new j7;return e.initialize(t),e},n.createTexture=function(t){var e=new s9;return e.initialize(t),e},n.createDescriptorSet=function(t){var e=new d7;return e.initialize(t),e},n.createShader=function(t){var e=new a9;return e.initialize(t),e},n.createInputAssembler=function(t){var e=new K7;return e.initialize(t),e},n.createRenderPass=function(t){var e=new n9;return e.initialize(t),e},n.createFramebuffer=function(t){var e=new Y7;return e.initialize(t),e},n.createDescriptorSetLayout=function(t){var e=new J7;return e.initialize(t),e},n.createPipelineLayout=function(t){var e=new Q7;return e.initialize(t),e},n.createPipelineState=function(t){var e=new $7;return e.initialize(t),e},n.createQueue=function(t){var e=new e9;return e.initialize(t),e},n.getSampler=function(t){var e=La.computeHash(t);return this._samplers.has(e)||this._samplers.set(e,new r9(t,e)),this._samplers.get(e)},n.getGeneralBarrier=function(t){var e=za.computeHash(t);return this._generalBarrierss.has(e)||this._generalBarrierss.set(e,new za(t,e)),this._generalBarrierss.get(e)},n.getTextureBarrier=function(t){var e=ka.computeHash(t);return this._textureBarriers.has(e)||this._textureBarriers.set(e,new ka(t,e)),this._textureBarriers.get(e)},n.copyBuffersToTexture=function(t,e,n){G7(this,t,e.gpuTexture,n)},n.copyTextureToBuffers=function(t,e,n){!function(t,e,n,i){var r=t.gl,a=t.stateCache,o=r.createFramebuffer();r.bindFramebuffer(r.FRAMEBUFFER,o);var s=0,c=0,l=1,h=1;switch(e.glTarget){case r.TEXTURE_2D:for(var u=0;u<i.length;u++){var _=i[u];r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,e.glTarget,e.glTexture,_.texSubres.mipLevel),s=_.texOffset.x,c=_.texOffset.y,l=_.texExtent.width,h=_.texExtent.height,r.readPixels(s,c,l,h,e.glFormat,e.glType,n[u])}break;default:console.error("Unsupported GL texture type, copy texture to buffers failed.")}r.bindFramebuffer(r.FRAMEBUFFER,null),a.glFramebuffer=null,r.deleteFramebuffer(o)}(this,t.gpuTexture,e,n)},n.copyTexImagesToTexture=function(t,e,n){!function(t,e,n,i){var r=t.gl,a=t.stateCache.glTexUnits[t.stateCache.texUnit];a.glTexture!==n.glTexture&&(r.bindTexture(n.glTarget,n.glTexture),a.glTexture=n.glTexture);var o=0,s=0;switch(n.glTarget){case r.TEXTURE_2D:for(var c=0;c<i.length;c++){var l=i[c];r.texSubImage2D(r.TEXTURE_2D,l.texSubres.mipLevel,l.texOffset.x,l.texOffset.y,n.glFormat,n.glType,e[o++])}break;case r.TEXTURE_CUBE_MAP:for(var h=0;h<i.length;h++){var u=i[h],_=u.texSubres.baseArrayLayer+u.texSubres.layerCount;for(s=u.texSubres.baseArrayLayer;s<_;++s)r.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+s,u.texSubres.mipLevel,u.texOffset.x,u.texOffset.y,n.glFormat,n.glType,e[o++])}break;default:console.error("Unsupported GL texture type, copy buffer to texture failed.")}n.flags&Ti.GEN_MIPMAP&&n.isPowerOf2&&r.generateMipmap(n.glTarget)}(this,t,e.gpuTexture,n)},Q(e,[{key:"gl",get:function(){return this._context}},{key:"extensions",get:function(){return this._swapchain.extensions}},{key:"stateCache",get:function(){return this._swapchain.stateCache}},{key:"nullTex2D",get:function(){return this._swapchain.nullTex2D}},{key:"nullTexCube",get:function(){return this._swapchain.nullTexCube}},{key:"textureExclusive",get:function(){return this._textureExclusive}},{key:"bindingMappings",get:function(){return this._bindingMappings}}]),e}(ga));function f9(t,e,n,i){var r=(i.x-n.x)*(t.y-n.y)-(i.y-n.y)*(t.x-n.x),a=(e.x-t.x)*(t.y-n.y)-(e.y-t.y)*(t.x-n.x),o=(i.y-n.y)*(e.x-t.x)-(i.x-n.x)*(e.y-t.y);if(0!==o){var s=r/o,c=a/o;if(s>=0&&s<=1&&c>=0&&c<=1)return!0}return!1}h.WebGLDevice=_9;var d9=new Qn,p9=new Qn,m9=new Qn,v9=new Qn;function g9(t,e,n){for(var i=n.length,r=0;r<i;++r)if(f9(t,e,n[r],n[(r+1)%i]))return!0;return!1}function y9(t,e){for(var n=!1,i=t.x,r=t.y,a=e.length,o=0,s=a-1;o<a;s=o++){var c=e[o].x,l=e[o].y,h=e[s].x,u=e[s].y;l>r!=u>r&&i<(h-c)*(r-l)/(u-l)+c&&(n=!n)}return n}function x9(t,e,n,i){var r,a=n.x-e.x,o=n.y-e.y,s=a*a+o*o,c=((t.x-e.x)*a+(t.y-e.y)*o)/s;return r=i?s?c<0?e:c>1?n:d9.set(e.x+c*a,e.y+c*o):e:d9.set(e.x+c*a,e.y+c*o),a=t.x-r.x,o=t.y-r.y,Math.sqrt(a*a+o*o)}var S9=t("Intersection2D",(function(){}));S9.lineLine=f9,S9.lineRect=function(t,e,n){var i=d9.set(n.x,n.y),r=p9.set(n.x,n.yMax),a=m9.set(n.xMax,n.yMax),o=v9.set(n.xMax,n.y);return!!(f9(t,e,i,r)||f9(t,e,r,a)||f9(t,e,a,o)||f9(t,e,o,i))},S9.linePolygon=g9,S9.rectRect=function(t,e){var n=t.x,i=t.y,r=t.x+t.width,a=t.y+t.height,o=e.x,s=e.y,c=e.x+e.width,l=e.y+e.height;return n<=c&&r>=o&&i<=l&&a>=s},S9.rectPolygon=function(t,e){var n=d9.set(t.x,t.y),i=p9.set(t.x,t.yMax),r=m9.set(t.xMax,t.yMax),a=v9.set(t.xMax,t.y);if(g9(n,i,e))return!0;if(g9(i,r,e))return!0;if(g9(r,a,e))return!0;if(g9(a,n,e))return!0;for(var o=0,s=e.length;o<s;++o)if(t.contains(e[o]))return!0;return!!(y9(n,e)||y9(i,e)||y9(r,e)||y9(a,e))},S9.rectCircle=function(t,e,n){var i=e.x,r=e.y,a=t.x,o=t.y,s=t.width,c=t.height,l=i,h=r;i<a?l=a:i>a+s&&(l=a+s),r<o?h=o:r>o+c&&(h=o+c);var u=i-l,_=r-h;return Math.sqrt(u*u+_*_)<=n},S9.polygonPolygon=function(t,e){var n,i;for(n=0,i=t.length;n<i;++n)if(g9(t[n],t[(n+1)%i],e))return!0;for(n=0,i=e.length;n<i;++n)if(y9(e[n],t))return!0;for(n=0,i=t.length;n<i;++n)if(y9(t[n],e))return!0;return!1},S9.circleCircle=function(t,e,n,i){return Qn.distance(t,n)<e+i},S9.polygonCircle=function(t,e,n){var i=e;if(y9(i,t))return!0;for(var r=0,a=t.length;r<a;r++)if(x9(i,0===r?t[t.length-1]:t[r-1],t[r],!0)<n)return!0;return!1},S9.pointInPolygon=y9,S9.pointLineDistance=x9;var A9,b9,C9,T9,E9=se({GRAVITY:0,RADIUS:1}),w9=se({FREE:0,RELATIVE:1,GROUPED:2}),I9=new Qn(0,0),P9=new Qn,D9=new Qn,R9=new Qn,M9=new Qn,O9=rV(nV),N9=function(){this.pos=new Qn(0,0),this.startPos=new Qn(0,0),this.color=new Dn(0,0,0,255),this.deltaColor={r:0,g:0,b:0,a:255},this.size=0,this.deltaSize=0,this.rotation=0,this.deltaRotation=0,this.timeToLive=0,this.drawPos=new Qn(0,0),this.aspectRatio=1,this.dir=new Qn(0,0),this.radialAccel=0,this.tangentialAccel=0,this.angle=0,this.degreesPerSecond=0,this.radius=0,this.deltaRadius=0},B9=new(function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e.prototype.get=function(){return this._get()||new N9},e}(ne))((function(t){t.pos.set(I9),t.startPos.set(I9),t.color._val=4278190080,t.deltaColor.r=t.deltaColor.g=t.deltaColor.b=0,t.deltaColor.a=255,t.size=0,t.deltaSize=0,t.rotation=0,t.deltaRotation=0,t.timeToLive=0,t.drawPos.set(I9),t.aspectRatio=1,t.dir.set(I9),t.radialAccel=0,t.tangentialAccel=0,t.angle=0,t.degreesPerSecond=0,t.radius=0,t.deltaRadius=0}),1024),L9=function(){function t(t){this.particles=[],this.active=!1,this.uvFilled=0,this.finished=!1,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this._worldRotation=0,this.sys=t,this.particles=[],this.active=!1,this.readyToPlay=!0,this.finished=!1,this.elapsed=0,this.emitCounter=0,this.uvFilled=0,this._worldRotation=0}var e=t.prototype;return e.stop=function(){this.active=!1,this.readyToPlay=!1,this.elapsed=this.sys.duration,this.emitCounter=0},e.reset=function(){this.active=!0,this.readyToPlay=!0,this.elapsed=0,this.emitCounter=0,this.finished=!1;for(var t=this.particles,e=0;e<t.length;++e)B9.put(t[e]);t.length=0},e.emitParticle=function(t){var e=this.sys,n=B9.get();this.particles.push(n),n.timeToLive=e.life+e.lifeVar*(Math.random()-.5)*2;var i=n.timeToLive=Math.max(0,n.timeToLive);n.pos.x=e.sourcePos.x+e.posVar.x*(Math.random()-.5)*2,n.pos.y=e.sourcePos.y+e.posVar.y*(Math.random()-.5)*2;var r,a,o,s,c=e.startColor,l=e.startColorVar,h=e.endColor,u=e.endColorVar;n.color.r=r=Ce(c.r+l.r*(Math.random()-.5)*2,0,255),n.color.g=a=Ce(c.g+l.g*(Math.random()-.5)*2,0,255),n.color.b=o=Ce(c.b+l.b*(Math.random()-.5)*2,0,255),n.color.a=s=Ce(c.a+l.a*(Math.random()-.5)*2,0,255),n.deltaColor.r=(Ce(h.r+u.r*(Math.random()-.5)*2,0,255)-r)/i,n.deltaColor.g=(Ce(h.g+u.g*(Math.random()-.5)*2,0,255)-a)/i,n.deltaColor.b=(Ce(h.b+u.b*(Math.random()-.5)*2,0,255)-o)/i,n.deltaColor.a=(Ce(h.a+u.a*(Math.random()-.5)*2,0,255)-s)/i;var _=e.startSize+e.startSizeVar*(Math.random()-.5)*2;if(_=Math.max(0,_),n.size=_,-1===e.endSize)n.deltaSize=0;else{var f=e.endSize+e.endSizeVar*(Math.random()-.5)*2;f=Math.max(0,f),n.deltaSize=(f-_)/i}var d=e.startSpin+e.startSpinVar*(Math.random()-.5)*2,p=e.endSpin+e.endSpinVar*(Math.random()-.5)*2;n.rotation=d,n.deltaRotation=(p-d)/i,n.startPos.x=t.x,n.startPos.y=t.y,n.aspectRatio=e.aspectRatio||1;var m=Te(e.angle+this._worldRotation+e.angleVar*(Math.random()-.5)*2);if(e.emitterMode===E9.GRAVITY){var v=e.speed+e.speedVar*(Math.random()-.5)*2;n.dir.x=Math.cos(m),n.dir.y=Math.sin(m),n.dir.multiplyScalar(v),n.radialAccel=e.radialAccel+e.radialAccelVar*(Math.random()-.5)*2,n.tangentialAccel=e.tangentialAccel+e.tangentialAccelVar*(Math.random()-.5)*2,e.rotationIsDir&&(n.rotation=-Ee(Math.atan2(n.dir.y,n.dir.x)))}else{var g=e.startRadius+e.startRadiusVar*(Math.random()-.5)*2,y=e.endRadius+e.endRadiusVar*(Math.random()-.5)*2;n.radius=g,n.deltaRadius=-1===e.endRadius?0:(y-g)/i,n.angle=m,n.degreesPerSecond=Te(e.rotatePerS+e.rotatePerSVar*(Math.random()-.5)*2)}},e.updateUVs=function(t){var e=this.renderData;if(e&&this.sys._renderSpriteFrame){for(var n=e.vData,i=this.sys._renderSpriteFrame.uv,r=t?0:this.uvFilled,a=this.particles.length,o=r;o<a;o++){var s=o*O9*4;n[s+3]=i[0],n[s+4]=i[1],n[s+12]=i[2],n[s+13]=i[3],n[s+21]=i[4],n[s+22]=i[5],n[s+30]=i[6],n[s+31]=i[7]}this.uvFilled=a}},e.updateParticleBuffer=function(t,e,n,i){var r=n.vData,a=e.x,o=e.y,s=t.size,c=s,l=t.aspectRatio;l>1?c=s/l:s=c*l;var h=s/2,u=c/2;if(t.rotation){var _=-h,f=-u,d=h,p=u,m=-Te(t.rotation),v=Math.cos(m),g=Math.sin(m);r[i]=_*v-f*g+a,r[i+1]=_*g+f*v+o,r[i+2]=0,r[i+9]=d*v-f*g+a,r[i+10]=d*g+f*v+o,r[i+11]=0,r[i+18]=_*v-p*g+a,r[i+19]=_*g+p*v+o,r[i+20]=0,r[i+27]=d*v-p*g+a,r[i+28]=d*g+p*v+o,r[i+29]=0}else r[i]=a-h,r[i+1]=o-u,r[i+2]=0,r[i+9]=a+h,r[i+10]=o-u,r[i+11]=0,r[i+18]=a-h,r[i+19]=o+u,r[i+20]=0,r[i+27]=a+h,r[i+28]=o+u,r[i+29]=0;Dn.toArray(r,t.color,i+5),Dn.toArray(r,t.color,i+14),Dn.toArray(r,t.color,i+23),Dn.toArray(r,t.color,i+32)},e.step=function(t){var e=this.sys.assembler,n=this.sys,i=n.node,r=this.particles;if(t=t>e.maxParticleDeltaTime?e.maxParticleDeltaTime:t,i.updateWorldTransform(),n.positionType===w9.FREE){this._worldRotation=function(t){for(var e=0,n=t;n;)e+=n.eulerAngles.z,n=n.parent;return e}(i);var a=i.worldMatrix;P9.x=a.m12,P9.y=a.m13}else n.positionType===w9.RELATIVE?(this._worldRotation=i.eulerAngles.z,P9.x=i.position.x,P9.y=i.position.y):this._worldRotation=0;if(this.active&&n.emissionRate){var o=1/n.emissionRate;for(r.length<n.totalParticles&&(this.emitCounter+=t);r.length<n.totalParticles&&this.emitCounter>o;)this.emitParticle(P9),this.emitCounter-=o;this.elapsed+=t,-1!==n.duration&&n.duration<this.elapsed&&n.stopSystem()}var s=this.renderData,c=r.length;s.reset(),this.requestData(4*c,6*c),c>this.uvFilled&&this.updateUVs();for(var l=0;l<r.length;){D9.x=D9.y=R9.x=R9.y=M9.x=M9.y=0;var h=r[l];if(h.timeToLive-=t,h.timeToLive>0){if(n.emitterMode===E9.GRAVITY){var u=M9,_=D9,f=R9;(h.pos.x||h.pos.y)&&(_.set(h.pos),_.normalize()),f.set(_),_.multiplyScalar(h.radialAccel);var d=f.x;f.x=-f.y,f.y=d,f.multiplyScalar(h.tangentialAccel),u.set(_),u.add(f),u.add(n.gravity),u.multiplyScalar(t),h.dir.add(u),u.set(h.dir),u.multiplyScalar(t),h.pos.add(u)}else h.angle+=h.degreesPerSecond*t,h.radius+=h.deltaRadius*t,h.pos.x=-Math.cos(h.angle)*h.radius,h.pos.y=-Math.sin(h.angle)*h.radius;h.color.r+=h.deltaColor.r*t,h.color.g+=h.deltaColor.g*t,h.color.b+=h.deltaColor.b*t,h.color.a+=h.deltaColor.a*t,h.size+=h.deltaSize*t,h.size<0&&(h.size=0),h.rotation+=h.deltaRotation*t;var p=D9;p.set(h.pos),n.positionType!==w9.GROUPED&&p.add(h.startPos);var m=O9*l*4;this.updateParticleBuffer(h,p,s,m),++l}else{var v=r[l];l!==r.length-1&&(r[l]=r[r.length-1]),B9.put(v),r.length--,s.resize(s.vertexCount-4,s.indexCount-6)}}0!==r.length||this.active||this.readyToPlay||(this.finished=!0,n._finishedSimulation())},e.requestData=function(t,e){var n=this.renderData.indexCount;this.renderData.request(t,e);for(var i=this.renderData.indexCount/6,r=this.renderData.iData,a=n;a<i;a++){var o=4*a;r[n++]=o,r[n++]=o+1,r[n++]=o+2,r[n++]=o+1,r[n++]=o+3,r[n++]=o+2}},t}(),F9=t("ParticleAsset",Ec("cc.ParticleAsset")((T9=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"spriteFrame",C9,at(e)),e}return $(e,t),e}($h),C9=lt((b9=T9).prototype,"spriteFrame",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A9=b9))||A9);h.ParticleAsset=F9;
/** @license zlib.js 2012 - imaya [ https://github.com/imaya/zlib.js ] The MIT License */
var V9={};(function(){function t(t){throw t}var e=void 0,n=!0,i=this;function r(t,n){var r,a=t.split("."),o=i;!(a[0]in o)&&o.execScript&&o.execScript("var "+a[0]);for(;a.length&&(r=a.shift());)a.length||n===e?o=o[r]?o[r]:o[r]={}:o[r]=n}var a="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Uint32Array;function o(t){if("string"==typeof t){var e,n,i=t.split("");for(e=0,n=i.length;e<n;e++)i[e]=(255&i[e].charCodeAt(0))>>>0;t=i}for(var r,a=1,o=0,s=t.length,c=0;0<s;){s-=r=1024<s?1024:s;do{o+=a+=t[c++]}while(--r);a%=65521,o%=65521}return(o<<16|a)>>>0}function s(e,n){this.index="number"==typeof n?n:0,this.i=0,this.buffer=e instanceof(a?Uint8Array:Array)?e:new(a?Uint8Array:Array)(32768),2*this.buffer.length<=this.index&&t(Error("invalid index")),this.buffer.length<=this.index&&this.f()}s.prototype.f=function(){var t,e=this.buffer,n=e.length,i=new(a?Uint8Array:Array)(n<<1);if(a)i.set(e);else for(t=0;t<n;++t)i[t]=e[t];return this.buffer=i},s.prototype.d=function(t,e,n){var i,r=this.buffer,a=this.index,o=this.i,s=r[a];if(n&&1<e&&(t=8<e?(f[255&t]<<24|f[t>>>8&255]<<16|f[t>>>16&255]<<8|f[t>>>24&255])>>32-e:f[t]>>8-e),8>e+o)s=s<<e|t,o+=e;else for(i=0;i<e;++i)s=s<<1|t>>e-i-1&1,8==++o&&(o=0,r[a++]=f[s],s=0,a===r.length&&(r=this.f()));r[a]=s,this.buffer=r,this.i=o,this.index=a},s.prototype.finish=function(){var t,e=this.buffer,n=this.index;return 0<this.i&&(e[n]<<=8-this.i,e[n]=f[e[n]],n++),a?t=e.subarray(0,n):(e.length=n,t=e),t};var c,l=new(a?Uint8Array:Array)(256);for(c=0;256>c;++c){for(var h=_=c,u=7,_=_>>>1;_;_>>>=1)h<<=1,h|=1&_,--u;l[c]=(h<<u&255)>>>0}var f=l;function d(t){this.buffer=new(a?Uint16Array:Array)(2*t),this.length=0}function p(t){var e,n,i,r,o,s,c,l,h,u=t.length,_=0,f=Number.POSITIVE_INFINITY;for(l=0;l<u;++l)t[l]>_&&(_=t[l]),t[l]<f&&(f=t[l]);for(e=1<<_,n=new(a?Uint32Array:Array)(e),i=1,r=0,o=2;i<=_;){for(l=0;l<u;++l)if(t[l]===i){for(s=0,c=r,h=0;h<i;++h)s=s<<1|1&c,c>>=1;for(h=s;h<e;h+=o)n[h]=i<<16|l;++r}++i,r<<=1,o<<=1}return[n,_,f]}function m(t,e){this.h=g,this.w=0,this.input=t,this.b=0,e&&(e.lazy&&(this.w=e.lazy),"number"==typeof e.compressionType&&(this.h=e.compressionType),e.outputBuffer&&(this.a=a&&e.outputBuffer instanceof Array?new Uint8Array(e.outputBuffer):e.outputBuffer),"number"==typeof e.outputIndex&&(this.b=e.outputIndex)),this.a||(this.a=new(a?Uint8Array:Array)(32768))}d.prototype.getParent=function(t){return 2*((t-2)/4|0)},d.prototype.push=function(t,e){var n,i,r,a=this.buffer;for(n=this.length,a[this.length++]=e,a[this.length++]=t;0<n&&(i=this.getParent(n),a[n]>a[i]);)r=a[n],a[n]=a[i],a[i]=r,r=a[n+1],a[n+1]=a[i+1],a[i+1]=r,n=i;return this.length},d.prototype.pop=function(){var t,e,n,i,r,a=this.buffer;for(e=a[0],t=a[1],this.length-=2,a[0]=a[this.length],a[1]=a[this.length+1],r=0;!((i=2*r+2)>=this.length)&&(i+2<this.length&&a[i+2]>a[i]&&(i+=2),a[i]>a[r]);)n=a[r],a[r]=a[i],a[i]=n,n=a[r+1],a[r+1]=a[i+1],a[i+1]=n,r=i;return{index:t,value:e,length:this.length}};var v,g=2,y={NONE:0,r:1,j:g,N:3},x=[];for(v=0;288>v;v++)switch(n){case 143>=v:x.push([v+48,8]);break;case 255>=v:x.push([v-144+400,9]);break;case 279>=v:x.push([v-256+0,7]);break;case 287>=v:x.push([v-280+192,8]);break;default:t("invalid literal: "+v)}function S(t,e){this.length=t,this.G=e}function A(){var e=b;switch(n){case 3===e:return[257,e-3,0];case 4===e:return[258,e-4,0];case 5===e:return[259,e-5,0];case 6===e:return[260,e-6,0];case 7===e:return[261,e-7,0];case 8===e:return[262,e-8,0];case 9===e:return[263,e-9,0];case 10===e:return[264,e-10,0];case 12>=e:return[265,e-11,1];case 14>=e:return[266,e-13,1];case 16>=e:return[267,e-15,1];case 18>=e:return[268,e-17,1];case 22>=e:return[269,e-19,2];case 26>=e:return[270,e-23,2];case 30>=e:return[271,e-27,2];case 34>=e:return[272,e-31,2];case 42>=e:return[273,e-35,3];case 50>=e:return[274,e-43,3];case 58>=e:return[275,e-51,3];case 66>=e:return[276,e-59,3];case 82>=e:return[277,e-67,4];case 98>=e:return[278,e-83,4];case 114>=e:return[279,e-99,4];case 130>=e:return[280,e-115,4];case 162>=e:return[281,e-131,5];case 194>=e:return[282,e-163,5];case 226>=e:return[283,e-195,5];case 257>=e:return[284,e-227,5];case 258===e:return[285,e-258,0];default:t("invalid length: "+e)}}m.prototype.n=function(){var i,r,o,c,l=this.input;switch(this.h){case 0:for(o=0,c=l.length;o<c;){var h,u,_,f=r=a?l.subarray(o,o+65535):l.slice(o,o+65535),d=(o+=r.length)===c,p=e,m=e,v=this.a,y=this.b;if(a){for(v=new Uint8Array(this.a.buffer);v.length<=y+f.length+5;)v=new Uint8Array(v.length<<1);v.set(this.a)}if(h=d?1:0,v[y++]=0|h,_=65536+~(u=f.length)&65535,v[y++]=255&u,v[y++]=u>>>8&255,v[y++]=255&_,v[y++]=_>>>8&255,a)v.set(f,y),y+=f.length,v=v.subarray(0,y);else{for(p=0,m=f.length;p<m;++p)v[y++]=f[p];v.length=y}this.b=y,this.a=v}break;case 1:var S=new s(new Uint8Array(this.a.buffer),this.b);S.d(1,1,n),S.d(1,2,n);var A,b,C,T=w(this,l);for(A=0,b=T.length;A<b;A++)if(C=T[A],s.prototype.d.apply(S,x[C]),256<C)S.d(T[++A],T[++A],n),S.d(T[++A],5),S.d(T[++A],T[++A],n);else if(256===C)break;this.a=S.finish(),this.b=this.a.length;break;case g:var E,D,R,M,O,N,B,L,F,V,z,k,U,G,H,j=new s(new Uint8Array(this.a),this.b),W=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],q=Array(19);for(E=g,j.d(1,1,n),j.d(E,2,n),D=w(this,l),B=P(N=I(this.L,15)),F=P(L=I(this.K,7)),R=286;257<R&&0===N[R-1];R--);for(M=30;1<M&&0===L[M-1];M--);var X,Y,K,J,Q,Z,$=R,tt=M,et=new(a?Uint32Array:Array)($+tt),nt=new(a?Uint32Array:Array)(316),it=new(a?Uint8Array:Array)(19);for(X=Y=0;X<$;X++)et[Y++]=N[X];for(X=0;X<tt;X++)et[Y++]=L[X];if(!a)for(X=0,J=it.length;X<J;++X)it[X]=0;for(X=Q=0,J=et.length;X<J;X+=Y){for(Y=1;X+Y<J&&et[X+Y]===et[X];++Y);if(K=Y,0===et[X])if(3>K)for(;0<K--;)nt[Q++]=0,it[0]++;else for(;0<K;)(Z=138>K?K:138)>K-3&&Z<K&&(Z=K-3),10>=Z?(nt[Q++]=17,nt[Q++]=Z-3,it[17]++):(nt[Q++]=18,nt[Q++]=Z-11,it[18]++),K-=Z;else if(nt[Q++]=et[X],it[et[X]]++,3>--K)for(;0<K--;)nt[Q++]=et[X],it[et[X]]++;else for(;0<K;)(Z=6>K?K:6)>K-3&&Z<K&&(Z=K-3),nt[Q++]=16,nt[Q++]=Z-3,it[16]++,K-=Z}for(i=a?nt.subarray(0,Q):nt.slice(0,Q),V=I(it,7),G=0;19>G;G++)q[G]=V[W[G]];for(O=19;4<O&&0===q[O-1];O--);for(z=P(V),j.d(R-257,5,n),j.d(M-1,5,n),j.d(O-4,4,n),G=0;G<O;G++)j.d(q[G],3,n);for(G=0,H=i.length;G<H;G++)if(k=i[G],j.d(z[k],V[k],n),16<=k){switch(G++,k){case 16:U=2;break;case 17:U=3;break;case 18:U=7;break;default:t("invalid code: "+k)}j.d(i[G],U,n)}var rt,at,ot,st,ct,lt,ht,ut,_t=[B,N],ft=[F,L];for(ct=_t[0],lt=_t[1],ht=ft[0],ut=ft[1],rt=0,at=D.length;rt<at;++rt)if(ot=D[rt],j.d(ct[ot],lt[ot],n),256<ot)j.d(D[++rt],D[++rt],n),st=D[++rt],j.d(ht[st],ut[st],n),j.d(D[++rt],D[++rt],n);else if(256===ot)break;this.a=j.finish(),this.b=this.a.length;break;default:t("invalid compression type")}return this.a};var b,C,T=[];for(b=3;258>=b;b++)C=A(),T[b]=C[2]<<24|C[1]<<16|C[0];var E=a?new Uint32Array(T):T;function w(i,r){function o(e,i){var r,a,o,s,c=e.G,l=[],h=0;switch(r=E[e.length],l[h++]=65535&r,l[h++]=r>>16&255,l[h++]=r>>24,n){case 1===c:a=[0,c-1,0];break;case 2===c:a=[1,c-2,0];break;case 3===c:a=[2,c-3,0];break;case 4===c:a=[3,c-4,0];break;case 6>=c:a=[4,c-5,1];break;case 8>=c:a=[5,c-7,1];break;case 12>=c:a=[6,c-9,2];break;case 16>=c:a=[7,c-13,2];break;case 24>=c:a=[8,c-17,3];break;case 32>=c:a=[9,c-25,3];break;case 48>=c:a=[10,c-33,4];break;case 64>=c:a=[11,c-49,4];break;case 96>=c:a=[12,c-65,5];break;case 128>=c:a=[13,c-97,5];break;case 192>=c:a=[14,c-129,6];break;case 256>=c:a=[15,c-193,6];break;case 384>=c:a=[16,c-257,7];break;case 512>=c:a=[17,c-385,7];break;case 768>=c:a=[18,c-513,8];break;case 1024>=c:a=[19,c-769,8];break;case 1536>=c:a=[20,c-1025,9];break;case 2048>=c:a=[21,c-1537,9];break;case 3072>=c:a=[22,c-2049,10];break;case 4096>=c:a=[23,c-3073,10];break;case 6144>=c:a=[24,c-4097,11];break;case 8192>=c:a=[25,c-6145,11];break;case 12288>=c:a=[26,c-8193,12];break;case 16384>=c:a=[27,c-12289,12];break;case 24576>=c:a=[28,c-16385,13];break;case 32768>=c:a=[29,c-24577,13];break;default:t("invalid distance")}for(r=a,l[h++]=r[0],l[h++]=r[1],l[h++]=r[2],o=0,s=l.length;o<s;++o)v[g++]=l[o];x[l[0]]++,A[l[3]]++,y=e.length+i-1,d=null}var s,c,l,h,u,_,f,d,p,m={},v=a?new Uint16Array(2*r.length):[],g=0,y=0,x=new(a?Uint32Array:Array)(286),A=new(a?Uint32Array:Array)(30),b=i.w;if(!a){for(l=0;285>=l;)x[l++]=0;for(l=0;29>=l;)A[l++]=0}for(x[256]=1,s=0,c=r.length;s<c;++s){for(l=u=0,h=3;l<h&&s+l!==c;++l)u=u<<8|r[s+l];if(m[u]===e&&(m[u]=[]),_=m[u],!(0<y--)){for(;0<_.length&&32768<s-_[0];)_.shift();if(s+3>=c){for(d&&o(d,-1),l=0,h=c-s;l<h;++l)p=r[s+l],v[g++]=p,++x[p];break}if(0<_.length){var C=e,T=e,w=0,I=e,P=e,D=e,R=r.length,M=(P=0,_.length);t:for(;P<M;P++){if(C=_[M-P-1],I=3,3<w){for(D=w;3<D;D--)if(r[C+D-1]!==r[s+D-1])continue t;I=w}for(;258>I&&s+I<R&&r[C+I]===r[s+I];)++I;if(I>w&&(T=C,w=I),258===I)break}f=new S(w,s-T),d?d.length<f.length?(p=r[s-1],v[g++]=p,++x[p],o(f,0)):o(d,-1):f.length<b?d=f:o(f,0)}else d?o(d,-1):(p=r[s],v[g++]=p,++x[p])}_.push(s)}return v[g++]=256,x[256]++,i.L=x,i.K=A,a?v.subarray(0,g):v}function I(t,e){function n(t){var e=b[t][C[t]];e===g?(n(t+1),n(t+1)):--S[e],++C[t]}var i,r,o,s,c,l=t.length,h=new d(572),u=new(a?Uint8Array:Array)(l);if(!a)for(s=0;s<l;s++)u[s]=0;for(s=0;s<l;++s)0<t[s]&&h.push(s,t[s]);if(i=Array(h.length/2),r=new(a?Uint32Array:Array)(h.length/2),1===i.length)return u[h.pop().index]=1,u;for(s=0,c=h.length/2;s<c;++s)i[s]=h.pop(),r[s]=i[s].value;var _,f,p,m,v,g=r.length,y=new(a?Uint16Array:Array)(e),x=new(a?Uint8Array:Array)(e),S=new(a?Uint8Array:Array)(g),A=Array(e),b=Array(e),C=Array(e),T=(1<<e)-g,E=1<<e-1;for(y[e-1]=g,f=0;f<e;++f)T<E?x[f]=0:(x[f]=1,T-=E),T<<=1,y[e-2-f]=(y[e-1-f]/2|0)+g;for(y[0]=x[0],A[0]=Array(y[0]),b[0]=Array(y[0]),f=1;f<e;++f)y[f]>2*y[f-1]+x[f]&&(y[f]=2*y[f-1]+x[f]),A[f]=Array(y[f]),b[f]=Array(y[f]);for(_=0;_<g;++_)S[_]=e;for(p=0;p<y[e-1];++p)A[e-1][p]=r[p],b[e-1][p]=p;for(_=0;_<e;++_)C[_]=0;for(1===x[e-1]&&(--S[0],++C[e-1]),f=e-2;0<=f;--f){for(m=_=0,v=C[f+1],p=0;p<y[f];p++)(m=A[f+1][v]+A[f+1][v+1])>r[_]?(A[f][p]=m,b[f][p]=g,v+=2):(A[f][p]=r[_],b[f][p]=_,++_);C[f]=0,1===x[f]&&n(f)}for(o=S,s=0,c=i.length;s<c;++s)u[i[s].index]=o[s];return u}function P(e){var n,i,r,o,s=new(a?Uint16Array:Array)(e.length),c=[],l=[],h=0;for(n=0,i=e.length;n<i;n++)c[e[n]]=1+(0|c[e[n]]);for(n=1,i=16;n<=i;n++)l[n]=h,(h+=0|c[n])>1<<n&&t("overcommitted"),h<<=1;for(65536>h&&t("undercommitted"),n=0,i=e.length;n<i;n++)for(h=l[e[n]],l[e[n]]+=1,r=s[n]=0,o=e[n];r<o;r++)s[n]=s[n]<<1|1&h,h>>>=1;return s}function D(t,e){this.input=t,this.a=new(a?Uint8Array:Array)(32768),this.h=R.j;var n,i={};for(n in!e&&(e={})||"number"!=typeof e.compressionType||(this.h=e.compressionType),e)i[n]=e[n];i.outputBuffer=this.a,this.z=new m(this.input,i)}var R=y;function M(e,n){switch(this.k=[],this.l=32768,this.e=this.g=this.c=this.q=0,this.input=a?new Uint8Array(e):e,this.s=!1,this.m=N,this.B=!1,!n&&(n={})||(n.index&&(this.c=n.index),n.bufferSize&&(this.l=n.bufferSize),n.bufferType&&(this.m=n.bufferType),n.resize&&(this.B=n.resize)),this.m){case O:this.b=32768,this.a=new(a?Uint8Array:Array)(32768+this.l+258);break;case N:this.b=0,this.a=new(a?Uint8Array:Array)(this.l),this.f=this.J,this.t=this.H,this.o=this.I;break;default:t(Error("invalid inflate mode"))}}D.prototype.n=function(){var e,n,i,r,s,c,l,h=0;switch(l=this.a,e=ht){case ht:n=Math.LOG2E*Math.log(32768)-8;break;default:t(Error("invalid compression method"))}switch(i=n<<4|e,l[h++]=i,e){case ht:switch(this.h){case R.NONE:s=0;break;case R.r:s=1;break;case R.j:s=2;break;default:t(Error("unsupported compression type"))}break;default:t(Error("invalid compression method"))}return r=s<<6|0,l[h++]=r|31-(256*i+r)%31,c=o(this.input),this.z.b=h,h=(l=this.z.n()).length,a&&((l=new Uint8Array(l.buffer)).length<=h+4&&(this.a=new Uint8Array(l.length+4),this.a.set(l),l=this.a),l=l.subarray(0,h+4)),l[h++]=c>>24&255,l[h++]=c>>16&255,l[h++]=c>>8&255,l[h++]=255&c,l},r("Zlib.Deflate",D),r("Zlib.Deflate.compress",(function(t,e){return new D(t,e).n()})),r("Zlib.Deflate.CompressionType",R),r("Zlib.Deflate.CompressionType.NONE",R.NONE),r("Zlib.Deflate.CompressionType.FIXED",R.r),r("Zlib.Deflate.CompressionType.DYNAMIC",R.j);var O=0,N=1,B={D:O,C:N};M.prototype.p=function(){for(;!this.s;){var i=tt(this,3);switch(1&i&&(this.s=n),i>>>=1){case 0:var r=this.input,o=this.c,s=this.a,c=this.b,l=e,h=e,u=e,_=s.length,f=e;switch(this.e=this.g=0,(l=r[o++])===e&&t(Error("invalid uncompressed block header: LEN (first byte)")),h=l,(l=r[o++])===e&&t(Error("invalid uncompressed block header: LEN (second byte)")),h|=l<<8,(l=r[o++])===e&&t(Error("invalid uncompressed block header: NLEN (first byte)")),u=l,(l=r[o++])===e&&t(Error("invalid uncompressed block header: NLEN (second byte)")),h===~(u|=l<<8)&&t(Error("invalid uncompressed block header: length verify")),o+h>r.length&&t(Error("input buffer is broken")),this.m){case O:for(;c+h>s.length;){if(h-=f=_-c,a)s.set(r.subarray(o,o+f),c),c+=f,o+=f;else for(;f--;)s[c++]=r[o++];this.b=c,s=this.f(),c=this.b}break;case N:for(;c+h>s.length;)s=this.f({v:2});break;default:t(Error("invalid inflate mode"))}if(a)s.set(r.subarray(o,o+h),c),c+=h,o+=h;else for(;h--;)s[c++]=r[o++];this.c=o,this.b=c,this.a=s;break;case 1:this.o(Q,$);break;case 2:nt(this);break;default:t(Error("unknown BTYPE: "+i))}}return this.t()};var L,F,V=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],z=a?new Uint16Array(V):V,k=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,258,258],U=a?new Uint16Array(k):k,G=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0],H=a?new Uint8Array(G):G,j=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],W=a?new Uint16Array(j):j,q=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],X=a?new Uint8Array(q):q,Y=new(a?Uint8Array:Array)(288);for(L=0,F=Y.length;L<F;++L)Y[L]=143>=L?8:255>=L?9:279>=L?7:8;var K,J,Q=p(Y),Z=new(a?Uint8Array:Array)(30);for(K=0,J=Z.length;K<J;++K)Z[K]=5;var $=p(Z);function tt(n,i){for(var r,a=n.g,o=n.e,s=n.input,c=n.c;o<i;)(r=s[c++])===e&&t(Error("input buffer is broken")),a|=r<<o,o+=8;return r=a&(1<<i)-1,n.g=a>>>i,n.e=o-i,n.c=c,r}function et(n,i){for(var r,a,o,s=n.g,c=n.e,l=n.input,h=n.c,u=i[0],_=i[1];c<_;)(r=l[h++])===e&&t(Error("input buffer is broken")),s|=r<<c,c+=8;return o=(a=u[s&(1<<_)-1])>>>16,n.g=s>>o,n.e=c-o,n.c=h,65535&a}function nt(t){function e(t,e,n){var i,r,a,o;for(o=0;o<t;)switch(i=et(this,e)){case 16:for(a=3+tt(this,2);a--;)n[o++]=r;break;case 17:for(a=3+tt(this,3);a--;)n[o++]=0;r=0;break;case 18:for(a=11+tt(this,7);a--;)n[o++]=0;r=0;break;default:r=n[o++]=i}return n}var n,i,r,o,s=tt(t,5)+257,c=tt(t,5)+1,l=tt(t,4)+4,h=new(a?Uint8Array:Array)(z.length);for(o=0;o<l;++o)h[z[o]]=tt(t,3);n=p(h),i=new(a?Uint8Array:Array)(s),r=new(a?Uint8Array:Array)(c),t.o(p(e.call(t,s,n,i)),p(e.call(t,c,n,r)))}function it(e,n){var i,r;switch(this.input=e,this.c=0,!n&&(n={})||(n.index&&(this.c=n.index),n.verify&&(this.M=n.verify)),i=e[this.c++],r=e[this.c++],15&i){case ht:this.method=ht;break;default:t(Error("unsupported compression method"))}0!=((i<<8)+r)%31&&t(Error("invalid fcheck flag:"+((i<<8)+r)%31)),32&r&&t(Error("fdict flag is not supported")),this.A=new M(e,{index:this.c,bufferSize:n.bufferSize,bufferType:n.bufferType,resize:n.resize})}M.prototype.o=function(t,e){var n=this.a,i=this.b;this.u=t;for(var r,a,o,s,c=n.length-258;256!==(r=et(this,t));)if(256>r)i>=c&&(this.b=i,n=this.f(),i=this.b),n[i++]=r;else for(s=U[a=r-257],0<H[a]&&(s+=tt(this,H[a])),r=et(this,e),o=W[r],0<X[r]&&(o+=tt(this,X[r])),i>=c&&(this.b=i,n=this.f(),i=this.b);s--;)n[i]=n[i++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=i},M.prototype.I=function(t,e){var n=this.a,i=this.b;this.u=t;for(var r,a,o,s,c=n.length;256!==(r=et(this,t));)if(256>r)i>=c&&(c=(n=this.f()).length),n[i++]=r;else for(s=U[a=r-257],0<H[a]&&(s+=tt(this,H[a])),r=et(this,e),o=W[r],0<X[r]&&(o+=tt(this,X[r])),i+s>c&&(c=(n=this.f()).length);s--;)n[i]=n[i++-o];for(;8<=this.e;)this.e-=8,this.c--;this.b=i},M.prototype.f=function(){var t,e,n=new(a?Uint8Array:Array)(this.b-32768),i=this.b-32768,r=this.a;if(a)n.set(r.subarray(32768,n.length));else for(t=0,e=n.length;t<e;++t)n[t]=r[t+32768];if(this.k.push(n),this.q+=n.length,a)r.set(r.subarray(i,i+32768));else for(t=0;32768>t;++t)r[t]=r[i+t];return this.b=32768,r},M.prototype.J=function(t){var e,n,i,r=this.input.length/this.c+1|0,o=this.input,s=this.a;return t&&("number"==typeof t.v&&(r=t.v),"number"==typeof t.F&&(r+=t.F)),n=2>r?(i=(o.length-this.c)/this.u[2]/2*258|0)<s.length?s.length+i:s.length<<1:s.length*r,a?(e=new Uint8Array(n)).set(s):e=s,this.a=e},M.prototype.t=function(){var t,e,n,i,r,o=0,s=this.a,c=this.k,l=new(a?Uint8Array:Array)(this.q+(this.b-32768));if(0===c.length)return a?this.a.subarray(32768,this.b):this.a.slice(32768,this.b);for(e=0,n=c.length;e<n;++e)for(i=0,r=(t=c[e]).length;i<r;++i)l[o++]=t[i];for(e=32768,n=this.b;e<n;++e)l[o++]=s[e];return this.k=[],this.buffer=l},M.prototype.H=function(){var t,e=this.b;return a?this.B?(t=new Uint8Array(e)).set(this.a.subarray(0,e)):t=this.a.subarray(0,e):(this.a.length>e&&(this.a.length=e),t=this.a),this.buffer=t},it.prototype.p=function(){var e,n=this.input;return e=this.A.p(),this.c=this.A.c,this.M&&(n[this.c++]<<24|n[this.c++]<<16|n[this.c++]<<8|n[this.c++])>>>0!==o(e)&&t(Error("invalid adler-32 checksum")),e},r("Zlib.Inflate",it),r("Zlib.Inflate.BufferType",B),B.ADAPTIVE=B.C,B.BLOCK=B.D,r("Zlib.Inflate.prototype.decompress",it.prototype.p);var rt,at,ot=new(a?Uint8Array:Array)(288);for(rt=0,at=ot.length;rt<at;++rt)ot[rt]=143>=rt?8:255>=rt?9:279>=rt?7:8;p(ot);var st,ct,lt=new(a?Uint8Array:Array)(30);for(st=0,ct=lt.length;st<ct;++st)lt[st]=5;p(lt);var ht=8}).call(V9);var z9=V9.Zlib;z9.Deflate=z9.Deflate,z9.Deflate.compress=z9.Deflate.compress,z9.Inflate=z9.Inflate,z9.Inflate.BufferType=z9.Inflate.BufferType,z9.Inflate.prototype.decompress=z9.Inflate.prototype.decompress;for(var k9=function(){function t(t){var e,n=this;this.pos=8,this.palette=[],this.imgData=[],this.text={},this.width=0,this.height=0,this.bits=0,this.colorType=0,this.compressionMethod=0,this.filterMethod=0,this.interlaceMethod=0,this.colors=0,this.hasAlphaChannel=!1,this.pixelBitlength=0,this.data=t,this.transparency={indexed:[],rgb:0,grayscale:0};for(var i=0,r=0,a=0;;){a=this.readUInt32();var o=function(){var t=[];for(i=0;i<4;++i)t.push(String.fromCharCode(n.data[n.pos++]));return t}.call(this).join("");switch(o){case"IHDR":this.width=this.readUInt32(),this.height=this.readUInt32(),this.bits=this.data[this.pos++],this.colorType=this.data[this.pos++],this.compressionMethod=this.data[this.pos++],this.filterMethod=this.data[this.pos++],this.interlaceMethod=this.data[this.pos++];break;case"acTL":this.animation={numFrames:this.readUInt32(),numPlays:this.readUInt32()||1/0,frames:[]};break;case"PLTE":this.palette=this.read(a);break;case"fcTL":e&&this.animation.frames.push(e),this.pos+=4,e={width:this.readUInt32(),height:this.readUInt32(),xOffset:this.readUInt32(),yOffset:this.readUInt32()};var s=this.readUInt16(),c=this.readUInt16()||100;e.delay=1e3*s/c,e.disposeOp=this.data[this.pos++],e.blendOp=this.data[this.pos++],e.data=[];break;case"IDAT":case"fdAT":for("fdAT"===o&&(this.pos+=4,a-=4),t=(null!=e?e.data:void 0)||this.imgData,i=0;a>=0?i<a:i>a;a>=0?++i:--i)t.push(this.data[this.pos++]);break;case"tRNS":switch(this.transparency={},this.colorType){case 3:this.transparency.indexed=this.read(a);var l=255-this.transparency.indexed.length;if(l>0)for(r=0;l>=0?r<l:r>l;l>=0?++r:--r)this.transparency.indexed.push(255);break;case 0:this.transparency.grayscale=this.read(a)[0];break;case 2:this.transparency.rgb=this.read(a)}break;case"tEXt":var h=this.read(a),u=h.indexOf(0),_=String.fromCharCode.apply(String,h.slice(0,u));this.text[_]=String.fromCharCode.apply(String,h.slice(u+1));break;case"IEND":e&&this.animation.frames.push(e),this.colors=function(){switch(n.colorType){case 0:case 3:case 4:return 1;case 2:case 6:return 3}}.call(this);var f=this.colorType;this.hasAlphaChannel=4===f||6===f;var d=this.colors+(this.hasAlphaChannel?1:0);return this.pixelBitlength=this.bits*d,this.colorSpace=function(){switch(n.colors){case 1:return"DeviceGray";case 3:return"DeviceRGB"}}.call(this),void(this.imgData instanceof Uint8Array||(this.imgData=new Uint8Array(this.imgData)));default:this.pos+=a}if(this.pos+=4,this.pos>this.data.length)throw new Error(F(6017))}}var e=t.prototype;return e.read=function(t){var e=0,n=[];for(e=0;t>=0?e<t:e>t;t>=0?++e:--e)n.push(this.data[this.pos++]);return n},e.readUInt32=function(){return this.data[this.pos++]<<24|this.data[this.pos++]<<16|this.data[this.pos++]<<8|this.data[this.pos++]},e.readUInt16=function(){return this.data[this.pos++]<<8|this.data[this.pos++]},e.decodePixels=function(t){if(null==t&&(t=this.imgData),0===t.length)return new Uint8Array(0);t=new z9.Inflate(t,{index:0,verify:!1}).decompress();for(var e=this.pixelBitlength/8,n=e*this.width,i=new Uint8Array(n*this.height),r=t.length,a=0,o=0,s=0,c=0,l=0,h=0,u=0,_=0,f=0,d=0,p=0,m=0,v=0,g=0,y=0,x=0,S=0,A=0,b=0;o<r;){switch(t[o++]){case 0:for(h=u=0;u<n;h=u+=1)i[s++]=t[o++];break;case 1:for(h=_=0;_<n;h=_+=1)c=t[o++],m=h<e?0:i[s-e],i[s++]=(c+m)%256;break;case 2:for(h=f=0;f<n;h=f+=1)c=t[o++],l=(h-h%e)/e,A=a&&i[(a-1)*n+l*e+h%e],i[s++]=(A+c)%256;break;case 3:for(h=d=0;d<n;h=d+=1)c=t[o++],l=(h-h%e)/e,m=h<e?0:i[s-e],A=a&&i[(a-1)*n+l*e+h%e],i[s++]=(c+Math.floor((m+A)/2))%256;break;case 4:for(h=p=0;p<n;h=p+=1)c=t[o++],l=(h-h%e)/e,m=h<e?0:i[s-e],0===a?A=b=0:(A=i[(a-1)*n+l*e+h%e],b=l&&i[(a-1)*n+(l-1)*e+h%e]),v=m+A-b,g=Math.abs(v-m),x=Math.abs(v-A),S=Math.abs(v-b),y=g<=x&&g<=S?m:x<=S?A:b,i[s++]=(c+y)%256;break;default:throw new Error(F(6018,t[o-1]))}a++}return i},e.copyToImageData=function(t,e){var n,i=this.hasAlphaChannel,r=this.colors;this.palette.length&&(n=null!=this._decodedPalette?this._decodedPalette:this._decodedPalette=this.decodePalette(),r=4,i=!0);var a=t.data||t,o=a.length,s=n||e,c=0,l=0,h=0,u=0;if(1===r)for(;c<o;)h=n?4*e[c/4]:l,u=s[h++],a[c++]=u,a[c++]=u,a[c++]=u,a[c++]=i?s[h++]:255,l=h;else for(;c<o;)h=n?4*e[c/4]:l,a[c++]=s[h++],a[c++]=s[h++],a[c++]=s[h++],a[c++]=i?s[h++]:255,l=h},e.decodePalette=function(){for(var t=this.palette,e=this.transparency.indexed||[],n=new Uint8Array((e.length||0)+t.length),i=0,r=0,a=0,o=0,s=0,c=t.length;s<c;o=s+=3)n[i++]=t[o],n[i++]=t[o+1],n[i++]=t[o+2],a=e[r++],n[i++]=null!=a?a:255;return n},e.render=function(t){t.width=this.width,t.height=this.height;var e=t.getContext("2d"),n=e.createImageData(this.width,this.height);return this.copyToImageData(n,this.decodePixels(null)),e.putImageData(n,0,0)},t}(),U9=function(){function t(){this._littleEndian=!1,this._tiffData=[],this._fileDirectories=[]}var e=t.prototype;return e.getUint8=function(t){return this._tiffData[t]},e.getUint16=function(t){return this._littleEndian?this._tiffData[t+1]<<8|this._tiffData[t]:this._tiffData[t]<<8|this._tiffData[t+1]},e.getUint32=function(t){var e=this._tiffData;return this._littleEndian?e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]:e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]},e.checkLittleEndian=function(){var t=this.getUint16(0);if(18761===t)this._littleEndian=!0;else{if(19789!==t)throw console.log(t),TypeError(F(6019));this._littleEndian=!1}return this._littleEndian},e.hasTowel=function(){if(42!==this.getUint16(2))throw RangeError(F(6020));return!0},e.getFieldTypeName=function(t){return t in H9?H9[t]:null},e.getFieldTagName=function(t){return t in G9?G9[t]:(P(6021,t),"Tag"+t)},e.getFieldTypeLength=function(t){return-1!==["BYTE","ASCII","SBYTE","UNDEFINED"].indexOf(t)?1:-1!==["SHORT","SSHORT"].indexOf(t)?2:-1!==["LONG","SLONG","FLOAT"].indexOf(t)?4:-1!==["RATIONAL","SRATIONAL","DOUBLE"].indexOf(t)?8:0},e.getFieldValues=function(t,e,n,i){var r=[],a=this.getFieldTypeLength(e);if(a*n<=4)!1===this._littleEndian?r.push(i>>>8*(4-a)):r.push(i);else for(var o=0;o<n;o++){var s=a*o;a>=8?-1!==["RATIONAL","SRATIONAL"].indexOf(e)?(r.push(this.getUint32(i+s)),r.push(this.getUint32(i+s+4))):P(8e3):r.push(this.getBytes(a,i+s))}return"ASCII"===e&&r.forEach((function(t,e,n){n[e]=String.fromCharCode(t)})),r},e.getBytes=function(t,e){if(t<=0)P(8001);else{if(t<=1)return this.getUint8(e);if(t<=2)return this.getUint16(e);if(t<=3)return this.getUint32(e)>>>8;if(t<=4)return this.getUint32(e);P(8002)}return 0},e.getBits=function(t,e,n){n=n||0;var i=e+Math.floor(n/8),r=n+t,a=32-t,o=0,s=0;return r<=0?P(6023):r<=8?(o=24+n,s=this.getUint8(i)):r<=16?(o=16+n,s=this.getUint16(i)):r<=32?(o=n,s=this.getUint32(i)):P(6022),{bits:s<<o>>>a,byteOffset:i+Math.floor(r/8),bitOffset:r%8}},e.parseFileDirectory=function(t){var e=this.getUint16(t),n=[],i=0,r=0;for(i=t+2,r=0;r<e;i+=12,r++){var a=this.getUint16(i),o=this.getUint16(i+2),s=this.getUint32(i+4),c=this.getUint32(i+8),l=this.getFieldTagName(a),h=this.getFieldTypeName(o),u=this.getFieldValues(l,h,s,c);n[l]={type:h,values:u}}this._fileDirectories.push(n);var _=this.getUint32(i);0!==_&&this.parseFileDirectory(_)},e.clampColorSample=function(t,e){var n=Math.pow(2,8-e);return Math.floor(t*n+(n-1))},e.parseTIFF=function(t,e){var n=this;if(e=e||document.createElement("canvas"),this._tiffData=t,this._canvas=e,this.checkLittleEndian(),this.hasTowel()){var i=this.getUint32(4);this._fileDirectories.length=0,this.parseFileDirectory(i);var r=this._fileDirectories[0],a=r.ImageWidth.values[0],o=r.ImageLength.values[0];this._canvas.width=a,this._canvas.height=o;var s=[],c=r.Compression?r.Compression.values[0]:1,l=r.SamplesPerPixel.values[0],h=[],u=0,_=!1;r.BitsPerSample.values.forEach((function(t,e){h[e]={bitsPerSample:t,hasBytesPerSample:!1,bytesPerSample:void 0},t%8==0&&(h[e].hasBytesPerSample=!0,h[e].bytesPerSample=t/8),u+=t}),this);var f=0;u%8==0&&(_=!0,f=u/8);var d,p=r.StripOffsets.values,m=p.length;if(r.StripByteCounts)d=r.StripByteCounts.values;else{if(P(8003),1!==m)throw Error(F(6024));d=[Math.ceil(a*o*u/8)]}for(var v=1,g=1,y=0;y<m;y++){var x=p[y];s[y]=[];for(var S=d[y],A=0,b=0,C=1,T=!0,E=[],w=0,I=0,D=0;A<S;A+=C)switch(c){case 1:E=[];for(var R=0;R<l;R++){var M=h[R];if(!M.hasBytesPerSample){var O=this.getBits(M.bitsPerSample,x+A,b);throw E.push(O.bits),A=O.byteOffset-x,b=O.bitOffset,RangeError(F(6025))}var N=M.bytesPerSample*R;E.push(this.getBytes(M.bytesPerSample,x+A+N))}if(s[y].push(E),!_)throw C=0,RangeError(F(6026));C=f;break;case 2:case 3:case 4:case 5:case 6:case 7:break;case 32773:if(T){T=!1;var B=this.getUint8(x+A);B>=0&&B<=127?v=B+1:B>=-127&&B<=-1?g=1-B:T=!0}else{for(var L=this.getUint8(x+A),V=0;V<g;V++){var z=h[I];if(!z.hasBytesPerSample)throw RangeError(F(6025));D=D<<8*w|L,++w===z.bytesPerSample&&(E.push(D),D=w=0,I++),I===l&&(s[y].push(E),E=[],I=0)}0==--v&&(T=!0)}C=1}}if(e.getContext){var k=this._canvas.getContext("2d");k.fillStyle="rgba(255, 255, 255, 0)";var U=r.RowsPerStrip?r.RowsPerStrip.values[0]:o,G=s.length,H=o%U,j=0===H?U:H,W=U,q=0,X=r.PhotometricInterpretation.values[0],Y=[],K=0;r.ExtraSamples&&(K=(Y=r.ExtraSamples.values).length);var J=[],Q=0;r.ColorMap&&(J=r.ColorMap.values,Q=Math.pow(2,h[0].bitsPerSample));for(var Z=0;Z<G;Z++){Z+1===G&&(W=j);for(var $=s[Z].length,tt=q*Z,et=0,nt=0;et<W&&nt<$;et++)for(var it=0;it<a;it++,nt++){var rt=s[Z][nt],at=0,ot=0,st=0,ct=1;if(K>0)for(var lt=0;lt<K;lt++)if(1===Y[lt]||2===Y[lt]){ct=rt[3+lt]/256;break}!function(){switch(X){case 0:var t=0;h[0].hasBytesPerSample&&(t=Math.pow(16,2*h[0].bytesPerSample)),rt.forEach((function(e,n,i){i[n]=t-e}));case 1:at=ot=st=n.clampColorSample(rt[0],h[0].bitsPerSample);break;case 2:at=n.clampColorSample(rt[0],h[0].bitsPerSample),ot=n.clampColorSample(rt[1],h[1].bitsPerSample),st=n.clampColorSample(rt[2],h[2].bitsPerSample);break;case 3:if(void 0===J)throw Error(F(6027));var e=rt[0];at=n.clampColorSample(J[e],16),ot=n.clampColorSample(J[Q+e],16),st=n.clampColorSample(J[2*Q+e],16);break;default:throw RangeError(F(6028,X))}}(),k.fillStyle="rgba("+at+", "+ot+", "+st+", "+ct+")",k.fillRect(it,tt+et,1,1)}q=W}}return this._canvas}},t}(),G9={315:"Artist",258:"BitsPerSample",265:"CellLength",264:"CellWidth",320:"ColorMap",259:"Compression",33432:"Copyright",306:"DateTime",338:"ExtraSamples",266:"FillOrder",289:"FreeByteCounts",288:"FreeOffsets",291:"GrayResponseCurve",290:"GrayResponseUnit",316:"HostComputer",270:"ImageDescription",257:"ImageLength",256:"ImageWidth",271:"Make",281:"MaxSampleValue",280:"MinSampleValue",272:"Model",254:"NewSubfileType",274:"Orientation",262:"PhotometricInterpretation",284:"PlanarConfiguration",296:"ResolutionUnit",278:"RowsPerStrip",277:"SamplesPerPixel",305:"Software",279:"StripByteCounts",273:"StripOffsets",255:"SubfileType",263:"Threshholding",282:"XResolution",283:"YResolution",326:"BadFaxLines",327:"CleanFaxData",343:"ClipPath",328:"ConsecutiveBadFaxLines",433:"Decode",434:"DefaultImageColor",269:"DocumentName",336:"DotRange",321:"HalftoneHints",346:"Indexed",347:"JPEGTables",285:"PageName",297:"PageNumber",317:"Predictor",319:"PrimaryChromaticities",532:"ReferenceBlackWhite",339:"SampleFormat",559:"StripRowCounts",330:"SubIFDs",292:"T4Options",293:"T6Options",325:"TileByteCounts",323:"TileLength",324:"TileOffsets",322:"TileWidth",301:"TransferFunction",318:"WhitePoint",344:"XClipPathUnits",286:"XPosition",529:"YCbCrCoefficients",531:"YCbCrPositioning",530:"YCbCrSubSampling",345:"YClipPathUnits",287:"YPosition",37378:"ApertureValue",40961:"ColorSpace",36868:"DateTimeDigitized",36867:"DateTimeOriginal",34665:"Exif IFD",36864:"ExifVersion",33434:"ExposureTime",41728:"FileSource",37385:"Flash",40960:"FlashpixVersion",33437:"FNumber",42016:"ImageUniqueID",37384:"LightSource",37500:"MakerNote",37377:"ShutterSpeedValue",37510:"UserComment",33723:"IPTC",34675:"ICC Profile",700:"XMP",42112:"GDAL_METADATA",42113:"GDAL_NODATA",34377:"Photoshop"},H9={1:"BYTE",2:"ASCII",3:"SHORT",4:"LONG",5:"RATIONAL",6:"SBYTE",7:"UNDEFINED",8:"SSHORT",9:"SLONG",10:"SRATIONAL",11:"FLOAT",12:"DOUBLE"},j9=new Array(123),W9=0;W9<123;++W9)j9[W9]=64;for(var q9=0;q9<64;++q9)j9["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charCodeAt(q9)]=q9;var X9={name:"Jacob__Codec__Base64",decode:function(t){var e,n,i,r,a,o,s=[],c=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)e=j9[t.charCodeAt(c++)]<<2|(r=j9[t.charCodeAt(c++)])>>4,n=(15&r)<<4|(a=j9[t.charCodeAt(c++)])>>2,i=(3&a)<<6|(o=j9[t.charCodeAt(c++)]),s.push(String.fromCharCode(e)),64!==a&&s.push(String.fromCharCode(n)),64!==o&&s.push(String.fromCharCode(i));return s.join("")},decodeAsArray:function(t,e){var n,i,r,a=this.decode(t),o=[];for(n=0,r=a.length/e;n<r;n++)for(o[n]=0,i=e-1;i>=0;--i)o[n]+=a.charCodeAt(n*e+i)<<8*i;return o}},Y9=function(t){this.data=t,this.debug=!1,this.gpflags=void 0,this.files=0,this.unzipped=[],this.buf32k=new Array(32768),this.bIdx=0,this.modeZIP=!1,this.bytepos=0,this.bb=1,this.bits=0,this.nameBuf=[],this.fileout=void 0,this.literalTree=new Array(Y9.LITERALS),this.distanceTree=new Array(32),this.treepos=0,this.Places=null,this.len=0,this.fpos=new Array(17),this.fpos[0]=0,this.flens=void 0,this.fmax=void 0};Y9.gunzip=function(t){return t.constructor===Array||t.constructor,new Y9(t).gunzip()[0][0]},Y9.HufNode=function(){this.b0=0,this.b1=0,this.jump=null,this.jumppos=-1},Y9.LITERALS=288,Y9.NAMEMAX=256,Y9.bitReverse=[0,128,64,192,32,160,96,224,16,144,80,208,48,176,112,240,8,136,72,200,40,168,104,232,24,152,88,216,56,184,120,248,4,132,68,196,36,164,100,228,20,148,84,212,52,180,116,244,12,140,76,204,44,172,108,236,28,156,92,220,60,188,124,252,2,130,66,194,34,162,98,226,18,146,82,210,50,178,114,242,10,138,74,202,42,170,106,234,26,154,90,218,58,186,122,250,6,134,70,198,38,166,102,230,22,150,86,214,54,182,118,246,14,142,78,206,46,174,110,238,30,158,94,222,62,190,126,254,1,129,65,193,33,161,97,225,17,145,81,209,49,177,113,241,9,137,73,201,41,169,105,233,25,153,89,217,57,185,121,249,5,133,69,197,37,165,101,229,21,149,85,213,53,181,117,245,13,141,77,205,45,173,109,237,29,157,93,221,61,189,125,253,3,131,67,195,35,163,99,227,19,147,83,211,51,179,115,243,11,139,75,203,43,171,107,235,27,155,91,219,59,187,123,251,7,135,71,199,39,167,103,231,23,151,87,215,55,183,119,247,15,143,79,207,47,175,111,239,31,159,95,223,63,191,127,255],Y9.cplens=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Y9.cplext=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,99,99],Y9.cpdist=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],Y9.cpdext=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Y9.border=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Y9.prototype.gunzip=function(){return this.outputArr=[],this.nextFile(),this.unzipped},Y9.prototype.readByte=function(){return this.bits+=8,this.bytepos<this.data.length?this.data.charCodeAt(this.bytepos++):-1},Y9.prototype.byteAlign=function(){this.bb=1},Y9.prototype.readBit=function(){var t;return this.bits++,t=1&this.bb,this.bb>>=1,0===this.bb&&(this.bb=this.readByte(),t=1&this.bb,this.bb=this.bb>>1|128),t},Y9.prototype.readBits=function(t){for(var e=0,n=t;n--;)e=e<<1|this.readBit();return t&&(e=Y9.bitReverse[e]>>8-t),e},Y9.prototype.flushBuffer=function(){this.bIdx=0},Y9.prototype.addBuffer=function(t){this.buf32k[this.bIdx++]=t,this.outputArr.push(String.fromCharCode(t)),32768===this.bIdx&&(this.bIdx=0)},Y9.prototype.IsPat=function(){for(;;){if(this.fpos[this.len]>=this.fmax)return-1;if(this.flens[this.fpos[this.len]]===this.len)return this.fpos[this.len]++;this.fpos[this.len]++}},Y9.prototype.Rec=function(){var t,e=this.Places[this.treepos];if(17===this.len)return-1;if(this.treepos++,this.len++,(t=this.IsPat())>=0)e.b0=t;else if(e.b0=32768,this.Rec())return-1;if((t=this.IsPat())>=0)e.b1=t,e.jump=null;else if(e.b1=32768,e.jump=this.Places[this.treepos],e.jumppos=this.treepos,this.Rec())return-1;return this.len--,0},Y9.prototype.CreateTree=function(t,e,n){var i;for(this.Places=t,this.treepos=0,this.flens=n,this.fmax=e,i=0;i<17;i++)this.fpos[i]=0;return this.len=0,this.Rec()?-1:0},Y9.prototype.DecodeValue=function(t){for(var e,n,i=0,r=t[i];;)if(this.readBit()){if(!(32768&r.b1))return r.b1;for(r=r.jump,e=t.length,n=0;n<e;n++)if(t[n]===r){i=n;break}}else{if(!(32768&r.b0))return r.b0;r=t[++i]}return-1},Y9.prototype.DeflateLoop=function(){var t,e,n;do{var i,r;if(t=this.readBit(),0===(e=this.readBits(2)))for(this.byteAlign(),i=this.readByte(),i|=this.readByte()<<8,r=this.readByte(),65535&(i^~(r|=this.readByte()<<8))&&document.write("BlockLen checksum mismatch\n");i--;)a=this.readByte(),this.addBuffer(a);else if(1===e)for(;;)if((o=Y9.bitReverse[this.readBits(7)]>>1)>23?(o=o<<1|this.readBit())>199?o=(o-=128)<<1|this.readBit():(o-=48)>143&&(o+=136):o+=256,o<256)this.addBuffer(o);else{if(256===o)break;for(o-=257,d=this.readBits(Y9.cplext[o])+Y9.cplens[o],o=Y9.bitReverse[this.readBits(5)]>>3,Y9.cpdext[o]>8?(p=this.readBits(8),p|=this.readBits(Y9.cpdext[o]-8)<<8):p=this.readBits(Y9.cpdext[o]),p+=Y9.cpdist[o],o=0;o<d;o++){var a=this.buf32k[this.bIdx-p&32767];this.addBuffer(a)}}else if(2===e){var o,s,c,l,h,u=new Array(320);for(c=257+this.readBits(5),l=1+this.readBits(5),h=4+this.readBits(4),o=0;o<19;o++)u[o]=0;for(o=0;o<h;o++)u[Y9.border[o]]=this.readBits(3);for(d=this.distanceTree.length,n=0;n<d;n++)this.distanceTree[n]=new Y9.HufNode;if(this.CreateTree(this.distanceTree,19,u,0))return this.flushBuffer(),1;for(s=c+l,n=0;n<s;)if((o=this.DecodeValue(this.distanceTree))<16)u[n++]=o;else if(16===o){var _;if(n+(o=3+this.readBits(2))>s)return this.flushBuffer(),1;for(_=n?u[n-1]:0;o--;)u[n++]=_}else{if(n+(o=17===o?3+this.readBits(3):11+this.readBits(7))>s)return this.flushBuffer(),1;for(;o--;)u[n++]=0}for(d=this.literalTree.length,n=0;n<d;n++)this.literalTree[n]=new Y9.HufNode;if(this.CreateTree(this.literalTree,c,u,0))return this.flushBuffer(),1;for(d=this.literalTree.length,n=0;n<d;n++)this.distanceTree[n]=new Y9.HufNode;var f=new Array;for(n=c;n<u.length;n++)f[n-c]=u[n];if(this.CreateTree(this.distanceTree,l,f,0))return this.flushBuffer(),1;for(;;)if((o=this.DecodeValue(this.literalTree))>=256){var d,p;if(0==(o-=256))break;for(o--,d=this.readBits(Y9.cplext[o])+Y9.cplens[o],o=this.DecodeValue(this.distanceTree),Y9.cpdext[o]>8?(p=this.readBits(8),p|=this.readBits(Y9.cpdext[o]-8)<<8):p=this.readBits(Y9.cpdext[o]),p+=Y9.cpdist[o];d--;)a=this.buf32k[this.bIdx-p&32767],this.addBuffer(a)}else this.addBuffer(o)}}while(!t);return this.flushBuffer(),this.byteAlign(),0},Y9.prototype.unzipFile=function(t){var e;for(this.gunzip(),e=0;e<this.unzipped.length;e++)if(this.unzipped[e][1]===t)return this.unzipped[e][0]},Y9.prototype.nextFile=function(){this.outputArr=[],this.modeZIP=!1;var t=[];if(t[0]=this.readByte(),t[1]=this.readByte(),120===t[0]&&218===t[1]&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),"geonext.gxt"],this.files++),31===t[0]&&139===t[1]&&(this.skipdir(),this.unzipped[this.files]=[this.outputArr.join(""),"file"],this.files++),80===t[0]&&75===t[1]&&(this.modeZIP=!0,t[2]=this.readByte(),t[3]=this.readByte(),3===t[2]&&4===t[3])){t[0]=this.readByte(),t[1]=this.readByte(),this.gpflags=this.readByte(),this.gpflags|=this.readByte()<<8;var e=this.readByte();e|=this.readByte()<<8,this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte();var n=this.readByte();n|=this.readByte()<<8;var i=this.readByte();for(i|=this.readByte()<<8,a=0,this.nameBuf=[];n--;){var r=this.readByte();"/"===r|":"===r?a=0:a<Y9.NAMEMAX-1&&(this.nameBuf[a++]=String.fromCharCode(r))}this.fileout||(this.fileout=this.nameBuf);for(var a=0;a<i;)r=this.readByte(),a++;8===e&&(this.DeflateLoop(),this.unzipped[this.files]=[this.outputArr.join(""),this.nameBuf.join("")],this.files++),this.skipdir()}},Y9.prototype.skipdir=function(){var t,e,n=[];if(8&this.gpflags&&(n[0]=this.readByte(),n[1]=this.readByte(),n[2]=this.readByte(),n[3]=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte()),this.modeZIP&&this.nextFile(),n[0]=this.readByte(),8!==n[0])return 0;if(this.gpflags=this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),4&this.gpflags)for(n[0]=this.readByte(),n[2]=this.readByte(),this.len=n[0]+256*n[1],t=0;t<this.len;t++)this.readByte();if(8&this.gpflags)for(t=0,this.nameBuf=[];e=this.readByte();)"7"!==e&&":"!==e||(t=0),t<Y9.NAMEMAX-1&&(this.nameBuf[t++]=e);if(16&this.gpflags)for(;e=this.readByte(););2&this.gpflags&&(this.readByte(),this.readByte()),this.DeflateLoop(),this.readByte(),this.readByte(),this.readByte(),this.readByte(),this.modeZIP&&this.nextFile()};var K9,J9,Q9,Z9,$9,ttt,ett,ntt,itt,rtt,att,ott,stt,ctt,ltt,htt,utt,_tt,ftt,dtt,ptt,mtt,vtt,gtt,ytt,xtt,Stt,Att,btt,Ctt,Ttt,Ett,wtt,Itt,Ptt,Dtt,Rtt,Mtt,Ott,Ntt,Btt,Ltt,Ftt,Vtt,ztt,ktt,Utt,Gtt,Htt,jtt,Wtt,qtt,Xtt,Ytt,Ktt,Jtt,Qtt,Ztt,$tt,tet,eet,net,iet,ret,aet,oet,set,cet,het,uet,_et,fet,det,pet,met,vet,get,yet,xet,Aet,bet,Cet,Tet,Eet,wet,Iet,Pet,Det,Ret,Met,Oet,Net,Bet,Let,Fet,Vet,zet,ket,Uet,Get,Het,jet,Wet,qet={name:"Jacob__Codec"};function Xet(t){var e=t.parent,n=t.getComponent(cnt);return e&&n?Xet(e):t.getComponentsInChildren(cnt)}qet.Base64=X9,qet.GZip=Y9,qet.unzip=function(){return qet.GZip.gunzip.apply(qet.GZip,arguments)},qet.unzipBase64=function(){var t=qet.Base64.decode.apply(qet.Base64,arguments);try{return qet.GZip.gunzip.call(qet.GZip,t)}catch(e){return t.slice(7)}},qet.unzipBase64AsArray=function(t,e){e=e||1;var n,i,r,a=this.unzipBase64(t),o=[];for(n=0,r=a.length/e;n<r;n++)for(o[n]=0,i=e-1;i>=0;--i)o[n]+=a.charCodeAt(n*e+i)<<8*i;return o},qet.unzipAsArray=function(t,e){e=e||1;var n,i,r,a=this.unzip(t),o=[];for(n=0,r=a.length/e;n<r;n++)for(o[n]=0,i=e-1;i>=0;--i)o[n]+=a.charCodeAt(n*e+i)<<8*i;return o},function(t){t[t.JPG=0]="JPG",t[t.PNG=1]="PNG",t[t.TIFF=2]="TIFF",t[t.WEBP=3]="WEBP",t[t.PVR=4]="PVR",t[t.ETC=5]="ETC",t[t.S3TC=6]="S3TC",t[t.ATITC=7]="ATITC",t[t.TGA=8]="TGA",t[t.RAWDATA=9]="RAWDATA",t[t.UNKNOWN=10]="UNKNOWN"}(Wet||(Wet={}));var Yet,Ket,Jet,Qet,Zet,$et,tnt,ent,nnt,int,rnt,ant,ont,snt,cnt=t("ParticleSystem2D",(K9=Ec("cc.ParticleSystem2D"),J9=kc(),Q9=el(),Z9=Kc(),$9=cl(F9),ttt=el(),ett=Kc(),ntt=cl(oF),itt=Kc(),rtt=Kc(),att=Kc(),ott=Kc(),stt=Kc(),ctt=Kc(),ltt=Kc(),htt=Kc(),utt=qc(),_tt=Kc(),ftt=Kc(),dtt=Kc(),ptt=Kc(),mtt=Kc(),vtt=Kc(),gtt=Kc(),ytt=Kc(),xtt=Kc(),Stt=Kc(),Att=Kc(),btt=Kc(),Ctt=Kc(),Ttt=cl(w9),Ett=Kc(),wtt=el(),Itt=Kc(),Ptt=cl(E9),Dtt=Kc(),Rtt=Kc(),Mtt=Kc(),Ott=Kc(),Ntt=Kc(),Btt=Kc(),Ltt=Kc(),Ftt=Kc(),Vtt=Kc(),ztt=Kc(),ktt=Kc(),Utt=Kc(),Gtt=Kc(),Htt=Kc(),jtt=Kc(),Wtt=el(),qtt=Kc(),Xtt=el(),Ytt=Kc(),Ktt=Bc("preview"),K9(Jtt=J9(Jtt=Uc(Jtt=zc((jet=Het=function(t){function e(){var e;return ct(e=t.call(this)||this,"duration",Ztt,at(e)),ct(e,"emissionRate",$tt,at(e)),ct(e,"life",tet,at(e)),ct(e,"lifeVar",eet,at(e)),ct(e,"angle",net,at(e)),ct(e,"angleVar",iet,at(e)),ct(e,"startSize",ret,at(e)),ct(e,"startSizeVar",aet,at(e)),ct(e,"endSize",oet,at(e)),ct(e,"endSizeVar",set,at(e)),ct(e,"startSpin",cet,at(e)),ct(e,"startSpinVar",het,at(e)),ct(e,"endSpin",uet,at(e)),ct(e,"endSpinVar",_et,at(e)),ct(e,"sourcePos",fet,at(e)),ct(e,"posVar",det,at(e)),ct(e,"emitterMode",pet,at(e)),ct(e,"gravity",met,at(e)),ct(e,"speed",vet,at(e)),ct(e,"speedVar",get,at(e)),ct(e,"tangentialAccel",yet,at(e)),ct(e,"tangentialAccelVar",xet,at(e)),ct(e,"radialAccel",Aet,at(e)),ct(e,"radialAccelVar",bet,at(e)),ct(e,"rotationIsDir",Cet,at(e)),ct(e,"startRadius",Tet,at(e)),ct(e,"startRadiusVar",Eet,at(e)),ct(e,"endRadius",wet,at(e)),ct(e,"endRadiusVar",Iet,at(e)),ct(e,"rotatePerS",Pet,at(e)),ct(e,"rotatePerSVar",Det,at(e)),e.aspectRatio=1,ct(e,"playOnLoad",Ret,at(e)),ct(e,"autoRemoveOnFinish",Met,at(e)),ct(e,"_preview",Oet,at(e)),ct(e,"_custom",Net,at(e)),ct(e,"_file",Bet,at(e)),ct(e,"_spriteFrame",Let,at(e)),ct(e,"_totalParticles",Fet,at(e)),ct(e,"_startColor",Vet,at(e)),ct(e,"_startColorVar",zet,at(e)),ct(e,"_endColor",ket,at(e)),ct(e,"_endColorVar",Uet,at(e)),ct(e,"_positionType",Get,at(e)),e._stopped=!0,e.initProperties(),e}$(e,t);var n=e.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this._updateMaterial()},n.onDestroy=function(){t.prototype.onDestroy.call(this),this.autoRemoveOnFinish&&(this.autoRemoveOnFinish=!1),this._simulator.uvFilled=0,this._simulator.renderData&&this._assembler&&this._assembler.removeData(this._simulator.renderData)},n.initProperties=function(){this._previewTimer=null,this._focused=!1,this.aspectRatio=1,this._simulator=new L9(this)},n.onFocusInEditor=function(){this._focused=!0;for(var t=Xet(this.node),e=0;e<t.length;++e)t[e]._startPreview()},n.onLostFocusInEditor=function(){this._focused=!1;for(var t=Xet(this.node),e=0;e<t.length;++e)t[e]._stopPreview()},n._startPreview=function(){this._preview&&this.resetSystem()},n._stopPreview=function(){this._preview&&(this.resetSystem(),this.stopSystem()),this._previewTimer&&clearInterval(this._previewTimer)},n.__preload=function(){t.prototype.__preload.call(this),this._custom&&this.spriteFrame&&!this._renderSpriteFrame?this._applySpriteFrame():this._file&&(this._custom?!this._getTexture()&&this._applyFile():this._applyFile()),this.playOnLoad&&this.resetSystem()},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._assembler&&this._assembler.createData&&(this._simulator.renderData=this._assembler.createData(this))},n.lateUpdate=function(t){this._simulator.finished||this._simulator.step(t)},n.addParticle=function(){},n.stopSystem=function(){this._stopped=!0,this._simulator.stop()},n.resetSystem=function(){this._stopped=!1,this._simulator.reset(),this._renderFlag=this._canRender()},n.isFull=function(){return this.particleCount>=this.totalParticles},n._applyFile=function(){var t=this._file;if(t){if(!t)return void O(6029);if(!this.isValid)return;this._plistFile=t.nativeUrl,this._custom||(this._spriteFrame!==t.spriteFrame&&(this.spriteFrame=t.spriteFrame),this._initWithDictionary(t._nativeAsset)),this._spriteFrame?!this._renderSpriteFrame&&this._spriteFrame&&this._applySpriteFrame():t.spriteFrame?this.spriteFrame=t.spriteFrame:this._custom&&this._initTextureWithDictionary(t._nativeAsset)}},n._initTextureWithDictionary=function(t){var e,n=this;if(t.spriteFrameUuid){var i=t.spriteFrameUuid;VN.loadAny(i,(function(e,i){e?(t.spriteFrameUuid=void 0,n._initTextureWithDictionary(t),A(e)):n.spriteFrame=i}))}else{var r=qh(this._plistFile,t.textureFileName||"");if(t.textureFileName)VN.loadRemote(r,(function(e,i){e?(t.textureFileName=void 0,n._initTextureWithDictionary(t),A(e)):n.spriteFrame=i?oF.createWithImage(i):oF.createWithImage(Uv.get("white-texture"))}));else if(t.textureImageData){var a=t.textureImageData;if(!(a&&a.length>0))return!1;var o=VN.assets.get(r);if(!o){var s=qet.unzipBase64AsArray(a,1);if(!s)return R(6030,this._file.name),!1;var c=(e=s).length>8&&137===e[0]&&80===e[1]&&78===e[2]&&71===e[3]&&13===e[4]&&10===e[5]&&26===e[6]&&10===e[7]?Wet.PNG:e.length>2&&(73===e[0]&&73===e[1]||77===e[0]&&77===e[1]||255===e[0]&&216===e[1])?Wet.TIFF:Wet.UNKNOWN;if(c!==Wet.TIFF&&c!==Wet.PNG)return R(6031,this._file.name),!1;var l=document.createElement("canvas");c===Wet.PNG?new k9(s).render(l):(this._tiffReader||(this._tiffReader=new U9),this._tiffReader.parseTIFF(s,l)),o=new lv(l),VN.assets.add(r,o)}o||R(6032,this._file.name),this.spriteFrame=o?oF.createWithImage(o):oF.createWithImage(Uv.get("white-texture"))}}return!0},n._initWithDictionary=function(t){this.totalParticles=parseInt(t.maxParticles||0),this.life=parseFloat(t.particleLifespan||0),this.lifeVar=parseFloat(t.particleLifespanVariance||0);var e=t.emissionRate;this.emissionRate=e||Math.min(this.totalParticles/this.life,Number.MAX_VALUE),this.duration=parseFloat(t.duration||0),this._srcBlendFactor=parseInt(t.blendFuncSource||Oi.SRC_ALPHA),this._dstBlendFactor=parseInt(t.blendFuncDestination||Oi.ONE_MINUS_SRC_ALPHA);var n=this._startColor;n.r=255*parseFloat(t.startColorRed||0),n.g=255*parseFloat(t.startColorGreen||0),n.b=255*parseFloat(t.startColorBlue||0),n.a=255*parseFloat(t.startColorAlpha||0);var i=this._startColorVar;i.r=255*parseFloat(t.startColorVarianceRed||0),i.g=255*parseFloat(t.startColorVarianceGreen||0),i.b=255*parseFloat(t.startColorVarianceBlue||0),i.a=255*parseFloat(t.startColorVarianceAlpha||0);var r=this._endColor;r.r=255*parseFloat(t.finishColorRed||0),r.g=255*parseFloat(t.finishColorGreen||0),r.b=255*parseFloat(t.finishColorBlue||0),r.a=255*parseFloat(t.finishColorAlpha||0);var a=this._endColorVar;if(a.r=255*parseFloat(t.finishColorVarianceRed||0),a.g=255*parseFloat(t.finishColorVarianceGreen||0),a.b=255*parseFloat(t.finishColorVarianceBlue||0),a.a=255*parseFloat(t.finishColorVarianceAlpha||0),this.startSize=parseFloat(t.startParticleSize||0),this.startSizeVar=parseFloat(t.startParticleSizeVariance||0),this.endSize=parseFloat(t.finishParticleSize||0),this.endSizeVar=parseFloat(t.finishParticleSizeVariance||0),this.positionType=parseFloat(void 0!==t.positionType?t.positionType:w9.FREE),this.sourcePos.set(0,0),this.posVar.set(parseFloat(t.sourcePositionVariancex||0),parseFloat(t.sourcePositionVariancey||0)),this.angle=parseFloat(t.angle||0),this.angleVar=parseFloat(t.angleVariance||0),this.startSpin=parseFloat(t.rotationStart||0),this.startSpinVar=parseFloat(t.rotationStartVariance||0),this.endSpin=parseFloat(t.rotationEnd||0),this.endSpinVar=parseFloat(t.rotationEndVariance||0),this.emitterMode=parseInt(t.emitterType||E9.GRAVITY),this.emitterMode===E9.GRAVITY){this.gravity.set(parseFloat(t.gravityx||0),parseFloat(t.gravityy||0)),this.speed=parseFloat(t.speed||0),this.speedVar=parseFloat(t.speedVariance||0),this.radialAccel=parseFloat(t.radialAcceleration||0),this.radialAccelVar=parseFloat(t.radialAccelVariance||0),this.tangentialAccel=parseFloat(t.tangentialAcceleration||0),this.tangentialAccelVar=parseFloat(t.tangentialAccelVariance||0);var o=t.rotationIsDir||"";null!==o?(o=o.toString().toLowerCase(),this.rotationIsDir="true"===o||"1"===o):this.rotationIsDir=!1}else{if(this.emitterMode!==E9.RADIUS)return R(6009),!1;this.startRadius=parseFloat(t.maxRadius||0),this.startRadiusVar=parseFloat(t.maxRadiusVariance||0),this.endRadius=parseFloat(t.minRadius||0),this.endRadiusVar=parseFloat(t.minRadiusVariance||0),this.rotatePerS=parseFloat(t.rotatePerSecond||0),this.rotatePerSVar=parseFloat(t.rotatePerSecondVariance||0)}return this._initTextureWithDictionary(t),!0},n._syncAspect=function(){if(this._renderSpriteFrame){var t=this._renderSpriteFrame.rect;this.aspectRatio=t.width/t.height}},n._applySpriteFrame=function(){this._renderSpriteFrame=this._renderSpriteFrame||this._spriteFrame,this._renderSpriteFrame?this._renderSpriteFrame.texture&&(this._simulator.updateUVs(!0),this._syncAspect(),this._updateMaterial(),this._stopped=!1,this._renderFlag=this._canRender()):this.resetSystem()},n._getTexture=function(){return this._renderSpriteFrame&&this._renderSpriteFrame.texture},n._updateMaterial=function(){var t=this.getMaterialInstance(0);t&&t.recompileShaders({USE_LOCAL:this._positionType!==w9.FREE})},n._finishedSimulation=function(){this.resetSystem(),this.stopSystem(),this._renderFlag=this._canRender(),this.autoRemoveOnFinish&&this._stopped&&this.node.destroy()},n._canRender=function(){return t.prototype._canRender.call(this)&&!this._stopped&&null!==this._renderSpriteFrame},n._render=function(t){this._positionType===w9.RELATIVE?t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,this.node.parent):this.positionType===w9.GROUPED?t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,this.node):t.commitComp(this,this._simulator.renderData,this._renderSpriteFrame,this._assembler,null)},Q(e,[{key:"custom",get:function(){return this._custom},set:function(t){this._custom!==t&&(this._custom=t,this._applyFile())}},{key:"file",get:function(){return this._file},set:function(t){this._file!==t&&(this._file=t,t?this._applyFile():this.custom=!0)}},{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._renderSpriteFrame!==t&&(this._renderSpriteFrame=t,t&&!t._uuid||(this._spriteFrame=t),this._applySpriteFrame())}},{key:"particleCount",get:function(){return this._simulator.particles.length}},{key:"totalParticles",get:function(){return this._totalParticles},set:function(t){this._totalParticles!==t&&(this._totalParticles=t)}},{key:"startColor",get:function(){return this._startColor},set:function(t){this._startColor.r=t.r,this._startColor.g=t.g,this._startColor.b=t.b,this._startColor.a=t.a}},{key:"startColorVar",get:function(){return this._startColorVar},set:function(t){this._startColorVar.r=t.r,this._startColorVar.g=t.g,this._startColorVar.b=t.b,this._startColorVar.a=t.a}},{key:"color",get:function(){return this._color},set:function(){}},{key:"endColor",get:function(){return this._endColor},set:function(t){this._endColor.r=t.r,this._endColor.g=t.g,this._endColor.b=t.b,this._endColor.a=t.a}},{key:"endColorVar",get:function(){return this._endColorVar},set:function(t){this._endColorVar.r=t.r,this._endColorVar.g=t.g,this._endColorVar.b=t.b,this._endColorVar.a=t.a}},{key:"positionType",get:function(){return this._positionType},set:function(t){this._positionType=t,this._updateMaterial()}},{key:"preview",get:function(){return this._preview},set:function(t){t?this._startPreview():this._stopPreview(),this._preview=t}},{key:"stopped",get:function(){return this._stopped}},{key:"active",get:function(){return this._simulator.active}},{key:"assembler",get:function(){return this._assembler}}]),e}(xk),Het.EmitterMode=E9,Het.PositionType=w9,Het.DURATION_INFINITY=-1,Het.START_SIZE_EQUAL_TO_END_SIZE=-1,Het.START_RADIUS_EQUAL_TO_END_RADIUS=-1,lt((Qtt=jet).prototype,"custom",[Wc,Q9,Z9],Object.getOwnPropertyDescriptor(Qtt.prototype,"custom"),Qtt.prototype),lt(Qtt.prototype,"file",[$9,ttt,ett],Object.getOwnPropertyDescriptor(Qtt.prototype,"file"),Qtt.prototype),lt(Qtt.prototype,"spriteFrame",[ntt,itt],Object.getOwnPropertyDescriptor(Qtt.prototype,"spriteFrame"),Qtt.prototype),lt(Qtt.prototype,"totalParticles",[Wc,rtt],Object.getOwnPropertyDescriptor(Qtt.prototype,"totalParticles"),Qtt.prototype),Ztt=lt(Qtt.prototype,"duration",[Nc,Wc,att],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),$tt=lt(Qtt.prototype,"emissionRate",[Nc,Wc,ott],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),tet=lt(Qtt.prototype,"life",[Nc,Wc,stt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),eet=lt(Qtt.prototype,"lifeVar",[Nc,Wc,ctt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),lt(Qtt.prototype,"startColor",[Wc,ltt],Object.getOwnPropertyDescriptor(Qtt.prototype,"startColor"),Qtt.prototype),lt(Qtt.prototype,"startColorVar",[Wc,htt],Object.getOwnPropertyDescriptor(Qtt.prototype,"startColorVar"),Qtt.prototype),lt(Qtt.prototype,"color",[utt],Object.getOwnPropertyDescriptor(Qtt.prototype,"color"),Qtt.prototype),lt(Qtt.prototype,"endColor",[Wc,_tt],Object.getOwnPropertyDescriptor(Qtt.prototype,"endColor"),Qtt.prototype),lt(Qtt.prototype,"endColorVar",[Wc,ftt],Object.getOwnPropertyDescriptor(Qtt.prototype,"endColorVar"),Qtt.prototype),net=lt(Qtt.prototype,"angle",[Nc,Wc,dtt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 90}}),iet=lt(Qtt.prototype,"angleVar",[Nc,Wc,ptt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),ret=lt(Qtt.prototype,"startSize",[Nc,Wc,mtt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),aet=lt(Qtt.prototype,"startSizeVar",[Nc,Wc,vtt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),oet=lt(Qtt.prototype,"endSize",[Nc,Wc,gtt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),set=lt(Qtt.prototype,"endSizeVar",[Nc,Wc,ytt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),cet=lt(Qtt.prototype,"startSpin",[Nc,Wc,xtt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),het=lt(Qtt.prototype,"startSpinVar",[Nc,Wc,Stt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),uet=lt(Qtt.prototype,"endSpin",[Nc,Wc,Att],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_et=lt(Qtt.prototype,"endSpinVar",[Nc,Wc,btt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),fet=lt(Qtt.prototype,"sourcePos",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qn.ZERO.clone()}}),det=lt(Qtt.prototype,"posVar",[Nc,Wc,Ctt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qn.ZERO.clone()}}),lt(Qtt.prototype,"positionType",[Ttt,Ett],Object.getOwnPropertyDescriptor(Qtt.prototype,"positionType"),Qtt.prototype),lt(Qtt.prototype,"preview",[Wc,wtt,Itt],Object.getOwnPropertyDescriptor(Qtt.prototype,"preview"),Qtt.prototype),pet=lt(Qtt.prototype,"emitterMode",[Nc,Wc,Ptt,Dtt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return E9.GRAVITY}}),met=lt(Qtt.prototype,"gravity",[Nc,Wc,Rtt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qn.ZERO.clone()}}),vet=lt(Qtt.prototype,"speed",[Nc,Wc,Mtt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 180}}),get=lt(Qtt.prototype,"speedVar",[Nc,Wc,Ott],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),yet=lt(Qtt.prototype,"tangentialAccel",[Nc,Wc,Ntt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 80}}),xet=lt(Qtt.prototype,"tangentialAccelVar",[Nc,Wc,Btt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Aet=lt(Qtt.prototype,"radialAccel",[Nc,Wc,Ltt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),bet=lt(Qtt.prototype,"radialAccelVar",[Nc,Wc,Ftt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Cet=lt(Qtt.prototype,"rotationIsDir",[Nc,Wc,Vtt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Tet=lt(Qtt.prototype,"startRadius",[Nc,Wc,ztt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Eet=lt(Qtt.prototype,"startRadiusVar",[Nc,Wc,ktt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),wet=lt(Qtt.prototype,"endRadius",[Nc,Wc,Utt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Iet=lt(Qtt.prototype,"endRadiusVar",[Nc,Wc,Gtt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Pet=lt(Qtt.prototype,"rotatePerS",[Nc,Wc,Htt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Det=lt(Qtt.prototype,"rotatePerSVar",[Nc,Wc,jtt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ret=lt(Qtt.prototype,"playOnLoad",[Nc,Wc,Wtt,qtt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Met=lt(Qtt.prototype,"autoRemoveOnFinish",[Nc,Wc,Xtt,Ytt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Oet=lt(Qtt.prototype,"_preview",[Ktt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Net=lt(Qtt.prototype,"_custom",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Bet=lt(Qtt.prototype,"_file",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Let=lt(Qtt.prototype,"_spriteFrame",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fet=lt(Qtt.prototype,"_totalParticles",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 150}}),Vet=lt(Qtt.prototype,"_startColor",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn(255,255,255,255)}}),zet=lt(Qtt.prototype,"_startColorVar",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn(0,0,0,0)}}),ket=lt(Qtt.prototype,"_endColor",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn(255,255,255,0)}}),Uet=lt(Qtt.prototype,"_endColorVar",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn(0,0,0,0)}}),Get=lt(Qtt.prototype,"_positionType",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return w9.FREE}}),Jtt=Qtt))||Jtt)||Jtt)||Jtt)||Jtt)),lnt=function(){function t(t,e){this.point=new Qn,this.dir=new Qn,this.distance=0,this.time=0,t&&this.point.set(t),e&&this.dir.set(e)}var e=t.prototype;return e.setPoint=function(t,e){this.point.x=t,this.point.y=e},e.setDir=function(t,e){this.dir.x=t,this.dir.y=e},t}(),hnt=t("MotionStreak",(Yet=Ec("cc.MotionStreak"),Ket=kc(),Jet=jc(),Qet=cl(Mv),Yet(Zet=zc(Zet=Uc(Zet=Ket(Zet=Jet((snt=ont=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_preview",tnt,at(e)),ct(e,"_fadeTime",ent,at(e)),ct(e,"_minSeg",nnt,at(e)),ct(e,"_stroke",int,at(e)),ct(e,"_texture",rnt,at(e)),ct(e,"_fastMode",ant,at(e)),e._points=[],e}$(e,t);var n=e.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this.reset()},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._renderData||this._assembler&&this._assembler.createData&&(this._renderData=this._assembler.createData(this),this._renderData.material=this.material)},n.onFocusInEditor=function(){this._preview&&this.reset()},n.onLostFocusInEditor=function(){this._preview&&this.reset()},n.reset=function(){this._points.length=0,this._renderData&&this._renderData.clear()},n.lateUpdate=function(t){this._assembler&&this._assembler.update(this,t)},n._render=function(t){t.commitComp(this,this.renderData,this._texture,this._assembler,null)},Q(e,[{key:"preview",get:function(){return this._preview},set:function(t){this._preview=t,this.reset()}},{key:"fadeTime",get:function(){return this._fadeTime},set:function(t){this._fadeTime=t,this.reset()}},{key:"minSeg",get:function(){return this._minSeg},set:function(t){this._minSeg=t}},{key:"stroke",get:function(){return this._stroke},set:function(t){this._stroke=t}},{key:"texture",get:function(){return this._texture},set:function(t){this._texture!==t&&(this._texture=t)}},{key:"fastMode",get:function(){return this._fastMode},set:function(t){this._fastMode=t}},{key:"points",get:function(){return this._points}}]),e}(xk),ont.Point=lnt,lt(($et=snt).prototype,"preview",[Wc],Object.getOwnPropertyDescriptor($et.prototype,"preview"),$et.prototype),lt($et.prototype,"fadeTime",[Wc],Object.getOwnPropertyDescriptor($et.prototype,"fadeTime"),$et.prototype),lt($et.prototype,"minSeg",[Wc],Object.getOwnPropertyDescriptor($et.prototype,"minSeg"),$et.prototype),lt($et.prototype,"stroke",[Wc],Object.getOwnPropertyDescriptor($et.prototype,"stroke"),$et.prototype),lt($et.prototype,"texture",[Qet],Object.getOwnPropertyDescriptor($et.prototype,"texture"),$et.prototype),lt($et.prototype,"fastMode",[Wc],Object.getOwnPropertyDescriptor($et.prototype,"fastMode"),$et.prototype),tnt=lt($et.prototype,"_preview",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ent=lt($et.prototype,"_fadeTime",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),nnt=lt($et.prototype,"_minSeg",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),int=lt($et.prototype,"_stroke",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),rnt=lt($et.prototype,"_texture",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ant=lt($et.prototype,"_fastMode",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Zet=$et))||Zet)||Zet)||Zet)||Zet)||Zet)),unt=(new Qn,new Qn),_nt=new Qn;function fnt(t,e){return t.x=-e.y,t.y=e.x,t}var dnt={createData:function(t){var e=t.requestRenderData();return e.dataLength=4,e.resize(16,42),e},update:function(t,e){var n,i=t.stroke/2,r=t.node.worldMatrix,a=r.m12,o=r.m13,s=t.points;if(s.length>1){var c=s[0],l=c.point.x-a,h=c.point.y-o;l*l+h*h<t.minSeg&&(n=c)}n||(n=new hnt.Point,s.unshift(n)),n.setPoint(a,o),n.time=t.fadeTime+e;var u,_=0;if(!(s.length<2)){var f=t.renderData;this.updateRenderDataCache(t,f);var d=t.color,p=d.r,m=d.g,v=d.b,g=d.a,y=s[1];y.distance=Qn.subtract(_nt,n.point,y.point).length(),_nt.normalize(),y.setDir(_nt.x,_nt.y),n.setDir(_nt.x,_nt.y),f.dataLength=2*s.length;for(var x=f.data,S=t.fadeTime,A=!1,b=s.length-1;b>=0;b--){var C=s[b],T=C.point,E=C.dir;if(C.time-=e,C.time<0)s.splice(b,1);else{var w=C.time/S,I=s[b-1];if(!A){if(!I){s.splice(b,1);continue}T.x=I.point.x-E.x*w,T.y=I.point.y-E.y*w}A=!0,fnt(unt,E);var P=(w*g<<24>>>0)+(v<<16)+(m<<8)+p,D=_;x[D].x=T.x+unt.x*i,x[D].y=T.y+unt.y*i,x[D].u=1,x[D].v=w,x[D].color._val=P,x[D+=1].x=T.x-unt.x*i,x[D].y=T.y-unt.y*i,x[D].u=0,x[D].v=w,x[D].color._val=P,_+=2}}u=_<=2?0:3*(_-2),f.resize(_,u)}},updateRenderDataCache:function(t,e){e.passDirty&&e.updatePass(t),e.nodeDirty&&e.updateNode(t),e.textureDirty&&t.texture&&(e.updateTexture(t.texture),e.material=t.getRenderMaterial(0)),e.hashDirty&&e.updateHash()},updateRenderData:function(){},updateColor:function(){},fillBuffers:function(t){for(var e=t.renderData,n=e.chunk,i=e.data,r=e.vertexCount,a=e.indexCount,o=n.vb,s=0,c=0;c<r;c++){var l=i[c];o[s++]=l.x,o[s++]=l.y,o[s++]=l.z,o[s++]=l.u,o[s++]=l.v,Dn.toArray(o,l.color,s),s+=4}for(var h=n.bufferId,u=n.vertexOffset,_=n.vertexAccessor.getMeshBuffer(n.bufferId),f=n.vertexAccessor.getIndexBuffer(h),d=_.indexOffset,p=0,m=a;p<m;p+=2){var v=u+p;f[d++]=v,f[d++]=v+2,f[d++]=v+1,f[d++]=v+1,f[d++]=v+2,f[d++]=v+3}_.indexOffset+=e.indexCount,_.setDirty()}},pnt=t("MotionStreakAssemblerManager",{getAssembler:function(){return dnt}});hnt.Assembler=pnt;var mnt,vnt,gnt={maxParticleDeltaTime:0,createData:function(){return EV.add()},removeData:function(t){EV.remove(t)},updateRenderData:function(){},fillBuffers:function(){}},ynt=t("ParticleSystem2DAssembler",{getAssembler:function(){return gnt.maxParticleDeltaTime||(gnt.maxParticleDeltaTime=h.game.frameTime/1e3*2),gnt}});cnt.Assembler=ynt,"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self&&self;var xnt,Snt=function(t,e){return function(t,e){!function(t){function e(t){if(!t){for(var e=arguments.length,n=new Array(e>1?e-1:0),i=1;i<e;i++)n[i-1]=arguments[i];throw it(Error,n)}}function n(t,e){return void 0!==t?t:e}var i=1e37,r=1e-5,a=r*r,o=3.14159265359,s=2,c=8,l=.1,h=2,u=.008,_=2/180*o,f=2*u,d=8,p=32,m=1,v=.2,g=8/180*o,y=2,x=y*y,S=.5*o,A=S*S,b=.2,C=.75,T=-1,E=2147483647,w=.75,I=1,P=.25,D=.5,R=2,M=R*R,O=256,N=2.5,B=.5,L=.01,F=2/180*o;function V(){return null}function z(){}function k(){}var U=function(){function t(t,e,n){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),this.major=0,this.minor=0,this.revision=0,this.major=t,this.minor=e,this.revision=n}return t.prototype.toString=function(){return this.major+"."+this.minor+"."+this.revision},t}(),G=new U(2,3,2),H="master",j="fbf51801d80fc389d43dc46524520e89043b6faf";function W(t){return parseInt(t,10)}function q(t){return Math.abs(parseInt(t,10))}function X(t,e){for(var n=new Array(t),i=0;i<t;++i)n[i]=e(i);return n}function Y(t){for(var e=new Array(t),n=0;n<t;++n)e[n]=null;return e}function K(t,e){void 0===e&&(e=0);for(var n=new Array(t),i=0;i<t;++i)n[i]=e;return n}var J=o/180,Z=180/o,tt=2*o,et=Math.abs;function nt(t,e){return t<e?t:e}function rt(t,e){return t>e?t:e}function at(t,e,n){return t<e?e:t>n?n:t}function ot(t,e){var n=t[0];t[0]=e[0],e[0]=n}var ct=isFinite;function lt(t){return t*t}function ht(t){return 1/Math.sqrt(t)}var ut=Math.sqrt,_t=Math.pow;function ft(t){return t*J}function dt(t){return t*Z}var pt=Math.cos,mt=Math.sin,vt=Math.acos,gt=Math.asin,yt=Math.atan2;function xt(t){return t|=t>>1&2147483647,t|=t>>2&1073741823,t|=t>>4&268435455,1+((t|=t>>8&16777215)|t>>16&65535)}function St(t){return t>0&&0==(t&t-1)}function At(){return 2*Math.random()-1}function bt(t,e){return(e-t)*Math.random()+t}var Ct=function(){function t(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e[0]instanceof Float32Array){if(2!==e[0].length)throw new Error;this.data=e[0]}else{var i="number"==typeof e[0]?e[0]:0,r="number"==typeof e[1]?e[1]:0;this.data=new Float32Array([i,r])}}var e=t.prototype;return e.Clone=function(){return new t(this.x,this.y)},e.SetZero=function(){return this.x=0,this.y=0,this},e.Set=function(t,e){return this.x=t,this.y=e,this},e.Copy=function(t){return this.x=t.x,this.y=t.y,this},e.SelfAdd=function(t){return this.x+=t.x,this.y+=t.y,this},e.SelfAddXY=function(t,e){return this.x+=t,this.y+=e,this},e.SelfSub=function(t){return this.x-=t.x,this.y-=t.y,this},e.SelfSubXY=function(t,e){return this.x-=t,this.y-=e,this},e.SelfMul=function(t){return this.x*=t,this.y*=t,this},e.SelfMulAdd=function(t,e){return this.x+=t*e.x,this.y+=t*e.y,this},e.SelfMulSub=function(t,e){return this.x-=t*e.x,this.y-=t*e.y,this},e.Dot=function(t){return this.x*t.x+this.y*t.y},e.Cross=function(t){return this.x*t.y-this.y*t.x},e.Length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},e.LengthSquared=function(){var t=this.x,e=this.y;return t*t+e*e},e.Normalize=function(){var t=this.Length();if(t>=r){var e=1/t;this.x*=e,this.y*=e}return t},e.SelfNormalize=function(){var t=this.Length();if(t>=r){var e=1/t;this.x*=e,this.y*=e}return this},e.SelfRotate=function(t){var e=Math.cos(t),n=Math.sin(t),i=this.x;return this.x=e*i-n*this.y,this.y=n*i+e*this.y,this},e.SelfRotateCosSin=function(t,e){var n=this.x;return this.x=t*n-e*this.y,this.y=e*n+t*this.y,this},e.IsValid=function(){return isFinite(this.x)&&isFinite(this.y)},e.SelfCrossVS=function(t){var e=this.x;return this.x=t*this.y,this.y=-t*e,this},e.SelfCrossSV=function(t){var e=this.x;return this.x=-t*this.y,this.y=t*e,this},e.SelfMinV=function(t){return this.x=nt(this.x,t.x),this.y=nt(this.y,t.y),this},e.SelfMaxV=function(t){return this.x=rt(this.x,t.x),this.y=rt(this.y,t.y),this},e.SelfAbs=function(){return this.x=et(this.x),this.y=et(this.y),this},e.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this},e.SelfSkew=function(){var t=this.x;return this.x=-this.y,this.y=t,this},t.MakeArray=function(e){return X(e,(function(){return new t}))},t.AbsV=function(t,e){return e.x=et(t.x),e.y=et(t.y),e},t.MinV=function(t,e,n){return n.x=nt(t.x,e.x),n.y=nt(t.y,e.y),n},t.MaxV=function(t,e,n){return n.x=rt(t.x,e.x),n.y=rt(t.y,e.y),n},t.ClampV=function(t,e,n,i){return i.x=at(t.x,e.x,n.x),i.y=at(t.y,e.y,n.y),i},t.RotateV=function(t,e,n){var i=t.x,r=t.y,a=Math.cos(e),o=Math.sin(e);return n.x=a*i-o*r,n.y=o*i+a*r,n},t.DotVV=function(t,e){return t.x*e.x+t.y*e.y},t.CrossVV=function(t,e){return t.x*e.y-t.y*e.x},t.CrossVS=function(t,e,n){var i=t.x;return n.x=e*t.y,n.y=-e*i,n},t.CrossVOne=function(t,e){var n=t.x;return e.x=t.y,e.y=-n,e},t.CrossSV=function(t,e,n){var i=e.x;return n.x=-t*e.y,n.y=t*i,n},t.CrossOneV=function(t,e){var n=t.x;return e.x=-t.y,e.y=n,e},t.AddVV=function(t,e,n){return n.x=t.x+e.x,n.y=t.y+e.y,n},t.SubVV=function(t,e,n){return n.x=t.x-e.x,n.y=t.y-e.y,n},t.MulSV=function(t,e,n){return n.x=e.x*t,n.y=e.y*t,n},t.MulVS=function(t,e,n){return n.x=t.x*e,n.y=t.y*e,n},t.AddVMulSV=function(t,e,n,i){return i.x=t.x+e*n.x,i.y=t.y+e*n.y,i},t.SubVMulSV=function(t,e,n,i){return i.x=t.x-e*n.x,i.y=t.y-e*n.y,i},t.AddVCrossSV=function(t,e,n,i){var r=n.x;return i.x=t.x-e*n.y,i.y=t.y+e*r,i},t.MidVV=function(t,e,n){return n.x=.5*(t.x+e.x),n.y=.5*(t.y+e.y),n},t.ExtVV=function(t,e,n){return n.x=.5*(e.x-t.x),n.y=.5*(e.y-t.y),n},t.IsEqualToV=function(t,e){return t.x===e.x&&t.y===e.y},t.DistanceVV=function(t,e){var n=t.x-e.x,i=t.y-e.y;return Math.sqrt(n*n+i*i)},t.DistanceSquaredVV=function(t,e){var n=t.x-e.x,i=t.y-e.y;return n*n+i*i},t.NegV=function(t,e){return e.x=-t.x,e.y=-t.y,e},Q(t,[{key:"x",get:function(){return this.data[0]},set:function(t){this.data[0]=t}},{key:"y",get:function(){return this.data[1]},set:function(t){this.data[1]=t}}]),t}();Ct.ZERO=new Ct(0,0),Ct.UNITX=new Ct(1,0),Ct.UNITY=new Ct(0,1),Ct.s_t0=new Ct,Ct.s_t1=new Ct,Ct.s_t2=new Ct,Ct.s_t3=new Ct;var Tt=new Ct(0,0),Et=function(){function t(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e[0]instanceof Float32Array){if(3!==e[0].length)throw new Error;this.data=e[0]}else{var i="number"==typeof e[0]?e[0]:0,r="number"==typeof e[1]?e[1]:0,a="number"==typeof e[2]?e[2]:0;this.data=new Float32Array([i,r,a])}}var e=t.prototype;return e.Clone=function(){return new t(this.x,this.y,this.z)},e.SetZero=function(){return this.x=0,this.y=0,this.z=0,this},e.SetXYZ=function(t,e,n){return this.x=t,this.y=e,this.z=n,this},e.Copy=function(t){return this.x=t.x,this.y=t.y,this.z=t.z,this},e.SelfNeg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},e.SelfAdd=function(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this},e.SelfAddXYZ=function(t,e,n){return this.x+=t,this.y+=e,this.z+=n,this},e.SelfSub=function(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this},e.SelfSubXYZ=function(t,e,n){return this.x-=t,this.y-=e,this.z-=n,this},e.SelfMul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},t.DotV3V3=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},t.CrossV3V3=function(t,e,n){var i=t.x,r=t.y,a=t.z,o=e.x,s=e.y,c=e.z;return n.x=r*c-a*s,n.y=a*o-i*c,n.z=i*s-r*o,n},Q(t,[{key:"x",get:function(){return this.data[0]},set:function(t){this.data[0]=t}},{key:"y",get:function(){return this.data[1]},set:function(t){this.data[1]=t}},{key:"z",get:function(){return this.data[2]},set:function(t){this.data[2]=t}}]),t}();Et.ZERO=new Et(0,0,0),Et.s_t0=new Et;var wt=function(){function t(){this.data=new Float32Array([1,0,0,1]),this.ex=new Ct(this.data.subarray(0,2)),this.ey=new Ct(this.data.subarray(2,4))}var e=t.prototype;return e.Clone=function(){return(new t).Copy(this)},t.FromVV=function(e,n){return(new t).SetVV(e,n)},t.FromSSSS=function(e,n,i,r){return(new t).SetSSSS(e,n,i,r)},t.FromAngle=function(e){return(new t).SetAngle(e)},e.SetSSSS=function(t,e,n,i){return this.ex.Set(t,n),this.ey.Set(e,i),this},e.SetVV=function(t,e){return this.ex.Copy(t),this.ey.Copy(e),this},e.SetAngle=function(t){var e=Math.cos(t),n=Math.sin(t);return this.ex.Set(e,n),this.ey.Set(-n,e),this},e.Copy=function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this},e.SetIdentity=function(){return this.ex.Set(1,0),this.ey.Set(0,1),this},e.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this},e.GetAngle=function(){return Math.atan2(this.ex.y,this.ex.x)},e.GetInverse=function(t){var e=this.ex.x,n=this.ey.x,i=this.ex.y,r=this.ey.y,a=e*r-n*i;return 0!==a&&(a=1/a),t.ex.x=a*r,t.ey.x=-a*n,t.ex.y=-a*i,t.ey.y=a*e,t},e.Solve=function(t,e,n){var i=this.ex.x,r=this.ey.x,a=this.ex.y,o=this.ey.y,s=i*o-r*a;return 0!==s&&(s=1/s),n.x=s*(o*t-r*e),n.y=s*(i*e-a*t),n},e.SelfAbs=function(){return this.ex.SelfAbs(),this.ey.SelfAbs(),this},e.SelfInv=function(){return this.GetInverse(this),this},e.SelfAddM=function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this},e.SelfSubM=function(t){return this.ex.SelfSub(t.ex),this.ey.SelfSub(t.ey),this},t.AbsM=function(t,e){var n=t.ex,i=t.ey;return e.ex.x=et(n.x),e.ex.y=et(n.y),e.ey.x=et(i.x),e.ey.y=et(i.y),e},t.MulMV=function(t,e,n){var i=t.ex,r=t.ey,a=e.x,o=e.y;return n.x=i.x*a+r.x*o,n.y=i.y*a+r.y*o,n},t.MulTMV=function(t,e,n){var i=t.ex,r=t.ey,a=e.x,o=e.y;return n.x=i.x*a+i.y*o,n.y=r.x*a+r.y*o,n},t.AddMM=function(t,e,n){var i=t.ex,r=t.ey,a=e.ex,o=e.ey;return n.ex.x=i.x+a.x,n.ex.y=i.y+a.y,n.ey.x=r.x+o.x,n.ey.y=r.y+o.y,n},t.MulMM=function(t,e,n){var i=t.ex.x,r=t.ex.y,a=t.ey.x,o=t.ey.y,s=e.ex.x,c=e.ex.y,l=e.ey.x,h=e.ey.y;return n.ex.x=i*s+a*c,n.ex.y=r*s+o*c,n.ey.x=i*l+a*h,n.ey.y=r*l+o*h,n},t.MulTMM=function(t,e,n){var i=t.ex.x,r=t.ex.y,a=t.ey.x,o=t.ey.y,s=e.ex.x,c=e.ex.y,l=e.ey.x,h=e.ey.y;return n.ex.x=i*s+r*c,n.ex.y=a*s+o*c,n.ey.x=i*l+r*h,n.ey.y=a*l+o*h,n},t}();wt.IDENTITY=new wt;var It=function(){function t(){this.data=new Float32Array([1,0,0,0,1,0,0,0,1]),this.ex=new Et(this.data.subarray(0,3)),this.ey=new Et(this.data.subarray(3,6)),this.ez=new Et(this.data.subarray(6,9))}var e=t.prototype;return e.Clone=function(){return(new t).Copy(this)},e.SetVVV=function(t,e,n){return this.ex.Copy(t),this.ey.Copy(e),this.ez.Copy(n),this},e.Copy=function(t){return this.ex.Copy(t.ex),this.ey.Copy(t.ey),this.ez.Copy(t.ez),this},e.SetIdentity=function(){return this.ex.SetXYZ(1,0,0),this.ey.SetXYZ(0,1,0),this.ez.SetXYZ(0,0,1),this},e.SetZero=function(){return this.ex.SetZero(),this.ey.SetZero(),this.ez.SetZero(),this},e.SelfAddM=function(t){return this.ex.SelfAdd(t.ex),this.ey.SelfAdd(t.ey),this.ez.SelfAdd(t.ez),this},e.Solve33=function(t,e,n,i){var r=this.ex.x,a=this.ex.y,o=this.ex.z,s=this.ey.x,c=this.ey.y,l=this.ey.z,h=this.ez.x,u=this.ez.y,_=this.ez.z,f=r*(c*_-l*u)+a*(l*h-s*_)+o*(s*u-c*h);return 0!==f&&(f=1/f),i.x=f*(t*(c*_-l*u)+e*(l*h-s*_)+n*(s*u-c*h)),i.y=f*(r*(e*_-n*u)+a*(n*h-t*_)+o*(t*u-e*h)),i.z=f*(r*(c*n-l*e)+a*(l*t-s*n)+o*(s*e-c*t)),i},e.Solve22=function(t,e,n){var i=this.ex.x,r=this.ey.x,a=this.ex.y,o=this.ey.y,s=i*o-r*a;return 0!==s&&(s=1/s),n.x=s*(o*t-r*e),n.y=s*(i*e-a*t),n},e.GetInverse22=function(t){var e=this.ex.x,n=this.ey.x,i=this.ex.y,r=this.ey.y,a=e*r-n*i;0!==a&&(a=1/a),t.ex.x=a*r,t.ey.x=-a*n,t.ex.z=0,t.ex.y=-a*i,t.ey.y=a*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0},e.GetSymInverse33=function(t){var e=Et.DotV3V3(this.ex,Et.CrossV3V3(this.ey,this.ez,Et.s_t0));0!==e&&(e=1/e);var n=this.ex.x,i=this.ey.x,r=this.ez.x,a=this.ey.y,o=this.ez.y,s=this.ez.z;t.ex.x=e*(a*s-o*o),t.ex.y=e*(r*o-i*s),t.ex.z=e*(i*o-r*a),t.ey.x=t.ex.y,t.ey.y=e*(n*s-r*r),t.ey.z=e*(r*i-n*o),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(n*a-i*i)},t.MulM33V3=function(t,e,n){var i=e.x,r=e.y,a=e.z;return n.x=t.ex.x*i+t.ey.x*r+t.ez.x*a,n.y=t.ex.y*i+t.ey.y*r+t.ez.y*a,n.z=t.ex.z*i+t.ey.z*r+t.ez.z*a,n},t.MulM33XYZ=function(t,e,n,i,r){return r.x=t.ex.x*e+t.ey.x*n+t.ez.x*i,r.y=t.ex.y*e+t.ey.y*n+t.ez.y*i,r.z=t.ex.z*e+t.ey.z*n+t.ez.z*i,r},t.MulM33V2=function(t,e,n){var i=e.x,r=e.y;return n.x=t.ex.x*i+t.ey.x*r,n.y=t.ex.y*i+t.ey.y*r,n},t.MulM33XY=function(t,e,n,i){return i.x=t.ex.x*e+t.ey.x*n,i.y=t.ex.y*e+t.ey.y*n,i},t}();It.IDENTITY=new It;var Pt=function(){function t(t){void 0===t&&(t=0),this.s=0,this.c=1,t&&(this.s=Math.sin(t),this.c=Math.cos(t))}var e=t.prototype;return e.Clone=function(){return(new t).Copy(this)},e.Copy=function(t){return this.s=t.s,this.c=t.c,this},e.SetAngle=function(t){return this.s=Math.sin(t),this.c=Math.cos(t),this},e.SetIdentity=function(){return this.s=0,this.c=1,this},e.GetAngle=function(){return Math.atan2(this.s,this.c)},e.GetXAxis=function(t){return t.x=this.c,t.y=this.s,t},e.GetYAxis=function(t){return t.x=-this.s,t.y=this.c,t},t.MulRR=function(t,e,n){var i=t.c,r=t.s,a=e.c,o=e.s;return n.s=r*a+i*o,n.c=i*a-r*o,n},t.MulTRR=function(t,e,n){var i=t.c,r=t.s,a=e.c,o=e.s;return n.s=i*o-r*a,n.c=i*a+r*o,n},t.MulRV=function(t,e,n){var i=t.c,r=t.s,a=e.x,o=e.y;return n.x=i*a-r*o,n.y=r*a+i*o,n},t.MulTRV=function(t,e,n){var i=t.c,r=t.s,a=e.x,o=e.y;return n.x=i*a+r*o,n.y=-r*a+i*o,n},t}();Pt.IDENTITY=new Pt;var Dt=function(){function t(){this.p=new Ct,this.q=new Pt}var e=t.prototype;return e.Clone=function(){return(new t).Copy(this)},e.Copy=function(t){return this.p.Copy(t.p),this.q.Copy(t.q),this},e.SetIdentity=function(){return this.p.SetZero(),this.q.SetIdentity(),this},e.SetPositionRotation=function(t,e){return this.p.Copy(t),this.q.Copy(e),this},e.SetPositionAngle=function(t,e){return this.p.Copy(t),this.q.SetAngle(e),this},e.SetPosition=function(t){return this.p.Copy(t),this},e.SetPositionXY=function(t,e){return this.p.Set(t,e),this},e.SetRotation=function(t){return this.q.Copy(t),this},e.SetRotationAngle=function(t){return this.q.SetAngle(t),this},e.GetPosition=function(){return this.p},e.GetRotation=function(){return this.q},e.GetRotationAngle=function(){return this.q.GetAngle()},e.GetAngle=function(){return this.q.GetAngle()},t.MulXV=function(t,e,n){var i=t.q.c,r=t.q.s,a=e.x,o=e.y;return n.x=i*a-r*o+t.p.x,n.y=r*a+i*o+t.p.y,n},t.MulTXV=function(t,e,n){var i=t.q.c,r=t.q.s,a=e.x-t.p.x,o=e.y-t.p.y;return n.x=i*a+r*o,n.y=-r*a+i*o,n},t.MulXX=function(t,e,n){return Pt.MulRR(t.q,e.q,n.q),Ct.AddVV(Pt.MulRV(t.q,e.p,n.p),t.p,n.p),n},t.MulTXX=function(t,e,n){return Pt.MulTRR(t.q,e.q,n.q),Pt.MulTRV(t.q,Ct.SubVV(e.p,t.p,n.p),n.p),n},t}();Dt.IDENTITY=new Dt;var Rt,Mt=function(){function t(){this.localCenter=new Ct,this.c0=new Ct,this.c=new Ct,this.a0=0,this.a=0,this.alpha0=0}var e=t.prototype;return e.Clone=function(){return(new t).Copy(this)},e.Copy=function(t){return this.localCenter.Copy(t.localCenter),this.c0.Copy(t.c0),this.c.Copy(t.c),this.a0=t.a0,this.a=t.a,this.alpha0=t.alpha0,this},e.GetTransform=function(t,e){var n=1-e;t.p.x=n*this.c0.x+e*this.c.x,t.p.y=n*this.c0.y+e*this.c.y;var i=n*this.a0+e*this.a;return t.q.SetAngle(i),t.p.SelfSub(Pt.MulRV(t.q,this.localCenter,Ct.s_t0)),t},e.Advance=function(t){var e=(t-this.alpha0)/(1-this.alpha0),n=1-e;this.c0.x=n*this.c0.x+e*this.c.x,this.c0.y=n*this.c0.y+e*this.c.y,this.a0=n*this.a0+e*this.a,this.alpha0=t},e.Normalize=function(){var t=tt*Math.floor(this.a0/tt);this.a0-=t,this.a-=t},t}(),Ot=function(){function t(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if(e[0]instanceof Float32Array){if(4!==e[0].length)throw new Error;this.data=e[0]}else{var i="number"==typeof e[0]?e[0]:.5,r="number"==typeof e[1]?e[1]:.5,a="number"==typeof e[2]?e[2]:.5,o="number"==typeof e[3]?e[3]:1;this.data=new Float32Array([i,r,a,o])}}var e=t.prototype;return e.Clone=function(){return(new t).Copy(this)},e.Copy=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},e.IsEqual=function(t){return this.r===t.r&&this.g===t.g&&this.b===t.b&&this.a===t.a},e.IsZero=function(){return 0===this.r&&0===this.g&&0===this.b&&0===this.a},e.Set=function(t,e,n,i){void 0===i&&(i=this.a),this.SetRGBA(t,e,n,i)},e.SetByteRGB=function(t,e,n){return this.r=t/255,this.g=e/255,this.b=n/255,this},e.SetByteRGBA=function(t,e,n,i){return this.r=t/255,this.g=e/255,this.b=n/255,this.a=i/255,this},e.SetRGB=function(t,e,n){return this.r=t,this.g=e,this.b=n,this},e.SetRGBA=function(t,e,n,i){return this.r=t,this.g=e,this.b=n,this.a=i,this},e.SelfAdd=function(t){return this.r+=t.r,this.g+=t.g,this.b+=t.b,this.a+=t.a,this},e.Add=function(t,e){return e.r=this.r+t.r,e.g=this.g+t.g,e.b=this.b+t.b,e.a=this.a+t.a,e},e.SelfSub=function(t){return this.r-=t.r,this.g-=t.g,this.b-=t.b,this.a-=t.a,this},e.Sub=function(t,e){return e.r=this.r-t.r,e.g=this.g-t.g,e.b=this.b-t.b,e.a=this.a-t.a,e},e.SelfMul=function(t){return this.r*=t,this.g*=t,this.b*=t,this.a*=t,this},e.Mul=function(t,e){return e.r=this.r*t,e.g=this.g*t,e.b=this.b*t,e.a=this.a*t,e},e.Mix=function(e,n){t.MixColors(this,e,n)},t.MixColors=function(t,e,n){var i=n*(e.r-t.r),r=n*(e.g-t.g),a=n*(e.b-t.b),o=n*(e.a-t.a);t.r+=i,t.g+=r,t.b+=a,t.a+=o,e.r-=i,e.g-=r,e.b-=a,e.a-=o},e.MakeStyleString=function(e){return void 0===e&&(e=this.a),t.MakeStyleString(this.r,this.g,this.b,e)},t.MakeStyleString=function(t,e,n,i){return void 0===i&&(i=1),t*=255,e*=255,n*=255,i<1?"rgba("+t+","+e+","+n+","+i+")":"rgb("+t+","+e+","+n+")"},Q(t,[{key:"r",get:function(){return this.data[0]},set:function(t){this.data[0]=t}},{key:"g",get:function(){return this.data[1]},set:function(t){this.data[1]=t}},{key:"b",get:function(){return this.data[2]},set:function(t){this.data[2]=t}},{key:"a",get:function(){return this.data[3]},set:function(t){this.data[3]=t}}]),t}();Ot.ZERO=new Ot(0,0,0,0),Ot.RED=new Ot(1,0,0),Ot.GREEN=new Ot(0,1,0),Ot.BLUE=new Ot(0,0,1),(Rt=t.b2DrawFlags||(t.b2DrawFlags={}))[Rt.e_none=0]="e_none",Rt[Rt.e_shapeBit=1]="e_shapeBit",Rt[Rt.e_jointBit=2]="e_jointBit",Rt[Rt.e_aabbBit=4]="e_aabbBit",Rt[Rt.e_pairBit=8]="e_pairBit",Rt[Rt.e_centerOfMassBit=16]="e_centerOfMassBit",Rt[Rt.e_particleBit=32]="e_particleBit",Rt[Rt.e_controllerBit=64]="e_controllerBit",Rt[Rt.e_all=63]="e_all";var Nt=function(){function t(){this.m_drawFlags=0}var e=t.prototype;return e.SetFlags=function(t){this.m_drawFlags=t},e.GetFlags=function(){return this.m_drawFlags},e.AppendFlags=function(t){this.m_drawFlags|=t},e.ClearFlags=function(t){this.m_drawFlags&=~t},t}(),Bt=function(){function t(){this.m_start=Date.now()}var e=t.prototype;return e.Reset=function(){return this.m_start=Date.now(),this},e.GetMilliseconds=function(){return Date.now()-this.m_start},t}(),Lt=function(){function t(){this.m_count=0,this.m_min_count=0,this.m_max_count=0}var e=t.prototype;return e.GetCount=function(){return this.m_count},e.GetMinCount=function(){return this.m_min_count},e.GetMaxCount=function(){return this.m_max_count},e.ResetCount=function(){var t=this.m_count;return this.m_count=0,t},e.ResetMinCount=function(){this.m_min_count=0},e.ResetMaxCount=function(){this.m_max_count=0},e.Increment=function(){this.m_count++,this.m_max_count<this.m_count&&(this.m_max_count=this.m_count)},e.Decrement=function(){this.m_count--,this.m_min_count>this.m_count&&(this.m_min_count=this.m_count)},t}(),Ft=function(){function t(t){this.m_stack=[],this.m_count=0,this.m_stack=X(t,(function(){return null})),this.m_count=0}var e=t.prototype;return e.Reset=function(){return this.m_count=0,this},e.Push=function(t){this.m_stack[this.m_count]=t,this.m_count++},e.Pop=function(){this.m_count--;var t=this.m_stack[this.m_count];if(this.m_stack[this.m_count]=null,null===t)throw new Error;return t},e.GetCount=function(){return this.m_count},t}(),Vt=function(){},zt=function(){},kt=function(){function t(){this.m_buffer=Ct.MakeArray(2),this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0}var e=t.prototype;return e.Copy=function(t){return t.m_vertices===t.m_buffer?(this.m_vertices=this.m_buffer,this.m_buffer[0].Copy(t.m_buffer[0]),this.m_buffer[1].Copy(t.m_buffer[1])):this.m_vertices=t.m_vertices,this.m_count=t.m_count,this.m_radius=t.m_radius,this},e.Reset=function(){return this.m_vertices=this.m_buffer,this.m_count=0,this.m_radius=0,this},e.SetShape=function(t,e){t.SetupDistanceProxy(this,e)},e.SetVerticesRadius=function(t,e,n){this.m_vertices=t,this.m_count=e,this.m_radius=n},e.GetSupport=function(t){for(var e=0,n=Ct.DotVV(this.m_vertices[0],t),i=1;i<this.m_count;++i){var r=Ct.DotVV(this.m_vertices[i],t);r>n&&(e=i,n=r)}return e},e.GetSupportVertex=function(t){for(var e=0,n=Ct.DotVV(this.m_vertices[0],t),i=1;i<this.m_count;++i){var r=Ct.DotVV(this.m_vertices[i],t);r>n&&(e=i,n=r)}return this.m_vertices[e]},e.GetVertexCount=function(){return this.m_count},e.GetVertex=function(t){return this.m_vertices[t]},t}(),Ut=function(){function t(){this.metric=0,this.count=0,this.indexA=[0,0,0],this.indexB=[0,0,0]}return t.prototype.Reset=function(){return this.metric=0,this.count=0,this},t}(),Gt=function(){function t(){this.proxyA=new kt,this.proxyB=new kt,this.transformA=new Dt,this.transformB=new Dt,this.useRadii=!1}return t.prototype.Reset=function(){return this.proxyA.Reset(),this.proxyB.Reset(),this.transformA.SetIdentity(),this.transformB.SetIdentity(),this.useRadii=!1,this},t}(),Ht=function(){function t(){this.pointA=new Ct,this.pointB=new Ct,this.distance=0,this.iterations=0}return t.prototype.Reset=function(){return this.pointA.SetZero(),this.pointB.SetZero(),this.distance=0,this.iterations=0,this},t}(),jt=function(){this.proxyA=new kt,this.proxyB=new kt,this.transformA=new Dt,this.transformB=new Dt,this.translationB=new Ct},Wt=function(){this.point=new Ct,this.normal=new Ct,this.lambda=0,this.iterations=0};function qt(){t.b2_gjkCalls=0,t.b2_gjkIters=0,t.b2_gjkMaxIters=0}t.b2_gjkCalls=0,t.b2_gjkIters=0,t.b2_gjkMaxIters=0;var Xt=function(){function t(){this.wA=new Ct,this.wB=new Ct,this.w=new Ct,this.a=0,this.indexA=0,this.indexB=0}return t.prototype.Copy=function(t){return this.wA.Copy(t.wA),this.wB.Copy(t.wB),this.w.Copy(t.w),this.a=t.a,this.indexA=t.indexA,this.indexB=t.indexB,this},t}(),Yt=function(){function t(){this.m_v1=new Xt,this.m_v2=new Xt,this.m_v3=new Xt,this.m_vertices=[],this.m_count=0,this.m_vertices[0]=this.m_v1,this.m_vertices[1]=this.m_v2,this.m_vertices[2]=this.m_v3}var e=t.prototype;return e.ReadCache=function(t,e,n,i,a){this.m_count=t.count;for(var o=this.m_vertices,s=0;s<this.m_count;++s){var c=o[s];c.indexA=t.indexA[s],c.indexB=t.indexB[s];var l=e.GetVertex(c.indexA),h=i.GetVertex(c.indexB);Dt.MulXV(n,l,c.wA),Dt.MulXV(a,h,c.wB),Ct.SubVV(c.wB,c.wA,c.w),c.a=0}if(this.m_count>1){var u=t.metric,_=this.GetMetric();(_<.5*u||2*u<_||_<r)&&(this.m_count=0)}if(0===this.m_count){var f=o[0];f.indexA=0,f.indexB=0;var d=e.GetVertex(0),p=i.GetVertex(0);Dt.MulXV(n,d,f.wA),Dt.MulXV(a,p,f.wB),Ct.SubVV(f.wB,f.wA,f.w),f.a=1,this.m_count=1}},e.WriteCache=function(t){t.metric=this.GetMetric(),t.count=this.m_count;for(var e=this.m_vertices,n=0;n<this.m_count;++n)t.indexA[n]=e[n].indexA,t.indexB[n]=e[n].indexB},e.GetSearchDirection=function(t){switch(this.m_count){case 1:return Ct.NegV(this.m_v1.w,t);case 2:var e=Ct.SubVV(this.m_v2.w,this.m_v1.w,t);return Ct.CrossVV(e,Ct.NegV(this.m_v1.w,Ct.s_t0))>0?Ct.CrossOneV(e,t):Ct.CrossVOne(e,t);default:return t.SetZero()}},e.GetClosestPoint=function(t){switch(this.m_count){case 0:return t.SetZero();case 1:return t.Copy(this.m_v1.w);case 2:return t.Set(this.m_v1.a*this.m_v1.w.x+this.m_v2.a*this.m_v2.w.x,this.m_v1.a*this.m_v1.w.y+this.m_v2.a*this.m_v2.w.y);case 3:default:return t.SetZero()}},e.GetWitnessPoints=function(t,e){switch(this.m_count){case 0:break;case 1:t.Copy(this.m_v1.wA),e.Copy(this.m_v1.wB);break;case 2:t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x,t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y,e.x=this.m_v1.a*this.m_v1.wB.x+this.m_v2.a*this.m_v2.wB.x,e.y=this.m_v1.a*this.m_v1.wB.y+this.m_v2.a*this.m_v2.wB.y;break;case 3:e.x=t.x=this.m_v1.a*this.m_v1.wA.x+this.m_v2.a*this.m_v2.wA.x+this.m_v3.a*this.m_v3.wA.x,e.y=t.y=this.m_v1.a*this.m_v1.wA.y+this.m_v2.a*this.m_v2.wA.y+this.m_v3.a*this.m_v3.wA.y}},e.GetMetric=function(){switch(this.m_count){case 0:case 1:return 0;case 2:return Ct.DistanceVV(this.m_v1.w,this.m_v2.w);case 3:return Ct.CrossVV(Ct.SubVV(this.m_v2.w,this.m_v1.w,Ct.s_t0),Ct.SubVV(this.m_v3.w,this.m_v1.w,Ct.s_t1));default:return 0}},e.Solve2=function(){var e=this.m_v1.w,n=this.m_v2.w,i=Ct.SubVV(n,e,t.s_e12),r=-Ct.DotVV(e,i);if(r<=0)return this.m_v1.a=1,void(this.m_count=1);var a=Ct.DotVV(n,i);if(a<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);var o=1/(a+r);this.m_v1.a=a*o,this.m_v2.a=r*o,this.m_count=2},e.Solve3=function(){var e=this.m_v1.w,n=this.m_v2.w,i=this.m_v3.w,r=Ct.SubVV(n,e,t.s_e12),a=Ct.DotVV(e,r),o=Ct.DotVV(n,r),s=-a,c=Ct.SubVV(i,e,t.s_e13),l=Ct.DotVV(e,c),h=Ct.DotVV(i,c),u=-l,_=Ct.SubVV(i,n,t.s_e23),f=Ct.DotVV(n,_),d=Ct.DotVV(i,_),p=-f,m=Ct.CrossVV(r,c),v=m*Ct.CrossVV(n,i),g=m*Ct.CrossVV(i,e),y=m*Ct.CrossVV(e,n);if(s<=0&&u<=0)return this.m_v1.a=1,void(this.m_count=1);if(o>0&&s>0&&y<=0){var x=1/(o+s);return this.m_v1.a=o*x,this.m_v2.a=s*x,void(this.m_count=2)}if(h>0&&u>0&&g<=0){var S=1/(h+u);return this.m_v1.a=h*S,this.m_v3.a=u*S,this.m_count=2,void this.m_v2.Copy(this.m_v3)}if(o<=0&&p<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v2);if(h<=0&&d<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.Copy(this.m_v3);if(d>0&&p>0&&v<=0){var A=1/(d+p);return this.m_v2.a=d*A,this.m_v3.a=p*A,this.m_count=2,void this.m_v1.Copy(this.m_v3)}var b=1/(v+g+y);this.m_v1.a=v*b,this.m_v2.a=g*b,this.m_v3.a=y*b,this.m_count=3},t}();Yt.s_e12=new Ct,Yt.s_e13=new Ct,Yt.s_e23=new Ct;var Kt=new Yt,Jt=[0,0,0],Qt=[0,0,0],Zt=new Ct,$t=new Ct,te=new Ct,ee=new Ct,ne=new Ct;function ie(e,n,i){++t.b2_gjkCalls;var o=i.proxyA,s=i.proxyB,c=i.transformA,l=i.transformB,h=Kt;h.ReadCache(n,o,c,s,l);for(var u=h.m_vertices,_=20,f=Jt,d=Qt,p=0,m=0;m<_;){p=h.m_count;for(var v=0;v<p;++v)f[v]=u[v].indexA,d[v]=u[v].indexB;switch(h.m_count){case 1:break;case 2:h.Solve2();break;case 3:h.Solve3()}if(3===h.m_count)break;var g=h.GetSearchDirection($t);if(g.LengthSquared()<a)break;var y=u[h.m_count];y.indexA=o.GetSupport(Pt.MulTRV(c.q,Ct.NegV(g,Ct.s_t0),ee)),Dt.MulXV(c,o.GetVertex(y.indexA),y.wA),y.indexB=s.GetSupport(Pt.MulTRV(l.q,g,ne)),Dt.MulXV(l,s.GetVertex(y.indexB),y.wB),Ct.SubVV(y.wB,y.wA,y.w),++m,++t.b2_gjkIters;for(var x=!1,S=0;S<p;++S)if(y.indexA===f[S]&&y.indexB===d[S]){x=!0;break}if(x)break;++h.m_count}if(t.b2_gjkMaxIters=rt(t.b2_gjkMaxIters,m),h.GetWitnessPoints(e.pointA,e.pointB),e.distance=Ct.DistanceVV(e.pointA,e.pointB),e.iterations=m,h.WriteCache(n),i.useRadii){var A=o.m_radius,b=s.m_radius;if(e.distance>A+b&&e.distance>r){e.distance-=A+b;var C=Ct.SubVV(e.pointB,e.pointA,te);C.Normalize(),e.pointA.SelfMulAdd(A,C),e.pointB.SelfMulSub(b,C)}else{var T=Ct.MidVV(e.pointA,e.pointB,Zt);e.pointA.Copy(T),e.pointB.Copy(T),e.distance=0}}}var re,ae=new Ct,oe=new Yt,se=new Ct,ce=new Ct,le=new Ct,he=new Ct,ue=new Ct,_e=new Ct;function fe(t,e){t.iterations=0,t.lambda=1,t.normal.SetZero(),t.point.SetZero();var n=e.proxyA,i=e.proxyB,r=rt(n.m_radius,f)+rt(i.m_radius,f),a=e.transformA,o=e.transformB,s=e.translationB,c=ae.Set(0,0),l=0,h=oe;h.m_count=0;for(var _=h.m_vertices,d=n.GetSupport(Pt.MulTRV(a.q,Ct.NegV(s,Ct.s_t1),Ct.s_t0)),p=Dt.MulXV(a,n.GetVertex(d),se),m=i.GetSupport(Pt.MulTRV(o.q,s,Ct.s_t0)),v=Dt.MulXV(o,i.GetVertex(m),ce),g=Ct.SubVV(p,v,le),y=rt(f,r-f),x=.5*u,S=20,A=0;A<S&&et(g.Length()-y)>x;){t.iterations+=1,d=n.GetSupport(Pt.MulTRV(a.q,Ct.NegV(g,Ct.s_t1),Ct.s_t0)),p=Dt.MulXV(a,n.GetVertex(d),se),m=i.GetSupport(Pt.MulTRV(o.q,g,Ct.s_t0)),v=Dt.MulXV(o,i.GetVertex(m),ce);var b=Ct.SubVV(p,v,he);g.Normalize();var C=Ct.DotVV(g,b),T=Ct.DotVV(g,s);if(C-y>l*T){if(T<=0)return!1;if((l=(C-y)/T)>1)return!1;c.Copy(g).SelfNeg(),h.m_count=0}var E=_[h.m_count];switch(E.indexA=m,E.wA.Copy(v).SelfMulAdd(l,s),E.indexB=d,E.wB.Copy(p),E.w.Copy(E.wB).SelfSub(E.wA),E.a=1,h.m_count+=1,h.m_count){case 1:break;case 2:h.Solve2();break;case 3:h.Solve3()}if(3===h.m_count)return!1;h.GetClosestPoint(g),++A}var w=ue,I=_e;return h.GetWitnessPoints(w,I),g.LengthSquared()>0&&(c.Copy(g).SelfNeg(),c.Normalize()),t.normal.Copy(c),t.lambda=l,t.iterations=A,!0}(re=t.b2ContactFeatureType||(t.b2ContactFeatureType={}))[re.e_vertex=0]="e_vertex",re[re.e_face=1]="e_face";var de,pe=function(){function t(){this._key=0,this._key_invalid=!1,this._indexA=0,this._indexB=0,this._typeA=0,this._typeB=0}return Q(t,[{key:"key",get:function(){return this._key_invalid&&(this._key_invalid=!1,this._key=this._indexA|this._indexB<<8|this._typeA<<16|this._typeB<<24),this._key},set:function(t){this._key=t,this._key_invalid=!1,this._indexA=255&this._key,this._indexB=this._key>>8&255,this._typeA=this._key>>16&255,this._typeB=this._key>>24&255}},{key:"indexA",get:function(){return this._indexA},set:function(t){this._indexA=t,this._key_invalid=!0}},{key:"indexB",get:function(){return this._indexB},set:function(t){this._indexB=t,this._key_invalid=!0}},{key:"typeA",get:function(){return this._typeA},set:function(t){this._typeA=t,this._key_invalid=!0}},{key:"typeB",get:function(){return this._typeB},set:function(t){this._typeB=t,this._key_invalid=!0}}]),t}(),me=function(){function t(){this.cf=new pe}var e=t.prototype;return e.Copy=function(t){return this.key=t.key,this},e.Clone=function(){return(new t).Copy(this)},Q(t,[{key:"key",get:function(){return this.cf.key},set:function(t){this.cf.key=t}}]),t}(),ve=function(){function t(){this.localPoint=new Ct,this.normalImpulse=0,this.tangentImpulse=0,this.id=new me}t.MakeArray=function(e){return X(e,(function(){return new t}))};var e=t.prototype;return e.Reset=function(){this.localPoint.SetZero(),this.normalImpulse=0,this.tangentImpulse=0,this.id.key=0},e.Copy=function(t){return this.localPoint.Copy(t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.Copy(t.id),this},t}();(de=t.b2ManifoldType||(t.b2ManifoldType={}))[de.e_unknown=-1]="e_unknown",de[de.e_circles=0]="e_circles",de[de.e_faceA=1]="e_faceA",de[de.e_faceB=2]="e_faceB";var ge,ye=function(){function e(){this.points=ve.MakeArray(s),this.localNormal=new Ct,this.localPoint=new Ct,this.type=t.b2ManifoldType.e_unknown,this.pointCount=0}var n=e.prototype;return n.Reset=function(){for(var e=0;e<s;++e)this.points[e].Reset();this.localNormal.SetZero(),this.localPoint.SetZero(),this.type=t.b2ManifoldType.e_unknown,this.pointCount=0},n.Copy=function(t){this.pointCount=t.pointCount;for(var e=0;e<s;++e)this.points[e].Copy(t.points[e]);return this.localNormal.Copy(t.localNormal),this.localPoint.Copy(t.localPoint),this.type=t.type,this},n.Clone=function(){return(new e).Copy(this)},e}(),xe=function(){function e(){this.normal=new Ct,this.points=Ct.MakeArray(s),this.separations=K(s)}return e.prototype.Initialize=function(n,i,r,o,s){if(0!==n.pointCount)switch(n.type){case t.b2ManifoldType.e_circles:this.normal.Set(1,0);var c=Dt.MulXV(i,n.localPoint,e.Initialize_s_pointA),l=Dt.MulXV(o,n.points[0].localPoint,e.Initialize_s_pointB);Ct.DistanceSquaredVV(c,l)>a&&Ct.SubVV(l,c,this.normal).SelfNormalize();var h=Ct.AddVMulSV(c,r,this.normal,e.Initialize_s_cA),u=Ct.SubVMulSV(l,s,this.normal,e.Initialize_s_cB);Ct.MidVV(h,u,this.points[0]),this.separations[0]=Ct.DotVV(Ct.SubVV(u,h,Ct.s_t0),this.normal);break;case t.b2ManifoldType.e_faceA:Pt.MulRV(i.q,n.localNormal,this.normal);for(var _=Dt.MulXV(i,n.localPoint,e.Initialize_s_planePoint),f=0;f<n.pointCount;++f){var d=Dt.MulXV(o,n.points[f].localPoint,e.Initialize_s_clipPoint),p=r-Ct.DotVV(Ct.SubVV(d,_,Ct.s_t0),this.normal),m=Ct.AddVMulSV(d,p,this.normal,e.Initialize_s_cA),v=Ct.SubVMulSV(d,s,this.normal,e.Initialize_s_cB);Ct.MidVV(m,v,this.points[f]),this.separations[f]=Ct.DotVV(Ct.SubVV(v,m,Ct.s_t0),this.normal)}break;case t.b2ManifoldType.e_faceB:Pt.MulRV(o.q,n.localNormal,this.normal);for(var g=Dt.MulXV(o,n.localPoint,e.Initialize_s_planePoint),y=0;y<n.pointCount;++y){var x=Dt.MulXV(i,n.points[y].localPoint,e.Initialize_s_clipPoint),S=s-Ct.DotVV(Ct.SubVV(x,g,Ct.s_t0),this.normal),A=Ct.AddVMulSV(x,S,this.normal,e.Initialize_s_cB),b=Ct.SubVMulSV(x,r,this.normal,e.Initialize_s_cA);Ct.MidVV(b,A,this.points[y]),this.separations[y]=Ct.DotVV(Ct.SubVV(b,A,Ct.s_t0),this.normal)}this.normal.SelfNeg()}},e}();function Se(e,n,i,r){var a;for(a=0;a<i.pointCount;++a){var o=i.points[a].id.key;e[a]=t.b2PointState.b2_removeState;for(var c=0,l=r.pointCount;c<l;++c)if(r.points[c].id.key===o){e[a]=t.b2PointState.b2_persistState;break}}for(;a<s;++a)e[a]=t.b2PointState.b2_nullState;for(a=0;a<r.pointCount;++a){var h=r.points[a].id.key;n[a]=t.b2PointState.b2_addState;for(var u=0,_=i.pointCount;u<_;++u)if(i.points[u].id.key===h){n[a]=t.b2PointState.b2_persistState;break}}for(;a<s;++a)n[a]=t.b2PointState.b2_nullState}xe.Initialize_s_pointA=new Ct,xe.Initialize_s_pointB=new Ct,xe.Initialize_s_cA=new Ct,xe.Initialize_s_cB=new Ct,xe.Initialize_s_planePoint=new Ct,xe.Initialize_s_clipPoint=new Ct,(ge=t.b2PointState||(t.b2PointState={}))[ge.b2_nullState=0]="b2_nullState",ge[ge.b2_addState=1]="b2_addState",ge[ge.b2_persistState=2]="b2_persistState",ge[ge.b2_removeState=3]="b2_removeState";var Ae=function(){function t(){this.v=new Ct,this.id=new me}return t.MakeArray=function(e){return X(e,(function(){return new t}))},t.prototype.Copy=function(t){return this.v.Copy(t.v),this.id.Copy(t.id),this},t}(),be=function(){function t(){this.p1=new Ct,this.p2=new Ct,this.maxFraction=1}return t.prototype.Copy=function(t){return this.p1.Copy(t.p1),this.p2.Copy(t.p2),this.maxFraction=t.maxFraction,this},t}(),Ce=function(){function t(){this.normal=new Ct,this.fraction=0}return t.prototype.Copy=function(t){return this.normal.Copy(t.normal),this.fraction=t.fraction,this},t}(),Te=function(){function t(){this.lowerBound=new Ct,this.upperBound=new Ct,this.m_cache_center=new Ct,this.m_cache_extent=new Ct}var e=t.prototype;return e.Copy=function(t){return this.lowerBound.Copy(t.lowerBound),this.upperBound.Copy(t.upperBound),this},e.IsValid=function(){return!(!this.lowerBound.IsValid()||!this.upperBound.IsValid()||this.upperBound.x<this.lowerBound.x||this.upperBound.y<this.lowerBound.y)},e.GetCenter=function(){return Ct.MidVV(this.lowerBound,this.upperBound,this.m_cache_center)},e.GetExtents=function(){return Ct.ExtVV(this.lowerBound,this.upperBound,this.m_cache_extent)},e.GetPerimeter=function(){return 2*(this.upperBound.x-this.lowerBound.x+(this.upperBound.y-this.lowerBound.y))},e.Combine1=function(t){return this.lowerBound.x=nt(this.lowerBound.x,t.lowerBound.x),this.lowerBound.y=nt(this.lowerBound.y,t.lowerBound.y),this.upperBound.x=rt(this.upperBound.x,t.upperBound.x),this.upperBound.y=rt(this.upperBound.y,t.upperBound.y),this},e.Combine2=function(t,e){return this.lowerBound.x=nt(t.lowerBound.x,e.lowerBound.x),this.lowerBound.y=nt(t.lowerBound.y,e.lowerBound.y),this.upperBound.x=rt(t.upperBound.x,e.upperBound.x),this.upperBound.y=rt(t.upperBound.y,e.upperBound.y),this},t.Combine=function(t,e,n){return n.Combine2(t,e),n},e.Contains=function(t){return!(this.lowerBound.x<=t.lowerBound.x||this.lowerBound.y<=t.lowerBound.y||t.upperBound.x<=this.upperBound.x||t.upperBound.y<=this.upperBound.y)},e.RayCast=function(t,e){var n=-i,a=i,o=e.p1.x,s=e.p1.y,c=e.p2.x-e.p1.x,l=e.p2.y-e.p1.y,h=et(c),u=et(l),_=t.normal;if(h<r){if(o<this.lowerBound.x||this.upperBound.x<o)return!1}else{var f=1/c,d=(this.lowerBound.x-o)*f,p=(this.upperBound.x-o)*f,m=-1;if(d>p){var v=d;d=p,p=v,m=1}if(d>n&&(_.x=m,_.y=0,n=d),n>(a=nt(a,p)))return!1}if(u<r){if(s<this.lowerBound.y||this.upperBound.y<s)return!1}else{var g=1/l,y=(this.lowerBound.y-s)*g,x=(this.upperBound.y-s)*g,S=-1;if(y>x){var A=y;y=x,x=A,S=1}if(y>n&&(_.x=0,_.y=S,n=y),n>(a=nt(a,x)))return!1}return!(n<0||e.maxFraction<n||(t.fraction=n,0))},e.TestContain=function(t){return!(t.x<this.lowerBound.x||this.upperBound.x<t.x||t.y<this.lowerBound.y||this.upperBound.y<t.y)},e.TestOverlap=function(t){return!(this.upperBound.x<t.lowerBound.x||this.upperBound.y<t.lowerBound.y||t.upperBound.x<this.lowerBound.x||t.upperBound.y<this.lowerBound.y)},t}();function Ee(t,e){return!(t.upperBound.x<e.lowerBound.x||t.upperBound.y<e.lowerBound.y||e.upperBound.x<t.lowerBound.x||e.upperBound.y<t.lowerBound.y)}function we(e,n,i,r,a){var o=0,s=n[0],c=n[1],l=Ct.DotVV(i,s.v)-r,h=Ct.DotVV(i,c.v)-r;if(l<=0&&e[o++].Copy(s),h<=0&&e[o++].Copy(c),l*h<0){var u=l/(l-h),_=e[o].v;_.x=s.v.x+u*(c.v.x-s.v.x),_.y=s.v.y+u*(c.v.y-s.v.y);var f=e[o].id;f.cf.indexA=a,f.cf.indexB=s.id.cf.indexB,f.cf.typeA=t.b2ContactFeatureType.e_vertex,f.cf.typeB=t.b2ContactFeatureType.e_face,++o}return o}var Ie=new Gt,Pe=new Ut,De=new Ht;function Re(t,e,n,i,a,o){var s=Ie.Reset();s.proxyA.SetShape(t,e),s.proxyB.SetShape(n,i),s.transformA.Copy(a),s.transformB.Copy(o),s.useRadii=!0;var c=Pe.Reset();c.count=0;var l=De.Reset();return ie(l,c,s),l.distance<10*r}function Me(t){if(null===t)throw new Error;return t}var Oe=function(){function t(t){void 0===t&&(t=0),this.m_id=0,this.aabb=new Te,this._userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=0,this.m_id=t}var e=t.prototype;return e.Reset=function(){this._userData=null},e.IsLeaf=function(){return null===this.child1},Q(t,[{key:"userData",get:function(){if(null===this._userData)throw new Error;return this._userData},set:function(t){if(null!==this._userData)throw new Error;this._userData=t}}]),t}(),Ne=function(){function t(){this.m_root=null,this.m_freeList=null,this.m_path=0,this.m_insertionCount=0,this.m_stack=new Ft(256)}var e=t.prototype;return e.Query=function(t,e){var n=this.m_stack.Reset();for(n.Push(this.m_root);n.GetCount()>0;){var i=n.Pop();if(null!==i&&i.aabb.TestOverlap(t))if(i.IsLeaf()){if(!e(i))return}else n.Push(i.child1),n.Push(i.child2)}},e.QueryPoint=function(t,e){var n=this.m_stack.Reset();for(n.Push(this.m_root);n.GetCount()>0;){var i=n.Pop();if(null!==i&&i.aabb.TestContain(t))if(i.IsLeaf()){if(!e(i))return}else n.Push(i.child1),n.Push(i.child2)}},e.RayCast=function(e,n){var i=e.p1,r=e.p2,a=Ct.SubVV(r,i,t.s_r);a.Normalize();var o=Ct.CrossOneV(a,t.s_v),s=Ct.AbsV(o,t.s_abs_v),c=e.maxFraction,l=t.s_segmentAABB,h=i.x+c*(r.x-i.x),u=i.y+c*(r.y-i.y);l.lowerBound.x=nt(i.x,h),l.lowerBound.y=nt(i.y,u),l.upperBound.x=rt(i.x,h),l.upperBound.y=rt(i.y,u);var _=this.m_stack.Reset();for(_.Push(this.m_root);_.GetCount()>0;){var f=_.Pop();if(null!==f&&Ee(f.aabb,l)){var d=f.aabb.GetCenter(),p=f.aabb.GetExtents();if(!(et(Ct.DotVV(o,Ct.SubVV(i,d,Ct.s_t0)))-Ct.DotVV(s,p)>0))if(f.IsLeaf()){var m=t.s_subInput;m.p1.Copy(e.p1),m.p2.Copy(e.p2),m.maxFraction=c;var v=n(m,f);if(0===v)return;v>0&&(c=v,h=i.x+c*(r.x-i.x),u=i.y+c*(r.y-i.y),l.lowerBound.x=nt(i.x,h),l.lowerBound.y=nt(i.y,u),l.upperBound.x=rt(i.x,h),l.upperBound.y=rt(i.y,u))}else _.Push(f.child1),_.Push(f.child2)}}},e.AllocateNode=function(){if(null!==this.m_freeList){var e=this.m_freeList;return this.m_freeList=e.parent,e.parent=null,e.child1=null,e.child2=null,e.height=0,e}return new Oe(t.s_node_id++)},e.FreeNode=function(t){t.parent=this.m_freeList,t.child1=null,t.child2=null,t.height=-1,t.Reset(),this.m_freeList=t},e.CreateProxy=function(t,e){var n=this.AllocateNode(),i=l,r=l;return n.aabb.lowerBound.x=t.lowerBound.x-i,n.aabb.lowerBound.y=t.lowerBound.y-r,n.aabb.upperBound.x=t.upperBound.x+i,n.aabb.upperBound.y=t.upperBound.y+r,n.userData=e,n.height=0,this.InsertLeaf(n),n},e.DestroyProxy=function(t){this.RemoveLeaf(t),this.FreeNode(t)},e.MoveProxy=function(t,e,n){if(t.aabb.Contains(e))return!1;this.RemoveLeaf(t);var i=l,r=l;t.aabb.lowerBound.x=e.lowerBound.x-i,t.aabb.lowerBound.y=e.lowerBound.y-r,t.aabb.upperBound.x=e.upperBound.x+i,t.aabb.upperBound.y=e.upperBound.y+r;var a=h*n.x,o=h*n.y;return a<0?t.aabb.lowerBound.x+=a:t.aabb.upperBound.x+=a,o<0?t.aabb.lowerBound.y+=o:t.aabb.upperBound.y+=o,this.InsertLeaf(t),!0},e.InsertLeaf=function(e){if(++this.m_insertionCount,null===this.m_root)return this.m_root=e,void(this.m_root.parent=null);for(var n=e.aabb,i=this.m_root;!i.IsLeaf();){var r=Me(i.child1),a=Me(i.child2),o=i.aabb.GetPerimeter(),s=t.s_combinedAABB;s.Combine2(i.aabb,n);var c=s.GetPerimeter(),l=2*c,h=2*(c-o),u=void 0,_=t.s_aabb,f=void 0;r.IsLeaf()?(_.Combine2(n,r.aabb),u=_.GetPerimeter()+h):(_.Combine2(n,r.aabb),f=r.aabb.GetPerimeter(),u=_.GetPerimeter()-f+h);var d=void 0;if(a.IsLeaf()?(_.Combine2(n,a.aabb),d=_.GetPerimeter()+h):(_.Combine2(n,a.aabb),f=a.aabb.GetPerimeter(),d=_.GetPerimeter()-f+h),l<u&&l<d)break;i=u<d?r:a}var p=i.parent,m=this.AllocateNode();m.parent=p,m.aabb.Combine2(n,i.aabb),m.height=i.height+1,null!==p?(p.child1===i?p.child1=m:p.child2=m,m.child1=i,m.child2=e,i.parent=m,e.parent=m):(m.child1=i,m.child2=e,i.parent=m,e.parent=m,this.m_root=m);for(var v=e.parent;null!==v;){var g=Me((v=this.Balance(v)).child1),y=Me(v.child2);v.height=1+rt(g.height,y.height),v.aabb.Combine2(g.aabb,y.aabb),v=v.parent}},e.RemoveLeaf=function(t){if(t!==this.m_root){var e=Me(t.parent),n=e&&e.parent,i=Me(e.child1===t?e.child2:e.child1);if(null!==n){n.child1===e?n.child1=i:n.child2=i,i.parent=n,this.FreeNode(e);for(var r=n;null!==r;){var a=Me((r=this.Balance(r)).child1),o=Me(r.child2);r.aabb.Combine2(a.aabb,o.aabb),r.height=1+rt(a.height,o.height),r=r.parent}}else this.m_root=i,i.parent=null,this.FreeNode(e)}else this.m_root=null},e.Balance=function(t){if(t.IsLeaf()||t.height<2)return t;var e=Me(t.child1),n=Me(t.child2),i=n.height-e.height;if(i>1){var r=Me(n.child1),a=Me(n.child2);return n.child1=t,n.parent=t.parent,t.parent=n,null!==n.parent?n.parent.child1===t?n.parent.child1=n:n.parent.child2=n:this.m_root=n,r.height>a.height?(n.child2=r,t.child2=a,a.parent=t,t.aabb.Combine2(e.aabb,a.aabb),n.aabb.Combine2(t.aabb,r.aabb),t.height=1+rt(e.height,a.height),n.height=1+rt(t.height,r.height)):(n.child2=a,t.child2=r,r.parent=t,t.aabb.Combine2(e.aabb,r.aabb),n.aabb.Combine2(t.aabb,a.aabb),t.height=1+rt(e.height,r.height),n.height=1+rt(t.height,a.height)),n}if(i<-1){var o=Me(e.child1),s=Me(e.child2);return e.child1=t,e.parent=t.parent,t.parent=e,null!==e.parent?e.parent.child1===t?e.parent.child1=e:e.parent.child2=e:this.m_root=e,o.height>s.height?(e.child2=o,t.child1=s,s.parent=t,t.aabb.Combine2(n.aabb,s.aabb),e.aabb.Combine2(t.aabb,o.aabb),t.height=1+rt(n.height,s.height),e.height=1+rt(t.height,o.height)):(e.child2=s,t.child1=o,o.parent=t,t.aabb.Combine2(n.aabb,o.aabb),e.aabb.Combine2(t.aabb,s.aabb),t.height=1+rt(n.height,o.height),e.height=1+rt(t.height,s.height)),e}return t},e.GetHeight=function(){return null===this.m_root?0:this.m_root.height},t.GetAreaNode=function(e){if(null===e)return 0;if(e.IsLeaf())return 0;var n=e.aabb.GetPerimeter();return(n+=t.GetAreaNode(e.child1))+t.GetAreaNode(e.child2)},e.GetAreaRatio=function(){if(null===this.m_root)return 0;var e=this.m_root.aabb.GetPerimeter();return t.GetAreaNode(this.m_root)/e},t.ComputeHeightNode=function(e){return null===e||e.IsLeaf()?0:1+rt(t.ComputeHeightNode(e.child1),t.ComputeHeightNode(e.child2))},e.ComputeHeight=function(){return t.ComputeHeightNode(this.m_root)},e.ValidateStructure=function(t){if(null!==t&&(this.m_root,!t.IsLeaf())){var e=Me(t.child1),n=Me(t.child2);this.ValidateStructure(e),this.ValidateStructure(n)}},e.ValidateMetrics=function(e){if(null!==e&&!e.IsLeaf()){var n=Me(e.child1),i=Me(e.child2);t.s_aabb.Combine2(n.aabb,i.aabb),this.ValidateMetrics(n),this.ValidateMetrics(i)}},e.Validate=function(){},t.GetMaxBalanceNode=function(t,e){if(null===t)return e;if(t.height<=1)return e;var n=Me(t.child1),i=Me(t.child2);return rt(e,et(i.height-n.height))},e.GetMaxBalance=function(){return t.GetMaxBalanceNode(this.m_root,0)},e.RebuildBottomUp=function(){this.Validate()},t.ShiftOriginNode=function(e,n){if(null!==e&&!(e.height<=1)){var i=e.child1,r=e.child2;t.ShiftOriginNode(i,n),t.ShiftOriginNode(r,n),e.aabb.lowerBound.SelfSub(n),e.aabb.upperBound.SelfSub(n)}},e.ShiftOrigin=function(e){t.ShiftOriginNode(this.m_root,e)},t}();function Be(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function Le(t,e){return t<e}function Fe(t,e,n,i){void 0===e&&(e=0),void 0===n&&(n=t.length-e),void 0===i&&(i=Le);for(var r=e,a=[],o=0;;){for(;r+1<n;n++){var s=t[r+Math.floor(Math.random()*(n-r))];a[o++]=n;for(var c=r-1;;){for(;i(t[++c],s););for(;i(s,t[--n]););if(c>=n)break;Be(t,c,n)}}if(0===o)break;r=n,n=a[--o]}return t}Ne.s_r=new Ct,Ne.s_v=new Ct,Ne.s_abs_v=new Ct,Ne.s_segmentAABB=new Te,Ne.s_subInput=new be,Ne.s_combinedAABB=new Te,Ne.s_aabb=new Te,Ne.s_node_id=0;var Ve=function(t,e){this.proxyA=t,this.proxyB=e},ze=function(){function t(){this.m_tree=new Ne,this.m_proxyCount=0,this.m_moveCount=0,this.m_moveBuffer=[],this.m_pairCount=0,this.m_pairBuffer=[]}var e=t.prototype;return e.CreateProxy=function(t,e){var n=this.m_tree.CreateProxy(t,e);return++this.m_proxyCount,this.BufferMove(n),n},e.DestroyProxy=function(t){this.UnBufferMove(t),--this.m_proxyCount,this.m_tree.DestroyProxy(t)},e.MoveProxy=function(t,e,n){this.m_tree.MoveProxy(t,e,n)&&this.BufferMove(t)},e.TouchProxy=function(t){this.BufferMove(t)},e.GetProxyCount=function(){return this.m_proxyCount},e.UpdatePairs=function(t){var e=this;this.m_pairCount=0;for(var n=function(t){var n=e.m_moveBuffer[t];if(null===n)return"continue";var i=n.aabb;e.m_tree.Query(i,(function(t){if(t.m_id===n.m_id)return!0;var i,r;if(t.m_id<n.m_id?(i=t,r=n):(i=n,r=t),e.m_pairCount===e.m_pairBuffer.length)e.m_pairBuffer[e.m_pairCount]=new Ve(i,r);else{var a=e.m_pairBuffer[e.m_pairCount];a.proxyA=i,a.proxyB=r}return++e.m_pairCount,!0}))},i=0;i<this.m_moveCount;++i)n(i);this.m_moveCount=0,Fe(this.m_pairBuffer,0,this.m_pairCount,ke);for(var r=0;r<this.m_pairCount;){var a=this.m_pairBuffer[r];for(t(a.proxyA.userData,a.proxyB.userData),++r;r<this.m_pairCount;){var o=this.m_pairBuffer[r];if(o.proxyA.m_id!==a.proxyA.m_id||o.proxyB.m_id!==a.proxyB.m_id)break;++r}}},e.Query=function(t,e){this.m_tree.Query(t,e)},e.QueryPoint=function(t,e){this.m_tree.QueryPoint(t,e)},e.RayCast=function(t,e){this.m_tree.RayCast(t,e)},e.GetTreeHeight=function(){return this.m_tree.GetHeight()},e.GetTreeBalance=function(){return this.m_tree.GetMaxBalance()},e.GetTreeQuality=function(){return this.m_tree.GetAreaRatio()},e.ShiftOrigin=function(t){this.m_tree.ShiftOrigin(t)},e.BufferMove=function(t){this.m_moveBuffer[this.m_moveCount]=t,++this.m_moveCount},e.UnBufferMove=function(t){var e=this.m_moveBuffer.indexOf(t);this.m_moveBuffer[e]=null},t}();function ke(t,e){return t.proxyA.m_id<e.proxyA.m_id||t.proxyA.m_id===e.proxyA.m_id&&t.proxyB.m_id<e.proxyB.m_id}function Ue(){t.b2_toiTime=0,t.b2_toiMaxTime=0,t.b2_toiCalls=0,t.b2_toiIters=0,t.b2_toiMaxIters=0,t.b2_toiRootIters=0,t.b2_toiMaxRootIters=0}t.b2_toiTime=0,t.b2_toiMaxTime=0,t.b2_toiCalls=0,t.b2_toiIters=0,t.b2_toiMaxIters=0,t.b2_toiRootIters=0,t.b2_toiMaxRootIters=0;var Ge,He=new Dt,je=new Dt,We=new Ct,qe=new Ct,Xe=new Ct,Ye=new Ct,Ke=new Ct,Je=function(){this.proxyA=new kt,this.proxyB=new kt,this.sweepA=new Mt,this.sweepB=new Mt,this.tMax=0};(Ge=t.b2TOIOutputState||(t.b2TOIOutputState={}))[Ge.e_unknown=0]="e_unknown",Ge[Ge.e_failed=1]="e_failed",Ge[Ge.e_overlapped=2]="e_overlapped",Ge[Ge.e_touching=3]="e_touching",Ge[Ge.e_separated=4]="e_separated";var Qe,Ze=function(){this.state=t.b2TOIOutputState.e_unknown,this.t=0};(Qe=t.b2SeparationFunctionType||(t.b2SeparationFunctionType={}))[Qe.e_unknown=-1]="e_unknown",Qe[Qe.e_points=0]="e_points",Qe[Qe.e_faceA=1]="e_faceA",Qe[Qe.e_faceB=2]="e_faceB";var $e=function(){function e(){this.m_sweepA=new Mt,this.m_sweepB=new Mt,this.m_type=t.b2SeparationFunctionType.e_unknown,this.m_localPoint=new Ct,this.m_axis=new Ct}var n=e.prototype;return n.Initialize=function(e,n,i,r,a,o){this.m_proxyA=n,this.m_proxyB=r;var s=e.count;this.m_sweepA.Copy(i),this.m_sweepB.Copy(a);var c=He,l=je;if(this.m_sweepA.GetTransform(c,o),this.m_sweepB.GetTransform(l,o),1===s){this.m_type=t.b2SeparationFunctionType.e_points;var h=this.m_proxyA.GetVertex(e.indexA[0]),u=this.m_proxyB.GetVertex(e.indexB[0]),_=Dt.MulXV(c,h,We),f=Dt.MulXV(l,u,qe);Ct.SubVV(f,_,this.m_axis);var d=this.m_axis.Normalize();return this.m_localPoint.SetZero(),d}if(e.indexA[0]===e.indexA[1]){this.m_type=t.b2SeparationFunctionType.e_faceB;var p=this.m_proxyB.GetVertex(e.indexB[0]),m=this.m_proxyB.GetVertex(e.indexB[1]);Ct.CrossVOne(Ct.SubVV(m,p,Ct.s_t0),this.m_axis).SelfNormalize();var v=Pt.MulRV(l.q,this.m_axis,Xe);Ct.MidVV(p,m,this.m_localPoint);var g=Dt.MulXV(l,this.m_localPoint,qe),y=this.m_proxyA.GetVertex(e.indexA[0]),x=Dt.MulXV(c,y,We),S=Ct.DotVV(Ct.SubVV(x,g,Ct.s_t0),v);return S<0&&(this.m_axis.SelfNeg(),S=-S),S}this.m_type=t.b2SeparationFunctionType.e_faceA;var A=this.m_proxyA.GetVertex(e.indexA[0]),b=this.m_proxyA.GetVertex(e.indexA[1]);Ct.CrossVOne(Ct.SubVV(b,A,Ct.s_t0),this.m_axis).SelfNormalize();var C=Pt.MulRV(c.q,this.m_axis,Xe);Ct.MidVV(A,b,this.m_localPoint);var T=Dt.MulXV(c,this.m_localPoint,We),E=this.m_proxyB.GetVertex(e.indexB[0]),w=Dt.MulXV(l,E,qe),I=Ct.DotVV(Ct.SubVV(w,T,Ct.s_t0),C);return I<0&&(this.m_axis.SelfNeg(),I=-I),I},n.FindMinSeparation=function(e,n,i){var r=He,a=je;switch(this.m_sweepA.GetTransform(r,i),this.m_sweepB.GetTransform(a,i),this.m_type){case t.b2SeparationFunctionType.e_points:var o=Pt.MulTRV(r.q,this.m_axis,Ye),s=Pt.MulTRV(a.q,Ct.NegV(this.m_axis,Ct.s_t0),Ke);e[0]=this.m_proxyA.GetSupport(o),n[0]=this.m_proxyB.GetSupport(s);var c=this.m_proxyA.GetVertex(e[0]),l=this.m_proxyB.GetVertex(n[0]),h=Dt.MulXV(r,c,We),u=Dt.MulXV(a,l,qe);return Ct.DotVV(Ct.SubVV(u,h,Ct.s_t0),this.m_axis);case t.b2SeparationFunctionType.e_faceA:var _=Pt.MulRV(r.q,this.m_axis,Xe),f=Dt.MulXV(r,this.m_localPoint,We),d=Pt.MulTRV(a.q,Ct.NegV(_,Ct.s_t0),Ke);e[0]=-1,n[0]=this.m_proxyB.GetSupport(d);var p=this.m_proxyB.GetVertex(n[0]),m=Dt.MulXV(a,p,qe);return Ct.DotVV(Ct.SubVV(m,f,Ct.s_t0),_);case t.b2SeparationFunctionType.e_faceB:var v=Pt.MulRV(a.q,this.m_axis,Xe),g=Dt.MulXV(a,this.m_localPoint,qe),y=Pt.MulTRV(r.q,Ct.NegV(v,Ct.s_t0),Ye);n[0]=-1,e[0]=this.m_proxyA.GetSupport(y);var x=this.m_proxyA.GetVertex(e[0]),S=Dt.MulXV(r,x,We);return Ct.DotVV(Ct.SubVV(S,g,Ct.s_t0),v);default:return e[0]=-1,n[0]=-1,0}},n.Evaluate=function(e,n,i){var r=He,a=je;switch(this.m_sweepA.GetTransform(r,i),this.m_sweepB.GetTransform(a,i),this.m_type){case t.b2SeparationFunctionType.e_points:var o=this.m_proxyA.GetVertex(e),s=this.m_proxyB.GetVertex(n),c=Dt.MulXV(r,o,We),l=Dt.MulXV(a,s,qe);return Ct.DotVV(Ct.SubVV(l,c,Ct.s_t0),this.m_axis);case t.b2SeparationFunctionType.e_faceA:var h=Pt.MulRV(r.q,this.m_axis,Xe),u=Dt.MulXV(r,this.m_localPoint,We),_=this.m_proxyB.GetVertex(n),f=Dt.MulXV(a,_,qe);return Ct.DotVV(Ct.SubVV(f,u,Ct.s_t0),h);case t.b2SeparationFunctionType.e_faceB:var d=Pt.MulRV(a.q,this.m_axis,Xe),p=Dt.MulXV(a,this.m_localPoint,qe),m=this.m_proxyA.GetVertex(e),v=Dt.MulXV(r,m,We);return Ct.DotVV(Ct.SubVV(v,p,Ct.s_t0),d);default:return 0}},e}(),tn=new Bt,en=new Ut,nn=new Gt,rn=new Ht,an=new $e,on=[0],sn=[0],cn=new Mt,ln=new Mt;function hn(e,n){var i=tn.Reset();++t.b2_toiCalls,e.state=t.b2TOIOutputState.e_unknown,e.t=n.tMax;var r=n.proxyA,a=n.proxyB,o=rt(c,rt(r.m_count,a.m_count)),s=cn.Copy(n.sweepA),l=ln.Copy(n.sweepB);s.Normalize(),l.Normalize();var h=n.tMax,_=r.m_radius+a.m_radius,f=rt(u,_-3*u),d=.25*u,p=0,m=20,v=0,g=en;g.count=0;var y=nn;for(y.proxyA.Copy(n.proxyA),y.proxyB.Copy(n.proxyB),y.useRadii=!1;;){var x=He,S=je;s.GetTransform(x,p),l.GetTransform(S,p),y.transformA.Copy(x),y.transformB.Copy(S);var A=rn;if(ie(A,g,y),A.distance<=0){e.state=t.b2TOIOutputState.e_overlapped,e.t=0;break}if(A.distance<f+d){e.state=t.b2TOIOutputState.e_touching,e.t=p;break}var b=an;b.Initialize(g,r,s,a,l,p);for(var C=!1,T=h,E=0;;){var w=on,I=sn,P=b.FindMinSeparation(w,I,T);if(P>f+d){e.state=t.b2TOIOutputState.e_separated,e.t=h,C=!0;break}if(P>f-d){p=T;break}var D=b.Evaluate(w[0],I[0],p);if(D<f-d){e.state=t.b2TOIOutputState.e_failed,e.t=p,C=!0;break}if(D<=f+d){e.state=t.b2TOIOutputState.e_touching,e.t=p,C=!0;break}for(var R=0,M=p,O=T;;){var N=0;N=1&R?M+(f-D)*(O-M)/(P-D):.5*(M+O),++R,++t.b2_toiRootIters;var B=b.Evaluate(w[0],I[0],N);if(et(B-f)<d){T=N;break}if(B>f?(M=N,D=B):(O=N,P=B),50===R)break}if(t.b2_toiMaxRootIters=rt(t.b2_toiMaxRootIters,R),++E===o)break}if(++v,++t.b2_toiIters,C)break;if(v===m){e.state=t.b2TOIOutputState.e_failed,e.t=p;break}}t.b2_toiMaxIters=rt(t.b2_toiMaxIters,v);var L=i.GetMilliseconds();t.b2_toiMaxTime=rt(t.b2_toiMaxTime,L),t.b2_toiTime+=L}var un=new Ct,_n=new Ct;function fn(e,n,i,r,a){e.pointCount=0;var o=Dt.MulXV(i,n.m_p,un),s=Dt.MulXV(a,r.m_p,_n),c=Ct.DistanceSquaredVV(o,s),l=n.m_radius+r.m_radius;c>l*l||(e.type=t.b2ManifoldType.e_circles,e.localPoint.Copy(n.m_p),e.localNormal.SetZero(),e.pointCount=1,e.points[0].localPoint.Copy(r.m_p),e.points[0].id.key=0)}var dn=new Ct,pn=new Ct,mn=new Ct;function vn(e,n,a,o,s){e.pointCount=0;for(var c=Dt.MulXV(s,o.m_p,dn),l=Dt.MulTXV(a,c,pn),h=0,u=-i,_=n.m_radius+o.m_radius,f=n.m_count,d=n.m_vertices,p=n.m_normals,m=0;m<f;++m){var v=Ct.DotVV(p[m],Ct.SubVV(l,d[m],Ct.s_t0));if(v>_)return;v>u&&(u=v,h=m)}var g=h,y=(g+1)%f,x=d[g],S=d[y];if(u<r)return e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,e.localNormal.Copy(p[h]),Ct.MidVV(x,S,e.localPoint),e.points[0].localPoint.Copy(o.m_p),void(e.points[0].id.key=0);var A=Ct.DotVV(Ct.SubVV(l,x,Ct.s_t0),Ct.SubVV(S,x,Ct.s_t1)),b=Ct.DotVV(Ct.SubVV(l,S,Ct.s_t0),Ct.SubVV(x,S,Ct.s_t1));if(A<=0){if(Ct.DistanceSquaredVV(l,x)>_*_)return;e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,Ct.SubVV(l,x,e.localNormal).SelfNormalize(),e.localPoint.Copy(x),e.points[0].localPoint.Copy(o.m_p),e.points[0].id.key=0}else if(b<=0){if(Ct.DistanceSquaredVV(l,S)>_*_)return;e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,Ct.SubVV(l,S,e.localNormal).SelfNormalize(),e.localPoint.Copy(S),e.points[0].localPoint.Copy(o.m_p),e.points[0].id.key=0}else{var C=Ct.MidVV(x,S,mn);if(Ct.DotVV(Ct.SubVV(l,C,Ct.s_t1),p[g])>_)return;e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,e.localNormal.Copy(p[g]).SelfNormalize(),e.localPoint.Copy(C),e.points[0].localPoint.Copy(o.m_p),e.points[0].id.key=0}}var gn=new Ct,yn=new Ct,xn=new Ct,Sn=new Ct;function An(t,e,n,r,a){for(var o=t.m_vertices,s=t.m_normals,c=r.m_count,l=r.m_vertices,h=Pt.MulRV(e.q,s[n],gn),u=Pt.MulTRV(a.q,h,yn),_=0,f=i,d=0;d<c;++d){var p=Ct.DotVV(l[d],u);p<f&&(f=p,_=d)}var m=Dt.MulXV(e,o[n],xn),v=Dt.MulXV(a,l[_],Sn);return Ct.DotVV(Ct.SubVV(v,m,Ct.s_t0),h)}var bn=new Ct,Cn=new Ct;function Tn(t,e,n,r,a){for(var o=e.m_count,s=e.m_normals,c=Ct.SubVV(Dt.MulXV(a,r.m_centroid,Ct.s_t0),Dt.MulXV(n,e.m_centroid,Ct.s_t1),bn),l=Pt.MulTRV(n.q,c,Cn),h=0,u=-i,_=0;_<o;++_){var f=Ct.DotVV(s[_],l);f>u&&(u=f,h=_)}var d=An(e,n,h,r,a),p=(h+o-1)%o,m=An(e,n,p,r,a),v=(h+1)%o,g=An(e,n,v,r,a),y=0,x=0,S=0;if(m>d&&m>g)S=-1,y=p,x=m;else{if(!(g>d))return t[0]=h,d;S=1,y=v,x=g}for(;(d=An(e,n,h=-1===S?(y+o-1)%o:(y+1)%o,r,a))>x;)y=h,x=d;return t[0]=y,x}var En=new Ct;function wn(e,n,r,a,o,s){for(var c=n.m_normals,l=o.m_count,h=o.m_vertices,u=o.m_normals,_=Pt.MulTRV(s.q,Pt.MulRV(r.q,c[a],Ct.s_t0),En),f=0,d=i,p=0;p<l;++p){var m=Ct.DotVV(_,u[p]);m<d&&(d=m,f=p)}var v=f,g=(v+1)%l,y=e[0];Dt.MulXV(s,h[v],y.v);var x=y.id.cf;x.indexA=a,x.indexB=v,x.typeA=t.b2ContactFeatureType.e_face,x.typeB=t.b2ContactFeatureType.e_vertex;var S=e[1];Dt.MulXV(s,h[g],S.v);var A=S.id.cf;A.indexA=a,A.indexB=g,A.typeA=t.b2ContactFeatureType.e_face,A.typeB=t.b2ContactFeatureType.e_vertex}var In=Ae.MakeArray(2),Pn=Ae.MakeArray(2),Dn=Ae.MakeArray(2),Rn=[0],Mn=[0],On=new Ct,Nn=new Ct,Bn=new Ct,Ln=new Ct,Fn=new Ct,Vn=new Ct,zn=new Ct,kn=new Ct;function Un(e,n,i,r,a){e.pointCount=0;var o=n.m_radius+r.m_radius,c=Rn;c[0]=0;var l=Tn(c,n,i,r,a);if(!(l>o)){var h=Mn;h[0]=0;var u=Tn(h,r,a,n,i);if(!(u>o)){var _,f,d,p,m=0,v=0;u>.98*l+.001?(_=r,f=n,d=a,p=i,m=h[0],e.type=t.b2ManifoldType.e_faceB,v=1):(_=n,f=r,d=i,p=a,m=c[0],e.type=t.b2ManifoldType.e_faceA,v=0);var g=In;wn(g,_,d,m,f,p);var y=_.m_count,x=_.m_vertices,S=m,A=(m+1)%y,b=x[S],C=x[A],T=Ct.SubVV(C,b,On);T.Normalize();var E=Ct.CrossVOne(T,Nn),w=Ct.MidVV(b,C,Bn),I=Pt.MulRV(d.q,T,Fn),P=Ct.CrossVOne(I,Ln),D=Dt.MulXV(d,b,zn),R=Dt.MulXV(d,C,kn),M=Ct.DotVV(P,D),O=-Ct.DotVV(I,D)+o,N=Ct.DotVV(I,R)+o,B=Pn,L=Dn;if(!(we(B,g,Ct.NegV(I,Vn),O,S)<2||we(L,B,I,N,A)<2)){e.localNormal.Copy(E),e.localPoint.Copy(w);for(var F=0,V=0;V<s;++V){var z=L[V];if(Ct.DotVV(P,z.v)-M<=o){var k=e.points[F];if(Dt.MulTXV(p,z.v,k.localPoint),k.id.Copy(z.id),v){var U=k.id.cf;k.id.cf.indexA=U.indexB,k.id.cf.indexB=U.indexA,k.id.cf.typeA=U.typeB,k.id.cf.typeB=U.typeA}++F}}e.pointCount=F}}}}var Gn,Hn=new Ct,jn=new Ct,Wn=new Ct,qn=new Ct,Xn=new Ct,Yn=new Ct,Kn=new Ct,Jn=new me;function Qn(e,n,i,r,a){e.pointCount=0;var o=Dt.MulTXV(i,Dt.MulXV(a,r.m_p,Ct.s_t0),Hn),s=n.m_vertex1,c=n.m_vertex2,l=Ct.SubVV(c,s,jn),h=Ct.DotVV(l,Ct.SubVV(c,o,Ct.s_t0)),u=Ct.DotVV(l,Ct.SubVV(o,s,Ct.s_t0)),_=n.m_radius+r.m_radius,f=Jn;if(f.cf.indexB=0,f.cf.typeB=t.b2ContactFeatureType.e_vertex,u<=0){var d=s,p=Ct.SubVV(o,d,Wn);if(Ct.DotVV(p,p)>_*_)return;if(n.m_hasVertex0){var m=n.m_vertex0,v=s,g=Ct.SubVV(v,m,qn);if(Ct.DotVV(g,Ct.SubVV(v,o,Ct.s_t0))>0)return}return f.cf.indexA=0,f.cf.typeA=t.b2ContactFeatureType.e_vertex,e.pointCount=1,e.type=t.b2ManifoldType.e_circles,e.localNormal.SetZero(),e.localPoint.Copy(d),e.points[0].id.Copy(f),void e.points[0].localPoint.Copy(r.m_p)}if(h<=0){var y=c,x=Ct.SubVV(o,y,Wn);if(Ct.DotVV(x,x)>_*_)return;if(n.m_hasVertex3){var S=n.m_vertex3,A=c,b=Ct.SubVV(S,A,Xn);if(Ct.DotVV(b,Ct.SubVV(o,A,Ct.s_t0))>0)return}return f.cf.indexA=1,f.cf.typeA=t.b2ContactFeatureType.e_vertex,e.pointCount=1,e.type=t.b2ManifoldType.e_circles,e.localNormal.SetZero(),e.localPoint.Copy(y),e.points[0].id.Copy(f),void e.points[0].localPoint.Copy(r.m_p)}var C=Ct.DotVV(l,l),T=Yn;T.x=1/C*(h*s.x+u*c.x),T.y=1/C*(h*s.y+u*c.y);var E=Ct.SubVV(o,T,Wn);if(!(Ct.DotVV(E,E)>_*_)){var w=Kn.Set(-l.y,l.x);Ct.DotVV(w,Ct.SubVV(o,s,Ct.s_t0))<0&&w.Set(-w.x,-w.y),w.Normalize(),f.cf.indexA=0,f.cf.typeA=t.b2ContactFeatureType.e_face,e.pointCount=1,e.type=t.b2ManifoldType.e_faceA,e.localNormal.Copy(w),e.localPoint.Copy(s),e.points[0].id.Copy(f),e.points[0].localPoint.Copy(r.m_p)}}!function(t){t[t.e_unknown=0]="e_unknown",t[t.e_edgeA=1]="e_edgeA",t[t.e_edgeB=2]="e_edgeB"}(Gn||(Gn={}));var Zn,$n=function(){this.type=Gn.e_unknown,this.index=0,this.separation=0},ti=function(){this.vertices=[],this.normals=[],this.count=0},ei=function(){this.i1=0,this.i2=0,this.v1=new Ct,this.v2=new Ct,this.normal=new Ct,this.sideNormal1=new Ct,this.sideOffset1=0,this.sideNormal2=new Ct,this.sideOffset2=0};!function(t){t[t.e_isolated=0]="e_isolated",t[t.e_concave=1]="e_concave",t[t.e_convex=2]="e_convex"}(Zn||(Zn={}));var ni=function(){function e(){this.m_polygonB=new ti,this.m_xf=new Dt,this.m_centroidB=new Ct,this.m_v0=new Ct,this.m_v1=new Ct,this.m_v2=new Ct,this.m_v3=new Ct,this.m_normal0=new Ct,this.m_normal1=new Ct,this.m_normal2=new Ct,this.m_normal=new Ct,this.m_type1=Zn.e_isolated,this.m_type2=Zn.e_isolated,this.m_lowerLimit=new Ct,this.m_upperLimit=new Ct,this.m_radius=0,this.m_front=!1}var n=e.prototype;return n.Collide=function(n,i,r,a,o){Dt.MulTXX(r,o,this.m_xf),Dt.MulXV(this.m_xf,a.m_centroid,this.m_centroidB),this.m_v0.Copy(i.m_vertex0),this.m_v1.Copy(i.m_vertex1),this.m_v2.Copy(i.m_vertex2),this.m_v3.Copy(i.m_vertex3);var c=i.m_hasVertex0,l=i.m_hasVertex3,h=Ct.SubVV(this.m_v2,this.m_v1,e.s_edge1);h.Normalize(),this.m_normal1.Set(h.y,-h.x);var u=Ct.DotVV(this.m_normal1,Ct.SubVV(this.m_centroidB,this.m_v1,Ct.s_t0)),_=0,f=0,d=!1,p=!1;if(c){var m=Ct.SubVV(this.m_v1,this.m_v0,e.s_edge0);m.Normalize(),this.m_normal0.Set(m.y,-m.x),d=Ct.CrossVV(m,h)>=0,_=Ct.DotVV(this.m_normal0,Ct.SubVV(this.m_centroidB,this.m_v0,Ct.s_t0))}if(l){var v=Ct.SubVV(this.m_v3,this.m_v2,e.s_edge2);v.Normalize(),this.m_normal2.Set(v.y,-v.x),p=Ct.CrossVV(h,v)>0,f=Ct.DotVV(this.m_normal2,Ct.SubVV(this.m_centroidB,this.m_v2,Ct.s_t0))}c&&l?d&&p?(this.m_front=_>=0||u>=0||f>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):d?(this.m_front=_>=0||u>=0&&f>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):p?(this.m_front=f>=0||_>=0&&u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):(this.m_front=_>=0&&u>=0&&f>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):c?d?(this.m_front=_>=0||u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal0),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg())):(this.m_front=_>=0&&u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal0).SelfNeg())):l?p?(this.m_front=u>=0||f>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal2)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=u>=0&&f>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1)):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal2).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1))):(this.m_front=u>=0,this.m_front?(this.m_normal.Copy(this.m_normal1),this.m_lowerLimit.Copy(this.m_normal1).SelfNeg(),this.m_upperLimit.Copy(this.m_normal1).SelfNeg()):(this.m_normal.Copy(this.m_normal1).SelfNeg(),this.m_lowerLimit.Copy(this.m_normal1),this.m_upperLimit.Copy(this.m_normal1))),this.m_polygonB.count=a.m_count;for(var g=0;g<a.m_count;++g)this.m_polygonB.vertices.length<=g&&this.m_polygonB.vertices.push(new Ct),this.m_polygonB.normals.length<=g&&this.m_polygonB.normals.push(new Ct),Dt.MulXV(this.m_xf,a.m_vertices[g],this.m_polygonB.vertices[g]),Pt.MulRV(this.m_xf.q,a.m_normals[g],this.m_polygonB.normals[g]);this.m_radius=a.m_radius+i.m_radius,n.pointCount=0;var y=this.ComputeEdgeSeparation(e.s_edgeAxis);if(y.type!==Gn.e_unknown&&!(y.separation>this.m_radius)){var x=this.ComputePolygonSeparation(e.s_polygonAxis);if(!(x.type!==Gn.e_unknown&&x.separation>this.m_radius)){var S,A=.98,b=.001;S=x.type===Gn.e_unknown?y:x.separation>A*y.separation+b?x:y;var C=e.s_ie,T=e.s_rf;if(S.type===Gn.e_edgeA){n.type=t.b2ManifoldType.e_faceA;for(var E=0,w=Ct.DotVV(this.m_normal,this.m_polygonB.normals[0]),I=1;I<this.m_polygonB.count;++I){var P=Ct.DotVV(this.m_normal,this.m_polygonB.normals[I]);P<w&&(w=P,E=I)}var D=E,R=(D+1)%this.m_polygonB.count,M=C[0];M.v.Copy(this.m_polygonB.vertices[D]),M.id.cf.indexA=0,M.id.cf.indexB=D,M.id.cf.typeA=t.b2ContactFeatureType.e_face,M.id.cf.typeB=t.b2ContactFeatureType.e_vertex;var O=C[1];O.v.Copy(this.m_polygonB.vertices[R]),O.id.cf.indexA=0,O.id.cf.indexB=R,O.id.cf.typeA=t.b2ContactFeatureType.e_face,O.id.cf.typeB=t.b2ContactFeatureType.e_vertex,this.m_front?(T.i1=0,T.i2=1,T.v1.Copy(this.m_v1),T.v2.Copy(this.m_v2),T.normal.Copy(this.m_normal1)):(T.i1=1,T.i2=0,T.v1.Copy(this.m_v2),T.v2.Copy(this.m_v1),T.normal.Copy(this.m_normal1).SelfNeg())}else{n.type=t.b2ManifoldType.e_faceB;var N=C[0];N.v.Copy(this.m_v1),N.id.cf.indexA=0,N.id.cf.indexB=S.index,N.id.cf.typeA=t.b2ContactFeatureType.e_vertex,N.id.cf.typeB=t.b2ContactFeatureType.e_face;var B=C[1];B.v.Copy(this.m_v2),B.id.cf.indexA=0,B.id.cf.indexB=S.index,B.id.cf.typeA=t.b2ContactFeatureType.e_vertex,B.id.cf.typeB=t.b2ContactFeatureType.e_face,T.i1=S.index,T.i2=(T.i1+1)%this.m_polygonB.count,T.v1.Copy(this.m_polygonB.vertices[T.i1]),T.v2.Copy(this.m_polygonB.vertices[T.i2]),T.normal.Copy(this.m_polygonB.normals[T.i1])}T.sideNormal1.Set(T.normal.y,-T.normal.x),T.sideNormal2.Copy(T.sideNormal1).SelfNeg(),T.sideOffset1=Ct.DotVV(T.sideNormal1,T.v1),T.sideOffset2=Ct.DotVV(T.sideNormal2,T.v2);var L=e.s_clipPoints1,F=e.s_clipPoints2;if(!(we(L,C,T.sideNormal1,T.sideOffset1,T.i1)<s||we(F,L,T.sideNormal2,T.sideOffset2,T.i2)<s)){S.type===Gn.e_edgeA?(n.localNormal.Copy(T.normal),n.localPoint.Copy(T.v1)):(n.localNormal.Copy(a.m_normals[T.i1]),n.localPoint.Copy(a.m_vertices[T.i1]));for(var V=0,z=0;z<s;++z)if(Ct.DotVV(T.normal,Ct.SubVV(F[z].v,T.v1,Ct.s_t0))<=this.m_radius){var k=n.points[V];S.type===Gn.e_edgeA?(Dt.MulTXV(this.m_xf,F[z].v,k.localPoint),k.id.Copy(F[z].id)):(k.localPoint.Copy(F[z].v),k.id.cf.typeA=F[z].id.cf.typeB,k.id.cf.typeB=F[z].id.cf.typeA,k.id.cf.indexA=F[z].id.cf.indexB,k.id.cf.indexB=F[z].id.cf.indexA),++V}n.pointCount=V}}}},n.ComputeEdgeSeparation=function(t){var e=t;e.type=Gn.e_edgeA,e.index=this.m_front?0:1,e.separation=i;for(var n=0;n<this.m_polygonB.count;++n){var r=Ct.DotVV(this.m_normal,Ct.SubVV(this.m_polygonB.vertices[n],this.m_v1,Ct.s_t0));r<e.separation&&(e.separation=r)}return e},n.ComputePolygonSeparation=function(t){var n=t;n.type=Gn.e_unknown,n.index=-1,n.separation=-i;for(var r=e.s_perp.Set(-this.m_normal.y,this.m_normal.x),a=0;a<this.m_polygonB.count;++a){var o=Ct.NegV(this.m_polygonB.normals[a],e.s_n),s=nt(Ct.DotVV(o,Ct.SubVV(this.m_polygonB.vertices[a],this.m_v1,Ct.s_t0)),Ct.DotVV(o,Ct.SubVV(this.m_polygonB.vertices[a],this.m_v2,Ct.s_t0)));if(s>this.m_radius)return n.type=Gn.e_edgeB,n.index=a,n.separation=s,n;if(Ct.DotVV(o,r)>=0){if(Ct.DotVV(Ct.SubVV(o,this.m_upperLimit,Ct.s_t0),this.m_normal)<-_)continue}else if(Ct.DotVV(Ct.SubVV(o,this.m_lowerLimit,Ct.s_t0),this.m_normal)<-_)continue;s>n.separation&&(n.type=Gn.e_edgeB,n.index=a,n.separation=s)}return n},e}();ni.s_edge1=new Ct,ni.s_edge0=new Ct,ni.s_edge2=new Ct,ni.s_ie=Ae.MakeArray(2),ni.s_rf=new ei,ni.s_clipPoints1=Ae.MakeArray(2),ni.s_clipPoints2=Ae.MakeArray(2),ni.s_edgeAxis=new $n,ni.s_polygonAxis=new $n,ni.s_n=new Ct,ni.s_perp=new Ct;var ii=new ni;function ri(t,e,n,i,r){ii.Collide(t,e,n,i,r)}var ai,oi=function(){this.mass=0,this.center=new Ct(0,0),this.I=0};(ai=t.b2ShapeType||(t.b2ShapeType={}))[ai.e_unknown=-1]="e_unknown",ai[ai.e_circleShape=0]="e_circleShape",ai[ai.e_edgeShape=1]="e_edgeShape",ai[ai.e_polygonShape=2]="e_polygonShape",ai[ai.e_chainShape=3]="e_chainShape",ai[ai.e_shapeTypeCount=4]="e_shapeTypeCount";var si=function(){function e(e,n){this.m_type=t.b2ShapeType.e_unknown,this.m_radius=0,this.m_type=e,this.m_radius=n}var n=e.prototype;return n.Copy=function(t){return this.m_radius=t.m_radius,this},n.GetType=function(){return this.m_type},e}(),ci=function(e){function n(n){var i;return void 0===n&&(n=0),(i=e.call(this,t.b2ShapeType.e_circleShape,n)||this).m_p=new Ct,i}$(n,e);var i=n.prototype;return i.Set=function(t,e){return void 0===e&&(e=this.m_radius),this.m_p.Copy(t),this.m_radius=e,this},i.Clone=function(){return(new n).Copy(this)},i.Copy=function(t){return e.prototype.Copy.call(this,t),this.m_p.Copy(t.m_p),this},i.GetChildCount=function(){return 1},i.TestPoint=function(t,e){var i=Dt.MulXV(t,this.m_p,n.TestPoint_s_center),r=Ct.SubVV(e,i,n.TestPoint_s_d);return Ct.DotVV(r,r)<=lt(this.m_radius)},i.ComputeDistance=function(t,e,i){var r=Dt.MulXV(t,this.m_p,n.ComputeDistance_s_center);return Ct.SubVV(e,r,i),i.Normalize()-this.m_radius},i.RayCast=function(t,e,i){var a=Dt.MulXV(i,this.m_p,n.RayCast_s_position),o=Ct.SubVV(e.p1,a,n.RayCast_s_s),s=Ct.DotVV(o,o)-lt(this.m_radius),c=Ct.SubVV(e.p2,e.p1,n.RayCast_s_r),l=Ct.DotVV(o,c),h=Ct.DotVV(c,c),u=l*l-h*s;if(u<0||h<r)return!1;var _=-(l+ut(u));return 0<=_&&_<=e.maxFraction*h&&(_/=h,t.fraction=_,Ct.AddVMulSV(o,_,c,t.normal).SelfNormalize(),!0)},i.ComputeAABB=function(t,e){var i=Dt.MulXV(e,this.m_p,n.ComputeAABB_s_p);t.lowerBound.Set(i.x-this.m_radius,i.y-this.m_radius),t.upperBound.Set(i.x+this.m_radius,i.y+this.m_radius)},i.ComputeMass=function(t,e){var n=lt(this.m_radius);t.mass=e*o*n,t.center.Copy(this.m_p),t.I=t.mass*(.5*n+Ct.DotVV(this.m_p,this.m_p))},i.SetupDistanceProxy=function(t){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_p),t.m_count=1,t.m_radius=this.m_radius},i.ComputeSubmergedArea=function(t,e,n,i){var a=Dt.MulXV(n,this.m_p,new Ct),s=-(Ct.DotVV(t,a)-e);if(s<-this.m_radius+r)return 0;if(s>this.m_radius)return i.Copy(a),o*this.m_radius*this.m_radius;var c=this.m_radius*this.m_radius,l=s*s,h=c*(gt(s/this.m_radius)+o/2)+s*ut(c-l),u=-2/3*_t(c-l,1.5)/h;return i.x=a.x+t.x*u,i.y=a.y+t.y*u,h},i.Dump=function(t){t("    const shape: b2CircleShape = new b2CircleShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_p.Set(%.15f, %.15f);\n",this.m_p.x,this.m_p.y)},n}(si);ci.TestPoint_s_center=new Ct,ci.TestPoint_s_d=new Ct,ci.ComputeDistance_s_center=new Ct,ci.RayCast_s_position=new Ct,ci.RayCast_s_s=new Ct,ci.RayCast_s_r=new Ct,ci.ComputeAABB_s_p=new Ct;var li=function(e){function n(){var n;return(n=e.call(this,t.b2ShapeType.e_polygonShape,f)||this).m_centroid=new Ct(0,0),n.m_vertices=[],n.m_normals=[],n.m_count=0,n}$(n,e);var a=n.prototype;return a.Clone=function(){return(new n).Copy(this)},a.Copy=function(t){e.prototype.Copy.call(this,t),this.m_centroid.Copy(t.m_centroid),this.m_count=t.m_count,this.m_vertices=Ct.MakeArray(this.m_count),this.m_normals=Ct.MakeArray(this.m_count);for(var n=0;n<this.m_count;++n)this.m_vertices[n].Copy(t.m_vertices[n]),this.m_normals[n].Copy(t.m_normals[n]);return this},a.GetChildCount=function(){return 1},a.Set=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if("number"==typeof e[0][0]){var i=e[0];if(i.length%2!=0)throw new Error;return this._Set((function(t){return{x:i[2*t],y:i[2*t+1]}}),i.length/2)}var r=e[0],a=e[1]||r.length;return this._Set((function(t){return r[t]}),a)},a._Set=function(t,e){if(e<3)return this.SetAsBox(1,1);for(var i=e,r=[],a=0;a<i;++a){for(var o=t(a),s=!0,c=0;c<r.length;++c)if(Ct.DistanceSquaredVV(o,r[c])<.25*u*u){s=!1;break}s&&r.push(o)}if((i=r.length)<3)return this.SetAsBox(1,1);for(var l=0,h=r[0].x,_=1;_<i;++_){var f=r[_].x;(f>h||f===h&&r[_].y<r[l].y)&&(l=_,h=f)}for(var d=[],p=0,m=l;;){d[p]=m;for(var v=0,g=1;g<i;++g)if(v!==m){var y=Ct.SubVV(r[v],r[d[p]],n.Set_s_r),x=Ct.SubVV(r[g],r[d[p]],n.Set_s_v),S=Ct.CrossVV(y,x);S<0&&(v=g),0===S&&x.LengthSquared()>y.LengthSquared()&&(v=g)}else v=g;if(++p,m=v,v===l)break}this.m_count=p,this.m_vertices=Ct.MakeArray(this.m_count),this.m_normals=Ct.MakeArray(this.m_count);for(var A=0;A<p;++A)this.m_vertices[A].Copy(r[d[A]]);for(var b=0;b<p;++b){var C=this.m_vertices[b],T=this.m_vertices[(b+1)%p],E=Ct.SubVV(T,C,Ct.s_t0);Ct.CrossVOne(E,this.m_normals[b]).SelfNormalize()}return n.ComputeCentroid(this.m_vertices,p,this.m_centroid),this},a.SetAsBox=function(t,e,n,i){if(void 0===i&&(i=0),this.m_count=4,this.m_vertices=Ct.MakeArray(this.m_count),this.m_normals=Ct.MakeArray(this.m_count),this.m_vertices[0].Set(-t,-e),this.m_vertices[1].Set(t,-e),this.m_vertices[2].Set(t,e),this.m_vertices[3].Set(-t,e),this.m_normals[0].Set(0,-1),this.m_normals[1].Set(1,0),this.m_normals[2].Set(0,1),this.m_normals[3].Set(-1,0),this.m_centroid.SetZero(),n){this.m_centroid.Copy(n);var r=new Dt;r.SetPosition(n),r.SetRotationAngle(i);for(var a=0;a<this.m_count;++a)Dt.MulXV(r,this.m_vertices[a],this.m_vertices[a]),Pt.MulRV(r.q,this.m_normals[a],this.m_normals[a])}return this},a.TestPoint=function(t,e){for(var i=Dt.MulTXV(t,e,n.TestPoint_s_pLocal),r=0;r<this.m_count;++r)if(Ct.DotVV(this.m_normals[r],Ct.SubVV(i,this.m_vertices[r],Ct.s_t0))>0)return!1;return!0},a.ComputeDistance=function(t,e,r){for(var a=Dt.MulTXV(t,e,n.ComputeDistance_s_pLocal),o=-i,s=n.ComputeDistance_s_normalForMaxDistance.Copy(a),c=0;c<this.m_count;++c){var l=Ct.DotVV(this.m_normals[c],Ct.SubVV(a,this.m_vertices[c],Ct.s_t0));l>o&&(o=l,s.Copy(this.m_normals[c]))}if(o>0){for(var h=n.ComputeDistance_s_minDistance.Copy(s),u=o*o,_=0;_<this.m_count;++_){var f=Ct.SubVV(a,this.m_vertices[_],n.ComputeDistance_s_distance),d=f.LengthSquared();u>d&&(h.Copy(f),u=d)}return Pt.MulRV(t.q,h,r),r.Normalize(),Math.sqrt(u)}return Pt.MulRV(t.q,s,r),o},a.RayCast=function(t,e,i){for(var r=Dt.MulTXV(i,e.p1,n.RayCast_s_p1),a=Dt.MulTXV(i,e.p2,n.RayCast_s_p2),o=Ct.SubVV(a,r,n.RayCast_s_d),s=0,c=e.maxFraction,l=-1,h=0;h<this.m_count;++h){var u=Ct.DotVV(this.m_normals[h],Ct.SubVV(this.m_vertices[h],r,Ct.s_t0)),_=Ct.DotVV(this.m_normals[h],o);if(0===_){if(u<0)return!1}else _<0&&u<s*_?(s=u/_,l=h):_>0&&u<c*_&&(c=u/_);if(c<s)return!1}return l>=0&&(t.fraction=s,Pt.MulRV(i.q,this.m_normals[l],t.normal),!0)},a.ComputeAABB=function(t,e){for(var i=Dt.MulXV(e,this.m_vertices[0],t.lowerBound),r=t.upperBound.Copy(i),a=0;a<this.m_count;++a){var o=Dt.MulXV(e,this.m_vertices[a],n.ComputeAABB_s_v);Ct.MinV(o,i,i),Ct.MaxV(o,r,r)}var s=this.m_radius;i.SelfSubXY(s,s),r.SelfAddXY(s,s)},a.ComputeMass=function(t,e){for(var i=n.ComputeMass_s_center.SetZero(),r=0,a=0,o=n.ComputeMass_s_s.SetZero(),s=0;s<this.m_count;++s)o.SelfAdd(this.m_vertices[s]);o.SelfMul(1/this.m_count);for(var c=1/3,l=0;l<this.m_count;++l){var h=Ct.SubVV(this.m_vertices[l],o,n.ComputeMass_s_e1),u=Ct.SubVV(this.m_vertices[(l+1)%this.m_count],o,n.ComputeMass_s_e2),_=Ct.CrossVV(h,u),f=.5*_;r+=f,i.SelfAdd(Ct.MulSV(f*c,Ct.AddVV(h,u,Ct.s_t0),Ct.s_t1));var d=h.x,p=h.y,m=u.x,v=u.y;a+=.25*c*_*(d*d+m*d+m*m+p*p+v*p+v*v)}t.mass=e*r,i.SelfMul(1/r),Ct.AddVV(i,o,t.center),t.I=e*a,t.I+=t.mass*(Ct.DotVV(t.center,t.center)-Ct.DotVV(i,i))},a.Validate=function(){for(var t=0;t<this.m_count;++t)for(var e=t,i=(t+1)%this.m_count,r=this.m_vertices[e],a=Ct.SubVV(this.m_vertices[i],r,n.Validate_s_e),o=0;o<this.m_count;++o)if(o!==e&&o!==i){var s=Ct.SubVV(this.m_vertices[o],r,n.Validate_s_v);if(Ct.CrossVV(a,s)<0)return!1}return!0},a.SetupDistanceProxy=function(t){t.m_vertices=this.m_vertices,t.m_count=this.m_count,t.m_radius=this.m_radius},a.ComputeSubmergedArea=function(t,e,i,a){for(var o=Pt.MulTRV(i.q,t,n.ComputeSubmergedArea_s_normalL),s=e-Ct.DotVV(t,i.p),c=[],l=0,h=-1,u=-1,_=!1,f=0;f<this.m_count;++f){c[f]=Ct.DotVV(o,this.m_vertices[f])-s;var d=c[f]<-r;f>0&&(d?_||(h=f-1,l++):_&&(u=f-1,l++)),_=d}switch(l){case 0:if(_){var p=n.ComputeSubmergedArea_s_md;return this.ComputeMass(p,1),Dt.MulXV(i,p.center,a),p.mass}return 0;case 1:-1===h?h=this.m_count-1:u=this.m_count-1}for(var m,v=(h+1)%this.m_count,g=(u+1)%this.m_count,y=(0-c[h])/(c[v]-c[h]),x=(0-c[u])/(c[g]-c[u]),S=n.ComputeSubmergedArea_s_intoVec.Set(this.m_vertices[h].x*(1-y)+this.m_vertices[v].x*y,this.m_vertices[h].y*(1-y)+this.m_vertices[v].y*y),A=n.ComputeSubmergedArea_s_outoVec.Set(this.m_vertices[u].x*(1-x)+this.m_vertices[g].x*x,this.m_vertices[u].y*(1-x)+this.m_vertices[g].y*x),b=0,C=n.ComputeSubmergedArea_s_center.SetZero(),T=this.m_vertices[v],E=v;E!==g;){m=(E=(E+1)%this.m_count)===g?A:this.m_vertices[E];var w=.5*((T.x-S.x)*(m.y-S.y)-(T.y-S.y)*(m.x-S.x));b+=w,C.x+=w*(S.x+T.x+m.x)/3,C.y+=w*(S.y+T.y+m.y)/3,T=m}return C.SelfMul(1/b),Dt.MulXV(i,C,a),b},a.Dump=function(t){t("    const shape: b2PolygonShape = new b2PolygonShape();\n"),t("    const vs: b2Vec2[] = [];\n");for(var e=0;e<this.m_count;++e)t("    vs[%d] = new b2Vec2(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.Set(vs, %d);\n",this.m_count)},n.ComputeCentroid=function(t,e,i){var r=i;r.SetZero();for(var a=0,o=n.ComputeCentroid_s_pRef.SetZero(),s=1/3,c=0;c<e;++c){var l=o,h=t[c],u=t[(c+1)%e],_=Ct.SubVV(h,l,n.ComputeCentroid_s_e1),f=Ct.SubVV(u,l,n.ComputeCentroid_s_e2),d=.5*Ct.CrossVV(_,f);a+=d,r.x+=d*s*(l.x+h.x+u.x),r.y+=d*s*(l.y+h.y+u.y)}return r.SelfMul(1/a),r},n}(si);li.Set_s_r=new Ct,li.Set_s_v=new Ct,li.TestPoint_s_pLocal=new Ct,li.ComputeDistance_s_pLocal=new Ct,li.ComputeDistance_s_normalForMaxDistance=new Ct,li.ComputeDistance_s_minDistance=new Ct,li.ComputeDistance_s_distance=new Ct,li.RayCast_s_p1=new Ct,li.RayCast_s_p2=new Ct,li.RayCast_s_d=new Ct,li.ComputeAABB_s_v=new Ct,li.ComputeMass_s_center=new Ct,li.ComputeMass_s_s=new Ct,li.ComputeMass_s_e1=new Ct,li.ComputeMass_s_e2=new Ct,li.Validate_s_e=new Ct,li.Validate_s_v=new Ct,li.ComputeSubmergedArea_s_normalL=new Ct,li.ComputeSubmergedArea_s_md=new oi,li.ComputeSubmergedArea_s_intoVec=new Ct,li.ComputeSubmergedArea_s_outoVec=new Ct,li.ComputeSubmergedArea_s_center=new Ct,li.ComputeCentroid_s_pRef=new Ct,li.ComputeCentroid_s_e1=new Ct,li.ComputeCentroid_s_e2=new Ct;var hi=function(e){function n(){var n;return(n=e.call(this,t.b2ShapeType.e_edgeShape,f)||this).m_vertex1=new Ct,n.m_vertex2=new Ct,n.m_vertex0=new Ct,n.m_vertex3=new Ct,n.m_hasVertex0=!1,n.m_hasVertex3=!1,n}$(n,e);var i=n.prototype;return i.Set=function(t,e){return this.m_vertex1.Copy(t),this.m_vertex2.Copy(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this},i.Clone=function(){return(new n).Copy(this)},i.Copy=function(t){return e.prototype.Copy.call(this,t),this.m_vertex1.Copy(t.m_vertex1),this.m_vertex2.Copy(t.m_vertex2),this.m_vertex0.Copy(t.m_vertex0),this.m_vertex3.Copy(t.m_vertex3),this.m_hasVertex0=t.m_hasVertex0,this.m_hasVertex3=t.m_hasVertex3,this},i.GetChildCount=function(){return 1},i.TestPoint=function(){return!1},i.ComputeDistance=function(t,e,i){var r=Dt.MulXV(t,this.m_vertex1,n.ComputeDistance_s_v1),a=Dt.MulXV(t,this.m_vertex2,n.ComputeDistance_s_v2),o=Ct.SubVV(e,r,n.ComputeDistance_s_d),s=Ct.SubVV(a,r,n.ComputeDistance_s_s),c=Ct.DotVV(o,s);if(c>0){var l=Ct.DotVV(s,s);c>l?Ct.SubVV(e,a,o):o.SelfMulSub(c/l,s)}return i.Copy(o),i.Normalize()},i.RayCast=function(t,e,i){var r=Dt.MulTXV(i,e.p1,n.RayCast_s_p1),a=Dt.MulTXV(i,e.p2,n.RayCast_s_p2),o=Ct.SubVV(a,r,n.RayCast_s_d),s=this.m_vertex1,c=this.m_vertex2,l=Ct.SubVV(c,s,n.RayCast_s_e),h=t.normal.Set(l.y,-l.x).SelfNormalize(),u=Ct.DotVV(h,Ct.SubVV(s,r,Ct.s_t0)),_=Ct.DotVV(h,o);if(0===_)return!1;var f=u/_;if(f<0||e.maxFraction<f)return!1;var d=Ct.AddVMulSV(r,f,o,n.RayCast_s_q),p=Ct.SubVV(c,s,n.RayCast_s_r),m=Ct.DotVV(p,p);if(0===m)return!1;var v=Ct.DotVV(Ct.SubVV(d,s,Ct.s_t0),p)/m;return!(v<0||1<v||(t.fraction=f,Pt.MulRV(i.q,t.normal,t.normal),u>0&&t.normal.SelfNeg(),0))},i.ComputeAABB=function(t,e){var i=Dt.MulXV(e,this.m_vertex1,n.ComputeAABB_s_v1),r=Dt.MulXV(e,this.m_vertex2,n.ComputeAABB_s_v2);Ct.MinV(i,r,t.lowerBound),Ct.MaxV(i,r,t.upperBound);var a=this.m_radius;t.lowerBound.SelfSubXY(a,a),t.upperBound.SelfAddXY(a,a)},i.ComputeMass=function(t){t.mass=0,Ct.MidVV(this.m_vertex1,this.m_vertex2,t.center),t.I=0},i.SetupDistanceProxy=function(t){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertex1),t.m_vertices[1].Copy(this.m_vertex2),t.m_count=2,t.m_radius=this.m_radius},i.ComputeSubmergedArea=function(t,e,n,i){return i.SetZero(),0},i.Dump=function(t){t("    const shape: b2EdgeShape = new b2EdgeShape();\n"),t("    shape.m_radius = %.15f;\n",this.m_radius),t("    shape.m_vertex0.Set(%.15f, %.15f);\n",this.m_vertex0.x,this.m_vertex0.y),t("    shape.m_vertex1.Set(%.15f, %.15f);\n",this.m_vertex1.x,this.m_vertex1.y),t("    shape.m_vertex2.Set(%.15f, %.15f);\n",this.m_vertex2.x,this.m_vertex2.y),t("    shape.m_vertex3.Set(%.15f, %.15f);\n",this.m_vertex3.x,this.m_vertex3.y),t("    shape.m_hasVertex0 = %s;\n",this.m_hasVertex0),t("    shape.m_hasVertex3 = %s;\n",this.m_hasVertex3)},n}(si);hi.ComputeDistance_s_v1=new Ct,hi.ComputeDistance_s_v2=new Ct,hi.ComputeDistance_s_d=new Ct,hi.ComputeDistance_s_s=new Ct,hi.RayCast_s_p1=new Ct,hi.RayCast_s_p2=new Ct,hi.RayCast_s_d=new Ct,hi.RayCast_s_e=new Ct,hi.RayCast_s_q=new Ct,hi.RayCast_s_r=new Ct,hi.ComputeAABB_s_v1=new Ct,hi.ComputeAABB_s_v2=new Ct;var ui=function(e){function n(){var n;return(n=e.call(this,t.b2ShapeType.e_chainShape,f)||this).m_vertices=[],n.m_count=0,n.m_prevVertex=new Ct,n.m_nextVertex=new Ct,n.m_hasPrevVertex=!1,n.m_hasNextVertex=!1,n}$(n,e);var i=n.prototype;return i.CreateLoop=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if("number"==typeof e[0][0]){var i=e[0];if(i.length%2!=0)throw new Error;return this._CreateLoop((function(t){return{x:i[2*t],y:i[2*t+1]}}),i.length/2)}var r=e[0],a=e[1]||r.length;return this._CreateLoop((function(t){return r[t]}),a)},i._CreateLoop=function(t,e){if(e<3)return this;this.m_count=e+1,this.m_vertices=Ct.MakeArray(this.m_count);for(var n=0;n<e;++n)this.m_vertices[n].Copy(t(n));return this.m_vertices[e].Copy(this.m_vertices[0]),this.m_prevVertex.Copy(this.m_vertices[this.m_count-2]),this.m_nextVertex.Copy(this.m_vertices[1]),this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this},i.CreateChain=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];if("number"==typeof e[0][0]){var i=e[0];if(i.length%2!=0)throw new Error;return this._CreateChain((function(t){return{x:i[2*t],y:i[2*t+1]}}),i.length/2)}var r=e[0],a=e[1]||r.length;return this._CreateChain((function(t){return r[t]}),a)},i._CreateChain=function(t,e){this.m_count=e,this.m_vertices=Ct.MakeArray(e);for(var n=0;n<e;++n)this.m_vertices[n].Copy(t(n));return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex.SetZero(),this.m_nextVertex.SetZero(),this},i.SetPrevVertex=function(t){return this.m_prevVertex.Copy(t),this.m_hasPrevVertex=!0,this},i.SetNextVertex=function(t){return this.m_nextVertex.Copy(t),this.m_hasNextVertex=!0,this},i.Clone=function(){return(new n).Copy(this)},i.Copy=function(t){return e.prototype.Copy.call(this,t),this._CreateChain((function(e){return t.m_vertices[e]}),t.m_count),this.m_prevVertex.Copy(t.m_prevVertex),this.m_nextVertex.Copy(t.m_nextVertex),this.m_hasPrevVertex=t.m_hasPrevVertex,this.m_hasNextVertex=t.m_hasNextVertex,this},i.GetChildCount=function(){return this.m_count-1},i.GetChildEdge=function(t,e){t.m_radius=this.m_radius,t.m_vertex1.Copy(this.m_vertices[e]),t.m_vertex2.Copy(this.m_vertices[e+1]),e>0?(t.m_vertex0.Copy(this.m_vertices[e-1]),t.m_hasVertex0=!0):(t.m_vertex0.Copy(this.m_prevVertex),t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3.Copy(this.m_vertices[e+2]),t.m_hasVertex3=!0):(t.m_vertex3.Copy(this.m_nextVertex),t.m_hasVertex3=this.m_hasNextVertex)},i.TestPoint=function(){return!1},i.ComputeDistance=function(t,e,i,r){var a=n.ComputeDistance_s_edgeShape;return this.GetChildEdge(a,r),a.ComputeDistance(t,e,i,0)},i.RayCast=function(t,e,i,r){var a=n.RayCast_s_edgeShape;return a.m_vertex1.Copy(this.m_vertices[r]),a.m_vertex2.Copy(this.m_vertices[(r+1)%this.m_count]),a.RayCast(t,e,i,0)},i.ComputeAABB=function(t,e,i){var r=this.m_vertices[i],a=this.m_vertices[(i+1)%this.m_count],o=Dt.MulXV(e,r,n.ComputeAABB_s_v1),s=Dt.MulXV(e,a,n.ComputeAABB_s_v2);Ct.MinV(o,s,t.lowerBound),Ct.MaxV(o,s,t.upperBound)},i.ComputeMass=function(t){t.mass=0,t.center.SetZero(),t.I=0},i.SetupDistanceProxy=function(t,e){t.m_vertices=t.m_buffer,t.m_vertices[0].Copy(this.m_vertices[e]),e+1<this.m_count?t.m_vertices[1].Copy(this.m_vertices[e+1]):t.m_vertices[1].Copy(this.m_vertices[0]),t.m_count=2,t.m_radius=this.m_radius},i.ComputeSubmergedArea=function(t,e,n,i){return i.SetZero(),0},i.Dump=function(t){t("    const shape: b2ChainShape = new b2ChainShape();\n"),t("    const vs: b2Vec2[] = [];\n");for(var e=0;e<this.m_count;++e)t("    vs[%d] = new bVec2(%.15f, %.15f);\n",e,this.m_vertices[e].x,this.m_vertices[e].y);t("    shape.CreateChain(vs, %d);\n",this.m_count),t("    shape.m_prevVertex.Set(%.15f, %.15f);\n",this.m_prevVertex.x,this.m_prevVertex.y),t("    shape.m_nextVertex.Set(%.15f, %.15f);\n",this.m_nextVertex.x,this.m_nextVertex.y),t("    shape.m_hasPrevVertex = %s;\n",this.m_hasPrevVertex?"true":"false"),t("    shape.m_hasNextVertex = %s;\n",this.m_hasNextVertex?"true":"false")},n}(si);ui.ComputeDistance_s_edgeShape=new hi,ui.RayCast_s_edgeShape=new hi,ui.ComputeAABB_s_v1=new Ct,ui.ComputeAABB_s_v2=new Ct;var _i=function(){function t(){this.categoryBits=1,this.maskBits=65535,this.groupIndex=0}var e=t.prototype;return e.Clone=function(){return(new t).Copy(this)},e.Copy=function(t){return this.categoryBits=t.categoryBits,this.maskBits=t.maskBits,this.groupIndex=t.groupIndex||0,this},t}();_i.DEFAULT=new _i;var fi=function(){this.userData=null,this.friction=.2,this.restitution=0,this.density=0,this.isSensor=!1,this.filter=new _i},di=function(){function t(t,e){this.aabb=new Te,this.childIndex=0,this.fixture=t,this.childIndex=e,this.fixture.m_shape.ComputeAABB(this.aabb,this.fixture.m_body.GetTransform(),e),this.treeNode=this.fixture.m_body.m_world.m_contactManager.m_broadPhase.CreateProxy(this.aabb,this)}var e=t.prototype;return e.Reset=function(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.DestroyProxy(this.treeNode)},e.Touch=function(){this.fixture.m_body.m_world.m_contactManager.m_broadPhase.TouchProxy(this.treeNode)},e.Synchronize=function(e,n,i){if(e===n)this.fixture.m_shape.ComputeAABB(this.aabb,e,this.childIndex),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,i);else{var r=t.Synchronize_s_aabb1,a=t.Synchronize_s_aabb2;this.fixture.m_shape.ComputeAABB(r,e,this.childIndex),this.fixture.m_shape.ComputeAABB(a,n,this.childIndex),this.aabb.Combine2(r,a),this.fixture.m_body.m_world.m_contactManager.m_broadPhase.MoveProxy(this.treeNode,this.aabb,i)}},t}();di.Synchronize_s_aabb1=new Te,di.Synchronize_s_aabb2=new Te;var pi,mi=function(){function t(t,e){this.m_density=0,this.m_next=null,this.m_friction=0,this.m_restitution=0,this.m_proxies=[],this.m_filter=new _i,this.m_isSensor=!1,this.m_userData=null,this.m_body=t,this.m_shape=e.shape.Clone(),this.m_userData=n(e.userData,null),this.m_friction=n(e.friction,.2),this.m_restitution=n(e.restitution,0),this.m_filter.Copy(n(e.filter,_i.DEFAULT)),this.m_isSensor=n(e.isSensor,!1),this.m_density=n(e.density,0)}var e=t.prototype;return e.Reset=function(){},e.GetType=function(){return this.m_shape.GetType()},e.GetShape=function(){return this.m_shape},e.SetSensor=function(t){t!==this.m_isSensor&&(this.m_body.SetAwake(!0),this.m_isSensor=t)},e.IsSensor=function(){return this.m_isSensor},e.SetFilterData=function(t){this.m_filter.Copy(t),this.Refilter()},e.GetFilterData=function(){return this.m_filter},e.Refilter=function(){for(var t=this.m_body.GetContactList();t;){var e=t.contact,n=e.GetFixtureA(),i=e.GetFixtureB();n!==this&&i!==this||e.FlagForFiltering(),t=t.next}this.TouchProxies()},e.GetBody=function(){return this.m_body},e.GetNext=function(){return this.m_next},e.GetUserData=function(){return this.m_userData},e.SetUserData=function(t){this.m_userData=t},e.TestPoint=function(t){return this.m_shape.TestPoint(this.m_body.GetTransform(),t)},e.ComputeDistance=function(t,e,n){return this.m_shape.ComputeDistance(this.m_body.GetTransform(),t,e,n)},e.RayCast=function(t,e,n){return this.m_shape.RayCast(t,e,this.m_body.GetTransform(),n)},e.GetMassData=function(t){return void 0===t&&(t=new oi),this.m_shape.ComputeMass(t,this.m_density),t},e.SetDensity=function(t){this.m_density=t},e.GetDensity=function(){return this.m_density},e.GetFriction=function(){return this.m_friction},e.SetFriction=function(t){this.m_friction=t},e.GetRestitution=function(){return this.m_restitution},e.SetRestitution=function(t){this.m_restitution=t},e.GetAABB=function(t){return this.m_proxies[t].aabb},e.Dump=function(t,e){t("    const fd: b2FixtureDef = new b2FixtureDef();\n"),t("    fd.friction = %.15f;\n",this.m_friction),t("    fd.restitution = %.15f;\n",this.m_restitution),t("    fd.density = %.15f;\n",this.m_density),t("    fd.isSensor = %s;\n",this.m_isSensor?"true":"false"),t("    fd.filter.categoryBits = %d;\n",this.m_filter.categoryBits),t("    fd.filter.maskBits = %d;\n",this.m_filter.maskBits),t("    fd.filter.groupIndex = %d;\n",this.m_filter.groupIndex),this.m_shape.Dump(t),t("\n"),t("    fd.shape = shape;\n"),t("\n"),t("    bodies[%d].CreateFixture(fd);\n",e)},e.CreateProxies=function(){if(0!==this.m_proxies.length)throw new Error;for(var t=0;t<this.m_shape.GetChildCount();++t)this.m_proxies[t]=new di(this,t)},e.DestroyProxies=function(){for(var t,e=st(this.m_proxies);!(t=e()).done;)t.value.Reset();this.m_proxies.length=0},e.TouchProxies=function(){for(var t,e=st(this.m_proxies);!(t=e()).done;)t.value.Touch()},e.SynchronizeProxies=function(t,e,n){for(var i,r=st(this.m_proxies);!(i=r()).done;)i.value.Synchronize(t,e,n)},Q(t,[{key:"m_proxyCount",get:function(){return this.m_proxies.length}}]),t}();(pi=t.b2BodyType||(t.b2BodyType={}))[pi.b2_unknown=-1]="b2_unknown",pi[pi.b2_staticBody=0]="b2_staticBody",pi[pi.b2_kinematicBody=1]="b2_kinematicBody",pi[pi.b2_dynamicBody=2]="b2_dynamicBody";var vi,gi,yi=function(){this.type=t.b2BodyType.b2_staticBody,this.position=new Ct(0,0),this.angle=0,this.linearVelocity=new Ct(0,0),this.angularVelocity=0,this.linearDamping=0,this.angularDamping=0,this.allowSleep=!0,this.awake=!0,this.fixedRotation=!1,this.bullet=!1,this.active=!0,this.userData=null,this.gravityScale=1},xi=function(){function e(e,i){this.m_type=t.b2BodyType.b2_staticBody,this.m_islandFlag=!1,this.m_awakeFlag=!1,this.m_autoSleepFlag=!1,this.m_bulletFlag=!1,this.m_fixedRotationFlag=!1,this.m_activeFlag=!1,this.m_toiFlag=!1,this.m_islandIndex=0,this.m_xf=new Dt,this.m_xf0=new Dt,this.m_sweep=new Mt,this.m_linearVelocity=new Ct,this.m_angularVelocity=0,this.m_force=new Ct,this.m_torque=0,this.m_prev=null,this.m_next=null,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_jointList=null,this.m_contactList=null,this.m_mass=1,this.m_invMass=1,this.m_I=0,this.m_invI=0,this.m_linearDamping=0,this.m_angularDamping=0,this.m_gravityScale=1,this.m_sleepTime=0,this.m_userData=null,this.m_controllerList=null,this.m_controllerCount=0,this.m_bulletFlag=n(e.bullet,!1),this.m_fixedRotationFlag=n(e.fixedRotation,!1),this.m_autoSleepFlag=n(e.allowSleep,!0),this.m_awakeFlag=n(e.awake,!0),this.m_activeFlag=n(e.active,!0),this.m_world=i,this.m_xf.p.Copy(n(e.position,Ct.ZERO)),this.m_xf.q.SetAngle(n(e.angle,0)),this.m_xf0.Copy(this.m_xf),this.m_sweep.localCenter.SetZero(),this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),this.m_sweep.a0=this.m_sweep.a=this.m_xf.q.GetAngle(),this.m_sweep.alpha0=0,this.m_linearVelocity.Copy(n(e.linearVelocity,Ct.ZERO)),this.m_angularVelocity=n(e.angularVelocity,0),this.m_linearDamping=n(e.linearDamping,0),this.m_angularDamping=n(e.angularDamping,0),this.m_gravityScale=n(e.gravityScale,1),this.m_force.SetZero(),this.m_torque=0,this.m_sleepTime=0,this.m_type=n(e.type,t.b2BodyType.b2_staticBody),e.type===t.b2BodyType.b2_dynamicBody?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_userData=e.userData,this.m_fixtureList=null,this.m_fixtureCount=0,this.m_controllerList=null,this.m_controllerCount=0}var i=e.prototype;return i.CreateFixture=function(t,e){return void 0===e&&(e=0),t instanceof si?this.CreateFixtureShapeDensity(t,e):this.CreateFixtureDef(t)},i.CreateFixtureDef=function(t){if(this.m_world.IsLocked())throw new Error;var e=new mi(this,t);return this.m_activeFlag&&e.CreateProxies(),e.m_next=this.m_fixtureList,this.m_fixtureList=e,++this.m_fixtureCount,e.m_density>0&&this.ResetMassData(),this.m_world.m_newFixture=!0,e},i.CreateFixtureShapeDensity=function(t,n){void 0===n&&(n=0);var i=e.CreateFixtureShapeDensity_s_def;return i.shape=t,i.density=n,this.CreateFixtureDef(i)},i.DestroyFixture=function(t){if(this.m_world.IsLocked())throw new Error;for(var e=this.m_fixtureList,n=null;null!==e;){if(e===t){n?n.m_next=t.m_next:this.m_fixtureList=t.m_next;break}n=e,e=e.m_next}for(var i=this.m_contactList;i;){var r=i.contact;i=i.next;var a=r.GetFixtureA(),o=r.GetFixtureB();t!==a&&t!==o||this.m_world.m_contactManager.Destroy(r)}this.m_activeFlag&&t.DestroyProxies(),t.m_next=null,t.Reset(),--this.m_fixtureCount,this.ResetMassData()},i.SetTransformVec=function(t,e){this.SetTransformXY(t.x,t.y,e)},i.SetTransformXY=function(t,e,n){if(this.m_world.IsLocked())throw new Error;this.m_xf.q.SetAngle(n),this.m_xf.p.Set(t,e),this.m_xf0.Copy(this.m_xf),Dt.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.a=n,this.m_sweep.c0.Copy(this.m_sweep.c),this.m_sweep.a0=n;for(var i=this.m_fixtureList;i;i=i.m_next)i.SynchronizeProxies(this.m_xf,this.m_xf,Ct.ZERO);this.m_world.m_contactManager.FindNewContacts()},i.SetTransform=function(t){this.SetTransformVec(t.p,t.GetAngle())},i.GetTransform=function(){return this.m_xf},i.GetPosition=function(){return this.m_xf.p},i.SetPosition=function(t){this.SetTransformVec(t,this.GetAngle())},i.SetPositionXY=function(t,e){this.SetTransformXY(t,e,this.GetAngle())},i.GetAngle=function(){return this.m_sweep.a},i.SetAngle=function(t){this.SetTransformVec(this.GetPosition(),t)},i.GetWorldCenter=function(){return this.m_sweep.c},i.GetLocalCenter=function(){return this.m_sweep.localCenter},i.SetLinearVelocity=function(e){this.m_type!==t.b2BodyType.b2_staticBody&&(Ct.DotVV(e,e)>0&&this.SetAwake(!0),this.m_linearVelocity.Copy(e))},i.GetLinearVelocity=function(){return this.m_linearVelocity},i.SetAngularVelocity=function(e){this.m_type!==t.b2BodyType.b2_staticBody&&(e*e>0&&this.SetAwake(!0),this.m_angularVelocity=e)},i.GetAngularVelocity=function(){return this.m_angularVelocity},i.GetDefinition=function(t){return t.type=this.GetType(),t.allowSleep=this.m_autoSleepFlag,t.angle=this.GetAngle(),t.angularDamping=this.m_angularDamping,t.gravityScale=this.m_gravityScale,t.angularVelocity=this.m_angularVelocity,t.fixedRotation=this.m_fixedRotationFlag,t.bullet=this.m_bulletFlag,t.awake=this.m_awakeFlag,t.linearDamping=this.m_linearDamping,t.linearVelocity.Copy(this.GetLinearVelocity()),t.position.Copy(this.GetPosition()),t.userData=this.GetUserData(),t},i.ApplyForce=function(e,n,i){void 0===i&&(i=!0),this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=e.x,this.m_force.y+=e.y,this.m_torque+=(n.x-this.m_sweep.c.x)*e.y-(n.y-this.m_sweep.c.y)*e.x))},i.ApplyForceToCenter=function(e,n){void 0===n&&(n=!0),this.m_type===t.b2BodyType.b2_dynamicBody&&(n&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_force.x+=e.x,this.m_force.y+=e.y))},i.ApplyTorque=function(e,n){void 0===n&&(n=!0),this.m_type===t.b2BodyType.b2_dynamicBody&&(n&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_torque+=e))},i.ApplyLinearImpulse=function(e,n,i){void 0===i&&(i=!0),this.m_type===t.b2BodyType.b2_dynamicBody&&(i&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y,this.m_angularVelocity+=this.m_invI*((n.x-this.m_sweep.c.x)*e.y-(n.y-this.m_sweep.c.y)*e.x)))},i.ApplyLinearImpulseToCenter=function(e,n){void 0===n&&(n=!0),this.m_type===t.b2BodyType.b2_dynamicBody&&(n&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.x+=this.m_invMass*e.x,this.m_linearVelocity.y+=this.m_invMass*e.y))},i.ApplyAngularImpulse=function(e,n){void 0===n&&(n=!0),this.m_type===t.b2BodyType.b2_dynamicBody&&(n&&!this.m_awakeFlag&&this.SetAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*e))},i.GetMass=function(){return this.m_mass},i.GetInertia=function(){return this.m_I+this.m_mass*Ct.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter)},i.GetMassData=function(t){return t.mass=this.m_mass,t.I=this.m_I+this.m_mass*Ct.DotVV(this.m_sweep.localCenter,this.m_sweep.localCenter),t.center.Copy(this.m_sweep.localCenter),t},i.SetMassData=function(n){if(this.m_world.IsLocked())throw new Error;if(this.m_type===t.b2BodyType.b2_dynamicBody){this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=n.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,n.I>0&&!this.m_fixedRotationFlag&&(this.m_I=n.I-this.m_mass*Ct.DotVV(n.center,n.center),this.m_invI=1/this.m_I);var i=e.SetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(n.center),Dt.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),Ct.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,Ct.SubVV(this.m_sweep.c,i,Ct.s_t0),this.m_linearVelocity)}},i.ResetMassData=function(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_sweep.localCenter.SetZero(),this.m_type===t.b2BodyType.b2_staticBody||this.m_type===t.b2BodyType.b2_kinematicBody)return this.m_sweep.c0.Copy(this.m_xf.p),this.m_sweep.c.Copy(this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);for(var n=e.ResetMassData_s_localCenter.SetZero(),i=this.m_fixtureList;i;i=i.m_next)if(0!==i.m_density){var r=i.GetMassData(e.ResetMassData_s_massData);this.m_mass+=r.mass,n.x+=r.center.x*r.mass,n.y+=r.center.y*r.mass,this.m_I+=r.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,n.x*=this.m_invMass,n.y*=this.m_invMass):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&!this.m_fixedRotationFlag?(this.m_I-=this.m_mass*Ct.DotVV(n,n),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0);var a=e.ResetMassData_s_oldCenter.Copy(this.m_sweep.c);this.m_sweep.localCenter.Copy(n),Dt.MulXV(this.m_xf,this.m_sweep.localCenter,this.m_sweep.c),this.m_sweep.c0.Copy(this.m_sweep.c),Ct.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,Ct.SubVV(this.m_sweep.c,a,Ct.s_t0),this.m_linearVelocity)},i.GetWorldPoint=function(t,e){return Dt.MulXV(this.m_xf,t,e)},i.GetWorldVector=function(t,e){return Pt.MulRV(this.m_xf.q,t,e)},i.GetLocalPoint=function(t,e){return Dt.MulTXV(this.m_xf,t,e)},i.GetLocalVector=function(t,e){return Pt.MulTRV(this.m_xf.q,t,e)},i.GetLinearVelocityFromWorldPoint=function(t,e){return Ct.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,Ct.SubVV(t,this.m_sweep.c,Ct.s_t0),e)},i.GetLinearVelocityFromLocalPoint=function(t,e){return this.GetLinearVelocityFromWorldPoint(this.GetWorldPoint(t,e),e)},i.GetLinearDamping=function(){return this.m_linearDamping},i.SetLinearDamping=function(t){this.m_linearDamping=t},i.GetAngularDamping=function(){return this.m_angularDamping},i.SetAngularDamping=function(t){this.m_angularDamping=t},i.GetGravityScale=function(){return this.m_gravityScale},i.SetGravityScale=function(t){this.m_gravityScale=t},i.SetType=function(e){if(this.m_world.IsLocked())throw new Error;if(this.m_type!==e){this.m_type=e,this.ResetMassData(),this.m_type===t.b2BodyType.b2_staticBody&&(this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_sweep.a0=this.m_sweep.a,this.m_sweep.c0.Copy(this.m_sweep.c),this.SynchronizeFixtures()),this.SetAwake(!0),this.m_force.SetZero(),this.m_torque=0;for(var n=this.m_contactList;n;){var i=n;n=n.next,this.m_world.m_contactManager.Destroy(i.contact)}this.m_contactList=null;for(var r=this.m_fixtureList;r;r=r.m_next)r.TouchProxies()}},i.GetType=function(){return this.m_type},i.SetBullet=function(t){this.m_bulletFlag=t},i.IsBullet=function(){return this.m_bulletFlag},i.SetSleepingAllowed=function(t){this.m_autoSleepFlag=t,t||this.SetAwake(!0)},i.IsSleepingAllowed=function(){return this.m_autoSleepFlag},i.SetAwake=function(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.SetZero(),this.m_angularVelocity=0,this.m_force.SetZero(),this.m_torque=0)},i.IsAwake=function(){return this.m_awakeFlag},i.SetActive=function(t){if(this.m_world.IsLocked())throw new Error;if(t!==this.IsActive())if(this.m_activeFlag=t,t)for(var e=this.m_fixtureList;e;e=e.m_next)e.CreateProxies();else{for(var n=this.m_fixtureList;n;n=n.m_next)n.DestroyProxies();for(var i=this.m_contactList;i;){var r=i;i=i.next,this.m_world.m_contactManager.Destroy(r.contact)}this.m_contactList=null}},i.IsActive=function(){return this.m_activeFlag},i.SetFixedRotation=function(t){this.m_fixedRotationFlag!==t&&(this.m_fixedRotationFlag=t,this.m_angularVelocity=0,this.ResetMassData())},i.IsFixedRotation=function(){return this.m_fixedRotationFlag},i.GetFixtureList=function(){return this.m_fixtureList},i.GetJointList=function(){return this.m_jointList},i.GetContactList=function(){return this.m_contactList},i.GetNext=function(){return this.m_next},i.GetUserData=function(){return this.m_userData},i.SetUserData=function(t){this.m_userData=t},i.GetWorld=function(){return this.m_world},i.Dump=function(e){var n=this.m_islandIndex;e("{\n"),e("  const bd: b2BodyDef = new b2BodyDef();\n");var i="";switch(this.m_type){case t.b2BodyType.b2_staticBody:i="b2BodyType.b2_staticBody";break;case t.b2BodyType.b2_kinematicBody:i="b2BodyType.b2_kinematicBody";break;case t.b2BodyType.b2_dynamicBody:i="b2BodyType.b2_dynamicBody"}e("  bd.type = %s;\n",i),e("  bd.position.Set(%.15f, %.15f);\n",this.m_xf.p.x,this.m_xf.p.y),e("  bd.angle = %.15f;\n",this.m_sweep.a),e("  bd.linearVelocity.Set(%.15f, %.15f);\n",this.m_linearVelocity.x,this.m_linearVelocity.y),e("  bd.angularVelocity = %.15f;\n",this.m_angularVelocity),e("  bd.linearDamping = %.15f;\n",this.m_linearDamping),e("  bd.angularDamping = %.15f;\n",this.m_angularDamping),e("  bd.allowSleep = %s;\n",this.m_autoSleepFlag?"true":"false"),e("  bd.awake = %s;\n",this.m_awakeFlag?"true":"false"),e("  bd.fixedRotation = %s;\n",this.m_fixedRotationFlag?"true":"false"),e("  bd.bullet = %s;\n",this.m_bulletFlag?"true":"false"),e("  bd.active = %s;\n",this.m_activeFlag?"true":"false"),e("  bd.gravityScale = %.15f;\n",this.m_gravityScale),e("\n"),e("  bodies[%d] = this.m_world.CreateBody(bd);\n",this.m_islandIndex),e("\n");for(var r=this.m_fixtureList;r;r=r.m_next)e("  {\n"),r.Dump(e,n),e("  }\n");e("}\n")},i.SynchronizeFixtures=function(){var t=e.SynchronizeFixtures_s_xf1;t.q.SetAngle(this.m_sweep.a0),Pt.MulRV(t.q,this.m_sweep.localCenter,t.p),Ct.SubVV(this.m_sweep.c0,t.p,t.p);for(var n=Ct.SubVV(this.m_sweep.c,this.m_sweep.c0,e.SynchronizeFixtures_s_displacement),i=this.m_fixtureList;i;i=i.m_next)i.SynchronizeProxies(t,this.m_xf,n)},i.SynchronizeTransform=function(){this.m_xf.q.SetAngle(this.m_sweep.a),Pt.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),Ct.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},i.ShouldCollide=function(e){return(this.m_type!==t.b2BodyType.b2_staticBody||e.m_type!==t.b2BodyType.b2_staticBody)&&this.ShouldCollideConnected(e)},i.ShouldCollideConnected=function(t){for(var e=this.m_jointList;e;e=e.next)if(e.other===t&&!e.joint.m_collideConnected)return!1;return!0},i.Advance=function(t){this.m_sweep.Advance(t),this.m_sweep.c.Copy(this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_xf.q.SetAngle(this.m_sweep.a),Pt.MulRV(this.m_xf.q,this.m_sweep.localCenter,this.m_xf.p),Ct.SubVV(this.m_sweep.c,this.m_xf.p,this.m_xf.p)},i.GetControllerList=function(){return this.m_controllerList},i.GetControllerCount=function(){return this.m_controllerCount},e}();xi.CreateFixtureShapeDensity_s_def=new fi,xi.SetMassData_s_oldCenter=new Ct,xi.ResetMassData_s_localCenter=new Ct,xi.ResetMassData_s_oldCenter=new Ct,xi.ResetMassData_s_massData=new oi,xi.SynchronizeFixtures_s_xf1=new Dt,xi.SynchronizeFixtures_s_displacement=new Ct,(gi=t.b2JointType||(t.b2JointType={}))[gi.e_unknownJoint=0]="e_unknownJoint",gi[gi.e_revoluteJoint=1]="e_revoluteJoint",gi[gi.e_prismaticJoint=2]="e_prismaticJoint",gi[gi.e_distanceJoint=3]="e_distanceJoint",gi[gi.e_pulleyJoint=4]="e_pulleyJoint",gi[gi.e_mouseJoint=5]="e_mouseJoint",gi[gi.e_gearJoint=6]="e_gearJoint",gi[gi.e_wheelJoint=7]="e_wheelJoint",gi[gi.e_weldJoint=8]="e_weldJoint",gi[gi.e_frictionJoint=9]="e_frictionJoint",gi[gi.e_ropeJoint=10]="e_ropeJoint",gi[gi.e_motorJoint=11]="e_motorJoint",gi[gi.e_areaJoint=12]="e_areaJoint",(vi=t.b2LimitState||(t.b2LimitState={}))[vi.e_inactiveLimit=0]="e_inactiveLimit",vi[vi.e_atLowerLimit=1]="e_atLowerLimit",vi[vi.e_atUpperLimit=2]="e_atUpperLimit",vi[vi.e_equalLimits=3]="e_equalLimits";var Si=function(){function t(){this.linear=new Ct,this.angularA=0,this.angularB=0}var e=t.prototype;return e.SetZero=function(){return this.linear.SetZero(),this.angularA=0,this.angularB=0,this},e.Set=function(t,e,n){return this.linear.Copy(t),this.angularA=e,this.angularB=n,this},t}(),Ai=function(){function t(t){this._other=null,this.prev=null,this.next=null,this.joint=t}return t.prototype.Reset=function(){this._other=null,this.prev=null,this.next=null},Q(t,[{key:"other",get:function(){if(null===this._other)throw new Error;return this._other},set:function(t){if(null!==this._other)throw new Error;this._other=t}}]),t}(),bi=function(e){this.type=t.b2JointType.e_unknownJoint,this.userData=null,this.collideConnected=!1,this.type=e},Ci=function(){function e(e){this.m_type=t.b2JointType.e_unknownJoint,this.m_prev=null,this.m_next=null,this.m_edgeA=new Ai(this),this.m_edgeB=new Ai(this),this.m_index=0,this.m_islandFlag=!1,this.m_collideConnected=!1,this.m_userData=null,this.m_type=e.type,this.m_edgeA.other=e.bodyB,this.m_edgeB.other=e.bodyA,this.m_bodyA=e.bodyA,this.m_bodyB=e.bodyB,this.m_collideConnected=n(e.collideConnected,!1),this.m_userData=n(e.userData,null)}var i=e.prototype;return i.GetType=function(){return this.m_type},i.GetBodyA=function(){return this.m_bodyA},i.GetBodyB=function(){return this.m_bodyB},i.GetNext=function(){return this.m_next},i.GetUserData=function(){return this.m_userData},i.SetUserData=function(t){this.m_userData=t},i.IsActive=function(){return this.m_bodyA.IsActive()&&this.m_bodyB.IsActive()},i.GetCollideConnected=function(){return this.m_collideConnected},i.Dump=function(t){t("// Dump is not supported for this joint type.\n")},i.ShiftOrigin=function(){},e}(),Ti=function(e){function n(){var n;return(n=e.call(this,t.b2JointType.e_distanceJoint)||this).localAnchorA=new Ct,n.localAnchorB=new Ct,n.length=1,n.frequencyHz=0,n.dampingRatio=0,n}return $(n,e),n.prototype.Initialize=function(t,e,n,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(i,this.localAnchorB),this.length=Ct.DistanceVV(n,i),this.frequencyHz=0,this.dampingRatio=0},n}(bi),Ei=function(t){function e(e){var i;return(i=t.call(this,e)||this).m_frequencyHz=0,i.m_dampingRatio=0,i.m_bias=0,i.m_localAnchorA=new Ct,i.m_localAnchorB=new Ct,i.m_gamma=0,i.m_impulse=0,i.m_length=0,i.m_indexA=0,i.m_indexB=0,i.m_u=new Ct,i.m_rA=new Ct,i.m_rB=new Ct,i.m_localCenterA=new Ct,i.m_localCenterB=new Ct,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_mass=0,i.m_qA=new Pt,i.m_qB=new Pt,i.m_lalcA=new Ct,i.m_lalcB=new Ct,i.m_frequencyHz=n(e.frequencyHz,0),i.m_dampingRatio=n(e.dampingRatio,0),i.m_localAnchorA.Copy(e.localAnchorA),i.m_localAnchorB.Copy(e.localAnchorB),i.m_length=e.length,i}$(e,t);var i=e.prototype;return i.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},i.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},i.GetReactionForce=function(t,e){return e.x=t*this.m_impulse*this.m_u.x,e.y=t*this.m_impulse*this.m_u.y,e},i.GetReactionTorque=function(){return 0},i.GetLocalAnchorA=function(){return this.m_localAnchorA},i.GetLocalAnchorB=function(){return this.m_localAnchorB},i.SetLength=function(t){this.m_length=t},i.Length=function(){return this.m_length},i.SetFrequency=function(t){this.m_frequencyHz=t},i.GetFrequency=function(){return this.m_frequencyHz},i.SetDampingRatio=function(t){this.m_dampingRatio=t},i.GetDampingRatio=function(){return this.m_dampingRatio},i.Dump=function(t){var e=this.m_bodyA.m_islandIndex,n=this.m_bodyB.m_islandIndex;t("  const jd: b2DistanceJointDef = new b2DistanceJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",n),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.length = %.15f;\n",this.m_length),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},i.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var n=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,s=t.positions[this.m_indexB].c,c=t.positions[this.m_indexB].a,l=t.velocities[this.m_indexB].v,h=t.velocities[this.m_indexB].w,_=this.m_qA.SetAngle(i),f=this.m_qB.SetAngle(c);Ct.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Pt.MulRV(_,this.m_lalcA,this.m_rA),Ct.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Pt.MulRV(f,this.m_lalcB,this.m_rB),this.m_u.x=s.x+this.m_rB.x-n.x-this.m_rA.x,this.m_u.y=s.y+this.m_rB.y-n.y-this.m_rA.y;var d=this.m_u.Length();d>u?this.m_u.SelfMul(1/d):this.m_u.SetZero();var p=Ct.CrossVV(this.m_rA,this.m_u),m=Ct.CrossVV(this.m_rB,this.m_u),v=this.m_invMassA+this.m_invIA*p*p+this.m_invMassB+this.m_invIB*m*m;if(this.m_mass=0!==v?1/v:0,this.m_frequencyHz>0){var g=d-this.m_length,y=2*o*this.m_frequencyHz,x=2*this.m_mass*this.m_dampingRatio*y,S=this.m_mass*y*y,A=t.step.dt;this.m_gamma=A*(x+A*S),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=g*A*S*this.m_gamma,v+=this.m_gamma,this.m_mass=0!==v?1/v:0}else this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var b=Ct.MulSV(this.m_impulse,this.m_u,e.InitVelocityConstraints_s_P);r.SelfMulSub(this.m_invMassA,b),a-=this.m_invIA*Ct.CrossVV(this.m_rA,b),l.SelfMulAdd(this.m_invMassB,b),h+=this.m_invIB*Ct.CrossVV(this.m_rB,b)}else this.m_impulse=0;t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=h},i.SolveVelocityConstraints=function(t){var n=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,o=Ct.AddVCrossSV(n,i,this.m_rA,e.SolveVelocityConstraints_s_vpA),s=Ct.AddVCrossSV(r,a,this.m_rB,e.SolveVelocityConstraints_s_vpB),c=Ct.DotVV(this.m_u,Ct.SubVV(s,o,Ct.s_t0)),l=-this.m_mass*(c+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=l;var h=Ct.MulSV(l,this.m_u,e.SolveVelocityConstraints_s_P);n.SelfMulSub(this.m_invMassA,h),i-=this.m_invIA*Ct.CrossVV(this.m_rA,h),r.SelfMulAdd(this.m_invMassB,h),a+=this.m_invIB*Ct.CrossVV(this.m_rB,h),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=a},i.SolvePositionConstraints=function(t){if(this.m_frequencyHz>0)return!0;var n=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),s=this.m_qB.SetAngle(a),c=Pt.MulRV(o,this.m_lalcA,this.m_rA),l=Pt.MulRV(s,this.m_lalcB,this.m_rB),h=this.m_u;h.x=r.x+l.x-n.x-c.x,h.y=r.y+l.y-n.y-c.y;var _=this.m_u.Normalize()-this.m_length;_=at(_,-v,v);var f=-this.m_mass*_,d=Ct.MulSV(f,h,e.SolvePositionConstraints_s_P);return n.SelfMulSub(this.m_invMassA,d),i-=this.m_invIA*Ct.CrossVV(c,d),r.SelfMulAdd(this.m_invMassB,d),a+=this.m_invIB*Ct.CrossVV(l,d),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=a,et(_)<u},e}(Ci);Ei.InitVelocityConstraints_s_P=new Ct,Ei.SolveVelocityConstraints_s_vpA=new Ct,Ei.SolveVelocityConstraints_s_vpB=new Ct,Ei.SolveVelocityConstraints_s_P=new Ct,Ei.SolvePositionConstraints_s_P=new Ct;var wi=function(e){function n(){var n;return(n=e.call(this,t.b2JointType.e_areaJoint)||this).bodies=[],n.frequencyHz=0,n.dampingRatio=0,n}return $(n,e),n.prototype.AddBody=function(t){this.bodies.push(t),1===this.bodies.length?this.bodyA=t:2===this.bodies.length&&(this.bodyB=t)},n}(bi),Ii=function(t){function e(e){var i;(i=t.call(this,e)||this).m_frequencyHz=0,i.m_dampingRatio=0,i.m_impulse=0,i.m_targetArea=0,i.m_delta=new Ct,i.m_bodies=e.bodies,i.m_frequencyHz=n(e.frequencyHz,0),i.m_dampingRatio=n(e.dampingRatio,0),i.m_targetLengths=K(e.bodies.length),i.m_normals=Ct.MakeArray(e.bodies.length),i.m_joints=[],i.m_deltas=Ct.MakeArray(e.bodies.length);var r=new Ti;r.frequencyHz=i.m_frequencyHz,r.dampingRatio=i.m_dampingRatio,i.m_targetArea=0;for(var a=0;a<i.m_bodies.length;++a){var o=i.m_bodies[a],s=i.m_bodies[(a+1)%i.m_bodies.length],c=o.GetWorldCenter(),l=s.GetWorldCenter();i.m_targetLengths[a]=Ct.DistanceVV(c,l),i.m_targetArea+=Ct.CrossVV(c,l),r.Initialize(o,s,c,l),i.m_joints[a]=o.GetWorld().CreateJoint(r)}return i.m_targetArea*=.5,i}$(e,t);var i=e.prototype;return i.GetAnchorA=function(t){return t},i.GetAnchorB=function(t){return t},i.GetReactionForce=function(t,e){return e},i.GetReactionTorque=function(){return 0},i.SetFrequency=function(t){this.m_frequencyHz=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetFrequency(t)},i.GetFrequency=function(){return this.m_frequencyHz},i.SetDampingRatio=function(t){this.m_dampingRatio=t;for(var e=0;e<this.m_joints.length;++e)this.m_joints[e].SetDampingRatio(t)},i.GetDampingRatio=function(){return this.m_dampingRatio},i.Dump=function(t){t("Area joint dumping is not supported.\n")},i.InitVelocityConstraints=function(t){for(var e=0;e<this.m_bodies.length;++e){var n=this.m_bodies[(e+this.m_bodies.length-1)%this.m_bodies.length],i=this.m_bodies[(e+1)%this.m_bodies.length],r=t.positions[n.m_islandIndex].c,a=t.positions[i.m_islandIndex].c,o=this.m_deltas[e];Ct.SubVV(a,r,o)}if(t.step.warmStarting){this.m_impulse*=t.step.dtRatio;for(var s=0;s<this.m_bodies.length;++s){var c=this.m_bodies[s],l=t.velocities[c.m_islandIndex].v,h=this.m_deltas[s];l.x+=c.m_invMass*h.y*.5*this.m_impulse,l.y+=c.m_invMass*-h.x*.5*this.m_impulse}}else this.m_impulse=0},i.SolveVelocityConstraints=function(t){for(var e=0,n=0,i=0;i<this.m_bodies.length;++i){var r=this.m_bodies[i],a=t.velocities[r.m_islandIndex].v,o=this.m_deltas[i];e+=o.LengthSquared()/r.GetMass(),n+=Ct.CrossVV(a,o)}var s=-2*n/e;this.m_impulse+=s;for(var c=0;c<this.m_bodies.length;++c){var l=this.m_bodies[c],h=t.velocities[l.m_islandIndex].v,u=this.m_deltas[c];h.x+=l.m_invMass*u.y*.5*s,h.y+=l.m_invMass*-u.x*.5*s}},i.SolvePositionConstraints=function(t){for(var e=0,n=0,i=0;i<this.m_bodies.length;++i){var a=this.m_bodies[i],o=this.m_bodies[(i+1)%this.m_bodies.length],s=t.positions[a.m_islandIndex].c,c=t.positions[o.m_islandIndex].c,l=Ct.SubVV(c,s,this.m_delta),h=l.Length();h<r&&(h=1),this.m_normals[i].x=l.y/h,this.m_normals[i].y=-l.x/h,e+=h,n+=Ct.CrossVV(s,c)}n*=.5;for(var _=.5*(this.m_targetArea-n)/e,f=!0,d=0;d<this.m_bodies.length;++d){var p=this.m_bodies[d],m=t.positions[p.m_islandIndex].c,g=(d+1)%this.m_bodies.length,y=Ct.AddVV(this.m_normals[d],this.m_normals[g],this.m_delta);y.SelfMul(_);var x=y.LengthSquared();x>lt(v)&&y.SelfMul(v/ut(x)),x>lt(u)&&(f=!1),m.x+=y.x,m.y+=y.y}return f},e}(Ci),Pi=function(e){function n(){var n;return(n=e.call(this,t.b2JointType.e_frictionJoint)||this).localAnchorA=new Ct,n.localAnchorB=new Ct,n.maxForce=0,n.maxTorque=0,n}return $(n,e),n.prototype.Initialize=function(t,e,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB)},n}(bi),Di=function(t){function e(e){var i;return(i=t.call(this,e)||this).m_localAnchorA=new Ct,i.m_localAnchorB=new Ct,i.m_linearImpulse=new Ct,i.m_angularImpulse=0,i.m_maxForce=0,i.m_maxTorque=0,i.m_indexA=0,i.m_indexB=0,i.m_rA=new Ct,i.m_rB=new Ct,i.m_localCenterA=new Ct,i.m_localCenterB=new Ct,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_linearMass=new wt,i.m_angularMass=0,i.m_qA=new Pt,i.m_qB=new Pt,i.m_lalcA=new Ct,i.m_lalcB=new Ct,i.m_K=new wt,i.m_localAnchorA.Copy(e.localAnchorA),i.m_localAnchorB.Copy(e.localAnchorB),i.m_linearImpulse.SetZero(),i.m_maxForce=n(e.maxForce,0),i.m_maxTorque=n(e.maxTorque,0),i.m_linearMass.SetZero(),i}$(e,t);var i=e.prototype;return i.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].a,n=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.positions[this.m_indexB].a,a=t.velocities[this.m_indexB].v,o=t.velocities[this.m_indexB].w,s=this.m_qA.SetAngle(e),c=this.m_qB.SetAngle(r);Ct.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var l=Pt.MulRV(s,this.m_lalcA,this.m_rA);Ct.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var h=Pt.MulRV(c,this.m_lalcB,this.m_rB),u=this.m_invMassA,_=this.m_invMassB,f=this.m_invIA,d=this.m_invIB,p=this.m_K;if(p.ex.x=u+_+f*l.y*l.y+d*h.y*h.y,p.ex.y=-f*l.x*l.y-d*h.x*h.y,p.ey.x=p.ex.y,p.ey.y=u+_+f*l.x*l.x+d*h.x*h.x,p.GetInverse(this.m_linearMass),this.m_angularMass=f+d,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var m=this.m_linearImpulse;n.SelfMulSub(u,m),i-=f*(Ct.CrossVV(this.m_rA,m)+this.m_angularImpulse),a.SelfMulAdd(_,m),o+=d*(Ct.CrossVV(this.m_rB,m)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=o},i.SolveVelocityConstraints=function(t){var n=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,o=this.m_invMassA,s=this.m_invMassB,c=this.m_invIA,l=this.m_invIB,h=t.step.dt,u=a-i,_=-this.m_angularMass*u,f=this.m_angularImpulse,d=h*this.m_maxTorque;this.m_angularImpulse=at(this.m_angularImpulse+_,-d,d),i-=c*(_=this.m_angularImpulse-f),a+=l*_;var p=Ct.SubVV(Ct.AddVCrossSV(r,a,this.m_rB,Ct.s_t0),Ct.AddVCrossSV(n,i,this.m_rA,Ct.s_t1),e.SolveVelocityConstraints_s_Cdot_v2),m=wt.MulMV(this.m_linearMass,p,e.SolveVelocityConstraints_s_impulseV).SelfNeg(),v=e.SolveVelocityConstraints_s_oldImpulseV.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(m);var g=h*this.m_maxForce;this.m_linearImpulse.LengthSquared()>g*g&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(g)),Ct.SubVV(this.m_linearImpulse,v,m),n.SelfMulSub(o,m),i-=c*Ct.CrossVV(this.m_rA,m),r.SelfMulAdd(s,m),a+=l*Ct.CrossVV(this.m_rB,m),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=a},i.SolvePositionConstraints=function(){return!0},i.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},i.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},i.GetReactionForce=function(t,e){return e.x=t*this.m_linearImpulse.x,e.y=t*this.m_linearImpulse.y,e},i.GetReactionTorque=function(t){return t*this.m_angularImpulse},i.GetLocalAnchorA=function(){return this.m_localAnchorA},i.GetLocalAnchorB=function(){return this.m_localAnchorB},i.SetMaxForce=function(t){this.m_maxForce=t},i.GetMaxForce=function(){return this.m_maxForce},i.SetMaxTorque=function(t){this.m_maxTorque=t},i.GetMaxTorque=function(){return this.m_maxTorque},i.Dump=function(t){var e=this.m_bodyA.m_islandIndex,n=this.m_bodyB.m_islandIndex;t("  const jd: b2FrictionJointDef = new b2FrictionJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",n),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},e}(Ci);Di.SolveVelocityConstraints_s_Cdot_v2=new Ct,Di.SolveVelocityConstraints_s_impulseV=new Ct,Di.SolveVelocityConstraints_s_oldImpulseV=new Ct;var Ri=function(e){function n(){var n;return(n=e.call(this,t.b2JointType.e_gearJoint)||this).ratio=1,n}return $(n,e),n}(bi),Mi=function(e){function i(i){var r,a,o;(r=e.call(this,i)||this).m_typeA=t.b2JointType.e_unknownJoint,r.m_typeB=t.b2JointType.e_unknownJoint,r.m_localAnchorA=new Ct,r.m_localAnchorB=new Ct,r.m_localAnchorC=new Ct,r.m_localAnchorD=new Ct,r.m_localAxisC=new Ct,r.m_localAxisD=new Ct,r.m_referenceAngleA=0,r.m_referenceAngleB=0,r.m_constant=0,r.m_ratio=0,r.m_impulse=0,r.m_indexA=0,r.m_indexB=0,r.m_indexC=0,r.m_indexD=0,r.m_lcA=new Ct,r.m_lcB=new Ct,r.m_lcC=new Ct,r.m_lcD=new Ct,r.m_mA=0,r.m_mB=0,r.m_mC=0,r.m_mD=0,r.m_iA=0,r.m_iB=0,r.m_iC=0,r.m_iD=0,r.m_JvAC=new Ct,r.m_JvBD=new Ct,r.m_JwA=0,r.m_JwB=0,r.m_JwC=0,r.m_JwD=0,r.m_mass=0,r.m_qA=new Pt,r.m_qB=new Pt,r.m_qC=new Pt,r.m_qD=new Pt,r.m_lalcA=new Ct,r.m_lalcB=new Ct,r.m_lalcC=new Ct,r.m_lalcD=new Ct,r.m_joint1=i.joint1,r.m_joint2=i.joint2,r.m_typeA=r.m_joint1.GetType(),r.m_typeB=r.m_joint2.GetType(),r.m_bodyC=r.m_joint1.GetBodyA(),r.m_bodyA=r.m_joint1.GetBodyB();var s=r.m_bodyA.m_xf,c=r.m_bodyA.m_sweep.a,l=r.m_bodyC.m_xf,h=r.m_bodyC.m_sweep.a;if(r.m_typeA===t.b2JointType.e_revoluteJoint){var u=i.joint1;r.m_localAnchorC.Copy(u.m_localAnchorA),r.m_localAnchorA.Copy(u.m_localAnchorB),r.m_referenceAngleA=u.m_referenceAngle,r.m_localAxisC.SetZero(),a=c-h-r.m_referenceAngleA}else{var _=i.joint1;r.m_localAnchorC.Copy(_.m_localAnchorA),r.m_localAnchorA.Copy(_.m_localAnchorB),r.m_referenceAngleA=_.m_referenceAngle,r.m_localAxisC.Copy(_.m_localXAxisA);var f=r.m_localAnchorC,d=Pt.MulTRV(l.q,Ct.AddVV(Pt.MulRV(s.q,r.m_localAnchorA,Ct.s_t0),Ct.SubVV(s.p,l.p,Ct.s_t1),Ct.s_t0),Ct.s_t0);a=Ct.DotVV(Ct.SubVV(d,f,Ct.s_t0),r.m_localAxisC)}r.m_bodyD=r.m_joint2.GetBodyA(),r.m_bodyB=r.m_joint2.GetBodyB();var p=r.m_bodyB.m_xf,m=r.m_bodyB.m_sweep.a,v=r.m_bodyD.m_xf,g=r.m_bodyD.m_sweep.a;if(r.m_typeB===t.b2JointType.e_revoluteJoint){var y=i.joint2;r.m_localAnchorD.Copy(y.m_localAnchorA),r.m_localAnchorB.Copy(y.m_localAnchorB),r.m_referenceAngleB=y.m_referenceAngle,r.m_localAxisD.SetZero(),o=m-g-r.m_referenceAngleB}else{var x=i.joint2;r.m_localAnchorD.Copy(x.m_localAnchorA),r.m_localAnchorB.Copy(x.m_localAnchorB),r.m_referenceAngleB=x.m_referenceAngle,r.m_localAxisD.Copy(x.m_localXAxisA);var S=r.m_localAnchorD,A=Pt.MulTRV(v.q,Ct.AddVV(Pt.MulRV(p.q,r.m_localAnchorB,Ct.s_t0),Ct.SubVV(p.p,v.p,Ct.s_t1),Ct.s_t0),Ct.s_t0);o=Ct.DotVV(Ct.SubVV(A,S,Ct.s_t0),r.m_localAxisD)}return r.m_ratio=n(i.ratio,1),r.m_constant=a+r.m_ratio*o,r.m_impulse=0,r}$(i,e);var r=i.prototype;return r.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_indexC=this.m_bodyC.m_islandIndex,this.m_indexD=this.m_bodyD.m_islandIndex,this.m_lcA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_lcB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_lcC.Copy(this.m_bodyC.m_sweep.localCenter),this.m_lcD.Copy(this.m_bodyD.m_sweep.localCenter),this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;var n=e.positions[this.m_indexA].a,r=e.velocities[this.m_indexA].v,a=e.velocities[this.m_indexA].w,o=e.positions[this.m_indexB].a,s=e.velocities[this.m_indexB].v,c=e.velocities[this.m_indexB].w,l=e.positions[this.m_indexC].a,h=e.velocities[this.m_indexC].v,u=e.velocities[this.m_indexC].w,_=e.positions[this.m_indexD].a,f=e.velocities[this.m_indexD].v,d=e.velocities[this.m_indexD].w,p=this.m_qA.SetAngle(n),m=this.m_qB.SetAngle(o),v=this.m_qC.SetAngle(l),g=this.m_qD.SetAngle(_);if(this.m_mass=0,this.m_typeA===t.b2JointType.e_revoluteJoint)this.m_JvAC.SetZero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{var y=Pt.MulRV(v,this.m_localAxisC,i.InitVelocityConstraints_s_u);Ct.SubVV(this.m_localAnchorC,this.m_lcC,this.m_lalcC);var x=Pt.MulRV(v,this.m_lalcC,i.InitVelocityConstraints_s_rC);Ct.SubVV(this.m_localAnchorA,this.m_lcA,this.m_lalcA);var S=Pt.MulRV(p,this.m_lalcA,i.InitVelocityConstraints_s_rA);this.m_JvAC.Copy(y),this.m_JwC=Ct.CrossVV(x,y),this.m_JwA=Ct.CrossVV(S,y),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_typeB===t.b2JointType.e_revoluteJoint)this.m_JvBD.SetZero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{var A=Pt.MulRV(g,this.m_localAxisD,i.InitVelocityConstraints_s_u);Ct.SubVV(this.m_localAnchorD,this.m_lcD,this.m_lalcD);var b=Pt.MulRV(g,this.m_lalcD,i.InitVelocityConstraints_s_rD);Ct.SubVV(this.m_localAnchorB,this.m_lcB,this.m_lalcB);var C=Pt.MulRV(m,this.m_lalcB,i.InitVelocityConstraints_s_rB);Ct.MulSV(this.m_ratio,A,this.m_JvBD),this.m_JwD=this.m_ratio*Ct.CrossVV(b,A),this.m_JwB=this.m_ratio*Ct.CrossVV(C,A),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,e.step.warmStarting?(r.SelfMulAdd(this.m_mA*this.m_impulse,this.m_JvAC),a+=this.m_iA*this.m_impulse*this.m_JwA,s.SelfMulAdd(this.m_mB*this.m_impulse,this.m_JvBD),c+=this.m_iB*this.m_impulse*this.m_JwB,h.SelfMulSub(this.m_mC*this.m_impulse,this.m_JvAC),u-=this.m_iC*this.m_impulse*this.m_JwC,f.SelfMulSub(this.m_mD*this.m_impulse,this.m_JvBD),d-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,e.velocities[this.m_indexA].w=a,e.velocities[this.m_indexB].w=c,e.velocities[this.m_indexC].w=u,e.velocities[this.m_indexD].w=d},r.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,i=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,a=t.velocities[this.m_indexC].v,o=t.velocities[this.m_indexC].w,s=t.velocities[this.m_indexD].v,c=t.velocities[this.m_indexD].w,l=Ct.DotVV(this.m_JvAC,Ct.SubVV(e,a,Ct.s_t0))+Ct.DotVV(this.m_JvBD,Ct.SubVV(i,s,Ct.s_t0));l+=this.m_JwA*n-this.m_JwC*o+(this.m_JwB*r-this.m_JwD*c);var h=-this.m_mass*l;this.m_impulse+=h,e.SelfMulAdd(this.m_mA*h,this.m_JvAC),n+=this.m_iA*h*this.m_JwA,i.SelfMulAdd(this.m_mB*h,this.m_JvBD),r+=this.m_iB*h*this.m_JwB,a.SelfMulSub(this.m_mC*h,this.m_JvAC),o-=this.m_iC*h*this.m_JwC,s.SelfMulSub(this.m_mD*h,this.m_JvBD),c-=this.m_iD*h*this.m_JwD,t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=r,t.velocities[this.m_indexC].w=o,t.velocities[this.m_indexD].w=c},r.SolvePositionConstraints=function(e){var n,r,a,o,s,c,l=e.positions[this.m_indexA].c,h=e.positions[this.m_indexA].a,_=e.positions[this.m_indexB].c,f=e.positions[this.m_indexB].a,d=e.positions[this.m_indexC].c,p=e.positions[this.m_indexC].a,m=e.positions[this.m_indexD].c,v=e.positions[this.m_indexD].a,g=this.m_qA.SetAngle(h),y=this.m_qB.SetAngle(f),x=this.m_qC.SetAngle(p),S=this.m_qD.SetAngle(v),A=0,b=this.m_JvAC,C=this.m_JvBD,T=0;if(this.m_typeA===t.b2JointType.e_revoluteJoint)b.SetZero(),a=1,s=1,T+=this.m_iA+this.m_iC,n=h-p-this.m_referenceAngleA;else{var E=Pt.MulRV(x,this.m_localAxisC,i.SolvePositionConstraints_s_u),w=Pt.MulRV(x,this.m_lalcC,i.SolvePositionConstraints_s_rC),I=Pt.MulRV(g,this.m_lalcA,i.SolvePositionConstraints_s_rA);b.Copy(E),s=Ct.CrossVV(w,E),a=Ct.CrossVV(I,E),T+=this.m_mC+this.m_mA+this.m_iC*s*s+this.m_iA*a*a;var P=this.m_lalcC,D=Pt.MulTRV(x,Ct.AddVV(I,Ct.SubVV(l,d,Ct.s_t0),Ct.s_t0),Ct.s_t0);n=Ct.DotVV(Ct.SubVV(D,P,Ct.s_t0),this.m_localAxisC)}if(this.m_typeB===t.b2JointType.e_revoluteJoint)C.SetZero(),o=this.m_ratio,c=this.m_ratio,T+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),r=f-v-this.m_referenceAngleB;else{var R=Pt.MulRV(S,this.m_localAxisD,i.SolvePositionConstraints_s_u),M=Pt.MulRV(S,this.m_lalcD,i.SolvePositionConstraints_s_rD),O=Pt.MulRV(y,this.m_lalcB,i.SolvePositionConstraints_s_rB);Ct.MulSV(this.m_ratio,R,C),c=this.m_ratio*Ct.CrossVV(M,R),o=this.m_ratio*Ct.CrossVV(O,R),T+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*c*c+this.m_iB*o*o;var N=this.m_lalcD,B=Pt.MulTRV(S,Ct.AddVV(O,Ct.SubVV(_,m,Ct.s_t0),Ct.s_t0),Ct.s_t0);r=Ct.DotVV(Ct.SubVV(B,N,Ct.s_t0),this.m_localAxisD)}var L=n+this.m_ratio*r-this.m_constant,F=0;return T>0&&(F=-L/T),l.SelfMulAdd(this.m_mA*F,b),h+=this.m_iA*F*a,_.SelfMulAdd(this.m_mB*F,C),f+=this.m_iB*F*o,d.SelfMulSub(this.m_mC*F,b),p-=this.m_iC*F*s,m.SelfMulSub(this.m_mD*F,C),v-=this.m_iD*F*c,e.positions[this.m_indexA].a=h,e.positions[this.m_indexB].a=f,e.positions[this.m_indexC].a=p,e.positions[this.m_indexD].a=v,A<u},r.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},r.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},r.GetReactionForce=function(t,e){return Ct.MulSV(t*this.m_impulse,this.m_JvAC,e)},r.GetReactionTorque=function(t){return t*this.m_impulse*this.m_JwA},r.GetJoint1=function(){return this.m_joint1},r.GetJoint2=function(){return this.m_joint2},r.GetRatio=function(){return this.m_ratio},r.SetRatio=function(t){this.m_ratio=t},r.Dump=function(t){var e=this.m_bodyA.m_islandIndex,n=this.m_bodyB.m_islandIndex,i=this.m_joint1.m_index,r=this.m_joint2.m_index;t("  const jd: b2GearJointDef = new b2GearJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",n),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.joint1 = joints[%d];\n",i),t("  jd.joint2 = joints[%d];\n",r),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},i}(Ci);Mi.InitVelocityConstraints_s_u=new Ct,Mi.InitVelocityConstraints_s_rA=new Ct,Mi.InitVelocityConstraints_s_rB=new Ct,Mi.InitVelocityConstraints_s_rC=new Ct,Mi.InitVelocityConstraints_s_rD=new Ct,Mi.SolvePositionConstraints_s_u=new Ct,Mi.SolvePositionConstraints_s_rA=new Ct,Mi.SolvePositionConstraints_s_rB=new Ct,Mi.SolvePositionConstraints_s_rC=new Ct,Mi.SolvePositionConstraints_s_rD=new Ct;var Oi=function(e){function n(){var n;return(n=e.call(this,t.b2JointType.e_motorJoint)||this).linearOffset=new Ct(0,0),n.angularOffset=0,n.maxForce=1,n.maxTorque=1,n.correctionFactor=.3,n}return $(n,e),n.prototype.Initialize=function(t,e){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(this.bodyB.GetPosition(),this.linearOffset);var n=this.bodyA.GetAngle(),i=this.bodyB.GetAngle();this.angularOffset=i-n},n}(bi),Ni=function(t){function e(e){var i;return(i=t.call(this,e)||this).m_linearOffset=new Ct,i.m_angularOffset=0,i.m_linearImpulse=new Ct,i.m_angularImpulse=0,i.m_maxForce=0,i.m_maxTorque=0,i.m_correctionFactor=.3,i.m_indexA=0,i.m_indexB=0,i.m_rA=new Ct,i.m_rB=new Ct,i.m_localCenterA=new Ct,i.m_localCenterB=new Ct,i.m_linearError=new Ct,i.m_angularError=0,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_linearMass=new wt,i.m_angularMass=0,i.m_qA=new Pt,i.m_qB=new Pt,i.m_K=new wt,i.m_linearOffset.Copy(n(e.linearOffset,Ct.ZERO)),i.m_linearImpulse.SetZero(),i.m_maxForce=n(e.maxForce,0),i.m_maxTorque=n(e.maxTorque,0),i.m_correctionFactor=n(e.correctionFactor,.3),i}$(e,t);var i=e.prototype;return i.GetAnchorA=function(t){var e=this.m_bodyA.GetPosition();return t.x=e.x,t.y=e.y,t},i.GetAnchorB=function(t){var e=this.m_bodyB.GetPosition();return t.x=e.x,t.y=e.y,t},i.GetReactionForce=function(t,e){return Ct.MulSV(t,this.m_linearImpulse,e)},i.GetReactionTorque=function(t){return t*this.m_angularImpulse},i.SetLinearOffset=function(t){Ct.IsEqualToV(t,this.m_linearOffset)||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_linearOffset.Copy(t))},i.GetLinearOffset=function(){return this.m_linearOffset},i.SetAngularOffset=function(t){t!==this.m_angularOffset&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_angularOffset=t)},i.GetAngularOffset=function(){return this.m_angularOffset},i.SetMaxForce=function(t){this.m_maxForce=t},i.GetMaxForce=function(){return this.m_maxForce},i.SetMaxTorque=function(t){this.m_maxTorque=t},i.GetMaxTorque=function(){return this.m_maxTorque},i.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,a=t.positions[this.m_indexB].c,o=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v,c=t.velocities[this.m_indexB].w,l=this.m_qA.SetAngle(n),h=this.m_qB.SetAngle(o),u=Pt.MulRV(l,Ct.SubVV(this.m_linearOffset,this.m_localCenterA,Ct.s_t0),this.m_rA),_=Pt.MulRV(h,Ct.NegV(this.m_localCenterB,Ct.s_t0),this.m_rB),f=this.m_invMassA,d=this.m_invMassB,p=this.m_invIA,m=this.m_invIB,v=this.m_K;if(v.ex.x=f+d+p*u.y*u.y+m*_.y*_.y,v.ex.y=-p*u.x*u.y-m*_.x*_.y,v.ey.x=v.ex.y,v.ey.y=f+d+p*u.x*u.x+m*_.x*_.x,v.GetInverse(this.m_linearMass),this.m_angularMass=p+m,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),Ct.SubVV(Ct.AddVV(a,_,Ct.s_t0),Ct.AddVV(e,u,Ct.s_t1),this.m_linearError),this.m_angularError=o-n-this.m_angularOffset,t.step.warmStarting){this.m_linearImpulse.SelfMul(t.step.dtRatio),this.m_angularImpulse*=t.step.dtRatio;var g=this.m_linearImpulse;i.SelfMulSub(f,g),r-=p*(Ct.CrossVV(u,g)+this.m_angularImpulse),s.SelfMulAdd(d,g),c+=m*(Ct.CrossVV(_,g)+this.m_angularImpulse)}else this.m_linearImpulse.SetZero(),this.m_angularImpulse=0;t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=c},i.SolveVelocityConstraints=function(t){var n=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,o=this.m_invMassA,s=this.m_invMassB,c=this.m_invIA,l=this.m_invIB,h=t.step.dt,u=t.step.inv_dt,_=a-i+u*this.m_correctionFactor*this.m_angularError,f=-this.m_angularMass*_,d=this.m_angularImpulse,p=h*this.m_maxTorque;this.m_angularImpulse=at(this.m_angularImpulse+f,-p,p),i-=c*(f=this.m_angularImpulse-d),a+=l*f;var m=this.m_rA,v=this.m_rB,g=Ct.AddVV(Ct.SubVV(Ct.AddVV(r,Ct.CrossSV(a,v,Ct.s_t0),Ct.s_t0),Ct.AddVV(n,Ct.CrossSV(i,m,Ct.s_t1),Ct.s_t1),Ct.s_t2),Ct.MulSV(u*this.m_correctionFactor,this.m_linearError,Ct.s_t3),e.SolveVelocityConstraints_s_Cdot_v2),y=wt.MulMV(this.m_linearMass,g,e.SolveVelocityConstraints_s_impulse_v2).SelfNeg(),x=e.SolveVelocityConstraints_s_oldImpulse_v2.Copy(this.m_linearImpulse);this.m_linearImpulse.SelfAdd(y);var S=h*this.m_maxForce;this.m_linearImpulse.LengthSquared()>S*S&&(this.m_linearImpulse.Normalize(),this.m_linearImpulse.SelfMul(S)),Ct.SubVV(this.m_linearImpulse,x,y),n.SelfMulSub(o,y),i-=c*Ct.CrossVV(m,y),r.SelfMulAdd(s,y),a+=l*Ct.CrossVV(v,y),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=a},i.SolvePositionConstraints=function(){return!0},i.Dump=function(t){var e=this.m_bodyA.m_islandIndex,n=this.m_bodyB.m_islandIndex;t("  const jd: b2MotorJointDef = new b2MotorJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",n),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.linearOffset.Set(%.15f, %.15f);\n",this.m_linearOffset.x,this.m_linearOffset.y),t("  jd.angularOffset = %.15f;\n",this.m_angularOffset),t("  jd.maxForce = %.15f;\n",this.m_maxForce),t("  jd.maxTorque = %.15f;\n",this.m_maxTorque),t("  jd.correctionFactor = %.15f;\n",this.m_correctionFactor),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},e}(Ci);Ni.SolveVelocityConstraints_s_Cdot_v2=new Ct,Ni.SolveVelocityConstraints_s_impulse_v2=new Ct,Ni.SolveVelocityConstraints_s_oldImpulse_v2=new Ct;var Bi=function(e){function n(){var n;return(n=e.call(this,t.b2JointType.e_mouseJoint)||this).target=new Ct,n.maxForce=0,n.frequencyHz=5,n.dampingRatio=.7,n}return $(n,e),n}(bi),Li=function(t){function e(e){var i;return(i=t.call(this,e)||this).m_localAnchorB=new Ct,i.m_targetA=new Ct,i.m_frequencyHz=0,i.m_dampingRatio=0,i.m_beta=0,i.m_impulse=new Ct,i.m_maxForce=0,i.m_gamma=0,i.m_indexA=0,i.m_indexB=0,i.m_rB=new Ct,i.m_localCenterB=new Ct,i.m_invMassB=0,i.m_invIB=0,i.m_mass=new wt,i.m_C=new Ct,i.m_qB=new Pt,i.m_lalcB=new Ct,i.m_K=new wt,i.m_targetA.Copy(n(e.target,Ct.ZERO)),Dt.MulTXV(i.m_bodyB.GetTransform(),i.m_targetA,i.m_localAnchorB),i.m_maxForce=n(e.maxForce,0),i.m_impulse.SetZero(),i.m_frequencyHz=n(e.frequencyHz,0),i.m_dampingRatio=n(e.dampingRatio,0),i.m_beta=0,i.m_gamma=0,i}$(e,t);var i=e.prototype;return i.SetTarget=function(t){this.m_bodyB.IsAwake()||this.m_bodyB.SetAwake(!0),this.m_targetA.Copy(t)},i.GetTarget=function(){return this.m_targetA},i.SetMaxForce=function(t){this.m_maxForce=t},i.GetMaxForce=function(){return this.m_maxForce},i.SetFrequency=function(t){this.m_frequencyHz=t},i.GetFrequency=function(){return this.m_frequencyHz},i.SetDampingRatio=function(t){this.m_dampingRatio=t},i.GetDampingRatio=function(){return this.m_dampingRatio},i.InitVelocityConstraints=function(t){this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;var e=t.positions[this.m_indexB].c,n=t.positions[this.m_indexB].a,i=t.velocities[this.m_indexB].v,r=t.velocities[this.m_indexB].w,a=this.m_qB.SetAngle(n),s=this.m_bodyB.GetMass(),c=2*o*this.m_frequencyHz,l=2*s*this.m_dampingRatio*c,h=s*c*c,u=t.step.dt;this.m_gamma=u*(l+u*h),0!==this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=u*h*this.m_gamma,Ct.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Pt.MulRV(a,this.m_lalcB,this.m_rB);var _=this.m_K;_.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,_.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,_.ey.x=_.ex.y,_.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,_.GetInverse(this.m_mass),this.m_C.x=e.x+this.m_rB.x-this.m_targetA.x,this.m_C.y=e.y+this.m_rB.y-this.m_targetA.y,this.m_C.SelfMul(this.m_beta),r*=.98,t.step.warmStarting?(this.m_impulse.SelfMul(t.step.dtRatio),i.x+=this.m_invMassB*this.m_impulse.x,i.y+=this.m_invMassB*this.m_impulse.y,r+=this.m_invIB*Ct.CrossVV(this.m_rB,this.m_impulse)):this.m_impulse.SetZero(),t.velocities[this.m_indexB].w=r},i.SolveVelocityConstraints=function(t){var n=t.velocities[this.m_indexB].v,i=t.velocities[this.m_indexB].w,r=Ct.AddVCrossSV(n,i,this.m_rB,e.SolveVelocityConstraints_s_Cdot),a=wt.MulMV(this.m_mass,Ct.AddVV(r,Ct.AddVV(this.m_C,Ct.MulSV(this.m_gamma,this.m_impulse,Ct.s_t0),Ct.s_t0),Ct.s_t0).SelfNeg(),e.SolveVelocityConstraints_s_impulse),o=e.SolveVelocityConstraints_s_oldImpulse.Copy(this.m_impulse);this.m_impulse.SelfAdd(a);var s=t.step.dt*this.m_maxForce;this.m_impulse.LengthSquared()>s*s&&this.m_impulse.SelfMul(s/this.m_impulse.Length()),Ct.SubVV(this.m_impulse,o,a),n.SelfMulAdd(this.m_invMassB,a),i+=this.m_invIB*Ct.CrossVV(this.m_rB,a),t.velocities[this.m_indexB].w=i},i.SolvePositionConstraints=function(){return!0},i.GetAnchorA=function(t){return t.x=this.m_targetA.x,t.y=this.m_targetA.y,t},i.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},i.GetReactionForce=function(t,e){return Ct.MulSV(t,this.m_impulse,e)},i.GetReactionTorque=function(){return 0},i.Dump=function(t){t("Mouse joint dumping is not supported.\n")},i.ShiftOrigin=function(t){this.m_targetA.SelfSub(t)},e}(Ci);Li.SolveVelocityConstraints_s_Cdot=new Ct,Li.SolveVelocityConstraints_s_impulse=new Ct,Li.SolveVelocityConstraints_s_oldImpulse=new Ct;var Fi=function(e){function n(){var n;return(n=e.call(this,t.b2JointType.e_prismaticJoint)||this).localAnchorA=new Ct,n.localAnchorB=new Ct,n.localAxisA=new Ct(1,0),n.referenceAngle=0,n.enableLimit=!1,n.lowerTranslation=0,n.upperTranslation=0,n.enableMotor=!1,n.maxMotorForce=0,n.motorSpeed=0,n}return $(n,e),n.prototype.Initialize=function(t,e,n,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB),this.bodyA.GetLocalVector(i,this.localAxisA),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},n}(bi),Vi=function(e){function i(i){var r;return(r=e.call(this,i)||this).m_localAnchorA=new Ct,r.m_localAnchorB=new Ct,r.m_localXAxisA=new Ct,r.m_localYAxisA=new Ct,r.m_referenceAngle=0,r.m_impulse=new Et(0,0,0),r.m_motorImpulse=0,r.m_lowerTranslation=0,r.m_upperTranslation=0,r.m_maxMotorForce=0,r.m_motorSpeed=0,r.m_enableLimit=!1,r.m_enableMotor=!1,r.m_limitState=t.b2LimitState.e_inactiveLimit,r.m_indexA=0,r.m_indexB=0,r.m_localCenterA=new Ct,r.m_localCenterB=new Ct,r.m_invMassA=0,r.m_invMassB=0,r.m_invIA=0,r.m_invIB=0,r.m_axis=new Ct(0,0),r.m_perp=new Ct(0,0),r.m_s1=0,r.m_s2=0,r.m_a1=0,r.m_a2=0,r.m_K=new It,r.m_K3=new It,r.m_K2=new wt,r.m_motorMass=0,r.m_qA=new Pt,r.m_qB=new Pt,r.m_lalcA=new Ct,r.m_lalcB=new Ct,r.m_rA=new Ct,r.m_rB=new Ct,r.m_localAnchorA.Copy(n(i.localAnchorA,Ct.ZERO)),r.m_localAnchorB.Copy(n(i.localAnchorB,Ct.ZERO)),r.m_localXAxisA.Copy(n(i.localAxisA,new Ct(1,0))).SelfNormalize(),Ct.CrossOneV(r.m_localXAxisA,r.m_localYAxisA),r.m_referenceAngle=n(i.referenceAngle,0),r.m_lowerTranslation=n(i.lowerTranslation,0),r.m_upperTranslation=n(i.upperTranslation,0),r.m_maxMotorForce=n(i.maxMotorForce,0),r.m_motorSpeed=n(i.motorSpeed,0),r.m_enableLimit=n(i.enableLimit,!1),r.m_enableMotor=n(i.enableMotor,!1),r}$(i,e);var r=i.prototype;return r.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var n=e.positions[this.m_indexA].c,r=e.positions[this.m_indexA].a,a=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,s=e.positions[this.m_indexB].c,c=e.positions[this.m_indexB].a,l=e.velocities[this.m_indexB].v,h=e.velocities[this.m_indexB].w,_=this.m_qA.SetAngle(r),f=this.m_qB.SetAngle(c);Ct.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var d=Pt.MulRV(_,this.m_lalcA,this.m_rA);Ct.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var p=Pt.MulRV(f,this.m_lalcB,this.m_rB),m=Ct.AddVV(Ct.SubVV(s,n,Ct.s_t0),Ct.SubVV(p,d,Ct.s_t1),i.InitVelocityConstraints_s_d),v=this.m_invMassA,g=this.m_invMassB,y=this.m_invIA,x=this.m_invIB;if(Pt.MulRV(_,this.m_localXAxisA,this.m_axis),this.m_a1=Ct.CrossVV(Ct.AddVV(m,d,Ct.s_t0),this.m_axis),this.m_a2=Ct.CrossVV(p,this.m_axis),this.m_motorMass=v+g+y*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),Pt.MulRV(_,this.m_localYAxisA,this.m_perp),this.m_s1=Ct.CrossVV(Ct.AddVV(m,d,Ct.s_t0),this.m_perp),this.m_s2=Ct.CrossVV(p,this.m_perp),this.m_K.ex.x=v+g+y*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2,this.m_K.ex.y=y*this.m_s1+x*this.m_s2,this.m_K.ex.z=y*this.m_s1*this.m_a1+x*this.m_s2*this.m_a2,this.m_K.ey.x=this.m_K.ex.y,this.m_K.ey.y=y+x,0===this.m_K.ey.y&&(this.m_K.ey.y=1),this.m_K.ey.z=y*this.m_a1+x*this.m_a2,this.m_K.ez.x=this.m_K.ex.z,this.m_K.ez.y=this.m_K.ey.z,this.m_K.ez.z=v+g+y*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_enableLimit){var S=Ct.DotVV(this.m_axis,m);et(this.m_upperTranslation-this.m_lowerTranslation)<2*u?this.m_limitState=t.b2LimitState.e_equalLimits:S<=this.m_lowerTranslation?this.m_limitState!==t.b2LimitState.e_atLowerLimit&&(this.m_limitState=t.b2LimitState.e_atLowerLimit,this.m_impulse.z=0):S>=this.m_upperTranslation?this.m_limitState!==t.b2LimitState.e_atUpperLimit&&(this.m_limitState=t.b2LimitState.e_atUpperLimit,this.m_impulse.z=0):(this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_impulse.z=0;if(this.m_enableMotor||(this.m_motorImpulse=0),e.step.warmStarting){this.m_impulse.SelfMul(e.step.dtRatio),this.m_motorImpulse*=e.step.dtRatio;var A=Ct.AddVV(Ct.MulSV(this.m_impulse.x,this.m_perp,Ct.s_t0),Ct.MulSV(this.m_motorImpulse+this.m_impulse.z,this.m_axis,Ct.s_t1),i.InitVelocityConstraints_s_P),b=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,C=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;a.SelfMulSub(v,A),o-=y*b,l.SelfMulAdd(g,A),h+=x*C}else this.m_impulse.SetZero(),this.m_motorImpulse=0;e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=h},r.SolveVelocityConstraints=function(e){var n=e.velocities[this.m_indexA].v,r=e.velocities[this.m_indexA].w,a=e.velocities[this.m_indexB].v,o=e.velocities[this.m_indexB].w,s=this.m_invMassA,c=this.m_invMassB,l=this.m_invIA,h=this.m_invIB;if(this.m_enableMotor&&this.m_limitState!==t.b2LimitState.e_equalLimits){var u=Ct.DotVV(this.m_axis,Ct.SubVV(a,n,Ct.s_t0))+this.m_a2*o-this.m_a1*r,_=this.m_motorMass*(this.m_motorSpeed-u),f=this.m_motorImpulse,d=e.step.dt*this.m_maxMotorForce;this.m_motorImpulse=at(this.m_motorImpulse+_,-d,d),_=this.m_motorImpulse-f;var p=Ct.MulSV(_,this.m_axis,i.SolveVelocityConstraints_s_P),m=_*this.m_a1,v=_*this.m_a2;n.SelfMulSub(s,p),r-=l*m,a.SelfMulAdd(c,p),o+=h*v}var g=Ct.DotVV(this.m_perp,Ct.SubVV(a,n,Ct.s_t0))+this.m_s2*o-this.m_s1*r,y=o-r;if(this.m_enableLimit&&this.m_limitState!==t.b2LimitState.e_inactiveLimit){var x=Ct.DotVV(this.m_axis,Ct.SubVV(a,n,Ct.s_t0))+this.m_a2*o-this.m_a1*r,S=i.SolveVelocityConstraints_s_f1.Copy(this.m_impulse),A=this.m_K.Solve33(-g,-y,-x,i.SolveVelocityConstraints_s_df3);this.m_impulse.SelfAdd(A),this.m_limitState===t.b2LimitState.e_atLowerLimit?this.m_impulse.z=rt(this.m_impulse.z,0):this.m_limitState===t.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=nt(this.m_impulse.z,0));var b=-g-(this.m_impulse.z-S.z)*this.m_K.ez.x,C=-y-(this.m_impulse.z-S.z)*this.m_K.ez.y,T=this.m_K.Solve22(b,C,i.SolveVelocityConstraints_s_f2r);T.x+=S.x,T.y+=S.y,this.m_impulse.x=T.x,this.m_impulse.y=T.y,A.x=this.m_impulse.x-S.x,A.y=this.m_impulse.y-S.y,A.z=this.m_impulse.z-S.z;var E=Ct.AddVV(Ct.MulSV(A.x,this.m_perp,Ct.s_t0),Ct.MulSV(A.z,this.m_axis,Ct.s_t1),i.SolveVelocityConstraints_s_P),w=A.x*this.m_s1+A.y+A.z*this.m_a1,I=A.x*this.m_s2+A.y+A.z*this.m_a2;n.SelfMulSub(s,E),r-=l*w,a.SelfMulAdd(c,E),o+=h*I}else{var P=this.m_K.Solve22(-g,-y,i.SolveVelocityConstraints_s_df2);this.m_impulse.x+=P.x,this.m_impulse.y+=P.y;var D=Ct.MulSV(P.x,this.m_perp,i.SolveVelocityConstraints_s_P),R=P.x*this.m_s1+P.y,M=P.x*this.m_s2+P.y;n.SelfMulSub(s,D),r-=l*R,a.SelfMulAdd(c,D),o+=h*M}e.velocities[this.m_indexA].w=r,e.velocities[this.m_indexB].w=o},r.SolvePositionConstraints=function(t){var e=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(n),s=this.m_qB.SetAngle(a),c=this.m_invMassA,l=this.m_invMassB,h=this.m_invIA,f=this.m_invIB,d=Pt.MulRV(o,this.m_lalcA,this.m_rA),p=Pt.MulRV(s,this.m_lalcB,this.m_rB),m=Ct.SubVV(Ct.AddVV(r,p,Ct.s_t0),Ct.AddVV(e,d,Ct.s_t1),i.SolvePositionConstraints_s_d),g=Pt.MulRV(o,this.m_localXAxisA,this.m_axis),y=Ct.CrossVV(Ct.AddVV(m,d,Ct.s_t0),g),x=Ct.CrossVV(p,g),S=Pt.MulRV(o,this.m_localYAxisA,this.m_perp),A=Ct.CrossVV(Ct.AddVV(m,d,Ct.s_t0),S),b=Ct.CrossVV(p,S),C=i.SolvePositionConstraints_s_impulse,T=Ct.DotVV(S,m),E=a-n-this.m_referenceAngle,w=et(T),I=et(E),P=!1,D=0;if(this.m_enableLimit){var R=Ct.DotVV(g,m);et(this.m_upperTranslation-this.m_lowerTranslation)<2*u?(D=at(R,-v,v),w=rt(w,et(R)),P=!0):R<=this.m_lowerTranslation?(D=at(R-this.m_lowerTranslation+u,-v,0),w=rt(w,this.m_lowerTranslation-R),P=!0):R>=this.m_upperTranslation&&(D=at(R-this.m_upperTranslation-u,0,v),w=rt(w,R-this.m_upperTranslation),P=!0)}if(P){var M=c+l+h*A*A+f*b*b,O=h*A+f*b,N=h*A*y+f*b*x,B=h+f;0===B&&(B=1);var L=h*y+f*x,F=c+l+h*y*y+f*x*x,V=this.m_K3;V.ex.SetXYZ(M,O,N),V.ey.SetXYZ(O,B,L),V.ez.SetXYZ(N,L,F),C=V.Solve33(-T,-E,-D,C)}else{var z=c+l+h*A*A+f*b*b,k=h*A+f*b,U=h+f;0===U&&(U=1);var G=this.m_K2;G.ex.Set(z,k),G.ey.Set(k,U);var H=G.Solve(-T,-E,i.SolvePositionConstraints_s_impulse1);C.x=H.x,C.y=H.y,C.z=0}var j=Ct.AddVV(Ct.MulSV(C.x,S,Ct.s_t0),Ct.MulSV(C.z,g,Ct.s_t1),i.SolvePositionConstraints_s_P),W=C.x*A+C.y+C.z*y,q=C.x*b+C.y+C.z*x;return e.SelfMulSub(c,j),n-=h*W,r.SelfMulAdd(l,j),a+=f*q,t.positions[this.m_indexA].a=n,t.positions[this.m_indexB].a=a,w<=u&&I<=_},r.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},r.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},r.GetReactionForce=function(t,e){return e.x=t*(this.m_impulse.x*this.m_perp.x+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.x),e.y=t*(this.m_impulse.x*this.m_perp.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_axis.y),e},r.GetReactionTorque=function(t){return t*this.m_impulse.y},r.GetLocalAnchorA=function(){return this.m_localAnchorA},r.GetLocalAnchorB=function(){return this.m_localAnchorB},r.GetLocalAxisA=function(){return this.m_localXAxisA},r.GetReferenceAngle=function(){return this.m_referenceAngle},r.GetJointTranslation=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,i.GetJointTranslation_s_pA),e=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,i.GetJointTranslation_s_pB),n=Ct.SubVV(e,t,i.GetJointTranslation_s_d),r=this.m_bodyA.GetWorldVector(this.m_localXAxisA,i.GetJointTranslation_s_axis);return Ct.DotVV(n,r)},r.GetJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB;Ct.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var n=Pt.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);Ct.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var i=Pt.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),r=Ct.AddVV(t.m_sweep.c,n,Ct.s_t0),a=Ct.AddVV(e.m_sweep.c,i,Ct.s_t1),o=Ct.SubVV(a,r,Ct.s_t2),s=t.GetWorldVector(this.m_localXAxisA,this.m_axis),c=t.m_linearVelocity,l=e.m_linearVelocity,h=t.m_angularVelocity,u=e.m_angularVelocity;return Ct.DotVV(o,Ct.CrossSV(h,s,Ct.s_t0))+Ct.DotVV(s,Ct.SubVV(Ct.AddVCrossSV(l,u,i,Ct.s_t0),Ct.AddVCrossSV(c,h,n,Ct.s_t1),Ct.s_t0))},r.IsLimitEnabled=function(){return this.m_enableLimit},r.EnableLimit=function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},r.GetLowerLimit=function(){return this.m_lowerTranslation},r.GetUpperLimit=function(){return this.m_upperTranslation},r.SetLimits=function(t,e){t===this.m_lowerTranslation&&e===this.m_upperTranslation||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)},r.IsMotorEnabled=function(){return this.m_enableMotor},r.EnableMotor=function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)},r.SetMotorSpeed=function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)},r.GetMotorSpeed=function(){return this.m_motorSpeed},r.SetMaxMotorForce=function(t){t!==this.m_maxMotorForce&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorForce=t)},r.GetMaxMotorForce=function(){return this.m_maxMotorForce},r.GetMotorForce=function(t){return t*this.m_motorImpulse},r.Dump=function(t){var e=this.m_bodyA.m_islandIndex,n=this.m_bodyB.m_islandIndex;t("  const jd: b2PrismaticJointDef = new b2PrismaticJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",n),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerTranslation = %.15f;\n",this.m_lowerTranslation),t("  jd.upperTranslation = %.15f;\n",this.m_upperTranslation),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorForce = %.15f;\n",this.m_maxMotorForce),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},i}(Ci);Vi.InitVelocityConstraints_s_d=new Ct,Vi.InitVelocityConstraints_s_P=new Ct,Vi.SolveVelocityConstraints_s_P=new Ct,Vi.SolveVelocityConstraints_s_f2r=new Ct,Vi.SolveVelocityConstraints_s_f1=new Et,Vi.SolveVelocityConstraints_s_df3=new Et,Vi.SolveVelocityConstraints_s_df2=new Ct,Vi.SolvePositionConstraints_s_d=new Ct,Vi.SolvePositionConstraints_s_impulse=new Et,Vi.SolvePositionConstraints_s_impulse1=new Ct,Vi.SolvePositionConstraints_s_P=new Ct,Vi.GetJointTranslation_s_pA=new Ct,Vi.GetJointTranslation_s_pB=new Ct,Vi.GetJointTranslation_s_d=new Ct,Vi.GetJointTranslation_s_axis=new Ct;var zi=2,ki=function(e){function n(){var n;return(n=e.call(this,t.b2JointType.e_pulleyJoint)||this).groundAnchorA=new Ct(-1,1),n.groundAnchorB=new Ct(1,1),n.localAnchorA=new Ct(-1,0),n.localAnchorB=new Ct(1,0),n.lengthA=0,n.lengthB=0,n.ratio=1,n.collideConnected=!0,n}return $(n,e),n.prototype.Initialize=function(t,e,n,i,r,a,o){this.bodyA=t,this.bodyB=e,this.groundAnchorA.Copy(n),this.groundAnchorB.Copy(i),this.bodyA.GetLocalPoint(r,this.localAnchorA),this.bodyB.GetLocalPoint(a,this.localAnchorB),this.lengthA=Ct.DistanceVV(r,n),this.lengthB=Ct.DistanceVV(a,i),this.ratio=o},n}(bi),Ui=function(t){function e(e){var i;return(i=t.call(this,e)||this).m_groundAnchorA=new Ct,i.m_groundAnchorB=new Ct,i.m_lengthA=0,i.m_lengthB=0,i.m_localAnchorA=new Ct,i.m_localAnchorB=new Ct,i.m_constant=0,i.m_ratio=0,i.m_impulse=0,i.m_indexA=0,i.m_indexB=0,i.m_uA=new Ct,i.m_uB=new Ct,i.m_rA=new Ct,i.m_rB=new Ct,i.m_localCenterA=new Ct,i.m_localCenterB=new Ct,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_mass=0,i.m_qA=new Pt,i.m_qB=new Pt,i.m_lalcA=new Ct,i.m_lalcB=new Ct,i.m_groundAnchorA.Copy(n(e.groundAnchorA,new Ct(-1,1))),i.m_groundAnchorB.Copy(n(e.groundAnchorB,new Ct(1,0))),i.m_localAnchorA.Copy(n(e.localAnchorA,new Ct(-1,0))),i.m_localAnchorB.Copy(n(e.localAnchorB,new Ct(1,0))),i.m_lengthA=n(e.lengthA,0),i.m_lengthB=n(e.lengthB,0),i.m_ratio=n(e.ratio,1),i.m_constant=n(e.lengthA,0)+i.m_ratio*n(e.lengthB,0),i.m_impulse=0,i}$(e,t);var i=e.prototype;return i.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var n=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.velocities[this.m_indexA].v,a=t.velocities[this.m_indexA].w,o=t.positions[this.m_indexB].c,s=t.positions[this.m_indexB].a,c=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,h=this.m_qA.SetAngle(i),_=this.m_qB.SetAngle(s);Ct.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Pt.MulRV(h,this.m_lalcA,this.m_rA),Ct.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Pt.MulRV(_,this.m_lalcB,this.m_rB),this.m_uA.Copy(n).SelfAdd(this.m_rA).SelfSub(this.m_groundAnchorA),this.m_uB.Copy(o).SelfAdd(this.m_rB).SelfSub(this.m_groundAnchorB);var f=this.m_uA.Length(),d=this.m_uB.Length();f>10*u?this.m_uA.SelfMul(1/f):this.m_uA.SetZero(),d>10*u?this.m_uB.SelfMul(1/d):this.m_uB.SetZero();var p=Ct.CrossVV(this.m_rA,this.m_uA),m=Ct.CrossVV(this.m_rB,this.m_uB),v=this.m_invMassA+this.m_invIA*p*p,g=this.m_invMassB+this.m_invIB*m*m;if(this.m_mass=v+this.m_ratio*this.m_ratio*g,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.step.warmStarting){this.m_impulse*=t.step.dtRatio;var y=Ct.MulSV(-this.m_impulse,this.m_uA,e.InitVelocityConstraints_s_PA),x=Ct.MulSV(-this.m_ratio*this.m_impulse,this.m_uB,e.InitVelocityConstraints_s_PB);r.SelfMulAdd(this.m_invMassA,y),a+=this.m_invIA*Ct.CrossVV(this.m_rA,y),c.SelfMulAdd(this.m_invMassB,x),l+=this.m_invIB*Ct.CrossVV(this.m_rB,x)}else this.m_impulse=0;t.velocities[this.m_indexA].w=a,t.velocities[this.m_indexB].w=l},i.SolveVelocityConstraints=function(t){var n=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,o=Ct.AddVCrossSV(n,i,this.m_rA,e.SolveVelocityConstraints_s_vpA),s=Ct.AddVCrossSV(r,a,this.m_rB,e.SolveVelocityConstraints_s_vpB),c=-Ct.DotVV(this.m_uA,o)-this.m_ratio*Ct.DotVV(this.m_uB,s),l=-this.m_mass*c;this.m_impulse+=l;var h=Ct.MulSV(-l,this.m_uA,e.SolveVelocityConstraints_s_PA),u=Ct.MulSV(-this.m_ratio*l,this.m_uB,e.SolveVelocityConstraints_s_PB);n.SelfMulAdd(this.m_invMassA,h),i+=this.m_invIA*Ct.CrossVV(this.m_rA,h),r.SelfMulAdd(this.m_invMassB,u),a+=this.m_invIB*Ct.CrossVV(this.m_rB,u),t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=a},i.SolvePositionConstraints=function(t){var n=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),s=this.m_qB.SetAngle(a);Ct.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var c=Pt.MulRV(o,this.m_lalcA,this.m_rA);Ct.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var l=Pt.MulRV(s,this.m_lalcB,this.m_rB),h=this.m_uA.Copy(n).SelfAdd(c).SelfSub(this.m_groundAnchorA),_=this.m_uB.Copy(r).SelfAdd(l).SelfSub(this.m_groundAnchorB),f=h.Length(),d=_.Length();f>10*u?h.SelfMul(1/f):h.SetZero(),d>10*u?_.SelfMul(1/d):_.SetZero();var p=Ct.CrossVV(c,h),m=Ct.CrossVV(l,_),v=this.m_invMassA+this.m_invIA*p*p,g=this.m_invMassB+this.m_invIB*m*m,y=v+this.m_ratio*this.m_ratio*g;y>0&&(y=1/y);var x=this.m_constant-f-this.m_ratio*d,S=et(x),A=-y*x,b=Ct.MulSV(-A,h,e.SolvePositionConstraints_s_PA),C=Ct.MulSV(-this.m_ratio*A,_,e.SolvePositionConstraints_s_PB);return n.SelfMulAdd(this.m_invMassA,b),i+=this.m_invIA*Ct.CrossVV(c,b),r.SelfMulAdd(this.m_invMassB,C),a+=this.m_invIB*Ct.CrossVV(l,C),t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=a,S<u},i.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},i.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},i.GetReactionForce=function(t,e){return e.x=t*this.m_impulse*this.m_uB.x,e.y=t*this.m_impulse*this.m_uB.y,e},i.GetReactionTorque=function(){return 0},i.GetGroundAnchorA=function(){return this.m_groundAnchorA},i.GetGroundAnchorB=function(){return this.m_groundAnchorB},i.GetLengthA=function(){return this.m_lengthA},i.GetLengthB=function(){return this.m_lengthB},i.GetRatio=function(){return this.m_ratio},i.GetCurrentLengthA=function(){var t=this.m_bodyA.GetWorldPoint(this.m_localAnchorA,e.GetCurrentLengthA_s_p),n=this.m_groundAnchorA;return Ct.DistanceVV(t,n)},i.GetCurrentLengthB=function(){var t=this.m_bodyB.GetWorldPoint(this.m_localAnchorB,e.GetCurrentLengthB_s_p),n=this.m_groundAnchorB;return Ct.DistanceVV(t,n)},i.Dump=function(t){var e=this.m_bodyA.m_islandIndex,n=this.m_bodyB.m_islandIndex;t("  const jd: b2PulleyJointDef = new b2PulleyJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",n),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.groundAnchorA.Set(%.15f, %.15f);\n",this.m_groundAnchorA.x,this.m_groundAnchorA.y),t("  jd.groundAnchorB.Set(%.15f, %.15f);\n",this.m_groundAnchorB.x,this.m_groundAnchorB.y),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.lengthA = %.15f;\n",this.m_lengthA),t("  jd.lengthB = %.15f;\n",this.m_lengthB),t("  jd.ratio = %.15f;\n",this.m_ratio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},i.ShiftOrigin=function(t){this.m_groundAnchorA.SelfSub(t),this.m_groundAnchorB.SelfSub(t)},e}(Ci);Ui.InitVelocityConstraints_s_PA=new Ct,Ui.InitVelocityConstraints_s_PB=new Ct,Ui.SolveVelocityConstraints_s_vpA=new Ct,Ui.SolveVelocityConstraints_s_vpB=new Ct,Ui.SolveVelocityConstraints_s_PA=new Ct,Ui.SolveVelocityConstraints_s_PB=new Ct,Ui.SolvePositionConstraints_s_PA=new Ct,Ui.SolvePositionConstraints_s_PB=new Ct,Ui.GetCurrentLengthA_s_p=new Ct,Ui.GetCurrentLengthB_s_p=new Ct;var Gi=function(e){function n(){var n;return(n=e.call(this,t.b2JointType.e_revoluteJoint)||this).localAnchorA=new Ct(0,0),n.localAnchorB=new Ct(0,0),n.referenceAngle=0,n.enableLimit=!1,n.lowerAngle=0,n.upperAngle=0,n.enableMotor=!1,n.motorSpeed=0,n.maxMotorTorque=0,n}return $(n,e),n.prototype.Initialize=function(t,e,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},n}(bi),Hi=function(e){function i(i){var r;return(r=e.call(this,i)||this).m_localAnchorA=new Ct,r.m_localAnchorB=new Ct,r.m_impulse=new Et,r.m_motorImpulse=0,r.m_enableMotor=!1,r.m_maxMotorTorque=0,r.m_motorSpeed=0,r.m_enableLimit=!1,r.m_referenceAngle=0,r.m_lowerAngle=0,r.m_upperAngle=0,r.m_indexA=0,r.m_indexB=0,r.m_rA=new Ct,r.m_rB=new Ct,r.m_localCenterA=new Ct,r.m_localCenterB=new Ct,r.m_invMassA=0,r.m_invMassB=0,r.m_invIA=0,r.m_invIB=0,r.m_mass=new It,r.m_motorMass=0,r.m_limitState=t.b2LimitState.e_inactiveLimit,r.m_qA=new Pt,r.m_qB=new Pt,r.m_lalcA=new Ct,r.m_lalcB=new Ct,r.m_K=new wt,r.m_localAnchorA.Copy(n(i.localAnchorA,Ct.ZERO)),r.m_localAnchorB.Copy(n(i.localAnchorB,Ct.ZERO)),r.m_referenceAngle=n(i.referenceAngle,0),r.m_impulse.SetZero(),r.m_motorImpulse=0,r.m_lowerAngle=n(i.lowerAngle,0),r.m_upperAngle=n(i.upperAngle,0),r.m_maxMotorTorque=n(i.maxMotorTorque,0),r.m_motorSpeed=n(i.motorSpeed,0),r.m_enableLimit=n(i.enableLimit,!1),r.m_enableMotor=n(i.enableMotor,!1),r.m_limitState=t.b2LimitState.e_inactiveLimit,r}$(i,e);var r=i.prototype;return r.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var n=e.positions[this.m_indexA].a,r=e.velocities[this.m_indexA].v,a=e.velocities[this.m_indexA].w,o=e.positions[this.m_indexB].a,s=e.velocities[this.m_indexB].v,c=e.velocities[this.m_indexB].w,l=this.m_qA.SetAngle(n),h=this.m_qB.SetAngle(o);Ct.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Pt.MulRV(l,this.m_lalcA,this.m_rA),Ct.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Pt.MulRV(h,this.m_lalcB,this.m_rB);var u=this.m_invMassA,f=this.m_invMassB,d=this.m_invIA,p=this.m_invIB,m=d+p===0;if(this.m_mass.ex.x=u+f+this.m_rA.y*this.m_rA.y*d+this.m_rB.y*this.m_rB.y*p,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*d-this.m_rB.y*this.m_rB.x*p,this.m_mass.ez.x=-this.m_rA.y*d-this.m_rB.y*p,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=u+f+this.m_rA.x*this.m_rA.x*d+this.m_rB.x*this.m_rB.x*p,this.m_mass.ez.y=this.m_rA.x*d+this.m_rB.x*p,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=d+p,this.m_motorMass=d+p,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),this.m_enableMotor&&!m||(this.m_motorImpulse=0),this.m_enableLimit&&!m){var v=o-n-this.m_referenceAngle;et(this.m_upperAngle-this.m_lowerAngle)<2*_?this.m_limitState=t.b2LimitState.e_equalLimits:v<=this.m_lowerAngle?(this.m_limitState!==t.b2LimitState.e_atLowerLimit&&(this.m_impulse.z=0),this.m_limitState=t.b2LimitState.e_atLowerLimit):v>=this.m_upperAngle?(this.m_limitState!==t.b2LimitState.e_atUpperLimit&&(this.m_impulse.z=0),this.m_limitState=t.b2LimitState.e_atUpperLimit):(this.m_limitState=t.b2LimitState.e_inactiveLimit,this.m_impulse.z=0)}else this.m_limitState=t.b2LimitState.e_inactiveLimit;if(e.step.warmStarting){this.m_impulse.SelfMul(e.step.dtRatio),this.m_motorImpulse*=e.step.dtRatio;var g=i.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);r.SelfMulSub(u,g),a-=d*(Ct.CrossVV(this.m_rA,g)+this.m_motorImpulse+this.m_impulse.z),s.SelfMulAdd(f,g),c+=p*(Ct.CrossVV(this.m_rB,g)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.SetZero(),this.m_motorImpulse=0;e.velocities[this.m_indexA].w=a,e.velocities[this.m_indexB].w=c},r.SolveVelocityConstraints=function(e){var n=e.velocities[this.m_indexA].v,r=e.velocities[this.m_indexA].w,a=e.velocities[this.m_indexB].v,o=e.velocities[this.m_indexB].w,s=this.m_invMassA,c=this.m_invMassB,l=this.m_invIA,h=this.m_invIB,u=l+h===0;if(this.m_enableMotor&&this.m_limitState!==t.b2LimitState.e_equalLimits&&!u){var _=o-r-this.m_motorSpeed,f=-this.m_motorMass*_,d=this.m_motorImpulse,p=e.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=at(this.m_motorImpulse+f,-p,p),r-=l*(f=this.m_motorImpulse-d),o+=h*f}if(this.m_enableLimit&&this.m_limitState!==t.b2LimitState.e_inactiveLimit&&!u){var m=Ct.SubVV(Ct.AddVCrossSV(a,o,this.m_rB,Ct.s_t0),Ct.AddVCrossSV(n,r,this.m_rA,Ct.s_t1),i.SolveVelocityConstraints_s_Cdot1),v=o-r,g=this.m_mass.Solve33(m.x,m.y,v,i.SolveVelocityConstraints_s_impulse_v3).SelfNeg();if(this.m_limitState===t.b2LimitState.e_equalLimits)this.m_impulse.SelfAdd(g);else if(this.m_limitState===t.b2LimitState.e_atLowerLimit)if(this.m_impulse.z+g.z<0){var y=-m.x+this.m_impulse.z*this.m_mass.ez.x,x=-m.y+this.m_impulse.z*this.m_mass.ez.y,S=this.m_mass.Solve22(y,x,i.SolveVelocityConstraints_s_reduced_v2);g.x=S.x,g.y=S.y,g.z=-this.m_impulse.z,this.m_impulse.x+=S.x,this.m_impulse.y+=S.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(g);else if(this.m_limitState===t.b2LimitState.e_atUpperLimit)if(this.m_impulse.z+g.z>0){var A=-m.x+this.m_impulse.z*this.m_mass.ez.x,b=-m.y+this.m_impulse.z*this.m_mass.ez.y,C=this.m_mass.Solve22(A,b,i.SolveVelocityConstraints_s_reduced_v2);g.x=C.x,g.y=C.y,g.z=-this.m_impulse.z,this.m_impulse.x+=C.x,this.m_impulse.y+=C.y,this.m_impulse.z=0}else this.m_impulse.SelfAdd(g);var T=i.SolveVelocityConstraints_s_P.Set(g.x,g.y);n.SelfMulSub(s,T),r-=l*(Ct.CrossVV(this.m_rA,T)+g.z),a.SelfMulAdd(c,T),o+=h*(Ct.CrossVV(this.m_rB,T)+g.z)}else{var E=Ct.SubVV(Ct.AddVCrossSV(a,o,this.m_rB,Ct.s_t0),Ct.AddVCrossSV(n,r,this.m_rA,Ct.s_t1),i.SolveVelocityConstraints_s_Cdot_v2),w=this.m_mass.Solve22(-E.x,-E.y,i.SolveVelocityConstraints_s_impulse_v2);this.m_impulse.x+=w.x,this.m_impulse.y+=w.y,n.SelfMulSub(s,w),r-=l*Ct.CrossVV(this.m_rA,w),a.SelfMulAdd(c,w),o+=h*Ct.CrossVV(this.m_rB,w)}e.velocities[this.m_indexA].w=r,e.velocities[this.m_indexB].w=o},r.SolvePositionConstraints=function(e){var n=e.positions[this.m_indexA].c,r=e.positions[this.m_indexA].a,a=e.positions[this.m_indexB].c,o=e.positions[this.m_indexB].a,s=this.m_qA.SetAngle(r),c=this.m_qB.SetAngle(o),l=0,h=0,f=this.m_invIA+this.m_invIB===0;if(this.m_enableLimit&&this.m_limitState!==t.b2LimitState.e_inactiveLimit&&!f){var d=o-r-this.m_referenceAngle,p=0;if(this.m_limitState===t.b2LimitState.e_equalLimits){var m=at(d-this.m_lowerAngle,-g,g);p=-this.m_motorMass*m,l=et(m)}else if(this.m_limitState===t.b2LimitState.e_atLowerLimit){var v=d-this.m_lowerAngle;l=-v,v=at(v+_,-g,0),p=-this.m_motorMass*v}else if(this.m_limitState===t.b2LimitState.e_atUpperLimit){var y=d-this.m_upperAngle;l=y,y=at(y-_,0,g),p=-this.m_motorMass*y}r-=this.m_invIA*p,o+=this.m_invIB*p}s.SetAngle(r),c.SetAngle(o),Ct.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var x=Pt.MulRV(s,this.m_lalcA,this.m_rA);Ct.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var S=Pt.MulRV(c,this.m_lalcB,this.m_rB),A=Ct.SubVV(Ct.AddVV(a,S,Ct.s_t0),Ct.AddVV(n,x,Ct.s_t1),i.SolvePositionConstraints_s_C_v2);h=A.Length();var b=this.m_invMassA,C=this.m_invMassB,T=this.m_invIA,E=this.m_invIB,w=this.m_K;w.ex.x=b+C+T*x.y*x.y+E*S.y*S.y,w.ex.y=-T*x.x*x.y-E*S.x*S.y,w.ey.x=w.ex.y,w.ey.y=b+C+T*x.x*x.x+E*S.x*S.x;var I=w.Solve(A.x,A.y,i.SolvePositionConstraints_s_impulse).SelfNeg();return n.SelfMulSub(b,I),r-=T*Ct.CrossVV(x,I),a.SelfMulAdd(C,I),o+=E*Ct.CrossVV(S,I),e.positions[this.m_indexA].a=r,e.positions[this.m_indexB].a=o,h<=u&&l<=_},r.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},r.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},r.GetReactionForce=function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e},r.GetReactionTorque=function(t){return t*this.m_impulse.z},r.GetLocalAnchorA=function(){return this.m_localAnchorA},r.GetLocalAnchorB=function(){return this.m_localAnchorB},r.GetReferenceAngle=function(){return this.m_referenceAngle},r.GetJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a-this.m_referenceAngle},r.GetJointSpeed=function(){return this.m_bodyB.m_angularVelocity-this.m_bodyA.m_angularVelocity},r.IsMotorEnabled=function(){return this.m_enableMotor},r.EnableMotor=function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)},r.GetMotorTorque=function(t){return t*this.m_motorImpulse},r.GetMotorSpeed=function(){return this.m_motorSpeed},r.SetMaxMotorTorque=function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)},r.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},r.IsLimitEnabled=function(){return this.m_enableLimit},r.EnableLimit=function(t){t!==this.m_enableLimit&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)},r.GetLowerLimit=function(){return this.m_lowerAngle},r.GetUpperLimit=function(){return this.m_upperAngle},r.SetLimits=function(t,e){t===this.m_lowerAngle&&e===this.m_upperAngle||(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)},r.SetMotorSpeed=function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)},r.Dump=function(t){var e=this.m_bodyA.m_islandIndex,n=this.m_bodyB.m_islandIndex;t("  const jd: b2RevoluteJointDef = new b2RevoluteJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",n),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.enableLimit = %s;\n",this.m_enableLimit?"true":"false"),t("  jd.lowerAngle = %.15f;\n",this.m_lowerAngle),t("  jd.upperAngle = %.15f;\n",this.m_upperAngle),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},i}(Ci);Hi.InitVelocityConstraints_s_P=new Ct,Hi.SolveVelocityConstraints_s_P=new Ct,Hi.SolveVelocityConstraints_s_Cdot_v2=new Ct,Hi.SolveVelocityConstraints_s_Cdot1=new Ct,Hi.SolveVelocityConstraints_s_impulse_v3=new Et,Hi.SolveVelocityConstraints_s_reduced_v2=new Ct,Hi.SolveVelocityConstraints_s_impulse_v2=new Ct,Hi.SolvePositionConstraints_s_C_v2=new Ct,Hi.SolvePositionConstraints_s_impulse=new Ct;var ji=function(e){function n(){var n;return(n=e.call(this,t.b2JointType.e_ropeJoint)||this).localAnchorA=new Ct(-1,0),n.localAnchorB=new Ct(1,0),n.maxLength=0,n}return $(n,e),n}(bi),Wi=function(e){function i(i){var r;return(r=e.call(this,i)||this).m_localAnchorA=new Ct,r.m_localAnchorB=new Ct,r.m_maxLength=0,r.m_length=0,r.m_impulse=0,r.m_indexA=0,r.m_indexB=0,r.m_u=new Ct,r.m_rA=new Ct,r.m_rB=new Ct,r.m_localCenterA=new Ct,r.m_localCenterB=new Ct,r.m_invMassA=0,r.m_invMassB=0,r.m_invIA=0,r.m_invIB=0,r.m_mass=0,r.m_state=t.b2LimitState.e_inactiveLimit,r.m_qA=new Pt,r.m_qB=new Pt,r.m_lalcA=new Ct,r.m_lalcB=new Ct,r.m_localAnchorA.Copy(n(i.localAnchorA,new Ct(-1,0))),r.m_localAnchorB.Copy(n(i.localAnchorB,new Ct(1,0))),r.m_maxLength=n(i.maxLength,0),r}$(i,e);var r=i.prototype;return r.InitVelocityConstraints=function(e){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var n=e.positions[this.m_indexA].c,r=e.positions[this.m_indexA].a,a=e.velocities[this.m_indexA].v,o=e.velocities[this.m_indexA].w,s=e.positions[this.m_indexB].c,c=e.positions[this.m_indexB].a,l=e.velocities[this.m_indexB].v,h=e.velocities[this.m_indexB].w,_=this.m_qA.SetAngle(r),f=this.m_qB.SetAngle(c);Ct.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Pt.MulRV(_,this.m_lalcA,this.m_rA),Ct.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Pt.MulRV(f,this.m_lalcB,this.m_rB),this.m_u.Copy(s).SelfAdd(this.m_rB).SelfSub(n).SelfSub(this.m_rA),this.m_length=this.m_u.Length();var d=this.m_length-this.m_maxLength;if(this.m_state=d>0?t.b2LimitState.e_atUpperLimit:t.b2LimitState.e_inactiveLimit,!(this.m_length>u))return this.m_u.SetZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.SelfMul(1/this.m_length);var p=Ct.CrossVV(this.m_rA,this.m_u),m=Ct.CrossVV(this.m_rB,this.m_u),v=this.m_invMassA+this.m_invIA*p*p+this.m_invMassB+this.m_invIB*m*m;if(this.m_mass=0!==v?1/v:0,e.step.warmStarting){this.m_impulse*=e.step.dtRatio;var g=Ct.MulSV(this.m_impulse,this.m_u,i.InitVelocityConstraints_s_P);a.SelfMulSub(this.m_invMassA,g),o-=this.m_invIA*Ct.CrossVV(this.m_rA,g),l.SelfMulAdd(this.m_invMassB,g),h+=this.m_invIB*Ct.CrossVV(this.m_rB,g)}else this.m_impulse=0;e.velocities[this.m_indexA].w=o,e.velocities[this.m_indexB].w=h},r.SolveVelocityConstraints=function(t){var e=t.velocities[this.m_indexA].v,n=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,o=Ct.AddVCrossSV(e,n,this.m_rA,i.SolveVelocityConstraints_s_vpA),s=Ct.AddVCrossSV(r,a,this.m_rB,i.SolveVelocityConstraints_s_vpB),c=this.m_length-this.m_maxLength,l=Ct.DotVV(this.m_u,Ct.SubVV(s,o,Ct.s_t0));c<0&&(l+=t.step.inv_dt*c);var h=-this.m_mass*l,u=this.m_impulse;this.m_impulse=nt(0,this.m_impulse+h),h=this.m_impulse-u;var _=Ct.MulSV(h,this.m_u,i.SolveVelocityConstraints_s_P);e.SelfMulSub(this.m_invMassA,_),n-=this.m_invIA*Ct.CrossVV(this.m_rA,_),r.SelfMulAdd(this.m_invMassB,_),a+=this.m_invIB*Ct.CrossVV(this.m_rB,_),t.velocities[this.m_indexA].w=n,t.velocities[this.m_indexB].w=a},r.SolvePositionConstraints=function(t){var e=t.positions[this.m_indexA].c,n=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(n),s=this.m_qB.SetAngle(a);Ct.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var c=Pt.MulRV(o,this.m_lalcA,this.m_rA);Ct.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var l=Pt.MulRV(s,this.m_lalcB,this.m_rB),h=this.m_u.Copy(r).SelfAdd(l).SelfSub(e).SelfSub(c),_=h.Normalize(),f=_-this.m_maxLength;f=at(f,0,v);var d=-this.m_mass*f,p=Ct.MulSV(d,h,i.SolvePositionConstraints_s_P);return e.SelfMulSub(this.m_invMassA,p),n-=this.m_invIA*Ct.CrossVV(c,p),r.SelfMulAdd(this.m_invMassB,p),a+=this.m_invIB*Ct.CrossVV(l,p),t.positions[this.m_indexA].a=n,t.positions[this.m_indexB].a=a,_-this.m_maxLength<u},r.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},r.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},r.GetReactionForce=function(t,e){return Ct.MulSV(t*this.m_impulse,this.m_u,e)},r.GetReactionTorque=function(){return 0},r.GetLocalAnchorA=function(){return this.m_localAnchorA},r.GetLocalAnchorB=function(){return this.m_localAnchorB},r.SetMaxLength=function(t){this.m_maxLength=t},r.GetMaxLength=function(){return this.m_maxLength},r.GetLimitState=function(){return this.m_state},r.Dump=function(t){var e=this.m_bodyA.m_islandIndex,n=this.m_bodyB.m_islandIndex;t("  const jd: b2RopeJointDef = new b2RopeJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",n),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.maxLength = %.15f;\n",this.m_maxLength),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},i}(Ci);Wi.InitVelocityConstraints_s_P=new Ct,Wi.SolveVelocityConstraints_s_vpA=new Ct,Wi.SolveVelocityConstraints_s_vpB=new Ct,Wi.SolveVelocityConstraints_s_P=new Ct,Wi.SolvePositionConstraints_s_P=new Ct;var qi=function(e){function n(){var n;return(n=e.call(this,t.b2JointType.e_weldJoint)||this).localAnchorA=new Ct,n.localAnchorB=new Ct,n.referenceAngle=0,n.frequencyHz=0,n.dampingRatio=0,n}return $(n,e),n.prototype.Initialize=function(t,e,n){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB),this.referenceAngle=this.bodyB.GetAngle()-this.bodyA.GetAngle()},n}(bi),Xi=function(t){function e(e){var i;return(i=t.call(this,e)||this).m_frequencyHz=0,i.m_dampingRatio=0,i.m_bias=0,i.m_localAnchorA=new Ct,i.m_localAnchorB=new Ct,i.m_referenceAngle=0,i.m_gamma=0,i.m_impulse=new Et(0,0,0),i.m_indexA=0,i.m_indexB=0,i.m_rA=new Ct,i.m_rB=new Ct,i.m_localCenterA=new Ct,i.m_localCenterB=new Ct,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_mass=new It,i.m_qA=new Pt,i.m_qB=new Pt,i.m_lalcA=new Ct,i.m_lalcB=new Ct,i.m_K=new It,i.m_frequencyHz=n(e.frequencyHz,0),i.m_dampingRatio=n(e.dampingRatio,0),i.m_localAnchorA.Copy(n(e.localAnchorA,Ct.ZERO)),i.m_localAnchorB.Copy(n(e.localAnchorB,Ct.ZERO)),i.m_referenceAngle=n(e.referenceAngle,0),i.m_impulse.SetZero(),i}$(e,t);var i=e.prototype;return i.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var n=t.positions[this.m_indexA].a,i=t.velocities[this.m_indexA].v,r=t.velocities[this.m_indexA].w,a=t.positions[this.m_indexB].a,s=t.velocities[this.m_indexB].v,c=t.velocities[this.m_indexB].w,l=this.m_qA.SetAngle(n),h=this.m_qB.SetAngle(a);Ct.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA),Pt.MulRV(l,this.m_lalcA,this.m_rA),Ct.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB),Pt.MulRV(h,this.m_lalcB,this.m_rB);var u=this.m_invMassA,_=this.m_invMassB,f=this.m_invIA,d=this.m_invIB,p=this.m_K;if(p.ex.x=u+_+this.m_rA.y*this.m_rA.y*f+this.m_rB.y*this.m_rB.y*d,p.ey.x=-this.m_rA.y*this.m_rA.x*f-this.m_rB.y*this.m_rB.x*d,p.ez.x=-this.m_rA.y*f-this.m_rB.y*d,p.ex.y=p.ey.x,p.ey.y=u+_+this.m_rA.x*this.m_rA.x*f+this.m_rB.x*this.m_rB.x*d,p.ez.y=this.m_rA.x*f+this.m_rB.x*d,p.ex.z=p.ez.x,p.ey.z=p.ez.y,p.ez.z=f+d,this.m_frequencyHz>0){p.GetInverse22(this.m_mass);var m=f+d,v=m>0?1/m:0,g=a-n-this.m_referenceAngle,y=2*o*this.m_frequencyHz,x=2*v*this.m_dampingRatio*y,S=v*y*y,A=t.step.dt;this.m_gamma=A*(x+A*S),this.m_gamma=0!==this.m_gamma?1/this.m_gamma:0,this.m_bias=g*A*S*this.m_gamma,m+=this.m_gamma,this.m_mass.ez.z=0!==m?1/m:0}else p.GetSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0;if(t.step.warmStarting){this.m_impulse.SelfMul(t.step.dtRatio);var b=e.InitVelocityConstraints_s_P.Set(this.m_impulse.x,this.m_impulse.y);i.SelfMulSub(u,b),r-=f*(Ct.CrossVV(this.m_rA,b)+this.m_impulse.z),s.SelfMulAdd(_,b),c+=d*(Ct.CrossVV(this.m_rB,b)+this.m_impulse.z)}else this.m_impulse.SetZero();t.velocities[this.m_indexA].w=r,t.velocities[this.m_indexB].w=c},i.SolveVelocityConstraints=function(t){var n=t.velocities[this.m_indexA].v,i=t.velocities[this.m_indexA].w,r=t.velocities[this.m_indexB].v,a=t.velocities[this.m_indexB].w,o=this.m_invMassA,s=this.m_invMassB,c=this.m_invIA,l=this.m_invIB;if(this.m_frequencyHz>0){var h=a-i,u=-this.m_mass.ez.z*(h+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=u,i-=c*u,a+=l*u;var _=Ct.SubVV(Ct.AddVCrossSV(r,a,this.m_rB,Ct.s_t0),Ct.AddVCrossSV(n,i,this.m_rA,Ct.s_t1),e.SolveVelocityConstraints_s_Cdot1),f=It.MulM33XY(this.m_mass,_.x,_.y,e.SolveVelocityConstraints_s_impulse1).SelfNeg();this.m_impulse.x+=f.x,this.m_impulse.y+=f.y;var d=f;n.SelfMulSub(o,d),i-=c*Ct.CrossVV(this.m_rA,d),r.SelfMulAdd(s,d),a+=l*Ct.CrossVV(this.m_rB,d)}else{var p=Ct.SubVV(Ct.AddVCrossSV(r,a,this.m_rB,Ct.s_t0),Ct.AddVCrossSV(n,i,this.m_rA,Ct.s_t1),e.SolveVelocityConstraints_s_Cdot1),m=a-i,v=It.MulM33XYZ(this.m_mass,p.x,p.y,m,e.SolveVelocityConstraints_s_impulse).SelfNeg();this.m_impulse.SelfAdd(v);var g=e.SolveVelocityConstraints_s_P.Set(v.x,v.y);n.SelfMulSub(o,g),i-=c*(Ct.CrossVV(this.m_rA,g)+v.z),r.SelfMulAdd(s,g),a+=l*(Ct.CrossVV(this.m_rB,g)+v.z)}t.velocities[this.m_indexA].w=i,t.velocities[this.m_indexB].w=a},i.SolvePositionConstraints=function(t){var n=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),s=this.m_qB.SetAngle(a),c=this.m_invMassA,l=this.m_invMassB,h=this.m_invIA,f=this.m_invIB;Ct.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var d=Pt.MulRV(o,this.m_lalcA,this.m_rA);Ct.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var p,m,v=Pt.MulRV(s,this.m_lalcB,this.m_rB),g=this.m_K;if(g.ex.x=c+l+d.y*d.y*h+v.y*v.y*f,g.ey.x=-d.y*d.x*h-v.y*v.x*f,g.ez.x=-d.y*h-v.y*f,g.ex.y=g.ey.x,g.ey.y=c+l+d.x*d.x*h+v.x*v.x*f,g.ez.y=d.x*h+v.x*f,g.ex.z=g.ez.x,g.ey.z=g.ez.y,g.ez.z=h+f,this.m_frequencyHz>0){var y=Ct.SubVV(Ct.AddVV(r,v,Ct.s_t0),Ct.AddVV(n,d,Ct.s_t1),e.SolvePositionConstraints_s_C1);p=y.Length(),m=0;var x=g.Solve22(y.x,y.y,e.SolvePositionConstraints_s_P).SelfNeg();n.SelfMulSub(c,x),i-=h*Ct.CrossVV(d,x),r.SelfMulAdd(l,x),a+=f*Ct.CrossVV(v,x)}else{var S=Ct.SubVV(Ct.AddVV(r,v,Ct.s_t0),Ct.AddVV(n,d,Ct.s_t1),e.SolvePositionConstraints_s_C1),A=a-i-this.m_referenceAngle;p=S.Length(),m=et(A);var b=g.Solve33(S.x,S.y,A,e.SolvePositionConstraints_s_impulse).SelfNeg(),C=e.SolvePositionConstraints_s_P.Set(b.x,b.y);n.SelfMulSub(c,C),i-=h*(Ct.CrossVV(this.m_rA,C)+b.z),r.SelfMulAdd(l,C),a+=f*(Ct.CrossVV(this.m_rB,C)+b.z)}return t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=a,p<=u&&m<=_},i.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},i.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},i.GetReactionForce=function(t,e){return e.x=t*this.m_impulse.x,e.y=t*this.m_impulse.y,e},i.GetReactionTorque=function(t){return t*this.m_impulse.z},i.GetLocalAnchorA=function(){return this.m_localAnchorA},i.GetLocalAnchorB=function(){return this.m_localAnchorB},i.GetReferenceAngle=function(){return this.m_referenceAngle},i.SetFrequency=function(t){this.m_frequencyHz=t},i.GetFrequency=function(){return this.m_frequencyHz},i.SetDampingRatio=function(t){this.m_dampingRatio=t},i.GetDampingRatio=function(){return this.m_dampingRatio},i.Dump=function(t){var e=this.m_bodyA.m_islandIndex,n=this.m_bodyB.m_islandIndex;t("  const jd: b2WeldJointDef = new b2WeldJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",n),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.referenceAngle = %.15f;\n",this.m_referenceAngle),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},e}(Ci);Xi.InitVelocityConstraints_s_P=new Ct,Xi.SolveVelocityConstraints_s_Cdot1=new Ct,Xi.SolveVelocityConstraints_s_impulse1=new Ct,Xi.SolveVelocityConstraints_s_impulse=new Et,Xi.SolveVelocityConstraints_s_P=new Ct,Xi.SolvePositionConstraints_s_C1=new Ct,Xi.SolvePositionConstraints_s_P=new Ct,Xi.SolvePositionConstraints_s_impulse=new Et;var Yi=function(e){function n(){var n;return(n=e.call(this,t.b2JointType.e_wheelJoint)||this).localAnchorA=new Ct(0,0),n.localAnchorB=new Ct(0,0),n.localAxisA=new Ct(1,0),n.enableMotor=!1,n.maxMotorTorque=0,n.motorSpeed=0,n.frequencyHz=2,n.dampingRatio=.7,n}return $(n,e),n.prototype.Initialize=function(t,e,n,i){this.bodyA=t,this.bodyB=e,this.bodyA.GetLocalPoint(n,this.localAnchorA),this.bodyB.GetLocalPoint(n,this.localAnchorB),this.bodyA.GetLocalVector(i,this.localAxisA)},n}(bi),Ki=function(t){function e(e){var i;return(i=t.call(this,e)||this).m_frequencyHz=0,i.m_dampingRatio=0,i.m_localAnchorA=new Ct,i.m_localAnchorB=new Ct,i.m_localXAxisA=new Ct,i.m_localYAxisA=new Ct,i.m_impulse=0,i.m_motorImpulse=0,i.m_springImpulse=0,i.m_maxMotorTorque=0,i.m_motorSpeed=0,i.m_enableMotor=!1,i.m_indexA=0,i.m_indexB=0,i.m_localCenterA=new Ct,i.m_localCenterB=new Ct,i.m_invMassA=0,i.m_invMassB=0,i.m_invIA=0,i.m_invIB=0,i.m_ax=new Ct,i.m_ay=new Ct,i.m_sAx=0,i.m_sBx=0,i.m_sAy=0,i.m_sBy=0,i.m_mass=0,i.m_motorMass=0,i.m_springMass=0,i.m_bias=0,i.m_gamma=0,i.m_qA=new Pt,i.m_qB=new Pt,i.m_lalcA=new Ct,i.m_lalcB=new Ct,i.m_rA=new Ct,i.m_rB=new Ct,i.m_frequencyHz=n(e.frequencyHz,2),i.m_dampingRatio=n(e.dampingRatio,.7),i.m_localAnchorA.Copy(n(e.localAnchorA,Ct.ZERO)),i.m_localAnchorB.Copy(n(e.localAnchorB,Ct.ZERO)),i.m_localXAxisA.Copy(n(e.localAxisA,Ct.UNITX)),Ct.CrossOneV(i.m_localXAxisA,i.m_localYAxisA),i.m_maxMotorTorque=n(e.maxMotorTorque,0),i.m_motorSpeed=n(e.motorSpeed,0),i.m_enableMotor=n(e.enableMotor,!1),i.m_ax.SetZero(),i.m_ay.SetZero(),i}$(e,t);var i=e.prototype;return i.GetMotorSpeed=function(){return this.m_motorSpeed},i.GetMaxMotorTorque=function(){return this.m_maxMotorTorque},i.SetSpringFrequencyHz=function(t){this.m_frequencyHz=t},i.GetSpringFrequencyHz=function(){return this.m_frequencyHz},i.SetSpringDampingRatio=function(t){this.m_dampingRatio=t},i.GetSpringDampingRatio=function(){return this.m_dampingRatio},i.InitVelocityConstraints=function(t){this.m_indexA=this.m_bodyA.m_islandIndex,this.m_indexB=this.m_bodyB.m_islandIndex,this.m_localCenterA.Copy(this.m_bodyA.m_sweep.localCenter),this.m_localCenterB.Copy(this.m_bodyB.m_sweep.localCenter),this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;var n=this.m_invMassA,i=this.m_invMassB,r=this.m_invIA,a=this.m_invIB,s=t.positions[this.m_indexA].c,c=t.positions[this.m_indexA].a,l=t.velocities[this.m_indexA].v,h=t.velocities[this.m_indexA].w,u=t.positions[this.m_indexB].c,_=t.positions[this.m_indexB].a,f=t.velocities[this.m_indexB].v,d=t.velocities[this.m_indexB].w,p=this.m_qA.SetAngle(c),m=this.m_qB.SetAngle(_);Ct.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var v=Pt.MulRV(p,this.m_lalcA,this.m_rA);Ct.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var g=Pt.MulRV(m,this.m_lalcB,this.m_rB),y=Ct.SubVV(Ct.AddVV(u,g,Ct.s_t0),Ct.AddVV(s,v,Ct.s_t1),e.InitVelocityConstraints_s_d);if(Pt.MulRV(p,this.m_localYAxisA,this.m_ay),this.m_sAy=Ct.CrossVV(Ct.AddVV(y,v,Ct.s_t0),this.m_ay),this.m_sBy=Ct.CrossVV(g,this.m_ay),this.m_mass=n+i+r*this.m_sAy*this.m_sAy+a*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){Pt.MulRV(p,this.m_localXAxisA,this.m_ax),this.m_sAx=Ct.CrossVV(Ct.AddVV(y,v,Ct.s_t0),this.m_ax),this.m_sBx=Ct.CrossVV(g,this.m_ax);var x=n+i+r*this.m_sAx*this.m_sAx+a*this.m_sBx*this.m_sBx;if(x>0){this.m_springMass=1/x;var S=Ct.DotVV(y,this.m_ax),A=2*o*this.m_frequencyHz,b=2*this.m_springMass*this.m_dampingRatio*A,C=this.m_springMass*A*A,T=t.step.dt;this.m_gamma=T*(b+T*C),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=S*T*C*this.m_gamma,this.m_springMass=x+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=r+a,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.step.warmStarting){this.m_impulse*=t.step.dtRatio,this.m_springImpulse*=t.step.dtRatio,this.m_motorImpulse*=t.step.dtRatio;var E=Ct.AddVV(Ct.MulSV(this.m_impulse,this.m_ay,Ct.s_t0),Ct.MulSV(this.m_springImpulse,this.m_ax,Ct.s_t1),e.InitVelocityConstraints_s_P),w=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,I=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;l.SelfMulSub(this.m_invMassA,E),h-=this.m_invIA*w,f.SelfMulAdd(this.m_invMassB,E),d+=this.m_invIB*I}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;t.velocities[this.m_indexA].w=h,t.velocities[this.m_indexB].w=d},i.SolveVelocityConstraints=function(t){var n=this.m_invMassA,i=this.m_invMassB,r=this.m_invIA,a=this.m_invIB,o=t.velocities[this.m_indexA].v,s=t.velocities[this.m_indexA].w,c=t.velocities[this.m_indexB].v,l=t.velocities[this.m_indexB].w,h=Ct.DotVV(this.m_ax,Ct.SubVV(c,o,Ct.s_t0))+this.m_sBx*l-this.m_sAx*s,u=-this.m_springMass*(h+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=u;var _=Ct.MulSV(u,this.m_ax,e.SolveVelocityConstraints_s_P),f=u*this.m_sAx,d=u*this.m_sBx;o.SelfMulSub(n,_),s-=r*f,c.SelfMulAdd(i,_);var p=(l+=a*d)-s-this.m_motorSpeed,m=-this.m_motorMass*p,v=this.m_motorImpulse,g=t.step.dt*this.m_maxMotorTorque;this.m_motorImpulse=at(this.m_motorImpulse+m,-g,g),s-=r*(m=this.m_motorImpulse-v),l+=a*m;var y=Ct.DotVV(this.m_ay,Ct.SubVV(c,o,Ct.s_t0))+this.m_sBy*l-this.m_sAy*s,x=-this.m_mass*y;this.m_impulse+=x;var S=Ct.MulSV(x,this.m_ay,e.SolveVelocityConstraints_s_P),A=x*this.m_sAy,b=x*this.m_sBy;o.SelfMulSub(n,S),s-=r*A,c.SelfMulAdd(i,S),l+=a*b,t.velocities[this.m_indexA].w=s,t.velocities[this.m_indexB].w=l},i.SolvePositionConstraints=function(t){var n=t.positions[this.m_indexA].c,i=t.positions[this.m_indexA].a,r=t.positions[this.m_indexB].c,a=t.positions[this.m_indexB].a,o=this.m_qA.SetAngle(i),s=this.m_qB.SetAngle(a);Ct.SubVV(this.m_localAnchorA,this.m_localCenterA,this.m_lalcA);var c=Pt.MulRV(o,this.m_lalcA,this.m_rA);Ct.SubVV(this.m_localAnchorB,this.m_localCenterB,this.m_lalcB);var l,h=Pt.MulRV(s,this.m_lalcB,this.m_rB),_=Ct.AddVV(Ct.SubVV(r,n,Ct.s_t0),Ct.SubVV(h,c,Ct.s_t1),e.SolvePositionConstraints_s_d),f=Pt.MulRV(o,this.m_localYAxisA,this.m_ay),d=Ct.CrossVV(Ct.AddVV(_,c,Ct.s_t0),f),p=Ct.CrossVV(h,f),m=Ct.DotVV(_,this.m_ay),v=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;l=0!==v?-m/v:0;var g=Ct.MulSV(l,f,e.SolvePositionConstraints_s_P),y=l*d,x=l*p;return n.SelfMulSub(this.m_invMassA,g),i-=this.m_invIA*y,r.SelfMulAdd(this.m_invMassB,g),a+=this.m_invIB*x,t.positions[this.m_indexA].a=i,t.positions[this.m_indexB].a=a,et(m)<=u},i.GetDefinition=function(t){return t},i.GetAnchorA=function(t){return this.m_bodyA.GetWorldPoint(this.m_localAnchorA,t)},i.GetAnchorB=function(t){return this.m_bodyB.GetWorldPoint(this.m_localAnchorB,t)},i.GetReactionForce=function(t,e){return e.x=t*(this.m_impulse*this.m_ay.x+this.m_springImpulse*this.m_ax.x),e.y=t*(this.m_impulse*this.m_ay.y+this.m_springImpulse*this.m_ax.y),e},i.GetReactionTorque=function(t){return t*this.m_motorImpulse},i.GetLocalAnchorA=function(){return this.m_localAnchorA},i.GetLocalAnchorB=function(){return this.m_localAnchorB},i.GetLocalAxisA=function(){return this.m_localXAxisA},i.GetJointTranslation=function(){return this.GetPrismaticJointTranslation()},i.GetJointLinearSpeed=function(){return this.GetPrismaticJointSpeed()},i.GetJointAngle=function(){return this.GetRevoluteJointAngle()},i.GetJointAngularSpeed=function(){return this.GetRevoluteJointSpeed()},i.GetPrismaticJointTranslation=function(){var t=this.m_bodyA,e=this.m_bodyB,n=t.GetWorldPoint(this.m_localAnchorA,new Ct),i=e.GetWorldPoint(this.m_localAnchorB,new Ct),r=Ct.SubVV(i,n,new Ct),a=t.GetWorldVector(this.m_localXAxisA,new Ct);return Ct.DotVV(r,a)},i.GetPrismaticJointSpeed=function(){var t=this.m_bodyA,e=this.m_bodyB;Ct.SubVV(this.m_localAnchorA,t.m_sweep.localCenter,this.m_lalcA);var n=Pt.MulRV(t.m_xf.q,this.m_lalcA,this.m_rA);Ct.SubVV(this.m_localAnchorB,e.m_sweep.localCenter,this.m_lalcB);var i=Pt.MulRV(e.m_xf.q,this.m_lalcB,this.m_rB),r=Ct.AddVV(t.m_sweep.c,n,Ct.s_t0),a=Ct.AddVV(e.m_sweep.c,i,Ct.s_t1),o=Ct.SubVV(a,r,Ct.s_t2),s=t.GetWorldVector(this.m_localXAxisA,new Ct),c=t.m_linearVelocity,l=e.m_linearVelocity,h=t.m_angularVelocity,u=e.m_angularVelocity;return Ct.DotVV(o,Ct.CrossSV(h,s,Ct.s_t0))+Ct.DotVV(s,Ct.SubVV(Ct.AddVCrossSV(l,u,i,Ct.s_t0),Ct.AddVCrossSV(c,h,n,Ct.s_t1),Ct.s_t0))},i.GetRevoluteJointAngle=function(){return this.m_bodyB.m_sweep.a-this.m_bodyA.m_sweep.a},i.GetRevoluteJointSpeed=function(){var t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t},i.IsMotorEnabled=function(){return this.m_enableMotor},i.EnableMotor=function(t){t!==this.m_enableMotor&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_enableMotor=t)},i.SetMotorSpeed=function(t){t!==this.m_motorSpeed&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_motorSpeed=t)},i.SetMaxMotorTorque=function(t){t!==this.m_maxMotorTorque&&(this.m_bodyA.SetAwake(!0),this.m_bodyB.SetAwake(!0),this.m_maxMotorTorque=t)},i.GetMotorTorque=function(t){return t*this.m_motorImpulse},i.Dump=function(t){var e=this.m_bodyA.m_islandIndex,n=this.m_bodyB.m_islandIndex;t("  const jd: b2WheelJointDef = new b2WheelJointDef();\n"),t("  jd.bodyA = bodies[%d];\n",e),t("  jd.bodyB = bodies[%d];\n",n),t("  jd.collideConnected = %s;\n",this.m_collideConnected?"true":"false"),t("  jd.localAnchorA.Set(%.15f, %.15f);\n",this.m_localAnchorA.x,this.m_localAnchorA.y),t("  jd.localAnchorB.Set(%.15f, %.15f);\n",this.m_localAnchorB.x,this.m_localAnchorB.y),t("  jd.localAxisA.Set(%.15f, %.15f);\n",this.m_localXAxisA.x,this.m_localXAxisA.y),t("  jd.enableMotor = %s;\n",this.m_enableMotor?"true":"false"),t("  jd.motorSpeed = %.15f;\n",this.m_motorSpeed),t("  jd.maxMotorTorque = %.15f;\n",this.m_maxMotorTorque),t("  jd.frequencyHz = %.15f;\n",this.m_frequencyHz),t("  jd.dampingRatio = %.15f;\n",this.m_dampingRatio),t("  joints[%d] = this.m_world.CreateJoint(jd);\n",this.m_index)},e}(Ci);function Ji(t,e){return ut(t*e)}function Qi(t,e){return t>e?t:e}Ki.InitVelocityConstraints_s_d=new Ct,Ki.InitVelocityConstraints_s_P=new Ct,Ki.SolveVelocityConstraints_s_P=new Ct,Ki.SolvePositionConstraints_s_d=new Ct,Ki.SolvePositionConstraints_s_P=new Ct;var Zi=function(){function t(t){this._other=null,this.prev=null,this.next=null,this.contact=t}return t.prototype.Reset=function(){this._other=null,this.prev=null,this.next=null},Q(t,[{key:"other",get:function(){if(null===this._other)throw new Error;return this._other},set:function(t){if(null!==this._other)throw new Error;this._other=t}}]),t}(),$i=function(){function t(){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_prev=null,this.m_next=null,this.m_nodeA=new Zi(this),this.m_nodeB=new Zi(this),this.m_indexA=0,this.m_indexB=0,this.m_manifold=new ye,this.m_toiCount=0,this.m_toi=0,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_oldManifold=new ye}var e=t.prototype;return e.GetManifold=function(){return this.m_manifold},e.GetWorldManifold=function(t){var e=this.m_fixtureA.GetBody(),n=this.m_fixtureB.GetBody(),i=this.GetShapeA(),r=this.GetShapeB();t.Initialize(this.m_manifold,e.GetTransform(),i.m_radius,n.GetTransform(),r.m_radius)},e.IsTouching=function(){return this.m_touchingFlag},e.SetEnabled=function(t){this.m_enabledFlag=t},e.IsEnabled=function(){return this.m_enabledFlag},e.GetNext=function(){return this.m_next},e.GetFixtureA=function(){return this.m_fixtureA},e.GetChildIndexA=function(){return this.m_indexA},e.GetShapeA=function(){return this.m_fixtureA.GetShape()},e.GetFixtureB=function(){return this.m_fixtureB},e.GetChildIndexB=function(){return this.m_indexB},e.GetShapeB=function(){return this.m_fixtureB.GetShape()},e.FlagForFiltering=function(){this.m_filterFlag=!0},e.SetFriction=function(t){this.m_friction=t},e.GetFriction=function(){return this.m_friction},e.ResetFriction=function(){this.m_friction=Ji(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction)},e.SetRestitution=function(t){this.m_restitution=t},e.GetRestitution=function(){return this.m_restitution},e.ResetRestitution=function(){this.m_restitution=Qi(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},e.SetTangentSpeed=function(t){this.m_tangentSpeed=t},e.GetTangentSpeed=function(){return this.m_tangentSpeed},e.Reset=function(t,e,n,i){this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_enabledFlag=!0,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_toiFlag=!1,this.m_fixtureA=t,this.m_fixtureB=n,this.m_indexA=e,this.m_indexB=i,this.m_manifold.pointCount=0,this.m_prev=null,this.m_next=null,this.m_nodeA.Reset(),this.m_nodeB.Reset(),this.m_toiCount=0,this.m_friction=Ji(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Qi(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)},e.Update=function(t){var e=this.m_oldManifold;this.m_oldManifold=this.m_manifold,this.m_manifold=e,this.m_enabledFlag=!0;var n=!1,i=this.m_touchingFlag,r=this.m_fixtureA.IsSensor(),a=this.m_fixtureB.IsSensor(),o=r||a,s=this.m_fixtureA.GetBody(),c=this.m_fixtureB.GetBody(),l=s.GetTransform(),h=c.GetTransform();if(o){var u=this.GetShapeA(),_=this.GetShapeB();n=Re(u,this.m_indexA,_,this.m_indexB,l,h),this.m_manifold.pointCount=0}else{this.Evaluate(this.m_manifold,l,h),n=this.m_manifold.pointCount>0;for(var f=0;f<this.m_manifold.pointCount;++f){var d=this.m_manifold.points[f];d.normalImpulse=0,d.tangentImpulse=0;for(var p=d.id,m=0;m<this.m_oldManifold.pointCount;++m){var v=this.m_oldManifold.points[m];if(v.id.key===p.key){d.normalImpulse=v.normalImpulse,d.tangentImpulse=v.tangentImpulse;break}}}n!==i&&(s.SetAwake(!0),c.SetAwake(!0))}this.m_touchingFlag=n,!i&&n&&t&&t.BeginContact(this),i&&!n&&t&&t.EndContact(this),!o&&n&&t&&t.PreSolve(this,this.m_oldManifold)},e.ComputeTOI=function(e,n){var i=t.ComputeTOI_s_input;i.proxyA.SetShape(this.GetShapeA(),this.m_indexA),i.proxyB.SetShape(this.GetShapeB(),this.m_indexB),i.sweepA.Copy(e),i.sweepB.Copy(n),i.tMax=u;var r=t.ComputeTOI_s_output;return hn(r,i),r.t},t}();$i.ComputeTOI_s_input=new Je,$i.ComputeTOI_s_output=new Ze;var tr=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(t,e,n){fn(t,this.GetShapeA(),e,this.GetShapeB(),n)},e}($i),er=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(t,e,n){Un(t,this.GetShapeA(),e,this.GetShapeB(),n)},e}($i),nr=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(t,e,n){vn(t,this.GetShapeA(),e,this.GetShapeB(),n)},e}($i),ir=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(t,e,n){Qn(t,this.GetShapeA(),e,this.GetShapeB(),n)},e}($i),rr=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(t,e,n){ri(t,this.GetShapeA(),e,this.GetShapeB(),n)},e}($i),ar=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(t,n,i){var r=e.Evaluate_s_edge;this.GetShapeA().GetChildEdge(r,this.m_indexA),Qn(t,r,n,this.GetShapeB(),i)},e}($i);ar.Evaluate_s_edge=new hi;var or=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e.Create=function(){return new e},e.Destroy=function(){},e.prototype.Evaluate=function(t,n,i){var r=e.Evaluate_s_edge;this.GetShapeA().GetChildEdge(r,this.m_indexA),ri(t,r,n,this.GetShapeB(),i)},e}($i);or.Evaluate_s_edge=new hi;var sr=function(){this.pool=[],this.createFcn=null,this.destroyFcn=null,this.primary=!1},cr=function(){function e(){this.m_registers=[],this.InitializeRegisters()}var n=e.prototype;return n.AddType=function(t,e,n,i){var r=[];function a(){return r.pop()||t()}function o(t){r.push(t)}this.m_registers[n][i].pool=r,this.m_registers[n][i].createFcn=a,this.m_registers[n][i].destroyFcn=o,this.m_registers[n][i].primary=!0,n!==i&&(this.m_registers[i][n].pool=r,this.m_registers[i][n].createFcn=a,this.m_registers[i][n].destroyFcn=o,this.m_registers[i][n].primary=!1)},n.InitializeRegisters=function(){for(var e=0;e<t.b2ShapeType.e_shapeTypeCount;e++){this.m_registers[e]=[];for(var n=0;n<t.b2ShapeType.e_shapeTypeCount;n++)this.m_registers[e][n]=new sr}this.AddType(tr.Create,tr.Destroy,t.b2ShapeType.e_circleShape,t.b2ShapeType.e_circleShape),this.AddType(nr.Create,nr.Destroy,t.b2ShapeType.e_polygonShape,t.b2ShapeType.e_circleShape),this.AddType(er.Create,er.Destroy,t.b2ShapeType.e_polygonShape,t.b2ShapeType.e_polygonShape),this.AddType(ir.Create,ir.Destroy,t.b2ShapeType.e_edgeShape,t.b2ShapeType.e_circleShape),this.AddType(rr.Create,rr.Destroy,t.b2ShapeType.e_edgeShape,t.b2ShapeType.e_polygonShape),this.AddType(ar.Create,ar.Destroy,t.b2ShapeType.e_chainShape,t.b2ShapeType.e_circleShape),this.AddType(or.Create,or.Destroy,t.b2ShapeType.e_chainShape,t.b2ShapeType.e_polygonShape)},n.Create=function(t,e,n,i){var r=t.GetType(),a=n.GetType(),o=this.m_registers[r][a];if(o.createFcn){var s=o.createFcn();return o.primary?s.Reset(t,e,n,i):s.Reset(n,i,t,e),s}return null},n.Destroy=function(t){var e=t.m_fixtureA.GetType(),n=t.m_fixtureB.GetType(),i=this.m_registers[e][n];i.destroyFcn&&i.destroyFcn(t)},e}(),lr=function(){function t(){}var e=t.prototype;return e.SayGoodbyeJoint=function(){},e.SayGoodbyeFixture=function(){},e.SayGoodbyeParticleGroup=function(){},e.SayGoodbyeParticle=function(){},t}(),hr=function(){function e(){}var n=e.prototype;return n.ShouldCollide=function(e,n){var i=e.GetBody(),r=n.GetBody();if(r.GetType()===t.b2BodyType.b2_staticBody&&i.GetType()===t.b2BodyType.b2_staticBody)return!1;if(!r.ShouldCollideConnected(i))return!1;var a=e.GetFilterData(),o=n.GetFilterData();return a.groupIndex===o.groupIndex&&0!==a.groupIndex?a.groupIndex>0:0!=(a.maskBits&o.categoryBits)&&0!=(a.categoryBits&o.maskBits)},n.ShouldCollideFixtureParticle=function(){return!0},n.ShouldCollideParticleParticle=function(){return!0},e}();hr.b2_defaultFilter=new hr;var ur=function(){this.normalImpulses=K(s),this.tangentImpulses=K(s),this.count=0},_r=function(){function t(){}var e=t.prototype;return e.BeginContact=function(){},e.EndContact=function(){},e.BeginContactFixtureParticle=function(){},e.EndContactFixtureParticle=function(){},e.BeginContactParticleParticle=function(){},e.EndContactParticleParticle=function(){},e.PreSolve=function(){},e.PostSolve=function(){},t}();_r.b2_defaultListener=new _r;var fr=function(){function t(){}var e=t.prototype;return e.ReportFixture=function(){return!0},e.ReportParticle=function(){return!1},e.ShouldQueryParticleSystem=function(){return!0},t}(),dr=function(){function t(){}var e=t.prototype;return e.ReportFixture=function(t,e,n,i){return i},e.ReportParticle=function(){return 0},e.ShouldQueryParticleSystem=function(){return!0},t}(),pr=function(){function e(){this.m_broadPhase=new ze,this.m_contactList=null,this.m_contactCount=0,this.m_contactFilter=hr.b2_defaultFilter,this.m_contactListener=_r.b2_defaultListener,this.m_contactFactory=new cr}var n=e.prototype;return n.AddPair=function(t,e){var n=t.fixture,i=e.fixture,r=t.childIndex,a=e.childIndex,o=n.GetBody(),s=i.GetBody();if(o!==s){for(var c=s.GetContactList();c;){if(c.other===o){var l=c.contact.GetFixtureA(),h=c.contact.GetFixtureB(),u=c.contact.GetChildIndexA(),_=c.contact.GetChildIndexB();if(l===n&&h===i&&u===r&&_===a)return;if(l===i&&h===n&&u===a&&_===r)return}c=c.next}if(!this.m_contactFilter||this.m_contactFilter.ShouldCollide(n,i)){var f=this.m_contactFactory.Create(n,r,i,a);null!==f&&(n=f.GetFixtureA(),i=f.GetFixtureB(),r=f.GetChildIndexA(),a=f.GetChildIndexB(),o=n.m_body,s=i.m_body,f.m_prev=null,f.m_next=this.m_contactList,null!==this.m_contactList&&(this.m_contactList.m_prev=f),this.m_contactList=f,f.m_nodeA.other=s,f.m_nodeA.prev=null,f.m_nodeA.next=o.m_contactList,null!==o.m_contactList&&(o.m_contactList.prev=f.m_nodeA),o.m_contactList=f.m_nodeA,f.m_nodeB.other=o,f.m_nodeB.prev=null,f.m_nodeB.next=s.m_contactList,null!==s.m_contactList&&(s.m_contactList.prev=f.m_nodeB),s.m_contactList=f.m_nodeB,n.IsSensor()||i.IsSensor()||(o.SetAwake(!0),s.SetAwake(!0)),++this.m_contactCount)}}},n.FindNewContacts=function(){var t=this;this.m_broadPhase.UpdatePairs((function(e,n){t.AddPair(e,n)}))},n.Destroy=function(t){var e=t.GetFixtureA(),n=t.GetFixtureB(),i=e.GetBody(),r=n.GetBody();this.m_contactListener&&t.IsTouching()&&this.m_contactListener.EndContact(t),t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_contactList&&(this.m_contactList=t.m_next),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA===i.m_contactList&&(i.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB===r.m_contactList&&(r.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!e.IsSensor()&&!n.IsSensor()&&(e.GetBody().SetAwake(!0),n.GetBody().SetAwake(!0)),this.m_contactFactory.Destroy(t),--this.m_contactCount},n.Collide=function(){for(var e=this.m_contactList;e;){var n=e.GetFixtureA(),i=e.GetFixtureB(),r=e.GetChildIndexA(),a=e.GetChildIndexB(),o=n.GetBody(),s=i.GetBody();if(e.m_filterFlag){if(this.m_contactFilter&&!this.m_contactFilter.ShouldCollide(n,i)){var c=e;e=c.m_next,this.Destroy(c);continue}e.m_filterFlag=!1}var l=o.IsAwake()&&o.m_type!==t.b2BodyType.b2_staticBody,h=s.IsAwake()&&s.m_type!==t.b2BodyType.b2_staticBody;if(l||h){var u=n.m_proxies[r].treeNode,_=i.m_proxies[a].treeNode;if(Ee(u.aabb,_.aabb))e.Update(this.m_contactListener),e=e.m_next;else{var f=e;e=f.m_next,this.Destroy(f)}}else e=e.m_next}},e}(),mr=function(){function t(){this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0}return t.prototype.Reset=function(){return this.step=0,this.collide=0,this.solve=0,this.solveInit=0,this.solveVelocity=0,this.solvePosition=0,this.broadphase=0,this.solveTOI=0,this},t}(),vr=function(){function t(){this.dt=0,this.inv_dt=0,this.dtRatio=0,this.velocityIterations=0,this.positionIterations=0,this.particleIterations=0,this.warmStarting=!1}return t.prototype.Copy=function(t){return this.dt=t.dt,this.inv_dt=t.inv_dt,this.dtRatio=t.dtRatio,this.positionIterations=t.positionIterations,this.velocityIterations=t.velocityIterations,this.particleIterations=t.particleIterations,this.warmStarting=t.warmStarting,this},t}(),gr=function(){function t(){this.c=new Ct,this.a=0}return t.MakeArray=function(e){return X(e,(function(){return new t}))},t}(),yr=function(){function t(){this.v=new Ct,this.w=0}return t.MakeArray=function(e){return X(e,(function(){return new t}))},t}(),xr=function(){this.step=new vr},Sr=!1,Ar=function(){function t(){this.rA=new Ct,this.rB=new Ct,this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}return t.MakeArray=function(e){return X(e,(function(){return new t}))},t}(),br=function(){function t(){this.points=Ar.MakeArray(s),this.normal=new Ct,this.tangent=new Ct,this.normalMass=new wt,this.K=new wt,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.invIA=0,this.invIB=0,this.friction=0,this.restitution=0,this.tangentSpeed=0,this.pointCount=0,this.contactIndex=0}return t.MakeArray=function(e){return X(e,(function(){return new t}))},t}(),Cr=function(){function e(){this.localPoints=Ct.MakeArray(s),this.localNormal=new Ct,this.localPoint=new Ct,this.indexA=0,this.indexB=0,this.invMassA=0,this.invMassB=0,this.localCenterA=new Ct,this.localCenterB=new Ct,this.invIA=0,this.invIB=0,this.type=t.b2ManifoldType.e_unknown,this.radiusA=0,this.radiusB=0,this.pointCount=0}return e.MakeArray=function(t){return X(t,(function(){return new e}))},e}(),Tr=function(){this.step=new vr,this.count=0},Er=function(){function e(){this.normal=new Ct,this.point=new Ct,this.separation=0}return e.prototype.Initialize=function(n,i,r,a){var o=e.Initialize_s_pointA,s=e.Initialize_s_pointB,c=e.Initialize_s_planePoint,l=e.Initialize_s_clipPoint;switch(n.type){case t.b2ManifoldType.e_circles:Dt.MulXV(i,n.localPoint,o),Dt.MulXV(r,n.localPoints[0],s),Ct.SubVV(s,o,this.normal).SelfNormalize(),Ct.MidVV(o,s,this.point),this.separation=Ct.DotVV(Ct.SubVV(s,o,Ct.s_t0),this.normal)-n.radiusA-n.radiusB;break;case t.b2ManifoldType.e_faceA:Pt.MulRV(i.q,n.localNormal,this.normal),Dt.MulXV(i,n.localPoint,c),Dt.MulXV(r,n.localPoints[a],l),this.separation=Ct.DotVV(Ct.SubVV(l,c,Ct.s_t0),this.normal)-n.radiusA-n.radiusB,this.point.Copy(l);break;case t.b2ManifoldType.e_faceB:Pt.MulRV(r.q,n.localNormal,this.normal),Dt.MulXV(r,n.localPoint,c),Dt.MulXV(i,n.localPoints[a],l),this.separation=Ct.DotVV(Ct.SubVV(l,c,Ct.s_t0),this.normal)-n.radiusA-n.radiusB,this.point.Copy(l),this.normal.SelfNeg()}},e}();Er.Initialize_s_pointA=new Ct,Er.Initialize_s_pointB=new Ct,Er.Initialize_s_planePoint=new Ct,Er.Initialize_s_clipPoint=new Ct;var wr=function(){function t(){this.m_step=new vr,this.m_positionConstraints=Cr.MakeArray(1024),this.m_velocityConstraints=br.MakeArray(1024),this.m_count=0}var e=t.prototype;return e.Initialize=function(t){if(this.m_step.Copy(t.step),this.m_count=t.count,this.m_positionConstraints.length<this.m_count)for(var e=rt(2*this.m_positionConstraints.length,this.m_count);this.m_positionConstraints.length<e;)this.m_positionConstraints[this.m_positionConstraints.length]=new Cr;if(this.m_velocityConstraints.length<this.m_count)for(var n=rt(2*this.m_velocityConstraints.length,this.m_count);this.m_velocityConstraints.length<n;)this.m_velocityConstraints[this.m_velocityConstraints.length]=new br;this.m_positions=t.positions,this.m_velocities=t.velocities,this.m_contacts=t.contacts;for(var i=0;i<this.m_count;++i){var r=this.m_contacts[i],a=r.m_fixtureA,o=r.m_fixtureB,s=a.GetShape(),c=o.GetShape(),l=s.m_radius,h=c.m_radius,u=a.GetBody(),_=o.GetBody(),f=r.GetManifold(),d=f.pointCount,p=this.m_velocityConstraints[i];p.friction=r.m_friction,p.restitution=r.m_restitution,p.tangentSpeed=r.m_tangentSpeed,p.indexA=u.m_islandIndex,p.indexB=_.m_islandIndex,p.invMassA=u.m_invMass,p.invMassB=_.m_invMass,p.invIA=u.m_invI,p.invIB=_.m_invI,p.contactIndex=i,p.pointCount=d,p.K.SetZero(),p.normalMass.SetZero();var m=this.m_positionConstraints[i];m.indexA=u.m_islandIndex,m.indexB=_.m_islandIndex,m.invMassA=u.m_invMass,m.invMassB=_.m_invMass,m.localCenterA.Copy(u.m_sweep.localCenter),m.localCenterB.Copy(_.m_sweep.localCenter),m.invIA=u.m_invI,m.invIB=_.m_invI,m.localNormal.Copy(f.localNormal),m.localPoint.Copy(f.localPoint),m.pointCount=d,m.radiusA=l,m.radiusB=h,m.type=f.type;for(var v=0;v<d;++v){var g=f.points[v],y=p.points[v];this.m_step.warmStarting?(y.normalImpulse=this.m_step.dtRatio*g.normalImpulse,y.tangentImpulse=this.m_step.dtRatio*g.tangentImpulse):(y.normalImpulse=0,y.tangentImpulse=0),y.rA.SetZero(),y.rB.SetZero(),y.normalMass=0,y.tangentMass=0,y.velocityBias=0,m.localPoints[v].Copy(g.localPoint)}}return this},e.InitializeVelocityConstraints=function(){for(var e=t.InitializeVelocityConstraints_s_xfA,n=t.InitializeVelocityConstraints_s_xfB,i=t.InitializeVelocityConstraints_s_worldManifold,r=1e3,a=0;a<this.m_count;++a){var o=this.m_velocityConstraints[a],s=this.m_positionConstraints[a],c=s.radiusA,l=s.radiusB,h=this.m_contacts[o.contactIndex].GetManifold(),u=o.indexA,_=o.indexB,f=o.invMassA,d=o.invMassB,p=o.invIA,v=o.invIB,g=s.localCenterA,y=s.localCenterB,x=this.m_positions[u].c,S=this.m_positions[u].a,A=this.m_velocities[u].v,b=this.m_velocities[u].w,C=this.m_positions[_].c,T=this.m_positions[_].a,E=this.m_velocities[_].v,w=this.m_velocities[_].w;e.q.SetAngle(S),n.q.SetAngle(T),Ct.SubVV(x,Pt.MulRV(e.q,g,Ct.s_t0),e.p),Ct.SubVV(C,Pt.MulRV(n.q,y,Ct.s_t0),n.p),i.Initialize(h,e,c,n,l),o.normal.Copy(i.normal),Ct.CrossVOne(o.normal,o.tangent);for(var I=o.pointCount,P=0;P<I;++P){var D=o.points[P];Ct.SubVV(i.points[P],x,D.rA),Ct.SubVV(i.points[P],C,D.rB);var R=Ct.CrossVV(D.rA,o.normal),M=Ct.CrossVV(D.rB,o.normal),O=f+d+p*R*R+v*M*M;D.normalMass=O>0?1/O:0;var N=o.tangent,B=Ct.CrossVV(D.rA,N),L=Ct.CrossVV(D.rB,N),F=f+d+p*B*B+v*L*L;D.tangentMass=F>0?1/F:0,D.velocityBias=0;var V=Ct.DotVV(o.normal,Ct.SubVV(Ct.AddVCrossSV(E,w,D.rB,Ct.s_t0),Ct.AddVCrossSV(A,b,D.rA,Ct.s_t1),Ct.s_t0));V<-m&&(D.velocityBias+=-o.restitution*V)}if(2===o.pointCount&&Sr){var z=o.points[0],k=o.points[1],U=Ct.CrossVV(z.rA,o.normal),G=Ct.CrossVV(z.rB,o.normal),H=Ct.CrossVV(k.rA,o.normal),j=Ct.CrossVV(k.rB,o.normal),W=f+d+p*U*U+v*G*G,q=f+d+p*H*H+v*j*j,X=f+d+p*U*H+v*G*j;W*W<r*(W*q-X*X)?(o.K.ex.Set(W,X),o.K.ey.Set(X,q),o.K.GetInverse(o.normalMass)):o.pointCount=1}}},e.WarmStart=function(){for(var e=t.WarmStart_s_P,n=0;n<this.m_count;++n){for(var i=this.m_velocityConstraints[n],r=i.indexA,a=i.indexB,o=i.invMassA,s=i.invIA,c=i.invMassB,l=i.invIB,h=i.pointCount,u=this.m_velocities[r].v,_=this.m_velocities[r].w,f=this.m_velocities[a].v,d=this.m_velocities[a].w,p=i.normal,m=i.tangent,v=0;v<h;++v){var g=i.points[v];Ct.AddVV(Ct.MulSV(g.normalImpulse,p,Ct.s_t0),Ct.MulSV(g.tangentImpulse,m,Ct.s_t1),e),_-=s*Ct.CrossVV(g.rA,e),u.SelfMulSub(o,e),d+=l*Ct.CrossVV(g.rB,e),f.SelfMulAdd(c,e)}this.m_velocities[r].w=_,this.m_velocities[a].w=d}},e.SolveVelocityConstraints=function(){for(var e=t.SolveVelocityConstraints_s_dv,n=t.SolveVelocityConstraints_s_dv1,i=t.SolveVelocityConstraints_s_dv2,r=t.SolveVelocityConstraints_s_P,a=t.SolveVelocityConstraints_s_a,o=t.SolveVelocityConstraints_s_b,s=t.SolveVelocityConstraints_s_x,c=t.SolveVelocityConstraints_s_d,l=t.SolveVelocityConstraints_s_P1,h=t.SolveVelocityConstraints_s_P2,u=t.SolveVelocityConstraints_s_P1P2,_=0;_<this.m_count;++_){for(var f=this.m_velocityConstraints[_],d=f.indexA,p=f.indexB,m=f.invMassA,v=f.invIA,g=f.invMassB,y=f.invIB,x=f.pointCount,S=this.m_velocities[d].v,A=this.m_velocities[d].w,b=this.m_velocities[p].v,C=this.m_velocities[p].w,T=f.normal,E=f.tangent,w=f.friction,I=0;I<x;++I){var P=f.points[I];Ct.SubVV(Ct.AddVCrossSV(b,C,P.rB,Ct.s_t0),Ct.AddVCrossSV(S,A,P.rA,Ct.s_t1),e);var D=Ct.DotVV(e,E)-f.tangentSpeed,R=P.tangentMass*-D,M=w*P.normalImpulse,O=at(P.tangentImpulse+R,-M,M);R=O-P.tangentImpulse,P.tangentImpulse=O,Ct.MulSV(R,E,r),S.SelfMulSub(m,r),A-=v*Ct.CrossVV(P.rA,r),b.SelfMulAdd(g,r),C+=y*Ct.CrossVV(P.rB,r)}if(1===f.pointCount||!1===Sr)for(var N=0;N<x;++N){var B=f.points[N];Ct.SubVV(Ct.AddVCrossSV(b,C,B.rB,Ct.s_t0),Ct.AddVCrossSV(S,A,B.rA,Ct.s_t1),e);var L=Ct.DotVV(e,T),F=-B.normalMass*(L-B.velocityBias),V=rt(B.normalImpulse+F,0);F=V-B.normalImpulse,B.normalImpulse=V,Ct.MulSV(F,T,r),S.SelfMulSub(m,r),A-=v*Ct.CrossVV(B.rA,r),b.SelfMulAdd(g,r),C+=y*Ct.CrossVV(B.rB,r)}else{var z=f.points[0],k=f.points[1];a.Set(z.normalImpulse,k.normalImpulse),Ct.SubVV(Ct.AddVCrossSV(b,C,z.rB,Ct.s_t0),Ct.AddVCrossSV(S,A,z.rA,Ct.s_t1),n),Ct.SubVV(Ct.AddVCrossSV(b,C,k.rB,Ct.s_t0),Ct.AddVCrossSV(S,A,k.rA,Ct.s_t1),i);var U=Ct.DotVV(n,T),G=Ct.DotVV(i,T);for(o.x=U-z.velocityBias,o.y=G-k.velocityBias,o.SelfSub(wt.MulMV(f.K,a,Ct.s_t0));;){if(wt.MulMV(f.normalMass,o,s).SelfNeg(),s.x>=0&&s.y>=0){Ct.SubVV(s,a,c),Ct.MulSV(c.x,T,l),Ct.MulSV(c.y,T,h),Ct.AddVV(l,h,u),S.SelfMulSub(m,u),A-=v*(Ct.CrossVV(z.rA,l)+Ct.CrossVV(k.rA,h)),b.SelfMulAdd(g,u),C+=y*(Ct.CrossVV(z.rB,l)+Ct.CrossVV(k.rB,h)),z.normalImpulse=s.x,k.normalImpulse=s.y;break}if(s.x=-z.normalMass*o.x,s.y=0,U=0,G=f.K.ex.y*s.x+o.y,s.x>=0&&G>=0){Ct.SubVV(s,a,c),Ct.MulSV(c.x,T,l),Ct.MulSV(c.y,T,h),Ct.AddVV(l,h,u),S.SelfMulSub(m,u),A-=v*(Ct.CrossVV(z.rA,l)+Ct.CrossVV(k.rA,h)),b.SelfMulAdd(g,u),C+=y*(Ct.CrossVV(z.rB,l)+Ct.CrossVV(k.rB,h)),z.normalImpulse=s.x,k.normalImpulse=s.y;break}if(s.x=0,s.y=-k.normalMass*o.y,U=f.K.ey.x*s.y+o.x,G=0,s.y>=0&&U>=0){Ct.SubVV(s,a,c),Ct.MulSV(c.x,T,l),Ct.MulSV(c.y,T,h),Ct.AddVV(l,h,u),S.SelfMulSub(m,u),A-=v*(Ct.CrossVV(z.rA,l)+Ct.CrossVV(k.rA,h)),b.SelfMulAdd(g,u),C+=y*(Ct.CrossVV(z.rB,l)+Ct.CrossVV(k.rB,h)),z.normalImpulse=s.x,k.normalImpulse=s.y;break}if(s.x=0,s.y=0,U=o.x,G=o.y,U>=0&&G>=0){Ct.SubVV(s,a,c),Ct.MulSV(c.x,T,l),Ct.MulSV(c.y,T,h),Ct.AddVV(l,h,u),S.SelfMulSub(m,u),A-=v*(Ct.CrossVV(z.rA,l)+Ct.CrossVV(k.rA,h)),b.SelfMulAdd(g,u),C+=y*(Ct.CrossVV(z.rB,l)+Ct.CrossVV(k.rB,h)),z.normalImpulse=s.x,k.normalImpulse=s.y;break}break}}this.m_velocities[d].w=A,this.m_velocities[p].w=C}},e.StoreImpulses=function(){for(var t=0;t<this.m_count;++t)for(var e=this.m_velocityConstraints[t],n=this.m_contacts[e.contactIndex].GetManifold(),i=0;i<e.pointCount;++i)n.points[i].normalImpulse=e.points[i].normalImpulse,n.points[i].tangentImpulse=e.points[i].tangentImpulse},e.SolvePositionConstraints=function(){for(var e=t.SolvePositionConstraints_s_xfA,n=t.SolvePositionConstraints_s_xfB,i=t.SolvePositionConstraints_s_psm,r=t.SolvePositionConstraints_s_rA,a=t.SolvePositionConstraints_s_rB,o=t.SolvePositionConstraints_s_P,s=0,c=0;c<this.m_count;++c){for(var l=this.m_positionConstraints[c],h=l.indexA,_=l.indexB,f=l.localCenterA,d=l.invMassA,p=l.invIA,m=l.localCenterB,g=l.invMassB,y=l.invIB,x=l.pointCount,S=this.m_positions[h].c,A=this.m_positions[h].a,C=this.m_positions[_].c,T=this.m_positions[_].a,E=0;E<x;++E){e.q.SetAngle(A),n.q.SetAngle(T),Ct.SubVV(S,Pt.MulRV(e.q,f,Ct.s_t0),e.p),Ct.SubVV(C,Pt.MulRV(n.q,m,Ct.s_t0),n.p),i.Initialize(l,e,n,E);var w=i.normal,I=i.point,P=i.separation;Ct.SubVV(I,S,r),Ct.SubVV(I,C,a),s=nt(s,P);var D=at(b*(P+u),-v,0),R=Ct.CrossVV(r,w),M=Ct.CrossVV(a,w),O=d+g+p*R*R+y*M*M,N=O>0?-D/O:0;Ct.MulSV(N,w,o),S.SelfMulSub(d,o),A-=p*Ct.CrossVV(r,o),C.SelfMulAdd(g,o),T+=y*Ct.CrossVV(a,o)}this.m_positions[h].a=A,this.m_positions[_].a=T}return s>-3*u},e.SolveTOIPositionConstraints=function(e,n){for(var i=t.SolveTOIPositionConstraints_s_xfA,r=t.SolveTOIPositionConstraints_s_xfB,a=t.SolveTOIPositionConstraints_s_psm,o=t.SolveTOIPositionConstraints_s_rA,s=t.SolveTOIPositionConstraints_s_rB,c=t.SolveTOIPositionConstraints_s_P,l=0,h=0;h<this.m_count;++h){var _=this.m_positionConstraints[h],f=_.indexA,d=_.indexB,p=_.localCenterA,m=_.localCenterB,g=_.pointCount,y=0,x=0;f!==e&&f!==n||(y=_.invMassA,x=_.invIA);var S=0,A=0;d!==e&&d!==n||(S=_.invMassB,A=_.invIB);for(var b=this.m_positions[f].c,T=this.m_positions[f].a,E=this.m_positions[d].c,w=this.m_positions[d].a,I=0;I<g;++I){i.q.SetAngle(T),r.q.SetAngle(w),Ct.SubVV(b,Pt.MulRV(i.q,p,Ct.s_t0),i.p),Ct.SubVV(E,Pt.MulRV(r.q,m,Ct.s_t0),r.p),a.Initialize(_,i,r,I);var P=a.normal,D=a.point,R=a.separation;Ct.SubVV(D,b,o),Ct.SubVV(D,E,s),l=nt(l,R);var M=at(C*(R+u),-v,0),O=Ct.CrossVV(o,P),N=Ct.CrossVV(s,P),B=y+S+x*O*O+A*N*N,L=B>0?-M/B:0;Ct.MulSV(L,P,c),b.SelfMulSub(y,c),T-=x*Ct.CrossVV(o,c),E.SelfMulAdd(S,c),w+=A*Ct.CrossVV(s,c)}this.m_positions[f].a=T,this.m_positions[d].a=w}return l>=-1.5*u},t}();wr.InitializeVelocityConstraints_s_xfA=new Dt,wr.InitializeVelocityConstraints_s_xfB=new Dt,wr.InitializeVelocityConstraints_s_worldManifold=new xe,wr.WarmStart_s_P=new Ct,wr.SolveVelocityConstraints_s_dv=new Ct,wr.SolveVelocityConstraints_s_dv1=new Ct,wr.SolveVelocityConstraints_s_dv2=new Ct,wr.SolveVelocityConstraints_s_P=new Ct,wr.SolveVelocityConstraints_s_a=new Ct,wr.SolveVelocityConstraints_s_b=new Ct,wr.SolveVelocityConstraints_s_x=new Ct,wr.SolveVelocityConstraints_s_d=new Ct,wr.SolveVelocityConstraints_s_P1=new Ct,wr.SolveVelocityConstraints_s_P2=new Ct,wr.SolveVelocityConstraints_s_P1P2=new Ct,wr.SolvePositionConstraints_s_xfA=new Dt,wr.SolvePositionConstraints_s_xfB=new Dt,wr.SolvePositionConstraints_s_psm=new Er,wr.SolvePositionConstraints_s_rA=new Ct,wr.SolvePositionConstraints_s_rB=new Ct,wr.SolvePositionConstraints_s_P=new Ct,wr.SolveTOIPositionConstraints_s_xfA=new Dt,wr.SolveTOIPositionConstraints_s_xfB=new Dt,wr.SolveTOIPositionConstraints_s_psm=new Er,wr.SolveTOIPositionConstraints_s_rA=new Ct,wr.SolveTOIPositionConstraints_s_rB=new Ct,wr.SolveTOIPositionConstraints_s_P=new Ct;var Ir,Pr=function(){function e(){this.m_bodies=[],this.m_contacts=[],this.m_joints=[],this.m_positions=gr.MakeArray(1024),this.m_velocities=yr.MakeArray(1024),this.m_bodyCount=0,this.m_jointCount=0,this.m_contactCount=0,this.m_bodyCapacity=0,this.m_contactCapacity=0,this.m_jointCapacity=0}var n=e.prototype;return n.Initialize=function(t,e,n,i){if(this.m_bodyCapacity=t,this.m_contactCapacity=e,this.m_jointCapacity=n,this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0,this.m_listener=i,this.m_positions.length<t)for(var r=rt(2*this.m_positions.length,t);this.m_positions.length<r;)this.m_positions[this.m_positions.length]=new gr;if(this.m_velocities.length<t)for(var a=rt(2*this.m_velocities.length,t);this.m_velocities.length<a;)this.m_velocities[this.m_velocities.length]=new yr},n.Clear=function(){this.m_bodyCount=0,this.m_contactCount=0,this.m_jointCount=0},n.AddBody=function(t){t.m_islandIndex=this.m_bodyCount,this.m_bodies[this.m_bodyCount++]=t},n.AddContact=function(t){this.m_contacts[this.m_contactCount++]=t},n.AddJoint=function(t){this.m_joints[this.m_jointCount++]=t},n.Solve=function(n,r,a,o){for(var s=e.s_timer.Reset(),c=r.dt,l=0;l<this.m_bodyCount;++l){var h=this.m_bodies[l];this.m_positions[l].c.Copy(h.m_sweep.c);var u=h.m_sweep.a,_=this.m_velocities[l].v.Copy(h.m_linearVelocity),f=h.m_angularVelocity;h.m_sweep.c0.Copy(h.m_sweep.c),h.m_sweep.a0=h.m_sweep.a,h.m_type===t.b2BodyType.b2_dynamicBody&&(_.x+=c*(h.m_gravityScale*a.x+h.m_invMass*h.m_force.x),_.y+=c*(h.m_gravityScale*a.y+h.m_invMass*h.m_force.y),f+=c*h.m_invI*h.m_torque,_.SelfMul(1/(1+c*h.m_linearDamping)),f*=1/(1+c*h.m_angularDamping)),this.m_positions[l].a=u,this.m_velocities[l].w=f}s.Reset();var d=e.s_solverData;d.step.Copy(r),d.positions=this.m_positions,d.velocities=this.m_velocities;var p=e.s_contactSolverDef;p.step.Copy(r),p.contacts=this.m_contacts,p.count=this.m_contactCount,p.positions=this.m_positions,p.velocities=this.m_velocities;var m=e.s_contactSolver.Initialize(p);m.InitializeVelocityConstraints(),r.warmStarting&&m.WarmStart();for(var v=0;v<this.m_jointCount;++v)this.m_joints[v].InitVelocityConstraints(d);n.solveInit=s.GetMilliseconds(),s.Reset();for(var g=0;g<r.velocityIterations;++g){for(var b=0;b<this.m_jointCount;++b)this.m_joints[b].SolveVelocityConstraints(d);m.SolveVelocityConstraints()}m.StoreImpulses(),n.solveVelocity=s.GetMilliseconds();for(var C=0;C<this.m_bodyCount;++C){var T=this.m_positions[C].c,E=this.m_positions[C].a,w=this.m_velocities[C].v,I=this.m_velocities[C].w,P=Ct.MulSV(c,w,e.s_translation);if(Ct.DotVV(P,P)>x){var D=y/P.Length();w.SelfMul(D)}var R=c*I;R*R>A&&(I*=S/et(R)),T.x+=c*w.x,T.y+=c*w.y,E+=c*I,this.m_positions[C].a=E,this.m_velocities[C].w=I}s.Reset();for(var M=!1,O=0;O<r.positionIterations;++O){for(var N=m.SolvePositionConstraints(),V=!0,z=0;z<this.m_jointCount;++z){var k=this.m_joints[z].SolvePositionConstraints(d);V=V&&k}if(N&&V){M=!0;break}}for(var U=0;U<this.m_bodyCount;++U){var G=this.m_bodies[U];G.m_sweep.c.Copy(this.m_positions[U].c),G.m_sweep.a=this.m_positions[U].a,G.m_linearVelocity.Copy(this.m_velocities[U].v),G.m_angularVelocity=this.m_velocities[U].w,G.SynchronizeTransform()}if(n.solvePosition=s.GetMilliseconds(),this.Report(m.m_velocityConstraints),o){for(var H=i,j=L*L,W=F*F,q=0;q<this.m_bodyCount;++q){var X=this.m_bodies[q];X.GetType()!==t.b2BodyType.b2_staticBody&&(!X.m_autoSleepFlag||X.m_angularVelocity*X.m_angularVelocity>W||Ct.DotVV(X.m_linearVelocity,X.m_linearVelocity)>j?(X.m_sleepTime=0,H=0):(X.m_sleepTime+=c,H=nt(H,X.m_sleepTime)))}if(H>=B&&M)for(var Y=0;Y<this.m_bodyCount;++Y)this.m_bodies[Y].SetAwake(!1)}},n.SolveTOI=function(t,n,i){for(var r=0;r<this.m_bodyCount;++r){var a=this.m_bodies[r];this.m_positions[r].c.Copy(a.m_sweep.c),this.m_positions[r].a=a.m_sweep.a,this.m_velocities[r].v.Copy(a.m_linearVelocity),this.m_velocities[r].w=a.m_angularVelocity}var o=e.s_contactSolverDef;o.contacts=this.m_contacts,o.count=this.m_contactCount,o.step.Copy(t),o.positions=this.m_positions,o.velocities=this.m_velocities;for(var s=e.s_contactSolver.Initialize(o),c=0;c<t.positionIterations&&!s.SolveTOIPositionConstraints(n,i);++c);this.m_bodies[n].m_sweep.c0.Copy(this.m_positions[n].c),this.m_bodies[n].m_sweep.a0=this.m_positions[n].a,this.m_bodies[i].m_sweep.c0.Copy(this.m_positions[i].c),this.m_bodies[i].m_sweep.a0=this.m_positions[i].a,s.InitializeVelocityConstraints();for(var l=0;l<t.velocityIterations;++l)s.SolveVelocityConstraints();for(var h=t.dt,u=0;u<this.m_bodyCount;++u){var _=this.m_positions[u].c,f=this.m_positions[u].a,d=this.m_velocities[u].v,p=this.m_velocities[u].w,m=Ct.MulSV(h,d,e.s_translation);if(Ct.DotVV(m,m)>x){var v=y/m.Length();d.SelfMul(v)}var g=h*p;g*g>A&&(p*=S/et(g)),_.SelfMulAdd(h,d),f+=h*p,this.m_positions[u].a=f,this.m_velocities[u].w=p;var b=this.m_bodies[u];b.m_sweep.c.Copy(_),b.m_sweep.a=f,b.m_linearVelocity.Copy(d),b.m_angularVelocity=p,b.SynchronizeTransform()}this.Report(s.m_velocityConstraints)},n.Report=function(t){if(null!==this.m_listener)for(var n=0;n<this.m_contactCount;++n){var i=this.m_contacts[n];if(i){var r=t[n],a=e.s_impulse;a.count=r.pointCount;for(var o=0;o<r.pointCount;++o)a.normalImpulses[o]=r.points[o].normalImpulse,a.tangentImpulses[o]=r.points[o].tangentImpulse;this.m_listener.PostSolve(i,a)}}},e}();Pr.s_timer=new Bt,Pr.s_solverData=new xr,Pr.s_contactSolverDef=new Tr,Pr.s_contactSolver=new wr,Pr.s_translation=new Ct,Pr.s_impulse=new ur,(Ir=t.b2ParticleFlag||(t.b2ParticleFlag={}))[Ir.b2_waterParticle=0]="b2_waterParticle",Ir[Ir.b2_zombieParticle=2]="b2_zombieParticle",Ir[Ir.b2_wallParticle=4]="b2_wallParticle",Ir[Ir.b2_springParticle=8]="b2_springParticle",Ir[Ir.b2_elasticParticle=16]="b2_elasticParticle",Ir[Ir.b2_viscousParticle=32]="b2_viscousParticle",Ir[Ir.b2_powderParticle=64]="b2_powderParticle",Ir[Ir.b2_tensileParticle=128]="b2_tensileParticle",Ir[Ir.b2_colorMixingParticle=256]="b2_colorMixingParticle",Ir[Ir.b2_destructionListenerParticle=512]="b2_destructionListenerParticle",Ir[Ir.b2_barrierParticle=1024]="b2_barrierParticle",Ir[Ir.b2_staticPressureParticle=2048]="b2_staticPressureParticle",Ir[Ir.b2_reactiveParticle=4096]="b2_reactiveParticle",Ir[Ir.b2_repulsiveParticle=8192]="b2_repulsiveParticle",Ir[Ir.b2_fixtureContactListenerParticle=16384]="b2_fixtureContactListenerParticle",Ir[Ir.b2_particleContactListenerParticle=32768]="b2_particleContactListenerParticle",Ir[Ir.b2_fixtureContactFilterParticle=65536]="b2_fixtureContactFilterParticle",Ir[Ir.b2_particleContactFilterParticle=131072]="b2_particleContactFilterParticle";var Dr=function(){this.flags=0,this.position=new Ct,this.velocity=new Ct,this.color=new Ot(0,0,0,0),this.lifetime=0,this.userData=null,this.group=null};function Rr(t,e,n){var i=8,r=.01;return at(Math.ceil(Math.sqrt(t/(r*e))*n),1,i)}var Mr,Or=function(){function t(){this.m_index=T}var e=t.prototype;return e.GetIndex=function(){return this.m_index},e.SetIndex=function(t){this.m_index=t},t}();(Mr=t.b2ParticleGroupFlag||(t.b2ParticleGroupFlag={}))[Mr.b2_solidParticleGroup=1]="b2_solidParticleGroup",Mr[Mr.b2_rigidParticleGroup=2]="b2_rigidParticleGroup",Mr[Mr.b2_particleGroupCanBeEmpty=4]="b2_particleGroupCanBeEmpty",Mr[Mr.b2_particleGroupWillBeDestroyed=8]="b2_particleGroupWillBeDestroyed",Mr[Mr.b2_particleGroupNeedsUpdateDepth=16]="b2_particleGroupNeedsUpdateDepth",Mr[Mr.b2_particleGroupInternalMask=24]="b2_particleGroupInternalMask";var Nr=function(){this.flags=0,this.groupFlags=0,this.position=new Ct,this.angle=0,this.linearVelocity=new Ct,this.angularVelocity=0,this.color=new Ot,this.strength=1,this.shapeCount=0,this.stride=0,this.particleCount=0,this.lifetime=0,this.userData=null,this.group=null},Br=function(){function e(t){this.m_firstIndex=0,this.m_lastIndex=0,this.m_groupFlags=0,this.m_strength=1,this.m_prev=null,this.m_next=null,this.m_timestamp=-1,this.m_mass=0,this.m_inertia=0,this.m_center=new Ct,this.m_linearVelocity=new Ct,this.m_angularVelocity=0,this.m_transform=new Dt,this.m_userData=null,this.m_system=t}var n=e.prototype;return n.GetNext=function(){return this.m_next},n.GetParticleSystem=function(){return this.m_system},n.GetParticleCount=function(){return this.m_lastIndex-this.m_firstIndex},n.GetBufferIndex=function(){return this.m_firstIndex},n.ContainsParticle=function(t){return this.m_firstIndex<=t&&t<this.m_lastIndex},n.GetAllParticleFlags=function(){if(!this.m_system.m_flagsBuffer.data)throw new Error;for(var t=0,e=this.m_firstIndex;e<this.m_lastIndex;e++)t|=this.m_system.m_flagsBuffer.data[e];return t},n.GetGroupFlags=function(){return this.m_groupFlags},n.SetGroupFlags=function(e){e|=this.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupInternalMask,this.m_system.SetGroupFlags(this,e)},n.GetMass=function(){return this.UpdateStatistics(),this.m_mass},n.GetInertia=function(){return this.UpdateStatistics(),this.m_inertia},n.GetCenter=function(){return this.UpdateStatistics(),this.m_center},n.GetLinearVelocity=function(){return this.UpdateStatistics(),this.m_linearVelocity},n.GetAngularVelocity=function(){return this.UpdateStatistics(),this.m_angularVelocity},n.GetTransform=function(){return this.m_transform},n.GetPosition=function(){return this.m_transform.p},n.GetAngle=function(){return this.m_transform.q.GetAngle()},n.GetLinearVelocityFromWorldPoint=function(t,n){var i=e.GetLinearVelocityFromWorldPoint_s_t0;return this.UpdateStatistics(),Ct.AddVCrossSV(this.m_linearVelocity,this.m_angularVelocity,Ct.SubVV(t,this.m_center,i),n)},n.GetUserData=function(){return this.m_userData},n.SetUserData=function(t){this.m_userData=t},n.ApplyForce=function(t){this.m_system.ApplyForce(this.m_firstIndex,this.m_lastIndex,t)},n.ApplyLinearImpulse=function(t){this.m_system.ApplyLinearImpulse(this.m_firstIndex,this.m_lastIndex,t)},n.DestroyParticles=function(t){if(this.m_system.m_world.IsLocked())throw new Error;for(var e=this.m_firstIndex;e<this.m_lastIndex;e++)this.m_system.DestroyParticle(e,t)},n.UpdateStatistics=function(){if(!this.m_system.m_positionBuffer.data)throw new Error;if(!this.m_system.m_velocityBuffer.data)throw new Error;var t=new Ct,e=new Ct;if(this.m_timestamp!==this.m_system.m_timestamp){var n=this.m_system.GetParticleMass();this.m_mass=n*(this.m_lastIndex-this.m_firstIndex),this.m_center.SetZero(),this.m_linearVelocity.SetZero();for(var i=this.m_firstIndex;i<this.m_lastIndex;i++)this.m_center.SelfMulAdd(n,this.m_system.m_positionBuffer.data[i]),this.m_linearVelocity.SelfMulAdd(n,this.m_system.m_velocityBuffer.data[i]);if(this.m_mass>0){var r=1/this.m_mass;this.m_center.SelfMul(r),this.m_linearVelocity.SelfMul(r)}this.m_inertia=0,this.m_angularVelocity=0;for(var a=this.m_firstIndex;a<this.m_lastIndex;a++)Ct.SubVV(this.m_system.m_positionBuffer.data[a],this.m_center,t),Ct.SubVV(this.m_system.m_velocityBuffer.data[a],this.m_linearVelocity,e),this.m_inertia+=n*Ct.DotVV(t,t),this.m_angularVelocity+=n*Ct.CrossVV(t,e);this.m_inertia>0&&(this.m_angularVelocity*=1/this.m_inertia),this.m_timestamp=this.m_system.m_timestamp}},e}();Br.GetLinearVelocityFromWorldPoint_s_t0=new Ct;var Lr=function(){function t(t){this.m_buffer=[],this.m_front=0,this.m_back=0,this.m_buffer.fill(null,0,t)}var e=t.prototype;return e.Push=function(t){if(this.m_back>=this.m_capacity){for(var e=this.m_front;e<this.m_back;e++)this.m_buffer[e-this.m_front]=this.m_buffer[e];this.m_back-=this.m_front,this.m_front=0}this.m_buffer[this.m_back]=t,this.m_back++},e.Pop=function(){this.m_buffer[this.m_front]=null,this.m_front++},e.Empty=function(){return this.m_front===this.m_back},e.Front=function(){var t=this.m_buffer[this.m_front];if(!t)throw new Error;return t},Q(t,[{key:"m_capacity",get:function(){return this.m_buffer.length}}]),t}(),Fr=function(){function t(t){this.m_generatorCapacity=0,this.m_generatorCount=0,this.m_countX=0,this.m_countY=0,this.m_diagram=[],this.m_generatorBuffer=X(t,(function(){return new Vr})),this.m_generatorCapacity=t}var e=t.prototype;return e.AddGenerator=function(t,e,n){var i=this.m_generatorBuffer[this.m_generatorCount++];i.center.Copy(t),i.tag=e,i.necessary=n},e.Generate=function(t,e){for(var n=1/t,r=new Ct(+i,+i),a=new Ct(-i,-i),o=0,s=0;s<this.m_generatorCount;s++){var c=this.m_generatorBuffer[s];c.necessary&&(Ct.MinV(r,c.center,r),Ct.MaxV(a,c.center,a),++o)}if(0===o)return this.m_countX=0,void(this.m_countY=0);r.x-=e,r.y-=e,a.x+=e,a.y+=e,this.m_countX=1+Math.floor(n*(a.x-r.x)),this.m_countY=1+Math.floor(n*(a.y-r.y)),this.m_diagram=[];for(var l=new Lr(4*this.m_countX*this.m_countY),h=0;h<this.m_generatorCount;h++){var u=this.m_generatorBuffer[h];u.center.SelfSub(r).SelfMul(n);var _=Math.floor(u.center.x),f=Math.floor(u.center.y);_>=0&&f>=0&&_<this.m_countX&&f<this.m_countY&&l.Push(new zr(_,f,_+f*this.m_countX,u))}for(;!l.Empty();){var d=l.Front(),p=d.m_x,m=d.m_y,v=d.m_i,g=d.m_generator;l.Pop(),this.m_diagram[v]||(this.m_diagram[v]=g,p>0&&l.Push(new zr(p-1,m,v-1,g)),m>0&&l.Push(new zr(p,m-1,v-this.m_countX,g)),p<this.m_countX-1&&l.Push(new zr(p+1,m,v+1,g)),m<this.m_countY-1&&l.Push(new zr(p,m+1,v+this.m_countX,g)))}for(var y=0;y<this.m_countY;y++)for(var x=0;x<this.m_countX-1;x++){var S=x+y*this.m_countX,A=this.m_diagram[S],b=this.m_diagram[S+1];A!==b&&(l.Push(new zr(x,y,S,b)),l.Push(new zr(x+1,y,S+1,A)))}for(var C=0;C<this.m_countY-1;C++)for(var T=0;T<this.m_countX;T++){var E=T+C*this.m_countX,w=this.m_diagram[E],I=this.m_diagram[E+this.m_countX];w!==I&&(l.Push(new zr(T,C,E,I)),l.Push(new zr(T,C+1,E+this.m_countX,w)))}for(;!l.Empty();){var P=l.Front(),D=P.m_x,R=P.m_y,M=P.m_i,O=P.m_generator;l.Pop();var N=this.m_diagram[M],B=O;if(N!==B){var L=N.center.x-D,F=N.center.y-R,V=B.center.x-D,z=B.center.y-R;L*L+F*F>V*V+z*z&&(this.m_diagram[M]=B,D>0&&l.Push(new zr(D-1,R,M-1,B)),R>0&&l.Push(new zr(D,R-1,M-this.m_countX,B)),D<this.m_countX-1&&l.Push(new zr(D+1,R,M+1,B)),R<this.m_countY-1&&l.Push(new zr(D,R+1,M+this.m_countX,B)))}}},e.GetNodes=function(t){for(var e=0;e<this.m_countY-1;e++)for(var n=0;n<this.m_countX-1;n++){var i=n+e*this.m_countX,r=this.m_diagram[i],a=this.m_diagram[i+1],o=this.m_diagram[i+this.m_countX],s=this.m_diagram[i+1+this.m_countX];a!==o&&(r!==a&&r!==o&&(r.necessary||a.necessary||o.necessary)&&t(r.tag,a.tag,o.tag),s!==a&&s!==o&&(r.necessary||a.necessary||o.necessary)&&t(a.tag,s.tag,o.tag))}},t}(),Vr=function(){this.center=new Ct,this.tag=0,this.necessary=!1},zr=function(t,e,n,i){this.m_x=t,this.m_y=e,this.m_i=n,this.m_generator=i};function kr(t,e,n){var i=t[e];t[e]=t[n],t[n]=i}function Ur(t,e){return t<e}function Gr(t,e,n,i){void 0===e&&(e=0),void 0===n&&(n=t.length-e),void 0===i&&(i=Ur);for(var r=e,a=[],o=0;;){for(;r+1<n;n++){var s=t[r+Math.floor(Math.random()*(n-r))];a[o++]=n;for(var c=r-1;;){for(;i(t[++c],s););for(;i(s,t[--n]););if(c>=n)break;kr(t,c,n)}}if(0===o)break;r=n,n=a[--o]}return t}function Hr(t,e,n,i){return void 0===e&&(e=0),void 0===n&&(n=t.length-e),void 0===i&&(i=Ur),Gr(t,e,n,i)}function jr(t,e,n){void 0===n&&(n=t.length);for(var i=0,r=0;r<n;++r)e(t[r])||(r!==i?kr(t,i++,r):++i);return i}function Wr(t,e,n,i,r){for(var a=n-e;a>0;){var o=Math.floor(a/2),s=e+o;r(t[s],i)?(e=++s,a-=o+1):a=o}return e}function qr(t,e,n,i,r){for(var a=n-e;a>0;){var o=Math.floor(a/2),s=e+o;r(i,t[s])?a=o:(e=++s,a-=o+1)}return e}function Xr(t,e,n,i){for(var r=n;e!==r;)kr(t,e++,r++),r===i?r=n:e===n&&(n=r)}function Yr(t,e,n,i){if(e===n)return n;for(var r=e;++e!==n;)i(t[r],t[e])||kr(t,++r,e);return++r}var Kr=function(){function t(t){this.data=[],this.count=0,this.capacity=0,this.allocator=t}var e=t.prototype;return e.Append=function(){return this.count>=this.capacity&&this.Grow(),this.count++},e.Reserve=function(t){if(!(this.capacity>=t)){for(var e=this.capacity;e<t;++e)this.data[e]=this.allocator();this.capacity=t}},e.Grow=function(){var t=this.capacity?2*this.capacity:O;this.Reserve(t)},e.Free=function(){0!==this.data.length&&(this.data=[],this.capacity=0,this.count=0)},e.Shorten=function(){},e.Data=function(){return this.data},e.GetCount=function(){return this.count},e.SetCount=function(t){this.count=t},e.GetCapacity=function(){return this.capacity},e.RemoveIf=function(t){this.count=jr(this.data,t,this.count)},e.Unique=function(t){this.count=Yr(this.data,0,this.count,t)},t}(),Jr=function(t){function e(e){var n;return(n=t.call(this)||this).m_system=e,n}$(e,t);var n=e.prototype;return n.ShouldQueryParticleSystem=function(){return!1},n.ReportFixture=function(t){if(t.IsSensor())return!0;for(var e=t.GetShape().GetChildCount(),n=0;n<e;n++)for(var i=t.GetAABB(n),r=this.m_system.GetInsideBoundsEnumerator(i),a=void 0;(a=r.GetNext())>=0;)this.ReportFixtureAndParticle(t,n,a);return!0},n.ReportParticle=function(){return!1},n.ReportFixtureAndParticle=function(){},e}(fr),Qr=function(){function t(){this.indexA=0,this.indexB=0,this.weight=0,this.normal=new Ct,this.flags=0}var e=t.prototype;return e.SetIndices=function(t,e){this.indexA=t,this.indexB=e},e.SetWeight=function(t){this.weight=t},e.SetNormal=function(t){this.normal.Copy(t)},e.SetFlags=function(t){this.flags=t},e.GetIndexA=function(){return this.indexA},e.GetIndexB=function(){return this.indexB},e.GetWeight=function(){return this.weight},e.GetNormal=function(){return this.normal},e.GetFlags=function(){return this.flags},e.IsEqual=function(t){return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&this.weight===t.weight&&this.normal.x===t.normal.x&&this.normal.y===t.normal.y},e.IsNotEqual=function(t){return!this.IsEqual(t)},e.ApproximatelyEqual=function(t){var e=.01,n=1e-4;return this.indexA===t.indexA&&this.indexB===t.indexB&&this.flags===t.flags&&et(this.weight-t.weight)<e&&Ct.DistanceSquaredVV(this.normal,t.normal)<n},t}(),Zr=function(){this.index=0,this.weight=0,this.normal=new Ct,this.mass=0},$r=function(){this.indexA=0,this.indexB=0,this.flags=0,this.strength=0,this.distance=0},ta=function(){this.indexA=0,this.indexB=0,this.indexC=0,this.flags=0,this.strength=0,this.pa=new Ct(0,0),this.pb=new Ct(0,0),this.pc=new Ct(0,0),this.ka=0,this.kb=0,this.kc=0,this.s=0},ea=function(){function t(){this.strictContactCheck=!1,this.density=1,this.gravityScale=1,this.radius=1,this.maxCount=0,this.pressureStrength=.005,this.dampingStrength=1,this.elasticStrength=.25,this.springStrength=.25,this.viscousStrength=.25,this.surfaceTensionPressureStrength=.2,this.surfaceTensionNormalStrength=.2,this.repulsiveStrength=1,this.powderStrength=.5,this.ejectionStrength=.5,this.staticPressureStrength=.2,this.staticPressureRelaxation=.2,this.staticPressureIterations=8,this.colorMixingStrength=.5,this.destroyByAge=!0,this.lifetimeGranularity=1/60}var e=t.prototype;return e.Copy=function(t){return this.strictContactCheck=t.strictContactCheck,this.density=t.density,this.gravityScale=t.gravityScale,this.radius=t.radius,this.maxCount=t.maxCount,this.pressureStrength=t.pressureStrength,this.dampingStrength=t.dampingStrength,this.elasticStrength=t.elasticStrength,this.springStrength=t.springStrength,this.viscousStrength=t.viscousStrength,this.surfaceTensionPressureStrength=t.surfaceTensionPressureStrength,this.surfaceTensionNormalStrength=t.surfaceTensionNormalStrength,this.repulsiveStrength=t.repulsiveStrength,this.powderStrength=t.powderStrength,this.ejectionStrength=t.ejectionStrength,this.staticPressureStrength=t.staticPressureStrength,this.staticPressureRelaxation=t.staticPressureRelaxation,this.staticPressureIterations=t.staticPressureIterations,this.colorMixingStrength=t.colorMixingStrength,this.destroyByAge=t.destroyByAge,this.lifetimeGranularity=t.lifetimeGranularity,this},e.Clone=function(){return(new t).Copy(this)},t}(),na=function(){function e(t,e){this.m_paused=!1,this.m_timestamp=0,this.m_allParticleFlags=0,this.m_needsUpdateAllParticleFlags=!1,this.m_allGroupFlags=0,this.m_needsUpdateAllGroupFlags=!1,this.m_hasForce=!1,this.m_iterationIndex=0,this.m_inverseDensity=0,this.m_particleDiameter=0,this.m_inverseDiameter=0,this.m_squaredDiameter=0,this.m_count=0,this.m_internalAllocatedCapacity=0,this.m_handleIndexBuffer=new ia,this.m_flagsBuffer=new ia,this.m_positionBuffer=new ia,this.m_velocityBuffer=new ia,this.m_forceBuffer=[],this.m_weightBuffer=[],this.m_staticPressureBuffer=[],this.m_accumulationBuffer=[],this.m_accumulation2Buffer=[],this.m_depthBuffer=[],this.m_colorBuffer=new ia,this.m_groupBuffer=[],this.m_userDataBuffer=new ia,this.m_stuckThreshold=0,this.m_lastBodyContactStepBuffer=new ia,this.m_bodyContactCountBuffer=new ia,this.m_consecutiveContactStepsBuffer=new ia,this.m_stuckParticleBuffer=new Kr((function(){return 0})),this.m_proxyBuffer=new Kr((function(){return new ra})),this.m_contactBuffer=new Kr((function(){return new Qr})),this.m_bodyContactBuffer=new Kr((function(){return new Zr})),this.m_pairBuffer=new Kr((function(){return new $r})),this.m_triadBuffer=new Kr((function(){return new ta})),this.m_expirationTimeBuffer=new ia,this.m_indexByExpirationTimeBuffer=new ia,this.m_timeElapsed=0,this.m_expirationTimeBufferRequiresSorting=!1,this.m_groupCount=0,this.m_groupList=null,this.m_def=new ea,this.m_prev=null,this.m_next=null,this.UpdateBodyContacts_callback=null,this.SolveCollision_callback=null,this.SetStrictContactCheck(t.strictContactCheck),this.SetDensity(t.density),this.SetGravityScale(t.gravityScale),this.SetRadius(t.radius),this.SetMaxParticleCount(t.maxCount),this.m_def=t.Clone(),this.m_world=e,this.SetDestructionByAge(this.m_def.destroyByAge)}e.computeTag=function(t,n){return(n+e.yOffset>>>0<<e.yShift)+(e.xScale*t+e.xOffset>>>0)>>>0},e.computeRelativeTag=function(t,n,i){return t+(i<<e.yShift)+(n<<e.xShift)>>>0};var r=e.prototype;return r.Drop=function(){for(;this.m_groupList;)this.DestroyParticleGroup(this.m_groupList);this.FreeUserOverridableBuffer(this.m_handleIndexBuffer),this.FreeUserOverridableBuffer(this.m_flagsBuffer),this.FreeUserOverridableBuffer(this.m_lastBodyContactStepBuffer),this.FreeUserOverridableBuffer(this.m_bodyContactCountBuffer),this.FreeUserOverridableBuffer(this.m_consecutiveContactStepsBuffer),this.FreeUserOverridableBuffer(this.m_positionBuffer),this.FreeUserOverridableBuffer(this.m_velocityBuffer),this.FreeUserOverridableBuffer(this.m_colorBuffer),this.FreeUserOverridableBuffer(this.m_userDataBuffer),this.FreeUserOverridableBuffer(this.m_expirationTimeBuffer),this.FreeUserOverridableBuffer(this.m_indexByExpirationTimeBuffer),this.FreeBuffer(this.m_forceBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_weightBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_staticPressureBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulationBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_accumulation2Buffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_depthBuffer,this.m_internalAllocatedCapacity),this.FreeBuffer(this.m_groupBuffer,this.m_internalAllocatedCapacity)},r.CreateParticle=function(t){if(this.m_world.IsLocked())throw new Error;if(this.m_count>=this.m_internalAllocatedCapacity){var e=this.m_count?2*this.m_count:O;this.ReallocateInternalAllocatedBuffers(e)}if(this.m_count>=this.m_internalAllocatedCapacity){if(!this.m_def.destroyByAge)return T;this.DestroyOldestParticle(0,!1),this.SolveZombie()}var i=this.m_count++;this.m_flagsBuffer.data[i]=0,this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[i]=0),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[i]=0),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[i]=0),this.m_positionBuffer.data[i]=(this.m_positionBuffer.data[i]||new Ct).Copy(n(t.position,Ct.ZERO)),this.m_velocityBuffer.data[i]=(this.m_velocityBuffer.data[i]||new Ct).Copy(n(t.velocity,Ct.ZERO)),this.m_weightBuffer[i]=0,this.m_forceBuffer[i]=(this.m_forceBuffer[i]||new Ct).SetZero(),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[i]=0),this.m_depthBuffer&&(this.m_depthBuffer[i]=0);var r=(new Ot).Copy(n(t.color,Ot.ZERO));!this.m_colorBuffer.data&&r.IsZero()||(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data[i]=(this.m_colorBuffer.data[i]||new Ot).Copy(r)),(this.m_userDataBuffer.data||t.userData)&&(this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data[i]=t.userData),this.m_handleIndexBuffer.data&&(this.m_handleIndexBuffer.data[i]=null);var a=this.m_proxyBuffer.data[this.m_proxyBuffer.Append()],o=n(t.lifetime,0),s=o>0;(this.m_expirationTimeBuffer.data||s)&&(this.SetParticleLifetime(i,s?o:this.ExpirationTimeToLifetime(-this.GetQuantizedTimeElapsed())),this.m_indexByExpirationTimeBuffer.data[i]=i),a.index=i;var c=n(t.group,null);return this.m_groupBuffer[i]=c,c&&(c.m_firstIndex<c.m_lastIndex?(this.RotateBuffer(c.m_firstIndex,c.m_lastIndex,i),c.m_lastIndex=i+1):(c.m_firstIndex=i,c.m_lastIndex=i+1)),this.SetParticleFlags(i,n(t.flags,0)),i},r.GetParticleHandleFromIndex=function(t){this.m_handleIndexBuffer.data=this.RequestBuffer(this.m_handleIndexBuffer.data);var e=this.m_handleIndexBuffer.data[t];return e||((e=new Or).SetIndex(t),this.m_handleIndexBuffer.data[t]=e,e)},r.DestroyParticle=function(e,n){void 0===n&&(n=!1);var i=t.b2ParticleFlag.b2_zombieParticle;n&&(i|=t.b2ParticleFlag.b2_destructionListenerParticle),this.SetParticleFlags(e,this.m_flagsBuffer.data[e]|i)},r.DestroyOldestParticle=function(t,e){void 0===e&&(e=!1);var n=this.GetParticleCount(),i=this.m_indexByExpirationTimeBuffer.data[n-(t+1)],r=this.m_indexByExpirationTimeBuffer.data[t];this.DestroyParticle(this.m_expirationTimeBuffer.data[i]>0?i:r,e)},r.DestroyParticlesInShape=function(t,n,i){void 0===i&&(i=!1);var r=e.DestroyParticlesInShape_s_aabb;if(this.m_world.IsLocked())throw new Error;var a=new fa(this,t,n,i),o=r;return t.ComputeAABB(o,n,0),this.m_world.QueryAABB(a,o),a.Destroyed()},r.CreateParticleGroup=function(t){var i=e.CreateParticleGroup_s_transform;if(this.m_world.IsLocked())throw new Error;var r=i;r.SetPositionAngle(n(t.position,Ct.ZERO),n(t.angle,0));var a=this.m_count;if(t.shape&&this.CreateParticlesWithShapeForGroup(t.shape,t,r),t.shapes&&this.CreateParticlesWithShapesForGroup(t.shapes,n(t.shapeCount,t.shapes.length),t,r),t.positionData)for(var o=n(t.particleCount,t.positionData.length),s=0;s<o;s++){var c=t.positionData[s];this.CreateParticleForGroup(t,r,c)}var l=this.m_count,h=new Br(this);h.m_firstIndex=a,h.m_lastIndex=l,h.m_strength=n(t.strength,1),h.m_userData=t.userData,h.m_transform.Copy(r),h.m_prev=null,h.m_next=this.m_groupList,this.m_groupList&&(this.m_groupList.m_prev=h),this.m_groupList=h,++this.m_groupCount;for(var u=a;u<l;u++)this.m_groupBuffer[u]=h;this.SetGroupFlags(h,n(t.groupFlags,0));var _=new _a;return this.UpdateContacts(!0),this.UpdatePairsAndTriads(a,l,_),t.group&&(this.JoinParticleGroups(t.group,h),h=t.group),h},r.JoinParticleGroups=function(t,e){if(this.m_world.IsLocked())throw new Error;this.RotateBuffer(e.m_firstIndex,e.m_lastIndex,this.m_count),this.RotateBuffer(t.m_firstIndex,t.m_lastIndex,e.m_firstIndex);var n=new da(e.m_firstIndex);this.UpdateContacts(!0),this.UpdatePairsAndTriads(t.m_firstIndex,e.m_lastIndex,n);for(var i=e.m_firstIndex;i<e.m_lastIndex;i++)this.m_groupBuffer[i]=t;var r=t.m_groupFlags|e.m_groupFlags;this.SetGroupFlags(t,r),t.m_lastIndex=e.m_lastIndex,e.m_firstIndex=e.m_lastIndex,this.DestroyParticleGroup(e)},r.SplitParticleGroup=function(t){this.UpdateContacts(!0);var n=X(t.GetParticleCount(),(function(){return new oa}));e.InitializeParticleLists(t,n),this.MergeParticleListsInContact(t,n);var i=e.FindLongestParticleList(t,n);this.MergeZombieParticleListNodes(t,n,i),this.CreateParticleGroupsFromParticleList(t,n,i),this.UpdatePairsAndTriadsWithParticleList(t,n)},r.GetParticleGroupList=function(){return this.m_groupList},r.GetParticleGroupCount=function(){return this.m_groupCount},r.GetParticleCount=function(){return this.m_count},r.GetMaxParticleCount=function(){return this.m_def.maxCount},r.SetMaxParticleCount=function(t){this.m_def.maxCount=t},r.GetAllParticleFlags=function(){return this.m_allParticleFlags},r.GetAllGroupFlags=function(){return this.m_allGroupFlags},r.SetPaused=function(t){this.m_paused=t},r.GetPaused=function(){return this.m_paused},r.SetDensity=function(t){this.m_def.density=t,this.m_inverseDensity=1/this.m_def.density},r.GetDensity=function(){return this.m_def.density},r.SetGravityScale=function(t){this.m_def.gravityScale=t},r.GetGravityScale=function(){return this.m_def.gravityScale},r.SetDamping=function(t){this.m_def.dampingStrength=t},r.GetDamping=function(){return this.m_def.dampingStrength},r.SetStaticPressureIterations=function(t){this.m_def.staticPressureIterations=t},r.GetStaticPressureIterations=function(){return this.m_def.staticPressureIterations},r.SetRadius=function(t){this.m_particleDiameter=2*t,this.m_squaredDiameter=this.m_particleDiameter*this.m_particleDiameter,this.m_inverseDiameter=1/this.m_particleDiameter},r.GetRadius=function(){return this.m_particleDiameter/2},r.GetPositionBuffer=function(){return this.m_positionBuffer.data},r.GetVelocityBuffer=function(){return this.m_velocityBuffer.data},r.GetColorBuffer=function(){return this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data),this.m_colorBuffer.data},r.GetGroupBuffer=function(){return this.m_groupBuffer},r.GetWeightBuffer=function(){return this.m_weightBuffer},r.GetUserDataBuffer=function(){return this.m_userDataBuffer.data=this.RequestBuffer(this.m_userDataBuffer.data),this.m_userDataBuffer.data},r.GetFlagsBuffer=function(){return this.m_flagsBuffer.data},r.SetParticleFlags=function(e,n){this.m_flagsBuffer.data[e]&~n&&(this.m_needsUpdateAllParticleFlags=!0),~this.m_allParticleFlags&n&&(n&t.b2ParticleFlag.b2_tensileParticle&&(this.m_accumulation2Buffer=this.RequestBuffer(this.m_accumulation2Buffer)),n&t.b2ParticleFlag.b2_colorMixingParticle&&(this.m_colorBuffer.data=this.RequestBuffer(this.m_colorBuffer.data)),this.m_allParticleFlags|=n),this.m_flagsBuffer.data[e]=n},r.GetParticleFlags=function(t){return this.m_flagsBuffer.data[t]},r.SetFlagsBuffer=function(t){this.SetUserOverridableBuffer(this.m_flagsBuffer,t)},r.SetPositionBuffer=function(t){if(t instanceof Float32Array){if(t.length%2!=0)throw new Error;for(var e=t.length/2,n=new Array(e),i=0;i<e;++i)n[i]=new Ct(t.subarray(2*i,2*i+2));t=n}this.SetUserOverridableBuffer(this.m_positionBuffer,t)},r.SetVelocityBuffer=function(t){if(t instanceof Float32Array){if(t.length%2!=0)throw new Error;for(var e=t.length/2,n=new Array(e),i=0;i<e;++i)n[i]=new Ct(t.subarray(2*i,2*i+2));t=n}this.SetUserOverridableBuffer(this.m_velocityBuffer,t)},r.SetColorBuffer=function(t){if(t instanceof Float32Array){if(t.length%4!=0)throw new Error;for(var e=t.length/4,n=new Array(e),i=0;i<e;++i)n[i]=new Ot(t.subarray(4*i,4*i+4));t=n}this.SetUserOverridableBuffer(this.m_colorBuffer,t)},r.SetUserDataBuffer=function(t){this.SetUserOverridableBuffer(this.m_userDataBuffer,t)},r.GetContacts=function(){return this.m_contactBuffer.data},r.GetContactCount=function(){return this.m_contactBuffer.count},r.GetBodyContacts=function(){return this.m_bodyContactBuffer.data},r.GetBodyContactCount=function(){return this.m_bodyContactBuffer.count},r.GetPairs=function(){return this.m_pairBuffer.data},r.GetPairCount=function(){return this.m_pairBuffer.count},r.GetTriads=function(){return this.m_triadBuffer.data},r.GetTriadCount=function(){return this.m_triadBuffer.count},r.SetStuckThreshold=function(t){this.m_stuckThreshold=t,t>0&&(this.m_lastBodyContactStepBuffer.data=this.RequestBuffer(this.m_lastBodyContactStepBuffer.data),this.m_bodyContactCountBuffer.data=this.RequestBuffer(this.m_bodyContactCountBuffer.data),this.m_consecutiveContactStepsBuffer.data=this.RequestBuffer(this.m_consecutiveContactStepsBuffer.data))},r.GetStuckCandidates=function(){return this.m_stuckParticleBuffer.Data()},r.GetStuckCandidateCount=function(){return this.m_stuckParticleBuffer.GetCount()},r.ComputeCollisionEnergy=function(){for(var t=e.ComputeCollisionEnergy_s_v,n=this.m_velocityBuffer.data,i=0,r=0;r<this.m_contactBuffer.count;r++){var a=this.m_contactBuffer.data[r],o=a.indexA,s=a.indexB,c=a.normal,l=Ct.SubVV(n[s],n[o],t),h=Ct.DotVV(l,c);h<0&&(i+=h*h)}return.5*this.GetParticleMass()*i},r.SetStrictContactCheck=function(t){this.m_def.strictContactCheck=t},r.GetStrictContactCheck=function(){return this.m_def.strictContactCheck},r.SetParticleLifetime=function(t,e){var n=null===this.m_indexByExpirationTimeBuffer.data;if(this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),n)for(var i=this.GetParticleCount(),r=0;r<i;++r)this.m_indexByExpirationTimeBuffer.data[r]=r;var a=e/this.m_def.lifetimeGranularity,o=a>0?this.GetQuantizedTimeElapsed()+a:a;o!==this.m_expirationTimeBuffer.data[t]&&(this.m_expirationTimeBuffer.data[t]=o,this.m_expirationTimeBufferRequiresSorting=!0)},r.GetParticleLifetime=function(t){return this.ExpirationTimeToLifetime(this.GetExpirationTimeBuffer()[t])},r.SetDestructionByAge=function(t){t&&this.GetExpirationTimeBuffer(),this.m_def.destroyByAge=t},r.GetDestructionByAge=function(){return this.m_def.destroyByAge},r.GetExpirationTimeBuffer=function(){return this.m_expirationTimeBuffer.data=this.RequestBuffer(this.m_expirationTimeBuffer.data),this.m_expirationTimeBuffer.data},r.ExpirationTimeToLifetime=function(t){return(t>0?t-this.GetQuantizedTimeElapsed():t)*this.m_def.lifetimeGranularity},r.GetIndexByExpirationTimeBuffer=function(){return this.GetParticleCount()?this.SetParticleLifetime(0,this.GetParticleLifetime(0)):this.m_indexByExpirationTimeBuffer.data=this.RequestBuffer(this.m_indexByExpirationTimeBuffer.data),this.m_indexByExpirationTimeBuffer.data},r.ParticleApplyLinearImpulse=function(t,e){this.ApplyLinearImpulse(t,t+1,e)},r.ApplyLinearImpulse=function(t,e,n){for(var i=this.m_velocityBuffer.data,r=(e-t)*this.GetParticleMass(),a=(new Ct).Copy(n).SelfMul(1/r),o=t;o<e;o++)i[o].SelfAdd(a)},e.IsSignificantForce=function(t){return 0!==t.x||0!==t.y},r.ParticleApplyForce=function(t,n){e.IsSignificantForce(n)&&this.ForceCanBeApplied(this.m_flagsBuffer.data[t])&&(this.PrepareForceBuffer(),this.m_forceBuffer[t].SelfAdd(n))},r.ApplyForce=function(t,n,i){var r=(new Ct).Copy(i).SelfMul(1/(n-t));if(e.IsSignificantForce(r)){this.PrepareForceBuffer();for(var a=t;a<n;a++)this.m_forceBuffer[a].SelfAdd(r)}},r.GetNext=function(){return this.m_next},r.QueryAABB=function(t,n){if(0!==this.m_proxyBuffer.count)for(var i=0,r=this.m_proxyBuffer.count,a=Wr(this.m_proxyBuffer.data,i,r,e.computeTag(this.m_inverseDiameter*n.lowerBound.x,this.m_inverseDiameter*n.lowerBound.y),ra.CompareProxyTag),o=qr(this.m_proxyBuffer.data,a,r,e.computeTag(this.m_inverseDiameter*n.upperBound.x,this.m_inverseDiameter*n.upperBound.y),ra.CompareTagProxy),s=this.m_positionBuffer.data,c=a;c<o;++c){var l=this.m_proxyBuffer.data[c].index,h=s[l];if(n.lowerBound.x<h.x&&h.x<n.upperBound.x&&n.lowerBound.y<h.y&&h.y<n.upperBound.y&&!t.ReportParticle(this,l))break}},r.QueryShapeAABB=function(t,n,i,r){void 0===r&&(r=0);var a=e.QueryShapeAABB_s_aabb;n.ComputeAABB(a,i,r),this.QueryAABB(t,a)},r.QueryPointAABB=function(t,n,i){void 0===i&&(i=u);var r=e.QueryPointAABB_s_aabb;r.lowerBound.Set(n.x-i,n.y-i),r.upperBound.Set(n.x+i,n.y+i),this.QueryAABB(t,r)},r.RayCast=function(t,n,i){var r=e.RayCast_s_aabb,a=e.RayCast_s_p,o=e.RayCast_s_v,s=e.RayCast_s_n,c=e.RayCast_s_point;if(0!==this.m_proxyBuffer.count){var l=this.m_positionBuffer.data,h=r;Ct.MinV(n,i,h.lowerBound),Ct.MaxV(n,i,h.upperBound);for(var u,_=1,f=Ct.SubVV(i,n,o),d=Ct.DotVV(f,f),p=this.GetInsideBoundsEnumerator(h);(u=p.GetNext())>=0;){var m=Ct.SubVV(n,l[u],a),v=Ct.DotVV(m,f),g=v*v-d*(Ct.DotVV(m,m)-this.m_squaredDiameter);if(g>=0){var y=ut(g),x=(-v-y)/d;if(x>_)continue;if(x<0&&((x=(-v+y)/d)<0||x>_))continue;var S=Ct.AddVMulSV(m,x,f,s);if(S.Normalize(),(_=nt(_,t.ReportParticle(this,u,Ct.AddVMulSV(n,x,f,c),S,x)))<=0)break}}}},r.ComputeAABB=function(t){var e=this.GetParticleCount();t.lowerBound.x=+i,t.lowerBound.y=+i,t.upperBound.x=-i,t.upperBound.y=-i;for(var n=this.m_positionBuffer.data,r=0;r<e;r++){var a=n[r];Ct.MinV(t.lowerBound,a,t.lowerBound),Ct.MaxV(t.upperBound,a,t.upperBound)}t.lowerBound.x-=this.m_particleDiameter,t.lowerBound.y-=this.m_particleDiameter,t.upperBound.x+=this.m_particleDiameter,t.upperBound.y+=this.m_particleDiameter},r.FreeBuffer=function(t){null!==t&&(t.length=0)},r.FreeUserOverridableBuffer=function(t){0===t.userSuppliedCapacity&&this.FreeBuffer(t.data,this.m_internalAllocatedCapacity)},r.ReallocateBuffer3=function(t,e,n){if(n<=e)throw new Error;var i=t?t.slice():[];return i.length=n,i},r.ReallocateBuffer5=function(t,e,n,i,r){if(i<=n)throw new Error;if(e&&!(i<=e))throw new Error;return r&&!t||e||(t=this.ReallocateBuffer3(t,n,i)),t},r.ReallocateBuffer4=function(t,e,n,i){return this.ReallocateBuffer5(t.data,t.userSuppliedCapacity,e,n,i)},r.RequestBuffer=function(t){return t||(0===this.m_internalAllocatedCapacity&&this.ReallocateInternalAllocatedBuffers(O),(t=[]).length=this.m_internalAllocatedCapacity),t},r.ReallocateHandleBuffers=function(t){this.m_handleIndexBuffer.data=this.ReallocateBuffer4(this.m_handleIndexBuffer,this.m_internalAllocatedCapacity,t,!0)},r.ReallocateInternalAllocatedBuffers=function(t){function e(t,e){return e&&t>e?e:t}if(t=e(t,this.m_def.maxCount),t=e(t,this.m_flagsBuffer.userSuppliedCapacity),t=e(t,this.m_positionBuffer.userSuppliedCapacity),t=e(t,this.m_velocityBuffer.userSuppliedCapacity),t=e(t,this.m_colorBuffer.userSuppliedCapacity),t=e(t,this.m_userDataBuffer.userSuppliedCapacity),this.m_internalAllocatedCapacity<t){this.ReallocateHandleBuffers(t),this.m_flagsBuffer.data=this.ReallocateBuffer4(this.m_flagsBuffer,this.m_internalAllocatedCapacity,t,!1);var n=this.m_stuckThreshold>0;this.m_lastBodyContactStepBuffer.data=this.ReallocateBuffer4(this.m_lastBodyContactStepBuffer,this.m_internalAllocatedCapacity,t,n),this.m_bodyContactCountBuffer.data=this.ReallocateBuffer4(this.m_bodyContactCountBuffer,this.m_internalAllocatedCapacity,t,n),this.m_consecutiveContactStepsBuffer.data=this.ReallocateBuffer4(this.m_consecutiveContactStepsBuffer,this.m_internalAllocatedCapacity,t,n),this.m_positionBuffer.data=this.ReallocateBuffer4(this.m_positionBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_velocityBuffer.data=this.ReallocateBuffer4(this.m_velocityBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_forceBuffer=this.ReallocateBuffer5(this.m_forceBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_weightBuffer=this.ReallocateBuffer5(this.m_weightBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_staticPressureBuffer=this.ReallocateBuffer5(this.m_staticPressureBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_accumulationBuffer=this.ReallocateBuffer5(this.m_accumulationBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_accumulation2Buffer=this.ReallocateBuffer5(this.m_accumulation2Buffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_depthBuffer=this.ReallocateBuffer5(this.m_depthBuffer,0,this.m_internalAllocatedCapacity,t,!0),this.m_colorBuffer.data=this.ReallocateBuffer4(this.m_colorBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_groupBuffer=this.ReallocateBuffer5(this.m_groupBuffer,0,this.m_internalAllocatedCapacity,t,!1),this.m_userDataBuffer.data=this.ReallocateBuffer4(this.m_userDataBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_expirationTimeBuffer.data=this.ReallocateBuffer4(this.m_expirationTimeBuffer,this.m_internalAllocatedCapacity,t,!0),this.m_indexByExpirationTimeBuffer.data=this.ReallocateBuffer4(this.m_indexByExpirationTimeBuffer,this.m_internalAllocatedCapacity,t,!1),this.m_internalAllocatedCapacity=t}},r.CreateParticleForGroup=function(t,e,i){var r=new Dr;r.flags=n(t.flags,0),Dt.MulXV(e,i,r.position),Ct.AddVV(n(t.linearVelocity,Ct.ZERO),Ct.CrossSV(n(t.angularVelocity,0),Ct.SubVV(r.position,n(t.position,Ct.ZERO),Ct.s_t0),Ct.s_t0),r.velocity),r.color.Copy(n(t.color,Ot.ZERO)),r.lifetime=n(t.lifetime,0),r.userData=t.userData,this.CreateParticle(r)},r.CreateParticlesStrokeShapeForGroup=function(i,r,a){var o=e.CreateParticlesStrokeShapeForGroup_s_edge,s=e.CreateParticlesStrokeShapeForGroup_s_d,c=e.CreateParticlesStrokeShapeForGroup_s_p,l=n(r.stride,0);0===l&&(l=this.GetParticleStride());for(var h=0,u=i.GetChildCount(),_=0;_<u;_++){var f=null;i.GetType()===t.b2ShapeType.e_edgeShape?f=i:(f=o,i.GetChildEdge(f,_));for(var d=Ct.SubVV(f.m_vertex2,f.m_vertex1,s),p=d.Length();h<p;){var m=Ct.AddVMulSV(f.m_vertex1,h/p,d,c);this.CreateParticleForGroup(r,a,m),h+=l}h-=p}},r.CreateParticlesFillShapeForGroup=function(t,i,r){var a=e.CreateParticlesFillShapeForGroup_s_aabb,o=e.CreateParticlesFillShapeForGroup_s_p,s=n(i.stride,0);0===s&&(s=this.GetParticleStride());var c=Dt.IDENTITY,l=a;t.ComputeAABB(l,c,0);for(var h=Math.floor(l.lowerBound.y/s)*s;h<l.upperBound.y;h+=s)for(var u=Math.floor(l.lowerBound.x/s)*s;u<l.upperBound.x;u+=s){var _=o.Set(u,h);t.TestPoint(c,_)&&this.CreateParticleForGroup(i,r,_)}},r.CreateParticlesWithShapeForGroup=function(e,n,i){switch(e.GetType()){case t.b2ShapeType.e_edgeShape:case t.b2ShapeType.e_chainShape:this.CreateParticlesStrokeShapeForGroup(e,n,i);break;case t.b2ShapeType.e_polygonShape:case t.b2ShapeType.e_circleShape:this.CreateParticlesFillShapeForGroup(e,n,i)}},r.CreateParticlesWithShapesForGroup=function(t,e,n,i){var r=new pa(t,e);this.CreateParticlesFillShapeForGroup(r,n,i)},r.CloneParticle=function(t,e){var n=new Dr;n.flags=this.m_flagsBuffer.data[t],n.position.Copy(this.m_positionBuffer.data[t]),n.velocity.Copy(this.m_velocityBuffer.data[t]),this.m_colorBuffer.data&&n.color.Copy(this.m_colorBuffer.data[t]),this.m_userDataBuffer.data&&(n.userData=this.m_userDataBuffer.data[t]),n.group=e;var i=this.CreateParticle(n);if(this.m_handleIndexBuffer.data){var r=this.m_handleIndexBuffer.data[t];r&&r.SetIndex(i),this.m_handleIndexBuffer.data[i]=r,this.m_handleIndexBuffer.data[t]=null}return this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[i]=this.m_lastBodyContactStepBuffer.data[t]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[i]=this.m_bodyContactCountBuffer.data[t]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[i]=this.m_consecutiveContactStepsBuffer.data[t]),this.m_hasForce&&this.m_forceBuffer[i].Copy(this.m_forceBuffer[t]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[i]=this.m_staticPressureBuffer[t]),this.m_depthBuffer&&(this.m_depthBuffer[i]=this.m_depthBuffer[t]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[i]=this.m_expirationTimeBuffer.data[t]),i},r.DestroyParticlesInGroup=function(t,e){void 0===e&&(e=!1);for(var n=t.m_firstIndex;n<t.m_lastIndex;n++)this.DestroyParticle(n,e)},r.DestroyParticleGroup=function(t){this.m_world.m_destructionListener&&this.m_world.m_destructionListener.SayGoodbyeParticleGroup(t),this.SetGroupFlags(t,0);for(var e=t.m_firstIndex;e<t.m_lastIndex;e++)this.m_groupBuffer[e]=null;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_groupList&&(this.m_groupList=t.m_next),--this.m_groupCount},e.ParticleCanBeConnected=function(e,n){return 0!=(e&(t.b2ParticleFlag.b2_wallParticle|t.b2ParticleFlag.b2_springParticle|t.b2ParticleFlag.b2_elasticParticle))||null!==n&&0!=(n.GetGroupFlags()&t.b2ParticleGroupFlag.b2_rigidParticleGroup)},r.UpdatePairsAndTriads=function(n,i,r){for(var a=e.UpdatePairsAndTriads_s_dab,o=e.UpdatePairsAndTriads_s_dbc,s=e.UpdatePairsAndTriads_s_dca,c=this.m_positionBuffer.data,l=0,h=n;h<i;h++)l|=this.m_flagsBuffer.data[h];if(l&e.k_pairFlags)for(var u=0;u<this.m_contactBuffer.count;u++){var _=this.m_contactBuffer.data[u],f=_.indexA,d=_.indexB,p=this.m_flagsBuffer.data[f],m=this.m_flagsBuffer.data[d],v=this.m_groupBuffer[f],g=this.m_groupBuffer[d];if(f>=n&&f<i&&d>=n&&d<i&&!((p|m)&t.b2ParticleFlag.b2_zombieParticle)&&(p|m)&e.k_pairFlags&&(r.IsNecessary(f)||r.IsNecessary(d))&&e.ParticleCanBeConnected(p,v)&&e.ParticleCanBeConnected(m,g)&&r.ShouldCreatePair(f,d)){var y=this.m_pairBuffer.data[this.m_pairBuffer.Append()];y.indexA=f,y.indexB=d,y.flags=_.flags,y.strength=nt(v?v.m_strength:1,g?g.m_strength:1),y.distance=Ct.DistanceVV(c[f],c[d])}Hr(this.m_pairBuffer.data,0,this.m_pairBuffer.count,e.ComparePairIndices),this.m_pairBuffer.Unique(e.MatchPairIndices)}if(l&e.k_triadFlags){for(var x=new Fr(i-n),S=n;S<i;S++){var A=this.m_flagsBuffer.data[S],b=this.m_groupBuffer[S];A&t.b2ParticleFlag.b2_zombieParticle||!e.ParticleCanBeConnected(A,b)||x.AddGenerator(c[S],S,r.IsNecessary(S))}var C=this.GetParticleStride();x.Generate(C/2,2*C);var T=this,E=function(t,n,i){var l=T.m_flagsBuffer.data[t],h=T.m_flagsBuffer.data[n],u=T.m_flagsBuffer.data[i];if((l|h|u)&e.k_triadFlags&&r.ShouldCreateTriad(t,n,i)){var _=c[t],f=c[n],d=c[i],p=Ct.SubVV(_,f,a),m=Ct.SubVV(f,d,o),v=Ct.SubVV(d,_,s),g=M*T.m_squaredDiameter;if(Ct.DotVV(p,p)>g||Ct.DotVV(m,m)>g||Ct.DotVV(v,v)>g)return;var y=T.m_groupBuffer[t],x=T.m_groupBuffer[n],S=T.m_groupBuffer[i],A=T.m_triadBuffer.data[T.m_triadBuffer.Append()];A.indexA=t,A.indexB=n,A.indexC=i,A.flags=l|h|u,A.strength=nt(nt(y?y.m_strength:1,x?x.m_strength:1),S?S.m_strength:1);var b=(_.x+f.x+d.x)/3,C=(_.y+f.y+d.y)/3;A.pa.x=_.x-b,A.pa.y=_.y-C,A.pb.x=f.x-b,A.pb.y=f.y-C,A.pc.x=d.x-b,A.pc.y=d.y-C,A.ka=-Ct.DotVV(v,p),A.kb=-Ct.DotVV(p,m),A.kc=-Ct.DotVV(m,v),A.s=Ct.CrossVV(_,f)+Ct.CrossVV(f,d)+Ct.CrossVV(d,_)}};x.GetNodes(E),Hr(this.m_triadBuffer.data,0,this.m_triadBuffer.count,e.CompareTriadIndices),this.m_triadBuffer.Unique(e.MatchTriadIndices)}},r.UpdatePairsAndTriadsWithReactiveParticles=function(){var e=new ma(this.m_flagsBuffer);this.UpdatePairsAndTriads(0,this.m_count,e);for(var n=0;n<this.m_count;n++)this.m_flagsBuffer.data[n]&=~t.b2ParticleFlag.b2_reactiveParticle;this.m_allParticleFlags&=~t.b2ParticleFlag.b2_reactiveParticle},e.ComparePairIndices=function(t,e){var n=t.indexA-e.indexA;return 0!==n?n<0:t.indexB<e.indexB},e.MatchPairIndices=function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB},e.CompareTriadIndices=function(t,e){var n=t.indexA-e.indexA;if(0!==n)return n<0;var i=t.indexB-e.indexB;return 0!==i?i<0:t.indexC<e.indexC},e.MatchTriadIndices=function(t,e){return t.indexA===e.indexA&&t.indexB===e.indexB&&t.indexC===e.indexC},e.InitializeParticleLists=function(t,e){for(var n=t.GetBufferIndex(),i=t.GetParticleCount(),r=0;r<i;r++){var a=e[r];a.list=a,a.next=null,a.count=1,a.index=r+n}},r.MergeParticleListsInContact=function(t,n){for(var i=t.GetBufferIndex(),r=0;r<this.m_contactBuffer.count;r++){var a=this.m_contactBuffer.data[r],o=a.indexA,s=a.indexB;if(t.ContainsParticle(o)&&t.ContainsParticle(s)){var c=n[o-i].list,l=n[s-i].list;if(c!==l){if(c.count<l.count){var h=c;c=l,l=h}e.MergeParticleLists(c,l)}}}},e.MergeParticleLists=function(t,e){for(var n=e;;){n.list=t;var i=n.next;if(!i){n.next=t.next;break}n=i}t.next=e,t.count+=e.count,e.count=0},e.FindLongestParticleList=function(t,e){for(var n=t.GetParticleCount(),i=e[0],r=0;r<n;r++){var a=e[r];i.count<a.count&&(i=a)}return i},r.MergeZombieParticleListNodes=function(n,i,r){for(var a=n.GetParticleCount(),o=0;o<a;o++){var s=i[o];s!==r&&this.m_flagsBuffer.data[s.index]&t.b2ParticleFlag.b2_zombieParticle&&e.MergeParticleListAndNode(r,s)}},e.MergeParticleListAndNode=function(t,e){e.list=t,e.next=t.next,t.next=e,t.count++,e.count=0},r.CreateParticleGroupsFromParticleList=function(e,n,i){var r=e.GetParticleCount(),a=new Nr;a.groupFlags=e.GetGroupFlags(),a.userData=e.GetUserData();for(var o=0;o<r;o++){var s=n[o];if(s.count&&s!==i)for(var c=this.CreateParticleGroup(a),l=s;l;l=l.next){var h=l.index,u=this.CloneParticle(h,c);this.m_flagsBuffer.data[h]|=t.b2ParticleFlag.b2_zombieParticle,l.index=u}}},r.UpdatePairsAndTriadsWithParticleList=function(t,e){for(var n=t.GetBufferIndex(),i=0;i<this.m_pairBuffer.count;i++){var r=this.m_pairBuffer.data[i],a=r.indexA,o=r.indexB;t.ContainsParticle(a)&&(r.indexA=e[a-n].index),t.ContainsParticle(o)&&(r.indexB=e[o-n].index)}for(var s=0;s<this.m_triadBuffer.count;s++){var c=this.m_triadBuffer.data[s],l=c.indexA,h=c.indexB,u=c.indexC;t.ContainsParticle(l)&&(c.indexA=e[l-n].index),t.ContainsParticle(h)&&(c.indexB=e[h-n].index),t.ContainsParticle(u)&&(c.indexC=e[u-n].index)}},r.ComputeDepth=function(){for(var e=[],n=0,r=0;r<this.m_contactBuffer.count;r++){var a=this.m_contactBuffer.data[r],o=a.indexA,s=a.indexB,c=this.m_groupBuffer[o],l=this.m_groupBuffer[s];c&&c===l&&c.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&(e[n++]=a)}for(var h=[],u=0,_=this.m_groupList;_;_=_.GetNext())if(_.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth){h[u++]=_,this.SetGroupFlags(_,_.m_groupFlags&~t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth);for(var f=_.m_firstIndex;f<_.m_lastIndex;f++)this.m_accumulationBuffer[f]=0}for(var d=0;d<n;d++){var p=e[d],m=p.indexA,v=p.indexB,g=p.weight;this.m_accumulationBuffer[m]+=g,this.m_accumulationBuffer[v]+=g}for(var y=0;y<u;y++)for(var x=h[y],S=x.m_firstIndex;S<x.m_lastIndex;S++){var A=this.m_accumulationBuffer[S];this.m_depthBuffer[S]=A<.8?0:i}for(var b=ut(this.m_count)>>0,C=0;C<b;C++){for(var T=!1,E=0;E<n;E++){var w=e[E],I=w.indexA,P=w.indexB,D=1-w.weight,R=this.m_depthBuffer[I],M=this.m_depthBuffer[P],O=M+D,N=R+D;R>O&&(this.m_depthBuffer[I]=O,T=!0),M>N&&(this.m_depthBuffer[P]=N,T=!0)}if(!T)break}for(var B=0;B<u;B++)for(var L=h[B],F=L.m_firstIndex;F<L.m_lastIndex;F++)this.m_depthBuffer[F]<i?this.m_depthBuffer[F]*=this.m_particleDiameter:this.m_depthBuffer[F]=0},r.GetInsideBoundsEnumerator=function(t){var n=e.computeTag(this.m_inverseDiameter*t.lowerBound.x-1,this.m_inverseDiameter*t.lowerBound.y-1),i=e.computeTag(this.m_inverseDiameter*t.upperBound.x+1,this.m_inverseDiameter*t.upperBound.y+1),r=0,a=this.m_proxyBuffer.count,o=Wr(this.m_proxyBuffer.data,r,a,n,ra.CompareProxyTag),s=qr(this.m_proxyBuffer.data,r,a,i,ra.CompareTagProxy);return new aa(this,n,i,o,s)},r.UpdateAllParticleFlags=function(){this.m_allParticleFlags=0;for(var t=0;t<this.m_count;t++)this.m_allParticleFlags|=this.m_flagsBuffer.data[t];this.m_needsUpdateAllParticleFlags=!1},r.UpdateAllGroupFlags=function(){this.m_allGroupFlags=0;for(var t=this.m_groupList;t;t=t.GetNext())this.m_allGroupFlags|=t.m_groupFlags;this.m_needsUpdateAllGroupFlags=!1},r.AddContact=function(t,n){var i=this.m_flagsBuffer.data,r=this.m_positionBuffer.data,a=Ct.SubVV(r[n],r[t],e.AddContact_s_d),o=Ct.DotVV(a,a);if(0<o&&o<this.m_squaredDiameter){var s=ht(o),c=this.m_contactBuffer.data[this.m_contactBuffer.Append()];c.indexA=t,c.indexB=n,c.flags=i[t]|i[n],c.weight=1-o*s*this.m_inverseDiameter,c.normal.x=s*a.x,c.normal.y=s*a.y}},r.FindContacts_Reference=function(){var t=0,n=this.m_proxyBuffer.count;this.m_contactBuffer.count=0;for(var i=t,r=t;i<n;i++){for(var a=e.computeRelativeTag(this.m_proxyBuffer.data[i].tag,1,0),o=i+1;o<n&&!(a<this.m_proxyBuffer.data[o].tag);o++)this.AddContact(this.m_proxyBuffer.data[i].index,this.m_proxyBuffer.data[o].index,this.m_contactBuffer);for(var s=e.computeRelativeTag(this.m_proxyBuffer.data[i].tag,-1,1);r<n&&!(s<=this.m_proxyBuffer.data[r].tag);r++);for(var c=e.computeRelativeTag(this.m_proxyBuffer.data[i].tag,1,1),l=r;l<n&&!(c<this.m_proxyBuffer.data[l].tag);l++)this.AddContact(this.m_proxyBuffer.data[i].index,this.m_proxyBuffer.data[l].index,this.m_contactBuffer)}},r.FindContacts=function(t){this.FindContacts_Reference(t)},r.UpdateProxies_Reference=function(){for(var t=this.m_positionBuffer.data,n=this.m_inverseDiameter,i=0;i<this.m_proxyBuffer.count;++i){var r=this.m_proxyBuffer.data[i],a=t[r.index];r.tag=e.computeTag(n*a.x,n*a.y)}},r.UpdateProxies=function(t){this.UpdateProxies_Reference(t)},r.SortProxies=function(){Gr(this.m_proxyBuffer.data,0,this.m_proxyBuffer.count,ra.CompareProxyProxy)},r.FilterContacts=function(){var e=this.GetParticleContactFilter();if(null!==e){var n=this,i=function(i){return 0!=(i.flags&t.b2ParticleFlag.b2_particleContactFilterParticle)&&!e.ShouldCollideParticleParticle(n,i.indexA,i.indexB)};this.m_contactBuffer.RemoveIf(i)}},r.NotifyContactListenerPreContact=function(t){if(null!==this.GetParticleContactListener())throw t.Initialize(this.m_contactBuffer,this.m_flagsBuffer),new Error},r.NotifyContactListenerPostContact=function(){var t=this.GetParticleContactListener();if(null!==t){for(var e=0;e<this.m_contactBuffer.count;++e){var n=this.m_contactBuffer.data[e];t.BeginContactParticleParticle(this,n)}throw new Error}},e.b2ParticleContactIsZombie=function(e){return(e.flags&t.b2ParticleFlag.b2_zombieParticle)===t.b2ParticleFlag.b2_zombieParticle},r.UpdateContacts=function(t){this.UpdateProxies(this.m_proxyBuffer),this.SortProxies(this.m_proxyBuffer);var n=new ua;this.NotifyContactListenerPreContact(n),this.FindContacts(this.m_contactBuffer),this.FilterContacts(this.m_contactBuffer),this.NotifyContactListenerPostContact(n),t&&this.m_contactBuffer.RemoveIf(e.b2ParticleContactIsZombie)},r.NotifyBodyContactListenerPreContact=function(t){if(null!==this.GetFixtureContactListener())throw t.Initialize(this.m_bodyContactBuffer,this.m_flagsBuffer),new Error},r.NotifyBodyContactListenerPostContact=function(){var t=this.GetFixtureContactListener();if(null!==t){for(var e=0;e<this.m_bodyContactBuffer.count;e++){var n=this.m_bodyContactBuffer.data[e];t.BeginContactFixtureParticle(this,n)}throw new Error}},r.UpdateBodyContacts=function(){var t=e.UpdateBodyContacts_s_aabb,n=new la;if(this.NotifyBodyContactListenerPreContact(n),this.m_stuckThreshold>0)for(var i=this.GetParticleCount(),r=0;r<i;r++)this.m_bodyContactCountBuffer.data[r]=0,this.m_timestamp>this.m_lastBodyContactStepBuffer.data[r]+1&&(this.m_consecutiveContactStepsBuffer.data[r]=0);this.m_bodyContactBuffer.SetCount(0),this.m_stuckParticleBuffer.SetCount(0);var a=t;this.ComputeAABB(a),null===this.UpdateBodyContacts_callback&&(this.UpdateBodyContacts_callback=new va(this));var o=this.UpdateBodyContacts_callback;o.m_contactFilter=this.GetFixtureContactFilter(),this.m_world.QueryAABB(o,a),this.m_def.strictContactCheck&&this.RemoveSpuriousBodyContacts(),this.NotifyBodyContactListenerPostContact(n)},r.Solve=function(n){var i=e.Solve_s_subStep;if(0!==this.m_count&&(this.m_expirationTimeBuffer.data&&this.SolveLifetimes(n),this.m_allParticleFlags&t.b2ParticleFlag.b2_zombieParticle&&this.SolveZombie(),this.m_needsUpdateAllParticleFlags&&this.UpdateAllParticleFlags(),this.m_needsUpdateAllGroupFlags&&this.UpdateAllGroupFlags(),!this.m_paused))for(this.m_iterationIndex=0;this.m_iterationIndex<n.particleIterations;this.m_iterationIndex++){++this.m_timestamp;var r=i.Copy(n);r.dt/=n.particleIterations,r.inv_dt*=n.particleIterations,this.UpdateContacts(!1),this.UpdateBodyContacts(),this.ComputeWeight(),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth&&this.ComputeDepth(),this.m_allParticleFlags&t.b2ParticleFlag.b2_reactiveParticle&&this.UpdatePairsAndTriadsWithReactiveParticles(),this.m_hasForce&&this.SolveForce(r),this.m_allParticleFlags&t.b2ParticleFlag.b2_viscousParticle&&this.SolveViscous(),this.m_allParticleFlags&t.b2ParticleFlag.b2_repulsiveParticle&&this.SolveRepulsive(r),this.m_allParticleFlags&t.b2ParticleFlag.b2_powderParticle&&this.SolvePowder(r),this.m_allParticleFlags&t.b2ParticleFlag.b2_tensileParticle&&this.SolveTensile(r),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SolveSolid(r),this.m_allParticleFlags&t.b2ParticleFlag.b2_colorMixingParticle&&this.SolveColorMixing(),this.SolveGravity(r),this.m_allParticleFlags&t.b2ParticleFlag.b2_staticPressureParticle&&this.SolveStaticPressure(r),this.SolvePressure(r),this.SolveDamping(r),this.m_allParticleFlags&e.k_extraDampingFlags&&this.SolveExtraDamping(),this.m_allParticleFlags&t.b2ParticleFlag.b2_elasticParticle&&this.SolveElastic(r),this.m_allParticleFlags&t.b2ParticleFlag.b2_springParticle&&this.SolveSpring(r),this.LimitVelocity(r),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigidDamping(),this.m_allParticleFlags&t.b2ParticleFlag.b2_barrierParticle&&this.SolveBarrier(r),this.SolveCollision(r),this.m_allGroupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup&&this.SolveRigid(r),this.m_allParticleFlags&t.b2ParticleFlag.b2_wallParticle&&this.SolveWall();for(var a=0;a<this.m_count;a++)this.m_positionBuffer.data[a].SelfMulAdd(r.dt,this.m_velocityBuffer.data[a])}},r.SolveCollision=function(t){var n=e.SolveCollision_s_aabb,r=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,o=n;o.lowerBound.x=+i,o.lowerBound.y=+i,o.upperBound.x=-i,o.upperBound.y=-i;for(var s=0;s<this.m_count;s++){var c=a[s],l=r[s],h=l.x+t.dt*c.x,u=l.y+t.dt*c.y;o.lowerBound.x=nt(o.lowerBound.x,nt(l.x,h)),o.lowerBound.y=nt(o.lowerBound.y,nt(l.y,u)),o.upperBound.x=rt(o.upperBound.x,rt(l.x,h)),o.upperBound.y=rt(o.upperBound.y,rt(l.y,u))}null===this.SolveCollision_callback&&(this.SolveCollision_callback=new ga(this,t));var _=this.SolveCollision_callback;_.m_step=t,this.m_world.QueryAABB(_,o)},r.LimitVelocity=function(t){for(var e=this.m_velocityBuffer.data,n=this.GetCriticalVelocitySquared(t),i=0;i<this.m_count;i++){var r=e[i],a=Ct.DotVV(r,r);a>n&&r.SelfMul(ut(n/a))}},r.SolveGravity=function(t){for(var n=e.SolveGravity_s_gravity,i=this.m_velocityBuffer.data,r=Ct.MulSV(t.dt*this.m_def.gravityScale,this.m_world.GetGravity(),n),a=0;a<this.m_count;a++)i[a].SelfAdd(r)},r.SolveBarrier=function(n){for(var i=e.SolveBarrier_s_aabb,r=e.SolveBarrier_s_va,a=e.SolveBarrier_s_vb,o=e.SolveBarrier_s_pba,s=e.SolveBarrier_s_vba,c=e.SolveBarrier_s_vc,l=e.SolveBarrier_s_pca,h=e.SolveBarrier_s_vca,u=e.SolveBarrier_s_qba,_=e.SolveBarrier_s_qca,f=e.SolveBarrier_s_dv,d=e.SolveBarrier_s_f,p=this.m_positionBuffer.data,m=this.m_velocityBuffer.data,v=0;v<this.m_count;v++)0!=(this.m_flagsBuffer.data[v]&e.k_barrierWallFlags)&&m[v].SetZero();for(var g=N*n.dt,y=this.GetParticleMass(),x=0;x<this.m_pairBuffer.count;x++){var S=this.m_pairBuffer.data[x];if(S.flags&t.b2ParticleFlag.b2_barrierParticle){var A=S.indexA,b=S.indexB,C=p[A],T=p[b],E=i;Ct.MinV(C,T,E.lowerBound),Ct.MaxV(C,T,E.upperBound);for(var w=this.m_groupBuffer[A],I=this.m_groupBuffer[b],P=this.GetLinearVelocity(w,A,C,r),D=this.GetLinearVelocity(I,b,T,a),R=Ct.SubVV(T,C,o),M=Ct.SubVV(D,P,s),O=this.GetInsideBoundsEnumerator(E),B=void 0;(B=O.GetNext())>=0;){var L=p[B],F=this.m_groupBuffer[B];if(w!==F&&I!==F){var V=this.GetLinearVelocity(F,B,L,c),z=Ct.SubVV(L,C,l),k=Ct.SubVV(V,P,h),U=Ct.CrossVV(M,k),G=Ct.CrossVV(R,k)-Ct.CrossVV(z,M),H=Ct.CrossVV(R,z),j=void 0,W=void 0,q=u,X=_;if(0===U){if(0===G)continue;if(!((W=-H/G)>=0&&W<g))continue;if(Ct.AddVMulSV(R,W,M,q),Ct.AddVMulSV(z,W,k,X),!((j=Ct.DotVV(q,X)/Ct.DotVV(q,q))>=0&&j<=1))continue}else{var Y=G*G-4*H*U;if(Y<0)continue;var K=ut(Y),J=(-G-K)/(2*U),Q=(-G+K)/(2*U);if(J>Q){var Z=J;J=Q,Q=Z}if(W=J,Ct.AddVMulSV(R,W,M,q),Ct.AddVMulSV(z,W,k,X),j=Ct.DotVV(q,X)/Ct.DotVV(q,q),!(W>=0&&W<g&&j>=0&&j<=1)){if(!((W=Q)>=0&&W<g))continue;if(Ct.AddVMulSV(R,W,M,q),Ct.AddVMulSV(z,W,k,X),!((j=Ct.DotVV(q,X)/Ct.DotVV(q,q))>=0&&j<=1))continue}}var $=f;$.x=P.x+j*M.x-V.x,$.y=P.y+j*M.y-V.y;var tt=Ct.MulSV(y,$,d);if(F&&this.IsRigidGroup(F)){var et=F.GetMass(),nt=F.GetInertia();et>0&&F.m_linearVelocity.SelfMulAdd(1/et,tt),nt>0&&(F.m_angularVelocity+=Ct.CrossVV(Ct.SubVV(L,F.GetCenter(),Ct.s_t0),tt)/nt)}else m[B].SelfAdd($);this.ParticleApplyForce(B,tt.SelfMul(-n.inv_dt))}}}}},r.SolveStaticPressure=function(e){this.m_staticPressureBuffer=this.RequestBuffer(this.m_staticPressureBuffer);for(var n=this.GetCriticalPressure(e),i=this.m_def.staticPressureStrength*n,r=P*n,a=this.m_def.staticPressureRelaxation,o=0;o<this.m_def.staticPressureIterations;o++){for(var s=0;s<this.m_count;s++)this.m_accumulationBuffer[s]=0;for(var c=0;c<this.m_contactBuffer.count;c++){var l=this.m_contactBuffer.data[c];if(l.flags&t.b2ParticleFlag.b2_staticPressureParticle){var h=l.indexA,u=l.indexB,_=l.weight;this.m_accumulationBuffer[h]+=_*this.m_staticPressureBuffer[u],this.m_accumulationBuffer[u]+=_*this.m_staticPressureBuffer[h]}}for(var f=0;f<this.m_count;f++){var d=this.m_weightBuffer[f];if(this.m_flagsBuffer.data[f]&t.b2ParticleFlag.b2_staticPressureParticle){var p=(this.m_accumulationBuffer[f]+i*(d-I))/(d+a);this.m_staticPressureBuffer[f]=at(p,0,r)}else this.m_staticPressureBuffer[f]=0}}},r.ComputeWeight=function(){for(var t=0;t<this.m_count;t++)this.m_weightBuffer[t]=0;for(var e=0;e<this.m_bodyContactBuffer.count;e++){var n=this.m_bodyContactBuffer.data[e],i=n.index,r=n.weight;this.m_weightBuffer[i]+=r}for(var a=0;a<this.m_contactBuffer.count;a++){var o=this.m_contactBuffer.data[a],s=o.indexA,c=o.indexB,l=o.weight;this.m_weightBuffer[s]+=l,this.m_weightBuffer[c]+=l}},r.SolvePressure=function(n){for(var i=e.SolvePressure_s_f,r=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,o=this.GetCriticalPressure(n),s=this.m_def.pressureStrength*o,c=P*o,l=0;l<this.m_count;l++){var h=s*rt(0,this.m_weightBuffer[l]-I);this.m_accumulationBuffer[l]=nt(h,c)}if(this.m_allParticleFlags&e.k_noPressureFlags)for(var u=0;u<this.m_count;u++)this.m_flagsBuffer.data[u]&e.k_noPressureFlags&&(this.m_accumulationBuffer[u]=0);if(this.m_allParticleFlags&t.b2ParticleFlag.b2_staticPressureParticle)for(var _=0;_<this.m_count;_++)this.m_flagsBuffer.data[_]&t.b2ParticleFlag.b2_staticPressureParticle&&(this.m_accumulationBuffer[_]+=this.m_staticPressureBuffer[_]);for(var f=n.dt/(this.m_def.density*this.m_particleDiameter),d=this.GetParticleInvMass(),p=0;p<this.m_bodyContactBuffer.count;p++){var m=this.m_bodyContactBuffer.data[p],v=m.index,g=m.body,y=m.weight,x=m.mass,S=m.normal,A=r[v],b=this.m_accumulationBuffer[v]+s*y,C=Ct.MulSV(f*y*x*b,S,i);a[v].SelfMulSub(d,C),g.ApplyLinearImpulse(C,A,!0)}for(var T=0;T<this.m_contactBuffer.count;T++){var E=this.m_contactBuffer.data[T],w=E.indexA,D=E.indexB,R=E.weight,M=E.normal,O=this.m_accumulationBuffer[w]+this.m_accumulationBuffer[D],N=Ct.MulSV(f*R*O,M,i);a[w].SelfSub(N),a[D].SelfAdd(N)}},r.SolveDamping=function(t){for(var n=e.SolveDamping_s_v,i=e.SolveDamping_s_f,r=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,o=this.m_def.dampingStrength,s=1/this.GetCriticalVelocity(t),c=this.GetParticleInvMass(),l=0;l<this.m_bodyContactBuffer.count;l++){var h=this.m_bodyContactBuffer.data[l],u=h.index,_=h.body,f=h.weight,d=h.mass,p=h.normal,m=r[u],v=Ct.SubVV(_.GetLinearVelocityFromWorldPoint(m,Ct.s_t0),a[u],n),g=Ct.DotVV(v,p);if(g<0){var y=rt(o*f,nt(-s*g,.5)),x=Ct.MulSV(y*d*g,p,i);a[u].SelfMulAdd(c,x),_.ApplyLinearImpulse(x.SelfNeg(),m,!0)}}for(var S=0;S<this.m_contactBuffer.count;S++){var A=this.m_contactBuffer.data[S],b=A.indexA,C=A.indexB,T=A.weight,E=A.normal,w=Ct.SubVV(a[C],a[b],n),I=Ct.DotVV(w,E);if(I<0){var P=rt(o*T,nt(-s*I,.5)),D=Ct.MulSV(P*I,E,i);a[b].SelfAdd(D),a[C].SelfSub(D)}}},r.SolveRigidDamping=function(){for(var t=e.SolveRigidDamping_s_t0,n=e.SolveRigidDamping_s_t1,i=e.SolveRigidDamping_s_p,r=e.SolveRigidDamping_s_v,a=[0],o=[0],s=[0],c=[0],l=[0],h=[0],u=this.m_positionBuffer.data,_=this.m_def.dampingStrength,f=0;f<this.m_bodyContactBuffer.count;f++){var d=this.m_bodyContactBuffer.data[f],p=d.index,m=this.m_groupBuffer[p];if(m&&this.IsRigidGroup(m)){var v=d.body,g=d.normal,y=d.weight,x=u[p],S=Ct.SubVV(v.GetLinearVelocityFromWorldPoint(x,t),m.GetLinearVelocityFromWorldPoint(x,n),r),A=Ct.DotVV(S,g);if(A<0){this.InitDampingParameterWithRigidGroupOrParticle(a,o,s,!0,m,p,x,g),this.InitDampingParameter(c,l,h,v.GetMass(),v.GetInertia()-v.GetMass()*v.GetLocalCenter().LengthSquared(),v.GetWorldCenter(),x,g);var b=_*nt(y,1)*this.ComputeDampingImpulse(a[0],o[0],s[0],c[0],l[0],h[0],A);this.ApplyDamping(a[0],o[0],s[0],!0,m,p,b,g),v.ApplyLinearImpulse(Ct.MulSV(-b,g,Ct.s_t0),x,!0)}}}for(var C=0;C<this.m_contactBuffer.count;C++){var T=this.m_contactBuffer.data[C],E=T.indexA,w=T.indexB,I=T.normal,P=T.weight,D=this.m_groupBuffer[E],R=this.m_groupBuffer[w],M=this.IsRigidGroup(D),O=this.IsRigidGroup(R);if(D!==R&&(M||O)){var N=Ct.MidVV(u[E],u[w],i),B=Ct.SubVV(this.GetLinearVelocity(R,w,N,t),this.GetLinearVelocity(D,E,N,n),r),L=Ct.DotVV(B,I);if(L<0){this.InitDampingParameterWithRigidGroupOrParticle(a,o,s,M,D,E,N,I),this.InitDampingParameterWithRigidGroupOrParticle(c,l,h,O,R,w,N,I);var F=_*P*this.ComputeDampingImpulse(a[0],o[0],s[0],c[0],l[0],h[0],L);this.ApplyDamping(a[0],o[0],s[0],M,D,E,F,I),this.ApplyDamping(c[0],l[0],h[0],O,R,w,-F,I)}}}},r.SolveExtraDamping=function(){for(var t=e.SolveExtraDamping_s_v,n=e.SolveExtraDamping_s_f,i=this.m_velocityBuffer.data,r=this.m_positionBuffer.data,a=this.GetParticleInvMass(),o=0;o<this.m_bodyContactBuffer.count;o++){var s=this.m_bodyContactBuffer.data[o],c=s.index;if(this.m_flagsBuffer.data[c]&e.k_extraDampingFlags){var l=s.body,h=s.mass,u=s.normal,_=r[c],f=Ct.SubVV(l.GetLinearVelocityFromWorldPoint(_,Ct.s_t0),i[c],t),d=Ct.DotVV(f,u);if(d<0){var p=Ct.MulSV(.5*h*d,u,n);i[c].SelfMulAdd(a,p),l.ApplyLinearImpulse(p.SelfNeg(),_,!0)}}}},r.SolveWall=function(){for(var e=this.m_velocityBuffer.data,n=0;n<this.m_count;n++)this.m_flagsBuffer.data[n]&t.b2ParticleFlag.b2_wallParticle&&e[n].SetZero()},r.SolveRigid=function(n){for(var i=e.SolveRigid_s_position,r=e.SolveRigid_s_rotation,a=e.SolveRigid_s_transform,o=e.SolveRigid_s_velocityTransform,s=this.m_positionBuffer.data,c=this.m_velocityBuffer.data,l=this.m_groupList;l;l=l.GetNext())if(l.m_groupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup){l.UpdateStatistics();var h=r;h.SetAngle(n.dt*l.m_angularVelocity);var u=Ct.AddVV(l.m_center,Ct.SubVV(Ct.MulSV(n.dt,l.m_linearVelocity,Ct.s_t0),Pt.MulRV(h,l.m_center,Ct.s_t1),Ct.s_t0),i),_=a;_.SetPositionRotation(u,h),Dt.MulXX(_,l.m_transform,l.m_transform);var f=o;f.p.x=n.inv_dt*_.p.x,f.p.y=n.inv_dt*_.p.y,f.q.s=n.inv_dt*_.q.s,f.q.c=n.inv_dt*(_.q.c-1);for(var d=l.m_firstIndex;d<l.m_lastIndex;d++)Dt.MulXV(f,s[d],c[d])}},r.SolveElastic=function(n){for(var i=e.SolveElastic_s_pa,r=e.SolveElastic_s_pb,a=e.SolveElastic_s_pc,o=e.SolveElastic_s_r,s=e.SolveElastic_s_t0,c=this.m_positionBuffer.data,l=this.m_velocityBuffer.data,h=n.inv_dt*this.m_def.elasticStrength,u=0;u<this.m_triadBuffer.count;u++){var _=this.m_triadBuffer.data[u];if(_.flags&t.b2ParticleFlag.b2_elasticParticle){var f=_.indexA,d=_.indexB,p=_.indexC,m=_.pa,v=_.pb,g=_.pc,y=i.Copy(c[f]),x=r.Copy(c[d]),S=a.Copy(c[p]),A=l[f],b=l[d],C=l[p];y.SelfMulAdd(n.dt,A),x.SelfMulAdd(n.dt,b),S.SelfMulAdd(n.dt,C);var T=(y.x+x.x+S.x)/3,E=(y.y+x.y+S.y)/3;y.x-=T,y.y-=E,x.x-=T,x.y-=E,S.x-=T,S.y-=E;var w=o;w.s=Ct.CrossVV(m,y)+Ct.CrossVV(v,x)+Ct.CrossVV(g,S),w.c=Ct.DotVV(m,y)+Ct.DotVV(v,x)+Ct.DotVV(g,S);var I=ht(w.s*w.s+w.c*w.c);isFinite(I)||(I=198177537e11),w.s*=I,w.c*=I;var P=h*_.strength;Pt.MulRV(w,m,s),Ct.SubVV(s,y,s),Ct.MulSV(P,s,s),A.SelfAdd(s),Pt.MulRV(w,v,s),Ct.SubVV(s,x,s),Ct.MulSV(P,s,s),b.SelfAdd(s),Pt.MulRV(w,g,s),Ct.SubVV(s,S,s),Ct.MulSV(P,s,s),C.SelfAdd(s)}}},r.SolveSpring=function(n){for(var i=e.SolveSpring_s_pa,r=e.SolveSpring_s_pb,a=e.SolveSpring_s_d,o=e.SolveSpring_s_f,s=this.m_positionBuffer.data,c=this.m_velocityBuffer.data,l=n.inv_dt*this.m_def.springStrength,h=0;h<this.m_pairBuffer.count;h++){var u=this.m_pairBuffer.data[h];if(u.flags&t.b2ParticleFlag.b2_springParticle){var _=u.indexA,f=u.indexB,d=i.Copy(s[_]),p=r.Copy(s[f]),m=c[_],v=c[f];d.SelfMulAdd(n.dt,m),p.SelfMulAdd(n.dt,v);var g=Ct.SubVV(p,d,a),y=u.distance,x=g.Length(),S=l*u.strength,A=Ct.MulSV(S*(y-x)/x,g,o);m.SelfSub(A),v.SelfAdd(A)}}},r.SolveTensile=function(n){for(var i=e.SolveTensile_s_weightedNormal,r=e.SolveTensile_s_s,a=e.SolveTensile_s_f,o=this.m_velocityBuffer.data,s=0;s<this.m_count;s++)this.m_accumulation2Buffer[s]=new Ct,this.m_accumulation2Buffer[s].SetZero();for(var c=0;c<this.m_contactBuffer.count;c++){var l=this.m_contactBuffer.data[c];if(l.flags&t.b2ParticleFlag.b2_tensileParticle){var h=l.indexA,u=l.indexB,_=l.weight,f=l.normal,d=Ct.MulSV((1-_)*_,f,i);this.m_accumulation2Buffer[h].SelfSub(d),this.m_accumulation2Buffer[u].SelfAdd(d)}}for(var p=this.GetCriticalVelocity(n),m=this.m_def.surfaceTensionPressureStrength*p,v=this.m_def.surfaceTensionNormalStrength*p,g=D*p,y=0;y<this.m_contactBuffer.count;y++){var x=this.m_contactBuffer.data[y];if(x.flags&t.b2ParticleFlag.b2_tensileParticle){var S=x.indexA,A=x.indexB,b=x.weight,C=x.normal,T=this.m_weightBuffer[S]+this.m_weightBuffer[A],E=Ct.SubVV(this.m_accumulation2Buffer[A],this.m_accumulation2Buffer[S],r),w=nt(m*(T-2)+v*Ct.DotVV(E,C),g)*b,I=Ct.MulSV(w,C,a);o[S].SelfSub(I),o[A].SelfAdd(I)}}},r.SolveViscous=function(){for(var n=e.SolveViscous_s_v,i=e.SolveViscous_s_f,r=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,o=this.m_def.viscousStrength,s=this.GetParticleInvMass(),c=0;c<this.m_bodyContactBuffer.count;c++){var l=this.m_bodyContactBuffer.data[c],h=l.index;if(this.m_flagsBuffer.data[h]&t.b2ParticleFlag.b2_viscousParticle){var u=l.body,_=l.weight,f=l.mass,d=r[h],p=Ct.SubVV(u.GetLinearVelocityFromWorldPoint(d,Ct.s_t0),a[h],n),m=Ct.MulSV(o*f*_,p,i);a[h].SelfMulAdd(s,m),u.ApplyLinearImpulse(m.SelfNeg(),d,!0)}}for(var v=0;v<this.m_contactBuffer.count;v++){var g=this.m_contactBuffer.data[v];if(g.flags&t.b2ParticleFlag.b2_viscousParticle){var y=g.indexA,x=g.indexB,S=g.weight,A=Ct.SubVV(a[x],a[y],n),b=Ct.MulSV(o*S,A,i);a[y].SelfAdd(b),a[x].SelfSub(b)}}},r.SolveRepulsive=function(n){for(var i=e.SolveRepulsive_s_f,r=this.m_velocityBuffer.data,a=this.m_def.repulsiveStrength*this.GetCriticalVelocity(n),o=0;o<this.m_contactBuffer.count;o++){var s=this.m_contactBuffer.data[o];if(s.flags&t.b2ParticleFlag.b2_repulsiveParticle){var c=s.indexA,l=s.indexB;if(this.m_groupBuffer[c]!==this.m_groupBuffer[l]){var h=s.weight,u=s.normal,_=Ct.MulSV(a*h,u,i);r[c].SelfSub(_),r[l].SelfAdd(_)}}}},r.SolvePowder=function(n){for(var i=e.SolvePowder_s_f,r=this.m_positionBuffer.data,a=this.m_velocityBuffer.data,o=this.m_def.powderStrength*this.GetCriticalVelocity(n),s=1-w,c=this.GetParticleInvMass(),l=0;l<this.m_bodyContactBuffer.count;l++){var h=this.m_bodyContactBuffer.data[l],u=h.index;if(this.m_flagsBuffer.data[u]&t.b2ParticleFlag.b2_powderParticle){var _=h.weight;if(_>s){var f=h.body,d=h.mass,p=r[u],m=h.normal,v=Ct.MulSV(o*d*(_-s),m,i);a[u].SelfMulSub(c,v),f.ApplyLinearImpulse(v,p,!0)}}}for(var g=0;g<this.m_contactBuffer.count;g++){var y=this.m_contactBuffer.data[g];if(y.flags&t.b2ParticleFlag.b2_powderParticle){var x=y.weight;if(x>s){var S=y.indexA,A=y.indexB,b=y.normal,C=Ct.MulSV(o*(x-s),b,i);a[S].SelfSub(C),a[A].SelfAdd(C)}}}},r.SolveSolid=function(t){var n=e.SolveSolid_s_f,i=this.m_velocityBuffer.data;this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer);for(var r=t.inv_dt*this.m_def.ejectionStrength,a=0;a<this.m_contactBuffer.count;a++){var o=this.m_contactBuffer.data[a],s=o.indexA,c=o.indexB;if(this.m_groupBuffer[s]!==this.m_groupBuffer[c]){var l=o.weight,h=o.normal,u=this.m_depthBuffer[s]+this.m_depthBuffer[c],_=Ct.MulSV(r*u*l,h,n);i[s].SelfSub(_),i[c].SelfAdd(_)}}},r.SolveForce=function(t){for(var e=this.m_velocityBuffer.data,n=t.dt*this.GetParticleInvMass(),i=0;i<this.m_count;i++)e[i].SelfMulAdd(n,this.m_forceBuffer[i]);this.m_hasForce=!1},r.SolveColorMixing=function(){var e=.5*this.m_def.colorMixingStrength;if(e)for(var n=0;n<this.m_contactBuffer.count;n++){var i=this.m_contactBuffer.data[n],r=i.indexA,a=i.indexB;if(this.m_flagsBuffer.data[r]&this.m_flagsBuffer.data[a]&t.b2ParticleFlag.b2_colorMixingParticle){var o=this.m_colorBuffer.data[r],s=this.m_colorBuffer.data[a];Ot.MixColors(o,s,e)}}},r.SolveZombie=function(){for(var e=0,n=[],i=0;i<this.m_count;i++)n[i]=T;for(var r=0,a=0;a<this.m_count;a++){var o=this.m_flagsBuffer.data[a];if(o&t.b2ParticleFlag.b2_zombieParticle){var s=this.m_world.m_destructionListener;if(o&t.b2ParticleFlag.b2_destructionListenerParticle&&s&&s.SayGoodbyeParticle(this,a),this.m_handleIndexBuffer.data){var c=this.m_handleIndexBuffer.data[a];c&&(c.SetIndex(T),this.m_handleIndexBuffer.data[a]=null)}n[a]=T}else{if(n[a]=e,a!==e){if(this.m_handleIndexBuffer.data){var l=this.m_handleIndexBuffer.data[a];l&&l.SetIndex(e),this.m_handleIndexBuffer.data[e]=l}this.m_flagsBuffer.data[e]=this.m_flagsBuffer.data[a],this.m_lastBodyContactStepBuffer.data&&(this.m_lastBodyContactStepBuffer.data[e]=this.m_lastBodyContactStepBuffer.data[a]),this.m_bodyContactCountBuffer.data&&(this.m_bodyContactCountBuffer.data[e]=this.m_bodyContactCountBuffer.data[a]),this.m_consecutiveContactStepsBuffer.data&&(this.m_consecutiveContactStepsBuffer.data[e]=this.m_consecutiveContactStepsBuffer.data[a]),this.m_positionBuffer.data[e].Copy(this.m_positionBuffer.data[a]),this.m_velocityBuffer.data[e].Copy(this.m_velocityBuffer.data[a]),this.m_groupBuffer[e]=this.m_groupBuffer[a],this.m_hasForce&&this.m_forceBuffer[e].Copy(this.m_forceBuffer[a]),this.m_staticPressureBuffer&&(this.m_staticPressureBuffer[e]=this.m_staticPressureBuffer[a]),this.m_depthBuffer&&(this.m_depthBuffer[e]=this.m_depthBuffer[a]),this.m_colorBuffer.data&&this.m_colorBuffer.data[e].Copy(this.m_colorBuffer.data[a]),this.m_userDataBuffer.data&&(this.m_userDataBuffer.data[e]=this.m_userDataBuffer.data[a]),this.m_expirationTimeBuffer.data&&(this.m_expirationTimeBuffer.data[e]=this.m_expirationTimeBuffer.data[a])}e++,r|=o}}for(var h={IsProxyInvalid:function(t){return t.index<0},IsContactInvalid:function(t){return t.indexA<0||t.indexB<0},IsBodyContactInvalid:function(t){return t.index<0},IsPairInvalid:function(t){return t.indexA<0||t.indexB<0},IsTriadInvalid:function(t){return t.indexA<0||t.indexB<0||t.indexC<0}},u=0;u<this.m_proxyBuffer.count;u++){var _=this.m_proxyBuffer.data[u];_.index=n[_.index]}this.m_proxyBuffer.RemoveIf(h.IsProxyInvalid);for(var f=0;f<this.m_contactBuffer.count;f++){var d=this.m_contactBuffer.data[f];d.indexA=n[d.indexA],d.indexB=n[d.indexB]}this.m_contactBuffer.RemoveIf(h.IsContactInvalid);for(var p=0;p<this.m_bodyContactBuffer.count;p++){var m=this.m_bodyContactBuffer.data[p];m.index=n[m.index]}this.m_bodyContactBuffer.RemoveIf(h.IsBodyContactInvalid);for(var v=0;v<this.m_pairBuffer.count;v++){var g=this.m_pairBuffer.data[v];g.indexA=n[g.indexA],g.indexB=n[g.indexB]}this.m_pairBuffer.RemoveIf(h.IsPairInvalid);for(var y=0;y<this.m_triadBuffer.count;y++){var x=this.m_triadBuffer.data[y];x.indexA=n[x.indexA],x.indexB=n[x.indexB],x.indexC=n[x.indexC]}if(this.m_triadBuffer.RemoveIf(h.IsTriadInvalid),this.m_indexByExpirationTimeBuffer.data)for(var S=0,A=0;A<this.m_count;A++){var b=n[this.m_indexByExpirationTimeBuffer.data[A]];b!==T&&(this.m_indexByExpirationTimeBuffer.data[S++]=b)}for(var C=this.m_groupList;C;C=C.GetNext()){for(var E=e,w=0,I=!1,P=C.m_firstIndex;P<C.m_lastIndex;P++){var D=n[P];D>=0?(E=nt(E,D),w=rt(w,D+1)):I=!0}E<w?(C.m_firstIndex=E,C.m_lastIndex=w,I&&C.m_groupFlags&t.b2ParticleGroupFlag.b2_solidParticleGroup&&this.SetGroupFlags(C,C.m_groupFlags|t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth)):(C.m_firstIndex=0,C.m_lastIndex=0,C.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupCanBeEmpty||this.SetGroupFlags(C,C.m_groupFlags|t.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed))}this.m_count=e,this.m_allParticleFlags=r,this.m_needsUpdateAllParticleFlags=!1;for(var R=this.m_groupList;R;){var M=R.GetNext();R.m_groupFlags&t.b2ParticleGroupFlag.b2_particleGroupWillBeDestroyed&&this.DestroyParticleGroup(R),R=M}},r.SolveLifetimes=function(t){this.m_timeElapsed=this.LifetimeToExpirationTime(t.dt);var e=this.GetQuantizedTimeElapsed(),n=this.m_expirationTimeBuffer.data,i=this.m_indexByExpirationTimeBuffer.data,r=this.GetParticleCount();this.m_expirationTimeBufferRequiresSorting&&(Gr(i,0,r,(function(t,e){var i=n[t],r=n[e],a=i<=0;return a===r<=0?i>r:a})),this.m_expirationTimeBufferRequiresSorting=!1);for(var a=r-1;a>=0;--a){var o=i[a],s=n[o];if(e<s||s<=0)break;this.DestroyParticle(o)}},r.RotateBuffer=function(t,e,n){if(t!==e&&e!==n){if(Xr(this.m_flagsBuffer.data,t,e,n),this.m_lastBodyContactStepBuffer.data&&Xr(this.m_lastBodyContactStepBuffer.data,t,e,n),this.m_bodyContactCountBuffer.data&&Xr(this.m_bodyContactCountBuffer.data,t,e,n),this.m_consecutiveContactStepsBuffer.data&&Xr(this.m_consecutiveContactStepsBuffer.data,t,e,n),Xr(this.m_positionBuffer.data,t,e,n),Xr(this.m_velocityBuffer.data,t,e,n),Xr(this.m_groupBuffer,t,e,n),this.m_hasForce&&Xr(this.m_forceBuffer,t,e,n),this.m_staticPressureBuffer&&Xr(this.m_staticPressureBuffer,t,e,n),this.m_depthBuffer&&Xr(this.m_depthBuffer,t,e,n),this.m_colorBuffer.data&&Xr(this.m_colorBuffer.data,t,e,n),this.m_userDataBuffer.data&&Xr(this.m_userDataBuffer.data,t,e,n),this.m_handleIndexBuffer.data){Xr(this.m_handleIndexBuffer.data,t,e,n);for(var i=t;i<n;++i){var r=this.m_handleIndexBuffer.data[i];r&&r.SetIndex(y(r.GetIndex()))}}if(this.m_expirationTimeBuffer.data){Xr(this.m_expirationTimeBuffer.data,t,e,n);for(var a=this.GetParticleCount(),o=this.m_indexByExpirationTimeBuffer.data,s=0;s<a;++s)o[s]=y(o[s])}for(var c=0;c<this.m_proxyBuffer.count;c++){var l=this.m_proxyBuffer.data[c];l.index=y(l.index)}for(var h=0;h<this.m_contactBuffer.count;h++){var u=this.m_contactBuffer.data[h];u.indexA=y(u.indexA),u.indexB=y(u.indexB)}for(var _=0;_<this.m_bodyContactBuffer.count;_++){var f=this.m_bodyContactBuffer.data[_];f.index=y(f.index)}for(var d=0;d<this.m_pairBuffer.count;d++){var p=this.m_pairBuffer.data[d];p.indexA=y(p.indexA),p.indexB=y(p.indexB)}for(var m=0;m<this.m_triadBuffer.count;m++){var v=this.m_triadBuffer.data[m];v.indexA=y(v.indexA),v.indexB=y(v.indexB),v.indexC=y(v.indexC)}for(var g=this.m_groupList;g;g=g.GetNext())g.m_firstIndex=y(g.m_firstIndex),g.m_lastIndex=y(g.m_lastIndex-1)+1}function y(i){return i<t?i:i<e?i+n-e:i<n?i+t-e:i}},r.GetCriticalVelocity=function(t){return this.m_particleDiameter*t.inv_dt},r.GetCriticalVelocitySquared=function(t){var e=this.GetCriticalVelocity(t);return e*e},r.GetCriticalPressure=function(t){return this.m_def.density*this.GetCriticalVelocitySquared(t)},r.GetParticleStride=function(){return w*this.m_particleDiameter},r.GetParticleMass=function(){var t=this.GetParticleStride();return this.m_def.density*t*t},r.GetParticleInvMass=function(){var t=this.m_inverseDiameter*(1/w);return this.m_inverseDensity*t*t},r.GetFixtureContactFilter=function(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_fixtureContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null},r.GetParticleContactFilter=function(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_particleContactFilterParticle?this.m_world.m_contactManager.m_contactFilter:null},r.GetFixtureContactListener=function(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_fixtureContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null},r.GetParticleContactListener=function(){return this.m_allParticleFlags&t.b2ParticleFlag.b2_particleContactListenerParticle?this.m_world.m_contactManager.m_contactListener:null},r.SetUserOverridableBuffer=function(t,e){t.data=e,t.userSuppliedCapacity=e.length},r.SetGroupFlags=function(e,n){var i=e.m_groupFlags;(i^n)&t.b2ParticleGroupFlag.b2_solidParticleGroup&&(n|=t.b2ParticleGroupFlag.b2_particleGroupNeedsUpdateDepth),i&~n&&(this.m_needsUpdateAllGroupFlags=!0),~this.m_allGroupFlags&n&&(n&t.b2ParticleGroupFlag.b2_solidParticleGroup&&(this.m_depthBuffer=this.RequestBuffer(this.m_depthBuffer)),this.m_allGroupFlags|=n),e.m_groupFlags=n},e.BodyContactCompare=function(t,e){return t.index===e.index?t.weight>e.weight:t.index<e.index},r.RemoveSpuriousBodyContacts=function(){Gr(this.m_bodyContactBuffer.data,0,this.m_bodyContactBuffer.count,e.BodyContactCompare);var t=e.RemoveSpuriousBodyContacts_s_n,n=e.RemoveSpuriousBodyContacts_s_pos,i=e.RemoveSpuriousBodyContacts_s_normal,r=3,a=this,o=-1,s=0,c=function(e){if(e.index!==o&&(s=0,o=e.index),s++>r)return!0;var c=t.Copy(e.normal);c.SelfMul(a.m_particleDiameter*(1-e.weight));var l=Ct.AddVV(a.m_positionBuffer.data[e.index],c,n);if(!e.fixture.TestPoint(l)){for(var h=e.fixture.GetShape().GetChildCount(),_=0;_<h;_++){var f=i;if(e.fixture.ComputeDistance(l,f,_)<u)return!1}return!0}return!1};this.m_bodyContactBuffer.count=jr(this.m_bodyContactBuffer.data,c,this.m_bodyContactBuffer.count)},r.DetectStuckParticle=function(t){this.m_stuckThreshold<=0||(++this.m_bodyContactCountBuffer.data[t],2===this.m_bodyContactCountBuffer.data[t]&&(++this.m_consecutiveContactStepsBuffer.data[t],this.m_consecutiveContactStepsBuffer.data[t]>this.m_stuckThreshold&&(this.m_stuckParticleBuffer.data[this.m_stuckParticleBuffer.Append()]=t)),this.m_lastBodyContactStepBuffer.data[t]=this.m_timestamp)},r.ValidateParticleIndex=function(t){return t>=0&&t<this.GetParticleCount()&&t!==T},r.GetQuantizedTimeElapsed=function(){return Math.floor(this.m_timeElapsed/4294967296)},r.LifetimeToExpirationTime=function(t){return this.m_timeElapsed+Math.floor(t/this.m_def.lifetimeGranularity*4294967296)},r.ForceCanBeApplied=function(e){return!(e&t.b2ParticleFlag.b2_wallParticle)},r.PrepareForceBuffer=function(){if(!this.m_hasForce){for(var t=0;t<this.m_count;t++)this.m_forceBuffer[t].SetZero();this.m_hasForce=!0}},r.IsRigidGroup=function(e){return null!==e&&0!=(e.m_groupFlags&t.b2ParticleGroupFlag.b2_rigidParticleGroup)},r.GetLinearVelocity=function(t,e,n,i){return t&&this.IsRigidGroup(t)?t.GetLinearVelocityFromWorldPoint(n,i):i.Copy(this.m_velocityBuffer.data[e])},r.InitDampingParameter=function(t,e,n,i,r,a,o,s){t[0]=i>0?1/i:0,e[0]=r>0?1/r:0,n[0]=Ct.CrossVV(Ct.SubVV(o,a,Ct.s_t0),s)},r.InitDampingParameterWithRigidGroupOrParticle=function(e,n,i,r,a,o,s,c){if(a&&r)this.InitDampingParameter(e,n,i,a.GetMass(),a.GetInertia(),a.GetCenter(),s,c);else{var l=this.m_flagsBuffer.data[o];this.InitDampingParameter(e,n,i,l&t.b2ParticleFlag.b2_wallParticle?0:this.GetParticleMass(),0,s,s,c)}},r.ComputeDampingImpulse=function(t,e,n,i,r,a,o){var s=t+e*n*n+i+r*a*a;return s>0?o/s:0},r.ApplyDamping=function(t,e,n,i,r,a,o,s){r&&i?(r.m_linearVelocity.SelfMulAdd(o*t,s),r.m_angularVelocity+=o*n*e):this.m_velocityBuffer.data[a].SelfMulAdd(o*t,s)},e}();na.xTruncBits=12,na.yTruncBits=12,na.tagBits=32,na.yOffset=1<<na.yTruncBits-1,na.yShift=na.tagBits-na.yTruncBits,na.xShift=na.tagBits-na.yTruncBits-na.xTruncBits,na.xScale=1<<na.xShift,na.xOffset=na.xScale*(1<<na.xTruncBits-1),na.yMask=(1<<na.yTruncBits)-1<<na.yShift,na.xMask=~na.yMask,na.DestroyParticlesInShape_s_aabb=new Te,na.CreateParticleGroup_s_transform=new Dt,na.ComputeCollisionEnergy_s_v=new Ct,na.QueryShapeAABB_s_aabb=new Te,na.QueryPointAABB_s_aabb=new Te,na.RayCast_s_aabb=new Te,na.RayCast_s_p=new Ct,na.RayCast_s_v=new Ct,na.RayCast_s_n=new Ct,na.RayCast_s_point=new Ct,na.k_pairFlags=t.b2ParticleFlag.b2_springParticle,na.k_triadFlags=t.b2ParticleFlag.b2_elasticParticle,na.k_noPressureFlags=t.b2ParticleFlag.b2_powderParticle|t.b2ParticleFlag.b2_tensileParticle,na.k_extraDampingFlags=t.b2ParticleFlag.b2_staticPressureParticle,na.k_barrierWallFlags=t.b2ParticleFlag.b2_barrierParticle|t.b2ParticleFlag.b2_wallParticle,na.CreateParticlesStrokeShapeForGroup_s_edge=new hi,na.CreateParticlesStrokeShapeForGroup_s_d=new Ct,na.CreateParticlesStrokeShapeForGroup_s_p=new Ct,na.CreateParticlesFillShapeForGroup_s_aabb=new Te,na.CreateParticlesFillShapeForGroup_s_p=new Ct,na.UpdatePairsAndTriads_s_dab=new Ct,na.UpdatePairsAndTriads_s_dbc=new Ct,na.UpdatePairsAndTriads_s_dca=new Ct,na.AddContact_s_d=new Ct,na.UpdateBodyContacts_s_aabb=new Te,na.Solve_s_subStep=new vr,na.SolveCollision_s_aabb=new Te,na.SolveGravity_s_gravity=new Ct,na.SolveBarrier_s_aabb=new Te,na.SolveBarrier_s_va=new Ct,na.SolveBarrier_s_vb=new Ct,na.SolveBarrier_s_pba=new Ct,na.SolveBarrier_s_vba=new Ct,na.SolveBarrier_s_vc=new Ct,na.SolveBarrier_s_pca=new Ct,na.SolveBarrier_s_vca=new Ct,na.SolveBarrier_s_qba=new Ct,na.SolveBarrier_s_qca=new Ct,na.SolveBarrier_s_dv=new Ct,na.SolveBarrier_s_f=new Ct,na.SolvePressure_s_f=new Ct,na.SolveDamping_s_v=new Ct,na.SolveDamping_s_f=new Ct,na.SolveRigidDamping_s_t0=new Ct,na.SolveRigidDamping_s_t1=new Ct,na.SolveRigidDamping_s_p=new Ct,na.SolveRigidDamping_s_v=new Ct,na.SolveExtraDamping_s_v=new Ct,na.SolveExtraDamping_s_f=new Ct,na.SolveRigid_s_position=new Ct,na.SolveRigid_s_rotation=new Pt,na.SolveRigid_s_transform=new Dt,na.SolveRigid_s_velocityTransform=new Dt,na.SolveElastic_s_pa=new Ct,na.SolveElastic_s_pb=new Ct,na.SolveElastic_s_pc=new Ct,na.SolveElastic_s_r=new Pt,na.SolveElastic_s_t0=new Ct,na.SolveSpring_s_pa=new Ct,na.SolveSpring_s_pb=new Ct,na.SolveSpring_s_d=new Ct,na.SolveSpring_s_f=new Ct,na.SolveTensile_s_weightedNormal=new Ct,na.SolveTensile_s_s=new Ct,na.SolveTensile_s_f=new Ct,na.SolveViscous_s_v=new Ct,na.SolveViscous_s_f=new Ct,na.SolveRepulsive_s_f=new Ct,na.SolvePowder_s_f=new Ct,na.SolveSolid_s_f=new Ct,na.RemoveSpuriousBodyContacts_s_n=new Ct,na.RemoveSpuriousBodyContacts_s_pos=new Ct,na.RemoveSpuriousBodyContacts_s_normal=new Ct;var ia=function(){function t(){this._data=null,this.userSuppliedCapacity=0}return Q(t,[{key:"data",get:function(){return this._data},set:function(t){this._data=t}}]),t}(),ra=function(){function t(){this.index=T,this.tag=0}return t.CompareProxyProxy=function(t,e){return t.tag<e.tag},t.CompareTagProxy=function(t,e){return t<e.tag},t.CompareProxyTag=function(t,e){return t.tag<e},t}(),aa=function(){function t(t,e,n,i,r){this.m_system=t,this.m_xLower=(e&na.xMask)>>>0,this.m_xUpper=(n&na.xMask)>>>0,this.m_yLower=(e&na.yMask)>>>0,this.m_yUpper=(n&na.yMask)>>>0,this.m_first=i,this.m_last=r}return t.prototype.GetNext=function(){for(;this.m_first<this.m_last;){var t=(this.m_system.m_proxyBuffer.data[this.m_first].tag&na.xMask)>>>0;if(t>=this.m_xLower&&t<=this.m_xUpper)return this.m_system.m_proxyBuffer.data[this.m_first++].index;this.m_first++}return T},t}(),oa=function(){this.next=null,this.count=0,this.index=0},sa=function(){function t(){}var e=t.prototype;return e.Allocate=function(t,e){return e},e.Clear=function(){},e.GetCount=function(){return 0},e.Invalidate=function(){},e.GetValidBuffer=function(){return[]},e.GetBuffer=function(){return[]},e.SetCount=function(){},t}(),ca=function(t,e){this.second=T,this.first=t,this.second=e},la=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.Initialize=function(){},n.Find=function(){return T},e}(sa),ha=function(t,e){this.first=T,this.second=T,this.first=t,this.second=e},ua=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.Initialize=function(){},n.Find=function(){return T},e}(sa),_a=function(){function t(){}var e=t.prototype;return e.IsNecessary=function(){return!0},e.ShouldCreatePair=function(){return!0},e.ShouldCreateTriad=function(){return!0},t}(),fa=function(t){function e(e,n,i,r){var a;return(a=t.call(this)||this).m_callDestructionListener=!1,a.m_destroyed=0,a.m_system=e,a.m_shape=n,a.m_xf=i,a.m_callDestructionListener=r,a.m_destroyed=0,a}$(e,t);var n=e.prototype;return n.ReportFixture=function(){return!1},n.ReportParticle=function(t,e){return t===this.m_system&&(this.m_shape.TestPoint(this.m_xf,this.m_system.m_positionBuffer.data[e])&&(this.m_system.DestroyParticle(e,this.m_callDestructionListener),this.m_destroyed++),!0)},n.Destroyed=function(){return this.m_destroyed},e}(fr),da=function(t){function e(e){var n;return(n=t.call(this)||this).m_threshold=0,n.m_threshold=e,n}$(e,t);var n=e.prototype;return n.ShouldCreatePair=function(t,e){return t<this.m_threshold&&this.m_threshold<=e||e<this.m_threshold&&this.m_threshold<=t},n.ShouldCreateTriad=function(t,e,n){return(t<this.m_threshold||e<this.m_threshold||n<this.m_threshold)&&(this.m_threshold<=t||this.m_threshold<=e||this.m_threshold<=n)},e}(_a),pa=function(e){function n(n,i){var r;return void 0===i&&(i=n.length),(r=e.call(this,t.b2ShapeType.e_unknown,0)||this).m_shapeCount=0,r.m_shapes=n,r.m_shapeCount=i,r}$(n,e);var r=n.prototype;return r.Clone=function(){throw new Error},r.GetChildCount=function(){return 1},r.TestPoint=function(t,e){for(var n=0;n<this.m_shapeCount;n++)if(this.m_shapes[n].TestPoint(t,e))return!0;return!1},r.ComputeDistance=function(){return 0},r.RayCast=function(){return!1},r.ComputeAABB=function(t,e){var n=new Te;t.lowerBound.x=+i,t.lowerBound.y=+i,t.upperBound.x=-i,t.upperBound.y=-i;for(var r=0;r<this.m_shapeCount;r++)for(var a=this.m_shapes[r].GetChildCount(),o=0;o<a;o++){var s=n;this.m_shapes[r].ComputeAABB(s,e,o),t.Combine1(s)}},r.ComputeMass=function(){},r.SetupDistanceProxy=function(){},r.ComputeSubmergedArea=function(){return 0},r.Dump=function(){},n}(si),ma=function(e){function n(t){var n;return(n=e.call(this)||this).m_flagsBuffer=t,n}return $(n,e),n.prototype.IsNecessary=function(e){return 0!=(this.m_flagsBuffer.data[e]&t.b2ParticleFlag.b2_reactiveParticle)},n}(_a),va=function(e){function n(t,n){var i;return void 0===n&&(n=null),(i=e.call(this,t)||this).m_contactFilter=null,i.m_contactFilter=n,i}$(n,e);var i=n.prototype;return i.ShouldCollideFixtureParticle=function(e,n,i){return!(this.m_contactFilter&&this.m_system.GetFlagsBuffer()[i]&t.b2ParticleFlag.b2_fixtureContactFilterParticle)||this.m_contactFilter.ShouldCollideFixtureParticle(e,this.m_system,i)},i.ReportFixtureAndParticle=function(e,i,r){var a=n.ReportFixtureAndParticle_s_n,o=n.ReportFixtureAndParticle_s_rp,s=this.m_system.m_positionBuffer.data[r],c=a,l=e.ComputeDistance(s,c,i);if(l<this.m_system.m_particleDiameter&&this.ShouldCollideFixtureParticle(e,this.m_system,r)){var h=e.GetBody(),u=h.GetWorldCenter(),_=h.GetMass(),f=h.GetInertia()-_*h.GetLocalCenter().LengthSquared(),d=_>0?1/_:0,p=f>0?1/f:0,m=this.m_system.m_flagsBuffer.data[r]&t.b2ParticleFlag.b2_wallParticle?0:this.m_system.GetParticleInvMass(),v=Ct.SubVV(s,u,o),g=Ct.CrossVV(v,c),y=m+d+p*g*g,x=this.m_system.m_bodyContactBuffer.data[this.m_system.m_bodyContactBuffer.Append()];x.index=r,x.body=h,x.fixture=e,x.weight=1-l*this.m_system.m_inverseDiameter,x.normal.Copy(c.SelfNeg()),x.mass=y>0?1/y:0,this.m_system.DetectStuckParticle(r)}},n}(Jr);va.ReportFixtureAndParticle_s_n=new Ct,va.ReportFixtureAndParticle_s_rp=new Ct;var ga=function(e){function n(t,n){var i;return(i=e.call(this,t)||this).m_step=n,i}$(n,e);var i=n.prototype;return i.ReportFixtureAndParticle=function(e,i,r){var a=n.ReportFixtureAndParticle_s_p1,o=n.ReportFixtureAndParticle_s_output,s=n.ReportFixtureAndParticle_s_input,c=n.ReportFixtureAndParticle_s_p,l=n.ReportFixtureAndParticle_s_v,h=n.ReportFixtureAndParticle_s_f,_=e.GetBody(),f=this.m_system.m_positionBuffer.data[r],d=this.m_system.m_velocityBuffer.data[r],p=o,m=s;if(0===this.m_system.m_iterationIndex){var v=Dt.MulTXV(_.m_xf0,f,a);e.GetShape().GetType()===t.b2ShapeType.e_circleShape&&(v.SelfSub(_.GetLocalCenter()),Pt.MulRV(_.m_xf0.q,v,v),Pt.MulTRV(_.m_xf.q,v,v),v.SelfAdd(_.GetLocalCenter())),Dt.MulXV(_.m_xf,v,m.p1)}else m.p1.Copy(f);if(Ct.AddVMulSV(f,this.m_step.dt,d,m.p2),m.maxFraction=1,e.RayCast(p,m,i)){var g=p.normal,y=c;y.x=(1-p.fraction)*m.p1.x+p.fraction*m.p2.x+u*g.x,y.y=(1-p.fraction)*m.p1.y+p.fraction*m.p2.y+u*g.y;var x=l;x.x=this.m_step.inv_dt*(y.x-f.x),x.y=this.m_step.inv_dt*(y.y-f.y),this.m_system.m_velocityBuffer.data[r].Copy(x);var S=h;S.x=this.m_step.inv_dt*this.m_system.GetParticleMass()*(d.x-x.x),S.y=this.m_step.inv_dt*this.m_system.GetParticleMass()*(d.y-x.y),this.m_system.ParticleApplyForce(r,S)}},i.ReportParticle=function(){return!1},n}(Jr);ga.ReportFixtureAndParticle_s_p1=new Ct,ga.ReportFixtureAndParticle_s_output=new Ce,ga.ReportFixtureAndParticle_s_input=new be,ga.ReportFixtureAndParticle_s_p=new Ct,ga.ReportFixtureAndParticle_s_v=new Ct,ga.ReportFixtureAndParticle_s_f=new Ct;var ya=function(){function e(t){this.m_newFixture=!1,this.m_locked=!1,this.m_clearForces=!0,this.m_contactManager=new pr,this.m_bodyList=null,this.m_jointList=null,this.m_particleSystemList=null,this.m_bodyCount=0,this.m_jointCount=0,this.m_gravity=new Ct,this.m_allowSleep=!0,this.m_destructionListener=null,this.m_debugDraw=null,this.m_inv_dt0=0,this.m_warmStarting=!0,this.m_continuousPhysics=!0,this.m_subStepping=!1,this.m_stepComplete=!0,this.m_profile=new mr,this.m_island=new Pr,this.s_stack=[],this.m_controllerList=null,this.m_controllerCount=0,this.m_gravity.Copy(t)}var n=e.prototype;return n.SetDestructionListener=function(t){this.m_destructionListener=t},n.SetContactFilter=function(t){this.m_contactManager.m_contactFilter=t},n.SetContactListener=function(t){this.m_contactManager.m_contactListener=t},n.SetDebugDraw=function(t){this.m_debugDraw=t},n.CreateBody=function(t){if(void 0===t&&(t={}),this.IsLocked())throw new Error;var e=new xi(t,this);return e.m_prev=null,e.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=e),this.m_bodyList=e,++this.m_bodyCount,e},n.DestroyBody=function(t){if(this.IsLocked())throw new Error;for(var e=t.m_jointList;e;){var n=e;e=e.next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeJoint(n.joint),this.DestroyJoint(n.joint),t.m_jointList=e}t.m_jointList=null;for(var i=t.m_controllerList;i;){var r=i;i=i.nextController,r.controller.RemoveBody(t)}for(var a=t.m_contactList;a;){var o=a;a=a.next,this.m_contactManager.Destroy(o.contact)}t.m_contactList=null;for(var s=t.m_fixtureList;s;){var c=s;s=s.m_next,this.m_destructionListener&&this.m_destructionListener.SayGoodbyeFixture(c),c.DestroyProxies(),c.Reset(),t.m_fixtureList=s,t.m_fixtureCount-=1}t.m_fixtureList=null,t.m_fixtureCount=0,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_bodyList&&(this.m_bodyList=t.m_next),--this.m_bodyCount},e._Joint_Create=function(e){switch(e.type){case t.b2JointType.e_distanceJoint:return new Ei(e);case t.b2JointType.e_mouseJoint:return new Li(e);case t.b2JointType.e_prismaticJoint:return new Vi(e);case t.b2JointType.e_revoluteJoint:return new Hi(e);case t.b2JointType.e_pulleyJoint:return new Ui(e);case t.b2JointType.e_gearJoint:return new Mi(e);case t.b2JointType.e_wheelJoint:return new Ki(e);case t.b2JointType.e_weldJoint:return new Xi(e);case t.b2JointType.e_frictionJoint:return new Di(e);case t.b2JointType.e_ropeJoint:return new Wi(e);case t.b2JointType.e_motorJoint:return new Ni(e);case t.b2JointType.e_areaJoint:return new Ii(e)}throw new Error},e._Joint_Destroy=function(){},n.CreateJoint=function(t){if(this.IsLocked())throw new Error;var n=e._Joint_Create(t);n.m_prev=null,n.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=n),this.m_jointList=n,++this.m_jointCount,n.m_edgeA.prev=null,n.m_edgeA.next=n.m_bodyA.m_jointList,n.m_bodyA.m_jointList&&(n.m_bodyA.m_jointList.prev=n.m_edgeA),n.m_bodyA.m_jointList=n.m_edgeA,n.m_edgeB.prev=null,n.m_edgeB.next=n.m_bodyB.m_jointList,n.m_bodyB.m_jointList&&(n.m_bodyB.m_jointList.prev=n.m_edgeB),n.m_bodyB.m_jointList=n.m_edgeB;var i=n.m_bodyA,r=n.m_bodyB;if(!n.m_collideConnected)for(var a=r.GetContactList();a;)a.other===i&&a.contact.FlagForFiltering(),a=a.next;return n},n.DestroyJoint=function(t){if(this.IsLocked())throw new Error;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_jointList&&(this.m_jointList=t.m_next);var n=t.m_bodyA,i=t.m_bodyB,r=t.m_collideConnected;if(n.SetAwake(!0),i.SetAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA===n.m_jointList&&(n.m_jointList=t.m_edgeA.next),t.m_edgeA.Reset(),t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB===i.m_jointList&&(i.m_jointList=t.m_edgeB.next),t.m_edgeB.Reset(),e._Joint_Destroy(t),--this.m_jointCount,!r)for(var a=i.GetContactList();a;)a.other===n&&a.contact.FlagForFiltering(),a=a.next},n.CreateParticleSystem=function(t){if(this.IsLocked())throw new Error;var e=new na(t,this);return e.m_prev=null,e.m_next=this.m_particleSystemList,this.m_particleSystemList&&(this.m_particleSystemList.m_prev=e),this.m_particleSystemList=e,e},n.DestroyParticleSystem=function(t){if(this.IsLocked())throw new Error;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t===this.m_particleSystemList&&(this.m_particleSystemList=t.m_next)},n.CalculateReasonableParticleIterations=function(t){if(null===this.m_particleSystemList)return 1;function e(t){for(var e=i,n=t.GetParticleSystemList();null!==n;n=n.m_next)e=nt(e,n.GetRadius());return e}return Rr(this.m_gravity.Length(),e(this),t)},n.Step=function(t,n,i,r){void 0===r&&(r=this.CalculateReasonableParticleIterations(t));var a=e.Step_s_stepTimer.Reset();this.m_newFixture&&(this.m_contactManager.FindNewContacts(),this.m_newFixture=!1),this.m_locked=!0;var o=e.Step_s_step;o.dt=t,o.velocityIterations=n,o.positionIterations=i,o.particleIterations=r,o.inv_dt=t>0?1/t:0,o.dtRatio=this.m_inv_dt0*t,o.warmStarting=this.m_warmStarting;var s=e.Step_s_timer.Reset();if(this.m_contactManager.Collide(),this.m_profile.collide=s.GetMilliseconds(),this.m_stepComplete&&o.dt>0){for(var c=e.Step_s_timer.Reset(),l=this.m_particleSystemList;l;l=l.m_next)l.Solve(o);this.Solve(o),this.m_profile.solve=c.GetMilliseconds()}if(this.m_continuousPhysics&&o.dt>0){var h=e.Step_s_timer.Reset();this.SolveTOI(o),this.m_profile.solveTOI=h.GetMilliseconds()}o.dt>0&&(this.m_inv_dt0=o.inv_dt),this.m_clearForces&&this.ClearForces(),this.m_locked=!1,this.m_profile.step=a.GetMilliseconds()},n.ClearForces=function(){for(var t=this.m_bodyList;t;t=t.m_next)t.m_force.SetZero(),t.m_torque=0},n.DrawParticleSystem=function(t){if(null!==this.m_debugDraw){var e=t.GetParticleCount();if(e){var n=t.GetRadius(),i=t.GetPositionBuffer();if(t.m_colorBuffer.data){var r=t.GetColorBuffer();this.m_debugDraw.DrawParticles(i,n,r,e)}else this.m_debugDraw.DrawParticles(i,n,null,e)}}},n.DrawDebugData=function(){if(null!==this.m_debugDraw){var n=this.m_debugDraw.GetFlags(),i=e.DrawDebugData_s_color.SetRGB(0,0,0);if(n&t.b2DrawFlags.e_shapeBit)for(var r=this.m_bodyList;r;r=r.m_next){var a=r.m_xf;this.m_debugDraw.PushTransform(a);for(var o=r.GetFixtureList();o;o=o.m_next)r.IsActive()?r.GetType()===t.b2BodyType.b2_staticBody?(i.SetRGB(.5,.9,.5),this.DrawShape(o,i)):r.GetType()===t.b2BodyType.b2_kinematicBody?(i.SetRGB(.5,.5,.9),this.DrawShape(o,i)):r.IsAwake()?(i.SetRGB(.9,.7,.7),this.DrawShape(o,i)):(i.SetRGB(.6,.6,.6),this.DrawShape(o,i)):(i.SetRGB(.5,.5,.3),this.DrawShape(o,i));this.m_debugDraw.PopTransform(a)}if(n&t.b2DrawFlags.e_particleBit)for(var s=this.m_particleSystemList;s;s=s.m_next)this.DrawParticleSystem(s);if(n&t.b2DrawFlags.e_jointBit)for(var c=this.m_jointList;c;c=c.m_next)this.DrawJoint(c);if(n&t.b2DrawFlags.e_aabbBit){i.SetRGB(.9,.3,.9);for(var l=e.DrawDebugData_s_vs,h=this.m_bodyList;h;h=h.m_next)if(h.IsActive())for(var u=h.GetFixtureList();u;u=u.m_next)for(var _=0;_<u.m_proxyCount;++_){var f=u.m_proxies[_].treeNode.aabb;l[0].Set(f.lowerBound.x,f.lowerBound.y),l[1].Set(f.upperBound.x,f.lowerBound.y),l[2].Set(f.upperBound.x,f.upperBound.y),l[3].Set(f.lowerBound.x,f.upperBound.y),this.m_debugDraw.DrawPolygon(l,4,i)}}if(n&t.b2DrawFlags.e_centerOfMassBit)for(var d=this.m_bodyList;d;d=d.m_next){var p=e.DrawDebugData_s_xf;p.q.Copy(d.m_xf.q),p.p.Copy(d.GetWorldCenter()),this.m_debugDraw.DrawTransform(p)}if(n&t.b2DrawFlags.e_controllerBit)for(var m=this.m_controllerList;m;m=m.m_next)m.Draw(this.m_debugDraw)}},n.QueryAABB=function(){(arguments.length<=0?void 0:arguments[0])instanceof fr?this._QueryAABB(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this._QueryAABB(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])},n._QueryAABB=function(t,e,n){if(this.m_contactManager.m_broadPhase.Query(e,(function(e){var i=e.userData.fixture;return t?t.ReportFixture(i):!n||n(i)})),t instanceof fr)for(var i=this.m_particleSystemList;i;i=i.m_next)t.ShouldQueryParticleSystem(i)&&i.QueryAABB(t,e)},n.QueryAllAABB=function(t,e){return void 0===e&&(e=[]),this.QueryAABB(t,(function(t){return e.push(t),!0})),e},n.QueryPointAABB=function(){(arguments.length<=0?void 0:arguments[0])instanceof fr?this._QueryPointAABB(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this._QueryPointAABB(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])},n._QueryPointAABB=function(t,e,n){if(this.m_contactManager.m_broadPhase.QueryPoint(e,(function(e){var i=e.userData.fixture;return t?t.ReportFixture(i):!n||n(i)})),t instanceof fr)for(var i=this.m_particleSystemList;i;i=i.m_next)t.ShouldQueryParticleSystem(i)&&i.QueryPointAABB(t,e)},n.QueryAllPointAABB=function(t,e){return void 0===e&&(e=[]),this.QueryPointAABB(t,(function(t){return e.push(t),!0})),e},n.QueryFixtureShape=function(){(arguments.length<=0?void 0:arguments[0])instanceof fr?this._QueryFixtureShape(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2],arguments.length<=3?void 0:arguments[3]):this._QueryFixtureShape(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2],arguments.length<=3?void 0:arguments[3])},n._QueryFixtureShape=function(t,n,i,r,a){var o=e.QueryFixtureShape_s_aabb;if(n.ComputeAABB(o,r,i),this.m_contactManager.m_broadPhase.Query(o,(function(e){var o=e.userData,s=o.fixture;if(Re(n,i,s.GetShape(),o.childIndex,r,s.GetBody().GetTransform())){if(t)return t.ReportFixture(s);if(a)return a(s)}return!0})),t instanceof fr)for(var s=this.m_particleSystemList;s;s=s.m_next)t.ShouldQueryParticleSystem(s)&&s.QueryAABB(t,o)},n.QueryAllFixtureShape=function(t,e,n,i){return void 0===i&&(i=[]),this.QueryFixtureShape(t,e,n,(function(t){return i.push(t),!0})),i},n.QueryFixturePoint=function(){(arguments.length<=0?void 0:arguments[0])instanceof fr?this._QueryFixturePoint(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1]):this._QueryFixturePoint(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1])},n._QueryFixturePoint=function(t,e,n){if(this.m_contactManager.m_broadPhase.QueryPoint(e,(function(i){var r=i.userData.fixture;if(r.TestPoint(e)){if(t)return t.ReportFixture(r);if(n)return n(r)}return!0})),t)for(var i=this.m_particleSystemList;i;i=i.m_next)t.ShouldQueryParticleSystem(i)&&i.QueryPointAABB(t,e)},n.QueryAllFixturePoint=function(t,e){return void 0===e&&(e=[]),this.QueryFixturePoint(t,(function(t){return e.push(t),!0})),e},n.RayCast=function(){(arguments.length<=0?void 0:arguments[0])instanceof dr?this._RayCast(arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2]):this._RayCast(null,arguments.length<=0?void 0:arguments[0],arguments.length<=1?void 0:arguments[1],arguments.length<=2?void 0:arguments[2])},n._RayCast=function(t,n,i,r){var a=e.RayCast_s_input;if(a.maxFraction=1,a.p1.Copy(n),a.p2.Copy(i),this.m_contactManager.m_broadPhase.RayCast(a,(function(a,o){var s=o.userData,c=s.fixture,l=s.childIndex,h=e.RayCast_s_output;if(c.RayCast(h,a,l)){var u=h.fraction,_=e.RayCast_s_point;if(_.Set((1-u)*n.x+u*i.x,(1-u)*n.y+u*i.y),t)return t.ReportFixture(c,_,h.normal,u);if(r)return r(c,_,h.normal,u)}return a.maxFraction})),t)for(var o=this.m_particleSystemList;o;o=o.m_next)t.ShouldQueryParticleSystem(o)&&o.RayCast(t,n,i)},n.RayCastOne=function(t,e){var n=null,i=1;return this.RayCast(t,e,(function(t,e,r,a){return a<i&&(i=a,n=t),i})),n},n.RayCastAll=function(t,e,n){return void 0===n&&(n=[]),this.RayCast(t,e,(function(t){return n.push(t),1})),n},n.GetBodyList=function(){return this.m_bodyList},n.GetJointList=function(){return this.m_jointList},n.GetParticleSystemList=function(){return this.m_particleSystemList},n.GetContactList=function(){return this.m_contactManager.m_contactList},n.SetAllowSleeping=function(t){if(t!==this.m_allowSleep&&(this.m_allowSleep=t,!this.m_allowSleep))for(var e=this.m_bodyList;e;e=e.m_next)e.SetAwake(!0)},n.GetAllowSleeping=function(){return this.m_allowSleep},n.SetWarmStarting=function(t){this.m_warmStarting=t},n.GetWarmStarting=function(){return this.m_warmStarting},n.SetContinuousPhysics=function(t){this.m_continuousPhysics=t},n.GetContinuousPhysics=function(){return this.m_continuousPhysics},n.SetSubStepping=function(t){this.m_subStepping=t},n.GetSubStepping=function(){return this.m_subStepping},n.GetProxyCount=function(){return this.m_contactManager.m_broadPhase.GetProxyCount()},n.GetBodyCount=function(){return this.m_bodyCount},n.GetJointCount=function(){return this.m_jointCount},n.GetContactCount=function(){return this.m_contactManager.m_contactCount},n.GetTreeHeight=function(){return this.m_contactManager.m_broadPhase.GetTreeHeight()},n.GetTreeBalance=function(){return this.m_contactManager.m_broadPhase.GetTreeBalance()},n.GetTreeQuality=function(){return this.m_contactManager.m_broadPhase.GetTreeQuality()},n.SetGravity=function(t,e){if(void 0===e&&(e=!0),!Ct.IsEqualToV(this.m_gravity,t)&&(this.m_gravity.Copy(t),e))for(var n=this.m_bodyList;n;n=n.m_next)n.SetAwake(!0)},n.GetGravity=function(){return this.m_gravity},n.IsLocked=function(){return this.m_locked},n.SetAutoClearForces=function(t){this.m_clearForces=t},n.GetAutoClearForces=function(){return this.m_clearForces},n.ShiftOrigin=function(t){if(this.IsLocked())throw new Error;for(var e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.SelfSub(t),e.m_sweep.c0.SelfSub(t),e.m_sweep.c.SelfSub(t);for(var n=this.m_jointList;n;n=n.m_next)n.ShiftOrigin(t);this.m_contactManager.m_broadPhase.ShiftOrigin(t)},n.GetContactManager=function(){return this.m_contactManager},n.GetProfile=function(){return this.m_profile},n.Dump=function(e){if(!this.m_locked){e("const g: b2Vec2 = new b2Vec2(%.15f, %.15f);\n",this.m_gravity.x,this.m_gravity.y),e("this.m_world.SetGravity(g);\n"),e("const bodies: b2Body[] = [];\n"),e("const joints: b2Joint[] = [];\n");for(var n=0,i=this.m_bodyList;i;i=i.m_next)i.m_islandIndex=n,i.Dump(e),++n;n=0;for(var r=this.m_jointList;r;r=r.m_next)r.m_index=n,++n;for(var a=this.m_jointList;a;a=a.m_next)a.m_type!==t.b2JointType.e_gearJoint&&(e("{\n"),a.Dump(e),e("}\n"));for(var o=this.m_jointList;o;o=o.m_next)o.m_type===t.b2JointType.e_gearJoint&&(e("{\n"),o.Dump(e),e("}\n"))}},n.DrawJoint=function(n){if(null!==this.m_debugDraw){var i=n.GetBodyA(),r=n.GetBodyB(),a=i.m_xf,o=r.m_xf,s=a.p,c=o.p,l=n.GetAnchorA(e.DrawJoint_s_p1),h=n.GetAnchorB(e.DrawJoint_s_p2),u=e.DrawJoint_s_color.SetRGB(.5,.8,.8);switch(n.m_type){case t.b2JointType.e_distanceJoint:this.m_debugDraw.DrawSegment(l,h,u);break;case t.b2JointType.e_pulleyJoint:var _=n,f=_.GetGroundAnchorA(),d=_.GetGroundAnchorB();this.m_debugDraw.DrawSegment(f,l,u),this.m_debugDraw.DrawSegment(d,h,u),this.m_debugDraw.DrawSegment(f,d,u);break;case t.b2JointType.e_mouseJoint:var p=e.DrawJoint_s_c;p.Set(0,1,0),this.m_debugDraw.DrawPoint(l,4,p),this.m_debugDraw.DrawPoint(h,4,p),p.Set(.8,.8,.8),this.m_debugDraw.DrawSegment(l,h,p);break;default:this.m_debugDraw.DrawSegment(s,l,u),this.m_debugDraw.DrawSegment(l,h,u),this.m_debugDraw.DrawSegment(c,h,u)}}},n.DrawShape=function(n,i){if(null!==this.m_debugDraw){var r=n.GetShape();switch(r.m_type){case t.b2ShapeType.e_circleShape:var a=r,o=a.m_p,s=a.m_radius,c=Ct.UNITX;this.m_debugDraw.DrawSolidCircle(o,s,c,i);break;case t.b2ShapeType.e_edgeShape:var l=r,h=l.m_vertex1,u=l.m_vertex2;this.m_debugDraw.DrawSegment(h,u,i);break;case t.b2ShapeType.e_chainShape:var _=r,f=_.m_count,d=_.m_vertices,p=e.DrawShape_s_ghostColor.SetRGBA(.75*i.r,.75*i.g,.75*i.b,i.a),m=d[0];if(this.m_debugDraw.DrawPoint(m,4,i),_.m_hasPrevVertex){var v=_.m_prevVertex;this.m_debugDraw.DrawSegment(v,m,p),this.m_debugDraw.DrawCircle(v,.1,p)}for(var g=1;g<f;++g){var y=d[g];this.m_debugDraw.DrawSegment(m,y,i),this.m_debugDraw.DrawPoint(y,4,i),m=y}if(_.m_hasNextVertex){var x=_.m_nextVertex;this.m_debugDraw.DrawSegment(x,m,p),this.m_debugDraw.DrawCircle(x,.1,p)}break;case t.b2ShapeType.e_polygonShape:var S=r,A=S.m_count,b=S.m_vertices;this.m_debugDraw.DrawSolidPolygon(b,A,i)}}},n.Solve=function(e){for(var n=this.m_bodyList;n;n=n.m_next)n.m_xf0.Copy(n.m_xf);for(var i=this.m_controllerList;i;i=i.m_next)i.Step(e);this.m_profile.solveInit=0,this.m_profile.solveVelocity=0,this.m_profile.solvePosition=0;var r=this.m_island;r.Initialize(this.m_bodyCount,this.m_contactManager.m_contactCount,this.m_jointCount,this.m_contactManager.m_contactListener);for(var a=this.m_bodyList;a;a=a.m_next)a.m_islandFlag=!1;for(var o=this.m_contactManager.m_contactList;o;o=o.m_next)o.m_islandFlag=!1;for(var s=this.m_jointList;s;s=s.m_next)s.m_islandFlag=!1;for(var c=this.s_stack,l=this.m_bodyList;l;l=l.m_next)if(!l.m_islandFlag&&l.IsAwake()&&l.IsActive()&&l.GetType()!==t.b2BodyType.b2_staticBody){r.Clear();var h=0;for(c[h++]=l,l.m_islandFlag=!0;h>0;){var u=c[--h];if(!u)throw new Error;if(r.AddBody(u),u.m_awakeFlag=!0,u.GetType()!==t.b2BodyType.b2_staticBody){for(var _=u.m_contactList;_;_=_.next){var f=_.contact;if(!f.m_islandFlag&&f.IsEnabled()&&f.IsTouching()){var d=f.m_fixtureA.m_isSensor,p=f.m_fixtureB.m_isSensor;if(!d&&!p){r.AddContact(f),f.m_islandFlag=!0;var m=_.other;m.m_islandFlag||(c[h++]=m,m.m_islandFlag=!0)}}}for(var v=u.m_jointList;v;v=v.next)if(!v.joint.m_islandFlag){var g=v.other;g.IsActive()&&(r.AddJoint(v.joint),v.joint.m_islandFlag=!0,g.m_islandFlag||(c[h++]=g,g.m_islandFlag=!0))}}}var y=new mr;r.Solve(y,e,this.m_gravity,this.m_allowSleep),this.m_profile.solveInit+=y.solveInit,this.m_profile.solveVelocity+=y.solveVelocity,this.m_profile.solvePosition+=y.solvePosition;for(var x=0;x<r.m_bodyCount;++x){var S=r.m_bodies[x];S.GetType()===t.b2BodyType.b2_staticBody&&(S.m_islandFlag=!1)}}for(var A=0;A<c.length&&c[A];++A)c[A]=null;for(var b=new Bt,C=this.m_bodyList;C;C=C.m_next)C.m_islandFlag&&C.GetType()!==t.b2BodyType.b2_staticBody&&C.SynchronizeFixtures();this.m_contactManager.FindNewContacts(),this.m_profile.broadphase=b.GetMilliseconds()},n.SolveTOI=function(n){var i=this.m_island;if(i.Initialize(2*p,p,0,this.m_contactManager.m_contactListener),this.m_stepComplete){for(var a=this.m_bodyList;a;a=a.m_next)a.m_islandFlag=!1,a.m_sweep.alpha0=0;for(var o=this.m_contactManager.m_contactList;o;o=o.m_next)o.m_toiFlag=!1,o.m_islandFlag=!1,o.m_toiCount=0,o.m_toi=1}for(;;){for(var s=null,c=1,l=this.m_contactManager.m_contactList;l;l=l.m_next)if(l.IsEnabled()&&!(l.m_toiCount>d)){var h=1;if(l.m_toiFlag)h=l.m_toi;else{var u=l.GetFixtureA(),_=l.GetFixtureB();if(u.IsSensor()||_.IsSensor())continue;var f=u.GetBody(),m=_.GetBody(),v=f.m_type,g=m.m_type,y=f.IsAwake()&&v!==t.b2BodyType.b2_staticBody,x=m.IsAwake()&&g!==t.b2BodyType.b2_staticBody;if(!y&&!x)continue;var S=f.IsBullet()||v!==t.b2BodyType.b2_dynamicBody,A=m.IsBullet()||g!==t.b2BodyType.b2_dynamicBody;if(!S&&!A)continue;var b=f.m_sweep.alpha0;f.m_sweep.alpha0<m.m_sweep.alpha0?(b=m.m_sweep.alpha0,f.m_sweep.Advance(b)):m.m_sweep.alpha0<f.m_sweep.alpha0&&(b=f.m_sweep.alpha0,m.m_sweep.Advance(b));var C=l.GetChildIndexA(),T=l.GetChildIndexB(),E=e.SolveTOI_s_toi_input;E.proxyA.SetShape(u.GetShape(),C),E.proxyB.SetShape(_.GetShape(),T),E.sweepA.Copy(f.m_sweep),E.sweepB.Copy(m.m_sweep),E.tMax=1;var w=e.SolveTOI_s_toi_output;hn(w,E);var I=w.t;h=w.state===t.b2TOIOutputState.e_touching?nt(b+(1-b)*I,1):1,l.m_toi=h,l.m_toiFlag=!0}h<c&&(s=l,c=h)}if(null===s||1-10*r<c){this.m_stepComplete=!0;break}var P=s.GetFixtureA(),D=s.GetFixtureB(),R=P.GetBody(),M=D.GetBody(),O=e.SolveTOI_s_backup1.Copy(R.m_sweep),N=e.SolveTOI_s_backup2.Copy(M.m_sweep);if(R.Advance(c),M.Advance(c),s.Update(this.m_contactManager.m_contactListener),s.m_toiFlag=!1,++s.m_toiCount,s.IsEnabled()&&s.IsTouching()){R.SetAwake(!0),M.SetAwake(!0),i.Clear(),i.AddBody(R),i.AddBody(M),i.AddContact(s),R.m_islandFlag=!0,M.m_islandFlag=!0,s.m_islandFlag=!0;for(var B=0;B<2;++B){var L=0===B?R:M;if(L.m_type===t.b2BodyType.b2_dynamicBody)for(var F=L.m_contactList;F&&i.m_bodyCount!==i.m_bodyCapacity&&i.m_contactCount!==i.m_contactCapacity;F=F.next){var V=F.contact;if(!V.m_islandFlag){var z=F.other;if(z.m_type!==t.b2BodyType.b2_dynamicBody||L.IsBullet()||z.IsBullet()){var k=V.m_fixtureA.m_isSensor,U=V.m_fixtureB.m_isSensor;if(!k&&!U){var G=e.SolveTOI_s_backup.Copy(z.m_sweep);z.m_islandFlag||z.Advance(c),V.Update(this.m_contactManager.m_contactListener),V.IsEnabled()&&V.IsTouching()?(V.m_islandFlag=!0,i.AddContact(V),z.m_islandFlag||(z.m_islandFlag=!0,z.m_type!==t.b2BodyType.b2_staticBody&&z.SetAwake(!0),i.AddBody(z))):(z.m_sweep.Copy(G),z.SynchronizeTransform())}}}}}var H=e.SolveTOI_s_subStep;H.dt=(1-c)*n.dt,H.inv_dt=1/H.dt,H.dtRatio=1,H.positionIterations=20,H.velocityIterations=n.velocityIterations,H.particleIterations=n.particleIterations,H.warmStarting=!1,i.SolveTOI(H,R.m_islandIndex,M.m_islandIndex);for(var j=0;j<i.m_bodyCount;++j){var W=i.m_bodies[j];if(W.m_islandFlag=!1,W.m_type===t.b2BodyType.b2_dynamicBody){W.SynchronizeFixtures();for(var q=W.m_contactList;q;q=q.next)q.contact.m_toiFlag=!1,q.contact.m_islandFlag=!1}}if(this.m_contactManager.FindNewContacts(),this.m_subStepping){this.m_stepComplete=!1;break}}else s.SetEnabled(!1),R.m_sweep.Copy(O),M.m_sweep.Copy(N),R.SynchronizeTransform(),M.SynchronizeTransform()}},n.AddController=function(t){return t.m_next=this.m_controllerList,t.m_prev=null,this.m_controllerList&&(this.m_controllerList.m_prev=t),this.m_controllerList=t,++this.m_controllerCount,t},n.RemoveController=function(t){return t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),this.m_controllerList===t&&(this.m_controllerList=t.m_next),--this.m_controllerCount,t.m_prev=null,t.m_next=null,t},e}();ya.Step_s_step=new vr,ya.Step_s_stepTimer=new Bt,ya.Step_s_timer=new Bt,ya.DrawDebugData_s_color=new Ot(0,0,0),ya.DrawDebugData_s_vs=Ct.MakeArray(4),ya.DrawDebugData_s_xf=new Dt,ya.QueryFixtureShape_s_aabb=new Te,ya.RayCast_s_input=new be,ya.RayCast_s_output=new Ce,ya.RayCast_s_point=new Ct,ya.DrawJoint_s_p1=new Ct,ya.DrawJoint_s_p2=new Ct,ya.DrawJoint_s_color=new Ot(.5,.8,.8),ya.DrawJoint_s_c=new Ot,ya.DrawShape_s_ghostColor=new Ot,ya.SolveTOI_s_subStep=new vr,ya.SolveTOI_s_backup=new Mt,ya.SolveTOI_s_backup1=new Mt,ya.SolveTOI_s_backup2=new Mt,ya.SolveTOI_s_toi_input=new Je,ya.SolveTOI_s_toi_output=new Ze;var xa=function(t,e){this.prevBody=null,this.nextBody=null,this.prevController=null,this.nextController=null,this.controller=t,this.body=e},Sa=function(){function t(){this.m_bodyList=null,this.m_bodyCount=0,this.m_prev=null,this.m_next=null}var e=t.prototype;return e.GetNext=function(){return this.m_next},e.GetPrev=function(){return this.m_prev},e.GetBodyList=function(){return this.m_bodyList},e.AddBody=function(t){var e=new xa(this,t);e.nextBody=this.m_bodyList,e.prevBody=null,this.m_bodyList&&(this.m_bodyList.prevBody=e),this.m_bodyList=e,++this.m_bodyCount,e.nextController=t.m_controllerList,e.prevController=null,t.m_controllerList&&(t.m_controllerList.prevController=e),t.m_controllerList=e,++t.m_controllerCount},e.RemoveBody=function(t){if(this.m_bodyCount<=0)throw new Error;for(var e=this.m_bodyList;e&&e.body!==t;)e=e.nextBody;if(null===e)throw new Error;e.prevBody&&(e.prevBody.nextBody=e.nextBody),e.nextBody&&(e.nextBody.prevBody=e.prevBody),this.m_bodyList===e&&(this.m_bodyList=e.nextBody),--this.m_bodyCount,e.nextController&&(e.nextController.prevController=e.prevController),e.prevController&&(e.prevController.nextController=e.nextController),t.m_controllerList===e&&(t.m_controllerList=e.nextController),--t.m_controllerCount},e.Clear=function(){for(;this.m_bodyList;)this.RemoveBody(this.m_bodyList.body);this.m_bodyCount=0},t}(),Aa=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).normal=new Ct(0,1),e.offset=0,e.density=0,e.velocity=new Ct(0,0),e.linearDrag=0,e.angularDrag=0,e.useDensity=!1,e.useWorldGravity=!0,e.gravity=new Ct(0,0),e}$(e,t);var n=e.prototype;return n.Step=function(){if(this.m_bodyList){this.useWorldGravity&&this.gravity.Copy(this.m_bodyList.body.GetWorld().GetGravity());for(var t=this.m_bodyList;t;t=t.nextBody){var e=t.body;if(e.IsAwake()){for(var n=new Ct,i=new Ct,a=0,o=0,s=e.GetFixtureList();s;s=s.m_next){var c=new Ct,l=s.GetShape().ComputeSubmergedArea(this.normal,this.offset,e.GetTransform(),c);a+=l,n.x+=l*c.x,n.y+=l*c.y;var h=0;o+=l*(h=this.useDensity?s.GetDensity():1),i.x+=l*c.x*h,i.y+=l*c.y*h}if(n.x/=a,n.y/=a,i.x/=o,i.y/=o,!(a<r)){var u=this.gravity.Clone().SelfNeg();u.SelfMul(this.density*a),e.ApplyForce(u,i);var _=e.GetLinearVelocityFromWorldPoint(n,new Ct);_.SelfSub(this.velocity),_.SelfMul(-this.linearDrag*a),e.ApplyForce(_,n),e.ApplyTorque(-e.GetInertia()/e.GetMass()*a*e.GetAngularVelocity()*this.angularDrag)}}}}},n.Draw=function(t){var e=100,n=new Ct,i=new Ct;n.x=this.normal.x*this.offset+this.normal.y*e,n.y=this.normal.y*this.offset-this.normal.x*e,i.x=this.normal.x*this.offset-this.normal.y*e,i.y=this.normal.y*this.offset+this.normal.x*e;var r=new Ot(0,0,.8);t.DrawSegment(n,i,r)},e}(Sa),ba=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).A=new Ct(0,0),e}$(e,t);var n=e.prototype;return n.Step=function(t){for(var n=Ct.MulSV(t.dt,this.A,e.Step_s_dtA),i=this.m_bodyList;i;i=i.nextBody){var r=i.body;r.IsAwake()&&r.SetLinearVelocity(Ct.AddVV(r.GetLinearVelocity(),n,Ct.s_t0))}},n.Draw=function(){},e}(Sa);ba.Step_s_dtA=new Ct;var Ca=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).F=new Ct(0,0),e}$(e,t);var n=e.prototype;return n.Step=function(){for(var t=this.m_bodyList;t;t=t.nextBody){var e=t.body;e.IsAwake()&&e.ApplyForce(this.F,e.GetWorldCenter())}},n.Draw=function(){},e}(Sa),Ta=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).G=1,e.invSqr=!0,e}$(e,t);var n=e.prototype;return n.Step=function(){if(this.invSqr)for(var t=this.m_bodyList;t;t=t.nextBody)for(var n=t.body,i=n.GetWorldCenter(),a=n.GetMass(),o=this.m_bodyList;o&&o!==t;o=o.nextBody){var s=o.body,c=s.GetWorldCenter(),l=s.GetMass(),h=c.x-i.x,u=c.y-i.y,_=h*h+u*u;if(!(_<r)){var f=e.Step_s_f.Set(h,u);f.SelfMul(this.G/_/ut(_)*a*l),n.IsAwake()&&n.ApplyForce(f,i),s.IsAwake()&&s.ApplyForce(f.SelfMul(-1),c)}}else for(var d=this.m_bodyList;d;d=d.nextBody)for(var p=d.body,m=p.GetWorldCenter(),v=p.GetMass(),g=this.m_bodyList;g&&g!==d;g=g.nextBody){var y=g.body,x=y.GetWorldCenter(),S=y.GetMass(),A=x.x-m.x,b=x.y-m.y,C=A*A+b*b;if(!(C<r)){var T=e.Step_s_f.Set(A,b);T.SelfMul(this.G/C*v*S),p.IsAwake()&&p.ApplyForce(T,m),y.IsAwake()&&y.ApplyForce(T.SelfMul(-1),x)}}},n.Draw=function(){},e}(Sa);Ta.Step_s_f=new Ct;var Ea=function(t){function e(){var e;return(e=t.apply(this,arguments)||this).T=new wt,e.maxTimestep=0,e}$(e,t);var n=e.prototype;return n.Step=function(t){var n=t.dt;if(!(n<=r)){n>this.maxTimestep&&this.maxTimestep>0&&(n=this.maxTimestep);for(var i=this.m_bodyList;i;i=i.nextBody){var a=i.body;if(a.IsAwake()){var o=a.GetWorldVector(wt.MulMV(this.T,a.GetLocalVector(a.GetLinearVelocity(),Ct.s_t0),Ct.s_t1),e.Step_s_damping);a.SetLinearVelocity(Ct.AddVV(a.GetLinearVelocity(),Ct.MulSV(n,o,Ct.s_t0),Ct.s_t1))}}}},n.Draw=function(){},n.SetAxisAligned=function(t,e){this.T.ex.x=-t,this.T.ex.y=0,this.T.ey.x=0,this.T.ey.y=-e,this.maxTimestep=t>0||e>0?1/rt(t,e):0},e}(Sa);Ea.Step_s_damping=new Ct;var wa=function(){this.vertices=[],this.count=0,this.masses=[],this.gravity=new Ct(0,0),this.damping=.1,this.k2=.9,this.k3=.1},Ia=function(){function t(){this.m_count=0,this.m_ps=[],this.m_p0s=[],this.m_vs=[],this.m_ims=[],this.m_Ls=[],this.m_as=[],this.m_gravity=new Ct,this.m_damping=0,this.m_k2=1,this.m_k3=.1}var e=t.prototype;return e.GetVertexCount=function(){return this.m_count},e.GetVertices=function(){return this.m_ps},e.Initialize=function(t){this.m_count=t.count,this.m_ps=Ct.MakeArray(this.m_count),this.m_p0s=Ct.MakeArray(this.m_count),this.m_vs=Ct.MakeArray(this.m_count),this.m_ims=K(this.m_count);for(var e=0;e<this.m_count;++e){this.m_ps[e].Copy(t.vertices[e]),this.m_p0s[e].Copy(t.vertices[e]),this.m_vs[e].SetZero();var n=t.masses[e];this.m_ims[e]=n>0?1/n:0}var i=this.m_count-1,r=this.m_count-2;this.m_Ls=K(i),this.m_as=K(r);for(var a=0;a<i;++a){var o=this.m_ps[a],s=this.m_ps[a+1];this.m_Ls[a]=Ct.DistanceVV(o,s)}for(var c=0;c<r;++c){var l=this.m_ps[c],h=this.m_ps[c+1],u=this.m_ps[c+2],_=Ct.SubVV(h,l,Ct.s_t0),f=Ct.SubVV(u,h,Ct.s_t1),d=Ct.CrossVV(_,f),p=Ct.DotVV(_,f);this.m_as[c]=yt(d,p)}this.m_gravity.Copy(t.gravity),this.m_damping=t.damping,this.m_k2=t.k2,this.m_k3=t.k3},e.Step=function(t,e){if(0!==t){for(var n=Math.exp(-t*this.m_damping),i=0;i<this.m_count;++i)this.m_p0s[i].Copy(this.m_ps[i]),this.m_ims[i]>0&&this.m_vs[i].SelfMulAdd(t,this.m_gravity),this.m_vs[i].SelfMul(n),this.m_ps[i].SelfMulAdd(t,this.m_vs[i]);for(var r=0;r<e;++r)this.SolveC2(),this.SolveC3(),this.SolveC2();for(var a=1/t,o=0;o<this.m_count;++o)Ct.MulSV(a,Ct.SubVV(this.m_ps[o],this.m_p0s[o],Ct.s_t0),this.m_vs[o])}},e.SolveC2=function(){for(var e=this.m_count-1,n=0;n<e;++n){var i=this.m_ps[n],r=this.m_ps[n+1],a=Ct.SubVV(r,i,t.s_d),o=a.Normalize(),s=this.m_ims[n],c=this.m_ims[n+1];if(s+c!==0){var l=s/(s+c),h=c/(s+c);i.SelfMulSub(this.m_k2*l*(this.m_Ls[n]-o),a),r.SelfMulAdd(this.m_k2*h*(this.m_Ls[n]-o),a)}}},e.SetAngle=function(t){for(var e=this.m_count-2,n=0;n<e;++n)this.m_as[n]=t},e.SolveC3=function(){for(var e=this.m_count-2,n=0;n<e;++n){var i=this.m_ps[n],r=this.m_ps[n+1],a=this.m_ps[n+2],s=this.m_ims[n],c=this.m_ims[n+1],l=this.m_ims[n+2],h=Ct.SubVV(r,i,t.s_d1),u=Ct.SubVV(a,r,t.s_d2),_=h.LengthSquared(),f=u.LengthSquared();if(_*f!=0){var d=Ct.CrossVV(h,u),p=Ct.DotVV(h,u),m=yt(d,p),v=Ct.MulSV(-1/_,h.SelfSkew(),t.s_Jd1),g=Ct.MulSV(1/f,u.SelfSkew(),t.s_Jd2),y=Ct.NegV(v,t.s_J1),x=Ct.SubVV(v,g,t.s_J2),S=g,A=s*Ct.DotVV(y,y)+c*Ct.DotVV(x,x)+l*Ct.DotVV(S,S);if(0!==A){A=1/A;for(var b=m-this.m_as[n];b>o;)b=(m-=2*o)-this.m_as[n];for(;b<-o;)b=(m+=2*o)-this.m_as[n];var C=-this.m_k3*A*b;i.SelfMulAdd(s*C,y),r.SelfMulAdd(c*C,x),a.SelfMulAdd(l*C,S)}}}},e.Draw=function(t){for(var e=new Ot(.4,.5,.7),n=0;n<this.m_count-1;++n)t.DrawSegment(this.m_ps[n],this.m_ps[n+1],e)},t}();Ia.s_d=new Ct,Ia.s_d1=new Ct,Ia.s_d2=new Ct,Ia.s_Jd1=new Ct,Ia.s_Jd2=new Ct,Ia.s_J1=new Ct,Ia.s_J2=new Ct,t.b2AABB=Te,t.b2Abs=et,t.b2Acos=vt,t.b2Alloc=V,t.b2AreaJoint=Ii,t.b2AreaJointDef=wi,t.b2Asin=gt,t.b2Assert=e,t.b2Atan2=yt,t.b2BlockAllocator=Vt,t.b2Body=xi,t.b2BodyDef=yi,t.b2BroadPhase=ze,t.b2BuoyancyController=Aa,t.b2CalculateParticleIterations=Rr,t.b2ChainAndCircleContact=ar,t.b2ChainAndPolygonContact=or,t.b2ChainShape=ui,t.b2CircleContact=tr,t.b2CircleShape=ci,t.b2Clamp=at,t.b2ClipSegmentToLine=we,t.b2ClipVertex=Ae,t.b2CollideCircles=fn,t.b2CollideEdgeAndCircle=Qn,t.b2CollideEdgeAndPolygon=ri,t.b2CollidePolygonAndCircle=vn,t.b2CollidePolygons=Un,t.b2Color=Ot,t.b2ConstantAccelController=ba,t.b2ConstantForceController=Ca,t.b2Contact=$i,t.b2ContactEdge=Zi,t.b2ContactFactory=cr,t.b2ContactFeature=pe,t.b2ContactFilter=hr,t.b2ContactID=me,t.b2ContactImpulse=ur,t.b2ContactListener=_r,t.b2ContactManager=pr,t.b2ContactPositionConstraint=Cr,t.b2ContactRegister=sr,t.b2ContactSolver=wr,t.b2ContactSolverDef=Tr,t.b2ContactVelocityConstraint=br,t.b2Controller=Sa,t.b2ControllerEdge=xa,t.b2Cos=pt,t.b2Counter=Lt,t.b2DegToRad=ft,t.b2DestructionListener=lr,t.b2Distance=ie,t.b2DistanceInput=Gt,t.b2DistanceJoint=Ei,t.b2DistanceJointDef=Ti,t.b2DistanceOutput=Ht,t.b2DistanceProxy=kt,t.b2Draw=Nt,t.b2DynamicTree=Ne,t.b2EdgeAndCircleContact=ir,t.b2EdgeAndPolygonContact=rr,t.b2EdgeShape=hi,t.b2Filter=_i,t.b2Fixture=mi,t.b2FixtureDef=fi,t.b2FixtureParticleQueryCallback=Jr,t.b2FixtureProxy=di,t.b2Free=z,t.b2FrictionJoint=Di,t.b2FrictionJointDef=Pi,t.b2GearJoint=Mi,t.b2GearJointDef=Ri,t.b2GetPointStates=Se,t.b2GravityController=Ta,t.b2GrowableBuffer=Kr,t.b2GrowableStack=Ft,t.b2InvSqrt=ht,t.b2IsPowerOfTwo=St,t.b2IsValid=ct,t.b2Island=Pr,t.b2Jacobian=Si,t.b2Joint=Ci,t.b2JointDef=bi,t.b2JointEdge=Ai,t.b2Log=k,t.b2MakeArray=X,t.b2MakeNullArray=Y,t.b2MakeNumberArray=K,t.b2Manifold=ye,t.b2ManifoldPoint=ve,t.b2MassData=oi,t.b2Mat22=wt,t.b2Mat33=It,t.b2Max=rt,t.b2Maybe=n,t.b2Min=nt,t.b2MixFriction=Ji,t.b2MixRestitution=Qi,t.b2MotorJoint=Ni,t.b2MotorJointDef=Oi,t.b2MouseJoint=Li,t.b2MouseJointDef=Bi,t.b2NextPowerOfTwo=xt,t.b2Pair=Ve,t.b2PairLessThan=ke,t.b2ParseInt=W,t.b2ParseUInt=q,t.b2ParticleBodyContact=Zr,t.b2ParticleContact=Qr,t.b2ParticleDef=Dr,t.b2ParticleGroup=Br,t.b2ParticleGroupDef=Nr,t.b2ParticleHandle=Or,t.b2ParticlePair=$r,t.b2ParticlePairSet=ua,t.b2ParticleSystem=na,t.b2ParticleSystemDef=ea,t.b2ParticleSystem_CompositeShape=pa,t.b2ParticleSystem_ConnectionFilter=_a,t.b2ParticleSystem_DestroyParticlesInShapeCallback=fa,t.b2ParticleSystem_FixedSetAllocator=sa,t.b2ParticleSystem_FixtureParticle=ca,t.b2ParticleSystem_FixtureParticleSet=la,t.b2ParticleSystem_InsideBoundsEnumerator=aa,t.b2ParticleSystem_JoinParticleGroupsFilter=da,t.b2ParticleSystem_ParticleListNode=oa,t.b2ParticleSystem_ParticlePair=ha,t.b2ParticleSystem_Proxy=ra,t.b2ParticleSystem_ReactiveFilter=ma,t.b2ParticleSystem_SolveCollisionCallback=ga,t.b2ParticleSystem_UpdateBodyContactsCallback=va,t.b2ParticleSystem_UserOverridableBuffer=ia,t.b2ParticleTriad=ta,t.b2PolygonAndCircleContact=nr,t.b2PolygonContact=er,t.b2PolygonShape=li,t.b2Position=gr,t.b2PositionSolverManifold=Er,t.b2Pow=_t,t.b2PrismaticJoint=Vi,t.b2PrismaticJointDef=Fi,t.b2Profile=mr,t.b2PulleyJoint=Ui,t.b2PulleyJointDef=ki,t.b2QueryCallback=fr,t.b2RadToDeg=dt,t.b2Random=At,t.b2RandomRange=bt,t.b2RayCastCallback=dr,t.b2RayCastInput=be,t.b2RayCastOutput=Ce,t.b2RevoluteJoint=Hi,t.b2RevoluteJointDef=Gi,t.b2Rope=Ia,t.b2RopeDef=wa,t.b2RopeJoint=Wi,t.b2RopeJointDef=ji,t.b2Rot=Pt,t.b2SeparationFunction=$e,t.b2Shape=si,t.b2ShapeCast=fe,t.b2ShapeCastInput=jt,t.b2ShapeCastOutput=Wt,t.b2Simplex=Yt,t.b2SimplexCache=Ut,t.b2SimplexVertex=Xt,t.b2Sin=mt,t.b2SolverData=xr,t.b2Sq=lt,t.b2Sqrt=ut,t.b2StackAllocator=zt,t.b2Swap=ot,t.b2Sweep=Mt,t.b2TOIInput=Je,t.b2TOIOutput=Ze,t.b2TensorDampingController=Ea,t.b2TestOverlapAABB=Ee,t.b2TestOverlapShape=Re,t.b2TimeOfImpact=hn,t.b2TimeStep=vr,t.b2Timer=Bt,t.b2Transform=Dt,t.b2TreeNode=Oe,t.b2Vec2=Ct,t.b2Vec2_zero=Tt,t.b2Vec3=Et,t.b2Velocity=yr,t.b2VelocityConstraintPoint=Ar,t.b2Version=U,t.b2WeldJoint=Xi,t.b2WeldJointDef=qi,t.b2WheelJoint=Ki,t.b2WheelJointDef=Yi,t.b2World=ya,t.b2WorldManifold=xe,t.b2_180_over_pi=Z,t.b2_aabbExtension=l,t.b2_aabbMultiplier=h,t.b2_angularSleepTolerance=F,t.b2_angularSlop=_,t.b2_barrierCollisionTime=N,t.b2_baumgarte=b,t.b2_branch=H,t.b2_commit=j,t.b2_epsilon=r,t.b2_epsilon_sq=a,t.b2_gjk_reset=qt,t.b2_invalidParticleIndex=T,t.b2_linearSleepTolerance=L,t.b2_linearSlop=u,t.b2_maxAngularCorrection=g,t.b2_maxFloat=i,t.b2_maxLinearCorrection=v,t.b2_maxManifoldPoints=s,t.b2_maxParticleForce=D,t.b2_maxParticleIndex=E,t.b2_maxParticlePressure=P,t.b2_maxPolygonVertices=c,t.b2_maxRotation=S,t.b2_maxRotationSquared=A,t.b2_maxSubSteps=d,t.b2_maxTOIContacts=p,t.b2_maxTranslation=y,t.b2_maxTranslationSquared=x,t.b2_maxTriadDistance=R,t.b2_maxTriadDistanceSquared=M,t.b2_minParticleSystemBufferCapacity=O,t.b2_minParticleWeight=I,t.b2_minPulleyLength=zi,t.b2_particleStride=w,t.b2_pi=o,t.b2_pi_over_180=J,t.b2_polygonRadius=f,t.b2_timeToSleep=B,t.b2_toiBaumgarte=C,t.b2_toi_reset=Ue,t.b2_two_pi=tt,t.b2_velocityThreshold=m,t.b2_version=G,t.g_blockSolve=Sr,Object.defineProperty(t,"__esModule",{value:!0})}(e)}(e={exports:{}},e.exports),e.exports}();(xnt=Snt)&&xnt.__esModule&&Object.prototype.hasOwnProperty.call(xnt,"default")&&xnt.default;var Ant={};for(var bnt in Snt)-1===bnt.indexOf("b2_")&&(Ant[bnt.replace("b2","")]=Snt[bnt]);var Cnt,Tnt,Ent,wnt,Int,Pnt=Ant;!function(t){t[t.Static=0]="Static",t[t.Kinematic=1]="Kinematic",t[t.Dynamic=2]="Dynamic",t[t.Animated=3]="Animated"}(Cnt||(Cnt=t("ERigidBody2DType",{}))),se(Cnt),function(t){t[t.None=0]="None",t[t.BOX=1]="BOX",t[t.CIRCLE=2]="CIRCLE",t[t.POLYGON=3]="POLYGON"}(Tnt||(Tnt=t("ECollider2DType",{}))),se(Tnt),function(t){t[t.None=0]="None",t[t.DISTANCE=1]="DISTANCE",t[t.SPRING=2]="SPRING",t[t.WHEEL=3]="WHEEL",t[t.MOUSE=4]="MOUSE",t[t.FIXED=5]="FIXED",t[t.SLIDER=6]="SLIDER",t[t.RELATIVE=7]="RELATIVE",t[t.HINGE=8]="HINGE"}(Ent||(Ent=t("EJoint2DType",{}))),se(Ent),function(t){t[t.DEFAULT=1]="DEFAULT"}(wnt||(wnt=t("PhysicsGroup",{}))),se(wnt),function(t){t[t.Closest=0]="Closest",t[t.Any=1]="Any",t[t.AllClosest=2]="AllClosest",t[t.All=3]="All"}(Int||(Int=t("ERaycast2DType",{})));var Dnt,Rnt=t("Contact2DType",{None:"none-contact",BEGIN_CONTACT:"begin-contact",END_CONTACT:"end-contact",PRE_SOLVE:"pre-solve",POST_SOLVE:"post-solve"});!function(t){t[t.None=0]="None",t[t.Shape=1]="Shape",t[t.Joint=2]="Joint",t[t.Aabb=4]="Aabb",t[t.Pair=8]="Pair",t[t.CenterOfMass=16]="CenterOfMass",t[t.Particle=32]="Particle",t[t.Controller=64]="Controller",t[t.All=63]="All"}(Dnt||(Dnt=t("EPhysics2DDrawFlags",{})));var Mnt=t("PHYSICS_2D_PTM_RATIO",32),Ont=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._contactFixtures=[],e._BeginContact=null,e._EndContact=null,e._PreSolve=null,e._PostSolve=null,e}$(e,t);var n=e.prototype;return n.setBeginContact=function(t){this._BeginContact=t},n.setEndContact=function(t){this._EndContact=t},n.setPreSolve=function(t){this._PreSolve=t},n.setPostSolve=function(t){this._PostSolve=t},n.BeginContact=function(t){if(this._BeginContact){var e=t.GetFixtureA(),n=t.GetFixtureB(),i=this._contactFixtures;t._shouldReport=!1,-1===i.indexOf(e)&&-1===i.indexOf(n)||(t._shouldReport=!0,this._BeginContact(t))}},n.EndContact=function(t){this._EndContact&&t._shouldReport&&(t._shouldReport=!1,this._EndContact(t))},n.PreSolve=function(t,e){this._PreSolve&&t._shouldReport&&this._PreSolve(t,e)},n.PostSolve=function(t,e){this._PostSolve&&t._shouldReport&&this._PostSolve(t,e)},n.registerContactFixture=function(t){this._contactFixtures.push(t)},n.unregisterContactFixture=function(t){ft(this._contactFixtures,t)},e}(Pnt.ContactListener),Nnt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._point=new Pnt.Vec2,e._isPoint=!1,e._fixtures=[],e}$(e,t);var n=e.prototype;return n.init=function(t){t?(this._isPoint=!0,this._point.x=t.x,this._point.y=t.y):this._isPoint=!1,this._fixtures.length=0},n.ReportFixture=function(t){return this._isPoint?t.TestPoint(this._point)&&this._fixtures.push(t):this._fixtures.push(t),!0},n.getFixture=function(){return this._fixtures[0]},n.getFixtures=function(){return this._fixtures},e}(Pnt.QueryCallback);function Bnt(t,e){var n=e.length;return e[t<0?n- -t%n:t%n]}function Lnt(t,e,n){for(var i=[];e<t;)e+=n.length;for(;t<=e;++t)i.push(Bnt(t,n));return i}function Fnt(t){Wnt(t);for(var e,n,i,r,a,o,s=[],c=new Qn,l=new Qn,h=0,u=0,_=0;_<t.length;++_)if(znt(_,t)){n=i=1e8;for(var f=0;f<t.length;++f)Unt(Bnt(_-1,t),Bnt(_,t),Bnt(f,t))&&Hnt(Bnt(_-1,t),Bnt(_,t),Bnt(f-1,t))&&(r=Xnt(Bnt(_-1,t),Bnt(_,t),Bnt(f,t),Bnt(f-1,t)),knt(Bnt(_+1,t),Bnt(_,t),r)&&(e=jnt(Bnt(_,t),r))<n&&(n=e,c=r,h=f)),Unt(Bnt(_+1,t),Bnt(_,t),Bnt(f+1,t))&&Hnt(Bnt(_+1,t),Bnt(_,t),Bnt(f,t))&&(r=Xnt(Bnt(_+1,t),Bnt(_,t),Bnt(f,t),Bnt(f+1,t)),Unt(Bnt(_-1,t),Bnt(_,t),r)&&(e=jnt(Bnt(_,t),r))<i&&(i=e,u=f,l=r));if(h==(u+1)%t.length){var d=c.add(l).multiplyScalar(.5);(a=Lnt(_,u,t)).push(d),(o=Lnt(h,_,t)).push(d)}else{for(var p=0,m=h;u<h;)u+=t.length;for(var v=h;v<=u;++v)if(Vnt(_,v,t)){var g=1/(jnt(Bnt(_,t),Bnt(v,t))+1);znt(v,t)?Hnt(Bnt(v-1,t),Bnt(v,t),Bnt(_,t))&&Gnt(Bnt(v+1,t),Bnt(v,t),Bnt(_,t))?g+=3:g+=2:g+=1,g>p&&(m=v,p=g)}a=Lnt(_,m,t),o=Lnt(m,_,t)}return(s=s.concat(Fnt(a))).concat(Fnt(o))}s.push(t);for(var y=s.length-1;y>=0;y--)0==s[y].length&&s.splice(y,0);return s}function Vnt(t,e,n){if(znt(t,n)){if(Gnt(Bnt(t,n),Bnt(t-1,n),Bnt(e,n))&&Hnt(Bnt(t,n),Bnt(t+1,n),Bnt(e,n)))return!1}else if(Hnt(Bnt(t,n),Bnt(t+1,n),Bnt(e,n))||Gnt(Bnt(t,n),Bnt(t-1,n),Bnt(e,n)))return!1;if(znt(e,n)){if(Gnt(Bnt(e,n),Bnt(e-1,n),Bnt(t,n))&&Hnt(Bnt(e,n),Bnt(e+1,n),Bnt(t,n)))return!1}else if(Hnt(Bnt(e,n),Bnt(e+1,n),Bnt(t,n))||Gnt(Bnt(e,n),Bnt(e-1,n),Bnt(t,n)))return!1;for(var i=0;i<n.length;++i)if((i+1)%n.length!=t&&i!=t&&(i+1)%n.length!=e&&i!=e){var r=new Qn;if(Ynt(Bnt(t,n),Bnt(e,n),Bnt(i,n),Bnt(i+1,n),r))return!1}return!0}function znt(t,e){return knt(t,e)}function knt(t,e,n){if(void 0===n){var i=t,r=e;t=Bnt(i-1,r),e=Bnt(i,r),n=Bnt(i+1,r)}return Knt(t,e,n)<0}function Unt(t,e,n){return Knt(t,e,n)>0}function Gnt(t,e,n){return Knt(t,e,n)>=0}function Hnt(t,e,n){return Knt(t,e,n)<=0}function jnt(t,e){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function Wnt(t){qnt(t)||t.reverse()}function qnt(t){return t.length<3||function(t){var e,n=0;for(e=0;e<t.length;e++){var i=(e+1)%t.length;n+=t[e].x*t[i].y,n-=t[e].y*t[i].x}return n/2}(t)>0}function Xnt(t,e,n,i){var r,a=new Qn,o=e.y-t.y,s=t.x-e.x,c=o*t.x+s*t.y,l=i.y-n.y,h=n.x-i.x,u=l*n.x+h*n.y,_=o*h-l*s;return r=_,0,Math.abs(r-0)<=1e-6||(a.x=(h*c-s*u)/_,a.y=(o*u-l*c)/_),a}function Ynt(t,e,n,i,r){if(t==n||t==i||e==n||e==i)return!1;var a=t.x,o=t.y,s=e.x,c=e.y,l=n.x,h=n.y,u=i.x,_=i.y;if(Math.max(a,s)<Math.min(l,u)||Math.max(l,u)<Math.min(a,s))return!1;if(Math.max(o,c)<Math.min(h,_)||Math.max(h,_)<Math.min(o,c))return!1;var f=(u-l)*(o-h)-(_-h)*(a-l),d=(s-a)*(o-h)-(c-o)*(a-l),p=(_-h)*(s-a)-(u-l)*(c-o);return!(Math.abs(p)<1e-6)&&(d/=p,(f/=p)>0&&f<1&&d>0&&d<1&&(r.x=a+f*(s-a),r.y=o+f*(c-o),!0))}function Knt(t,e,n){return t.x*(e.y-n.y)+e.x*(n.y-t.y)+n.x*(t.y-e.y)}var Jnt=Object.freeze({__proto__:null,ConvexPartition:Fnt,ForceCounterClockWise:Wnt,IsCounterClockWise:qnt}),Qnt=function(){return 0},Znt={impl:null,rigidBody:null,isAwake:!1,isSleeping:!1,initialize:Qnt,setType:Qnt,setLinearDamping:Qnt,setAngularDamping:Qnt,setGravityScale:Qnt,setFixedRotation:Qnt,setAllowSleep:Qnt,isActive:Qnt,setActive:Qnt,wakeUp:Qnt,sleep:Qnt,getMass:Qnt,getInertia:Qnt,getLinearVelocity:Qnt,setLinearVelocity:Qnt,getLinearVelocityFromWorldPoint:Qnt,getAngularVelocity:Qnt,setAngularVelocity:Qnt,getLocalVector:Qnt,getWorldVector:Qnt,getLocalPoint:Qnt,getWorldPoint:Qnt,getLocalCenter:Qnt,getWorldCenter:Qnt,applyForce:Qnt,applyForceToCenter:Qnt,applyTorque:Qnt,applyLinearImpulse:Qnt,applyLinearImpulseToCenter:Qnt,applyAngularImpulse:Qnt,onEnable:Qnt,onDisable:Qnt,onDestroy:Qnt},$nt={INITED:!1};var tit,eit,nit,iit,rit,ait,oit={INITED:!1},sit={impl:null,initialize:Qnt,setDampingRatio:Qnt,setFrequency:Qnt,setMaxForce:Qnt,setTarget:Qnt,setDistance:Qnt,setAngularOffset:Qnt,setCorrectionFactor:Qnt,setLinearOffset:Qnt,setMaxLength:Qnt,setMaxTorque:Qnt,setLowerLimit:Qnt,setUpperLimit:Qnt,setMaxMotorForce:Qnt,setMaxMotorTorque:Qnt,setMotorSpeed:Qnt,enableLimit:Qnt,enableMotor:Qnt,setLowerAngle:Qnt,setUpperAngle:Qnt};!function(t){t[t.DYNAMIC=1]="DYNAMIC",t[t.STATIC=2]="STATIC",t[t.KINEMATIC=4]="KINEMATIC"}(tit||(tit={})),se(tit),function(t){t[t.X_AXIS=0]="X_AXIS",t[t.Y_AXIS=1]="Y_AXIS",t[t.Z_AXIS=2]="Z_AXIS"}(eit||(eit={})),se(eit),function(t){t[t.VERTEX=1]="VERTEX",t[t.LINE=2]="LINE",t[t.TRIANGLE=3]="TRIANGLE",t[t.TETRAHEDRON=4]="TETRAHEDRON"}(nit||(nit={})),se(nit),function(t){t[t.BOX=0]="BOX",t[t.SPHERE=1]="SPHERE",t[t.CAPSULE=2]="CAPSULE",t[t.CYLINDER=3]="CYLINDER",t[t.CONE=4]="CONE",t[t.MESH=5]="MESH",t[t.PLANE=6]="PLANE",t[t.SIMPLEX=7]="SIMPLEX",t[t.TERRAIN=8]="TERRAIN"}(iit||(iit={})),se(iit),function(t){t[t.POINT_TO_POINT=0]="POINT_TO_POINT",t[t.HINGE=1]="HINGE",t[t.CONE_TWIST=2]="CONE_TWIST"}(rit||(rit={})),se(rit),function(t){t[t.DEFAULT=1]="DEFAULT"}(ait||(ait={})),se(ait);var cit=function(t){if(1===t){for(var e=this,n=function(t){var n="_"+(1<<t);e[n]=0,e.updateArray=[],Object.defineProperty(e,1<<t,{get:function(){return this[n]},set:function(e){this[n]!==e&&(this[n]=e,this.updateArray.indexOf(t)<0&&this.updateArray.push(t))}})},i=0;i<32;i++)n(i);this._1=ait.DEFAULT}else{for(var r=0;r<32;r++)this[""+(1<<r)]=0;this[1]=ait.DEFAULT}},lit=null;h.internal.PhysicsGroup2D=wnt;var hit,uit,_it,fit,dit,pit,mit,vit,git,yit,xit,Sit,Ait,bit,Cit,Tit,Eit,wit,Iit,Pit=t("PhysicsSystem2D",function(t){function e(){var e;(e=t.call(this)||this).velocityIterations=10,e.positionIterations=10,e.physicsWorld=void 0,e.collisionMatrix=new cit,e._enable=!0,e._allowSleep=!0,e._maxSubSteps=1,e._fixedTimeStep=1/60,e._autoSimulation=!0,e._accumulator=0,e._steping=!1,e._gravity=new Qn(0,-10*Mnt),e._delayEvents=[];var n=bO.config?bO.config.physics:null;if(n){if(Qn.copy(e._gravity,n.gravity),e._gravity.multiplyScalar(Mnt),e._allowSleep=n.allowSleep,e._fixedTimeStep=n.fixedTimeStep,e._maxSubSteps=n.maxSubSteps,e._autoSimulation=n.autoSimulation,n.collisionMatrix)for(var i in n.collisionMatrix){var r=parseInt(i),a=1<<parseInt(i);e.collisionMatrix[""+a]=n.collisionMatrix[r]}if(n.collisionGroups){var o=n.collisionGroups;o instanceof Array&&(o.forEach((function(t){wnt[t.name]=1<<t.index})),se.update(wnt))}}return e.physicsWorld=new mnt.PhysicsWorld,e.gravity=e._gravity,e.allowSleep=e._allowSleep,e}$(e,t);var n=e.prototype;return n.postUpdate=function(t){if(this._enable&&this._autoSimulation){TO.emit(CO.EVENT_BEFORE_PHYSICS),this._steping=!0;var e=this._fixedTimeStep,n=this.velocityIterations,i=this.positionIterations;this._accumulator+=t;for(var r=0;r++<this._maxSubSteps&&this._accumulator>e;)this.physicsWorld.step(e,n,i),this._accumulator-=e;for(var a=this._delayEvents,o=0,s=a.length;o<s;o++){var c=a[o];c.func.call(c.target)}a.length=0,this.physicsWorld.syncPhysicsToScene(),this.debugDrawFlags&&this.physicsWorld.drawDebug(),this._steping=!1,TO.emit(CO.EVENT_AFTER_PHYSICS)}},n._callAfterStep=function(t,e){this._steping?this._delayEvents.push({target:t,func:e}):e.call(t)},n.resetAccumulator=function(t){void 0===t&&(t=0),this._accumulator=t},n.step=function(t){this.physicsWorld.step(t,this.velocityIterations,this.positionIterations)},n.raycast=function(t,e,n,i){return void 0===n&&(n=Int.Closest),void 0===i&&(i=4294967295),this.physicsWorld.raycast(t,e,n,i)},n.testPoint=function(t){return this.physicsWorld.testPoint(t)},n.testAABB=function(t){return this.physicsWorld.testAABB(t)},Q(e,[{key:"enable",get:function(){return this._enable},set:function(t){this._enable=t}},{key:"allowSleep",get:function(){return this._allowSleep},set:function(t){this._allowSleep=t,this.physicsWorld.setAllowSleep(t)}},{key:"gravity",get:function(){return this._gravity},set:function(t){this._gravity.set(t),this.physicsWorld.setGravity(new Qn(t.x/Mnt,t.y/Mnt))}},{key:"maxSubSteps",get:function(){return this._maxSubSteps},set:function(t){this._maxSubSteps=t}},{key:"fixedTimeStep",get:function(){return this._fixedTimeStep},set:function(t){this._fixedTimeStep=t}},{key:"autoSimulation",get:function(){return this._autoSimulation},set:function(t){this._autoSimulation=t}},{key:"debugDrawFlags",get:function(){return this.physicsWorld.debugDrawFlags},set:function(t){this.physicsWorld.debugDrawFlags=t}},{key:"stepping",get:function(){return this._steping}}],[{key:"PHYSICS_NONE",get:function(){return!vnt}},{key:"PHYSICS_BUILTIN",get:function(){return"builtin"===vnt}},{key:"PHYSICS_BOX2D",get:function(){return"box2d"===vnt}},{key:"PhysicsGroup",get:function(){return wnt}},{key:"instance",get:function(){return lit||(lit=new e),lit}}]),e}(nh(uO)));Pit.ID="PHYSICS_2D",TO.once(CO.EVENT_INIT,(function(){Pit.PHYSICS_NONE||TO.registerSystem(Pit.ID,Pit.instance,uO.Priority.LOW)})),function(t){t[t.Circles=0]="Circles",t[t.FaceA=1]="FaceA",t[t.FaceB=2]="FaceB"}(hit||(hit=t("Physics2DManifoldType",{})));var Dit,Rit,Mit,Oit,Nit,Bit,Lit,Fit,Vit,zit,kit,Uit,Git,Hit,jit,Wit,qit,Xit,Yit,Kit,Jit,Qit,Zit,$it,trt,ert,nrt,irt,rrt,art,ort,srt,crt,lrt,hrt,urt,_rt,frt,drt,prt,mrt,vrt,grt,yrt,xrt,Srt,Art,brt,Crt,Trt,Ert,wrt,Irt,Prt,Drt,Rrt,Mrt,Ort,Nrt,Brt,Lrt,Frt,Vrt,zrt,krt,Urt,Grt,Hrt,jrt,Wrt,qrt,Xrt,Yrt,Krt,Jrt,Qrt,Zrt,$rt,tat,eat,nat,iat,rat,aat,oat,sat,cat,lat,hat,uat,_at,fat,dat=Dc,pat=cl,mat=kc,vat=t("RigidBody2D",(uit=Ec("cc.RigidBody2D"),_it=mat(),fit=pat(ait),dit=pat(Cnt),uit(pit=_it((lt((mit=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"enabledContactListener",vit,at(e)),ct(e,"bullet",git,at(e)),ct(e,"awakeOnLoad",yit,at(e)),e._body=null,ct(e,"_group",xit,at(e)),ct(e,"_type",Sit,at(e)),ct(e,"_allowSleep",Ait,at(e)),ct(e,"_gravityScale",bit,at(e)),ct(e,"_linearDamping",Cit,at(e)),ct(e,"_angularDamping",Tit,at(e)),ct(e,"_linearVelocity",Eit,at(e)),ct(e,"_angularVelocity",wit,at(e)),ct(e,"_fixedRotation",Iit,at(e)),e}$(e,t);var n=e.prototype;return n.isAwake=function(){return!!this._body&&this._body.isAwake},n.wakeUp=function(){this._body&&this._body.wakeUp()},n.sleep=function(){this._body&&this._body.sleep()},n.getMass=function(){return this._body?this._body.getMass():0},n.applyForce=function(t,e,n){this._body&&this._body.applyForce(t,e,n)},n.applyForceToCenter=function(t,e){this._body&&this._body.applyForceToCenter(t,e)},n.applyTorque=function(t,e){this._body&&this._body.applyTorque(t,e)},n.applyLinearImpulse=function(t,e,n){this._body&&this._body.applyLinearImpulse(t,e,n)},n.applyLinearImpulseToCenter=function(t,e){this._body&&this._body.applyLinearImpulseToCenter(t,e)},n.applyAngularImpulse=function(t,e){this._body&&this._body.applyAngularImpulse(t,e)},n.getLinearVelocityFromWorldPoint=function(t,e){return this._body?this._body.getLinearVelocityFromWorldPoint(t,e):e},n.getLocalVector=function(t,e){return this._body?this._body.getLocalVector(t,e):e},n.getWorldVector=function(t,e){return this._body?this._body.getWorldVector(t,e):e},n.getLocalPoint=function(t,e){return this._body?this._body.getLocalPoint(t,e):e},n.getWorldPoint=function(t,e){return this._body?this._body.getWorldPoint(t,e):e},n.getLocalCenter=function(t){return this._body?this._body.getLocalCenter(t):t},n.getWorldCenter=function(t){return this._body?this._body.getWorldCenter(t):t},n.getInertia=function(){return this._body&&this._body.getInertia(),0},n.onLoad=function(){this._body=h._global.CC_PHYSICS_2D_BUILTIN?Znt:new mnt.RigidBody,this._body.initialize(this)},n.onEnable=function(){this._body&&this._body.onEnable()},n.onDisable=function(){this._body&&this._body.onDisable()},n.onDestroy=function(){this._body&&this._body.onDestroy()},Q(e,[{key:"group",get:function(){return this._group},set:function(t){this._group=t}},{key:"type",get:function(){return this._type},set:function(t){this._type=t,this._body&&(t===Cnt.Animated?this._body.setType(Cnt.Kinematic):this._body.setType(t))}},{key:"allowSleep",get:function(){return this._allowSleep},set:function(t){this._allowSleep=t,this._body&&this._body.setAllowSleep(t)}},{key:"gravityScale",get:function(){return this._gravityScale},set:function(t){this._gravityScale=t,this._body&&this._body.setGravityScale(t)}},{key:"linearDamping",get:function(){return this._linearDamping},set:function(t){this._linearDamping=t,this._body&&this._body.setLinearDamping(t)}},{key:"angularDamping",get:function(){return this._angularDamping},set:function(t){this._angularDamping=t,this._body&&this._body.setAngularDamping(t)}},{key:"linearVelocity",get:function(){return this._body&&this._body.getLinearVelocity(this._linearVelocity),this._linearVelocity},set:function(t){this._linearVelocity=t,this._body&&this._body.setLinearVelocity(t)}},{key:"angularVelocity",get:function(){return this._body&&(this._angularVelocity=this._body.getAngularVelocity()),this._angularVelocity},set:function(t){this._angularVelocity=t,this._body&&this._body.setAngularVelocity(t)}},{key:"fixedRotation",get:function(){return this._fixedRotation},set:function(t){this._fixedRotation=t,this._body&&this._body.setFixedRotation(t)}},{key:"impl",get:function(){return this._body}}]),e}(xu)).prototype,"group",[fit],Object.getOwnPropertyDescriptor(mit.prototype,"group"),mit.prototype),vit=lt(mit.prototype,"enabledContactListener",[dat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),git=lt(mit.prototype,"bullet",[dat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),lt(mit.prototype,"type",[dit],Object.getOwnPropertyDescriptor(mit.prototype,"type"),mit.prototype),lt(mit.prototype,"allowSleep",[dat],Object.getOwnPropertyDescriptor(mit.prototype,"allowSleep"),mit.prototype),lt(mit.prototype,"gravityScale",[dat],Object.getOwnPropertyDescriptor(mit.prototype,"gravityScale"),mit.prototype),lt(mit.prototype,"linearDamping",[dat],Object.getOwnPropertyDescriptor(mit.prototype,"linearDamping"),mit.prototype),lt(mit.prototype,"angularDamping",[dat],Object.getOwnPropertyDescriptor(mit.prototype,"angularDamping"),mit.prototype),lt(mit.prototype,"linearVelocity",[dat],Object.getOwnPropertyDescriptor(mit.prototype,"linearVelocity"),mit.prototype),lt(mit.prototype,"angularVelocity",[dat],Object.getOwnPropertyDescriptor(mit.prototype,"angularVelocity"),mit.prototype),lt(mit.prototype,"fixedRotation",[dat],Object.getOwnPropertyDescriptor(mit.prototype,"fixedRotation"),mit.prototype),yit=lt(mit.prototype,"awakeOnLoad",[dat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),xit=lt(mit.prototype,"_group",[dat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ait.DEFAULT}}),Sit=lt(mit.prototype,"_type",[dat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Cnt.Dynamic}}),Ait=lt(mit.prototype,"_allowSleep",[dat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),bit=lt(mit.prototype,"_gravityScale",[dat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Cit=lt(mit.prototype,"_linearDamping",[dat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Tit=lt(mit.prototype,"_angularDamping",[dat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Eit=lt(mit.prototype,"_linearVelocity",[dat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn}}),wit=lt(mit.prototype,"_angularVelocity",[dat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Iit=lt(mit.prototype,"_fixedRotation",[dat],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),pit=mit))||pit)||pit)),gat=t("Collider2D",(Dit=Ec("cc.Collider2D"),Rit=cl(ait),Dit((Git=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"editing",Nit,at(e)),ct(e,"tag",Bit,at(e)),e.TYPE=Tnt.None,e._shape=null,e._body=null,ct(e,"_group",Lit,at(e)),ct(e,"_density",Fit,at(e)),ct(e,"_sensor",Vit,at(e)),ct(e,"_friction",zit,at(e)),ct(e,"_restitution",kit,at(e)),ct(e,"_offset",Uit,at(e)),e}$(e,t);var n=e.prototype;return n.onLoad=function(){this._shape=function(t){return $nt.INITED||($nt.INITED=!0,$nt[Tnt.BOX]=function(){return new mnt.BoxShape},$nt[Tnt.CIRCLE]=function(){return new mnt.CircleShape},$nt[Tnt.POLYGON]=function(){return new mnt.PolygonShape}),$nt[t]()}(this.TYPE),this._shape.initialize(this),this._shape.onLoad&&this._shape.onLoad(),this._body=this.getComponent(vat)},n.onEnable=function(){this._shape&&this._shape.onEnable()},n.onDisable=function(){this._shape&&this._shape.onDisable&&this._shape.onDisable()},n.onDestroy=function(){this._shape&&this._shape.onDestroy&&this._shape.onDestroy()},n.apply=function(){this._shape&&this._shape.apply&&this._shape.apply()},Q(e,[{key:"group",get:function(){return this._group},set:function(t){this._group=t,this._shape&&this._shape.onGroupChanged&&this._shape.onGroupChanged()}},{key:"density",get:function(){return this._density},set:function(t){this._density=t}},{key:"sensor",get:function(){return this._sensor},set:function(t){this._sensor=t}},{key:"friction",get:function(){return this._friction},set:function(t){this._friction=t}},{key:"restitution",get:function(){return this._restitution},set:function(t){this._restitution=t}},{key:"offset",get:function(){return this._offset},set:function(t){this._offset=t}},{key:"body",get:function(){return this._body}},{key:"impl",get:function(){return this._shape}},{key:"worldAABB",get:function(){return this._shape?this._shape.worldAABB:new oi}}]),e}(nh(xu)),Nit=lt((Oit=Git).prototype,"editing",[Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Bit=lt(Oit.prototype,"tag",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),lt(Oit.prototype,"group",[Rit],Object.getOwnPropertyDescriptor(Oit.prototype,"group"),Oit.prototype),lt(Oit.prototype,"density",[Dc],Object.getOwnPropertyDescriptor(Oit.prototype,"density"),Oit.prototype),lt(Oit.prototype,"sensor",[Dc],Object.getOwnPropertyDescriptor(Oit.prototype,"sensor"),Oit.prototype),lt(Oit.prototype,"friction",[Dc],Object.getOwnPropertyDescriptor(Oit.prototype,"friction"),Oit.prototype),lt(Oit.prototype,"restitution",[Dc],Object.getOwnPropertyDescriptor(Oit.prototype,"restitution"),Oit.prototype),lt(Oit.prototype,"offset",[Dc],Object.getOwnPropertyDescriptor(Oit.prototype,"offset"),Oit.prototype),Lit=lt(Oit.prototype,"_group",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ait.DEFAULT}}),Fit=lt(Oit.prototype,"_density",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Vit=lt(Oit.prototype,"_sensor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),zit=lt(Oit.prototype,"_friction",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),kit=lt(Oit.prototype,"_restitution",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Uit=lt(Oit.prototype,"_offset",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn}}),Mit=Oit))||Mit)),yat=(t("BoxCollider2D",Ec("cc.BoxCollider2D")(Hit=kc()((qit=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_size",Wit,at(e)),e.TYPE=Tnt.BOX,e}return $(e,t),Q(e,[{key:"size",get:function(){return this._size},set:function(t){this._size=t}},{key:"worldPoints",get:function(){return this._shape?this._shape.worldPoints:[]}}]),e}(gat),Wit=lt((jit=qit).prototype,"_size",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ri(1,1)}}),lt(jit.prototype,"size",[Dc],Object.getOwnPropertyDescriptor(jit.prototype,"size"),jit.prototype),Hit=jit))||Hit)||Hit),t("CircleCollider2D",Ec("cc.CircleCollider2D")(Xit=kc()((Jit=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_radius",Kit,at(e)),e.TYPE=Tnt.CIRCLE,e}return $(e,t),Q(e,[{key:"radius",get:function(){return this._radius},set:function(t){this._radius=t<0?0:t}},{key:"worldPosition",get:function(){return this._shape?this._shape.worldPosition:new Qn}},{key:"worldRadius",get:function(){return this._shape?this._shape.worldRadius:0}}]),e}(gat),Kit=lt((Yit=Jit).prototype,"_radius",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),lt(Yit.prototype,"radius",[Dc],Object.getOwnPropertyDescriptor(Yit.prototype,"radius"),Yit.prototype),Xit=Yit))||Xit)||Xit),t("PolygonCollider2D",(Qit=Ec("cc.PolygonCollider2D"),Zit=kc(),$it=Dc({serializable:!1,displayOrder:0}),trt=Dc({type:Qn}),Qit(ert=Zit((art=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"threshold",irt,at(e)),ct(e,"_points",rrt,at(e)),e.TYPE=Tnt.POLYGON,e}return $(e,t),Q(e,[{key:"points",get:function(){return this._points},set:function(t){this._points=t}},{key:"worldPoints",get:function(){return this._shape?this._shape.worldPoints:[]}}]),e}(gat),irt=lt((nrt=art).prototype,"threshold",[$it],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),rrt=lt(nrt.prototype,"_points",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[new Qn(-1,-1),new Qn(1,-1),new Qn(1,1),new Qn(-1,1)]}}),lt(nrt.prototype,"points",[trt],Object.getOwnPropertyDescriptor(nrt.prototype,"points"),nrt.prototype),ert=nrt))||ert)||ert)),t("Joint2D",(ort=Ec("cc.Joint2D"),srt=cl(vat),ort((drt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"anchor",hrt,at(e)),ct(e,"connectedAnchor",urt,at(e)),ct(e,"collideConnected",_rt,at(e)),ct(e,"connectedBody",frt,at(e)),e._body=null,e._joint=null,e.TYPE=Ent.None,e}$(e,t);var n=e.prototype;return n.onLoad=function(){this._joint=function(t){return function(){if(!oit.INITED){oit.INITED=!0;var t=h._global.CC_PHYSICS_2D_BUILTIN;oit[Ent.SPRING]=function(){return t?sit:new mnt.SpringJoint},oit[Ent.DISTANCE]=function(){return t?sit:new mnt.DistanceJoint},oit[Ent.FIXED]=function(){return t?sit:new mnt.FixedJoint},oit[Ent.MOUSE]=function(){return t?sit:new mnt.MouseJoint},oit[Ent.RELATIVE]=function(){return t?sit:new mnt.RelativeJoint},oit[Ent.SLIDER]=function(){return t?sit:new mnt.SliderJoint},oit[Ent.WHEEL]=function(){return t?sit:new mnt.WheelJoint},oit[Ent.HINGE]=function(){return t?sit:new mnt.HingeJoint}}}(),oit[t]()}(this.TYPE),this._joint.initialize(this),this._body=this.getComponent(vat)},n.onEnable=function(){this._joint&&this._joint.onEnable&&this._joint.onEnable()},n.onDisable=function(){this._joint&&this._joint.onDisable&&this._joint.onDisable()},n.start=function(){this._joint&&this._joint.start&&this._joint.start()},n.onDestroy=function(){this._joint&&this._joint.onDestroy&&this._joint.onDestroy()},Q(e,[{key:"body",get:function(){return this._body}},{key:"impl",get:function(){return this._joint}}]),e}(xu),hrt=lt((lrt=drt).prototype,"anchor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn}}),urt=lt(lrt.prototype,"connectedAnchor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn}}),_rt=lt(lrt.prototype,"collideConnected",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),frt=lt(lrt.prototype,"connectedBody",[srt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),crt=lrt))||crt))),xat=(t("DistanceJoint2D",Ec("cc.DistanceJoint2D")(prt=kc()((lt((mrt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).TYPE=Ent.DISTANCE,ct(e,"_maxLength",vrt,at(e)),ct(e,"_autoCalcDistance",grt,at(e)),e}return $(e,t),Q(e,[{key:"maxLength",get:function(){return this._autoCalcDistance&&this.connectedBody?Mn.distance(this.node.worldPosition,this.connectedBody.node.worldPosition):this._maxLength},set:function(t){this._maxLength=t,this._joint&&this._joint.setMaxLength(t)}},{key:"autoCalcDistance",get:function(){return this._autoCalcDistance},set:function(t){this._autoCalcDistance=t}}]),e}(yat)).prototype,"maxLength",[Dc],Object.getOwnPropertyDescriptor(mrt.prototype,"maxLength"),mrt.prototype),lt(mrt.prototype,"autoCalcDistance",[Dc],Object.getOwnPropertyDescriptor(mrt.prototype,"autoCalcDistance"),mrt.prototype),vrt=lt(mrt.prototype,"_maxLength",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),grt=lt(mrt.prototype,"_autoCalcDistance",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),prt=mrt))||prt)||prt),t("SpringJoint2D",Ec("cc.SpringJoint2D")(yrt=kc()((lt((xrt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).TYPE=Ent.SPRING,ct(e,"_frequency",Srt,at(e)),ct(e,"_dampingRatio",Art,at(e)),ct(e,"_distance",brt,at(e)),ct(e,"_autoCalcDistance",Crt,at(e)),e}return $(e,t),Q(e,[{key:"frequency",get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)}},{key:"dampingRatio",get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}},{key:"distance",get:function(){return this._autoCalcDistance&&this.connectedBody?Mn.distance(this.node.worldPosition,this.connectedBody.node.worldPosition):this._distance},set:function(t){this._distance=t,this._joint&&this._joint.setDistance(t)}},{key:"autoCalcDistance",get:function(){return this._autoCalcDistance},set:function(t){this._autoCalcDistance=t}}]),e}(yat)).prototype,"frequency",[Dc],Object.getOwnPropertyDescriptor(xrt.prototype,"frequency"),xrt.prototype),lt(xrt.prototype,"dampingRatio",[Dc],Object.getOwnPropertyDescriptor(xrt.prototype,"dampingRatio"),xrt.prototype),lt(xrt.prototype,"distance",[Dc],Object.getOwnPropertyDescriptor(xrt.prototype,"distance"),xrt.prototype),lt(xrt.prototype,"autoCalcDistance",[Dc],Object.getOwnPropertyDescriptor(xrt.prototype,"autoCalcDistance"),xrt.prototype),Srt=lt(xrt.prototype,"_frequency",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Art=lt(xrt.prototype,"_dampingRatio",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),brt=lt(xrt.prototype,"_distance",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),Crt=lt(xrt.prototype,"_autoCalcDistance",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),yrt=xrt))||yrt)||yrt),t("MouseJoint2D",Ec("cc.MouseJoint2D")(Trt=kc()((lt((Ert=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).TYPE=Ent.MOUSE,ct(e,"_maxForce",wrt,at(e)),ct(e,"_dampingRatio",Irt,at(e)),ct(e,"_frequency",Prt,at(e)),e._target=new Qn,e}return $(e,t),e.prototype.update=function(t){this._joint.update(t)},Q(e,[{key:"target",get:function(){return this._target},set:function(t){this._target=t,this._joint&&this._joint.setTarget(t)}},{key:"frequency",get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)}},{key:"dampingRatio",get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}},{key:"maxForce",get:function(){return this._maxForce},set:function(t){this._maxForce=t,this._joint&&this._joint.setMaxForce(t)}}]),e}(yat)).prototype,"frequency",[Dc],Object.getOwnPropertyDescriptor(Ert.prototype,"frequency"),Ert.prototype),lt(Ert.prototype,"dampingRatio",[Dc],Object.getOwnPropertyDescriptor(Ert.prototype,"dampingRatio"),Ert.prototype),lt(Ert.prototype,"maxForce",[Dc],Object.getOwnPropertyDescriptor(Ert.prototype,"maxForce"),Ert.prototype),wrt=lt(Ert.prototype,"_maxForce",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),Irt=lt(Ert.prototype,"_dampingRatio",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),Prt=lt(Ert.prototype,"_frequency",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Trt=Ert))||Trt)||Trt),new Mn),Sat=new Mn,Aat=(t("RelativeJoint2D",Ec("cc.RelativeJoint2D")(Drt=kc()((lt((Rrt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).TYPE=Ent.RELATIVE,ct(e,"_maxForce",Mrt,at(e)),ct(e,"_maxTorque",Ort,at(e)),ct(e,"_correctionFactor",Nrt,at(e)),ct(e,"_angularOffset",Brt,at(e)),ct(e,"_linearOffset",Lrt,at(e)),ct(e,"_autoCalcOffset",Frt,at(e)),e}return $(e,t),Q(e,[{key:"maxForce",get:function(){return this._maxForce},set:function(t){this._maxForce=t,this._joint&&this._joint.setMaxForce(t)}},{key:"maxTorque",get:function(){return this._maxTorque},set:function(t){this._maxTorque=t,this._joint&&this._joint.setMaxTorque(t)}},{key:"correctionFactor",get:function(){return this._correctionFactor},set:function(t){this._correctionFactor=t,this._joint&&this._joint.setCorrectionFactor(t)}},{key:"linearOffset",get:function(){return this._autoCalcOffset&&this.connectedBody?Qn.subtract(this._linearOffset,this.connectedBody.node.worldPosition,this.node.worldPosition):this._linearOffset},set:function(t){this._linearOffset.set(t),this._joint&&this._joint.setLinearOffset(t)}},{key:"angularOffset",get:function(){return this._autoCalcOffset&&this.connectedBody&&(zn.toEuler(xat,this.node.worldRotation),zn.toEuler(Sat,this.connectedBody.node.worldRotation),this._angularOffset=Sat.z-xat.z),this._angularOffset},set:function(t){this._angularOffset=t,this._joint&&this._joint.setAngularOffset(t)}},{key:"autoCalcOffset",get:function(){return this._autoCalcOffset},set:function(t){this._autoCalcOffset=t}}]),e}(yat)).prototype,"maxForce",[Dc],Object.getOwnPropertyDescriptor(Rrt.prototype,"maxForce"),Rrt.prototype),lt(Rrt.prototype,"maxTorque",[Dc],Object.getOwnPropertyDescriptor(Rrt.prototype,"maxTorque"),Rrt.prototype),lt(Rrt.prototype,"correctionFactor",[Dc],Object.getOwnPropertyDescriptor(Rrt.prototype,"correctionFactor"),Rrt.prototype),lt(Rrt.prototype,"linearOffset",[Dc],Object.getOwnPropertyDescriptor(Rrt.prototype,"linearOffset"),Rrt.prototype),lt(Rrt.prototype,"angularOffset",[Dc],Object.getOwnPropertyDescriptor(Rrt.prototype,"angularOffset"),Rrt.prototype),lt(Rrt.prototype,"autoCalcOffset",[Dc],Object.getOwnPropertyDescriptor(Rrt.prototype,"autoCalcOffset"),Rrt.prototype),Mrt=lt(Rrt.prototype,"_maxForce",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Ort=lt(Rrt.prototype,"_maxTorque",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),Nrt=lt(Rrt.prototype,"_correctionFactor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),Brt=lt(Rrt.prototype,"_angularOffset",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Lrt=lt(Rrt.prototype,"_linearOffset",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn}}),Frt=lt(Rrt.prototype,"_autoCalcOffset",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Drt=Rrt))||Drt)||Drt),new Qn),bat=(t("SliderJoint2D",Ec("cc.SliderJoint2D")(Vrt=kc()((lt((zrt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).TYPE=Ent.SLIDER,ct(e,"_angle",krt,at(e)),ct(e,"_autoCalcAngle",Urt,at(e)),ct(e,"_enableMotor",Grt,at(e)),ct(e,"_maxMotorForce",Hrt,at(e)),ct(e,"_motorSpeed",jrt,at(e)),ct(e,"_enableLimit",Wrt,at(e)),ct(e,"_lowerLimit",qrt,at(e)),ct(e,"_upperLimit",Xrt,at(e)),e}return $(e,t),Q(e,[{key:"angle",get:function(){return this._autoCalcAngle&&this.connectedBody&&(Qn.subtract(Aat,this.connectedBody.node.worldPosition,this.node.worldPosition),this._angle=pn(Math.atan2(Aat.y,Aat.x))),this._angle},set:function(t){this._angle=t}},{key:"autoCalcAngle",get:function(){return this._autoCalcAngle},set:function(t){this._autoCalcAngle=t}},{key:"enableMotor",get:function(){return this._enableMotor},set:function(t){this._enableMotor=t}},{key:"maxMotorForce",get:function(){return this._maxMotorForce},set:function(t){this._maxMotorForce=t,this._joint&&this._joint.setMaxMotorForce(t)}},{key:"motorSpeed",get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.setMotorSpeed(t)}},{key:"enableLimit",get:function(){return this._enableLimit},set:function(t){this._enableLimit=t}},{key:"lowerLimit",get:function(){return this._lowerLimit},set:function(t){this._lowerLimit=t,this._joint&&this._joint.setLowerLimit(t)}},{key:"upperLimit",get:function(){return this._upperLimit},set:function(t){this._upperLimit=t,this._joint&&this._joint.setUpperLimit(t)}}]),e}(yat)).prototype,"angle",[Dc],Object.getOwnPropertyDescriptor(zrt.prototype,"angle"),zrt.prototype),lt(zrt.prototype,"autoCalcAngle",[Dc],Object.getOwnPropertyDescriptor(zrt.prototype,"autoCalcAngle"),zrt.prototype),lt(zrt.prototype,"enableMotor",[Dc],Object.getOwnPropertyDescriptor(zrt.prototype,"enableMotor"),zrt.prototype),lt(zrt.prototype,"maxMotorForce",[Dc],Object.getOwnPropertyDescriptor(zrt.prototype,"maxMotorForce"),zrt.prototype),lt(zrt.prototype,"motorSpeed",[Dc],Object.getOwnPropertyDescriptor(zrt.prototype,"motorSpeed"),zrt.prototype),lt(zrt.prototype,"enableLimit",[Dc],Object.getOwnPropertyDescriptor(zrt.prototype,"enableLimit"),zrt.prototype),lt(zrt.prototype,"lowerLimit",[Dc],Object.getOwnPropertyDescriptor(zrt.prototype,"lowerLimit"),zrt.prototype),lt(zrt.prototype,"upperLimit",[Dc],Object.getOwnPropertyDescriptor(zrt.prototype,"upperLimit"),zrt.prototype),krt=lt(zrt.prototype,"_angle",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Urt=lt(zrt.prototype,"_autoCalcAngle",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Grt=lt(zrt.prototype,"_enableMotor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Hrt=lt(zrt.prototype,"_maxMotorForce",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),jrt=lt(zrt.prototype,"_motorSpeed",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),Wrt=lt(zrt.prototype,"_enableLimit",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),qrt=lt(zrt.prototype,"_lowerLimit",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xrt=lt(zrt.prototype,"_upperLimit",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Vrt=zrt))||Vrt)||Vrt),t("FixedJoint2D",Ec("cc.FixedJoint2D")(Yrt=kc()((lt((Krt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).TYPE=Ent.FIXED,ct(e,"_frequency",Jrt,at(e)),ct(e,"_dampingRatio",Qrt,at(e)),e}return $(e,t),Q(e,[{key:"frequency",get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)}},{key:"dampingRatio",get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}}]),e}(yat)).prototype,"frequency",[Dc],Object.getOwnPropertyDescriptor(Krt.prototype,"frequency"),Krt.prototype),lt(Krt.prototype,"dampingRatio",[Dc],Object.getOwnPropertyDescriptor(Krt.prototype,"dampingRatio"),Krt.prototype),Jrt=lt(Krt.prototype,"_frequency",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),Qrt=lt(Krt.prototype,"_dampingRatio",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Yrt=Krt))||Yrt)||Yrt),t("WheelJoint2D",Ec("cc.WheelJoint2D")(Zrt=kc()((lt(($rt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).TYPE=Ent.WHEEL,ct(e,"_angle",tat,at(e)),ct(e,"_enableMotor",eat,at(e)),ct(e,"_maxMotorTorque",nat,at(e)),ct(e,"_motorSpeed",iat,at(e)),ct(e,"_frequency",rat,at(e)),ct(e,"_dampingRatio",aat,at(e)),e}return $(e,t),Q(e,[{key:"angle",get:function(){return this._angle},set:function(t){this._angle=t}},{key:"enableMotor",get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.enableMotor(t)}},{key:"maxMotorTorque",get:function(){return this._maxMotorTorque},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.setMaxMotorTorque(t)}},{key:"motorSpeed",get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.setMotorSpeed(t)}},{key:"frequency",get:function(){return this._frequency},set:function(t){this._frequency=t,this._joint&&this._joint.setFrequency(t)}},{key:"dampingRatio",get:function(){return this._dampingRatio},set:function(t){this._dampingRatio=t,this._joint&&this._joint.setDampingRatio(t)}}]),e}(yat)).prototype,"angle",[Dc],Object.getOwnPropertyDescriptor($rt.prototype,"angle"),$rt.prototype),lt($rt.prototype,"enableMotor",[Dc],Object.getOwnPropertyDescriptor($rt.prototype,"enableMotor"),$rt.prototype),lt($rt.prototype,"maxMotorTorque",[Dc],Object.getOwnPropertyDescriptor($rt.prototype,"maxMotorTorque"),$rt.prototype),lt($rt.prototype,"motorSpeed",[Dc],Object.getOwnPropertyDescriptor($rt.prototype,"motorSpeed"),$rt.prototype),lt($rt.prototype,"frequency",[Dc],Object.getOwnPropertyDescriptor($rt.prototype,"frequency"),$rt.prototype),lt($rt.prototype,"dampingRatio",[Dc],Object.getOwnPropertyDescriptor($rt.prototype,"dampingRatio"),$rt.prototype),tat=lt($rt.prototype,"_angle",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 90}}),eat=lt($rt.prototype,"_enableMotor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),nat=lt($rt.prototype,"_maxMotorTorque",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),iat=lt($rt.prototype,"_motorSpeed",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),rat=lt($rt.prototype,"_frequency",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),aat=lt($rt.prototype,"_dampingRatio",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),Zrt=$rt))||Zrt)||Zrt),t("HingeJoint2D",Ec("cc.HingeJoint2D")(oat=kc()((lt((sat=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).TYPE=Ent.HINGE,ct(e,"_enableLimit",cat,at(e)),ct(e,"_lowerAngle",lat,at(e)),ct(e,"_upperAngle",hat,at(e)),ct(e,"_enableMotor",uat,at(e)),ct(e,"_maxMotorTorque",_at,at(e)),ct(e,"_motorSpeed",fat,at(e)),e}return $(e,t),Q(e,[{key:"enableLimit",get:function(){return this._enableLimit},set:function(t){this._enableLimit=t}},{key:"lowerAngle",get:function(){return this._lowerAngle},set:function(t){this._lowerAngle=t,this._joint&&this._joint.setLowerAngle(t)}},{key:"upperAngle",get:function(){return this._upperAngle},set:function(t){this._upperAngle=t,this._joint&&this._joint.setUpperAngle(t)}},{key:"enableMotor",get:function(){return this._enableMotor},set:function(t){this._enableMotor=t,this._joint&&this._joint.enableMotor(t)}},{key:"maxMotorTorque",get:function(){return this._maxMotorTorque},set:function(t){this._maxMotorTorque=t,this._joint&&this._joint.setMaxMotorTorque(t)}},{key:"motorSpeed",get:function(){return this._motorSpeed},set:function(t){this._motorSpeed=t,this._joint&&this._joint.setMotorSpeed(t)}}]),e}(yat)).prototype,"enableLimit",[Dc],Object.getOwnPropertyDescriptor(sat.prototype,"enableLimit"),sat.prototype),lt(sat.prototype,"lowerAngle",[Dc],Object.getOwnPropertyDescriptor(sat.prototype,"lowerAngle"),sat.prototype),lt(sat.prototype,"upperAngle",[Dc],Object.getOwnPropertyDescriptor(sat.prototype,"upperAngle"),sat.prototype),lt(sat.prototype,"enableMotor",[Dc],Object.getOwnPropertyDescriptor(sat.prototype,"enableMotor"),sat.prototype),lt(sat.prototype,"maxMotorTorque",[Dc],Object.getOwnPropertyDescriptor(sat.prototype,"maxMotorTorque"),sat.prototype),lt(sat.prototype,"motorSpeed",[Dc],Object.getOwnPropertyDescriptor(sat.prototype,"motorSpeed"),sat.prototype),cat=lt(sat.prototype,"_enableLimit",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),lat=lt(sat.prototype,"_lowerAngle",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),hat=lt(sat.prototype,"_upperAngle",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),uat=lt(sat.prototype,"_enableMotor",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_at=lt(sat.prototype,"_maxMotorTorque",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),fat=lt(sat.prototype,"_motorSpeed",[Dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),oat=sat))||oat)||oat),t("Physics2DUtils",{PolygonSeparator:Jnt}),function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._type=Int.Closest,e._fixtures=[],e._points=[],e._normals=[],e._fractions=[],e._mask=4294967295,e}$(e,t);var n=e.prototype;return n.init=function(t,e){this._type=t,this._mask=e,this._fixtures.length=0,this._points.length=0,this._normals.length=0,this._fractions.length=0},n.ReportFixture=function(t,e,n,i){return 0==(t.GetFilterData().categoryBits&this._mask)?0:this._type===Int.Closest?(this._fixtures[0]=t,this._points[0]=e,this._normals[0]=n,this._fractions[0]=i,i):(this._fixtures.push(t),this._points.push(new Qn(e.x,e.y)),this._normals.push(new Qn(n.x,n.y)),this._fractions.push(i),this._type===Int.Any?0:this._type>=Int.All?1:i)},n.getFixtures=function(){return this._fixtures},n.getPoints=function(){return this._points},n.getNormals=function(){return this._normals},n.getFractions=function(){return this._fractions},e}(Pnt.RayCastCallback)),Cat=[],Tat=[new Qn,new Qn],Eat=new Pnt.WorldManifold,wat={points:[],separations:[],normal:new Qn},Iat=function(){this.localPoint=new Qn,this.normalImpulse=0,this.tangentImpulse=0},Pat=[new Iat,new Iat],Dat={type:0,localPoint:new Qn,localNormal:new Qn,points:[]},Rat={normalImpulses:[],tangentImpulses:[]},Mat=function(){function t(){this.colliderA=null,this.colliderB=null,this.disabled=!1,this.disabledOnce=!1,this._impulse=null,this._inverted=!1,this._b2contact=null}t.get=function(e){var n=Cat.pop();return n||(n=new t),n.init(e),n},t.put=function(t){var e=t.m_userData;e&&(Cat.push(e),e.reset())};var e=t.prototype;return e._setImpulse=function(t){this._impulse=t},e.init=function(t){this.colliderA=t.m_fixtureA.m_userData.collider,this.colliderB=t.m_fixtureB.m_userData.collider,this.disabled=!1,this.disabledOnce=!1,this._impulse=null,this._inverted=!1,this._b2contact=t,t.m_userData=this},e.reset=function(){this.setTangentSpeed(0),this.resetFriction(),this.resetRestitution(),this.colliderA=null,this.colliderB=null,this.disabled=!1,this._impulse=null,this._b2contact.m_userData=null,this._b2contact=null},e.getWorldManifold=function(){var t=wat.points,e=wat.separations,n=wat.normal;this._b2contact.GetWorldManifold(Eat);var i=Eat.points,r=Eat.separations,a=this._b2contact.GetManifold().pointCount;t.length=e.length=a;for(var o=0;o<a;o++){var s=Tat[o];s.x=i[o].x*Mnt,s.y=i[o].y*Mnt,t[o]=s,e[o]=r[o]*Mnt}return n.x=Eat.normal.x,n.y=Eat.normal.y,this._inverted&&(n.x*=-1,n.y*=-1),wat},e.getManifold=function(){for(var t=Dat.points,e=Dat.localNormal,n=Dat.localPoint,i=this._b2contact.GetManifold(),r=i.points,a=t.length=i.pointCount,o=0;o<a;o++){var s=Pat[o],c=r[o];s.localPoint.x=c.localPoint.x*Mnt,s.localPoint.y=c.localPoint.y*Mnt,s.normalImpulse=c.normalImpulse*Mnt,s.tangentImpulse=c.tangentImpulse,t[o]=s}return n.x=i.localPoint.x*Mnt,n.y=i.localPoint.y*Mnt,e.x=i.localNormal.x,e.y=i.localNormal.y,Dat.type=i.type,this._inverted&&(e.x*=-1,e.y*=-1),Dat},e.getImpulse=function(){var t=this._impulse;if(!t)return null;for(var e=Rat.normalImpulses,n=Rat.tangentImpulses,i=t.count,r=0;r<i;r++)e[r]=t.normalImpulses[r]*Mnt,n[r]=t.tangentImpulses[r];return n.length=e.length=i,Rat},e.emit=function(t){var e=this.colliderA,n=this.colliderB,i=e.body,r=n.body;i.enabledContactListener&&(null==e||e.emit(t,e,n,this)),r.enabledContactListener&&(null==n||n.emit(t,n,e,this)),(i.enabledContactListener||r.enabledContactListener)&&Pit.instance.emit(t,e,n,this),(this.disabled||this.disabledOnce)&&(this.setEnabled(!1),this.disabledOnce=!1)},e.setEnabled=function(t){this._b2contact.SetEnabled(t)},e.isTouching=function(){return this._b2contact.IsTouching()},e.setTangentSpeed=function(t){this._b2contact.SetTangentSpeed(t)},e.getTangentSpeed=function(){return this._b2contact.GetTangentSpeed()},e.setFriction=function(t){this._b2contact.SetFriction(t)},e.getFriction=function(){return this._b2contact.GetFriction()},e.resetFriction=function(){return this._b2contact.ResetFriction()},e.setRestitution=function(t){this._b2contact.SetRestitution(t)},e.getRestitution=function(){return this._b2contact.GetRestitution()},e.resetRestitution=function(){return this._b2contact.ResetRestitution()},t}(),Oat=new Pnt.Vec2,Nat=new Dn,Bat=Dn.GREEN,Lat=Dn.RED,Fat=function(t){function e(e){var n;return(n=t.call(this)||this)._drawer=null,n._xf=new Pnt.Transform,n._dxf=new Pnt.Transform,n._drawer=e,n}$(e,t);var n=e.prototype;return n._DrawPolygon=function(t,e){for(var n=this._drawer,i=0;i<e;i++){Pnt.Transform.MulXV(this._xf,t[i],Oat);var r=Oat.x*Mnt,a=Oat.y*Mnt;0===i?n.moveTo(r,a):n.lineTo(r,a)}n.close()},n.DrawPolygon=function(t,e,n){this._applyStrokeColor(n),this._DrawPolygon(t,e),this._drawer.stroke()},n.DrawSolidPolygon=function(t,e,n){this._applyFillColor(n),this._DrawPolygon(t,e),this._drawer.fill(),this._drawer.stroke()},n._DrawCircle=function(t,e){var n=this._xf.p;this._drawer.circle((t.x+n.x)*Mnt,(t.y+n.y)*Mnt,e*Mnt)},n.DrawCircle=function(t,e,n){this._applyStrokeColor(n),this._DrawCircle(t,e),this._drawer.stroke()},n.DrawSolidCircle=function(t,e,n,i){this._applyFillColor(i),this._DrawCircle(t,e),this._drawer.fill()},n.DrawSegment=function(t,e,n){var i=this._drawer;if(t.x===e.x&&t.y===e.y)return this._applyFillColor(n),this._DrawCircle(t,2/Mnt),void i.fill();this._applyStrokeColor(n),Pnt.Transform.MulXV(this._xf,t,Oat),i.moveTo(Oat.x*Mnt,Oat.y*Mnt),Pnt.Transform.MulXV(this._xf,e,Oat),i.lineTo(Oat.x*Mnt,Oat.y*Mnt),i.stroke()},n.DrawTransform=function(t){var e=this._drawer;e.strokeColor=Lat,Oat.x=Oat.y=0,Pnt.Transform.MulXV(t,Oat,Oat),e.moveTo(Oat.x*Mnt,Oat.y*Mnt),Oat.x=1,Oat.y=0,Pnt.Transform.MulXV(t,Oat,Oat),e.lineTo(Oat.x*Mnt,Oat.y*Mnt),e.stroke(),e.strokeColor=Bat,Oat.x=Oat.y=0,Pnt.Transform.MulXV(t,Oat,Oat),e.moveTo(Oat.x*Mnt,Oat.y*Mnt),Oat.x=0,Oat.y=1,Pnt.Transform.MulXV(t,Oat,Oat),e.lineTo(Oat.x*Mnt,Oat.y*Mnt),e.stroke()},n.DrawPoint=function(){},n.DrawParticles=function(){},n._applyStrokeColor=function(t){this._drawer.strokeColor=Nat.set(255*t.r,255*t.g,255*t.b,150)},n._applyFillColor=function(t){this._drawer.fillColor=Nat.set(255*t.r,255*t.g,255*t.b,150)},n.PushTransform=function(t){this._xf=t},n.PopTransform=function(){this._xf=this._dxf},e}(Pnt.Draw),Vat=new Mn,zat=new Qn,kat=new Qn,Uat=new Pnt.BodyDef,Gat=new Pnt.AABB,Hat=[],jat=function(){function t(){this._world=void 0,this._bodies=[],this._animatedBodies=[],this._rotationAxis=new Mn,this._contactListener=void 0,this._aabbQueryCallback=void 0,this._raycastQueryCallback=void 0,this._debugGraphics=null,this._b2DebugDrawer=null,this._debugDrawFlags=0,this._world=new Pnt.World(new Pnt.Vec2(0,-10));var t=new Ont;t.setBeginContact(this._onBeginContact),t.setEndContact(this._onEndContact),t.setPreSolve(this._onPreSolve),t.setPostSolve(this._onPostSolve),this._world.SetContactListener(t),this._contactListener=t,this._aabbQueryCallback=new Nnt,this._raycastQueryCallback=new bat}var e=t.prototype;return e._checkDebugDrawValid=function(){if(!this._debugGraphics||!this._debugGraphics.isValid){var t=rR("Canvas");if(!t){var e=TO.getScene();if(!e)return;(t=new TE("Canvas")).addComponent(nj),t.parent=e}var n=new TE("PHYSICS_2D_DEBUG_DRAW");n.hideFlags|=ml.Flags.DontSave,n.parent=t,n.worldPosition=Mn.ZERO,n.layer=Hd.Enum.UI_2D,this._debugGraphics=n.addComponent(NU),this._debugGraphics.lineWidth=2;var i=new Fat(this._debugGraphics);this._b2DebugDrawer=i,this._world.SetDebugDraw(i)}var r=this._debugGraphics.node.parent;this._debugGraphics.node.setSiblingIndex(r.children.length-1),this._b2DebugDrawer&&this._b2DebugDrawer.SetFlags(this.debugDrawFlags)},e.setGravity=function(t){this._world.SetGravity(t)},e.setAllowSleep=function(){this._world.SetAllowSleeping(!0)},e.step=function(t,e,n){void 0===e&&(e=10),void 0===n&&(n=10);for(var i=this._animatedBodies,r=0,a=i.length;r<a;r++)i[r].animate(t);this._world.Step(t,e,n)},e.raycast=function(t,e,n,i){if(t.equals(e))return[];n=n||Int.Closest,zat.x=t.x/Mnt,zat.y=t.y/Mnt,kat.x=e.x/Mnt,kat.y=e.y/Mnt;var r=this._raycastQueryCallback;r.init(n,i),this._world.RayCast(r,zat,kat);var a=r.getFixtures();if(a.length>0){for(var o=r.getPoints(),s=r.getNormals(),c=r.getFractions(),l=[],h=0,u=a.length;h<u;h++){var _=a[h],f=_.m_userData,d=f.collider;if(n===Int.AllClosest){for(var p=void 0,m=0;m<l.length;m++)l[m].collider===d&&(p=l[m]);if(p){c[h]<p.fraction&&(p.fixtureIndex=f.getFixtureIndex(_),p.point.x=o[h].x*Mnt,p.point.y=o[h].y*Mnt,p.normal.x=s[h].x,p.normal.y=s[h].y,p.fraction=c[h]);continue}}l.push({collider:d,fixtureIndex:f.getFixtureIndex(_),point:new Qn(o[h].x*Mnt,o[h].y*Mnt),normal:new Qn(s[h].x,s[h].y),fraction:c[h]})}return l}return[]},e.syncPhysicsToScene=function(){for(var t=this._bodies,e=0,n=t.length;e<n;e++){var i=t[e],r=i.rigidBody;if(r.type!==Cnt.Animated){var a=r.node,o=i.impl,s=o.GetPosition();Vat.x=s.x*Mnt,Vat.y=s.y*Mnt,Vat.z=0,a.worldPosition=Vat;var c=pn(o.GetAngle());a.setWorldRotationFromEuler(0,0,c)}else i.resetVelocity()}},e.syncSceneToPhysics=function(){for(var t=this._bodies,e=0;e<t.length;e++)t[e].syncRotationToPhysics(),t[e].syncPositionToPhysics()},e.addBody=function(t){if(!this._bodies.includes(t)){var e=Uat,n=t.rigidBody;e.allowSleep=n.allowSleep,e.gravityScale=n.gravityScale,e.linearDamping=n.linearDamping,e.angularDamping=n.angularDamping,e.fixedRotation=n.fixedRotation,e.bullet=n.bullet;var i=n.node,r=i.worldPosition;e.position.Set(r.x/Mnt,r.y/Mnt),Vat.z=zn.getAxisAngle(this._rotationAxis,i.worldRotation),this._rotationAxis.z<0&&(Vat.z=2*Math.PI-Vat.z),e.angle=Vat.z,e.awake=n.awakeOnLoad,n.type===Cnt.Animated?(e.type=Cnt.Kinematic,this._animatedBodies.push(t),t._animatedPos.set(e.position.x,e.position.y),t._animatedAngle=e.angle):e.type=n.type;var a=n,o=a._linearVelocity;e.linearVelocity.Set(o.x,o.y),e.angularVelocity=dn(a._angularVelocity);var s=this._world.CreateBody(e);s.m_userData=t,t._imp=s,this._bodies.push(t)}},e.removeBody=function(t){this._bodies.includes(t)&&(t.impl&&(t.impl.m_userData=null,this._world.DestroyBody(t.impl),t._imp=null),ie.remove(this._bodies,t),t.rigidBody.type===Cnt.Animated&&ie.remove(this._animatedBodies,t))},e.registerContactFixture=function(t){this._contactListener.registerContactFixture(t)},e.unregisterContactFixture=function(t){this._contactListener.unregisterContactFixture(t)},e.testPoint=function(t){var e=zat.x=t.x/Mnt,n=zat.y=t.y/Mnt,i=.2/Mnt;Gat.lowerBound.x=e-i,Gat.lowerBound.y=n-i,Gat.upperBound.x=e+i,Gat.upperBound.y=n+i;var r=this._aabbQueryCallback;r.init(zat),this._world.QueryAABB(r,Gat);var a=r.getFixtures();Hat.length=0;for(var o=0;o<a.length;o++){var s=a[o].m_userData.collider;Hat.includes(s)||Hat.push(s)}return Hat},e.testAABB=function(t){Gat.lowerBound.x=t.xMin/Mnt,Gat.lowerBound.y=t.yMin/Mnt,Gat.upperBound.x=t.xMax/Mnt,Gat.upperBound.y=t.yMax/Mnt;var e=this._aabbQueryCallback;e.init(),this._world.QueryAABB(e,Gat);var n=e.getFixtures();Hat.length=0;for(var i=0;i<n.length;i++){var r=n[i].m_userData.collider;Hat.includes(r)||Hat.push(r)}return Hat},e.drawDebug=function(){this._checkDebugDrawValid(),this._debugGraphics&&(this._debugGraphics.clear(),this._world.DrawDebugData())},e._onBeginContact=function(t){Mat.get(t).emit(Rnt.BEGIN_CONTACT)},e._onEndContact=function(t){var e=t.m_userData;e&&(e.emit(Rnt.END_CONTACT),Mat.put(t))},e._onPreSolve=function(t){var e=t.m_userData;e&&e.emit(Rnt.PRE_SOLVE)},e._onPostSolve=function(t,e){var n=t.m_userData;n&&(n._setImpulse(e),n.emit(Rnt.POST_SOLVE),n._setImpulse(null))},Q(t,[{key:"impl",get:function(){return this._world}},{key:"debugDrawFlags",get:function(){return this._debugDrawFlags},set:function(t){t||this._debugGraphics&&(this._debugGraphics.node.parent=null),this._debugDrawFlags=t}}]),t}(),Wat=(new Mn,new Pnt.Vec2),qat=function(){function t(){this._animatedPos=new Qn,this._animatedAngle=0,this._body=null,this._inited=!1}var e=t.prototype;return e.initialize=function(t){this._rigidBody=t,Pit.instance._callAfterStep(this,this._init)},e.onDestroy=function(){Pit.instance._callAfterStep(this,this._destroy)},e.onEnable=function(){this.setActive(!0)},e.onDisable=function(){this.setActive(!1)},e._registerNodeEvents=function(){this.rigidBody.node.on(bC.TRANSFORM_CHANGED,this._onNodeTransformChanged,this)},e._unregisterNodeEvents=function(){this.rigidBody.node.off(bC.TRANSFORM_CHANGED,this._onNodeTransformChanged,this)},e._onNodeTransformChanged=function(t){if(!Pit.instance.stepping){if(t&TE.TransformBit.SCALE)for(var e=this.rigidBody.getComponents(gat),n=0;n<e.length;n++)e[n].apply();t&TE.TransformBit.POSITION&&this.syncPositionToPhysics(!0),t&TE.TransformBit.ROTATION&&this.syncRotationToPhysics(!0)}},e._init=function(){this._inited||(this._registerNodeEvents(),Pit.instance.physicsWorld.addBody(this),this._inited=!0)},e._destroy=function(){this._inited&&(Pit.instance.physicsWorld.removeBody(this),this._unregisterNodeEvents(),this._inited=!1)},e.animate=function(t){var e=this._body;if(e){var n=e.GetPosition();e.SetAwake(!0);var i=1/t;Wat.x=(this._animatedPos.x-n.x)*i,Wat.y=(this._animatedPos.y-n.y)*i,e.SetLinearVelocity(Wat);var r=e.GetAngle();e.SetAngularVelocity((this._animatedAngle-r)*i)}},e.syncPositionToPhysics=function(t){void 0===t&&(t=!1);var e=this._body;if(e){var n,i=this._rigidBody.node.worldPosition,r=this._rigidBody.type;(n=r===Cnt.Animated?e.GetLinearVelocity():e.GetPosition()).x=i.x/Mnt,n.y=i.y/Mnt,r===Cnt.Animated&&t?this._animatedPos.set(n.x,n.y):e.SetTransformVec(n,e.GetAngle())}},e.syncRotationToPhysics=function(t){void 0===t&&(t=!1);var e=this._body;if(e){var n=dn(this._rigidBody.node.eulerAngles.z);this._rigidBody.type===Cnt.Animated&&t?this._animatedAngle=n:e.SetTransformVec(e.GetPosition(),n)}},e.resetVelocity=function(){var t=this._body;if(t){var e=t.m_linearVelocity;e.Set(0,0),t.SetLinearVelocity(e),t.SetAngularVelocity(0)}},e.setType=function(t){this._body.SetType(t)},e.setLinearDamping=function(t){this._body.SetLinearDamping(t)},e.setAngularDamping=function(t){this._body.SetAngularDamping(t)},e.setGravityScale=function(t){this._body.SetGravityScale(t)},e.setFixedRotation=function(t){this._body.SetFixedRotation(t)},e.setAllowSleep=function(t){this._body.SetSleepingAllowed(t)},e.isActive=function(){return this._body.IsActive()},e.setActive=function(t){this._body.SetActive(t)},e.wakeUp=function(){this._body.SetAwake(!0)},e.sleep=function(){this._body.SetAwake(!1)},e.getMass=function(){return this._body.GetMass()},e.setLinearVelocity=function(t){this._body.SetLinearVelocity(t)},e.getLinearVelocity=function(t){var e=this._body.GetLinearVelocity();return t.x=e.x,t.y=e.y,t},e.getLinearVelocityFromWorldPoint=function(t,e){return Wat.Set(t.x/Mnt,t.y/Mnt),this._body.GetLinearVelocityFromWorldPoint(Wat,e),e.x*=Mnt,e.y*=Mnt,e},e.setAngularVelocity=function(t){this._body.SetAngularVelocity(t)},e.getAngularVelocity=function(){return pn(this._body.GetAngularVelocity())},e.getLocalVector=function(t,e){return e=e||new Qn,Wat.Set(t.x/Mnt,t.y/Mnt),this._body.GetLocalVector(Wat,e),e.x*=Mnt,e.y*=Mnt,e},e.getWorldVector=function(t,e){return Wat.Set(t.x/Mnt,t.y/Mnt),this._body.GetWorldVector(Wat,e),e.x*=Mnt,e.y*=Mnt,e},e.getLocalPoint=function(t,e){return e=e||new Qn,Wat.Set(t.x/Mnt,t.y/Mnt),this._body.GetLocalPoint(Wat,e),e.x*=Mnt,e.y*=Mnt,e},e.getWorldPoint=function(t,e){return e=e||new Qn,Wat.Set(t.x/Mnt,t.y/Mnt),this._body.GetWorldPoint(Wat,e),e.x*=Mnt,e.y*=Mnt,e},e.getLocalCenter=function(t){t=t||new Qn;var e=this._body.GetLocalCenter();return t.x=e.x*Mnt,t.y=e.y*Mnt,t},e.getWorldCenter=function(t){t=t||new Qn;var e=this._body.GetWorldCenter();return t.x=e.x*Mnt,t.y=e.y*Mnt,t},e.getInertia=function(){return this._body.GetInertia()},e.applyForce=function(t,e,n){this._body&&(Wat.Set(e.x/Mnt,e.y/Mnt),this._body.ApplyForce(t,Wat,n))},e.applyForceToCenter=function(t,e){this._body&&this._body.ApplyForceToCenter(t,e)},e.applyTorque=function(t,e){this._body&&this._body.ApplyTorque(t,e)},e.applyLinearImpulse=function(t,e,n){this._body&&(Wat.Set(e.x/Mnt,e.y/Mnt),this._body.ApplyLinearImpulse(t,Wat,n))},e.applyLinearImpulseToCenter=function(t,e){this._body&&this._body.ApplyLinearImpulse(t,this._body.GetPosition(),e)},e.applyAngularImpulse=function(t,e){this._body&&this._body.ApplyAngularImpulse(t,e)},Q(t,[{key:"impl",get:function(){return this._body}},{key:"_imp",set:function(t){this._body=t}},{key:"rigidBody",get:function(){return this._rigidBody}},{key:"isAwake",get:function(){return this._body.IsAwake()}},{key:"isSleeping",get:function(){return!this._body.IsAwake()}}]),t}(),Xat=new Pnt.Filter;function Yat(t){var e=t.collider;return Xat.categoryBits=e.group===ait.DEFAULT?e.body.group:e.group,Xat.maskBits=Pit.instance.collisionMatrix[Xat.categoryBits],Xat}var Kat,Jat=function(){function t(){this._shapes=[],this._fixtures=[],this._collider=null,this._body=null,this._inited=!1,this._rect=new oi}var e=t.prototype;return e.initialize=function(t){this._collider=t},e.onLoad=function(){},e.onEnable=function(){Pit.instance._callAfterStep(this,this._init)},e.onDisable=function(){Pit.instance._callAfterStep(this,this._destroy)},e.start=function(){},e.onGroupChanged=function(){var t=Yat(this);this._fixtures.forEach((function(e){e.SetFilterData(t)}))},e.apply=function(){this._destroy(),this._init()},e.getFixtureIndex=function(t){return this._fixtures.indexOf(t)},e._createShapes=function(){return[]},e._init=function(){var t;if(!this._inited){var e=this.collider,n=e.getComponent(vat);if(n){var i=null===(t=n.impl)||void 0===t?void 0:t.impl;if(i){for(var r=n.node.worldScale,a=0===r.x&&0===r.y?[]:this._createShapes(r.x,r.y),o=Yat(this),s=0;s<a.length;s++){var c=a[s],l={density:e.density,isSensor:e.sensor,friction:e.friction,restitution:e.restitution,shape:c,filter:o},h=i.CreateFixture(l);h.m_userData=this,n.enabledContactListener&&Pit.instance.physicsWorld.registerContactFixture(h),this._shapes.push(c),this._fixtures.push(h)}this._body=i,this._inited=!0}}}},e._destroy=function(){if(this._inited){for(var t=this._fixtures,e=this._body,n=t.length-1;n>=0;n--){var i=t[n];i.m_userData=null,Pit.instance.physicsWorld.unregisterContactFixture(i),e&&e.DestroyFixture(i)}this._body=null,this._fixtures.length=0,this._shapes.length=0,this._inited=!1}},Q(t,[{key:"impl",get:function(){return this._shapes}},{key:"collider",get:function(){return this._collider}},{key:"worldAABB",get:function(){for(var t=1e7,e=t,n=t,i=-t,r=-t,a=this._fixtures,o=0;o<a.length;o++)for(var s=a[o],c=s.GetShape().GetChildCount(),l=0;l<c;l++){var h=s.GetAABB(l);h.lowerBound.x<e&&(e=h.lowerBound.x),h.lowerBound.y<n&&(n=h.lowerBound.y),h.upperBound.x>i&&(i=h.upperBound.x),h.upperBound.y>r&&(r=h.upperBound.y)}e*=Mnt,n*=Mnt,i*=Mnt,r*=Mnt;var u=this._rect;return u.x=e,u.y=n,u.width=i-e,u.height=r-n,u}}]),t}(),Qat=new oi,Zat=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._worldPoints=[new Qn,new Qn,new Qn,new Qn],e}return $(e,t),e.prototype._createShapes=function(t,e){t=Math.abs(t),e=Math.abs(e);var n=this.collider,i=n.size.width/2/Mnt*t,r=n.size.height/2/Mnt*e,a=n.offset.x/Mnt*t,o=n.offset.y/Mnt*e,s=new Pnt.PolygonShape;return s.SetAsBox(i,r,new Pnt.Vec2(a,o),0),[s]},Q(e,[{key:"worldPoints",get:function(){var t=Qat,e=this.collider,n=e.size,i=e.offset;t.x=i.x-n.width/2,t.y=i.y-n.height/2,t.width=n.width,t.height=n.height;var r=this._worldPoints,a=r[0],o=r[1],s=r[2],c=r[3];return t.transformMat4ToPoints(e.node.worldMatrix,a,o,s,c),r}}]),e}(Jat),$at=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._worldPosition=new Qn,e}return $(e,t),e.prototype._createShapes=function(t,e){t=Math.abs(t),e=Math.abs(e);var n=this.collider,i=n.offset.x/Mnt*t,r=n.offset.y/Mnt*e,a=new Pnt.CircleShape;return a.m_radius=n.radius/Mnt*t,a.m_p.Set(i,r),[a]},Q(e,[{key:"worldRadius",get:function(){return this._shapes[0].m_radius*Mnt}},{key:"worldPosition",get:function(){var t=this._shapes[0].m_p;return this._worldPosition.set(t.x*Mnt,t.y*Mnt)}}]),e}(Jat),tot=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._worldPoints=[],e}return $(e,t),e.prototype._createShapes=function(t,e){var n=[],i=this.collider,r=i.points;r.length>0&&r[0].equals(r[r.length-1])&&(r.length-=1);for(var a=Fnt(r),o=i.offset,s=0;s<a.length;s++){for(var c=a[s],l=null,h=[],u=null,_=0,f=c.length;_<f;_++){l||(l=new Pnt.PolygonShape);var d=c[_],p=(d.x+o.x)/Mnt*t,m=(d.y+o.y)/Mnt*e,v=new Pnt.Vec2(p,m);h.push(v),u||(u=v),h.length===Pnt.maxPolygonVertices&&(l.Set(h,h.length),n.push(l),l=null,_<f-1&&(h=[u,h[h.length-1]]))}l&&(l.Set(h,h.length),n.push(l))}return n},Q(e,[{key:"worldPoints",get:function(){for(var t=this.collider,e=t.points,n=this._worldPoints,i=t.node.worldMatrix,r=0;r<e.length;r++)n[r]||(n[r]=new Qn),Qn.transformMat4(n[r],e[r],i);return n.length=e.length,this._worldPoints}}]),e}(Jat),eot=function(){function t(){this._b2joint=null,this._jointComp=null,this._body=null,this._inited=!1}var e=t.prototype;return e.initialize=function(t){this._jointComp=t},e.onEnable=function(){Pit.instance._callAfterStep(this,this._init)},e.onDisable=function(){Pit.instance._callAfterStep(this,this._destroy)},e.start=function(){Pit.instance._callAfterStep(this,this._init)},e._init=function(){if(!this._inited){var t=this._jointComp;if(t.isValid){this._body=t.getComponent(vat);var e=this._createJointDef();if(e){var n=t.connectedBody;n&&n.enabledInHierarchy&&(e.bodyA=this._body.impl.impl,e.bodyB=n.impl.impl,e.collideConnected=t.collideConnected,this._b2joint=Pit.instance.physicsWorld.impl.CreateJoint(e),this._inited=!0)}}}},e._destroy=function(){this._inited&&(Pit.instance.physicsWorld.impl.DestroyJoint(this._b2joint),this._b2joint=null,this._inited=!1)},e._createJointDef=function(){return null},e.isValid=function(){return this._b2joint&&this._body&&this._body.impl&&this._jointComp&&this._jointComp.connectedBody&&this._jointComp.connectedBody.impl},Q(t,[{key:"impl",get:function(){return this._b2joint}},{key:"comp",get:function(){return this._jointComp}},{key:"body",get:function(){return this._body}}]),t}(),not=new Pnt.Vec2;Kat={PhysicsWorld:jat,RigidBody:qat,BoxShape:Zat,CircleShape:$at,PolygonShape:tot,MouseJoint:function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._touchPoint=new Qn,e._isTouched=!1,e}$(e,t);var n=e.prototype;return n.setTarget=function(t){this._b2joint&&(not.x=t.x/Mnt,not.y=t.y/Mnt,this._b2joint.SetTarget(not))},n.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetDampingRatio(t)},n.setFrequency=function(t){this._b2joint&&this._b2joint.SetFrequency(t)},n.setMaxForce=function(t){this._b2joint&&this._b2joint.SetMaxForce(t)},n._createJointDef=function(){var t=new Pnt.MouseJointDef,e=this._jointComp;return t.target.Set(this._touchPoint.x/Mnt,this._touchPoint.y/Mnt),t.maxForce=e.maxForce,t.dampingRatio=e.dampingRatio,t.frequencyHz=e.frequency,t},n.initialize=function(e){t.prototype.initialize.call(this,e);var n=rR("Canvas");n&&(n.on(bC.TOUCH_START,this.onTouchBegan,this),n.on(bC.TOUCH_MOVE,this.onTouchMove,this),n.on(bC.TOUCH_END,this.onTouchEnd,this),n.on(bC.TOUCH_CANCEL,this.onTouchEnd,this))},n.onEnable=function(){},n.start=function(){},n.onTouchBegan=function(t){this._isTouched=!0;var e=this._touchPoint.set(t.getUILocation()),n=Pit.instance.physicsWorld.testPoint(e);if(!(n.length<=0)){var i=n[0].body;i.wakeUp();var r=this._jointComp;r.connectedBody=i,this._init(),this.setMaxForce(r.maxForce*i.getMass()),this.setTarget(e)}},n.onTouchMove=function(t){this._touchPoint=t.getUILocation()},n.onTouchEnd=function(){this._destroy(),this._isTouched=!1},n.update=function(){this._isTouched&&this.isValid()&&this.setTarget(this._touchPoint)},e}(eot),DistanceJoint:function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.setMaxLength=function(t){this._b2joint&&this._b2joint.SetMaxLength(t)},n._createJointDef=function(){var t=this._jointComp,e=new Pnt.RopeJointDef;return e.localAnchorA.Set(t.anchor.x/Mnt,t.anchor.y/Mnt),e.localAnchorB.Set(t.connectedAnchor.x/Mnt,t.connectedAnchor.y/Mnt),e.maxLength=t.maxLength/Mnt,e},e}(eot),SpringJoint:function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetDampingRatio(t)},n.setFrequency=function(t){this._b2joint&&this._b2joint.SetFrequency(t)},n.setDistance=function(t){this._b2joint&&this._b2joint.SetLength(t)},n._createJointDef=function(){var t=this._jointComp,e=new Pnt.DistanceJointDef;return e.localAnchorA.Set(t.anchor.x/Mnt,t.anchor.y/Mnt),e.localAnchorB.Set(t.connectedAnchor.x/Mnt,t.connectedAnchor.y/Mnt),e.length=t.distance/Mnt,e.dampingRatio=t.dampingRatio,e.frequencyHz=t.frequency,e},e}(eot),RelativeJoint:function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.setMaxForce=function(t){this._b2joint&&this._b2joint.SetMaxForce(t)},n.setAngularOffset=function(t){this._b2joint&&this._b2joint.SetAngularOffset(dn(t))},n.setLinearOffset=function(t){this._b2joint&&this._b2joint.SetLinearOffset(new Pnt.Vec2(t.x/Mnt,t.y/Mnt))},n.setCorrectionFactor=function(t){this._b2joint&&(this._b2joint.m_correctionFactor=t)},n.setMaxTorque=function(t){this._b2joint&&this._b2joint.SetMaxTorque(t)},n._createJointDef=function(){var t=this._jointComp,e=new Pnt.MotorJointDef;return e.linearOffset.Set(t.linearOffset.x/Mnt,t.linearOffset.y/Mnt),e.angularOffset=dn(t.angularOffset),e.maxForce=t.maxForce,e.maxTorque=t.maxTorque,e.correctionFactor=t.correctionFactor,e},e}(eot),SliderJoint:function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.enableLimit=function(t){this._b2joint&&this._b2joint.EnableLimit(t)},n.setLowerLimit=function(){this.updateLimits()},n.setUpperLimit=function(){this.updateLimits()},n.updateLimits=function(){if(this._b2joint){var t=this._jointComp;this._b2joint.SetLimits(t.lowerLimit/Mnt,t.upperLimit/Mnt)}},n.enableMotor=function(t){this._b2joint&&this._b2joint.EnableMotor(t)},n.setMaxMotorForce=function(t){this._b2joint&&this._b2joint.SetMaxMotorForce(t)},n.setMotorSpeed=function(t){this._b2joint&&this._b2joint.SetMotorSpeed(t)},n._createJointDef=function(){var t=this._jointComp,e=new Pnt.PrismaticJointDef;e.localAnchorA.Set(t.anchor.x/Mnt,t.anchor.y/Mnt),e.localAnchorB.Set(t.connectedAnchor.x/Mnt,t.connectedAnchor.y/Mnt);var n=dn(t.angle);return e.localAxisA.Set(Math.cos(n),Math.sin(n)),e.referenceAngle=0,e.enableLimit=t.enableLimit,e.lowerTranslation=t.lowerLimit/Mnt,e.upperTranslation=t.upperLimit/Mnt,e.enableMotor=t.enableMotor,e.maxMotorForce=t.maxMotorForce,e.motorSpeed=t.motorSpeed,e},e}(eot),FixedJoint:function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.setFrequency=function(t){this._b2joint&&this._b2joint.SetFrequency(t)},n.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetDampingRatio(t)},n._createJointDef=function(){var t=this._jointComp,e=new Pnt.WeldJointDef;return e.localAnchorA.Set(t.anchor.x/Mnt,t.anchor.y/Mnt),e.localAnchorB.Set(t.connectedAnchor.x/Mnt,t.connectedAnchor.y/Mnt),e.referenceAngle=0,e.frequencyHz=t.frequency,e.dampingRatio=t.dampingRatio,e},e}(eot),WheelJoint:function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.setDampingRatio=function(t){this._b2joint&&this._b2joint.SetSpringDampingRatio(t)},n.setFrequency=function(t){this._b2joint&&this._b2joint.SetSpringFrequencyHz(t)},n.enableMotor=function(t){this._b2joint&&this._b2joint.EnableMotor(t)},n.setMaxMotorTorque=function(t){this._b2joint&&this._b2joint.SetMaxMotorTorque(t)},n.setMotorSpeed=function(t){this._b2joint&&this._b2joint.SetMotorSpeed(t)},n._createJointDef=function(){var t=this._jointComp,e=new Pnt.WheelJointDef;e.localAnchorA.Set(t.anchor.x/Mnt,t.anchor.y/Mnt),e.localAnchorB.Set(t.connectedAnchor.x/Mnt,t.connectedAnchor.y/Mnt);var n=dn(t.angle);return e.localAxisA.Set(Math.cos(n),Math.sin(n)),e.maxMotorTorque=t.maxMotorTorque,e.motorSpeed=dn(t.motorSpeed),e.enableMotor=t.enableMotor,e.dampingRatio=t.dampingRatio,e.frequencyHz=t.frequency,e},e}(eot),HingeJoint:function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.enableLimit=function(t){this._b2joint&&this._b2joint.EnableLimit(t)},n.setLowerAngle=function(){this.updateLimits()},n.setUpperAngle=function(){this.updateLimits()},n.updateLimits=function(){if(this._b2joint){var t=this._jointComp;this._b2joint.SetLimits(dn(t.lowerAngle),dn(t.upperAngle))}},n.enableMotor=function(t){this._b2joint&&this._b2joint.EnableMotor(t)},n.setMaxMotorTorque=function(t){this._b2joint&&this._b2joint.SetMaxMotorTorque(t)},n.setMotorSpeed=function(t){this._b2joint&&this._b2joint.SetMotorSpeed(t)},n._createJointDef=function(){var t=this._jointComp,e=new Pnt.RevoluteJointDef;return e.localAnchorA.Set(t.anchor.x/Mnt,t.anchor.y/Mnt),e.localAnchorB.Set(t.connectedAnchor.x/Mnt,t.connectedAnchor.y/Mnt),e.enableMotor=t.enableMotor,e.maxMotorTorque=t.maxMotorTorque,e.motorSpeed=dn(t.motorSpeed),e.enableLimit=t.enableLimit,e.lowerAngle=t.lowerAngle,e.upperAngle=t.upperAngle,e},e}(eot)},vnt="box2d",h._global.CC_PHYSICS_2D_BUILTIN=!1,h._global.CC_PHYSICS_2D_BOX2D=!0,mnt=Kat;var iot,rot,aot,oot,sot,cot=function(){function t(){this._arrayBufferOrPaddings=[],this._length=0}var e=t.prototype;return e.setNextAlignment=function(t){if(0!==t){var e=this._length%t;if(0!==e){var n=t-e;this._arrayBufferOrPaddings.push(n),this._length+=n}}},e.addBuffer=function(t){var e=this._length;return this._arrayBufferOrPaddings.push(t),this._length+=t.byteLength,e},e.getLength=function(){return this._length},e.getCombined=function(){var t=new Uint8Array(this._length),e=0;return this._arrayBufferOrPaddings.forEach((function(n){"number"==typeof n?e+=n:(t.set(new Uint8Array(n),e),e+=n.byteLength)})),t.buffer},t}(),lot=function(){function t(t,e){if(this._mesh=void 0,this._subMeshRenderings=[],this._mesh=t,this._mesh.struct.morph){var n=this._mesh.struct.primitives.length;this._subMeshRenderings=new Array(n).fill(null);for(var i=0;i<n;++i){var r=this._mesh.struct.morph.subMeshMorphs[i];r&&(r.targets.length>Rp.MAX_MORPH_TARGET_COUNT?this._subMeshRenderings[i]=new uot(this._mesh,i,this._mesh.struct.morph,e):this._subMeshRenderings[i]=new hot(this._mesh,i,this._mesh.struct.morph,e))}}}return t.prototype.createInstance=function(){for(var t=this,e=this._mesh.struct.primitives.length,n=new Array(e),i=0;i<e;++i){var r,a;n[i]=null!==(r=null===(a=this._subMeshRenderings[i])||void 0===a?void 0:a.createInstance())&&void 0!==r?r:null}return{setWeights:function(t,e){var i;null===(i=n[t])||void 0===i||i.setWeights(e)},requiredPatches:function(e){t._mesh.struct.morph;var i=t._mesh.struct.morph.subMeshMorphs[e],r=n[e];if(null===r)return null;var a=[{name:"CC_USE_MORPH",value:!0},{name:"CC_MORPH_TARGET_COUNT",value:i.targets.length}];return i.attributes.includes(nr.ATTR_POSITION)&&a.push({name:"CC_MORPH_TARGET_HAS_POSITION",value:!0}),i.attributes.includes(nr.ATTR_NORMAL)&&a.push({name:"CC_MORPH_TARGET_HAS_NORMAL",value:!0}),i.attributes.includes(nr.ATTR_TANGENT)&&a.push({name:"CC_MORPH_TARGET_HAS_TANGENT",value:!0}),a.push.apply(a,r.requiredPatches()),a},adaptPipelineState:function(t,e){var i;null===(i=n[t])||void 0===i||i.adaptPipelineState(e)},destroy:function(){for(var t,e=st(n);!(t=e()).done;){var i=t.value;null==i||i.destroy()}}}},t}(),hot=function(){function t(t,e,n,i){this._gfxDevice=void 0,this._subMeshMorph=void 0,this._textureInfo=void 0,this._attributes=void 0,this._verticesCount=void 0,this._gfxDevice=i;var r=n.subMeshMorphs[e];this._subMeshMorph=r,pot(t,e,i);var a=t.struct.vertexBundles[t.struct.primitives[e].vertexBundelIndices[0]].view.count;this._verticesCount=a;var o=r.targets.length,s=dot(i,a*o);this._textureInfo={width:s.width,height:s.height},this._attributes=r.attributes.map((function(e,n){var i=s.create(),o=i.valueView;return r.targets.forEach((function(e,i){for(var r=e.displacements[n],s=new Float32Array(t.data.buffer,t.data.byteOffset+r.offset,r.count),c=a*i*4,l=0;l<a;++l)o[c+4*l+0]=s[3*l+0],o[c+4*l+1]=s[3*l+1],o[c+4*l+2]=s[3*l+2]})),i.updatePixels(),{name:e,morphTexture:i}}))}var e=t.prototype;return e.destroy=function(){for(var t,e=st(this._attributes);!(t=e()).done;)t.value.morphTexture.destroy()},e.createInstance=function(){var t=this,e=new fot(this._gfxDevice,this._subMeshMorph.targets.length);return e.setMorphTextureInfo(this._textureInfo.width,this._textureInfo.height),e.setVerticesCount(this._verticesCount),e.commit(),{setWeights:function(t){e.setWeights(t),e.commit()},requiredPatches:function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0}]},adaptPipelineState:function(n){for(var i,r=st(t._attributes);!(i=r()).done;){var a=i.value,o=void 0;switch(a.name){case nr.ATTR_POSITION:o=Lp;break;case nr.ATTR_NORMAL:o=zp;break;case nr.ATTR_TANGENT:o=Gp;break;default:S("Unexpected attribute!")}void 0!==o&&(n.bindSampler(o,a.morphTexture.sampler),n.bindTexture(o,a.morphTexture.texture))}n.bindBuffer(Rp.BINDING,e.buffer),n.update()},destroy:function(){}}},t}(),uot=function(){function t(t,e,n,i){this._gfxDevice=void 0,this._attributes=[],this._gfxDevice=i;var r=n.subMeshMorphs[e];pot(t,e,i),this._attributes=r.attributes.map((function(e,n){return{name:e,targets:r.targets.map((function(e){return{displacements:new Float32Array(t.data.buffer,t.data.byteOffset+e.displacements[n].offset,e.displacements[n].count)}}))}}))}return t.prototype.createInstance=function(){return new _ot(this,this._attributes[0].targets[0].displacements.length/3,this._gfxDevice)},Q(t,[{key:"data",get:function(){return this._attributes}}]),t}(),_ot=function(){function t(t,e,n){this._attributes=void 0,this._owner=void 0,this._morphUniforms=void 0,this._owner=t,this._morphUniforms=new fot(n,0);var i=dot(n,e);this._morphUniforms.setMorphTextureInfo(i.width,i.height),this._morphUniforms.commit(),this._attributes=this._owner.data.map((function(t){var e=i.create();return{attributeName:t.name,morphTexture:e}}))}var e=t.prototype;return e.setWeights=function(t){for(var e=0;e<this._attributes.length;++e){var n=this._attributes[e],i=n.morphTexture.valueView,r=this._owner.data[e];t.length,r.targets.length;for(var a=0;a<r.targets.length;++a){var o=r.targets[a].displacements,s=t[a],c=o.length/3;if(0===a)for(var l=0;l<c;++l)i[4*l+0]=o[3*l+0]*s,i[4*l+1]=o[3*l+1]*s,i[4*l+2]=o[3*l+2]*s;else if(0!==s)for(var h=0;h<c;++h)i[4*h+0]+=o[3*h+0]*s,i[4*h+1]+=o[3*h+1]*s,i[4*h+2]+=o[3*h+2]*s}n.morphTexture.updatePixels()}},e.requiredPatches=function(){return[{name:"CC_MORPH_TARGET_USE_TEXTURE",value:!0},{name:"CC_MORPH_PRECOMPUTED",value:!0}]},e.adaptPipelineState=function(t){for(var e,n=st(this._attributes);!(e=n()).done;){var i=e.value,r=void 0;switch(i.attributeName){case nr.ATTR_POSITION:r=Lp;break;case nr.ATTR_NORMAL:r=zp;break;case nr.ATTR_TANGENT:r=Gp;break;default:S("Unexpected attribute!")}void 0!==r&&(t.bindSampler(r,i.morphTexture.sampler),t.bindTexture(r,i.morphTexture.texture))}t.bindBuffer(Rp.BINDING,this._morphUniforms.buffer),t.update()},e.destroy=function(){this._morphUniforms.destroy();for(var t=0;t<this._attributes.length;++t)this._attributes[t].morphTexture.destroy()},t}(),fot=function(){function t(t,e){this._targetCount=void 0,this._localBuffer=void 0,this._remoteBuffer=void 0,this._targetCount=e,this._localBuffer=new DataView(new ArrayBuffer(Rp.SIZE)),this._remoteBuffer=t.createBuffer(new gr(yi.UNIFORM|yi.TRANSFER_DST,Ai.HOST|Ai.DEVICE,Rp.SIZE,Rp.SIZE))}var e=t.prototype;return e.destroy=function(){this._remoteBuffer.destroy()},e.setWeights=function(t){t.length,this._targetCount;for(var e=0;e<t.length;++e)this._localBuffer.setFloat32(Rp.OFFSET_OF_WEIGHTS+4*e,t[e],h.sys.isLittleEndian)},e.setMorphTextureInfo=function(t,e){this._localBuffer.setFloat32(Rp.OFFSET_OF_DISPLACEMENT_TEXTURE_WIDTH,t,h.sys.isLittleEndian),this._localBuffer.setFloat32(Rp.OFFSET_OF_DISPLACEMENT_TEXTURE_HEIGHT,e,h.sys.isLittleEndian)},e.setVerticesCount=function(t){this._localBuffer.setFloat32(Rp.OFFSET_OF_VERTICES_COUNT,t,h.sys.isLittleEndian)},e.commit=function(){this._remoteBuffer.update(this._localBuffer.buffer)},Q(t,[{key:"buffer",get:function(){return this._remoteBuffer}}]),t}();function dot(t,e){var i,r,o,s;t.getFormatFeatures(mi.RGBA32F)&Ei.SAMPLED_TEXTURE?(i=e,o=16,r=Mv.PixelFormat.RGBA32F,s=Float32Array):(i=4*e,o=4,r=Mv.PixelFormat.RGBA8888,s=Uint8Array);var c=function(t){t<5&&(t=5);var e=n(a(t)),i=e>>1;return{width:1<<(1&e?i+1:i),height:1<<i}}(i),l=c.width,h=c.height;return{width:l,height:h,create:function(){var e=new ArrayBuffer(l*h*o),n=new Float32Array(e),i=s===Float32Array?n:new s(e),a=new lv({width:l,height:h,_data:i,_compressed:!1,format:r}),c=new Mv;c.setFilters(Mv.Filter.NEAREST,Mv.Filter.NEAREST),c.setMipFilter(Mv.Filter.NONE),c.setWrapMode(Mv.WrapMode.CLAMP_TO_EDGE,Mv.WrapMode.CLAMP_TO_EDGE,Mv.WrapMode.CLAMP_TO_EDGE),c.image=a,c.getGFXTexture()||S("Unexpected: failed to create morph texture?");var u=t.getSampler(c.getSamplerInfo());return{get texture(){return c.getGFXTexture()},get sampler(){return u},get valueView(){return n},destroy:function(){c.destroy()},updatePixels:function(){c.uploadData(i)}}}}}function pot(t,e,n){t.renderingSubMeshes[e].enableVertexIdChannel(n)}function mot(t){switch(t){case 1:return Uint8Array;case 2:return Uint16Array;case 4:return Uint32Array;default:return Uint8Array}}var vot=new Mn,got=new Mn,yot=new Uint8Array,xot=Ec("cc.Mesh")((sot=function(t){function e(){var e;return(e=t.call(this)||this).morphRendering=null,ct(e,"_struct",aot,at(e)),ct(e,"_hash",oot,at(e)),e._data=yot,e._initialized=!1,e._renderingSubMeshes=null,e._boneSpaceBounds=new Map,e._jointBufferIndices=null,e}$(e,t);var n=e.prototype;return n.onLoaded=function(){this.initialize()},n.initialize=function(){if(!this._initialized){this._initialized=!0;for(var t=this._data.buffer,e=h.director.root.device,n=this._createVertexBuffers(e,t),i=[],r=0;r<this._struct.primitives.length;r++){var a=this._struct.primitives[r];if(0!==a.vertexBundelIndices.length){var o=null,s=null;if(a.indexView){var c=a.indexView,l=c.stride,u=c.length;if(4===l&&!e.hasFeature(pi.ELEMENT_INDEX_UINT)){var _=this._struct.vertexBundles[a.vertexBundelIndices[0]].view.count;if(_>=65536){R(10001,_,65536);continue}l>>=1,u>>=1}o=e.createBuffer(new gr(yi.INDEX,Ai.DEVICE,u,l)),s=new(mot(c.stride))(t,c.offset,c.count),c.stride!==l&&(s=mot(l).from(s)),o.update(s)}var f=a.vertexBundelIndices.map((function(t){return n[t]})),d=[];if(a.vertexBundelIndices.length>0)for(var p=a.vertexBundelIndices[0],m=this._struct.vertexBundles[p].attributes,v=0;v<m.length;++v){var g=m[v];d[v]=new Br(g.name,g.format,g.isNormalized,g.stream,g.isInstanced,g.location)}var y=new Aw(f,d,a.primitiveMode,o);y.mesh=this,y.subMeshIdx=r,i.push(y)}}this._renderingSubMeshes=i,this._struct.morph&&(this.morphRendering=function(t,e){return new lot(t,e)}(this,e))}},n.destroy=function(){return this.destroyRenderingMesh(),t.prototype.destroy.call(this)},n.destroyRenderingMesh=function(){if(this._renderingSubMeshes){for(var t=0;t<this._renderingSubMeshes.length;t++)this._renderingSubMeshes[t].destroy();this._renderingSubMeshes=null,this._initialized=!1}},n.assign=function(t,e){this.reset({struct:t,data:e})},n.reset=function(t){this.destroyRenderingMesh(),this._struct=t.struct,this._data=t.data,this._hash=0},n.getBoneSpaceBounds=function(t){if(this._boneSpaceBounds.has(t.hash))return this._boneSpaceBounds.get(t.hash);var e=[];this._boneSpaceBounds.set(t.hash,e);for(var n=[],i=t.bindposes,r=0;r<i.length;r++)e.push(new Qs(1/0,1/0,1/0,-1/0,-1/0,-1/0)),n.push(!1);for(var a=this._struct.primitives,o=0;o<a.length;o++){var s=this.readAttribute(o,nr.ATTR_JOINTS),c=this.readAttribute(o,nr.ATTR_WEIGHTS),l=this.readAttribute(o,nr.ATTR_POSITION);if(s&&c&&l)for(var h=Math.min(s.length/4,c.length/4,l.length/3),u=0;u<h;u++){Mn.set(vot,l[3*u+0],l[3*u+1],l[3*u+2]);for(var _=0;_<4;++_){var f=4*u+_,d=s[f];if(!(0===c[f]||d>=i.length)){Mn.transformMat4(got,vot,i[d]),n[d]=!0;var p=e[d];Mn.min(p.center,p.center,got),Mn.max(p.halfExtents,p.halfExtents,got)}}}}for(var m=0;m<i.length;m++){var v=e[m];n[m]?Qs.fromPoints(v,v.center,v.halfExtents):e[m]=null}return e},n.merge=function(t,e,n){if(n&&!this.validateMergingMesh(t))return!1;var i=new Mn,r=e&&new zn,a=e&&new Qs;if(r&&e.getRotation(r),!this._initialized){var o=JSON.parse(JSON.stringify(t._struct)),s=t._data.slice();if(e){o.maxPosition&&o.minPosition&&(Mn.add(a.center,o.maxPosition,o.minPosition),Mn.multiplyScalar(a.center,a.center,.5),Mn.subtract(a.halfExtents,o.maxPosition,o.minPosition),Mn.multiplyScalar(a.halfExtents,a.halfExtents,.5),Qs.transform(a,a,e),Mn.add(o.maxPosition,a.center,a.halfExtents),Mn.subtract(o.minPosition,a.center,a.halfExtents));for(var c=0;c<o.vertexBundles.length;c++)for(var l=o.vertexBundles[c],h=0;h<l.attributes.length;h++)if(l.attributes[h].name===nr.ATTR_POSITION||l.attributes[h].name===nr.ATTR_NORMAL){var u=l.attributes[h].format,_=new DataView(s.buffer,l.view.offset+Sot(l.attributes,h)),f=Cot(_,u),d=Tot(_,u);if(!f||!d)continue;for(var p=l.view.count,m=l.view.stride,v=bot(u),g=0;g<p;g++){var y=g*m,x=y+v,S=x+v;switch(i.set(f(y),f(x),f(S)),l.attributes[h].name){case nr.ATTR_POSITION:i.transformMat4(e);break;case nr.ATTR_NORMAL:Mn.transformQuat(i,i,r)}d(y,i.x),d(x,i.y),d(S,i.z)}}}return this.reset({struct:o,data:s}),this.initialize(),!0}for(var A,b,C,T,E,w=new cot,I=0,P=0,D=0,R=0,M=0,O=0,N=0,B=0,L=!1,F=new Array(this._struct.vertexBundles.length),V=0;V<this._struct.vertexBundles.length;++V){var z=this._struct.vertexBundles[V],k=t._struct.vertexBundles[V];D=z.view.offset,R=k.view.offset,P=z.view.stride,I=z.view.count+k.view.count,A=new ArrayBuffer(I*P),b=new Uint8Array(A),D+=(C=this._data.subarray(D,D+z.view.length)).length,R+=(T=t._data.subarray(R,R+k.view.length)).length,b.set(C),M=0;for(var U,G=st(z.attributes);!(U=G()).done;){var H=U.value;N=0,L=!1;for(var j,W=st(k.attributes);!(j=W()).done;){var q=j.value;if(H.name===q.name&&H.format===q.format){L=!0;break}N+=aa[q.format].size}if(L){B=aa[H.format].size,O=z.view.length+M;for(var X=0;X<k.view.count;++X){if(E=T.subarray(N,N+B),b.set(E,O),(H.name===nr.ATTR_POSITION||H.name===nr.ATTR_NORMAL)&&e){var Y=new Float32Array(b.buffer,O,3);switch(i.set(Y[0],Y[1],Y[2]),H.name){case nr.ATTR_POSITION:i.transformMat4(e);break;case nr.ATTR_NORMAL:Mn.transformQuat(i,i,r)}Y[0]=i.x,Y[1]=i.y,Y[2]=i.z}O+=z.view.stride,N+=k.view.stride}}M+=aa[H.format].size}F[V]={attributes:z.attributes,view:{offset:w.getLength(),length:A.byteLength,count:I,stride:P}},w.addBuffer(A)}for(var K,J,Q,Z=0,$=2,tt=0,et=new Array(this._struct.primitives.length),nt=0;nt<this._struct.primitives.length;++nt){var it=this._struct.primitives[nt],rt=t._struct.primitives[nt];et[nt]={primitiveMode:it.primitiveMode,vertexBundelIndices:it.vertexBundelIndices};for(var at,ot=st(it.vertexBundelIndices);!(at=ot()).done;){var ct=at.value;tt=Math.max(tt,this._struct.vertexBundles[ct].view.count)}if(it.indexView&&rt.indexView){Z=it.indexView.count,Z+=rt.indexView.count,D=it.indexView.offset,R=rt.indexView.offset,$=Z<256?1:Z<65536?2:4;var lt=new ArrayBuffer(Z*$);if(K=2===$?new Uint16Array(lt):1===$?new Uint8Array(lt):new Uint32Array(lt),J=2===it.indexView.stride?new Uint16Array(this._data.buffer,D,it.indexView.count):1===it.indexView.stride?new Uint8Array(this._data.buffer,D,it.indexView.count):new Uint32Array(this._data.buffer,D,it.indexView.count),$===it.indexView.stride)K.set(J);else for(var ht=0;ht<it.indexView.count;++ht)K[ht]=J[ht];D+=it.indexView.length,Q=2===rt.indexView.stride?new Uint16Array(t._data.buffer,R,rt.indexView.count):1===rt.indexView.stride?new Uint8Array(t._data.buffer,R,rt.indexView.count):new Uint32Array(t._data.buffer,R,rt.indexView.count);for(var ut=0;ut<rt.indexView.count;++ut)K[it.indexView.count+ut]=tt+Q[ut];R+=rt.indexView.length,et[nt].indexView={offset:w.getLength(),length:lt.byteLength,count:Z,stride:$},w.setNextAlignment($),w.addBuffer(lt)}}var _t={vertexBundles:F,primitives:et,minPosition:this._struct.minPosition,maxPosition:this._struct.maxPosition};return _t.minPosition&&t._struct.minPosition&&_t.maxPosition&&t._struct.maxPosition&&(e?(Mn.add(a.center,t._struct.maxPosition,t._struct.minPosition),Mn.multiplyScalar(a.center,a.center,.5),Mn.subtract(a.halfExtents,t._struct.maxPosition,t._struct.minPosition),Mn.multiplyScalar(a.halfExtents,a.halfExtents,.5),Qs.transform(a,a,e),Mn.add(i,a.center,a.halfExtents),Mn.max(_t.maxPosition,_t.maxPosition,i),Mn.subtract(i,a.center,a.halfExtents),Mn.min(_t.minPosition,_t.minPosition,i)):(Mn.min(_t.minPosition,_t.minPosition,t._struct.minPosition),Mn.max(_t.maxPosition,_t.maxPosition,t._struct.maxPosition))),this.reset({struct:_t,data:new Uint8Array(w.getCombined())}),this.initialize(),!0},n.validateMergingMesh=function(t){if(this._struct.vertexBundles.length!==t._struct.vertexBundles.length)return!1;for(var e=0;e<this._struct.vertexBundles.length;++e){var n=this._struct.vertexBundles[e],i=t._struct.vertexBundles[e];if(n.attributes.length!==i.attributes.length)return!1;for(var r=0;r<n.attributes.length;++r)if(n.attributes[r].format!==i.attributes[r].format)return!1}if(this._struct.primitives.length!==t._struct.primitives.length)return!1;for(var a=0;a<this._struct.primitives.length;++a){var o=this._struct.primitives[a],s=t._struct.primitives[a];if(o.vertexBundelIndices.length!==s.vertexBundelIndices.length)return!1;for(var c=0;c<o.vertexBundelIndices.length;++c)if(o.vertexBundelIndices[c]!==s.vertexBundelIndices[c])return!1;if(o.primitiveMode!==s.primitiveMode)return!1;if(o.indexView){if(void 0===s.indexView)return!1}else if(s.indexView)return!1}return!0},n.readAttribute=function(t,e){var n=this,i=null;return this._accessAttribute(t,e,(function(t,e){var r=t.view.count,a=t.attributes[e].format,o=da(aa[a]);if(0!==r){var s=new DataView(n._data.buffer,t.view.offset+Sot(t.attributes,e)),c=aa[a],l=Cot(s,a);if(o&&l){for(var h=c.count,u=new o(r*h),_=t.view.stride,f=0;f<r;++f)for(var d=0;d<h;++d)u[h*f+d]=l(_*f+u.BYTES_PER_ELEMENT*d);i=u}}})),i},n.copyAttribute=function(t,e,n,i,r){var a=this,o=!1;return this._accessAttribute(t,e,(function(t,e){var s=t.view.count;if(0!==s){var c=t.attributes[e].format,l=new DataView(a._data.buffer,t.view.offset+Sot(t.attributes,e)),h=new DataView(n,r),u=aa[c],_=Cot(l,c),f=Tot(h,c);if(_&&f){for(var d=u.count,p=t.view.stride,m=bot(c),v=i,g=m,y=0;y<s;++y)for(var x=0;x<d;++x)f(v*y+g*x,_(p*y+m*x));o=!0}}else o=!0})),o},n.readIndices=function(t){if(t>=this._struct.primitives.length)return null;var e=this._struct.primitives[t];if(!e.indexView)return null;var n=e.indexView.stride;return new(1===n?Uint8Array:2===n?Uint16Array:Uint32Array)(this._data.buffer,e.indexView.offset,e.indexView.count)},n.copyIndices=function(t,e){if(t>=this._struct.primitives.length)return!1;var n=this._struct.primitives[t];if(!n.indexView)return!1;for(var i=n.indexView.count,r=1===n.indexView.stride?mi.R8UI:2===n.indexView.stride?mi.R16UI:mi.R32UI,a=Cot(new DataView(this._data.buffer),r),o=0;o<i;++o)e[o]=a(n.indexView.offset+aa[r].size*o);return!0},n._accessAttribute=function(t,e,n){if(!(t>=this._struct.primitives.length))for(var i,r=st(this._struct.primitives[t].vertexBundelIndices);!(i=r()).done;){var a=i.value,o=this._struct.vertexBundles[a],s=o.attributes.findIndex((function(t){return t.name===e}));if(!(s<0)){n(o,s);break}}},n._createVertexBuffers=function(t,e){return this._struct.vertexBundles.map((function(n){var i=t.createBuffer(new gr(yi.VERTEX,Ai.DEVICE,n.view.length,n.view.stride)),r=new Uint8Array(e,n.view.offset,n.view.length);return i.update(r),i}))},n.initDefault=function(e){t.prototype.initDefault.call(this,e),this.reset({struct:{vertexBundles:[],primitives:[]},data:yot})},Q(e,[{key:"_nativeAsset",get:function(){return this._data.buffer},set:function(t){this._data=new Uint8Array(t)}},{key:"subMeshCount",get:function(){var t=this.renderingSubMeshes;return t?t.length:0}},{key:"minPosition",get:function(){return this.struct.minPosition}},{key:"maxPosition",get:function(){return this.struct.maxPosition}},{key:"struct",get:function(){return this._struct}},{key:"data",get:function(){return this._data}},{key:"hash",get:function(){return this._hash||(this._hash=ba(this._data,666)),this._hash}},{key:"jointBufferIndices",get:function(){return this._jointBufferIndices?this._jointBufferIndices:this._jointBufferIndices=this._struct.primitives.map((function(t){return t.jointMapIndex||0}))}},{key:"renderingSubMeshes",get:function(){return this.initialize(),this._renderingSubMeshes}}]),e}($h),aot=lt((rot=sot).prototype,"_struct",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return{vertexBundles:[],primitives:[]}}}),oot=lt(rot.prototype,"_hash",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),iot=rot))||iot;function Sot(t,e){for(var n=0,i=0;i<e;++i){var r=t[i];n+=aa[r.format].size}return n}h.Mesh=xot;var Aot=wu.isLittleEndian;function bot(t){var e=aa[t];return e.size/e.count}function Cot(t,e){var n=aa[e],i=n.size/n.count;switch(n.type){case vi.UNORM:switch(i){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,Aot)};case 4:return function(e){return t.getUint32(e,Aot)}}break;case vi.SNORM:case vi.INT:switch(i){case 1:return function(e){return t.getInt8(e)};case 2:return function(e){return t.getInt16(e,Aot)};case 4:return function(e){return t.getInt32(e,Aot)}}break;case vi.UINT:switch(i){case 1:return function(e){return t.getUint8(e)};case 2:return function(e){return t.getUint16(e,Aot)};case 4:return function(e){return t.getUint32(e,Aot)}}break;case vi.FLOAT:return function(e){return t.getFloat32(e,Aot)}}return null}function Tot(t,e){var n=aa[e],i=n.size/n.count;switch(n.type){case vi.UNORM:switch(i){case 1:return function(e,n){return t.setUint8(e,n)};case 2:return function(e,n){return t.setUint16(e,n,Aot)};case 4:return function(e,n){return t.setUint32(e,n,Aot)}}break;case vi.SNORM:case vi.INT:switch(i){case 1:return function(e,n){return t.setInt8(e,n)};case 2:return function(e,n){return t.setInt16(e,n,Aot)};case 4:return function(e,n){return t.setInt32(e,n,Aot)}}break;case vi.UINT:switch(i){case 1:return function(e,n){return t.setUint8(e,n)};case 2:return function(e,n){return t.setUint16(e,n,Aot)};case 4:return function(e,n){return t.setUint32(e,n,Aot)}}break;case vi.FLOAT:return function(e,n){return t.setFloat32(e,n,Aot)}}return null}var Eot,wot,Iot,Pot,Dot,Rot,Mot,Oot,Not,Bot,Lot,Fot,Vot,zot,kot,Uot,Got,Hot,jot,Wot,qot,Xot,Yot,Kot,Jot,Qot,Zot,$ot,tst,est,nst,ist,rst,ast,ost,sst,cst,lst,hst,ust,_st,fst,dst=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._morphRenderingInstance=null,e._usedMaterials=new Set,e}$(e,t);var n=e.prototype;return n.getMacroPatches=function(e){var n=t.prototype.getMacroPatches.call(this,e);if(this._morphRenderingInstance){var i=this._morphRenderingInstance.requiredPatches(e);if(i)return i.concat(null!=n?n:[])}return n},n.initSubModel=function(e,n,i){return t.prototype.initSubModel.call(this,e,n,this._launderMaterial(i))},n.destroy=function(){t.prototype.destroy.call(this),this._morphRenderingInstance=null},n.setSubModelMaterial=function(e,n){return t.prototype.setSubModelMaterial.call(this,e,this._launderMaterial(n))},n.setMorphRendering=function(t){this._morphRenderingInstance=t},n._updateLocalDescriptors=function(e,n){t.prototype._updateLocalDescriptors.call(this,e,n),this._morphRenderingInstance&&this._morphRenderingInstance.adaptPipelineState(e,n)},n._launderMaterial=function(t){return t},e}(Cy),pst=se({OFF:0,ON:1}),mst=se({OFF:0,ON:1}),vst=(Eot=Ec("cc.ModelLightmapSettings"),wot=Bc("_recieveShadow"),Eot((Lot=function(){function t(){ct(this,"texture",Dot,this),ct(this,"uvParam",Rot,this),ct(this,"_bakeable",Mot,this),ct(this,"_castShadow",Oot,this),ct(this,"_receiveShadow",Not,this),ct(this,"_lightmapSize",Bot,this)}return Q(t,[{key:"bakeable",get:function(){return this._bakeable},set:function(t){this._bakeable=t}},{key:"castShadow",get:function(){return this._castShadow},set:function(t){this._castShadow=t}},{key:"receiveShadow",get:function(){return this._receiveShadow},set:function(t){this._receiveShadow=t}},{key:"lightmapSize",get:function(){return this._lightmapSize},set:function(t){this._lightmapSize=t}}]),t}(),Dot=lt((Pot=Lot).prototype,"texture",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Rot=lt(Pot.prototype,"uvParam",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ei}}),Mot=lt(Pot.prototype,"_bakeable",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Oot=lt(Pot.prototype,"_castShadow",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Not=lt(Pot.prototype,"_receiveShadow",[wot],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Bot=lt(Pot.prototype,"_lightmapSize",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),lt(Pot.prototype,"bakeable",[Wc],Object.getOwnPropertyDescriptor(Pot.prototype,"bakeable"),Pot.prototype),lt(Pot.prototype,"castShadow",[Wc],Object.getOwnPropertyDescriptor(Pot.prototype,"castShadow"),Pot.prototype),lt(Pot.prototype,"receiveShadow",[Wc],Object.getOwnPropertyDescriptor(Pot.prototype,"receiveShadow"),Pot.prototype),lt(Pot.prototype,"lightmapSize",[Wc],Object.getOwnPropertyDescriptor(Pot.prototype,"lightmapSize"),Pot.prototype),Iot=Pot))||Iot),gst=(Fot=Ec("cc.MeshRenderer"),Vot=jc(),zot=Ic(100),kot=kc(),Uot=cl(Be),Got=Kc(),Hot=Dc({group:{name:"DynamicShadowSettings",displayOrder:0}}),jot=cl(Be),Wot=Kc(),qot=Dc({group:{name:"DynamicShadowSettings",displayOrder:1}}),Xot=cl(pst),Yot=Kc(),Kot=Dc({group:{name:"DynamicShadowSettings",displayOrder:2}}),Jot=cl(mst),Qot=Kc(),Zot=Dc({group:{name:"DynamicShadowSettings",displayOrder:3}}),$ot=cl(xot),tst=Kc(),est=qc(),Fot(nst=Vot(nst=zot(nst=kot(nst=zc((_st=ust=function(t){function e(){var e;return ct(e=t.call(this)||this,"lightmapSettings",rst,at(e)),ct(e,"_mesh",ast,at(e)),ct(e,"_shadowCastingMode",ost,at(e)),ct(e,"_shadowReceivingMode",sst,at(e)),ct(e,"_shadowBias",cst,at(e)),ct(e,"_shadowNormalBias",lst,at(e)),e._subMeshShapesWeights=[],e._modelType=void 0,e._model=null,e._morphInstance=null,ct(e,"_enableMorph",hst,at(e)),e._modelType=Cy,e}$(e,t);var n=e.prototype;return n.onLoad=function(){this._mesh&&this._mesh.initialize(),this._validateShapeWeights()||this._initSubMeshShapesWeights(),this._watchMorphInMesh(),this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateShadowBias(),this._updateShadowNormalBias()},n.onRestore=function(){this._updateModels(),this.enabledInHierarchy&&this._attachToScene(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateShadowBias(),this._updateShadowNormalBias()},n.onEnable=function(){this._model||this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow(),this._updateShadowBias(),this._updateShadowNormalBias(),this._onUpdateLocalShadowBias(),this._attachToScene()},n.onDisable=function(){this._model&&this._detachFromScene()},n.onDestroy=function(){this._model&&(h.director.root.destroyModel(this._model),this._model=null,this._models.length=0),this._morphInstance&&this._morphInstance.destroy()},n.getWeight=function(t,e){this._subMeshShapesWeights.length;var n=this._subMeshShapesWeights[t];return n.length,n[e]},n.setWeights=function(t,e){var n=this._subMeshShapesWeights;e>=n.length||n[e].length===t.length&&(n[e]=t.slice(0),this._uploadSubMeshShapesWeights(e))},n.setWeight=function(t,e,n){var i=this._subMeshShapesWeights;if(!(e>=i.length)){var r=i[e];n>=r.length||(r[n]=t,this._uploadSubMeshShapesWeights(e))}},n.setInstancedAttribute=function(t,e){if(this.model)for(var n=this.model.instancedAttributes,i=n.attributes,r=n.views,a=0;a<i.length;a++)if(i[a].name===t){r[a].set(e);break}},n._updateLightmap=function(t,e,n,i,r){this.lightmapSettings.texture=t,this.lightmapSettings.uvParam.x=e,this.lightmapSettings.uvParam.y=n,this.lightmapSettings.uvParam.z=i,this.lightmapSettings.uvParam.w=r,this._onUpdateLightingmap()},n._updateModels=function(){if(this.enabledInHierarchy){var t=this._model;t?(t.destroy(),t.initialize(),t.node=t.transform=this.node):this._createModel(),this._model&&(this._mesh&&this._model.createBoundingShape(this._mesh.struct.minPosition,this._mesh.struct.maxPosition),this._updateModelParams(),this._onUpdateLightingmap(),this._onUpdateLocalShadowBias())}},n._createModel=function(){var t=this._morphInstance&&this._modelType===Cy?dst:this._modelType,e=this._model=h.director.root.createModel(t);e.visFlags=this.visibility,e.node=e.transform=this.node,this._models.length=0,this._models.push(this._model),this._morphInstance&&e instanceof dst&&e.setMorphRendering(this._morphInstance)},n._attachToScene=function(){if(this.node.scene&&this._model){var t=this._getRenderScene();null!==this._model.scene&&this._detachFromScene(),t.addModel(this._model)}},n._detachFromScene=function(){this._model&&this._model.scene&&this._model.scene.removeModel(this._model)},n._updateModelParams=function(){if(this._mesh&&this._model){this.node.hasChangedFlags|=Fy.POSITION,this._model.transform.hasChangedFlags|=Fy.POSITION,this._model.isDynamicBatching=this._isBatchingEnabled();var t=this._mesh?this._mesh.renderingSubMeshes.length:0,e=this._mesh.renderingSubMeshes;if(e)for(var n=0;n<t;++n){var i=this.getRenderMaterial(n);i&&!i.isValid&&(i=null);var r=e[n];r&&this._model.initSubModel(n,r,i||this._getBuiltinMaterial())}this._model.enabled=!0}},n._onUpdateLightingmap=function(){null!==this.model&&this.model.updateLightingmap(this.lightmapSettings.texture,this.lightmapSettings.uvParam),this.setInstancedAttribute("a_lightingMapUVParam",[this.lightmapSettings.uvParam.x,this.lightmapSettings.uvParam.y,this.lightmapSettings.uvParam.z,this.lightmapSettings.uvParam.w])},n._onUpdateLocalShadowBias=function(){null!==this.model&&this.model.updateLocalShadowBias(),this.setInstancedAttribute("a_localShadowBias",[this._shadowBias,this._shadowNormalBias])},n._onMaterialModified=function(t,e){this._model&&this._model.inited&&this._onRebuildPSO(t,e||this._getBuiltinMaterial())},n._onRebuildPSO=function(t,e){this._model&&this._model.inited&&(this._model.isDynamicBatching=this._isBatchingEnabled(),this._model.setSubModelMaterial(t,e),this._onUpdateLightingmap(),this._onUpdateLocalShadowBias())},n._onMeshChanged=function(){},n._clearMaterials=function(){if(this._model)for(var t=this._model.subModels,e=0;e<t.length;++e)this._onMaterialModified(e,null)},n._getBuiltinMaterial=function(){return Uv.get("missing-material")},n._onVisibilityChange=function(t){this._model&&(this._model.visFlags=t)},n._updateShadowBias=function(){this._model&&(this._model.shadowBias=this._shadowBias)},n._updateShadowNormalBias=function(){this._model&&(this._model.shadowNormalBias=this._shadowNormalBias)},n._updateCastShadow=function(){this._model&&(this._shadowCastingMode===pst.OFF?this._model.castShadow=!1:(this._shadowCastingMode,pst.ON,this._shadowCastingMode,this._model.castShadow=!0))},n._updateReceiveShadow=function(){this._model&&(this._shadowReceivingMode===mst.OFF?this._model.receiveShadow=!1:this._model.receiveShadow=!0)},n._isBatchingEnabled=function(){for(var t=0;t<this._materials.length;++t){var e=this._materials[t];if(e)for(var n=0;n<e.passes.length;++n)if(e.passes[n].batchingScheme)return!0}return!1},n._watchMorphInMesh=function(){if(this._morphInstance&&(this._morphInstance.destroy(),this._morphInstance=null),this._enableMorph&&this._mesh&&this._mesh.struct.morph&&this._mesh.morphRendering){this._morphInstance=this._mesh.morphRendering.createInstance();for(var t=this._mesh.struct.primitives.length,e=0;e<t;++e)this._uploadSubMeshShapesWeights(e);this._model&&this._model instanceof dst&&this._model.setMorphRendering(this._morphInstance)}},n._initSubMeshShapesWeights=function(){var t=this._mesh;if(this._subMeshShapesWeights.length=0,t){var e=t.struct.morph;if(e){var n=e.weights;this._subMeshShapesWeights=e.subMeshMorphs.map((function(t){return t?t.weights?t.weights.slice(0):n?(n.length,t.targets.length,n.slice(0)):new Array(t.targets.length).fill(0):[]}))}}},n._validateShapeWeights=function(){var t=this._mesh,e=this._subMeshShapesWeights;if(!t||!t.struct.morph)return 0===e.length;var n=t.struct.morph;return n.subMeshMorphs.length===e.length&&e.every((function(t,e){var i,r,a=t.length;return(null!==(i=null===(r=n.subMeshMorphs[e])||void 0===r?void 0:r.targets.length)&&void 0!==i?i:0)===a}))},n._uploadSubMeshShapesWeights=function(t){var e;null===(e=this._morphInstance)||void 0===e||e.setWeights(t,this._subMeshShapesWeights[t])},Q(e,[{key:"shadowBias",get:function(){return this._shadowBias},set:function(t){this._shadowBias=t,this._updateShadowBias(),this._onUpdateLocalShadowBias()}},{key:"shadowNormalBias",get:function(){return this._shadowNormalBias},set:function(t){this._shadowNormalBias=t,this._updateShadowNormalBias(),this._onUpdateLocalShadowBias()}},{key:"shadowCastingMode",get:function(){return this._shadowCastingMode},set:function(t){this._shadowCastingMode=t,this._updateCastShadow()}},{key:"receiveShadow",get:function(){return this._shadowReceivingMode},set:function(t){this._shadowReceivingMode=t,this._updateReceiveShadow()}},{key:"mesh",get:function(){return this._mesh},set:function(t){var e=this._mesh,n=this._mesh=t;null==n||n.initialize(),this._initSubMeshShapesWeights(),this._watchMorphInMesh(),this._onMeshChanged(e),this._updateModels(),this.enabledInHierarchy&&this._attachToScene(),this._updateCastShadow(),this._updateReceiveShadow()}},{key:"model",get:function(){return this._model}},{key:"enableMorph",get:function(){return this._enableMorph},set:function(t){this._enableMorph=t}}]),e}(jL),ust.ShadowCastingMode=pst,ust.ShadowReceivingMode=mst,rst=lt((ist=_st).prototype,"lightmapSettings",[Nc,Wc,il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new vst}}),ast=lt(ist.prototype,"_mesh",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ost=lt(ist.prototype,"_shadowCastingMode",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return pst.OFF}}),sst=lt(ist.prototype,"_shadowReceivingMode",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return mst.ON}}),cst=lt(ist.prototype,"_shadowBias",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),lst=lt(ist.prototype,"_shadowNormalBias",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),lt(ist.prototype,"shadowBias",[Uot,Got,Hot,il],Object.getOwnPropertyDescriptor(ist.prototype,"shadowBias"),ist.prototype),lt(ist.prototype,"shadowNormalBias",[jot,Wot,qot,il],Object.getOwnPropertyDescriptor(ist.prototype,"shadowNormalBias"),ist.prototype),lt(ist.prototype,"shadowCastingMode",[Xot,Yot,Kot,il],Object.getOwnPropertyDescriptor(ist.prototype,"shadowCastingMode"),ist.prototype),lt(ist.prototype,"receiveShadow",[Jot,Qot,Zot,il],Object.getOwnPropertyDescriptor(ist.prototype,"receiveShadow"),ist.prototype),lt(ist.prototype,"mesh",[$ot,tst],Object.getOwnPropertyDescriptor(ist.prototype,"mesh"),ist.prototype),lt(ist.prototype,"enableMorph",[est,il],Object.getOwnPropertyDescriptor(ist.prototype,"enableMorph"),ist.prototype),hst=lt(ist.prototype,"_enableMorph",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),nst=ist))||nst)||nst)||nst)||nst)||nst);!function(t){t[t.positions=nr.ATTR_POSITION]="positions",t[t.normals=nr.ATTR_NORMAL]="normals",t[t.uvs=nr.ATTR_TEX_COORD]="uvs",t[t.colors=nr.ATTR_COLOR]="colors"}(fst||(fst={}));var yst,xst=[new Br(nr.ATTR_POSITION,mi.RGB32F),new Br(nr.ATTR_NORMAL,mi.RGB32F),new Br(nr.ATTR_TEX_COORD,mi.RG32F),new Br(nr.ATTR_TANGENT,mi.RGBA32F),new Br(nr.ATTR_COLOR,mi.RGBA32F)],Sst=new Mn,Ast=function(){function t(t,e,n){this._id=void 0,this._opts=void 0,this._accumStart=void 0,this._total=0,this._value=0,this._averageValue=0,this._accumValue=0,this._accumSamples=0,this._id=t,this._opts=e,this._accumStart=n}var e=t.prototype;return e.sample=function(t){this._average(this._value,t)},e.human=function(){var t=this._opts,e=t.average,n=t.isInteger,i=e?this._averageValue:this._value;return n?Math.round(i):Math.round(100*i)/100},e.alarm=function(){return this._opts.below&&this._value<this._opts.below||this._opts.over&&this._value>this._opts.over},e._average=function(t,e){if(void 0===e&&(e=0),this._opts.average){this._accumValue+=t,++this._accumSamples;var n=e;n-this._accumStart>=this._opts.average&&(this._averageValue=this._accumValue/this._accumSamples,this._accumValue=0,this._accumStart=n,this._accumSamples=0)}},Q(t,[{key:"value",get:function(){return this._value},set:function(t){this._value=t}}]),t}(),bst=Ec("cc.PerfCounter")(yst=function(t){function e(e,n,i){var r;return(r=t.call(this,e,n,i)||this)._time=void 0,r._time=i,r}$(e,t);var n=e.prototype;return n.start=function(t){void 0===t&&(t=0),this._time=t},n.end=function(t){void 0===t&&(t=0),this._value=t-this._time,this._average(this._value)},n.tick=function(){this.end(),this.start()},n.frame=function(t){var e=t,n=e-this._time;this._total++,n>(this._opts.average||1e3)&&(this._value=1e3*this._total/n,this._total=0,this._time=e,this._average(this._value))},e}(Ast))||yst,Cst="0123456789. ",Tst=500,Est={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,".":10},wst={fps:{desc:"Framerate (FPS)",below:30,average:Tst,isInteger:!0},draws:{desc:"Draw call",isInteger:!0},frame:{desc:"Frame time (ms)",min:0,max:50,average:Tst},instances:{desc:"Instance Count",isInteger:!0},tricount:{desc:"Triangle",isInteger:!0},logic:{desc:"Game Logic (ms)",min:0,max:50,average:Tst,color:"#080"},physics:{desc:"Physics (ms)",min:0,max:50,average:Tst},render:{desc:"Renderer (ms)",min:0,max:50,average:Tst,color:"#f90"},textureMemory:{desc:"GFX Texture Mem(M)"},bufferMemory:{desc:"GFX Buffer Mem(M)"}},Ist=t("Profiler",function(){function t(){this._stats=null,this.id="__Profiler__",this._showFPS=!1,this._rootNode=null,this._device=null,this._swapchain=null,this._pipeline=null,this._meshRenderer=null,this._canvas=null,this._ctx=null,this._texture=null,this._region=new _r,this._canvasArr=[],this._regionArr=[this._region],this.digitsData=null,this.offsetData=null,this.pass=null,this._canvasDone=!1,this._statsDone=!1,this._inited=!1,this._lineHeight=256/(Object.keys(wst).length+1),this._wordHeight=0,this._eachNumWidth=0,this._totalLines=0,this.lastTime=0,this._canvas=document.createElement("canvas"),this._ctx=this._canvas.getContext("2d"),this._canvasArr.push(this._canvas)}var e=t.prototype;return e.reset=function(){this._stats=null,this._showFPS=!1,this._rootNode=null,this._device=null,this._swapchain=null,this._pipeline=null,this._meshRenderer&&this._meshRenderer.destroy(),this._meshRenderer=null,this.digitsData=null,this.offsetData=null,this.pass=null,this._canvasDone=!1,this._statsDone=!1,this._inited=!1,this._lineHeight=256/(Object.keys(wst).length+1),this._wordHeight=0,this._eachNumWidth=0,this._totalLines=0,this.lastTime=0},e.isShowingStats=function(){return this._showFPS},e.hideStats=function(){this._showFPS&&(this._rootNode&&(this._rootNode.active=!1),h.director.off(h.Director.EVENT_BEFORE_UPDATE,this.beforeUpdate,this),h.director.off(h.Director.EVENT_AFTER_UPDATE,this.afterUpdate,this),h.director.off(h.Director.EVENT_BEFORE_PHYSICS,this.beforePhysics,this),h.director.off(h.Director.EVENT_AFTER_PHYSICS,this.afterPhysics,this),h.director.off(h.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),h.director.off(h.Director.EVENT_AFTER_DRAW,this.afterDraw,this),this._showFPS=!1,this._pipeline.profiler=null,h.game.config.showFPS=!1)},e.showStats=function(){if(!this._showFPS){if(!this._device){var t=h.director.root;this._device=t.device,this._swapchain=t.mainWindow.swapchain,this._pipeline=t.pipeline}this.generateCanvas(),this.generateStats(),h.game.once(h.Game.EVENT_ENGINE_INITED,this.generateNode,this),this._rootNode&&(this._rootNode.active=!0),h.director.on(h.Director.EVENT_BEFORE_UPDATE,this.beforeUpdate,this),h.director.on(h.Director.EVENT_AFTER_UPDATE,this.afterUpdate,this),h.director.on(h.Director.EVENT_BEFORE_PHYSICS,this.beforePhysics,this),h.director.on(h.Director.EVENT_AFTER_PHYSICS,this.afterPhysics,this),h.director.on(h.Director.EVENT_BEFORE_DRAW,this.beforeDraw,this),h.director.on(h.Director.EVENT_AFTER_DRAW,this.afterDraw,this),this._showFPS=!0,this._canvasDone=!0,this._statsDone=!0,h.game.config.showFPS=!0}},e.generateCanvas=function(){if(!this._canvasDone){this._ctx&&this._canvas&&(this._canvas.width=256,this._canvas.height=256,this._canvas.style.width=""+this._canvas.width,this._canvas.style.height=""+this._canvas.height,this._ctx.font="23px Arial",this._ctx.textBaseline="top",this._ctx.fillStyle="#fff",this._texture=this._device.createTexture(new br(bi.TEX2D,Ci.SAMPLED|Ci.TRANSFER_DST,mi.RGBA8,256,256)),this._region.texExtent.width=256,this._region.texExtent.height=256)}},e.generateStats=function(){if(!this._statsDone&&this._ctx&&this._canvas){this._stats=null;var t=performance.now();this._ctx.textAlign="left";var e=0;for(var n in wst){var i=wst[n];this._ctx.fillText(i.desc,0,e*this._lineHeight),i.counter=new bst(n,i,t),e++}this._totalLines=e,this._wordHeight=this._totalLines*this._lineHeight/this._canvas.height;for(var r=0;r<Cst.length;++r){var a=this._ctx.measureText(Cst[r]).width;this._eachNumWidth=Math.max(this._eachNumWidth,a)}for(var o=0;o<Cst.length;++o)this._ctx.fillText(Cst[o],o*this._eachNumWidth,this._totalLines*this._lineHeight);this._eachNumWidth/=this._canvas.width,this._stats=wst,this._canvasArr[0]=this._canvas,this._device.copyTexImagesToTexture(this._canvasArr,this._texture,this._regionArr)}},e.generateNode=function(){if(!this._rootNode||!this._rootNode.isValid){this._rootNode=new TE("PROFILER_NODE"),h.game.addPersistRootNode(this._rootNode);var t=new TE("Profiler_Root");t.parent=this._rootNode;for(var e=.4,n=e/this._totalLines,i=e/this._wordHeight,r=n/23,a=this._eachNumWidth*this._canvas.width*r,o=[0,e,0,i,e,0,i,0,0,0,0,0],s=[0,2,1,0,3,2],c=[0,0,-1,0,1,0,-1,0,1,this._wordHeight,-1,0,0,this._wordHeight,-1,0],l=0,u=0;u<this._totalLines;u++)for(var _=0;_<8;_++){o.push(i+_*a,e-u*n,0),o.push(i+(_+1)*a,e-u*n,0),o.push(i+(_+1)*a,e-(u+1)*n,0),o.push(i+_*a,e-(u+1)*n,0),l=4*(8*u+_+1),s.push(0+l,2+l,1+l,0+l,3+l,2+l);var f=8*u+_,d=Math.floor(f/4),p=f-4*d;c.push(0,this._wordHeight,d,p),c.push(this._eachNumWidth,this._wordHeight,d,p),c.push(this._eachNumWidth,1,d,p),c.push(0,1,d,p)}this._meshRenderer=t.addComponent(gst),this._meshRenderer.mesh=function(t,e,n){n=n||{};var i,r=[],a=0,o=[],s=0,c=t.positions.slice();if(c.length>0){if(i=null,t.attributes)for(var l,h=st(t.attributes);!(l=h()).done;){var u=l.value;if(u.name===nr.ATTR_POSITION){i=u;break}}i||(i=xst[0]),r.push(i);var _=aa[i.format];s=Math.max(s,Math.floor(c.length/_.count)),o.push({offset:a,data:c,attribute:i}),a+=_.size}if(t.normals&&t.normals.length>0){if(i=null,t.attributes)for(var f,d=st(t.attributes);!(f=d()).done;){var p=f.value;if(p.name===nr.ATTR_NORMAL){i=p;break}}i||(i=xst[1]);var m=aa[i.format];r.push(i),s=Math.max(s,Math.floor(t.normals.length/m.count)),o.push({offset:a,data:t.normals,attribute:i}),a+=m.size}if(t.uvs&&t.uvs.length>0){if(i=null,t.attributes)for(var v,g=st(t.attributes);!(v=g()).done;){var y=v.value;if(y.name===nr.ATTR_TEX_COORD){i=y;break}}i||(i=xst[2]);var x=aa[i.format];r.push(i),s=Math.max(s,Math.floor(t.uvs.length/x.count)),o.push({offset:a,data:t.uvs,attribute:i}),a+=x.size}if(t.tangents&&t.tangents.length>0){if(i=null,t.attributes)for(var S,A=st(t.attributes);!(S=A()).done;){var b=S.value;if(b.name===nr.ATTR_TANGENT){i=b;break}}i||(i=xst[3]);var C=aa[i.format];r.push(i),s=Math.max(s,Math.floor(t.tangents.length/C.count)),o.push({offset:a,data:t.tangents,attribute:i}),a+=C.size}if(t.colors&&t.colors.length>0){if(i=null,t.attributes)for(var T,E=st(t.attributes);!(T=E()).done;){var w=T.value;if(w.name===nr.ATTR_COLOR){i=w;break}}i||(i=xst[4]);var I=aa[i.format];r.push(i),s=Math.max(s,Math.floor(t.colors.length/I.count)),o.push({offset:a,data:t.colors,attribute:i}),a+=I.size}if(t.customAttributes)for(var P,D=st(t.customAttributes);!(P=D()).done;){var R=P.value,M=aa[R.attr.format];r.push(R.attr),s=Math.max(s,Math.floor(R.values.length/M.count)),o.push({offset:a,data:R.values,attribute:R.attr}),a+=M.size}for(var O=new cot,N=new ArrayBuffer(s*a),B=new DataView(N),L=0,F=o;L<F.length;L++){var V=F[L];vw(B,V.data,V.attribute.format,V.offset,a)}O.setNextAlignment(0);var z={attributes:r,view:{offset:O.getLength(),length:N.byteLength,count:s,stride:a}};O.addBuffer(N);var k=null,U=0;if(t.indices){var G=t.indices;U=G.length,k=new ArrayBuffer(2*U),vw(new DataView(k),G,mi.R16UI)}var H={primitiveMode:t.primitiveMode||Gi.TRIANGLE_LIST,vertexBundelIndices:[0]};k&&(O.setNextAlignment(2),H.indexView={offset:O.getLength(),length:k.byteLength,count:U,stride:2},O.addBuffer(k));var j=t.minPos;if(!j&&n.calculateBounds){j=Mn.set(new Mn,1/0,1/0,1/0);for(var W=0;W<s;++W)Mn.set(Sst,c[3*W+0],c[3*W+1],c[3*W+2]),Mn.min(j,j,Sst)}var q=t.maxPos;if(!q&&n.calculateBounds){q=Mn.set(new Mn,-1/0,-1/0,-1/0);for(var X=0;X<s;++X)Mn.set(Sst,c[3*X+0],c[3*X+1],c[3*X+2]),Mn.max(q,q,Sst)}var Y={vertexBundles:[z],primitives:[H]};return j&&(Y.minPosition=new Mn(j.x,j.y,j.z)),q&&(Y.maxPosition=new Mn(q.x,q.y,q.z)),e||(e=new xot),e.reset({struct:Y,data:new Uint8Array(O.getCombined())}),e}({positions:o,indices:s,colors:c});var m=new vg;m.initialize({effectName:"profiler"});var v=this.pass=m.passes[0],g=v.getBinding("mainTexture"),y=v.getBinding("digits"),x=v.getBinding("offset");v.bindTexture(g,this._texture),this.digitsData=v.blocks[y],this.offsetData=v.blocks[x],this.offsetData[3]=-1,this._meshRenderer.material=m,this._meshRenderer.node.layer=Hd.Enum.PROFILER,this._inited=!0}},e.beforeUpdate=function(){if(this._stats){var t=performance.now();this._stats.frame.counter.start(t),this._stats.logic.counter.start(t)}},e.afterUpdate=function(){if(this._stats){var t=performance.now();h.director.isPaused()?this._stats.frame.counter.start(t):this._stats.logic.counter.end(t)}},e.beforePhysics=function(){if(this._stats){var t=performance.now();this._stats.physics.counter.start(t)}},e.afterPhysics=function(){if(this._stats){var t=performance.now();this._stats.physics.counter.end(t)}},e.beforeDraw=function(){if(this._stats&&this._inited){var t=this._swapchain.surfaceTransform,e=this._device.capabilities.clipSpaceSignY;if(t!==this.offsetData[3]){var n=qn[t],i=-.9*e;this.offsetData[0]=-.9*n[0]+i*n[2],this.offsetData[1]=-.9*n[1]+i*n[3],this.offsetData[2]=this._eachNumWidth,this.offsetData[3]=t}this.pass._setRootBufferDirty(!0),this._meshRenderer.model&&(this._pipeline.profiler=this._meshRenderer.model);var r=performance.now();this._stats.render.counter.start(r)}},e.afterDraw=function(){if(this._stats&&this._inited){var t=performance.now();if(this._stats.frame.counter.end(t),this._stats.fps.counter.frame(t),this._stats.render.counter.end(t),!(t-this.lastTime<Tst)){this.lastTime=t;var e=this._device;this._stats.draws.counter.value=e.numDrawCalls,this._stats.instances.counter.value=e.numInstances,this._stats.bufferMemory.counter.value=e.memoryStatus.bufferSize/1048576,this._stats.textureMemory.counter.value=e.memoryStatus.textureSize/1048576,this._stats.tricount.counter.value=e.numTris;var n=0,i=this.digitsData;for(var r in this._stats){var a=this._stats[r];a.counter.sample(t);for(var o=a.counter.human().toString(),s=7;s>=0;s--){var c=8*n+s,l=o[o.length-(8-s)],h=Est[l];void 0===h&&(h=11),i[c]=h}n++}}}},t}()),Pst=t("profiler",new Ist);h.profiler=Pst;var Dst=new Tr(Pi.POINT,Pi.POINT,Pi.NONE,Di.CLAMP,Di.CLAMP,Di.CLAMP),Rst=function(t,e,n){t[e+0]=n.m00,t[e+1]=n.m01,t[e+2]=n.m02,t[e+3]=n.m12,t[e+4]=n.m04,t[e+5]=n.m05,t[e+6]=n.m06,t[e+7]=n.m13,t[e+8]=n.m08,t[e+9]=n.m09,t[e+10]=n.m10,t[e+11]=n.m14};function Mst(t,e){var n=4/Math.sqrt(e);return 12*Math.ceil(Math.max(480*n,t)/12)}new zn,new zn,new Mn,new zn,new Mn;var Ost=new Mn,Nst=new Mn,Bst=new Mn,Lst=new Mn,Fst=new Xn,Vst=new Xn,zst=new Qs,kst=Number.MAX_SAFE_INTEGER,Ust=function(){function t(t){this._device=void 0,this._pool=void 0,this._textureBuffers=new Map,this._formatSize=void 0,this._pixelsPerJoint=void 0,this._customPool=void 0,this._chunkIdxMap=new Map,this._device=t;var e=function(t){return t.getFormatFeatures(mi.RGBA32F)&Ei.SAMPLED_TEXTURE?mi.RGBA32F:mi.RGBA8}(this._device);this._formatSize=aa[e].size,this._pixelsPerJoint=48/this._formatSize,this._pool=new ox(t),this._pool.initialize({format:e,roundUpFn:Mst}),this._customPool=new ox(t),this._customPool.initialize({format:e,roundUpFn:Mst})}var e=t.prototype;return e.clear=function(){this._pool.destroy(),this._textureBuffers.clear()},e.registerCustomTextureLayouts=function(t){for(var e=0;e<t.length;e++)for(var n=t[e],i=this._customPool.createChunk(n.textureLength),r=0;r<n.contents.length;r++){var a=n.contents[r],o=a.skeleton;this._chunkIdxMap.set(o,i);for(var s=0;s<a.clips.length;s++){var c=a.clips[s];this._chunkIdxMap.set(o^c,i)}}},e.getDefaultPoseTexture=function(t,e,n){var i=0^t.hash,r=this._textureBuffers.get(i)||null;if(r&&r.bounds.has(e.hash))return r.refCount++,r;var a=t.joints,o=t.bindposes,s=null,c=!1,l=a.length;if(r)r.refCount++;else{var h=12*l,u=this._chunkIdxMap.get(i),_=void 0!==u?this._customPool.alloc(h*Float32Array.BYTES_PER_ELEMENT,u):this._pool.alloc(h*Float32Array.BYTES_PER_ELEMENT);if(!_)return r;r={pixelOffset:_.start/this._formatSize,refCount:1,bounds:new Map,skeletonHash:t.hash,clipHash:0,readyToBeDeleted:!1,handle:_},s=new Float32Array(h),c=!0}Mn.set(Bst,kst,kst,kst),Mn.set(Lst,-kst,-kst,-kst);for(var f=e.getBoneSpaceBounds(t),d=0,p=0;d<l;d++,p+=12){var m=n.getChildByPath(a[d]),v=m?o4(m,n,Fst):t.inverseBindposes[d],g=f[d];g&&(Qs.transform(zst,g,v),zst.getBoundary(Ost,Nst),Mn.min(Bst,Bst,Ost),Mn.max(Lst,Lst,Nst)),c&&(m&&Xn.multiply(v,v,o[d]),Rst(s,p,m?v:Xn.IDENTITY))}var y=[new Qs];return r.bounds.set(e.hash,y),Qs.fromPoints(y[0],Bst,Lst),c&&(this._pool.update(r.handle,s.buffer),this._textureBuffers.set(i,r)),r},e.getSequencePoseTexture=function(t,e,n,i){var r=t.hash^e.hash,a=this._textureBuffers.get(r)||null;if(a&&a.bounds.has(n.hash))return a.refCount++,a;var o=t.joints,s=t.bindposes,c=UQ.getOrExtract(e).frames,l=null,h=!1,u=o.length;if(a)a.refCount++;else{var _=12*u*c,f=this._chunkIdxMap.get(r),d=void 0!==f?this._customPool.alloc(_*Float32Array.BYTES_PER_ELEMENT,f):this._pool.alloc(_*Float32Array.BYTES_PER_ELEMENT);if(!d)return null;var p=this._createAnimInfos(t,e,i);a={pixelOffset:d.start/this._formatSize,refCount:1,bounds:new Map,skeletonHash:t.hash,clipHash:e.hash,readyToBeDeleted:!1,handle:d,animInfos:p},l=new Float32Array(_),h=!0}var m=n.getBoneSpaceBounds(t),v=[];a.bounds.set(n.hash,v);for(var g=0;g<c;g++)v.push(new Qs(kst,kst,kst,-kst,-kst,-kst));for(var y=0,x=0;y<c;y++){for(var S=v[y],A=0;A<u;A++,x+=12){var b=a.animInfos[A],C=b.curveData,T=b.downstream,E=b.bindposeIdx,w=b.bindposeCorrection,I=void 0,P=!0;C&&T?I=Xn.multiply(Fst,C[y],T):C?I=C[y]:T?I=T:(I=t.inverseBindposes[E],P=!1);var D=m[A];if(D){var R=w?Xn.multiply(Vst,I,w):I;Qs.transform(zst,D,R),zst.getBoundary(Ost,Nst),Mn.min(S.center,S.center,Ost),Mn.max(S.halfExtents,S.halfExtents,Nst)}h&&(P&&Xn.multiply(Fst,I,s[E]),Rst(l,x,P?Fst:Xn.IDENTITY))}Qs.fromPoints(S,S.center,S.halfExtents)}return h&&(this._pool.update(a.handle,l.buffer),this._textureBuffers.set(r,a)),a},e.releaseHandle=function(t){if(t.refCount>0&&t.refCount--,!t.refCount&&t.readyToBeDeleted){var e=t.skeletonHash^t.clipHash;(void 0!==this._chunkIdxMap.get(e)?this._customPool:this._pool).free(t.handle),this._textureBuffers.get(e)===t&&this._textureBuffers.delete(e)}},e.releaseSkeleton=function(t){for(var e=this._textureBuffers.values(),n=e.next();!n.done;){var i=n.value;i.skeletonHash===t.hash&&(i.readyToBeDeleted=!0,i.refCount?this._textureBuffers.delete(i.skeletonHash^i.clipHash):this.releaseHandle(i)),n=e.next()}},e.releaseAnimationClip=function(t){for(var e=this._textureBuffers.values(),n=e.next();!n.done;){var i=n.value;i.clipHash===t.hash&&(i.readyToBeDeleted=!0,i.refCount?this._textureBuffers.delete(i.skeletonHash^i.clipHash):this.releaseHandle(i)),n=e.next()}},e._createAnimInfos=function(t,e,n){for(var i=[],r=t.joints,a=t.bindposes,o=r.length,s=UQ.getOrExtract(e),c=0;c<o;c++){for(var l=r[c],h=s.joints[l],u=n.getChildByPath(l),_=void 0,f=void 0;!h;){var d=l.lastIndexOf("/");if(l=l.substring(0,d),h=s.joints[l],u?(_||(_=new Xn),Xn.fromRTS(Fst,u.rotation,u.position,u.scale),Xn.multiply(_,Fst,_),u=u.parent):f=l,d<0)break}var p=c,m=void 0;if(void 0!==f&&h){p=c-1;for(var v=0;v<o;v++)if(r[v]===f){p=v,m=new Xn,Xn.multiply(m,a[v],t.inverseBindposes[c]);break}}i.push({curveData:h&&h.transforms,downstream:_,bindposeIdx:p,bindposeCorrection:m})}return i},Q(t,[{key:"pixelsPerJoint",get:function(){return this._pixelsPerJoint}}]),t}(),Gst=function(){function t(t){this._pool=new Map,this._device=void 0,this._device=t}var e=t.prototype;return e.getData=function(t){void 0===t&&(t="-1");var e=this._pool.get(t);if(e)return e;var n=this._device.createBuffer(new gr(yi.UNIFORM|yi.TRANSFER_DST,Ai.HOST|Ai.DEVICE,Ip.SIZE,Ip.SIZE)),i=new Float32Array([0,0,0,0]);n.update(i);var r={buffer:n,data:i,dirty:!1,currentClip:null};return this._setAnimInfoDirty(r,!1),this._pool.set(t,r),r},e.destroy=function(t){var e=this._pool.get(t);e&&(e.buffer.destroy(),this._pool.delete(t))},e._setAnimInfoDirty=function(t,e){t.dirty=e},e.switchClip=function(t,e){return t.currentClip=e,t.data[0]=-1,t.buffer.update(t.data),this._setAnimInfoDirty(t,!1),t},e.clear=function(){for(var t,e=st(this._pool.values());!(t=e()).done;)t.value.buffer.destroy();this._pool.clear()},t}(),Hst=function(){function t(t){this.jointTexturePool=void 0,this.jointAnimationInfo=void 0,this.jointTexturePool=new Ust(t),this.jointAnimationInfo=new Gst(t)}var e=t.prototype;return e.releaseSkeleton=function(t){this.jointTexturePool.releaseSkeleton(t)},e.releaseAnimationClip=function(t){this.jointTexturePool.releaseAnimationClip(t)},e.clear=function(){this.jointTexturePool.clear(),this.jointAnimationInfo.clear()},t}();h.internal.DataPoolManager=Hst;var jst,Wst,qst,Xst,Yst,Kst,Jst,Qst,Zst,$st=new Xn,tct=new Xn,ect=t("SkeletalAnimationState",function(t){function e(e,n){var i;return void 0===n&&(n=""),(i=t.call(this,e,n)||this)._frames=1,i._bakedDuration=0,i._animInfo=null,i._sockets=[],i._animInfoMgr=void 0,i._parent=null,i._curvesInited=!1,i._animInfoMgr=h.director.root.dataPoolManager.jointAnimationInfo,i}$(e,t);var n=e.prototype;return n.initialize=function(e){if(!this._curveLoaded){this._parent=e.getComponent("cc.SkeletalAnimation");var n=this._parent.useBakedAnimation;this._doNotCreateEval=n,t.prototype.initialize.call(this,e),this._curvesInited=!n;var i=UQ.getOrExtract(this.clip),r=i.frames,a=i.samples;this._frames=r-1,this._animInfo=this._animInfoMgr.getData(e.uuid),this._bakedDuration=this._frames/a,this.setUseBaked(n)}},n.setUseBaked=function(e){e?(this._sampleCurves=this._sampleCurvesBaked,this.duration=this._bakedDuration):(this._sampleCurves=t.prototype._sampleCurves,this.duration=this.clip.duration,this._curvesInited||(this._curveLoaded=!1,t.prototype.initialize.call(this,this._targetNode),this._curvesInited=!0))},n.rebuildSocketCurves=function(t){if(this._sockets.length=0,this._targetNode)for(var e=this._targetNode,n=0;n<t.length;++n){var i=t[n],r=e.getChildByPath(i.path);if(i.target){for(var a=UQ.getOrExtract(this.clip),o=i.path,s=a.joints[o],c=r,l=void 0;!s;){var h=o.lastIndexOf("/");if(o=o.substring(0,h),s=a.joints[o],c&&(l||(l=Xn.identity(tct)),Xn.fromRTS($st,c.rotation,c.position,c.scale),Xn.multiply(l,$st,l),c=c.parent),h<0)break}for(var u=s&&s.transforms,_=a.frames,f=[],d=0;d<_;d++){var p;p=u&&l?Xn.multiply($st,u[d],l):u?u[d]:l||new Xn;var m={pos:new Mn,rot:new zn,scale:new Mn};Xn.toRTS(p,m.rot,m.pos,m.scale),f.push(m)}this._sockets.push({target:i.target,frames:f})}}},n._setAnimInfoDirty=function(t,e){t.dirty=e},n._sampleCurvesBaked=function(t){var e=t/this.duration,n=this._animInfo,i=this.clip;n.currentClip!==i&&(this._animInfoMgr.switchClip(this._animInfo,i),this._parent.getUsers().forEach((function(t){t.uploadAnimation(i)})));var r=e*this._frames+.5|0;if(r!==n.data[0]){n.data[0]=r,this._setAnimInfoDirty(n,!0);for(var a=0;a<this._sockets.length;++a){var o=this._sockets[a],s=o.target,c=o.frames[r],l=c.pos,h=c.rot,u=c.scale;s.setRTS(h,l,u)}}},e}(B$)),nct=(jst=Ec("cc.Skeleton"),Wst=cl([Fe]),qst=cl([Xn]),jst((Zst=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_joints",Kst,at(e)),ct(e,"_bindposes",Jst,at(e)),ct(e,"_hash",Qst,at(e)),e._invBindposes=null,e}$(e,t);var n=e.prototype;return n.destroy=function(){var e,n;return null===(e=null===(n=h.director.root)||void 0===n?void 0:n.dataPoolManager)||void 0===e||e.releaseSkeleton(this),t.prototype.destroy.call(this)},n.validate=function(){return this.joints.length>0&&this.bindposes.length>0},Q(e,[{key:"joints",get:function(){return this._joints},set:function(t){this._joints=t}},{key:"bindposes",get:function(){return this._bindposes},set:function(t){this._bindposes=t}},{key:"inverseBindposes",get:function(){if(!this._invBindposes){this._invBindposes=[];for(var t=0;t<this._bindposes.length;t++){var e=new Xn;Xn.invert(e,this._bindposes[t]),this._invBindposes.push(e)}}return this._invBindposes}},{key:"hash",get:function(){if(!this._hash){for(var t="",e=0;e<this._bindposes.length;e++){var n=this._bindposes[e];t+=n.m00.toPrecision(2)+" "+n.m01.toPrecision(2)+" "+n.m02.toPrecision(2)+" "+n.m03.toPrecision(2)+" "+n.m04.toPrecision(2)+" "+n.m05.toPrecision(2)+" "+n.m06.toPrecision(2)+" "+n.m07.toPrecision(2)+" "+n.m08.toPrecision(2)+" "+n.m09.toPrecision(2)+" "+n.m10.toPrecision(2)+" "+n.m11.toPrecision(2)+" "+n.m12.toPrecision(2)+" "+n.m13.toPrecision(2)+" "+n.m14.toPrecision(2)+" "+n.m15.toPrecision(2)+"\n"}this._hash=ba(t,666)}return this._hash}}]),e}($h),Kst=lt((Yst=Zst).prototype,"_joints",[Wst],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Jst=lt(Yst.prototype,"_bindposes",[qst],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Qst=lt(Yst.prototype,"_hash",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xst=Yst))||Xst);h.Skeleton=nct;var ict=[{name:"CC_USE_SKINNING",value:!0}];function rct(t,e,n,i){for(var r=0;r<n.length;r++){for(var a=n[r],o=-1,s=0;s<a.length;s++)if(a[s]===i){o=s;break}o>=0&&(e.push(r),t.push(o))}}var act,oct,sct,cct,lct,hct,uct,_ct,fct,dct,pct,mct,vct,gct,yct,xct,Sct,Act,bct,Cct,Tct,Ect,wct,Ict,Pct,Dct,Rct,Mct,Oct,Nct,Bct,Lct,Fct,Vct,zct,kct,Uct,Gct,Hct,jct,Wct,qct,Xct,Yct,Kct,Jct,Qct,Zct,$ct,tlt,elt,nlt,ilt,rlt,alt,olt,slt,clt,llt,hlt,ult,_lt,flt,dlt,plt,mlt=new Mn,vlt=new Mn,glt=new Mn,ylt=new Mn,xlt=new Xn,Slt=new Qs,Alt=function(t){function e(){var e;return(e=t.call(this)||this)._buffers=[],e._dataArray=[],e._joints=[],e._bufferIndices=null,e.type=uy.SKINNING,e}$(e,t);var n=e.prototype;return n._init=function(){},n.destroy=function(){if(this.bindSkeleton(),this._buffers.length){for(var e=0;e<this._buffers.length;e++)this._buffers[e].destroy();this._buffers.length=0}t.prototype.destroy.call(this)},n.uploadAnimation=function(){},n.bindSkeleton=function(t,e,n){void 0===t&&(t=null),void 0===e&&(e=null),void 0===n&&(n=null);for(var i=0;i<this._joints.length;i++)N2(this._joints[i].target);if(this._bufferIndices=null,this._joints.length=0,t&&e&&n){this.transform=e;var r=n.getBoneSpaceBounds(t),a=n.struct.jointMaps;this._ensureEnoughBuffers(a&&a.length||1),this._bufferIndices=n.jointBufferIndices;for(var o=0;o<t.joints.length;o++){var s=r[o],c=e.getChildByPath(t.joints[o]);if(s&&c){var l=O2(c,e),h=t.bindposes[o],u=[],_=[];a?rct(u,_,a,o):(u.push(o),_.push(0)),this._joints.push({indices:u,buffers:_,bound:s,target:c,bindpose:h,transform:l})}}}},n.updateTransform=function(t){var e=this.transform;(e.hasChangedFlags||e._dirtyFlags)&&(e.updateWorldTransform(),this._localDataUpdated=!0),Mn.set(mlt,1/0,1/0,1/0),Mn.set(vlt,-1/0,-1/0,-1/0);for(var n=0;n<this._joints.length;n++){var i=this._joints[n],r=i.bound,a=M2(i.transform,t);Qs.transform(Slt,r,a),Slt.getBoundary(glt,ylt),Mn.min(mlt,mlt,glt),Mn.max(vlt,vlt,ylt)}var o=this._worldBounds;this._modelBounds&&o&&(Qs.fromPoints(this._modelBounds,mlt,vlt),this._modelBounds.transform(e._mat,e._pos,e._rot,e._scale,this._worldBounds),this._updateNativeBounds())},n.updateUBOs=function(e){t.prototype.updateUBOs.call(this,e);for(var n=0;n<this._joints.length;n++){var i=this._joints[n],r=i.indices,a=i.buffers,o=i.transform,s=i.bindpose;Xn.multiply(xlt,o.world,s);for(var c=0;c<a.length;c++)Rst(this._dataArray[a[c]],12*r[c],xlt)}for(var l=0;l<this._buffers.length;l++)this._buffers[l].update(this._dataArray[l]);return!0},n.initSubModel=function(e,n,i){var r=n.vertexBuffers,a=n.iaInfo;a.vertexBuffers=n.jointMappedBuffers,t.prototype.initSubModel.call(this,e,n,i),a.vertexBuffers=r},n.getMacroPatches=function(e){var n=t.prototype.getMacroPatches.call(this,e);return n?ict.concat(n):ict},n._updateLocalDescriptors=function(e,n){t.prototype._updateLocalDescriptors.call(this,e,n);var i=this._buffers[this._bufferIndices[e]];i&&n.bindBuffer(Dp.BINDING,i)},n._updateInstancedAttributes=function(e,n){n.batchingScheme!==Fv.NONE&&R(3936,this.node.getPathInHierarchy()),t.prototype._updateInstancedAttributes.call(this,e,n)},n._ensureEnoughBuffers=function(t){for(var e=0;e<t;e++)this._buffers[e]||(this._buffers[e]=this._device.createBuffer(new gr(yi.UNIFORM|yi.TRANSFER_DST,Ai.HOST|Ai.DEVICE,Dp.SIZE,Dp.SIZE))),this._dataArray[e]||(this._dataArray[e]=new Float32Array(Dp.COUNT))},e}(dst),blt=[{name:"CC_USE_SKINNING",value:!0},{name:"CC_USE_BAKED_ANIMATION",value:!0}],Clt=function(t){function e(){var e;(e=t.call(this)||this).uploadedAnim=void 0,e._jointsMedium=void 0,e._skeleton=null,e._mesh=null,e._dataPoolManager=void 0,e._instAnimInfoIdx=-1,e.type=uy.BAKED_SKINNING,e._dataPoolManager=h.director.root.dataPoolManager;var n=new Float32Array(4),i=e._dataPoolManager.jointAnimationInfo.getData();return e._jointsMedium={buffer:null,jointTextureInfo:n,animInfo:i,texture:null,boundsInfo:null},e}$(e,t);var n=e.prototype;return n._init=function(){},n.destroy=function(){this.uploadedAnim=void 0,this._jointsMedium.boundsInfo=null,this._jointsMedium.buffer&&(this._jointsMedium.buffer.destroy(),this._jointsMedium.buffer=null),this._applyJointTexture(),this._applyNativeJointMedium(),t.prototype.destroy.call(this)},n.bindSkeleton=function(t,e,n){if(void 0===t&&(t=null),void 0===e&&(e=null),void 0===n&&(n=null),this._skeleton=t,this._mesh=n,t&&e&&n){this.transform=e;var i=this._dataPoolManager;this._jointsMedium.animInfo=i.jointAnimationInfo.getData(e.uuid),this._jointsMedium.buffer||(this._jointsMedium.buffer=this._device.createBuffer(new gr(yi.UNIFORM|yi.TRANSFER_DST,Ai.DEVICE,wp.SIZE,wp.SIZE)))}},n.updateTransform=function(e){if(t.prototype.updateTransform.call(this,e),this.uploadedAnim){var n=this._jointsMedium,i=n.animInfo,r=n.boundsInfo[i.data[0]],a=this._worldBounds;if(a&&r){var o=this.transform;r.transform(o._mat,o._pos,o._rot,o._scale,a)}}},n.updateUBOs=function(e){t.prototype.updateUBOs.call(this,e);var n=this._jointsMedium.animInfo,i=this._instAnimInfoIdx;return i>=0?this.instancedAttributes.views[i][0]=n.data[0]:n.dirty&&(n.buffer.update(n.data),n.dirty=!1),!0},n.getMacroPatches=function(e){var n=t.prototype.getMacroPatches.call(this,e);return n?n.concat(blt):blt},n.uploadAnimation=function(t){if(this._skeleton&&this._mesh&&this.uploadedAnim!==t){this.uploadedAnim=t;var e=this._dataPoolManager,n=null;t?(n=e.jointTexturePool.getSequencePoseTexture(this._skeleton,t,this._mesh,this.transform),this._jointsMedium.boundsInfo=n&&n.bounds.get(this._mesh.hash),this._updateModelBounds(null)):(n=e.jointTexturePool.getDefaultPoseTexture(this._skeleton,this._mesh,this.transform),this._jointsMedium.boundsInfo=null,this._updateModelBounds(n&&n.bounds.get(this._mesh.hash)[0])),this._applyJointTexture(n),this._applyNativeJointMedium()}},n._applyNativeJointMedium=function(){},n._updateModelBounds=function(t){this._modelBounds=t},n._applyJointTexture=function(t){void 0===t&&(t=null);var e=this._jointsMedium.texture;if(e&&e!==t&&this._dataPoolManager.jointTexturePool.releaseHandle(e),this._jointsMedium.texture=t,t){var n=this._jointsMedium,i=n.buffer,r=n.jointTextureInfo;r[0]=t.handle.texture.width,r[1]=this._skeleton.joints.length,r[2]=t.pixelOffset+.1,r[3]=1/r[0],this.updateInstancedJointTextureInfo(),i&&i.update(r);for(var a=t.handle.texture,o=0;o<this._subModels.length;++o)this._subModels[o].descriptorSet.bindTexture(Op,a)}},n._updateLocalDescriptors=function(e,n){t.prototype._updateLocalDescriptors.call(this,e,n);var i=this._jointsMedium,r=i.buffer,a=i.texture,o=i.animInfo;if(n.bindBuffer(wp.BINDING,r),n.bindBuffer(Ip.BINDING,o.buffer),a){var s=this._device.getSampler(Dst);n.bindTexture(Op,a.handle.texture),n.bindSampler(Op,s)}},n._updateInstancedAttributes=function(e,n){t.prototype._updateInstancedAttributes.call(this,e,n),this._setInstAnimInfoIdx(this._getInstancedAttributeIndex(Pp)),this.updateInstancedJointTextureInfo()},n._setInstAnimInfoIdx=function(t){this._instAnimInfoIdx=t},n.updateInstancedJointTextureInfo=function(){var t=this._jointsMedium,e=t.jointTextureInfo,n=t.animInfo,i=this._instAnimInfoIdx;if(i>=0){var r=this.instancedAttributes.views[i];r[0]=n.data[0],r[1]=e[1],r[2]=e[2]}},e}(dst),Tlt=(act=Ec("cc.SkinnedMeshRenderer"),oct=jc(),sct=Ic(100),cct=kc(),lct=cl(nct),hct=cl(TE),uct=cl(nct),_ct=cl(TE),fct=Kc(),act(dct=oct(dct=sct(dct=zc(dct=cct((gct=function(t){function e(){var e;return ct(e=t.call(this)||this,"_skeleton",mct,at(e)),ct(e,"_skinningRoot",vct,at(e)),e._clip=null,e.associatedAnimation=null,e._modelType=Clt,e}$(e,t);var n=e.prototype;return n.onLoad=function(){t.prototype.onLoad.call(this),this._tryBindAnimation()},n.onDestroy=function(){this.associatedAnimation&&(this.associatedAnimation.notifySkinnedMeshRemoved(this),this.associatedAnimation),t.prototype.onDestroy.call(this)},n.uploadAnimation=function(t){this._clip=t,this.model&&this.model.uploadAnimation&&this.model.uploadAnimation(t)},n.setUseBakedAnimation=function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!1);var n=t?Clt:Alt;(e||this._modelType!==n)&&(this._modelType=n,this._model&&(h.director.root.destroyModel(this._model),this._model=null,this._models.length=0,this._updateModels(),this._updateCastShadow(),this._updateReceiveShadow(),this.enabledInHierarchy&&this._attachToScene()))},n.setMaterial=function(e,n){t.prototype.setMaterial.call(this,e,n),this._modelType===Alt&&this.getMaterialInstance(n)},n._updateModelParams=function(){this._update(),t.prototype._updateModelParams.call(this)},n._tryBindAnimation=function(){var t=this._skinningRoot;if(t){for(var e=!1,n=this.node;n;n=n.parent)if(n===t){e=!0;break}if(e){var i=t.getComponent("cc.SkeletalAnimation");i?i.notifySkinnedMeshAdded(this):this.setUseBakedAnimation(!1)}}},n._update=function(){this.model&&(this.model.bindSkeleton(this._skeleton,this._skinningRoot,this._mesh),this.model.uploadAnimation&&this.model.uploadAnimation(this._clip))},Q(e,[{key:"skeleton",get:function(){return this._skeleton},set:function(t){t!==this._skeleton&&(this._skeleton=t,this._update())}},{key:"skinningRoot",get:function(){return this._skinningRoot},set:function(t){this._skinningRoot=t,this._tryBindAnimation(),t!==this._skinningRoot&&this._update()}},{key:"model",get:function(){return this._model}}]),e}(gst),mct=lt((pct=gct).prototype,"_skeleton",[lct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vct=lt(pct.prototype,"_skinningRoot",[hct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lt(pct.prototype,"skeleton",[uct],Object.getOwnPropertyDescriptor(pct.prototype,"skeleton"),pct.prototype),lt(pct.prototype,"skinningRoot",[_ct,fct],Object.getOwnPropertyDescriptor(pct.prototype,"skinningRoot"),pct.prototype),dct=pct))||dct)||dct)||dct)||dct)||dct),Elt=new Br(nr.ATTR_BATCH_ID,mi.R32F),wlt=new Br(nr.ATTR_BATCH_UV,mi.RG32F),Ilt=aa[Elt.format].size+aa[wlt.format].size,Plt=(yct=Ec("cc.SkinnedMeshUnit"),xct=cl(xot),Sct=cl(nct),Act=cl(vg),bct=cl(Tlt),yct((Mct=function(){function t(){ct(this,"mesh",Ect,this),ct(this,"skeleton",wct,this),ct(this,"material",Ict,this),ct(this,"_localTransform",Pct,this),ct(this,"_offset",Dct,this),ct(this,"_size",Rct,this)}return Q(t,[{key:"offset",get:function(){return this._offset},set:function(t){Qn.copy(this._offset,t)}},{key:"size",get:function(){return this._size},set:function(t){Qn.copy(this._size,t)}},{key:"copyFrom",get:function(){return null},set:function(t){t&&(this.mesh=t.mesh,this.skeleton=t.skeleton,this.material=t.getMaterial(0),t.skinningRoot&&o4(t.node,t.skinningRoot,this._localTransform))}}]),t}(),Ect=lt((Tct=Mct).prototype,"mesh",[xct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wct=lt(Tct.prototype,"skeleton",[Sct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ict=lt(Tct.prototype,"material",[Act],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pct=lt(Tct.prototype,"_localTransform",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Xn}}),Dct=lt(Tct.prototype,"_offset",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn(0,0)}}),Rct=lt(Tct.prototype,"_size",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Qn(1,1)}}),lt(Tct.prototype,"offset",[Wc],Object.getOwnPropertyDescriptor(Tct.prototype,"offset"),Tct.prototype),lt(Tct.prototype,"size",[Wc],Object.getOwnPropertyDescriptor(Tct.prototype,"size"),Tct.prototype),lt(Tct.prototype,"copyFrom",[bct],Object.getOwnPropertyDescriptor(Tct.prototype,"copyFrom"),Tct.prototype),Cct=Tct))||Cct),Dlt=new Xn,Rlt=(new Xn,new Mn),Mlt=(Oct=Ec("cc.SkinnedMeshBatchRenderer"),Nct=jc(),Bct=Ic(100),Lct=kc(),Fct=Kc(),Vct=cl([Fe]),zct=Kc(),kct=cl([Plt]),Uct=Kc(),Gct=qc(),Hct=qc(),Oct(jct=Nct(jct=Bct(jct=zc(jct=Lct((Kct=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"atlasSize",qct,at(e)),ct(e,"batchableTextureNames",Xct,at(e)),ct(e,"units",Yct,at(e)),e._textures={},e._batchMaterial=null,e}$(e,t);var n=e.prototype;return n.onLoad=function(){t.prototype.onLoad.call(this),this.cook()},n.onDestroy=function(){for(var e in this._textures)this._textures[e].destroy();this._textures={},this._mesh&&(this._mesh.destroy(),this._mesh=null),t.prototype.onDestroy.call(this)},n._onMaterialModified=function(e){this.cookMaterials(),t.prototype._onMaterialModified.call(this,e,this.getMaterialInstance(e))},n.cook=function(){this.cookMaterials(),this.cookSkeletons(),this.cookMeshes()},n.cookMaterials=function(){var t=this;this._batchMaterial||(this._batchMaterial=this.getMaterial(0));var e=this.getMaterialInstance(0);if(e&&this._batchMaterial&&this._batchMaterial.effectAsset){e.copy(this._batchMaterial),this.resizeAtlases();for(var n=e.effectAsset.techniques[e.technique],i=function(i){var r=n.passes[i];if(!r.properties)return"continue";var a=function(n){if(r.properties[n].type>=gi.SAMPLER1D){var a=null;t.batchableTextureNames.find((function(t){return t===n}))?((a=t._textures[n])||(a=t.createTexture(n)),t.cookTextures(a,n,i)):t.units.some((function(t){return a=t.material&&t.material.getProperty(n,i)})),a&&e.setProperty(n,a,i)}else{for(var o=[],s=0;s<t.units.length;s++){var c=t.units[s];c.material&&o.push(c.material.getProperty(n.slice(0,-3),i))}e.setProperty(n,o,i)}};for(var o in r.properties)a(o)},r=0;r<n.passes.length;r++)i(r)}else console.warn("incomplete batch material!")},n.cookSkeletons=function(){if(this._skinningRoot){for(var t=[],e=[],n=0;n<this.units.length;n++){var i=this.units[n];if(i&&i.skeleton){var r=i.skeleton;Xn.invert(Dlt,i._localTransform);for(var a=function(n){var i=r.joints[n];if(t.findIndex((function(t){return t===i}))>=0)return"continue";t.push(i),e.push(Xn.multiply(new Xn,r.bindposes[n]||Xn.IDENTITY,Dlt))},o=0;o<r.joints.length;o++)a(o)}}var s=Array.from(Array(t.length).keys()).sort((function(e,n){return t[e]>t[n]?1:t[e]<t[n]?-1:0})),c=new nct;c.joints=t.map((function(t,e,n){return n[s[e]]})),c.bindposes=e.map((function(t,e,n){return n[s[e]]})),this._skeleton&&this._skeleton.destroy(),this.skeleton=c}else console.warn("no skinning root specified!")},n.cookMeshes=function(){for(var t=this,e=!1,n=0;n<this.units.length;n++)if(this.units[n].mesh){e=!0;break}if(e&&this._skinningRoot){this._mesh?this._mesh.destroyRenderingMesh():this._mesh=new xot;for(var i=0,r=mi.UNKNOWN,a=0,o=mi.UNKNOWN,s=0,c=mi.UNKNOWN,l=0,h=mi.UNKNOWN,u=0,_=mi.UNKNOWN,f=new Array(this.units.length),d=this.units.length,p=0;p<d;p++){var m=this.units[p];m&&m.skeleton&&(f[p]=m.skeleton.joints.map((function(e){return t._skeleton.joints.findIndex((function(t){return e===t}))})))}for(var v=function(e){var n=t.units[e];if(!n||!n.mesh||!n.mesh.data)return"continue";var d=t._createUnitMesh(e,n.mesh),p=new DataView(d.data.buffer);Xn.inverseTranspose(Dlt,n._localTransform);for(var m=n.offset,v=n.size,g=function(t){var g=d.struct.vertexBundles[t];i=g.view.offset,r=mi.UNKNOWN;for(var y=0;y<g.attributes.length;y++){var x=g.attributes[y];if(x.name===nr.ATTR_POSITION){r=x.format;break}i+=aa[x.format].size}if(r){for(var S=gw(p,r,i,g.view.length,g.view.stride),A=0;A<S.length;A+=3)Mn.fromArray(Rlt,S,A),Mn.transformMat4(Rlt,Rlt,n._localTransform),Mn.toArray(S,Rlt,A);vw(p,S,r,i,g.view.stride)}a=g.view.offset,o=mi.UNKNOWN;for(var b=0;b<g.attributes.length;b++){var C=g.attributes[b];if(C.name===nr.ATTR_NORMAL){o=C.format;break}a+=aa[C.format].size}if(o){for(var T=gw(p,o,a,g.view.length,g.view.stride),E=0;E<T.length;E+=3)Mn.fromArray(Rlt,T,E),Mn.transformMat4Normal(Rlt,Rlt,Dlt),Mn.toArray(T,Rlt,E);vw(p,T,o,a,g.view.stride)}s=g.view.offset,c=mi.UNKNOWN;for(var w=0;w<g.attributes.length;w++){var I=g.attributes[w];if(I.name===nr.ATTR_TANGENT){c=I.format;break}s+=aa[I.format].size}if(c){for(var P=gw(p,c,s,g.view.length,g.view.stride),D=0;D<P.length;D+=3)Mn.fromArray(Rlt,P,D),Mn.transformMat4Normal(Rlt,Rlt,Dlt),Mn.toArray(P,Rlt,D);vw(p,P,c,s,g.view.stride)}l=g.view.offset,h=mi.UNKNOWN;for(var R=0;R<g.attributes.length;R++){var M=g.attributes[R];if(M.name===nr.ATTR_BATCH_UV){h=M.format;break}l+=aa[M.format].size}h&&yw(p,(function(t,e){var n,i=0===e?"x":"y";return(t=(n=t)-Math.floor(n))*v[i]+m[i]}),h,l,g.view.length,g.view.stride,p);var O=f[e];if(!O)return"continue";u=g.view.offset,_=mi.UNKNOWN;for(var N=0;N<g.attributes.length;N++){var B=g.attributes[N];if(B.name===nr.ATTR_JOINTS){_=B.format;break}u+=aa[B.format].size}_&&yw(p,(function(t){return O[t]}),_,u,g.view.length,g.view.stride,p)},y=0;y<d.struct.vertexBundles.length;y++)g(y);t._mesh.merge(d)},g=0;g<d;g++)v(g);this._onMeshChanged(this._mesh),this._updateModels()}},n.cookTextures=function(t,e,n){for(var i=[],r=[],a=[],o=[],s=0;s<this.units.length;s++){var c=this.units[s];if(c.material){var l=c.material.getProperty(e,n);if(l&&l.image&&l.image.data){var u=new _r;u.texOffset.x=c.offset.x*this.atlasSize,u.texOffset.y=c.offset.y*this.atlasSize,u.texExtent.width=c.size.x*this.atlasSize,u.texExtent.height=c.size.y*this.atlasSize;var _=l.image.data;ArrayBuffer.isView(_)?(a.push(_),o.push(u)):(i.push(_),r.push(u))}}}var f=t.getGFXTexture(),d=h.director.root.device;a.length>0&&d.copyBuffersToTexture(a,f,o),i.length>0&&d.copyTexImagesToTexture(i,f,r)},n.createTexture=function(t){var e=new Mv;return e.setFilters(Gm.LINEAR,Gm.LINEAR),e.setMipFilter(Gm.NEAREST),e.reset({width:this.atlasSize,height:this.atlasSize,format:km.RGBA8888}),this._textures[t]=e,e},n.resizeAtlases=function(){for(var t in this._textures)this._textures[t].reset({width:this.atlasSize,height:this.atlasSize,format:km.RGBA8888})},n._createUnitMesh=function(t,e){for(var n=JSON.parse(JSON.stringify(e.struct)),i={},r=0;r<e.struct.primitives.length;r++){for(var a=e.struct.primitives[r],o=0,s=mi.UNKNOWN,c=0;c<a.vertexBundelIndices.length;c++){var l=e.struct.vertexBundles[a.vertexBundelIndices[c]];o=l.view.offset,s=mi.UNKNOWN;for(var u=0;u<l.attributes.length;u++){var _=l.attributes[u];if(_.name===nr.ATTR_TEX_COORD){s=_.format;break}o+=aa[_.format].size}if(s)break}if(void 0===i[c]){i[c]=[s,o];var f=n.vertexBundles[c];f.attributes.push(Elt),f.attributes.push(wlt),f.view.offset=0,f.view.length+=f.view.count*Ilt,f.view.stride+=Ilt}}for(var d=0,p=0;p<n.vertexBundles.length;p++)d+=n.vertexBundles[p].view.length;for(var m=0;m<n.primitives.length;m++){var v=n.primitives[m];v.indexView&&(v.indexView.offset=d,d+=v.indexView.length)}var g=new Uint8Array(d),y=e.data,x=new DataView(g.buffer),S=new DataView(y.buffer),A=h.sys.isLittleEndian;for(var b in i)for(var C=n.vertexBundles[b],T=e.struct.vertexBundles[b],E=i[b],w=gw(S,E[0],E[1],T.view.length,T.view.stride),I=T.view,P=C.view,D=I.stride,R=P.stride,M=I.offset,O=P.offset,N=0;N<P.count;N++){var B=y.subarray(M,M+D);g.set(B,O),x.setFloat32(O+D,t),x.setFloat32(O+D+4,w[2*N],A),x.setFloat32(O+D+8,w[2*N+1],A),O+=R,M+=D}for(var L=0;L<n.primitives.length;L++){var F=e.struct.primitives[L],V=n.primitives[L];if(F.indexView&&V.indexView)for(var z=F.indexView.stride,k=V.indexView.stride,U=F.indexView.offset,G=V.indexView.offset,H=0;H<V.indexView.count;H++){var j=y.subarray(U,U+z);g.set(j,G),G+=k,U+=z}}var W=new xot;return W.reset({struct:n,data:g}),W},Q(e,[{key:"mesh",get:function(){return t.prototype.mesh},set:function(t){this.mesh=t}},{key:"skeleton",get:function(){return t.prototype.skeleton},set:function(t){this.skeleton=t}}]),e}(Tlt),qct=lt((Wct=Kct).prototype,"atlasSize",[Nc,Fct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1024}}),Xct=lt(Wct.prototype,"batchableTextureNames",[Vct,Nc,zct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Yct=lt(Wct.prototype,"units",[kct,Nc,Uct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lt(Wct.prototype,"mesh",[hl,Gct],Object.getOwnPropertyDescriptor(Wct.prototype,"mesh"),Wct.prototype),lt(Wct.prototype,"skeleton",[hl,Hct],Object.getOwnPropertyDescriptor(Wct.prototype,"skeleton"),Wct.prototype),jct=Wct))||jct)||jct)||jct)||jct)||jct);h.SkinningModelComponent=Tlt,re.setClassAlias(Tlt,"cc.SkinningModelComponent"),h.SkinningModelUnit=Plt,re.setClassAlias(Plt,"cc.SkinningModelUnit"),h.BatchedSkinningModelComponent=Mlt,re.setClassAlias(Mlt,"cc.BatchedSkinningModelComponent");var Olt=t("Socket",(Jct=Ec("cc.SkeletalAnimation.Socket"),Qct=cl(TE),Jct((tlt=lt(($ct=function(t,e){void 0===t&&(t=""),void 0===e&&(e=null),ct(this,"path",tlt,this),ct(this,"target",elt,this),this.path=t,this.target=e}).prototype,"path",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),elt=lt($ct.prototype,"target",[Qct],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zct=$ct))||Zct));re.setClassAlias(Olt,"cc.SkeletalAnimationComponent.Socket");var Nlt=new Xn,Blt=new Xn;function Llt(t,e,n){void 0===e&&(e=""),void 0===n&&(n=[]);for(var i=0;i<t.children.length;i++){var r=t.children[i];if(r){var a=e?e+"/"+r.name:r.name;n.push(a),Llt(r,a,n)}}return n}var Flt=function(e){return t({SkeletalAnimation:e,SkeletalAnimationComponent:e}),e}((nlt=Ec("cc.SkeletalAnimation"),ilt=jc(),rlt=Ic(99),alt=kc(),olt=cl([Olt]),slt=Kc(),clt=Kc(),llt=cl([Olt]),nlt(hlt=ilt(hlt=rlt(hlt=zc(hlt=alt((plt=dlt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_useBakedAnimation",_lt,at(e)),ct(e,"_sockets",flt,at(e)),e._users=new Set,e._currentBakedState=null,e}$(e,t);var n=e.prototype;return n.onLoad=function(){t.prototype.onLoad.call(this);for(var e=this.node.getComponentsInChildren(Tlt),n=0;n<e.length;++n){var i=e[n];i.skinningRoot===this.node&&this.notifySkinnedMeshAdded(i)}},n.onDestroy=function(){t.prototype.onDestroy.call(this),h.director.root.dataPoolManager.jointAnimationInfo.destroy(this.node.uuid),g$().removeSockets(this.node,this._sockets),this._removeAllUsers()},n.start=function(){this.sockets=this._sockets,this.useBakedAnimation=this._useBakedAnimation,t.prototype.start.call(this)},n.pause=function(){var e;this._useBakedAnimation?null===(e=this._currentBakedState)||void 0===e||e.pause():t.prototype.pause.call(this)},n.resume=function(){var e;this._useBakedAnimation?null===(e=this._currentBakedState)||void 0===e||e.resume():t.prototype.resume.call(this)},n.stop=function(){this._useBakedAnimation?this._currentBakedState&&(this._currentBakedState.stop(),this._currentBakedState=null):t.prototype.stop.call(this)},n.querySockets=function(){var t=this._defaultClip&&Object.keys(UQ.getOrExtract(this._defaultClip).joints).sort().reduce((function(t,e){return e.startsWith(t[t.length-1])||t.push(e),t}),[])||[];if(!t.length)return["please specify a valid default animation clip first"];for(var e=[],n=0;n<t.length;n++){var i=t[n],r=this.node.getChildByPath(i);r&&(e.push(i),Llt(r,i,e))}return e},n.rebuildSocketAnimations=function(){for(var t,e=st(this._sockets);!(t=e()).done;){var n=t.value,i=this.node.getChildByPath(n.path),r=n.target;i&&r&&(r.name=n.path.substring(n.path.lastIndexOf("/")+1)+" Socket",r.parent=this.node,o4(i,this.node,Nlt),Xn.fromRTS(Blt,r.rotation,r.position,r.scale),Xn.equals(Blt,Nlt)||(r.matrix=Nlt))}for(var a=0,o=Object.keys(this._nameToState);a<o.length;a++){var s=o[a];this._nameToState[s].rebuildSocketCurves(this._sockets)}},n.createSocket=function(t){var e=this._sockets.find((function(e){return e.path===t}));if(e)return e.target;if(!this.node.getChildByPath(t))return console.warn("illegal socket path"),null;var n=new TE;return n.parent=this.node,this._sockets.push(new Olt(t,n)),this.rebuildSocketAnimations(),n},n.notifySkinnedMeshAdded=function(t){var e=this._useBakedAnimation,n=t.associatedAnimation;if(n&&n._users.delete(t),t.associatedAnimation=this,t.setUseBakedAnimation(e,!0),e){var i=this._currentBakedState;i&&t.uploadAnimation(i.clip)}this._users.add(t)},n.notifySkinnedMeshRemoved=function(t){t.associatedAnimation===this||t.associatedAnimation,t.setUseBakedAnimation(!1),t.associatedAnimation=null,this._users.delete(t)},n.getUsers=function(){return this._users},n._createState=function(t,e){return new ect(t,e)},n._doCreateState=function(e,n){var i=t.prototype._doCreateState.call(this,e,n);return i.rebuildSocketCurves(this._sockets),i},n.doPlayOrCrossFade=function(e,n){if(this._useBakedAnimation){this._currentBakedState&&this._currentBakedState.stop();var i=e;this._currentBakedState=i,i.play()}else t.prototype.doPlayOrCrossFade.call(this,e,n)},n._removeAllUsers=function(){var t=this;Array.from(this._users).forEach((function(e){t.notifySkinnedMeshRemoved(e)}))},Q(e,[{key:"sockets",get:function(){return this._sockets},set:function(t){if(!this._useBakedAnimation){var e=g$();e.removeSockets(this.node,this._sockets),e.addSockets(this.node,t)}this._sockets=t,this.rebuildSocketAnimations()}},{key:"useBakedAnimation",get:function(){return this._useBakedAnimation},set:function(t){for(var e in this._useBakedAnimation=t,this._nameToState)this._nameToState[e].setUseBaked(t);this._users.forEach((function(e){e.setUseBakedAnimation(t)})),this._useBakedAnimation?g$().removeSockets(this.node,this._sockets):(g$().addSockets(this.node,this._sockets),this._currentBakedState=null)}}]),e}(t4),dlt.Socket=Olt,lt((ult=plt).prototype,"sockets",[olt,slt],Object.getOwnPropertyDescriptor(ult.prototype,"sockets"),ult.prototype),lt(ult.prototype,"useBakedAnimation",[clt],Object.getOwnPropertyDescriptor(ult.prototype,"useBakedAnimation"),ult.prototype),_lt=lt(ult.prototype,"_useBakedAnimation",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),flt=lt(ult.prototype,"_sockets",[llt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),hlt=ult))||hlt)||hlt)||hlt)||hlt)||hlt));h.SkeletalAnimationComponent=Flt,re.setClassAlias(Flt,"cc.SkeletalAnimationComponent");var Vlt,zlt,klt=(Vlt=function(t,e){return(Vlt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)},function(t,e){function n(){this.constructor=t}Vlt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)});!function(t){var e,n,i,r=function(){function t(t,e,n){if(null==t)throw new Error("name cannot be null.");if(null==e)throw new Error("timelines cannot be null.");this.name=t,this.timelines=e,this.timelineIds=[];for(var i=0;i<e.length;i++)this.timelineIds[e[i].getPropertyId()]=!0;this.duration=n}return t.prototype.hasTimeline=function(t){return 1==this.timelineIds[t]},t.prototype.apply=function(t,e,n,i,r,a,o,s){if(null==t)throw new Error("skeleton cannot be null.");i&&0!=this.duration&&(n%=this.duration,e>0&&(e%=this.duration));for(var c=this.timelines,l=0,h=c.length;l<h;l++)c[l].apply(t,e,n,r,a,o,s)},t.binarySearch=function(t,e,n){void 0===n&&(n=1);var i=0,r=t.length/n-2;if(0==r)return n;for(var a=r>>>1;;){if(t[(a+1)*n]<=e?i=a+1:r=a,i==r)return(i+1)*n;a=i+r>>>1}},t.linearSearch=function(t,e,n){for(var i=0,r=t.length-n;i<=r;i+=n)if(t[i]>e)return i;return-1},t}();t.Animation=r,function(t){t[t.setup=0]="setup",t[t.first=1]="first",t[t.replace=2]="replace",t[t.add=3]="add"}(e=t.MixBlend||(t.MixBlend={})),function(t){t[t.mixIn=0]="mixIn",t[t.mixOut=1]="mixOut"}(n=t.MixDirection||(t.MixDirection={})),function(t){t[t.rotate=0]="rotate",t[t.translate=1]="translate",t[t.scale=2]="scale",t[t.shear=3]="shear",t[t.attachment=4]="attachment",t[t.color=5]="color",t[t.deform=6]="deform",t[t.event=7]="event",t[t.drawOrder=8]="drawOrder",t[t.ikConstraint=9]="ikConstraint",t[t.transformConstraint=10]="transformConstraint",t[t.pathConstraintPosition=11]="pathConstraintPosition",t[t.pathConstraintSpacing=12]="pathConstraintSpacing",t[t.pathConstraintMix=13]="pathConstraintMix",t[t.twoColor=14]="twoColor"}(i=t.TimelineType||(t.TimelineType={}));var a=function(){function e(n){if(n<=0)throw new Error("frameCount must be > 0: "+n);this.curves=t.Utils.newFloatArray((n-1)*e.BEZIER_SIZE)}return e.prototype.getFrameCount=function(){return this.curves.length/e.BEZIER_SIZE+1},e.prototype.setLinear=function(t){this.curves[t*e.BEZIER_SIZE]=e.LINEAR},e.prototype.setStepped=function(t){this.curves[t*e.BEZIER_SIZE]=e.STEPPED},e.prototype.getCurveType=function(t){var n=t*e.BEZIER_SIZE;if(n==this.curves.length)return e.LINEAR;var i=this.curves[n];return i==e.LINEAR?e.LINEAR:i==e.STEPPED?e.STEPPED:e.BEZIER},e.prototype.setCurve=function(t,n,i,r,a){var o=.03*(2*-n+r),s=.03*(2*-i+a),c=.006*(3*(n-r)+1),l=.006*(3*(i-a)+1),h=2*o+c,u=2*s+l,_=.3*n+o+.16666667*c,f=.3*i+s+.16666667*l,d=t*e.BEZIER_SIZE,p=this.curves;p[d++]=e.BEZIER;for(var m=_,v=f,g=d+e.BEZIER_SIZE-1;d<g;d+=2)p[d]=m,p[d+1]=v,_+=h,f+=u,h+=c,u+=l,m+=_,v+=f},e.prototype.getCurvePercent=function(n,i){i=t.MathUtils.clamp(i,0,1);var r=this.curves,a=n*e.BEZIER_SIZE,o=r[a];if(o==e.LINEAR)return i;if(o==e.STEPPED)return 0;for(var s=0,c=++a,l=a+e.BEZIER_SIZE-1;a<l;a+=2)if((s=r[a])>=i){var h=void 0,u=void 0;return a==c?(h=0,u=0):(h=r[a-2],u=r[a-1]),u+(r[a+1]-u)*(i-h)/(s-h)}var _=r[a-1];return _+(1-_)*(i-s)/(1-s)},e.LINEAR=0,e.STEPPED=1,e.BEZIER=2,e.BEZIER_SIZE=19,e}();t.CurveTimeline=a;var o=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e<<1),i}return klt(a,n),a.prototype.getPropertyId=function(){return(i.rotate<<24)+this.boneIndex},a.prototype.setFrame=function(t,e,n){t<<=1,this.frames[t]=e,this.frames[t+a.ROTATION]=n},a.prototype.apply=function(t,n,i,o,s,c){var l=this.frames,h=t.bones[this.boneIndex];if(h.active)if(i<l[0])switch(c){case e.setup:return void(h.rotation=h.data.rotation);case e.first:var u=h.data.rotation-h.rotation;h.rotation+=(u-360*(16384-(16384.499999999996-u/360|0)))*s}else if(i>=l[l.length-a.ENTRIES]){var _=l[l.length+a.PREV_ROTATION];switch(c){case e.setup:h.rotation=h.data.rotation+_*s;break;case e.first:case e.replace:_+=h.data.rotation-h.rotation,_-=360*(16384-(16384.499999999996-_/360|0));case e.add:h.rotation+=_*s}}else{var f=r.binarySearch(l,i,a.ENTRIES),d=l[f+a.PREV_ROTATION],p=l[f],m=this.getCurvePercent((f>>1)-1,1-(i-p)/(l[f+a.PREV_TIME]-p)),v=l[f+a.ROTATION]-d;switch(v=d+(v-360*(16384-(16384.499999999996-v/360|0)))*m,c){case e.setup:h.rotation=h.data.rotation+(v-360*(16384-(16384.499999999996-v/360|0)))*s;break;case e.first:case e.replace:v+=h.data.rotation-h.rotation;case e.add:h.rotation+=(v-360*(16384-(16384.499999999996-v/360|0)))*s}}},a.ENTRIES=2,a.PREV_TIME=-2,a.PREV_ROTATION=-1,a.ROTATION=1,a}(a);t.RotateTimeline=o;var s=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return klt(a,n),a.prototype.getPropertyId=function(){return(i.translate<<24)+this.boneIndex},a.prototype.setFrame=function(t,e,n,i){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.X]=n,this.frames[t+a.Y]=i},a.prototype.apply=function(t,n,i,o,s,c){var l=this.frames,h=t.bones[this.boneIndex];if(h.active)if(i<l[0])switch(c){case e.setup:return h.x=h.data.x,void(h.y=h.data.y);case e.first:h.x+=(h.data.x-h.x)*s,h.y+=(h.data.y-h.y)*s}else{var u=0,_=0;if(i>=l[l.length-a.ENTRIES])u=l[l.length+a.PREV_X],_=l[l.length+a.PREV_Y];else{var f=r.binarySearch(l,i,a.ENTRIES);u=l[f+a.PREV_X],_=l[f+a.PREV_Y];var d=l[f],p=this.getCurvePercent(f/a.ENTRIES-1,1-(i-d)/(l[f+a.PREV_TIME]-d));u+=(l[f+a.X]-u)*p,_+=(l[f+a.Y]-_)*p}switch(c){case e.setup:h.x=h.data.x+u*s,h.y=h.data.y+_*s;break;case e.first:case e.replace:h.x+=(h.data.x+u-h.x)*s,h.y+=(h.data.y+_-h.y)*s;break;case e.add:h.x+=u*s,h.y+=_*s}}},a.ENTRIES=3,a.PREV_TIME=-3,a.PREV_X=-2,a.PREV_Y=-1,a.X=1,a.Y=2,a}(a);t.TranslateTimeline=s;var c=function(a){function o(t){return a.call(this,t)||this}return klt(o,a),o.prototype.getPropertyId=function(){return(i.scale<<24)+this.boneIndex},o.prototype.apply=function(i,a,s,c,l,h,u){var _=this.frames,f=i.bones[this.boneIndex];if(f.active)if(s<_[0])switch(h){case e.setup:return f.scaleX=f.data.scaleX,void(f.scaleY=f.data.scaleY);case e.first:f.scaleX+=(f.data.scaleX-f.scaleX)*l,f.scaleY+=(f.data.scaleY-f.scaleY)*l}else{var d=0,p=0;if(s>=_[_.length-o.ENTRIES])d=_[_.length+o.PREV_X]*f.data.scaleX,p=_[_.length+o.PREV_Y]*f.data.scaleY;else{var m=r.binarySearch(_,s,o.ENTRIES);d=_[m+o.PREV_X],p=_[m+o.PREV_Y];var v=_[m],g=this.getCurvePercent(m/o.ENTRIES-1,1-(s-v)/(_[m+o.PREV_TIME]-v));d=(d+(_[m+o.X]-d)*g)*f.data.scaleX,p=(p+(_[m+o.Y]-p)*g)*f.data.scaleY}if(1==l)h==e.add?(f.scaleX+=d-f.data.scaleX,f.scaleY+=p-f.data.scaleY):(f.scaleX=d,f.scaleY=p);else{var y=0,x=0;if(u==n.mixOut)switch(h){case e.setup:y=f.data.scaleX,x=f.data.scaleY,f.scaleX=y+(Math.abs(d)*t.MathUtils.signum(y)-y)*l,f.scaleY=x+(Math.abs(p)*t.MathUtils.signum(x)-x)*l;break;case e.first:case e.replace:y=f.scaleX,x=f.scaleY,f.scaleX=y+(Math.abs(d)*t.MathUtils.signum(y)-y)*l,f.scaleY=x+(Math.abs(p)*t.MathUtils.signum(x)-x)*l;break;case e.add:y=f.scaleX,x=f.scaleY,f.scaleX=y+(Math.abs(d)*t.MathUtils.signum(y)-f.data.scaleX)*l,f.scaleY=x+(Math.abs(p)*t.MathUtils.signum(x)-f.data.scaleY)*l}else switch(h){case e.setup:y=Math.abs(f.data.scaleX)*t.MathUtils.signum(d),x=Math.abs(f.data.scaleY)*t.MathUtils.signum(p),f.scaleX=y+(d-y)*l,f.scaleY=x+(p-x)*l;break;case e.first:case e.replace:y=Math.abs(f.scaleX)*t.MathUtils.signum(d),x=Math.abs(f.scaleY)*t.MathUtils.signum(p),f.scaleX=y+(d-y)*l,f.scaleY=x+(p-x)*l;break;case e.add:y=t.MathUtils.signum(d),x=t.MathUtils.signum(p),f.scaleX=Math.abs(f.scaleX)*y+(d-Math.abs(f.data.scaleX)*y)*l,f.scaleY=Math.abs(f.scaleY)*x+(p-Math.abs(f.data.scaleY)*x)*l}}}},o}(s);t.ScaleTimeline=c;var l=function(t){function n(e){return t.call(this,e)||this}return klt(n,t),n.prototype.getPropertyId=function(){return(i.shear<<24)+this.boneIndex},n.prototype.apply=function(t,i,a,o,s,c){var l=this.frames,h=t.bones[this.boneIndex];if(h.active)if(a<l[0])switch(c){case e.setup:return h.shearX=h.data.shearX,void(h.shearY=h.data.shearY);case e.first:h.shearX+=(h.data.shearX-h.shearX)*s,h.shearY+=(h.data.shearY-h.shearY)*s}else{var u=0,_=0;if(a>=l[l.length-n.ENTRIES])u=l[l.length+n.PREV_X],_=l[l.length+n.PREV_Y];else{var f=r.binarySearch(l,a,n.ENTRIES);u=l[f+n.PREV_X],_=l[f+n.PREV_Y];var d=l[f],p=this.getCurvePercent(f/n.ENTRIES-1,1-(a-d)/(l[f+n.PREV_TIME]-d));u+=(l[f+n.X]-u)*p,_+=(l[f+n.Y]-_)*p}switch(c){case e.setup:h.shearX=h.data.shearX+u*s,h.shearY=h.data.shearY+_*s;break;case e.first:case e.replace:h.shearX+=(h.data.shearX+u-h.shearX)*s,h.shearY+=(h.data.shearY+_-h.shearY)*s;break;case e.add:h.shearX+=u*s,h.shearY+=_*s}}},n}(s);t.ShearTimeline=l;var h=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return klt(a,n),a.prototype.getPropertyId=function(){return(i.color<<24)+this.slotIndex},a.prototype.setFrame=function(t,e,n,i,r,o){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.R]=n,this.frames[t+a.G]=i,this.frames[t+a.B]=r,this.frames[t+a.A]=o},a.prototype.apply=function(t,n,i,o,s,c){var l=t.slots[this.slotIndex];if(l.bone.active){var h=this.frames;if(i<h[0])switch(c){case e.setup:return void l.color.setFromColor(l.data.color);case e.first:var u=l.color,_=l.data.color;u.add((_.r-u.r)*s,(_.g-u.g)*s,(_.b-u.b)*s,(_.a-u.a)*s)}else{var f=0,d=0,p=0,m=0;if(i>=h[h.length-a.ENTRIES]){var v=h.length;f=h[v+a.PREV_R],d=h[v+a.PREV_G],p=h[v+a.PREV_B],m=h[v+a.PREV_A]}else{var g=r.binarySearch(h,i,a.ENTRIES);f=h[g+a.PREV_R],d=h[g+a.PREV_G],p=h[g+a.PREV_B],m=h[g+a.PREV_A];var y=h[g],x=this.getCurvePercent(g/a.ENTRIES-1,1-(i-y)/(h[g+a.PREV_TIME]-y));f+=(h[g+a.R]-f)*x,d+=(h[g+a.G]-d)*x,p+=(h[g+a.B]-p)*x,m+=(h[g+a.A]-m)*x}1==s?l.color.set(f,d,p,m):(u=l.color,c==e.setup&&u.setFromColor(l.data.color),u.add((f-u.r)*s,(d-u.g)*s,(p-u.b)*s,(m-u.a)*s))}}},a.ENTRIES=5,a.PREV_TIME=-5,a.PREV_R=-4,a.PREV_G=-3,a.PREV_B=-2,a.PREV_A=-1,a.R=1,a.G=2,a.B=3,a.A=4,a}(a);t.ColorTimeline=h;var u=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return klt(a,n),a.prototype.getPropertyId=function(){return(i.twoColor<<24)+this.slotIndex},a.prototype.setFrame=function(t,e,n,i,r,o,s,c,l){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.R]=n,this.frames[t+a.G]=i,this.frames[t+a.B]=r,this.frames[t+a.A]=o,this.frames[t+a.R2]=s,this.frames[t+a.G2]=c,this.frames[t+a.B2]=l},a.prototype.apply=function(t,n,i,o,s,c){var l=t.slots[this.slotIndex];if(l.bone.active){var h=this.frames;if(i<h[0])switch(c){case e.setup:return l.color.setFromColor(l.data.color),void l.darkColor.setFromColor(l.data.darkColor);case e.first:var u=l.color,_=l.darkColor,f=l.data.color,d=l.data.darkColor;u.add((f.r-u.r)*s,(f.g-u.g)*s,(f.b-u.b)*s,(f.a-u.a)*s),_.add((d.r-_.r)*s,(d.g-_.g)*s,(d.b-_.b)*s,0)}else{var p=0,m=0,v=0,g=0,y=0,x=0,S=0;if(i>=h[h.length-a.ENTRIES]){var A=h.length;p=h[A+a.PREV_R],m=h[A+a.PREV_G],v=h[A+a.PREV_B],g=h[A+a.PREV_A],y=h[A+a.PREV_R2],x=h[A+a.PREV_G2],S=h[A+a.PREV_B2]}else{var b=r.binarySearch(h,i,a.ENTRIES);p=h[b+a.PREV_R],m=h[b+a.PREV_G],v=h[b+a.PREV_B],g=h[b+a.PREV_A],y=h[b+a.PREV_R2],x=h[b+a.PREV_G2],S=h[b+a.PREV_B2];var C=h[b],T=this.getCurvePercent(b/a.ENTRIES-1,1-(i-C)/(h[b+a.PREV_TIME]-C));p+=(h[b+a.R]-p)*T,m+=(h[b+a.G]-m)*T,v+=(h[b+a.B]-v)*T,g+=(h[b+a.A]-g)*T,y+=(h[b+a.R2]-y)*T,x+=(h[b+a.G2]-x)*T,S+=(h[b+a.B2]-S)*T}1==s?(l.color.set(p,m,v,g),l.darkColor.set(y,x,S,1)):(u=l.color,_=l.darkColor,c==e.setup&&(u.setFromColor(l.data.color),_.setFromColor(l.data.darkColor)),u.add((p-u.r)*s,(m-u.g)*s,(v-u.b)*s,(g-u.a)*s),_.add((y-_.r)*s,(x-_.g)*s,(S-_.b)*s,0))}}},a.ENTRIES=8,a.PREV_TIME=-8,a.PREV_R=-7,a.PREV_G=-6,a.PREV_B=-5,a.PREV_A=-4,a.PREV_R2=-3,a.PREV_G2=-2,a.PREV_B2=-1,a.R=1,a.G=2,a.B=3,a.A=4,a.R2=5,a.G2=6,a.B2=7,a}(a);t.TwoColorTimeline=u;var _=function(){function a(e){this.frames=t.Utils.newFloatArray(e),this.attachmentNames=new Array(e)}return a.prototype.getPropertyId=function(){return(i.attachment<<24)+this.slotIndex},a.prototype.getFrameCount=function(){return this.frames.length},a.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.attachmentNames[t]=n},a.prototype.apply=function(t,i,a,o,s,c,l){var h=t.slots[this.slotIndex];if(h.bone.active)if(l!=n.mixOut||c!=e.setup){var u=this.frames;if(a<u[0]){if(c==e.setup||c==e.first){var _=h.data.attachmentName;h.setAttachment(null==_?null:t.getAttachment(this.slotIndex,_))}}else{var f;f=a>=u[u.length-1]?u.length-1:r.binarySearch(u,a,1)-1;var d=this.attachmentNames[f];t.slots[this.slotIndex].setAttachment(null==d?null:t.getAttachment(this.slotIndex,d))}}else{var p=h.data.attachmentName;h.setAttachment(null==p?null:t.getAttachment(this.slotIndex,p))}},a}();t.AttachmentTimeline=_;var f=null,d=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e),i.frameVertices=new Array(e),null==f&&(f=t.Utils.newFloatArray(64)),i}return klt(a,n),a.prototype.getPropertyId=function(){return(i.deform<<27)+ +this.attachment.id+this.slotIndex},a.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.frameVertices[t]=n},a.prototype.apply=function(n,i,a,o,s,c){var l=n.slots[this.slotIndex];if(l.bone.active){var h=l.getAttachment();if(h instanceof t.VertexAttachment&&h.deformAttachment==this.attachment){var u=l.deform;0==u.length&&(c=e.setup);var _=this.frameVertices,f=_[0].length,d=this.frames;if(a<d[0]){var p=h;switch(c){case e.setup:return void(u.length=0);case e.first:if(1==s){u.length=0;break}var m=t.Utils.setArraySize(u,f);if(null==p.bones)for(var v=p.vertices,g=0;g<f;g++)m[g]+=(v[g]-m[g])*s;else for(s=1-s,g=0;g<f;g++)m[g]*=s}}else{var y=t.Utils.setArraySize(u,f);if(a>=d[d.length-1]){var x=_[d.length-1];if(1==s)if(c==e.add)if(null==(p=h).bones){v=p.vertices;for(var S=0;S<f;S++)y[S]+=x[S]-v[S]}else for(var A=0;A<f;A++)y[A]+=x[A];else t.Utils.arrayCopy(x,0,y,0,f);else switch(c){case e.setup:var b=h;if(null==b.bones){v=b.vertices;for(var C=0;C<f;C++){var T=v[C];y[C]=T+(x[C]-T)*s}}else for(var E=0;E<f;E++)y[E]=x[E]*s;break;case e.first:case e.replace:for(var w=0;w<f;w++)y[w]+=(x[w]-y[w])*s;case e.add:if(null==(p=h).bones){v=p.vertices;for(var I=0;I<f;I++)y[I]+=(x[I]-v[I])*s}else for(var P=0;P<f;P++)y[P]+=x[P]*s}}else{var D=r.binarySearch(d,a),R=_[D-1],M=_[D],O=d[D],N=this.getCurvePercent(D-1,1-(a-O)/(d[D-1]-O));if(1==s)if(c==e.add)if(null==(p=h).bones){v=p.vertices;for(var B=0;B<f;B++){var L=R[B];y[B]+=L+(M[B]-L)*N-v[B]}}else for(var F=0;F<f;F++)L=R[F],y[F]+=L+(M[F]-L)*N;else for(var V=0;V<f;V++)L=R[V],y[V]=L+(M[V]-L)*N;else switch(c){case e.setup:var z=h;if(null==z.bones){v=z.vertices;for(var k=0;k<f;k++)L=R[k],T=v[k],y[k]=T+(L+(M[k]-L)*N-T)*s}else for(var U=0;U<f;U++)L=R[U],y[U]=(L+(M[U]-L)*N)*s;break;case e.first:case e.replace:for(var G=0;G<f;G++)L=R[G],y[G]+=(L+(M[G]-L)*N-y[G])*s;break;case e.add:if(null==(p=h).bones){v=p.vertices;for(var H=0;H<f;H++)L=R[H],y[H]+=(L+(M[H]-L)*N-v[H])*s}else for(var j=0;j<f;j++)L=R[j],y[j]+=(L+(M[j]-L)*N)*s}}}}}},a}(a);t.DeformTimeline=d;var p=function(){function e(e){this.frames=t.Utils.newFloatArray(e),this.events=new Array(e)}return e.prototype.getPropertyId=function(){return i.event<<24},e.prototype.getFrameCount=function(){return this.frames.length},e.prototype.setFrame=function(t,e){this.frames[t]=e.time,this.events[t]=e},e.prototype.apply=function(t,e,n,i,a,o,s){if(null!=i){var c=this.frames,l=this.frames.length;if(e>n)this.apply(t,e,Number.MAX_VALUE,i,a,o,s),e=-1;else if(e>=c[l-1])return;if(!(n<c[0])){var h=0;if(e<c[0])h=0;else for(var u=c[h=r.binarySearch(c,e)];h>0&&c[h-1]==u;)h--;for(;h<l&&n>=c[h];h++)i.push(this.events[h])}}},e}();t.EventTimeline=p;var m=function(){function a(e){this.frames=t.Utils.newFloatArray(e),this.drawOrders=new Array(e)}return a.prototype.getPropertyId=function(){return i.drawOrder<<24},a.prototype.getFrameCount=function(){return this.frames.length},a.prototype.setFrame=function(t,e,n){this.frames[t]=e,this.drawOrders[t]=n},a.prototype.apply=function(i,a,o,s,c,l,h){var u=i.drawOrder,_=i.slots;if(h!=n.mixOut||l!=e.setup){var f=this.frames;if(o<f[0])l!=e.setup&&l!=e.first||t.Utils.arrayCopy(i.slots,0,i.drawOrder,0,i.slots.length);else{var d;d=o>=f[f.length-1]?f.length-1:r.binarySearch(f,o)-1;var p=this.drawOrders[d];if(null==p)t.Utils.arrayCopy(_,0,u,0,_.length);else for(var m=0,v=p.length;m<v;m++)u[m]=_[p[m]]}}else t.Utils.arrayCopy(i.slots,0,i.drawOrder,0,i.slots.length)},a}();t.DrawOrderTimeline=m;var v=function(a){function o(e){var n=a.call(this,e)||this;return n.frames=t.Utils.newFloatArray(e*o.ENTRIES),n}return klt(o,a),o.prototype.getPropertyId=function(){return(i.ikConstraint<<24)+this.ikConstraintIndex},o.prototype.setFrame=function(t,e,n,i,r,a,s){t*=o.ENTRIES,this.frames[t]=e,this.frames[t+o.MIX]=n,this.frames[t+o.SOFTNESS]=i,this.frames[t+o.BEND_DIRECTION]=r,this.frames[t+o.COMPRESS]=a?1:0,this.frames[t+o.STRETCH]=s?1:0},o.prototype.apply=function(t,i,a,s,c,l,h){var u=this.frames,_=t.ikConstraints[this.ikConstraintIndex];if(_.active)if(a<u[0])switch(l){case e.setup:return _.mix=_.data.mix,_.softness=_.data.softness,_.bendDirection=_.data.bendDirection,_.compress=_.data.compress,void(_.stretch=_.data.stretch);case e.first:_.mix+=(_.data.mix-_.mix)*c,_.softness+=(_.data.softness-_.softness)*c,_.bendDirection=_.data.bendDirection,_.compress=_.data.compress,_.stretch=_.data.stretch}else if(a>=u[u.length-o.ENTRIES])l==e.setup?(_.mix=_.data.mix+(u[u.length+o.PREV_MIX]-_.data.mix)*c,_.softness=_.data.softness+(u[u.length+o.PREV_SOFTNESS]-_.data.softness)*c,h==n.mixOut?(_.bendDirection=_.data.bendDirection,_.compress=_.data.compress,_.stretch=_.data.stretch):(_.bendDirection=u[u.length+o.PREV_BEND_DIRECTION],_.compress=0!=u[u.length+o.PREV_COMPRESS],_.stretch=0!=u[u.length+o.PREV_STRETCH])):(_.mix+=(u[u.length+o.PREV_MIX]-_.mix)*c,_.softness+=(u[u.length+o.PREV_SOFTNESS]-_.softness)*c,h==n.mixIn&&(_.bendDirection=u[u.length+o.PREV_BEND_DIRECTION],_.compress=0!=u[u.length+o.PREV_COMPRESS],_.stretch=0!=u[u.length+o.PREV_STRETCH]));else{var f=r.binarySearch(u,a,o.ENTRIES),d=u[f+o.PREV_MIX],p=u[f+o.PREV_SOFTNESS],m=u[f],v=this.getCurvePercent(f/o.ENTRIES-1,1-(a-m)/(u[f+o.PREV_TIME]-m));l==e.setup?(_.mix=_.data.mix+(d+(u[f+o.MIX]-d)*v-_.data.mix)*c,_.softness=_.data.softness+(p+(u[f+o.SOFTNESS]-p)*v-_.data.softness)*c,h==n.mixOut?(_.bendDirection=_.data.bendDirection,_.compress=_.data.compress,_.stretch=_.data.stretch):(_.bendDirection=u[f+o.PREV_BEND_DIRECTION],_.compress=0!=u[f+o.PREV_COMPRESS],_.stretch=0!=u[f+o.PREV_STRETCH])):(_.mix+=(d+(u[f+o.MIX]-d)*v-_.mix)*c,_.softness+=(p+(u[f+o.SOFTNESS]-p)*v-_.softness)*c,h==n.mixIn&&(_.bendDirection=u[f+o.PREV_BEND_DIRECTION],_.compress=0!=u[f+o.PREV_COMPRESS],_.stretch=0!=u[f+o.PREV_STRETCH]))}},o.ENTRIES=6,o.PREV_TIME=-6,o.PREV_MIX=-5,o.PREV_SOFTNESS=-4,o.PREV_BEND_DIRECTION=-3,o.PREV_COMPRESS=-2,o.PREV_STRETCH=-1,o.MIX=1,o.SOFTNESS=2,o.BEND_DIRECTION=3,o.COMPRESS=4,o.STRETCH=5,o}(a);t.IkConstraintTimeline=v;var g=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return klt(a,n),a.prototype.getPropertyId=function(){return(i.transformConstraint<<24)+this.transformConstraintIndex},a.prototype.setFrame=function(t,e,n,i,r,o){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.ROTATE]=n,this.frames[t+a.TRANSLATE]=i,this.frames[t+a.SCALE]=r,this.frames[t+a.SHEAR]=o},a.prototype.apply=function(t,n,i,o,s,c){var l=this.frames,h=t.transformConstraints[this.transformConstraintIndex];if(h.active)if(i<l[0]){var u=h.data;switch(c){case e.setup:return h.rotateMix=u.rotateMix,h.translateMix=u.translateMix,h.scaleMix=u.scaleMix,void(h.shearMix=u.shearMix);case e.first:h.rotateMix+=(u.rotateMix-h.rotateMix)*s,h.translateMix+=(u.translateMix-h.translateMix)*s,h.scaleMix+=(u.scaleMix-h.scaleMix)*s,h.shearMix+=(u.shearMix-h.shearMix)*s}}else{var _=0,f=0,d=0,p=0;if(i>=l[l.length-a.ENTRIES]){var m=l.length;_=l[m+a.PREV_ROTATE],f=l[m+a.PREV_TRANSLATE],d=l[m+a.PREV_SCALE],p=l[m+a.PREV_SHEAR]}else{var v=r.binarySearch(l,i,a.ENTRIES);_=l[v+a.PREV_ROTATE],f=l[v+a.PREV_TRANSLATE],d=l[v+a.PREV_SCALE],p=l[v+a.PREV_SHEAR];var g=l[v],y=this.getCurvePercent(v/a.ENTRIES-1,1-(i-g)/(l[v+a.PREV_TIME]-g));_+=(l[v+a.ROTATE]-_)*y,f+=(l[v+a.TRANSLATE]-f)*y,d+=(l[v+a.SCALE]-d)*y,p+=(l[v+a.SHEAR]-p)*y}c==e.setup?(u=h.data,h.rotateMix=u.rotateMix+(_-u.rotateMix)*s,h.translateMix=u.translateMix+(f-u.translateMix)*s,h.scaleMix=u.scaleMix+(d-u.scaleMix)*s,h.shearMix=u.shearMix+(p-u.shearMix)*s):(h.rotateMix+=(_-h.rotateMix)*s,h.translateMix+=(f-h.translateMix)*s,h.scaleMix+=(d-h.scaleMix)*s,h.shearMix+=(p-h.shearMix)*s)}},a.ENTRIES=5,a.PREV_TIME=-5,a.PREV_ROTATE=-4,a.PREV_TRANSLATE=-3,a.PREV_SCALE=-2,a.PREV_SHEAR=-1,a.ROTATE=1,a.TRANSLATE=2,a.SCALE=3,a.SHEAR=4,a}(a);t.TransformConstraintTimeline=g;var y=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return klt(a,n),a.prototype.getPropertyId=function(){return(i.pathConstraintPosition<<24)+this.pathConstraintIndex},a.prototype.setFrame=function(t,e,n){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.VALUE]=n},a.prototype.apply=function(t,n,i,o,s,c){var l=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(h.active)if(i<l[0])switch(c){case e.setup:return void(h.position=h.data.position);case e.first:h.position+=(h.data.position-h.position)*s}else{var u=0;if(i>=l[l.length-a.ENTRIES])u=l[l.length+a.PREV_VALUE];else{var _=r.binarySearch(l,i,a.ENTRIES);u=l[_+a.PREV_VALUE];var f=l[_],d=this.getCurvePercent(_/a.ENTRIES-1,1-(i-f)/(l[_+a.PREV_TIME]-f));u+=(l[_+a.VALUE]-u)*d}c==e.setup?h.position=h.data.position+(u-h.data.position)*s:h.position+=(u-h.position)*s}},a.ENTRIES=2,a.PREV_TIME=-2,a.PREV_VALUE=-1,a.VALUE=1,a}(a);t.PathConstraintPositionTimeline=y;var x=function(t){function n(e){return t.call(this,e)||this}return klt(n,t),n.prototype.getPropertyId=function(){return(i.pathConstraintSpacing<<24)+this.pathConstraintIndex},n.prototype.apply=function(t,i,a,o,s,c){var l=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(h.active)if(a<l[0])switch(c){case e.setup:return void(h.spacing=h.data.spacing);case e.first:h.spacing+=(h.data.spacing-h.spacing)*s}else{var u=0;if(a>=l[l.length-n.ENTRIES])u=l[l.length+n.PREV_VALUE];else{var _=r.binarySearch(l,a,n.ENTRIES);u=l[_+n.PREV_VALUE];var f=l[_],d=this.getCurvePercent(_/n.ENTRIES-1,1-(a-f)/(l[_+n.PREV_TIME]-f));u+=(l[_+n.VALUE]-u)*d}c==e.setup?h.spacing=h.data.spacing+(u-h.data.spacing)*s:h.spacing+=(u-h.spacing)*s}},n}(y);t.PathConstraintSpacingTimeline=x;var S=function(n){function a(e){var i=n.call(this,e)||this;return i.frames=t.Utils.newFloatArray(e*a.ENTRIES),i}return klt(a,n),a.prototype.getPropertyId=function(){return(i.pathConstraintMix<<24)+this.pathConstraintIndex},a.prototype.setFrame=function(t,e,n,i){t*=a.ENTRIES,this.frames[t]=e,this.frames[t+a.ROTATE]=n,this.frames[t+a.TRANSLATE]=i},a.prototype.apply=function(t,n,i,o,s,c){var l=this.frames,h=t.pathConstraints[this.pathConstraintIndex];if(h.active)if(i<l[0])switch(c){case e.setup:return h.rotateMix=h.data.rotateMix,void(h.translateMix=h.data.translateMix);case e.first:h.rotateMix+=(h.data.rotateMix-h.rotateMix)*s,h.translateMix+=(h.data.translateMix-h.translateMix)*s}else{var u=0,_=0;if(i>=l[l.length-a.ENTRIES])u=l[l.length+a.PREV_ROTATE],_=l[l.length+a.PREV_TRANSLATE];else{var f=r.binarySearch(l,i,a.ENTRIES);u=l[f+a.PREV_ROTATE],_=l[f+a.PREV_TRANSLATE];var d=l[f],p=this.getCurvePercent(f/a.ENTRIES-1,1-(i-d)/(l[f+a.PREV_TIME]-d));u+=(l[f+a.ROTATE]-u)*p,_+=(l[f+a.TRANSLATE]-_)*p}c==e.setup?(h.rotateMix=h.data.rotateMix+(u-h.data.rotateMix)*s,h.translateMix=h.data.translateMix+(_-h.data.translateMix)*s):(h.rotateMix+=(u-h.rotateMix)*s,h.translateMix+=(_-h.translateMix)*s)}},a.ENTRIES=3,a.PREV_TIME=-3,a.PREV_ROTATE=-2,a.PREV_TRANSLATE=-1,a.ROTATE=1,a.TRANSLATE=2,a}(a);t.PathConstraintMixTimeline=S}(zlt||(zlt={})),function(t){var e=function(){function e(e){this.tracks=new Array,this.timeScale=1,this.events=new Array,this.listeners=new Array,this.queue=new r(this),this.propertyIDs=new t.IntSet,this.animationsChanged=!1,this.trackEntryPool=new t.Pool((function(){return new n})),this.data=e}return e.prototype.update=function(t){t*=this.timeScale;for(var e=this.tracks,n=0,i=e.length;n<i;n++){var r=e[n];if(null!=r){r.animationLast=r.nextAnimationLast,r.trackLast=r.nextTrackLast;var a=t*r.timeScale;if(r.delay>0){if(r.delay-=a,r.delay>0)continue;a=-r.delay,r.delay=0}var o=r.next;if(null!=o){var s=r.trackLast-o.delay;if(s>=0){for(o.delay=0,o.trackTime+=0==r.timeScale?0:(s/r.timeScale+t)*o.timeScale,r.trackTime+=a,this.setCurrent(n,o,!0);null!=o.mixingFrom;)o.mixTime+=t,o=o.mixingFrom;continue}}else if(r.trackLast>=r.trackEnd&&null==r.mixingFrom){e[n]=null,this.queue.end(r),this.disposeNext(r);continue}if(null!=r.mixingFrom&&this.updateMixingFrom(r,t)){var c=r.mixingFrom;for(r.mixingFrom=null,null!=c&&(c.mixingTo=null);null!=c;)this.queue.end(c),c=c.mixingFrom}r.trackTime+=a}}this.queue.drain()},e.prototype.updateMixingFrom=function(t,e){var n=t.mixingFrom;if(null==n)return!0;var i=this.updateMixingFrom(n,e);return n.animationLast=n.nextAnimationLast,n.trackLast=n.nextTrackLast,t.mixTime>0&&t.mixTime>=t.mixDuration?(0!=n.totalAlpha&&0!=t.mixDuration||(t.mixingFrom=n.mixingFrom,null!=n.mixingFrom&&(n.mixingFrom.mixingTo=t),t.interruptAlpha=n.interruptAlpha,this.queue.end(n)),i):(n.trackTime+=e*n.timeScale,t.mixTime+=e,!1)},e.prototype.apply=function(n){if(null==n)throw new Error("skeleton cannot be null.");this.animationsChanged&&this._animationsChanged();for(var i=this.events,r=this.tracks,a=!1,o=0,s=r.length;o<s;o++){var c=r[o];if(!(null==c||c.delay>0)){a=!0;var l=0==o?t.MixBlend.first:c.mixBlend,h=c.alpha;null!=c.mixingFrom?h*=this.applyMixingFrom(c,n,l):c.trackTime>=c.trackEnd&&null==c.next&&(h=0);var u=c.animationLast,_=c.getAnimationTime(),f=c.animation.timelines.length,d=c.animation.timelines;if(0==o&&1==h||l==t.MixBlend.add)for(var p=0;p<f;p++)t.Utils.webkit602BugfixHelper(h,l),d[p].apply(n,u,_,i,h,l,t.MixDirection.mixIn);else{var m=c.timelineMode,v=0==c.timelinesRotation.length;v&&t.Utils.setArraySize(c.timelinesRotation,f<<1,null);var g=c.timelinesRotation;for(p=0;p<f;p++){var y=d[p],x=(m[p]&e.NOT_LAST-1)==e.SUBSEQUENT?l:t.MixBlend.setup;y instanceof t.RotateTimeline?this.applyRotateTimeline(y,n,_,h,x,g,p<<1,v):(t.Utils.webkit602BugfixHelper(h,l),y.apply(n,u,_,i,h,x,t.MixDirection.mixIn))}}this.queueEvents(c,_),i.length=0,c.nextAnimationLast=_,c.nextTrackLast=c.trackTime}}return this.queue.drain(),a},e.prototype.applyMixingFrom=function(n,i,r){var a=n.mixingFrom;null!=a.mixingFrom&&this.applyMixingFrom(a,i,r);var o=0;0==n.mixDuration?(o=1,r==t.MixBlend.first&&(r=t.MixBlend.setup)):((o=n.mixTime/n.mixDuration)>1&&(o=1),r!=t.MixBlend.first&&(r=a.mixBlend));var s=o<a.eventThreshold?this.events:null,c=o<a.attachmentThreshold,l=o<a.drawOrderThreshold,h=a.animationLast,u=a.getAnimationTime(),_=a.animation.timelines.length,f=a.animation.timelines,d=a.alpha*n.interruptAlpha,p=d*(1-o);if(r==t.MixBlend.add)for(var m=0;m<_;m++)f[m].apply(i,h,u,s,p,r,t.MixDirection.mixOut);else{var v=a.timelineMode,g=a.timelineHoldMix,y=0==a.timelinesRotation.length;y&&t.Utils.setArraySize(a.timelinesRotation,_<<1,null);var x=a.timelinesRotation;for(a.totalAlpha=0,m=0;m<_;m++){var S=f[m],A=t.MixDirection.mixOut,b=void 0,C=0;switch(v[m]&e.NOT_LAST-1){case e.SUBSEQUENT:if(b=r,!c&&S instanceof t.AttachmentTimeline){if((v[m]&e.NOT_LAST)==e.NOT_LAST)continue;b=t.MixBlend.setup}if(!l&&S instanceof t.DrawOrderTimeline)continue;C=p;break;case e.FIRST:b=t.MixBlend.setup,C=p;break;case e.HOLD:b=t.MixBlend.setup,C=d;break;default:b=t.MixBlend.setup;var T=g[m];C=d*Math.max(0,1-T.mixTime/T.mixDuration)}a.totalAlpha+=C,S instanceof t.RotateTimeline?this.applyRotateTimeline(S,i,u,C,b,x,m<<1,y):(t.Utils.webkit602BugfixHelper(C,r),b==t.MixBlend.setup&&(S instanceof t.AttachmentTimeline?(c||(v[m]&e.NOT_LAST)==e.NOT_LAST)&&(A=t.MixDirection.mixIn):S instanceof t.DrawOrderTimeline&&l&&(A=t.MixDirection.mixIn)),S.apply(i,h,u,s,C,b,A))}}return n.mixDuration>0&&this.queueEvents(a,u),this.events.length=0,a.nextAnimationLast=u,a.nextTrackLast=a.trackTime,o},e.prototype.applyRotateTimeline=function(e,n,i,r,a,o,s,c){if(c&&(o[s]=0),1!=r){var l=e,h=l.frames,u=n.bones[l.boneIndex];if(u.active){var _=0,f=0;if(i<h[0])switch(a){case t.MixBlend.setup:u.rotation=u.data.rotation;default:return;case t.MixBlend.first:_=u.rotation,f=u.data.rotation}else if(_=a==t.MixBlend.setup?u.data.rotation:u.rotation,i>=h[h.length-t.RotateTimeline.ENTRIES])f=u.data.rotation+h[h.length+t.RotateTimeline.PREV_ROTATION];else{var d=t.Animation.binarySearch(h,i,t.RotateTimeline.ENTRIES),p=h[d+t.RotateTimeline.PREV_ROTATION],m=h[d],v=l.getCurvePercent((d>>1)-1,1-(i-m)/(h[d+t.RotateTimeline.PREV_TIME]-m));f=h[d+t.RotateTimeline.ROTATION]-p,f=p+(f-=360*(16384-(16384.499999999996-f/360|0)))*v+u.data.rotation,f-=360*(16384-(16384.499999999996-f/360|0))}var g=0,y=f-_;if(0==(y-=360*(16384-(16384.499999999996-y/360|0))))g=o[s];else{var x=0,S=0;c?(x=0,S=y):(x=o[s],S=o[s+1]);var A=y>0,b=x>=0;t.MathUtils.signum(S)!=t.MathUtils.signum(y)&&Math.abs(S)<=90&&(Math.abs(x)>180&&(x+=360*t.MathUtils.signum(x)),b=A),g=y+x-x%360,b!=A&&(g+=360*t.MathUtils.signum(x)),o[s]=g}o[s+1]=y,_+=g*r,u.rotation=_-360*(16384-(16384.499999999996-_/360|0))}}else e.apply(n,0,i,null,1,a,t.MixDirection.mixIn)},e.prototype.queueEvents=function(t,e){for(var n=t.animationStart,i=t.animationEnd,r=i-n,a=t.trackLast%r,o=this.events,s=0,c=o.length;s<c;s++){var l=o[s];if(l.time<a)break;l.time>i||this.queue.event(t,l)}for((t.loop?0==r||a>t.trackTime%r:e>=i&&t.animationLast<i)&&this.queue.complete(t);s<c;s++)o[s].time<n||this.queue.event(t,o[s])},e.prototype.clearTracks=function(){var t=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var e=0,n=this.tracks.length;e<n;e++)this.clearTrack(e);this.tracks.length=0,this.queue.drainDisabled=t,this.queue.drain()},e.prototype.clearTrack=function(t){if(!(t>=this.tracks.length)){var e=this.tracks[t];if(null!=e){this.queue.end(e),this.disposeNext(e);for(var n=e;;){var i=n.mixingFrom;if(null==i)break;this.queue.end(i),n.mixingFrom=null,n.mixingTo=null,n=i}this.tracks[e.trackIndex]=null,this.queue.drain()}}},e.prototype.setCurrent=function(t,e,n){var i=this.expandToIndex(t);this.tracks[t]=e,null!=i&&(n&&this.queue.interrupt(i),e.mixingFrom=i,i.mixingTo=e,e.mixTime=0,null!=i.mixingFrom&&i.mixDuration>0&&(e.interruptAlpha*=Math.min(1,i.mixTime/i.mixDuration)),i.timelinesRotation.length=0),this.queue.start(e)},e.prototype.setAnimation=function(t,e,n){var i=this.data.skeletonData.findAnimation(e);if(null==i)throw new Error("Animation not found: "+e);return this.setAnimationWith(t,i,n)},e.prototype.setAnimationWith=function(t,e,n){if(null==e)throw new Error("animation cannot be null.");var i=!0,r=this.expandToIndex(t);null!=r&&(-1==r.nextTrackLast?(this.tracks[t]=r.mixingFrom,this.queue.interrupt(r),this.queue.end(r),this.disposeNext(r),r=r.mixingFrom,i=!1):this.disposeNext(r));var a=this.trackEntry(t,e,n,r);return this.setCurrent(t,a,i),this.queue.drain(),a},e.prototype.addAnimation=function(t,e,n,i){var r=this.data.skeletonData.findAnimation(e);if(null==r)throw new Error("Animation not found: "+e);return this.addAnimationWith(t,r,n,i)},e.prototype.addAnimationWith=function(t,e,n,i){if(null==e)throw new Error("animation cannot be null.");var r=this.expandToIndex(t);if(null!=r)for(;null!=r.next;)r=r.next;var a=this.trackEntry(t,e,n,r);if(null==r)this.setCurrent(t,a,!0),this.queue.drain();else if(r.next=a,i<=0){var o=r.animationEnd-r.animationStart;0!=o?(r.loop?i+=o*(1+(r.trackTime/o|0)):i+=Math.max(o,r.trackTime),i-=this.data.getMix(r.animation,e)):i=r.trackTime}return a.delay=i,a},e.prototype.setEmptyAnimation=function(t,n){var i=this.setAnimationWith(t,e.emptyAnimation,!1);return i.mixDuration=n,i.trackEnd=n,i},e.prototype.addEmptyAnimation=function(t,n,i){i<=0&&(i-=n);var r=this.addAnimationWith(t,e.emptyAnimation,!1,i);return r.mixDuration=n,r.trackEnd=n,r},e.prototype.setEmptyAnimations=function(t){var e=this.queue.drainDisabled;this.queue.drainDisabled=!0;for(var n=0,i=this.tracks.length;n<i;n++){var r=this.tracks[n];null!=r&&this.setEmptyAnimation(r.trackIndex,t)}this.queue.drainDisabled=e,this.queue.drain()},e.prototype.expandToIndex=function(e){return e<this.tracks.length?this.tracks[e]:(t.Utils.ensureArrayCapacity(this.tracks,e+1,null),this.tracks.length=e+1,null)},e.prototype.trackEntry=function(t,e,n,i){var r=this.trackEntryPool.obtain();return r.trackIndex=t,r.animation=e,r.loop=n,r.holdPrevious=!1,r.eventThreshold=0,r.attachmentThreshold=0,r.drawOrderThreshold=0,r.animationStart=0,r.animationEnd=e.duration,r.animationLast=-1,r.nextAnimationLast=-1,r.delay=0,r.trackTime=0,r.trackLast=-1,r.nextTrackLast=-1,r.trackEnd=Number.MAX_VALUE,r.timeScale=1,r.alpha=1,r.interruptAlpha=1,r.mixTime=0,r.mixDuration=null==i?0:this.data.getMix(i.animation,e),r},e.prototype.disposeNext=function(t){for(var e=t.next;null!=e;)this.queue.dispose(e),e=e.next;t.next=null},e.prototype._animationsChanged=function(){this.animationsChanged=!1,this.propertyIDs.clear();for(var e=0,n=this.tracks.length;e<n;e++)if(null!=(i=this.tracks[e])){for(;null!=i.mixingFrom;)i=i.mixingFrom;do{null!=i.mixingFrom&&i.mixBlend==t.MixBlend.add||this.computeHold(i),i=i.mixingTo}while(null!=i)}for(this.propertyIDs.clear(),e=this.tracks.length-1;e>=0;e--)for(var i=this.tracks[e];null!=i;)this.computeNotLast(i),i=i.mixingFrom},e.prototype.computeHold=function(n){var i=n.mixingTo,r=n.animation.timelines,a=n.animation.timelines.length,o=t.Utils.setArraySize(n.timelineMode,a);n.timelineHoldMix.length=0;var s=t.Utils.setArraySize(n.timelineHoldMix,a),c=this.propertyIDs;if(null!=i&&i.holdPrevious)for(var l=0;l<a;l++)c.add(r[l].getPropertyId()),o[l]=e.HOLD;else t:for(l=0;l<a;l++){var h=r[l],u=h.getPropertyId();if(c.add(u))if(null==i||h instanceof t.AttachmentTimeline||h instanceof t.DrawOrderTimeline||h instanceof t.EventTimeline||!i.animation.hasTimeline(u))o[l]=e.FIRST;else{for(var _=i.mixingTo;null!=_;_=_.mixingTo)if(!_.animation.hasTimeline(u)){if(n.mixDuration>0){o[l]=e.HOLD_MIX,s[l]=_;continue t}break}o[l]=e.HOLD}else o[l]=e.SUBSEQUENT}},e.prototype.computeNotLast=function(n){for(var i=n.animation.timelines,r=n.animation.timelines.length,a=n.timelineMode,o=this.propertyIDs,s=0;s<r;s++)if(i[s]instanceof t.AttachmentTimeline){var c=i[s];o.add(c.slotIndex)||(a[s]|=e.NOT_LAST)}},e.prototype.getCurrent=function(t){return t>=this.tracks.length?null:this.tracks[t]},e.prototype.addListener=function(t){if(null==t)throw new Error("listener cannot be null.");this.listeners.push(t)},e.prototype.removeListener=function(t){var e=this.listeners.indexOf(t);e>=0&&this.listeners.splice(e,1)},e.prototype.clearListeners=function(){this.listeners.length=0},e.prototype.clearListenerNotifications=function(){this.queue.clear()},e.emptyAnimation=new t.Animation("<empty>",[],0),e.SUBSEQUENT=0,e.FIRST=1,e.HOLD=2,e.HOLD_MIX=3,e.NOT_LAST=4,e}();t.AnimationState=e;var n=function(){function e(){this.mixBlend=t.MixBlend.replace,this.timelineMode=new Array,this.timelineHoldMix=new Array,this.timelinesRotation=new Array}return e.prototype.reset=function(){this.next=null,this.mixingFrom=null,this.mixingTo=null,this.animation=null,this.listener=null,this.timelineMode.length=0,this.timelineHoldMix.length=0,this.timelinesRotation.length=0},e.prototype.getAnimationTime=function(){if(this.loop){var t=this.animationEnd-this.animationStart;return 0==t?this.animationStart:this.trackTime%t+this.animationStart}return Math.min(this.trackTime+this.animationStart,this.animationEnd)},e.prototype.setAnimationLast=function(t){this.animationLast=t,this.nextAnimationLast=t},e.prototype.isComplete=function(){return this.trackTime>=this.animationEnd-this.animationStart},e.prototype.resetRotationDirections=function(){this.timelinesRotation.length=0},e}();t.TrackEntry=n;var i,r=function(){function t(t){this.objects=[],this.drainDisabled=!1,this.animState=t}return t.prototype.start=function(t){this.objects.push(i.start),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.interrupt=function(t){this.objects.push(i.interrupt),this.objects.push(t)},t.prototype.end=function(t){this.objects.push(i.end),this.objects.push(t),this.animState.animationsChanged=!0},t.prototype.dispose=function(t){this.objects.push(i.dispose),this.objects.push(t)},t.prototype.complete=function(t){this.objects.push(i.complete),this.objects.push(t)},t.prototype.event=function(t,e){this.objects.push(i.event),this.objects.push(t),this.objects.push(e)},t.prototype.drain=function(){if(!this.drainDisabled){this.drainDisabled=!0;for(var t=this.objects,e=this.animState.listeners,n=0;n<t.length;n+=2){var r=t[n],a=t[n+1];switch(r){case i.start:null!=a.listener&&a.listener.start&&a.listener.start(a);for(var o=0;o<e.length;o++)e[o].start&&e[o].start(a);break;case i.interrupt:for(null!=a.listener&&a.listener.interrupt&&a.listener.interrupt(a),o=0;o<e.length;o++)e[o].interrupt&&e[o].interrupt(a);break;case i.end:for(null!=a.listener&&a.listener.end&&a.listener.end(a),o=0;o<e.length;o++)e[o].end&&e[o].end(a);case i.dispose:for(null!=a.listener&&a.listener.dispose&&a.listener.dispose(a),o=0;o<e.length;o++)e[o].dispose&&e[o].dispose(a);this.animState.trackEntryPool.free(a);break;case i.complete:for(null!=a.listener&&a.listener.complete&&a.listener.complete(a),o=0;o<e.length;o++)e[o].complete&&e[o].complete(a);break;case i.event:var s=t[2+n++];for(null!=a.listener&&a.listener.event&&a.listener.event(a,s),o=0;o<e.length;o++)e[o].event&&e[o].event(a,s)}}this.clear(),this.drainDisabled=!1}},t.prototype.clear=function(){this.objects.length=0},t}();t.EventQueue=r,function(t){t[t.start=0]="start",t[t.interrupt=1]="interrupt",t[t.end=2]="end",t[t.dispose=3]="dispose",t[t.complete=4]="complete",t[t.event=5]="event"}(i=t.EventType||(t.EventType={}));var a=function(){function t(){}return t.prototype.start=function(){},t.prototype.interrupt=function(){},t.prototype.end=function(){},t.prototype.dispose=function(){},t.prototype.complete=function(){},t.prototype.event=function(){},t}();t.AnimationStateAdapter=a}(zlt||(zlt={})),function(t){var e=function(){function t(t){if(this.animationToMixTime={},this.defaultMix=0,null==t)throw new Error("skeletonData cannot be null.");this.skeletonData=t}return t.prototype.setMix=function(t,e,n){var i=this.skeletonData.findAnimation(t);if(null==i)throw new Error("Animation not found: "+t);var r=this.skeletonData.findAnimation(e);if(null==r)throw new Error("Animation not found: "+e);this.setMixWith(i,r,n)},t.prototype.setMixWith=function(t,e,n){if(null==t)throw new Error("from cannot be null.");if(null==e)throw new Error("to cannot be null.");var i=t.name+"."+e.name;this.animationToMixTime[i]=n},t.prototype.getMix=function(t,e){var n=t.name+"."+e.name,i=this.animationToMixTime[n];return void 0===i?this.defaultMix:i},t}();t.AnimationStateData=e}(zlt||(zlt={})),function(t){var e=function(){function e(t,e){void 0===e&&(e=""),this.assets={},this.errors={},this.toLoad=0,this.loaded=0,this.textureLoader=t,this.pathPrefix=e}return e.downloadText=function(t,e,n){var i=new XMLHttpRequest;i.open("GET",t,!0),i.onload=function(){200==i.status?e(i.responseText):n(i.status,i.responseText)},i.onerror=function(){n(i.status,i.responseText)},i.send()},e.downloadBinary=function(t,e,n){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){200==i.status?e(new Uint8Array(i.response)):n(i.status,i.responseText)},i.onerror=function(){n(i.status,i.responseText)},i.send()},e.prototype.loadBinary=function(t,n,i){var r=this;void 0===n&&(n=null),void 0===i&&(i=null),t=this.pathPrefix+t,this.toLoad++,e.downloadBinary(t,(function(e){r.assets[t]=e,n&&n(t,e),r.toLoad--,r.loaded++}),(function(e,n){r.errors[t]="Couldn't load binary "+t+": status "+status+", "+n,i&&i(t,"Couldn't load binary "+t+": status "+status+", "+n),r.toLoad--,r.loaded++}))},e.prototype.loadText=function(t,n,i){var r=this;void 0===n&&(n=null),void 0===i&&(i=null),t=this.pathPrefix+t,this.toLoad++,e.downloadText(t,(function(e){r.assets[t]=e,n&&n(t,e),r.toLoad--,r.loaded++}),(function(e,n){r.errors[t]="Couldn't load text "+t+": status "+status+", "+n,i&&i(t,"Couldn't load text "+t+": status "+status+", "+n),r.toLoad--,r.loaded++}))},e.prototype.loadTexture=function(t,e,n){var i=this;void 0===e&&(e=null),void 0===n&&(n=null),t=this.pathPrefix+t,this.toLoad++;var r=new Image;r.crossOrigin="anonymous",r.onload=function(){var n=i.textureLoader(r);i.assets[t]=n,i.toLoad--,i.loaded++,e&&e(t,r)},r.onerror=function(){i.errors[t]="Couldn't load image "+t,i.toLoad--,i.loaded++,n&&n(t,"Couldn't load image "+t)},r.src=t},e.prototype.loadTextureData=function(t,e,n,i){var r=this;void 0===n&&(n=null),void 0===i&&(i=null),t=this.pathPrefix+t,this.toLoad++;var a=new Image;a.onload=function(){var e=r.textureLoader(a);r.assets[t]=e,r.toLoad--,r.loaded++,n&&n(t,a)},a.onerror=function(){r.errors[t]="Couldn't load image "+t,r.toLoad--,r.loaded++,i&&i(t,"Couldn't load image "+t)},a.src=e},e.prototype.loadTextureAtlas=function(n,i,r){var a=this;void 0===i&&(i=null),void 0===r&&(r=null);var o=n.lastIndexOf("/")>=0?n.substring(0,n.lastIndexOf("/")):"";n=this.pathPrefix+n,this.toLoad++,e.downloadText(n,(function(e){var s={count:0},c=new Array;try{new t.TextureAtlas(e,(function(e){c.push(o+"/"+e);var n=document.createElement("img");return n.width=16,n.height=16,new t.FakeTexture(n)}))}catch(t){var l=t;return a.errors[n]="Couldn't load texture atlas "+n+": "+l.message,r&&r(n,"Couldn't load texture atlas "+n+": "+l.message),a.toLoad--,void a.loaded++}for(var h=function(l){var h=!1;a.loadTexture(l,(function(l){if(s.count++,s.count==c.length)if(h)a.errors[n]="Couldn't load texture atlas page "+l+"} of atlas "+n,r&&r(n,"Couldn't load texture atlas page "+l+" of atlas "+n),a.toLoad--,a.loaded++;else try{var u=new t.TextureAtlas(e,(function(t){return a.get(o+"/"+t)}));a.assets[n]=u,i&&i(n,u),a.toLoad--,a.loaded++}catch(t){var _=t;a.errors[n]="Couldn't load texture atlas "+n+": "+_.message,r&&r(n,"Couldn't load texture atlas "+n+": "+_.message),a.toLoad--,a.loaded++}}),(function(t){h=!0,s.count++,s.count==c.length&&(a.errors[n]="Couldn't load texture atlas page "+t+"} of atlas "+n,r&&r(n,"Couldn't load texture atlas page "+t+" of atlas "+n),a.toLoad--,a.loaded++)}))},u=0,_=c;u<_.length;u++)h(_[u])}),(function(t,e){a.errors[n]="Couldn't load texture atlas "+n+": status "+status+", "+e,r&&r(n,"Couldn't load texture atlas "+n+": status "+status+", "+e),a.toLoad--,a.loaded++}))},e.prototype.get=function(t){return t=this.pathPrefix+t,this.assets[t]},e.prototype.remove=function(t){t=this.pathPrefix+t;var e=this.assets[t];e.dispose&&e.dispose(),this.assets[t]=null},e.prototype.removeAll=function(){for(var t in this.assets){var e=this.assets[t];e.dispose&&e.dispose()}this.assets={}},e.prototype.isLoadingComplete=function(){return 0==this.toLoad},e.prototype.getToLoad=function(){return this.toLoad},e.prototype.getLoaded=function(){return this.loaded},e.prototype.dispose=function(){this.removeAll()},e.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},e.prototype.getErrors=function(){return this.errors},e}();t.AssetManager=e}(zlt||(zlt={})),function(t){var e=function(){function e(t){this.atlas=t}return e.prototype.newRegionAttachment=function(e,n,i){var r=this.atlas.findRegion(i);if(null==r)return null;r.renderObject=r;var a=new t.RegionAttachment(n);return a.setRegion(r),a},e.prototype.newMeshAttachment=function(e,n,i){var r=this.atlas.findRegion(i);if(null==r)return null;r.renderObject=r;var a=new t.MeshAttachment(n);return a.region=r,a},e.prototype.newBoundingBoxAttachment=function(e,n){return new t.BoundingBoxAttachment(n)},e.prototype.newPathAttachment=function(e,n){return new t.PathAttachment(n)},e.prototype.newPointAttachment=function(e,n){return new t.PointAttachment(n)},e.prototype.newClippingAttachment=function(e,n){return new t.ClippingAttachment(n)},e}();t.AtlasAttachmentLoader=e}(zlt||(zlt={})),function(t){!function(t){t[t.Normal=0]="Normal",t[t.Additive=1]="Additive",t[t.Multiply=2]="Multiply",t[t.Screen=3]="Screen"}(t.BlendMode||(t.BlendMode={}))}(zlt||(zlt={})),function(t){var e=function(){function e(t,e,n){if(this.children=new Array,this.x=0,this.y=0,this.rotation=0,this.scaleX=0,this.scaleY=0,this.shearX=0,this.shearY=0,this.ax=0,this.ay=0,this.arotation=0,this.ascaleX=0,this.ascaleY=0,this.ashearX=0,this.ashearY=0,this.appliedValid=!1,this.a=0,this.b=0,this.c=0,this.d=0,this.worldY=0,this.worldX=0,this.sorted=!1,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.skeleton=e,this.parent=n,this.setToSetupPose()}return e.prototype.isActive=function(){return this.active},e.prototype.update=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},e.prototype.updateWorldTransform=function(){this.updateWorldTransformWith(this.x,this.y,this.rotation,this.scaleX,this.scaleY,this.shearX,this.shearY)},e.prototype.updateWorldTransformWith=function(e,n,i,r,a,o,s){this.ax=e,this.ay=n,this.arotation=i,this.ascaleX=r,this.ascaleY=a,this.ashearX=o,this.ashearY=s,this.appliedValid=!0;var c=this.parent;if(null==c){var l=this.skeleton,h=i+90+s,u=l.scaleX,_=l.scaleY;return this.a=t.MathUtils.cosDeg(i+o)*r*u,this.b=t.MathUtils.cosDeg(h)*a*u,this.c=t.MathUtils.sinDeg(i+o)*r*_,this.d=t.MathUtils.sinDeg(h)*a*_,this.worldX=e*u+l.x,void(this.worldY=n*_+l.y)}var f=c.a,d=c.b,p=c.c,m=c.d;switch(this.worldX=f*e+d*n+c.worldX,this.worldY=p*e+m*n+c.worldY,this.data.transformMode){case t.TransformMode.Normal:h=i+90+s;var v=t.MathUtils.cosDeg(i+o)*r,g=t.MathUtils.cosDeg(h)*a,y=t.MathUtils.sinDeg(i+o)*r,x=t.MathUtils.sinDeg(h)*a;return this.a=f*v+d*y,this.b=f*g+d*x,this.c=p*v+m*y,void(this.d=p*g+m*x);case t.TransformMode.OnlyTranslation:h=i+90+s,this.a=t.MathUtils.cosDeg(i+o)*r,this.b=t.MathUtils.cosDeg(h)*a,this.c=t.MathUtils.sinDeg(i+o)*r,this.d=t.MathUtils.sinDeg(h)*a;break;case t.TransformMode.NoRotationOrReflection:var S=0;(C=f*f+p*p)>1e-4?(d=p*(C=Math.abs(f*m-d*p)/C),m=f*C,S=Math.atan2(p,f)*t.MathUtils.radDeg):(f=0,p=0,S=90-Math.atan2(m,d)*t.MathUtils.radDeg);var A=i+o-S,b=i+s-S+90;v=t.MathUtils.cosDeg(A)*r,g=t.MathUtils.cosDeg(b)*a,y=t.MathUtils.sinDeg(A)*r,x=t.MathUtils.sinDeg(b)*a,this.a=f*v-d*y,this.b=f*g-d*x,this.c=p*v+m*y,this.d=p*g+m*x;break;case t.TransformMode.NoScale:case t.TransformMode.NoScaleOrReflection:var C,T=t.MathUtils.cosDeg(i),E=t.MathUtils.sinDeg(i),w=(f*T+d*E)/this.skeleton.scaleX,I=(p*T+m*E)/this.skeleton.scaleY;(C=Math.sqrt(w*w+I*I))>1e-5&&(C=1/C),w*=C,I*=C,C=Math.sqrt(w*w+I*I),this.data.transformMode==t.TransformMode.NoScale&&f*m-d*p<0!=(this.skeleton.scaleX<0!=this.skeleton.scaleY<0)&&(C=-C);var P=Math.PI/2+Math.atan2(I,w),D=Math.cos(P)*C,R=Math.sin(P)*C;v=t.MathUtils.cosDeg(o)*r,g=t.MathUtils.cosDeg(90+s)*a,y=t.MathUtils.sinDeg(o)*r,x=t.MathUtils.sinDeg(90+s)*a,this.a=w*v+D*y,this.b=w*g+D*x,this.c=I*v+R*y,this.d=I*g+R*x}this.a*=this.skeleton.scaleX,this.b*=this.skeleton.scaleX,this.c*=this.skeleton.scaleY,this.d*=this.skeleton.scaleY},e.prototype.setToSetupPose=function(){var t=this.data;this.x=t.x,this.y=t.y,this.rotation=t.rotation,this.scaleX=t.scaleX,this.scaleY=t.scaleY,this.shearX=t.shearX,this.shearY=t.shearY},e.prototype.getWorldRotationX=function(){return Math.atan2(this.c,this.a)*t.MathUtils.radDeg},e.prototype.getWorldRotationY=function(){return Math.atan2(this.d,this.b)*t.MathUtils.radDeg},e.prototype.getWorldScaleX=function(){return Math.sqrt(this.a*this.a+this.c*this.c)},e.prototype.getWorldScaleY=function(){return Math.sqrt(this.b*this.b+this.d*this.d)},e.prototype.updateAppliedTransform=function(){this.appliedValid=!0;var e=this.parent;if(null==e)return this.ax=this.worldX,this.ay=this.worldY,this.arotation=Math.atan2(this.c,this.a)*t.MathUtils.radDeg,this.ascaleX=Math.sqrt(this.a*this.a+this.c*this.c),this.ascaleY=Math.sqrt(this.b*this.b+this.d*this.d),this.ashearX=0,void(this.ashearY=Math.atan2(this.a*this.b+this.c*this.d,this.a*this.d-this.b*this.c)*t.MathUtils.radDeg);var n=e.a,i=e.b,r=e.c,a=e.d,o=1/(n*a-i*r),s=this.worldX-e.worldX,c=this.worldY-e.worldY;this.ax=s*a*o-c*i*o,this.ay=c*n*o-s*r*o;var l=o*a,h=o*n,u=o*i,_=o*r,f=l*this.a-u*this.c,d=l*this.b-u*this.d,p=h*this.c-_*this.a,m=h*this.d-_*this.b;if(this.ashearX=0,this.ascaleX=Math.sqrt(f*f+p*p),this.ascaleX>1e-4){var v=f*m-d*p;this.ascaleY=v/this.ascaleX,this.ashearY=Math.atan2(f*d+p*m,v)*t.MathUtils.radDeg,this.arotation=Math.atan2(p,f)*t.MathUtils.radDeg}else this.ascaleX=0,this.ascaleY=Math.sqrt(d*d+m*m),this.ashearY=0,this.arotation=90-Math.atan2(m,d)*t.MathUtils.radDeg},e.prototype.worldToLocal=function(t){var e=this.a,n=this.b,i=this.c,r=this.d,a=1/(e*r-n*i),o=t.x-this.worldX,s=t.y-this.worldY;return t.x=o*r*a-s*n*a,t.y=s*e*a-o*i*a,t},e.prototype.localToWorld=function(t){var e=t.x,n=t.y;return t.x=e*this.a+n*this.b+this.worldX,t.y=e*this.c+n*this.d+this.worldY,t},e.prototype.worldToLocalRotation=function(e){var n=t.MathUtils.sinDeg(e),i=t.MathUtils.cosDeg(e);return Math.atan2(this.a*n-this.c*i,this.d*i-this.b*n)*t.MathUtils.radDeg+this.rotation-this.shearX},e.prototype.localToWorldRotation=function(e){e-=this.rotation-this.shearX;var n=t.MathUtils.sinDeg(e),i=t.MathUtils.cosDeg(e);return Math.atan2(i*this.c+n*this.d,i*this.a+n*this.b)*t.MathUtils.radDeg},e.prototype.rotateWorld=function(e){var n=this.a,i=this.b,r=this.c,a=this.d,o=t.MathUtils.cosDeg(e),s=t.MathUtils.sinDeg(e);this.a=o*n-s*r,this.b=o*i-s*a,this.c=s*n+o*r,this.d=s*i+o*a,this.appliedValid=!1},e}();t.Bone=e}(zlt||(zlt={})),function(t){var e;t.BoneData=function(n,i,r){if(this.x=0,this.y=0,this.rotation=0,this.scaleX=1,this.scaleY=1,this.shearX=0,this.shearY=0,this.transformMode=e.Normal,this.skinRequired=!1,this.color=new t.Color,n<0)throw new Error("index must be >= 0.");if(null==i)throw new Error("name cannot be null.");this.index=n,this.name=i,this.parent=r},function(t){t[t.Normal=0]="Normal",t[t.OnlyTranslation=1]="OnlyTranslation",t[t.NoRotationOrReflection=2]="NoRotationOrReflection",t[t.NoScale=3]="NoScale",t[t.NoScaleOrReflection=4]="NoScaleOrReflection"}(e=t.TransformMode||(t.TransformMode={}))}(zlt||(zlt={})),function(t){t.ConstraintData=function(t,e,n){this.name=t,this.order=e,this.skinRequired=n}}(zlt||(zlt={})),function(t){t.Event=function(t,e){if(null==e)throw new Error("data cannot be null.");this.time=t,this.data=e}}(zlt||(zlt={})),function(t){t.EventData=function(t){this.name=t}}(zlt||(zlt={})),function(t){var e=function(){function e(t,e){if(this.bendDirection=0,this.compress=!1,this.stretch=!1,this.mix=1,this.softness=0,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.mix=t.mix,this.softness=t.softness,this.bendDirection=t.bendDirection,this.compress=t.compress,this.stretch=t.stretch,this.bones=new Array;for(var n=0;n<t.bones.length;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findBone(t.target.name)}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){var t=this.target,e=this.bones;switch(e.length){case 1:this.apply1(e[0],t.worldX,t.worldY,this.compress,this.stretch,this.data.uniform,this.mix);break;case 2:this.apply2(e[0],e[1],t.worldX,t.worldY,this.bendDirection,this.stretch,this.softness,this.mix)}},e.prototype.apply1=function(e,n,i,r,a,o,s){e.appliedValid||e.updateAppliedTransform();var c=e.parent,l=1/(c.a*c.d-c.b*c.c),h=n-c.worldX,u=i-c.worldY,_=(h*c.d-u*c.b)*l-e.ax,f=(u*c.a-h*c.c)*l-e.ay,d=Math.atan2(f,_)*t.MathUtils.radDeg-e.ashearX-e.arotation;e.ascaleX<0&&(d+=180),d>180?d-=360:d<-180&&(d+=360);var p=e.ascaleX,m=e.ascaleY;if(r||a){var v=e.data.length*p,g=Math.sqrt(_*_+f*f);if(r&&g<v||a&&g>v&&v>1e-4){var y=(g/v-1)*s+1;p*=y,o&&(m*=y)}}e.updateWorldTransformWith(e.ax,e.ay,e.arotation+d*s,p,m,e.ashearX,e.ashearY)},e.prototype.apply2=function(e,n,i,r,a,o,s,c){if(0!=c){e.appliedValid||e.updateAppliedTransform(),n.appliedValid||n.updateAppliedTransform();var l=e.ax,h=e.ay,u=e.ascaleX,_=u,f=e.ascaleY,d=n.ascaleX,p=0,m=0,v=0;u<0?(u=-u,p=180,v=-1):(p=0,v=1),f<0&&(f=-f,v=-v),d<0?(d=-d,m=180):m=0;var g=n.ax,y=0,x=0,S=0,A=e.a,b=e.b,C=e.c,T=e.d,E=Math.abs(u-f)<=1e-4;E?(x=A*g+b*(y=n.ay)+e.worldX,S=C*g+T*y+e.worldY):(y=0,x=A*g+e.worldX,S=C*g+e.worldY);var w=e.parent;A=w.a,b=w.b,C=w.c;var I,P,D=1/(A*(T=w.d)-b*C),R=x-w.worldX,M=S-w.worldY,O=(R*T-M*b)*D-l,N=(M*A-R*C)*D-h,B=Math.sqrt(O*O+N*N),L=n.data.length*d;if(B<1e-4)return this.apply1(e,i,r,!1,o,!1,c),void n.updateWorldTransformWith(g,y,0,n.ascaleX,n.ascaleY,n.ashearX,n.ashearY);var F=((R=i-w.worldX)*T-(M=r-w.worldY)*b)*D-l,V=(M*A-R*C)*D-h,z=F*F+V*V;if(0!=s){s*=u*(d+1)/2;var k=Math.sqrt(z),U=k-B-L*u+s;if(U>0){var G=Math.min(1,U/(2*s))-1;z=(F-=(G=(U-s*(1-G*G))/k)*F)*F+(V-=G*V)*V}}t:if(E){var H=(z-B*B-(L*=u)*L)/(2*B*L);H<-1?H=-1:H>1&&(H=1,o&&(_*=(Math.sqrt(z)/(B+L)-1)*c+1)),P=Math.acos(H)*a,A=B+L*H,b=L*Math.sin(P),I=Math.atan2(V*A-F*b,F*A+V*b)}else{var j=(A=u*L)*A,W=(b=f*L)*b,q=Math.atan2(V,F),X=-2*W*B,Y=W-j;if((T=X*X-4*Y*(C=W*B*B+j*z-j*W))>=0){var K=Math.sqrt(T);X<0&&(K=-K);var J=(K=-(X+K)/2)/Y,Q=C/K,Z=Math.abs(J)<Math.abs(Q)?J:Q;if(Z*Z<=z){M=Math.sqrt(z-Z*Z)*a,I=q-Math.atan2(M,Z),P=Math.atan2(M/f,(Z-B)/u);break t}}var $=t.MathUtils.PI,tt=B-A,et=tt*tt,nt=0,it=0,rt=B+A,at=rt*rt,ot=0;(C=-A*B/(j-W))>=-1&&C<=1&&(C=Math.acos(C),(T=(R=A*Math.cos(C)+B)*R+(M=b*Math.sin(C))*M)<et&&($=C,et=T,tt=R,nt=M),T>at&&(it=C,at=T,rt=R,ot=M)),z<=(et+at)/2?(I=q-Math.atan2(nt*a,tt),P=$*a):(I=q-Math.atan2(ot*a,rt),P=it*a)}var st=Math.atan2(y,g)*v,ct=e.arotation;(I=(I-st)*t.MathUtils.radDeg+p-ct)>180?I-=360:I<-180&&(I+=360),e.updateWorldTransformWith(l,h,ct+I*c,_,e.ascaleY,0,0),ct=n.arotation,(P=((P+st)*t.MathUtils.radDeg-n.ashearX)*v+m-ct)>180?P-=360:P<-180&&(P+=360),n.updateWorldTransformWith(g,y,ct+P*c,n.ascaleX,n.ascaleY,n.ashearX,n.ashearY)}else n.updateWorldTransform()},e}();t.IkConstraint=e}(zlt||(zlt={})),function(t){var e=function(t){function e(e){var n=t.call(this,e,0,!1)||this;return n.bones=new Array,n.bendDirection=1,n.compress=!1,n.stretch=!1,n.uniform=!1,n.mix=1,n.softness=0,n}return klt(e,t),e}(t.ConstraintData);t.IkConstraintData=e}(zlt||(zlt={})),function(t){var e=function(){function e(t,e){if(this.position=0,this.spacing=0,this.rotateMix=0,this.translateMix=0,this.spaces=new Array,this.positions=new Array,this.world=new Array,this.curves=new Array,this.lengths=new Array,this.segments=new Array,this.active=!1,null==t)throw new Error("data cannot be null.");if(null==e)throw new Error("skeleton cannot be null.");this.data=t,this.bones=new Array;for(var n=0,i=t.bones.length;n<i;n++)this.bones.push(e.findBone(t.bones[n].name));this.target=e.findSlot(t.target.name),this.position=t.position,this.spacing=t.spacing,this.rotateMix=t.rotateMix,this.translateMix=t.translateMix}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){var n=this.target.getAttachment();if(n instanceof t.PathAttachment){var i=this.rotateMix,r=this.translateMix,a=i>0;if(r>0||a){var o=this.data,s=o.spacingMode==t.SpacingMode.Percent,c=o.rotateMode,l=c==t.RotateMode.Tangent,h=c==t.RotateMode.ChainScale,u=this.bones.length,_=l?u:u+1,f=this.bones,d=t.Utils.setArraySize(this.spaces,_),p=null,m=this.spacing;if(h||!s){h&&(p=t.Utils.setArraySize(this.lengths,u));for(var v=o.spacingMode==t.SpacingMode.Length,g=0,y=_-1;g<y;){var x=(R=f[g]).data.length;if(x<e.epsilon)h&&(p[g]=0),d[++g]=0;else if(s){if(h){var S=x*R.a,A=x*R.c,b=Math.sqrt(S*S+A*A);p[g]=b}d[++g]=m}else{S=x*R.a,A=x*R.c;var C=Math.sqrt(S*S+A*A);h&&(p[g]=C),d[++g]=(v?x+m:m)*C/x}}}else for(g=1;g<_;g++)d[g]=m;var T=this.computeWorldPositions(n,_,l,o.positionMode==t.PositionMode.Percent,s),E=T[0],w=T[1],I=o.offsetRotation,P=!1;0==I?P=c==t.RotateMode.Chain:(P=!1,I*=(D=this.target.bone).a*D.d-D.b*D.c>0?t.MathUtils.degRad:-t.MathUtils.degRad),g=0;for(var D=3;g<u;g++,D+=3){var R;(R=f[g]).worldX+=(E-R.worldX)*r,R.worldY+=(w-R.worldY)*r;var M=(S=T[D])-E,O=(A=T[D+1])-w;if(h){var N=p[g];if(0!=N){var B=(Math.sqrt(M*M+O*O)/N-1)*i+1;R.a*=B,R.c*=B}}if(E=S,w=A,a){var L=R.a,F=R.b,V=R.c,z=R.d,k=0,U=0,G=0;if(k=l?T[D-1]:0==d[g+1]?T[D+2]:Math.atan2(O,M),k-=Math.atan2(V,L),P){U=Math.cos(k),G=Math.sin(k);var H=R.data.length;E+=(H*(U*L-G*V)-M)*i,w+=(H*(G*L+U*V)-O)*i}else k+=I;k>t.MathUtils.PI?k-=t.MathUtils.PI2:k<-t.MathUtils.PI&&(k+=t.MathUtils.PI2),k*=i,U=Math.cos(k),G=Math.sin(k),R.a=U*L-G*V,R.b=U*F-G*z,R.c=G*L+U*V,R.d=G*F+U*z}R.appliedValid=!1}}}},e.prototype.computeWorldPositions=function(n,i,r,a,o){var s=this.target,c=this.position,l=this.spaces,h=t.Utils.setArraySize(this.positions,3*i+2),u=null,_=n.closed,f=n.worldVerticesLength,d=f/6,p=e.NONE;if(!n.constantSpeed){var m=n.lengths,v=m[d-=_?1:2];if(a&&(c*=v),o)for(var g=1;g<i;g++)l[g]*=v;u=t.Utils.setArraySize(this.world,8),g=0;for(var y=0,x=0;g<i;g++,y+=3){var S=c+=W=l[g];if(_)(S%=v)<0&&(S+=v),x=0;else{if(S<0){p!=e.BEFORE&&(p=e.BEFORE,n.computeWorldVertices(s,2,4,u,0,2)),this.addBeforePosition(S,u,0,h,y);continue}if(S>v){p!=e.AFTER&&(p=e.AFTER,n.computeWorldVertices(s,f-6,4,u,0,2)),this.addAfterPosition(S-v,u,0,h,y);continue}}for(;;x++){var A=m[x];if(!(S>A)){0==x?S/=A:S=(S-(K=m[x-1]))/(A-K);break}}x!=p&&(p=x,_&&x==d?(n.computeWorldVertices(s,f-4,4,u,0,2),n.computeWorldVertices(s,0,4,u,4,2)):n.computeWorldVertices(s,6*x+2,8,u,0,2)),this.addCurvePosition(S,u[0],u[1],u[2],u[3],u[4],u[5],u[6],u[7],h,y,r||g>0&&0==W)}return h}_?(f+=2,u=t.Utils.setArraySize(this.world,f),n.computeWorldVertices(s,2,f-4,u,0,2),n.computeWorldVertices(s,0,2,u,f-4,2),u[f-2]=u[0],u[f-1]=u[1]):(d--,f-=4,u=t.Utils.setArraySize(this.world,f),n.computeWorldVertices(s,2,f,u,0,2));for(var b=t.Utils.setArraySize(this.curves,d),C=0,T=u[0],E=u[1],w=0,I=0,P=0,D=0,R=0,M=0,O=0,N=0,B=0,L=0,F=0,V=0,z=0,k=0,U=(g=0,2);g<d;g++,U+=6)w=u[U],I=u[U+1],P=u[U+2],D=u[U+3],F=2*(O=.1875*(T-2*w+P))+(B=.09375*(3*(w-P)-T+(R=u[U+4]))),V=2*(N=.1875*(E-2*I+D))+(L=.09375*(3*(I-D)-E+(M=u[U+5]))),z=.75*(w-T)+O+.16666667*B,k=.75*(I-E)+N+.16666667*L,C+=Math.sqrt(z*z+k*k),z+=F,k+=V,F+=B,V+=L,C+=Math.sqrt(z*z+k*k),z+=F,k+=V,C+=Math.sqrt(z*z+k*k),z+=F+B,k+=V+L,C+=Math.sqrt(z*z+k*k),b[g]=C,T=R,E=M;if(c*=a?C:C/n.lengths[d-1],o)for(g=1;g<i;g++)l[g]*=C;for(var G=this.segments,H=0,j=(g=0,y=0,x=0,0);g<i;g++,y+=3){var W;if(S=c+=W=l[g],_)(S%=C)<0&&(S+=C),x=0;else{if(S<0){this.addBeforePosition(S,u,0,h,y);continue}if(S>C){this.addAfterPosition(S-C,u,f-4,h,y);continue}}for(;;x++){var q=b[x];if(!(S>q)){0==x?S/=q:S=(S-(K=b[x-1]))/(q-K);break}}if(x!=p){p=x;var X=6*x;for(T=u[X],E=u[X+1],w=u[X+2],I=u[X+3],P=u[X+4],D=u[X+5],F=2*(O=.03*(T-2*w+P))+(B=.006*(3*(w-P)-T+(R=u[X+6]))),V=2*(N=.03*(E-2*I+D))+(L=.006*(3*(I-D)-E+(M=u[X+7]))),z=.3*(w-T)+O+.16666667*B,k=.3*(I-E)+N+.16666667*L,H=Math.sqrt(z*z+k*k),G[0]=H,X=1;X<8;X++)z+=F,k+=V,F+=B,V+=L,H+=Math.sqrt(z*z+k*k),G[X]=H;z+=F,k+=V,H+=Math.sqrt(z*z+k*k),G[8]=H,z+=F+B,k+=V+L,H+=Math.sqrt(z*z+k*k),G[9]=H,j=0}for(S*=H;;j++){var Y=G[j];if(!(S>Y)){var K;0==j?S/=Y:S=j+(S-(K=G[j-1]))/(Y-K);break}}this.addCurvePosition(.1*S,T,E,w,I,P,D,R,M,h,y,r||g>0&&0==W)}return h},e.prototype.addBeforePosition=function(t,e,n,i,r){var a=e[n],o=e[n+1],s=e[n+2]-a,c=e[n+3]-o,l=Math.atan2(c,s);i[r]=a+t*Math.cos(l),i[r+1]=o+t*Math.sin(l),i[r+2]=l},e.prototype.addAfterPosition=function(t,e,n,i,r){var a=e[n+2],o=e[n+3],s=a-e[n],c=o-e[n+1],l=Math.atan2(c,s);i[r]=a+t*Math.cos(l),i[r+1]=o+t*Math.sin(l),i[r+2]=l},e.prototype.addCurvePosition=function(t,e,n,i,r,a,o,s,c,l,h,u){if(0==t||isNaN(t))return l[h]=e,l[h+1]=n,void(l[h+2]=Math.atan2(r-n,i-e));var _=t*t,f=_*t,d=1-t,p=d*d,m=p*d,v=d*t,g=3*v,y=d*g,x=g*t,S=e*m+i*y+a*x+s*f,A=n*m+r*y+o*x+c*f;l[h]=S,l[h+1]=A,u&&(l[h+2]=t<.001?Math.atan2(r-n,i-e):Math.atan2(A-(n*p+r*v*2+o*_),S-(e*p+i*v*2+a*_)))},e.NONE=-1,e.BEFORE=-2,e.AFTER=-3,e.epsilon=1e-5,e}();t.PathConstraint=e}(zlt||(zlt={})),function(t){var e,n,i,r=function(t){function e(e){var n=t.call(this,e,0,!1)||this;return n.bones=new Array,n}return klt(e,t),e}(t.ConstraintData);t.PathConstraintData=r,(i=t.PositionMode||(t.PositionMode={}))[i.Fixed=0]="Fixed",i[i.Percent=1]="Percent",(n=t.SpacingMode||(t.SpacingMode={}))[n.Length=0]="Length",n[n.Fixed=1]="Fixed",n[n.Percent=2]="Percent",(e=t.RotateMode||(t.RotateMode={}))[e.Tangent=0]="Tangent",e[e.Chain=1]="Chain",e[e.ChainScale=2]="ChainScale"}(zlt||(zlt={})),function(t){var e=function(){function t(t){this.toLoad=new Array,this.assets={},this.clientId=t}return t.prototype.loaded=function(){var t=0;for(var e in this.assets)t++;return t},t}(),n=function(){function t(t){void 0===t&&(t=""),this.clientAssets={},this.queuedAssets={},this.rawAssets={},this.errors={},this.pathPrefix=t}return t.prototype.queueAsset=function(t,n,i){var r=this.clientAssets[t];return null==r&&(r=new e(t),this.clientAssets[t]=r),null!==n&&(r.textureLoader=n),r.toLoad.push(i),this.queuedAssets[i]!==i&&(this.queuedAssets[i]=i,!0)},t.prototype.loadText=function(t,e){var n=this;if(e=this.pathPrefix+e,this.queueAsset(t,null,e)){var i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(i.status>=200&&i.status<300?n.rawAssets[e]=i.responseText:n.errors[e]="Couldn't load text "+e+": status "+i.status+", "+i.responseText)},i.open("GET",e,!0),i.send()}},t.prototype.loadJson=function(t,e){var n=this;if(e=this.pathPrefix+e,this.queueAsset(t,null,e)){var i=new XMLHttpRequest;i.onreadystatechange=function(){i.readyState==XMLHttpRequest.DONE&&(i.status>=200&&i.status<300?n.rawAssets[e]=JSON.parse(i.responseText):n.errors[e]="Couldn't load text "+e+": status "+i.status+", "+i.responseText)},i.open("GET",e,!0),i.send()}},t.prototype.loadTexture=function(t,e,n){var i=this;if(n=this.pathPrefix+n,this.queueAsset(t,e,n)){var r=new Image;r.src=n,r.crossOrigin="anonymous",r.onload=function(){i.rawAssets[n]=r},r.onerror=function(){i.errors[n]="Couldn't load image "+n}}},t.prototype.get=function(t,e){e=this.pathPrefix+e;var n=this.clientAssets[t];return null==n||n.assets[e]},t.prototype.updateClientAssets=function(t){for(var e=0;e<t.toLoad.length;e++){var n=t.toLoad[e];if(null==t.assets[n]){var i=this.rawAssets[n];if(null==i)continue;i instanceof HTMLImageElement?t.assets[n]=t.textureLoader(i):t.assets[n]=i}}},t.prototype.isLoadingComplete=function(t){var e=this.clientAssets[t];return null==e||(this.updateClientAssets(e),e.toLoad.length==e.loaded())},t.prototype.dispose=function(){},t.prototype.hasErrors=function(){return Object.keys(this.errors).length>0},t.prototype.getErrors=function(){return this.errors},t}();t.SharedAssetManager=n}(zlt||(zlt={})),function(t){var e=function(){function e(e){if(this._updateCache=new Array,this.updateCacheReset=new Array,this.time=0,this.scaleX=1,this.scaleY=1,this.x=0,this.y=0,null==e)throw new Error("data cannot be null.");this.data=e,this.bones=new Array;for(var n=0;n<e.bones.length;n++){var i=e.bones[n],r=void 0;if(null==i.parent)r=new t.Bone(i,this,null);else{var a=this.bones[i.parent.index];r=new t.Bone(i,this,a),a.children.push(r)}this.bones.push(r)}for(this.slots=new Array,this.drawOrder=new Array,n=0;n<e.slots.length;n++){var o=e.slots[n],s=(r=this.bones[o.boneData.index],new t.Slot(o,r));this.slots.push(s),this.drawOrder.push(s)}for(this.ikConstraints=new Array,n=0;n<e.ikConstraints.length;n++){var c=e.ikConstraints[n];this.ikConstraints.push(new t.IkConstraint(c,this))}for(this.transformConstraints=new Array,n=0;n<e.transformConstraints.length;n++){var l=e.transformConstraints[n];this.transformConstraints.push(new t.TransformConstraint(l,this))}for(this.pathConstraints=new Array,n=0;n<e.pathConstraints.length;n++){var h=e.pathConstraints[n];this.pathConstraints.push(new t.PathConstraint(h,this))}this.color=new t.Color(1,1,1,1),this.updateCache()}return e.prototype.updateCache=function(){this._updateCache.length=0,this.updateCacheReset.length=0;for(var t=this.bones,e=0,n=t.length;e<n;e++)(r=t[e]).sorted=r.data.skinRequired,r.active=!r.sorted;if(null!=this.skin){var i=this.skin.bones;for(e=0,n=this.skin.bones.length;e<n;e++){var r=this.bones[i[e].index];do{r.sorted=!1,r.active=!0,r=r.parent}while(null!=r)}}var a=this.ikConstraints,o=this.transformConstraints,s=this.pathConstraints,c=a.length,l=o.length,h=s.length,u=c+l+h;t:for(e=0;e<u;e++){for(var _=0;_<c;_++)if((f=a[_]).data.order==e){this.sortIkConstraint(f);continue t}for(_=0;_<l;_++)if((f=o[_]).data.order==e){this.sortTransformConstraint(f);continue t}for(_=0;_<h;_++){var f;if((f=s[_]).data.order==e){this.sortPathConstraint(f);continue t}}}for(e=0,n=t.length;e<n;e++)this.sortBone(t[e])},e.prototype.sortIkConstraint=function(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){var n=e.target;this.sortBone(n);var i=e.bones,r=i[0];if(this.sortBone(r),i.length>1){var a=i[i.length-1];this._updateCache.indexOf(a)>-1||this.updateCacheReset.push(a)}this._updateCache.push(e),this.sortReset(r.children),i[i.length-1].sorted=!0}},e.prototype.sortPathConstraint=function(e){if(e.active=e.target.bone.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){var n=e.target,i=n.data.index,r=n.bone;null!=this.skin&&this.sortPathConstraintAttachment(this.skin,i,r),null!=this.data.defaultSkin&&this.data.defaultSkin!=this.skin&&this.sortPathConstraintAttachment(this.data.defaultSkin,i,r);for(var a=0,o=this.data.skins.length;a<o;a++)this.sortPathConstraintAttachment(this.data.skins[a],i,r);var s=n.getAttachment();s instanceof t.PathAttachment&&this.sortPathConstraintAttachmentWith(s,r);var c=e.bones,l=c.length;for(a=0;a<l;a++)this.sortBone(c[a]);for(this._updateCache.push(e),a=0;a<l;a++)this.sortReset(c[a].children);for(a=0;a<l;a++)c[a].sorted=!0}},e.prototype.sortTransformConstraint=function(e){if(e.active=e.target.isActive()&&(!e.data.skinRequired||null!=this.skin&&t.Utils.contains(this.skin.constraints,e.data,!0)),e.active){this.sortBone(e.target);var n=e.bones,i=n.length;if(e.data.local)for(var r=0;r<i;r++){var a=n[r];this.sortBone(a.parent),this._updateCache.indexOf(a)>-1||this.updateCacheReset.push(a)}else for(r=0;r<i;r++)this.sortBone(n[r]);this._updateCache.push(e);for(var o=0;o<i;o++)this.sortReset(n[o].children);for(o=0;o<i;o++)n[o].sorted=!0}},e.prototype.sortPathConstraintAttachment=function(t,e,n){var i=t.attachments[e];if(i)for(var r in i)this.sortPathConstraintAttachmentWith(i[r],n)},e.prototype.sortPathConstraintAttachmentWith=function(e,n){if(e instanceof t.PathAttachment){var i=e.bones;if(null==i)this.sortBone(n);else for(var r=this.bones,a=0;a<i.length;)for(var o=i[a++],s=a+o;a<s;a++){var c=i[a];this.sortBone(r[c])}}},e.prototype.sortBone=function(t){if(!t.sorted){var e=t.parent;null!=e&&this.sortBone(e),t.sorted=!0,this._updateCache.push(t)}},e.prototype.sortReset=function(t){for(var e=0,n=t.length;e<n;e++){var i=t[e];i.active&&(i.sorted&&this.sortReset(i.children),i.sorted=!1)}},e.prototype.updateWorldTransform=function(){for(var t=this.updateCacheReset,e=0,n=t.length;e<n;e++){var i=t[e];i.ax=i.x,i.ay=i.y,i.arotation=i.rotation,i.ascaleX=i.scaleX,i.ascaleY=i.scaleY,i.ashearX=i.shearX,i.ashearY=i.shearY,i.appliedValid=!0}var r=this._updateCache;for(e=0,n=r.length;e<n;e++)r[e].update()},e.prototype.setToSetupPose=function(){this.setBonesToSetupPose(),this.setSlotsToSetupPose()},e.prototype.setBonesToSetupPose=function(){for(var t=this.bones,e=0,n=t.length;e<n;e++)t[e].setToSetupPose();var i=this.ikConstraints;for(e=0,n=i.length;e<n;e++)(s=i[e]).mix=s.data.mix,s.softness=s.data.softness,s.bendDirection=s.data.bendDirection,s.compress=s.data.compress,s.stretch=s.data.stretch;var r=this.transformConstraints;for(e=0,n=r.length;e<n;e++){var a=(s=r[e]).data;s.rotateMix=a.rotateMix,s.translateMix=a.translateMix,s.scaleMix=a.scaleMix,s.shearMix=a.shearMix}var o=this.pathConstraints;for(e=0,n=o.length;e<n;e++){var s;a=(s=o[e]).data,s.position=a.position,s.spacing=a.spacing,s.rotateMix=a.rotateMix,s.translateMix=a.translateMix}},e.prototype.setSlotsToSetupPose=function(){var e=this.slots;t.Utils.arrayCopy(e,0,this.drawOrder,0,e.length);for(var n=0,i=e.length;n<i;n++)e[n].setToSetupPose()},e.prototype.getRootBone=function(){return 0==this.bones.length?null:this.bones[0]},e.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,i=e.length;n<i;n++){var r=e[n];if(r.data.name==t)return r}return null},e.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,i=e.length;n<i;n++)if(e[n].data.name==t)return n;return-1},e.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,i=e.length;n<i;n++){var r=e[n];if(r.data.name==t)return r}return null},e.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,i=e.length;n<i;n++)if(e[n].data.name==t)return n;return-1},e.prototype.setSkinByName=function(t){var e=this.data.findSkin(t);if(null==e)throw new Error("Skin not found: "+t);this.setSkin(e)},e.prototype.setSkin=function(t){if(t!=this.skin){if(null!=t)if(null!=this.skin)t.attachAll(this,this.skin);else for(var e=this.slots,n=0,i=e.length;n<i;n++){var r=e[n],a=r.data.attachmentName;if(null!=a){var o=t.getAttachment(n,a);null!=o&&r.setAttachment(o)}}this.skin=t,this.updateCache()}},e.prototype.getAttachmentByName=function(t,e){return this.getAttachment(this.data.findSlotIndex(t),e)},e.prototype.getAttachment=function(t,e){if(null==e)throw new Error("attachmentName cannot be null.");if(null!=this.skin){var n=this.skin.getAttachment(t,e);if(null!=n)return n}return null!=this.data.defaultSkin?this.data.defaultSkin.getAttachment(t,e):null},e.prototype.setAttachment=function(t,e){if(null==t)throw new Error("slotName cannot be null.");for(var n=this.slots,i=0,r=n.length;i<r;i++){var a=n[i];if(a.data.name==t){var o=null;if(null!=e&&null==(o=this.getAttachment(i,e)))throw new Error("Attachment not found: "+e+", for slot: "+t);return void a.setAttachment(o)}}throw new Error("Slot not found: "+t)},e.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,n=0,i=e.length;n<i;n++){var r=e[n];if(r.data.name==t)return r}return null},e.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,n=0,i=e.length;n<i;n++){var r=e[n];if(r.data.name==t)return r}return null},e.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,n=0,i=e.length;n<i;n++){var r=e[n];if(r.data.name==t)return r}return null},e.prototype.getBounds=function(e,n,i){if(void 0===i&&(i=new Array(2)),null==e)throw new Error("offset cannot be null.");if(null==n)throw new Error("size cannot be null.");for(var r=this.drawOrder,a=Number.POSITIVE_INFINITY,o=Number.POSITIVE_INFINITY,s=Number.NEGATIVE_INFINITY,c=Number.NEGATIVE_INFINITY,l=0,h=r.length;l<h;l++){var u=r[l];if(u.bone.active){var _=0,f=null,d=u.getAttachment();if(d instanceof t.RegionAttachment)_=8,f=t.Utils.setArraySize(i,_,0),d.computeWorldVertices(u.bone,f,0,2);else if(d instanceof t.MeshAttachment){var p=d;_=p.worldVerticesLength,f=t.Utils.setArraySize(i,_,0),p.computeWorldVertices(u,0,_,f,0,2)}if(null!=f)for(var m=0,v=f.length;m<v;m+=2){var g=f[m],y=f[m+1];a=Math.min(a,g),o=Math.min(o,y),s=Math.max(s,g),c=Math.max(c,y)}}}e.set(a,o),n.set(s-a,c-o)},e.prototype.update=function(t){this.time+=t},e}();t.Skeleton=e}(zlt||(zlt={})),function(t){var e=function(){function e(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return e.prototype.readSkeletonData=function(i){var r=this.scale,a=new t.SkeletonData;a.name="";var o=new n(i);a.hash=o.readString(),a.version=o.readString(),a.x=o.readFloat(),a.y=o.readFloat(),a.width=o.readFloat(),a.height=o.readFloat();var s=o.readBoolean();s&&(a.fps=o.readFloat(),a.imagesPath=o.readString(),a.audioPath=o.readString());var c=0;c=o.readInt(!0);for(var l=0;l<c;l++)o.strings.push(o.readString());for(c=o.readInt(!0),l=0;l<c;l++){var h=o.readString(),u=0==l?null:a.bones[o.readInt(!0)];(d=new t.BoneData(l,h,u)).rotation=o.readFloat(),d.x=o.readFloat()*r,d.y=o.readFloat()*r,d.scaleX=o.readFloat(),d.scaleY=o.readFloat(),d.shearX=o.readFloat(),d.shearY=o.readFloat(),d.length=o.readFloat()*r,d.transformMode=e.TransformModeValues[o.readInt(!0)],d.skinRequired=o.readBoolean(),s&&t.Color.rgba8888ToColor(d.color,o.readInt32()),a.bones.push(d)}for(c=o.readInt(!0),l=0;l<c;l++){var _=o.readString(),f=a.bones[o.readInt(!0)],d=new t.SlotData(l,_,f);t.Color.rgba8888ToColor(d.color,o.readInt32());var p=o.readInt32();-1!=p&&t.Color.rgb888ToColor(d.darkColor=new t.Color,p),d.attachmentName=o.readStringRef(),d.blendMode=e.BlendModeValues[o.readInt(!0)],a.slots.push(d)}c=o.readInt(!0),l=0;for(var m=void 0;l<c;l++){(d=new t.IkConstraintData(o.readString())).order=o.readInt(!0),d.skinRequired=o.readBoolean(),m=o.readInt(!0);for(var v=0;v<m;v++)d.bones.push(a.bones[o.readInt(!0)]);d.target=a.bones[o.readInt(!0)],d.mix=o.readFloat(),d.softness=o.readFloat()*r,d.bendDirection=o.readByte(),d.compress=o.readBoolean(),d.stretch=o.readBoolean(),d.uniform=o.readBoolean(),a.ikConstraints.push(d)}for(c=o.readInt(!0),l=0,m=void 0;l<c;l++){for((d=new t.TransformConstraintData(o.readString())).order=o.readInt(!0),d.skinRequired=o.readBoolean(),m=o.readInt(!0),v=0;v<m;v++)d.bones.push(a.bones[o.readInt(!0)]);d.target=a.bones[o.readInt(!0)],d.local=o.readBoolean(),d.relative=o.readBoolean(),d.offsetRotation=o.readFloat(),d.offsetX=o.readFloat()*r,d.offsetY=o.readFloat()*r,d.offsetScaleX=o.readFloat(),d.offsetScaleY=o.readFloat(),d.offsetShearY=o.readFloat(),d.rotateMix=o.readFloat(),d.translateMix=o.readFloat(),d.scaleMix=o.readFloat(),d.shearMix=o.readFloat(),a.transformConstraints.push(d)}for(c=o.readInt(!0),l=0,m=void 0;l<c;l++){for((d=new t.PathConstraintData(o.readString())).order=o.readInt(!0),d.skinRequired=o.readBoolean(),m=o.readInt(!0),v=0;v<m;v++)d.bones.push(a.bones[o.readInt(!0)]);d.target=a.slots[o.readInt(!0)],d.positionMode=e.PositionModeValues[o.readInt(!0)],d.spacingMode=e.SpacingModeValues[o.readInt(!0)],d.rotateMode=e.RotateModeValues[o.readInt(!0)],d.offsetRotation=o.readFloat(),d.position=o.readFloat(),d.positionMode==t.PositionMode.Fixed&&(d.position*=r),d.spacing=o.readFloat(),d.spacingMode!=t.SpacingMode.Length&&d.spacingMode!=t.SpacingMode.Fixed||(d.spacing*=r),d.rotateMix=o.readFloat(),d.translateMix=o.readFloat(),a.pathConstraints.push(d)}var g=this.readSkin(o,a,!0,s);for(null!=g&&(a.defaultSkin=g,a.skins.push(g)),l=a.skins.length,t.Utils.setArraySize(a.skins,c=l+o.readInt(!0));l<c;l++)a.skins[l]=this.readSkin(o,a,!1,s);for(c=this.linkedMeshes.length,l=0;l<c;l++){var y=this.linkedMeshes[l],x=null==y.skin?a.defaultSkin:a.findSkin(y.skin);if(null==x)throw new Error("Skin not found: "+y.skin);var S=x.getAttachment(y.slotIndex,y.parent);if(null==S)throw new Error("Parent mesh not found: "+y.parent);y.mesh.deformAttachment=y.inheritDeform?S:y.mesh,y.mesh.setParentMesh(S),y.mesh.updateUVs()}for(this.linkedMeshes.length=0,c=o.readInt(!0),l=0;l<c;l++)(d=new t.EventData(o.readStringRef())).intValue=o.readInt(!1),d.floatValue=o.readFloat(),d.stringValue=o.readString(),d.audioPath=o.readString(),null!=d.audioPath&&(d.volume=o.readFloat(),d.balance=o.readFloat()),a.events.push(d);for(c=o.readInt(!0),l=0;l<c;l++)a.animations.push(this.readAnimation(o,o.readString(),a));return a},e.prototype.readSkin=function(e,n,i,r){var a=null,o=0;if(i){if(0==(o=e.readInt(!0)))return null;a=new t.Skin("default")}else{(a=new t.Skin(e.readStringRef())).bones.length=e.readInt(!0);for(var s=0,c=a.bones.length;s<c;s++)a.bones[s]=n.bones[e.readInt(!0)];for(s=0,c=e.readInt(!0);s<c;s++)a.constraints.push(n.ikConstraints[e.readInt(!0)]);for(s=0,c=e.readInt(!0);s<c;s++)a.constraints.push(n.transformConstraints[e.readInt(!0)]);for(s=0,c=e.readInt(!0);s<c;s++)a.constraints.push(n.pathConstraints[e.readInt(!0)]);o=e.readInt(!0)}for(s=0;s<o;s++)for(var l=e.readInt(!0),h=0,u=e.readInt(!0);h<u;h++){var _=e.readStringRef(),f=this.readAttachment(e,n,a,l,_,r);null!=f&&a.setAttachment(l,_,f)}return a},e.prototype.readAttachment=function(n,r,a,o,s,c){var l=this.scale,h=n.readStringRef();null==h&&(h=s);var u=n.readByte();switch(e.AttachmentTypeValues[u]){case t.AttachmentType.Region:var _=n.readStringRef(),f=n.readFloat(),d=n.readFloat(),p=n.readFloat(),m=n.readFloat(),v=n.readFloat(),g=n.readFloat(),y=n.readFloat(),x=n.readInt32();null==_&&(_=h);var S=this.attachmentLoader.newRegionAttachment(a,h,_);return null==S?null:(S.path=_,S.x=d*l,S.y=p*l,S.scaleX=m,S.scaleY=v,S.rotation=f,S.width=g*l,S.height=y*l,t.Color.rgba8888ToColor(S.color,x),S.updateOffset(),S);case t.AttachmentType.BoundingBox:var A=n.readInt(!0),b=this.readVertices(n,A),C=(x=c?n.readInt32():0,this.attachmentLoader.newBoundingBoxAttachment(a,h));return null==C?null:(C.worldVerticesLength=A<<1,C.vertices=b.vertices,C.bones=b.bones,c&&t.Color.rgba8888ToColor(C.color,x),C);case t.AttachmentType.Mesh:_=n.readStringRef(),x=n.readInt32(),A=n.readInt(!0);var T=this.readFloatArray(n,A<<1,1),E=this.readShortArray(n),w=(b=this.readVertices(n,A),n.readInt(!0)),I=null;return g=0,y=0,c&&(I=this.readShortArray(n),g=n.readFloat(),y=n.readFloat()),null==_&&(_=h),null==(P=this.attachmentLoader.newMeshAttachment(a,h,_))?null:(P.path=_,t.Color.rgba8888ToColor(P.color,x),P.bones=b.bones,P.vertices=b.vertices,P.worldVerticesLength=A<<1,P.triangles=E,P.regionUVs=T,P.updateUVs(),P.hullLength=w<<1,c&&(P.edges=I,P.width=g*l,P.height=y*l),P);case t.AttachmentType.LinkedMesh:_=n.readStringRef(),x=n.readInt32();var P,D=n.readStringRef(),R=n.readStringRef(),M=n.readBoolean();return g=0,y=0,c&&(g=n.readFloat(),y=n.readFloat()),null==_&&(_=h),null==(P=this.attachmentLoader.newMeshAttachment(a,h,_))?null:(P.path=_,t.Color.rgba8888ToColor(P.color,x),c&&(P.width=g*l,P.height=y*l),this.linkedMeshes.push(new i(P,D,o,R,M)),P);case t.AttachmentType.Path:for(var O=n.readBoolean(),N=n.readBoolean(),B=(A=n.readInt(!0),b=this.readVertices(n,A),t.Utils.newArray(A/3,0)),L=0,F=B.length;L<F;L++)B[L]=n.readFloat()*l;return x=c?n.readInt32():0,null==(_=this.attachmentLoader.newPathAttachment(a,h))?null:(_.closed=O,_.constantSpeed=N,_.worldVerticesLength=A<<1,_.vertices=b.vertices,_.bones=b.bones,_.lengths=B,c&&t.Color.rgba8888ToColor(_.color,x),_);case t.AttachmentType.Point:f=n.readFloat(),d=n.readFloat(),p=n.readFloat(),x=c?n.readInt32():0;var V=this.attachmentLoader.newPointAttachment(a,h);return null==V?null:(V.x=d*l,V.y=p*l,V.rotation=f,c&&t.Color.rgba8888ToColor(V.color,x),V);case t.AttachmentType.Clipping:var z=n.readInt(!0),k=(A=n.readInt(!0),b=this.readVertices(n,A),x=c?n.readInt32():0,this.attachmentLoader.newClippingAttachment(a,h));return null==k?null:(k.endSlot=r.slots[z],k.worldVerticesLength=A<<1,k.vertices=b.vertices,k.bones=b.bones,c&&t.Color.rgba8888ToColor(k.color,x),k)}return null},e.prototype.readVertices=function(e,n){var i=n<<1,a=new r,o=this.scale;if(!e.readBoolean())return a.vertices=this.readFloatArray(e,i,o),a;for(var s=new Array,c=new Array,l=0;l<n;l++){var h=e.readInt(!0);c.push(h);for(var u=0;u<h;u++)c.push(e.readInt(!0)),s.push(e.readFloat()*o),s.push(e.readFloat()*o),s.push(e.readFloat())}return a.vertices=t.Utils.toFloatArray(s),a.bones=c,a},e.prototype.readFloatArray=function(t,e,n){var i=new Array(e);if(1==n)for(var r=0;r<e;r++)i[r]=t.readFloat();else for(r=0;r<e;r++)i[r]=t.readFloat()*n;return i},e.prototype.readShortArray=function(t){for(var e=t.readInt(!0),n=new Array(e),i=0;i<e;i++)n[i]=t.readShort();return n},e.prototype.readAnimation=function(n,i,r){for(var a=new Array,o=this.scale,s=0,c=new t.Color,l=new t.Color,h=0,u=n.readInt(!0);h<u;h++)for(var _=n.readInt(!0),f=0,d=n.readInt(!0);f<d;f++){var p=n.readByte(),m=n.readInt(!0);switch(p){case e.SLOT_ATTACHMENT:(x=new t.AttachmentTimeline(m)).slotIndex=_;for(var v=0;v<m;v++)x.setFrame(v,n.readFloat(),n.readStringRef());a.push(x),s=Math.max(s,x.frames[m-1]);break;case e.SLOT_COLOR:for((x=new t.ColorTimeline(m)).slotIndex=_,v=0;v<m;v++){var g=n.readFloat();t.Color.rgba8888ToColor(c,n.readInt32()),x.setFrame(v,g,c.r,c.g,c.b,c.a),v<m-1&&this.readCurve(n,v,x)}a.push(x),s=Math.max(s,x.frames[(m-1)*t.ColorTimeline.ENTRIES]);break;case e.SLOT_TWO_COLOR:for((x=new t.TwoColorTimeline(m)).slotIndex=_,v=0;v<m;v++)g=n.readFloat(),t.Color.rgba8888ToColor(c,n.readInt32()),t.Color.rgb888ToColor(l,n.readInt32()),x.setFrame(v,g,c.r,c.g,c.b,c.a,l.r,l.g,l.b),v<m-1&&this.readCurve(n,v,x);a.push(x),s=Math.max(s,x.frames[(m-1)*t.TwoColorTimeline.ENTRIES])}}for(h=0,u=n.readInt(!0);h<u;h++){var y=n.readInt(!0);for(f=0,d=n.readInt(!0);f<d;f++)switch(p=n.readByte(),m=n.readInt(!0),p){case e.BONE_ROTATE:for((x=new t.RotateTimeline(m)).boneIndex=y,v=0;v<m;v++)x.setFrame(v,n.readFloat(),n.readFloat()),v<m-1&&this.readCurve(n,v,x);a.push(x),s=Math.max(s,x.frames[(m-1)*t.RotateTimeline.ENTRIES]);break;case e.BONE_TRANSLATE:case e.BONE_SCALE:case e.BONE_SHEAR:var x=void 0,S=1;for(p==e.BONE_SCALE?x=new t.ScaleTimeline(m):p==e.BONE_SHEAR?x=new t.ShearTimeline(m):(x=new t.TranslateTimeline(m),S=o),x.boneIndex=y,v=0;v<m;v++)x.setFrame(v,n.readFloat(),n.readFloat()*S,n.readFloat()*S),v<m-1&&this.readCurve(n,v,x);a.push(x),s=Math.max(s,x.frames[(m-1)*t.TranslateTimeline.ENTRIES])}}for(h=0,u=n.readInt(!0);h<u;h++){var A=n.readInt(!0);for(m=n.readInt(!0),(x=new t.IkConstraintTimeline(m)).ikConstraintIndex=A,v=0;v<m;v++)x.setFrame(v,n.readFloat(),n.readFloat(),n.readFloat()*o,n.readByte(),n.readBoolean(),n.readBoolean()),v<m-1&&this.readCurve(n,v,x);a.push(x),s=Math.max(s,x.frames[(m-1)*t.IkConstraintTimeline.ENTRIES])}for(h=0,u=n.readInt(!0);h<u;h++){for(A=n.readInt(!0),m=n.readInt(!0),(x=new t.TransformConstraintTimeline(m)).transformConstraintIndex=A,v=0;v<m;v++)x.setFrame(v,n.readFloat(),n.readFloat(),n.readFloat(),n.readFloat(),n.readFloat()),v<m-1&&this.readCurve(n,v,x);a.push(x),s=Math.max(s,x.frames[(m-1)*t.TransformConstraintTimeline.ENTRIES])}for(h=0,u=n.readInt(!0);h<u;h++){A=n.readInt(!0);var b=r.pathConstraints[A];for(f=0,d=n.readInt(!0);f<d;f++)switch(p=n.readByte(),m=n.readInt(!0),p){case e.PATH_POSITION:case e.PATH_SPACING:for(x=void 0,S=1,p==e.PATH_SPACING?(x=new t.PathConstraintSpacingTimeline(m),b.spacingMode!=t.SpacingMode.Length&&b.spacingMode!=t.SpacingMode.Fixed||(S=o)):(x=new t.PathConstraintPositionTimeline(m),b.positionMode==t.PositionMode.Fixed&&(S=o)),x.pathConstraintIndex=A,v=0;v<m;v++)x.setFrame(v,n.readFloat(),n.readFloat()*S),v<m-1&&this.readCurve(n,v,x);a.push(x),s=Math.max(s,x.frames[(m-1)*t.PathConstraintPositionTimeline.ENTRIES]);break;case e.PATH_MIX:for((x=new t.PathConstraintMixTimeline(m)).pathConstraintIndex=A,v=0;v<m;v++)x.setFrame(v,n.readFloat(),n.readFloat(),n.readFloat()),v<m-1&&this.readCurve(n,v,x);a.push(x),s=Math.max(s,x.frames[(m-1)*t.PathConstraintMixTimeline.ENTRIES])}}for(h=0,u=n.readInt(!0);h<u;h++){var C=r.skins[n.readInt(!0)];for(f=0,d=n.readInt(!0);f<d;f++){_=n.readInt(!0);for(var T=0,E=n.readInt(!0);T<E;T++){var w=C.getAttachment(_,n.readStringRef()),I=null!=w.bones,P=w.vertices,D=I?P.length/3*2:P.length;for(m=n.readInt(!0),(x=new t.DeformTimeline(m)).slotIndex=_,x.attachment=w,v=0;v<m;v++){g=n.readFloat();var R=void 0,M=n.readInt(!0);if(0==M)R=I?t.Utils.newFloatArray(D):P;else{R=t.Utils.newFloatArray(D);var O=n.readInt(!0);if(M+=O,1==o)for(var N=O;N<M;N++)R[N]=n.readFloat();else for(N=O;N<M;N++)R[N]=n.readFloat()*o;if(!I){N=0;for(var B=R.length;N<B;N++)R[N]+=P[N]}}x.setFrame(v,g,R),v<m-1&&this.readCurve(n,v,x)}a.push(x),s=Math.max(s,x.frames[m-1])}}}var L=n.readInt(!0);if(L>0){x=new t.DrawOrderTimeline(L);var F=r.slots.length;for(h=0;h<L;h++){g=n.readFloat();var V=n.readInt(!0),z=t.Utils.newArray(F,0);for(f=F-1;f>=0;f--)z[f]=-1;var k=t.Utils.newArray(F-V,0),U=0,G=0;for(f=0;f<V;f++){for(_=n.readInt(!0);U!=_;)k[G++]=U++;z[U+n.readInt(!0)]=U++}for(;U<F;)k[G++]=U++;for(f=F-1;f>=0;f--)-1==z[f]&&(z[f]=k[--G]);x.setFrame(h,g,z)}a.push(x),s=Math.max(s,x.frames[L-1])}var H=n.readInt(!0);if(H>0){for(x=new t.EventTimeline(H),h=0;h<H;h++){g=n.readFloat();var j=r.events[n.readInt(!0)],W=new t.Event(g,j);W.intValue=n.readInt(!1),W.floatValue=n.readFloat(),W.stringValue=n.readBoolean()?n.readString():j.stringValue,null!=W.data.audioPath&&(W.volume=n.readFloat(),W.balance=n.readFloat()),x.setFrame(h,W)}a.push(x),s=Math.max(s,x.frames[H-1])}return new t.Animation(i,a,s)},e.prototype.readCurve=function(t,n,i){switch(t.readByte()){case e.CURVE_STEPPED:i.setStepped(n);break;case e.CURVE_BEZIER:this.setCurve(i,n,t.readFloat(),t.readFloat(),t.readFloat(),t.readFloat())}},e.prototype.setCurve=function(t,e,n,i,r,a){t.setCurve(e,n,i,r,a)},e.AttachmentTypeValues=[0,1,2,3,4,5,6],e.TransformModeValues=[t.TransformMode.Normal,t.TransformMode.OnlyTranslation,t.TransformMode.NoRotationOrReflection,t.TransformMode.NoScale,t.TransformMode.NoScaleOrReflection],e.PositionModeValues=[t.PositionMode.Fixed,t.PositionMode.Percent],e.SpacingModeValues=[t.SpacingMode.Length,t.SpacingMode.Fixed,t.SpacingMode.Percent],e.RotateModeValues=[t.RotateMode.Tangent,t.RotateMode.Chain,t.RotateMode.ChainScale],e.BlendModeValues=[t.BlendMode.Normal,t.BlendMode.Additive,t.BlendMode.Multiply,t.BlendMode.Screen],e.BONE_ROTATE=0,e.BONE_TRANSLATE=1,e.BONE_SCALE=2,e.BONE_SHEAR=3,e.SLOT_ATTACHMENT=0,e.SLOT_COLOR=1,e.SLOT_TWO_COLOR=2,e.PATH_POSITION=0,e.PATH_SPACING=1,e.PATH_MIX=2,e.CURVE_LINEAR=0,e.CURVE_STEPPED=1,e.CURVE_BEZIER=2,e}();t.SkeletonBinary=e;var n=function(){function t(t,e,n,i){void 0===e&&(e=new Array),void 0===n&&(n=0),void 0===i&&(i=new DataView(t.buffer)),this.strings=e,this.index=n,this.buffer=i}return t.prototype.readByte=function(){return this.buffer.getInt8(this.index++)},t.prototype.readShort=function(){var t=this.buffer.getInt16(this.index);return this.index+=2,t},t.prototype.readInt32=function(){var t=this.buffer.getInt32(this.index);return this.index+=4,t},t.prototype.readInt=function(t){var e=this.readByte(),n=127&e;return 0!=(128&e)&&(n|=(127&(e=this.readByte()))<<7,0!=(128&e)&&(n|=(127&(e=this.readByte()))<<14,0!=(128&e)&&(n|=(127&(e=this.readByte()))<<21,0!=(128&e)&&(n|=(127&(e=this.readByte()))<<28)))),t?n:n>>>1^-(1&n)},t.prototype.readStringRef=function(){var t=this.readInt(!0);return 0==t?null:this.strings[t-1]},t.prototype.readString=function(){var t=this.readInt(!0);switch(t){case 0:return null;case 1:return""}t--;for(var e="",n=0;n<t;){var i=this.readByte();switch(i>>4){case 12:case 13:e+=String.fromCharCode((31&i)<<6|63&this.readByte()),n+=2;break;case 14:e+=String.fromCharCode((15&i)<<12|(63&this.readByte())<<6|63&this.readByte()),n+=3;break;default:e+=String.fromCharCode(i),n++}}return e},t.prototype.readFloat=function(){var t=this.buffer.getFloat32(this.index);return this.index+=4,t},t.prototype.readBoolean=function(){return 0!=this.readByte()},t}(),i=function(t,e,n,i,r){this.mesh=t,this.skin=e,this.slotIndex=n,this.parent=i,this.inheritDeform=r},r=function(t,e){void 0===t&&(t=null),void 0===e&&(e=null),this.bones=t,this.vertices=e}}(zlt||(zlt={})),function(t){var e=function(){function e(){this.minX=0,this.minY=0,this.maxX=0,this.maxY=0,this.boundingBoxes=new Array,this.polygons=new Array,this.polygonPool=new t.Pool((function(){return t.Utils.newFloatArray(16)}))}return e.prototype.update=function(e,n){if(null==e)throw new Error("skeleton cannot be null.");var i=this.boundingBoxes,r=this.polygons,a=this.polygonPool,o=e.slots,s=o.length;i.length=0,a.freeAll(r),r.length=0;for(var c=0;c<s;c++){var l=o[c];if(l.bone.active){var h=l.getAttachment();if(h instanceof t.BoundingBoxAttachment){var u=h;i.push(u);var _=a.obtain();_.length!=u.worldVerticesLength&&(_=t.Utils.newFloatArray(u.worldVerticesLength)),r.push(_),u.computeWorldVertices(l,0,u.worldVerticesLength,_,0,2)}}}n?this.aabbCompute():(this.minX=Number.POSITIVE_INFINITY,this.minY=Number.POSITIVE_INFINITY,this.maxX=Number.NEGATIVE_INFINITY,this.maxY=Number.NEGATIVE_INFINITY)},e.prototype.aabbCompute=function(){for(var t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY,i=Number.NEGATIVE_INFINITY,r=this.polygons,a=0,o=r.length;a<o;a++)for(var s=r[a],c=s,l=0,h=s.length;l<h;l+=2){var u=c[l],_=c[l+1];t=Math.min(t,u),e=Math.min(e,_),n=Math.max(n,u),i=Math.max(i,_)}this.minX=t,this.minY=e,this.maxX=n,this.maxY=i},e.prototype.aabbContainsPoint=function(t,e){return t>=this.minX&&t<=this.maxX&&e>=this.minY&&e<=this.maxY},e.prototype.aabbIntersectsSegment=function(t,e,n,i){var r=this.minX,a=this.minY,o=this.maxX,s=this.maxY;if(t<=r&&n<=r||e<=a&&i<=a||t>=o&&n>=o||e>=s&&i>=s)return!1;var c=(i-e)/(n-t),l=c*(r-t)+e;if(l>a&&l<s)return!0;if((l=c*(o-t)+e)>a&&l<s)return!0;var h=(a-e)/c+t;return h>r&&h<o||(h=(s-e)/c+t)>r&&h<o},e.prototype.aabbIntersectsSkeleton=function(t){return this.minX<t.maxX&&this.maxX>t.minX&&this.minY<t.maxY&&this.maxY>t.minY},e.prototype.containsPoint=function(t,e){for(var n=this.polygons,i=0,r=n.length;i<r;i++)if(this.containsPointPolygon(n[i],t,e))return this.boundingBoxes[i];return null},e.prototype.containsPointPolygon=function(t,e,n){for(var i=t,r=t.length,a=r-2,o=!1,s=0;s<r;s+=2){var c=i[s+1],l=i[a+1];if(c<n&&l>=n||l<n&&c>=n){var h=i[s];h+(n-c)/(l-c)*(i[a]-h)<e&&(o=!o)}a=s}return o},e.prototype.intersectsSegment=function(t,e,n,i){for(var r=this.polygons,a=0,o=r.length;a<o;a++)if(this.intersectsSegmentPolygon(r[a],t,e,n,i))return this.boundingBoxes[a];return null},e.prototype.intersectsSegmentPolygon=function(t,e,n,i,r){for(var a=t,o=t.length,s=e-i,c=n-r,l=e*r-n*i,h=a[o-2],u=a[o-1],_=0;_<o;_+=2){var f=a[_],d=a[_+1],p=h*d-u*f,m=h-f,v=u-d,g=s*v-c*m,y=(l*m-s*p)/g;if((y>=h&&y<=f||y>=f&&y<=h)&&(y>=e&&y<=i||y>=i&&y<=e)){var x=(l*v-c*p)/g;if((x>=u&&x<=d||x>=d&&x<=u)&&(x>=n&&x<=r||x>=r&&x<=n))return!0}h=f,u=d}return!1},e.prototype.getPolygon=function(t){if(null==t)throw new Error("boundingBox cannot be null.");var e=this.boundingBoxes.indexOf(t);return-1==e?null:this.polygons[e]},e.prototype.getWidth=function(){return this.maxX-this.minX},e.prototype.getHeight=function(){return this.maxY-this.minY},e}();t.SkeletonBounds=e}(zlt||(zlt={})),function(t){var e=function(){function e(){this.triangulator=new t.Triangulator,this.clippingPolygon=new Array,this.clipOutput=new Array,this.clippedVertices=new Array,this.clippedTriangles=new Array,this.scratch=new Array}return e.prototype.clipStart=function(n,i){if(null!=this.clipAttachment)return 0;this.clipAttachment=i;var r=i.worldVerticesLength,a=t.Utils.setArraySize(this.clippingPolygon,r);i.computeWorldVertices(n,0,r,a,0,2);var o=this.clippingPolygon;e.makeClockwise(o);for(var s=this.clippingPolygons=this.triangulator.decompose(o,this.triangulator.triangulate(o)),c=0,l=s.length;c<l;c++){var h=s[c];e.makeClockwise(h),h.push(h[0]),h.push(h[1])}return s.length},e.prototype.clipEndWithSlot=function(t){null!=this.clipAttachment&&this.clipAttachment.endSlot==t.data&&this.clipEnd()},e.prototype.clipEnd=function(){null!=this.clipAttachment&&(this.clipAttachment=null,this.clippingPolygons=null,this.clippedVertices.length=0,this.clippedTriangles.length=0,this.clippingPolygon.length=0)},e.prototype.isClipping=function(){return null!=this.clipAttachment},e.prototype.clipTriangles=function(e,n,i,r,a,o,s,c,l,h,u){void 0===l&&(l=2),void 0===h&&(h=0),void 0===u&&(u=0);var _=this.clipOutput,f=this.clippedVertices,d=this.clippedTriangles,p=this.clippingPolygons,m=this.clippingPolygons.length,v=c?12:8,g=0;f.length=0,d.length=0;t:for(var y=0;y<r;y+=3)for(var x=i[y]*l,S=e[x+h],A=e[x+h+1],b=a[x+u],C=a[x+u+1],T=e[(x=i[y+1]*l)+h],E=e[x+h+1],w=a[x+u],I=a[x+u+1],P=e[(x=i[y+2]*l)+h],D=e[x+h+1],R=a[x+u],M=a[x+u+1],O=0;O<m;O++){var N=f.length;if(!this.clip(S,A,T,E,P,D,p[O],_)){(H=t.Utils.setArraySize(f,N+3*v))[N]=S,H[N+1]=A,H[N+2]=o.r,H[N+3]=o.g,H[N+4]=o.b,H[N+5]=o.a,c?(H[N+6]=b,H[N+7]=C,H[N+8]=s.r,H[N+9]=s.g,H[N+10]=s.b,H[N+11]=s.a,H[N+12]=T,H[N+13]=E,H[N+14]=o.r,H[N+15]=o.g,H[N+16]=o.b,H[N+17]=o.a,H[N+18]=w,H[N+19]=I,H[N+20]=s.r,H[N+21]=s.g,H[N+22]=s.b,H[N+23]=s.a,H[N+24]=P,H[N+25]=D,H[N+26]=o.r,H[N+27]=o.g,H[N+28]=o.b,H[N+29]=o.a,H[N+30]=R,H[N+31]=M,H[N+32]=s.r,H[N+33]=s.g,H[N+34]=s.b,H[N+35]=s.a):(H[N+6]=b,H[N+7]=C,H[N+8]=T,H[N+9]=E,H[N+10]=o.r,H[N+11]=o.g,H[N+12]=o.b,H[N+13]=o.a,H[N+14]=w,H[N+15]=I,H[N+16]=P,H[N+17]=D,H[N+18]=o.r,H[N+19]=o.g,H[N+20]=o.b,H[N+21]=o.a,H[N+22]=R,H[N+23]=M),N=d.length,(Z=t.Utils.setArraySize(d,N+3))[N]=g,Z[N+1]=g+1,Z[N+2]=g+2,g+=3;continue t}var B=_.length;if(0!=B){for(var L=E-D,F=P-T,V=S-P,z=D-A,k=1/(L*V+F*(A-D)),U=B>>1,G=this.clipOutput,H=t.Utils.setArraySize(f,N+U*v),j=0;j<B;j+=2){var W=G[j],q=G[j+1];H[N]=W,H[N+1]=q,H[N+2]=o.r,H[N+3]=o.g,H[N+4]=o.b,H[N+5]=o.a;var X=W-P,Y=q-D,K=(L*X+F*Y)*k,J=(z*X+V*Y)*k,Q=1-K-J;H[N+6]=b*K+w*J+R*Q,H[N+7]=C*K+I*J+M*Q,c&&(H[N+8]=s.r,H[N+9]=s.g,H[N+10]=s.b,H[N+11]=s.a),N+=v}N=d.length;var Z=t.Utils.setArraySize(d,N+3*(U-2));for(U--,j=1;j<U;j++)Z[N]=g,Z[N+1]=g+j,Z[N+2]=g+j+1,N+=3;g+=U+1}}},e.prototype.clip=function(t,e,n,i,r,a,o,s){var c=s,l=!1,h=null;o.length%4>=2?(h=s,s=this.scratch):h=this.scratch,h.length=0,h.push(t),h.push(e),h.push(n),h.push(i),h.push(r),h.push(a),h.push(t),h.push(e),s.length=0;for(var u=o,_=o.length-4,f=0;;f+=2){for(var d=u[f],p=u[f+1],m=u[f+2],v=u[f+3],g=d-m,y=p-v,x=h,S=h.length-2,A=s.length,b=0;b<S;b+=2){var C=x[b],T=x[b+1],E=x[b+2],w=x[b+3],I=g*(w-v)-y*(E-m)>0;if(g*(T-v)-y*(C-m)>0){if(I){s.push(E),s.push(w);continue}var P=(R=w-T)*(m-d)-(M=E-C)*(v-p);if(Math.abs(P)>1e-6){var D=(M*(p-T)-R*(d-C))/P;s.push(d+(m-d)*D),s.push(p+(v-p)*D)}else s.push(d),s.push(p)}else if(I){var R,M;P=(R=w-T)*(m-d)-(M=E-C)*(v-p),Math.abs(P)>1e-6?(D=(M*(p-T)-R*(d-C))/P,s.push(d+(m-d)*D),s.push(p+(v-p)*D)):(s.push(d),s.push(p)),s.push(E),s.push(w)}l=!0}if(A==s.length)return c.length=0,!0;if(s.push(s[0]),s.push(s[1]),f==_)break;var O=s;(s=h).length=0,h=O}if(c!=s){c.length=0,f=0;for(var N=s.length-2;f<N;f++)c[f]=s[f]}else c.length=c.length-2;return l},e.makeClockwise=function(t){for(var e=t,n=t.length,i=e[n-2]*e[1]-e[0]*e[n-1],r=0,a=0,o=0,s=0,c=n-3;s<c;s+=2)r=e[s],a=e[s+1],o=e[s+2],i+=r*e[s+3]-o*a;if(!(i<0)){s=0;var l=n-2;for(c=n>>1;s<c;s+=2){var h=e[s],u=e[s+1],_=l-s;e[s]=e[_],e[s+1]=e[_+1],e[_]=h,e[_+1]=u}}},e}();t.SkeletonClipping=e}(zlt||(zlt={})),function(t){var e=function(){function t(){this.bones=new Array,this.slots=new Array,this.skins=new Array,this.events=new Array,this.animations=new Array,this.ikConstraints=new Array,this.transformConstraints=new Array,this.pathConstraints=new Array,this.fps=0}return t.prototype.findBone=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findBoneIndex=function(t){if(null==t)throw new Error("boneName cannot be null.");for(var e=this.bones,n=0,i=e.length;n<i;n++)if(e[n].name==t)return n;return-1},t.prototype.findSlot=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findSlotIndex=function(t){if(null==t)throw new Error("slotName cannot be null.");for(var e=this.slots,n=0,i=e.length;n<i;n++)if(e[n].name==t)return n;return-1},t.prototype.findSkin=function(t){if(null==t)throw new Error("skinName cannot be null.");for(var e=this.skins,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findEvent=function(t){if(null==t)throw new Error("eventDataName cannot be null.");for(var e=this.events,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findAnimation=function(t){if(null==t)throw new Error("animationName cannot be null.");for(var e=this.animations,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findIkConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.ikConstraints,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findTransformConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.transformConstraints,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findPathConstraint=function(t){if(null==t)throw new Error("constraintName cannot be null.");for(var e=this.pathConstraints,n=0,i=e.length;n<i;n++){var r=e[n];if(r.name==t)return r}return null},t.prototype.findPathConstraintIndex=function(t){if(null==t)throw new Error("pathConstraintName cannot be null.");for(var e=this.pathConstraints,n=0,i=e.length;n<i;n++)if(e[n].name==t)return n;return-1},t}();t.SkeletonData=e}(zlt||(zlt={})),function(t){var e=function(){function e(t){this.scale=1,this.linkedMeshes=new Array,this.attachmentLoader=t}return e.prototype.readSkeletonData=function(n){var i=this.scale,r=new t.SkeletonData,a="string"==typeof n?JSON.parse(n):n,o=a.skeleton;if(null!=o&&(r.hash=o.hash,r.version=o.spine,r.x=o.x,r.y=o.y,r.width=o.width,r.height=o.height,r.fps=o.fps,r.imagesPath=o.images),a.bones)for(var s=0;s<a.bones.length;s++){var c=a.bones[s],l=null,h=this.getValue(c,"parent",null);if(null!=h&&null==(l=r.findBone(h)))throw new Error("Parent bone not found: "+h);(d=new t.BoneData(r.bones.length,c.name,l)).length=this.getValue(c,"length",0)*i,d.x=this.getValue(c,"x",0)*i,d.y=this.getValue(c,"y",0)*i,d.rotation=this.getValue(c,"rotation",0),d.scaleX=this.getValue(c,"scaleX",1),d.scaleY=this.getValue(c,"scaleY",1),d.shearX=this.getValue(c,"shearX",0),d.shearY=this.getValue(c,"shearY",0),d.transformMode=e.transformModeFromString(this.getValue(c,"transform","normal")),d.skinRequired=this.getValue(c,"skin",!1),r.bones.push(d)}if(a.slots)for(s=0;s<a.slots.length;s++){var u=(P=a.slots[s]).name,_=P.bone,f=r.findBone(_);if(null==f)throw new Error("Slot bone not found: "+_);var d=new t.SlotData(r.slots.length,u,f),p=this.getValue(P,"color",null);null!=p&&d.color.setFromString(p);var m=this.getValue(P,"dark",null);null!=m&&(d.darkColor=new t.Color(1,1,1,1),d.darkColor.setFromString(m)),d.attachmentName=this.getValue(P,"attachment",null),d.blendMode=e.blendModeFromString(this.getValue(P,"blend","normal")),r.slots.push(d)}if(a.ik)for(s=0;s<a.ik.length;s++){var v=a.ik[s];(d=new t.IkConstraintData(v.name)).order=this.getValue(v,"order",0),d.skinRequired=this.getValue(v,"skin",!1);for(var g=0;g<v.bones.length;g++){if(_=v.bones[g],null==(E=r.findBone(_)))throw new Error("IK bone not found: "+_);d.bones.push(E)}var y=v.target;if(d.target=r.findBone(y),null==d.target)throw new Error("IK target bone not found: "+y);d.mix=this.getValue(v,"mix",1),d.softness=this.getValue(v,"softness",0)*i,d.bendDirection=this.getValue(v,"bendPositive",!0)?1:-1,d.compress=this.getValue(v,"compress",!1),d.stretch=this.getValue(v,"stretch",!1),d.uniform=this.getValue(v,"uniform",!1),r.ikConstraints.push(d)}if(a.transform)for(s=0;s<a.transform.length;s++){for(v=a.transform[s],(d=new t.TransformConstraintData(v.name)).order=this.getValue(v,"order",0),d.skinRequired=this.getValue(v,"skin",!1),g=0;g<v.bones.length;g++){if(_=v.bones[g],null==(E=r.findBone(_)))throw new Error("Transform constraint bone not found: "+_);d.bones.push(E)}if(y=v.target,d.target=r.findBone(y),null==d.target)throw new Error("Transform constraint target bone not found: "+y);d.local=this.getValue(v,"local",!1),d.relative=this.getValue(v,"relative",!1),d.offsetRotation=this.getValue(v,"rotation",0),d.offsetX=this.getValue(v,"x",0)*i,d.offsetY=this.getValue(v,"y",0)*i,d.offsetScaleX=this.getValue(v,"scaleX",0),d.offsetScaleY=this.getValue(v,"scaleY",0),d.offsetShearY=this.getValue(v,"shearY",0),d.rotateMix=this.getValue(v,"rotateMix",1),d.translateMix=this.getValue(v,"translateMix",1),d.scaleMix=this.getValue(v,"scaleMix",1),d.shearMix=this.getValue(v,"shearMix",1),r.transformConstraints.push(d)}if(a.path)for(s=0;s<a.path.length;s++){for(v=a.path[s],(d=new t.PathConstraintData(v.name)).order=this.getValue(v,"order",0),d.skinRequired=this.getValue(v,"skin",!1),g=0;g<v.bones.length;g++){if(_=v.bones[g],null==(E=r.findBone(_)))throw new Error("Transform constraint bone not found: "+_);d.bones.push(E)}if(y=v.target,d.target=r.findSlot(y),null==d.target)throw new Error("Path target slot not found: "+y);d.positionMode=e.positionModeFromString(this.getValue(v,"positionMode","percent")),d.spacingMode=e.spacingModeFromString(this.getValue(v,"spacingMode","length")),d.rotateMode=e.rotateModeFromString(this.getValue(v,"rotateMode","tangent")),d.offsetRotation=this.getValue(v,"rotation",0),d.position=this.getValue(v,"position",0),d.positionMode==t.PositionMode.Fixed&&(d.position*=i),d.spacing=this.getValue(v,"spacing",0),d.spacingMode!=t.SpacingMode.Length&&d.spacingMode!=t.SpacingMode.Fixed||(d.spacing*=i),d.rotateMix=this.getValue(v,"rotateMix",1),d.translateMix=this.getValue(v,"translateMix",1),r.pathConstraints.push(d)}if(a.skins){var x=a.skins;if(!(x instanceof Array)){var S=[];for(var A in x)S.push({name:A,attachments:x[A]});x=S}for(s=0;s<x.length;s++){var b=x[s],C=new t.Skin(b.name);if(b.bones)for(var T=0;T<b.bones.length;T++){var E;if(null==(E=r.findBone(b.bones[T])))throw new Error("Skin bone not found: "+b.bones[s]);C.bones.push(E)}if(b.ik)for(T=0;T<b.ik.length;T++){if(null==(w=r.findIkConstraint(b.ik[T])))throw new Error("Skin IK constraint not found: "+b.ik[s]);C.constraints.push(w)}if(b.transform)for(T=0;T<b.transform.length;T++){if(null==(w=r.findTransformConstraint(b.transform[T])))throw new Error("Skin transform constraint not found: "+b.transform[s]);C.constraints.push(w)}if(b.path)for(T=0;T<b.path.length;T++){var w;if(null==(w=r.findPathConstraint(b.path[T])))throw new Error("Skin path constraint not found: "+b.path[s]);C.constraints.push(w)}for(var u in b.attachments){var I=r.findSlot(u);if(null==I)throw new Error("Slot not found: "+u);var P=b.attachments[u];for(var D in P){var R=this.readAttachment(P[D],C,I.index,D,r);null!=R&&C.setAttachment(I.index,D,R)}}r.skins.push(C),"default"==C.name&&(r.defaultSkin=C)}}s=0;for(var M=this.linkedMeshes.length;s<M;s++){var O=this.linkedMeshes[s];if(null==(C=null==O.skin?r.defaultSkin:r.findSkin(O.skin)))throw new Error("Skin not found: "+O.skin);var N=C.getAttachment(O.slotIndex,O.parent);if(null==N)throw new Error("Parent mesh not found: "+O.parent);O.mesh.deformAttachment=O.inheritDeform?N:O.mesh,O.mesh.setParentMesh(N),O.mesh.updateUVs()}if(this.linkedMeshes.length=0,a.events)for(var B in a.events){var L=a.events[B];(d=new t.EventData(B)).intValue=this.getValue(L,"int",0),d.floatValue=this.getValue(L,"float",0),d.stringValue=this.getValue(L,"string",""),d.audioPath=this.getValue(L,"audio",null),null!=d.audioPath&&(d.volume=this.getValue(L,"volume",1),d.balance=this.getValue(L,"balance",0)),r.events.push(d)}if(a.animations)for(var F in a.animations){var V=a.animations[F];this.readAnimation(V,F,r)}return r},e.prototype.readAttachment=function(e,i,r,a,o){var s=this.scale;switch(a=this.getValue(e,"name",a),this.getValue(e,"type","region")){case"region":var c=this.getValue(e,"path",a),l=this.attachmentLoader.newRegionAttachment(i,a,c);return null==l?null:(l.path=c,l.x=this.getValue(e,"x",0)*s,l.y=this.getValue(e,"y",0)*s,l.scaleX=this.getValue(e,"scaleX",1),l.scaleY=this.getValue(e,"scaleY",1),l.rotation=this.getValue(e,"rotation",0),l.width=e.width*s,l.height=e.height*s,null!=(y=this.getValue(e,"color",null))&&l.color.setFromString(y),l.updateOffset(),l);case"boundingbox":var h=this.attachmentLoader.newBoundingBoxAttachment(i,a);return null==h?null:(this.readVertices(e,h,e.vertexCount<<1),null!=(y=this.getValue(e,"color",null))&&h.color.setFromString(y),h);case"mesh":case"linkedmesh":c=this.getValue(e,"path",a);var u=this.attachmentLoader.newMeshAttachment(i,a,c);if(null==u)return null;u.path=c,null!=(y=this.getValue(e,"color",null))&&u.color.setFromString(y),u.width=this.getValue(e,"width",0)*s,u.height=this.getValue(e,"height",0)*s;var _=this.getValue(e,"parent",null);if(null!=_)return this.linkedMeshes.push(new n(u,this.getValue(e,"skin",null),r,_,this.getValue(e,"deform",!0))),u;var f=e.uvs;return this.readVertices(e,u,f.length),u.triangles=e.triangles,u.regionUVs=f,u.updateUVs(),u.edges=this.getValue(e,"edges",null),u.hullLength=2*this.getValue(e,"hull",0),u;case"path":if(null==(c=this.attachmentLoader.newPathAttachment(i,a)))return null;c.closed=this.getValue(e,"closed",!1),c.constantSpeed=this.getValue(e,"constantSpeed",!0);var d=e.vertexCount;this.readVertices(e,c,d<<1);for(var p=t.Utils.newArray(d/3,0),m=0;m<e.lengths.length;m++)p[m]=e.lengths[m]*s;return c.lengths=p,null!=(y=this.getValue(e,"color",null))&&c.color.setFromString(y),c;case"point":var v=this.attachmentLoader.newPointAttachment(i,a);return null==v?null:(v.x=this.getValue(e,"x",0)*s,v.y=this.getValue(e,"y",0)*s,v.rotation=this.getValue(e,"rotation",0),null!=(y=this.getValue(e,"color",null))&&v.color.setFromString(y),v);case"clipping":var g=this.attachmentLoader.newClippingAttachment(i,a);if(null==g)return null;var y,x=this.getValue(e,"end",null);if(null!=x){var S=o.findSlot(x);if(null==S)throw new Error("Clipping end slot not found: "+x);g.endSlot=S}return d=e.vertexCount,this.readVertices(e,g,d<<1),null!=(y=this.getValue(e,"color",null))&&g.color.setFromString(y),g}return null},e.prototype.readVertices=function(e,n,i){var r=this.scale;n.worldVerticesLength=i;var a=e.vertices;if(i!=a.length){var o=new Array,s=new Array;for(u=0,_=a.length;u<_;){var c=a[u++];s.push(c);for(var l=u+4*c;u<l;u+=4)s.push(a[u]),o.push(a[u+1]*r),o.push(a[u+2]*r),o.push(a[u+3])}n.bones=s,n.vertices=t.Utils.toFloatArray(o)}else{var h=t.Utils.toFloatArray(a);if(1!=r)for(var u=0,_=a.length;u<_;u++)h[u]*=r;n.vertices=h}},e.prototype.readAnimation=function(e,n,i){var r=this.scale,a=new Array,o=0;if(e.slots)for(var s in e.slots){var c=e.slots[s];if(-1==(Q=i.findSlotIndex(s)))throw new Error("Slot not found: "+s);for(var l in c){var h=c[l];if("attachment"==l){(x=new t.AttachmentTimeline(h.length)).slotIndex=Q;for(var u=0,_=0;_<h.length;_++){var f=h[_];x.setFrame(u++,this.getValue(f,"time",0),f.name)}a.push(x),o=Math.max(o,x.frames[x.getFrameCount()-1])}else if("color"==l){for((x=new t.ColorTimeline(h.length)).slotIndex=Q,u=0,_=0;_<h.length;_++){f=h[_];var d=new t.Color;d.setFromString(f.color),x.setFrame(u,this.getValue(f,"time",0),d.r,d.g,d.b,d.a),this.readCurve(f,x,u),u++}a.push(x),o=Math.max(o,x.frames[(x.getFrameCount()-1)*t.ColorTimeline.ENTRIES])}else{if("twoColor"!=l)throw new Error("Invalid timeline type for a slot: "+l+" ("+s+")");for((x=new t.TwoColorTimeline(h.length)).slotIndex=Q,u=0,_=0;_<h.length;_++){f=h[_];var p=new t.Color,m=new t.Color;p.setFromString(f.light),m.setFromString(f.dark),x.setFrame(u,this.getValue(f,"time",0),p.r,p.g,p.b,p.a,m.r,m.g,m.b),this.readCurve(f,x,u),u++}a.push(x),o=Math.max(o,x.frames[(x.getFrameCount()-1)*t.TwoColorTimeline.ENTRIES])}}}if(e.bones)for(var v in e.bones){var g=e.bones[v],y=i.findBoneIndex(v);if(-1==y)throw new Error("Bone not found: "+v);for(var l in g)if(h=g[l],"rotate"===l){for((x=new t.RotateTimeline(h.length)).boneIndex=y,u=0,_=0;_<h.length;_++)f=h[_],x.setFrame(u,this.getValue(f,"time",0),this.getValue(f,"angle",0)),this.readCurve(f,x,u),u++;a.push(x),o=Math.max(o,x.frames[(x.getFrameCount()-1)*t.RotateTimeline.ENTRIES])}else{if("translate"!==l&&"scale"!==l&&"shear"!==l)throw new Error("Invalid timeline type for a bone: "+l+" ("+v+")");var x=null,S=1,A=0;for("scale"===l?(x=new t.ScaleTimeline(h.length),A=1):"shear"===l?x=new t.ShearTimeline(h.length):(x=new t.TranslateTimeline(h.length),S=r),x.boneIndex=y,u=0,_=0;_<h.length;_++){f=h[_];var b=this.getValue(f,"x",A),C=this.getValue(f,"y",A);x.setFrame(u,this.getValue(f,"time",0),b*S,C*S),this.readCurve(f,x,u),u++}a.push(x),o=Math.max(o,x.frames[(x.getFrameCount()-1)*t.TranslateTimeline.ENTRIES])}}if(e.ik)for(var T in e.ik){var E=e.ik[T],w=i.findIkConstraint(T);for((x=new t.IkConstraintTimeline(E.length)).ikConstraintIndex=i.ikConstraints.indexOf(w),u=0,_=0;_<E.length;_++)f=E[_],x.setFrame(u,this.getValue(f,"time",0),this.getValue(f,"mix",1),this.getValue(f,"softness",0)*r,this.getValue(f,"bendPositive",!0)?1:-1,this.getValue(f,"compress",!1),this.getValue(f,"stretch",!1)),this.readCurve(f,x,u),u++;a.push(x),o=Math.max(o,x.frames[(x.getFrameCount()-1)*t.IkConstraintTimeline.ENTRIES])}if(e.transform)for(var T in e.transform){for(E=e.transform[T],w=i.findTransformConstraint(T),(x=new t.TransformConstraintTimeline(E.length)).transformConstraintIndex=i.transformConstraints.indexOf(w),u=0,_=0;_<E.length;_++)f=E[_],x.setFrame(u,this.getValue(f,"time",0),this.getValue(f,"rotateMix",1),this.getValue(f,"translateMix",1),this.getValue(f,"scaleMix",1),this.getValue(f,"shearMix",1)),this.readCurve(f,x,u),u++;a.push(x),o=Math.max(o,x.frames[(x.getFrameCount()-1)*t.TransformConstraintTimeline.ENTRIES])}var I=e.path||e.paths;if(I)for(var T in I){E=I[T];var P=i.findPathConstraintIndex(T);if(-1==P)throw new Error("Path constraint not found: "+T);var D=i.pathConstraints[P];for(var l in E)if(h=E[l],"position"===l||"spacing"===l){for(x=null,S=1,"spacing"===l?(x=new t.PathConstraintSpacingTimeline(h.length),D.spacingMode!=t.SpacingMode.Length&&D.spacingMode!=t.SpacingMode.Fixed||(S=r)):(x=new t.PathConstraintPositionTimeline(h.length),D.positionMode==t.PositionMode.Fixed&&(S=r)),x.pathConstraintIndex=P,u=0,_=0;_<h.length;_++)f=h[_],x.setFrame(u,this.getValue(f,"time",0),this.getValue(f,l,0)*S),this.readCurve(f,x,u),u++;a.push(x),o=Math.max(o,x.frames[(x.getFrameCount()-1)*t.PathConstraintPositionTimeline.ENTRIES])}else if("mix"===l){for((x=new t.PathConstraintMixTimeline(h.length)).pathConstraintIndex=P,u=0,_=0;_<h.length;_++)f=h[_],x.setFrame(u,this.getValue(f,"time",0),this.getValue(f,"rotateMix",1),this.getValue(f,"translateMix",1)),this.readCurve(f,x,u),u++;a.push(x),o=Math.max(o,x.frames[(x.getFrameCount()-1)*t.PathConstraintMixTimeline.ENTRIES])}}if(e.deform)for(var R in e.deform){var M=e.deform[R],O=i.findSkin(R);if(null==O)throw new Error("Skin not found: "+R);for(var s in M){if(c=M[s],-1==(Q=i.findSlotIndex(s)))throw new Error("Slot not found: "+c.name);for(var l in c){h=c[l];var N=O.getAttachment(Q,l);if(null!=N){var B=null!=N.bones,L=N.vertices,F=B?L.length/3*2:L.length;(x=new t.DeformTimeline(h.length)).slotIndex=Q,x.attachment=N,u=0;for(var V=0;V<h.length;V++){f=h[V];var z=void 0,k=this.getValue(f,"vertices",null);if(null==k)z=B?t.Utils.newFloatArray(F):L;else{z=t.Utils.newFloatArray(F);var U=this.getValue(f,"offset",0);if(t.Utils.arrayCopy(k,0,z,U,k.length),1!=r)for(var G=(_=U)+k.length;_<G;_++)z[_]*=r;if(!B)for(_=0;_<F;_++)z[_]+=L[_]}x.setFrame(u,this.getValue(f,"time",0),z),this.readCurve(f,x,u),u++}a.push(x),o=Math.max(o,x.frames[x.getFrameCount()-1])}}}}var H=e.drawOrder;if(null==H&&(H=e.draworder),null!=H){x=new t.DrawOrderTimeline(H.length);var j=i.slots.length;for(u=0,V=0;V<H.length;V++){var W=H[V],q=null,X=this.getValue(W,"offsets",null);if(null!=X){q=t.Utils.newArray(j,-1);var Y=t.Utils.newArray(j-X.length,0),K=0,J=0;for(_=0;_<X.length;_++){var Q,Z=X[_];if(-1==(Q=i.findSlotIndex(Z.slot)))throw new Error("Slot not found: "+Z.slot);for(;K!=Q;)Y[J++]=K++;q[K+Z.offset]=K++}for(;K<j;)Y[J++]=K++;for(_=j-1;_>=0;_--)-1==q[_]&&(q[_]=Y[--J])}x.setFrame(u++,this.getValue(W,"time",0),q)}a.push(x),o=Math.max(o,x.frames[x.getFrameCount()-1])}if(e.events){for(x=new t.EventTimeline(e.events.length),u=0,_=0;_<e.events.length;_++){var $=e.events[_],tt=i.findEvent($.name);if(null==tt)throw new Error("Event not found: "+$.name);var et=new t.Event(t.Utils.toSinglePrecision(this.getValue($,"time",0)),tt);et.intValue=this.getValue($,"int",tt.intValue),et.floatValue=this.getValue($,"float",tt.floatValue),et.stringValue=this.getValue($,"string",tt.stringValue),null!=et.data.audioPath&&(et.volume=this.getValue($,"volume",1),et.balance=this.getValue($,"balance",0)),x.setFrame(u++,et)}a.push(x),o=Math.max(o,x.frames[x.getFrameCount()-1])}if(isNaN(o))throw new Error("Error while parsing animation, duration is NaN");i.animations.push(new t.Animation(n,a,o))},e.prototype.readCurve=function(t,e,n){var i=t.curve;i&&("stepped"==i?e.setStepped(n):"[object Array]"===Object.prototype.toString.call(i)?e.setCurve(n,i[0],i[1],i[2],i[3]):e.setCurve(n,i,this.getValue(t,"c2",0),this.getValue(t,"c3",1),this.getValue(t,"c4",1)))},e.prototype.getValue=function(t,e,n){return void 0!==t[e]?t[e]:n},e.blendModeFromString=function(e){if("normal"==(e=e.toLowerCase()))return t.BlendMode.Normal;if("additive"==e)return t.BlendMode.Additive;if("multiply"==e)return t.BlendMode.Multiply;if("screen"==e)return t.BlendMode.Screen;throw new Error("Unknown blend mode: "+e)},e.positionModeFromString=function(e){if("fixed"==(e=e.toLowerCase()))return t.PositionMode.Fixed;if("percent"==e)return t.PositionMode.Percent;throw new Error("Unknown position mode: "+e)},e.spacingModeFromString=function(e){if("length"==(e=e.toLowerCase()))return t.SpacingMode.Length;if("fixed"==e)return t.SpacingMode.Fixed;if("percent"==e)return t.SpacingMode.Percent;throw new Error("Unknown position mode: "+e)},e.rotateModeFromString=function(e){if("tangent"==(e=e.toLowerCase()))return t.RotateMode.Tangent;if("chain"==e)return t.RotateMode.Chain;if("chainscale"==e)return t.RotateMode.ChainScale;throw new Error("Unknown rotate mode: "+e)},e.transformModeFromString=function(e){if("normal"==(e=e.toLowerCase()))return t.TransformMode.Normal;if("onlytranslation"==e)return t.TransformMode.OnlyTranslation;if("norotationorreflection"==e)return t.TransformMode.NoRotationOrReflection;if("noscale"==e)return t.TransformMode.NoScale;if("noscaleorreflection"==e)return t.TransformMode.NoScaleOrReflection;throw new Error("Unknown transform mode: "+e)},e}();t.SkeletonJson=e;var n=function(t,e,n,i,r){this.mesh=t,this.skin=e,this.slotIndex=n,this.parent=i,this.inheritDeform=r}}(zlt||(zlt={})),function(t){var e=function(t,e,n){this.slotIndex=t,this.name=e,this.attachment=n};t.SkinEntry=e;var n=function(){function n(t){if(this.attachments=new Array,this.bones=Array(),this.constraints=new Array,null==t)throw new Error("name cannot be null.");this.name=t}return n.prototype.setAttachment=function(t,e,n){if(null==n)throw new Error("attachment cannot be null.");var i=this.attachments;t>=i.length&&(i.length=t+1),i[t]||(i[t]={}),i[t][e]=n},n.prototype.addSkin=function(t){for(var e=0;e<t.bones.length;e++){for(var n=t.bones[e],i=!1,r=0;r<this.bones.length;r++)if(this.bones[r]==n){i=!0;break}i||this.bones.push(n)}for(e=0;e<t.constraints.length;e++){var a=t.constraints[e];for(i=!1,r=0;r<this.constraints.length;r++)if(this.constraints[r]==a){i=!0;break}i||this.constraints.push(a)}var o=t.getAttachments();for(e=0;e<o.length;e++){var s=o[e];this.setAttachment(s.slotIndex,s.name,s.attachment)}},n.prototype.copySkin=function(e){for(var n=0;n<e.bones.length;n++){for(var i=e.bones[n],r=!1,a=0;a<this.bones.length;a++)if(this.bones[a]==i){r=!0;break}r||this.bones.push(i)}for(n=0;n<e.constraints.length;n++){var o=e.constraints[n];for(r=!1,a=0;a<this.constraints.length;a++)if(this.constraints[a]==o){r=!0;break}r||this.constraints.push(o)}var s=e.getAttachments();for(n=0;n<s.length;n++){var c=s[n];null!=c.attachment&&(c.attachment instanceof t.MeshAttachment?(c.attachment=c.attachment.newLinkedMesh(),this.setAttachment(c.slotIndex,c.name,c.attachment)):(c.attachment=c.attachment.copy(),this.setAttachment(c.slotIndex,c.name,c.attachment)))}},n.prototype.getAttachment=function(t,e){var n=this.attachments[t];return n?n[e]:null},n.prototype.removeAttachment=function(t,e){var n=this.attachments[t];n&&(n[e]=null)},n.prototype.getAttachments=function(){for(var t=new Array,n=0;n<this.attachments.length;n++){var i=this.attachments[n];if(i)for(var r in i){var a=i[r];a&&t.push(new e(n,r,a))}}return t},n.prototype.getAttachmentsForSlot=function(t,n){var i=this.attachments[t];if(i)for(var r in i){var a=i[r];a&&n.push(new e(t,r,a))}},n.prototype.clear=function(){this.attachments.length=0,this.bones.length=0,this.constraints.length=0},n.prototype.attachAll=function(t,e){for(var n=0,i=0;i<t.slots.length;i++){var r=t.slots[i],a=r.getAttachment();if(a&&n<e.attachments.length){var o=e.attachments[n];for(var s in o)if(a==o[s]){var c=this.getAttachment(n,s);null!=c&&r.setAttachment(c);break}}n++}},n}();t.Skin=n}(zlt||(zlt={})),function(t){var e=function(){function e(e,n){if(this.deform=new Array,null==e)throw new Error("data cannot be null.");if(null==n)throw new Error("bone cannot be null.");this.data=e,this.bone=n,this.color=new t.Color,this.darkColor=null==e.darkColor?null:new t.Color,this.setToSetupPose()}return e.prototype.getSkeleton=function(){return this.bone.skeleton},e.prototype.getAttachment=function(){return this.attachment},e.prototype.setAttachment=function(t){this.attachment!=t&&(this.attachment=t,this.attachmentTime=this.bone.skeleton.time,this.deform.length=0)},e.prototype.setAttachmentTime=function(t){this.attachmentTime=this.bone.skeleton.time-t},e.prototype.getAttachmentTime=function(){return this.bone.skeleton.time-this.attachmentTime},e.prototype.setToSetupPose=function(){this.color.setFromColor(this.data.color),null!=this.darkColor&&this.darkColor.setFromColor(this.data.darkColor),null==this.data.attachmentName?this.attachment=null:(this.attachment=null,this.setAttachment(this.bone.skeleton.getAttachment(this.data.index,this.data.attachmentName)))},e}();t.Slot=e}(zlt||(zlt={})),function(t){t.SlotData=function(e,n,i){if(this.color=new t.Color(1,1,1,1),e<0)throw new Error("index must be >= 0.");if(null==n)throw new Error("name cannot be null.");if(null==i)throw new Error("boneData cannot be null.");this.index=e,this.name=n,this.boneData=i}}(zlt||(zlt={})),function(t){var e,n,i=function(){function t(t){this._image=t}return t.prototype.getImage=function(){return this._image},t.filterFromString=function(t){switch(t.toLowerCase()){case"nearest":return e.Nearest;case"linear":return e.Linear;case"mipmap":return e.MipMap;case"mipmapnearestnearest":return e.MipMapNearestNearest;case"mipmaplinearnearest":return e.MipMapLinearNearest;case"mipmapnearestlinear":return e.MipMapNearestLinear;case"mipmaplinearlinear":return e.MipMapLinearLinear;default:throw new Error("Unknown texture filter "+t)}},t.wrapFromString=function(t){switch(t.toLowerCase()){case"mirroredtepeat":return n.MirroredRepeat;case"clamptoedge":return n.ClampToEdge;case"repeat":return n.Repeat;default:throw new Error("Unknown texture wrap "+t)}},t}();t.Texture=i,function(t){t[t.Nearest=9728]="Nearest",t[t.Linear=9729]="Linear",t[t.MipMap=9987]="MipMap",t[t.MipMapNearestNearest=9984]="MipMapNearestNearest",t[t.MipMapLinearNearest=9985]="MipMapLinearNearest",t[t.MipMapNearestLinear=9986]="MipMapNearestLinear",t[t.MipMapLinearLinear=9987]="MipMapLinearLinear"}(e=t.TextureFilter||(t.TextureFilter={})),function(t){t[t.MirroredRepeat=33648]="MirroredRepeat",t[t.ClampToEdge=33071]="ClampToEdge",t[t.Repeat=10497]="Repeat"}(n=t.TextureWrap||(t.TextureWrap={}));t.TextureRegion=function(){this.u=0,this.v=0,this.u2=0,this.v2=0,this.width=0,this.height=0,this.rotate=!1,this.offsetX=0,this.offsetY=0,this.originalWidth=0,this.originalHeight=0};var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return klt(e,t),e.prototype.setFilters=function(){},e.prototype.setWraps=function(){},e.prototype.dispose=function(){},e}(i);t.FakeTexture=r}(zlt||(zlt={})),function(t){var e=function(){function e(t,e){this.pages=new Array,this.regions=new Array,this.load(t,e)}return e.prototype.load=function(e,a){if(null==a)throw new Error("textureLoader cannot be null.");for(var o=new n(e),s=new Array(4),c=null;;){var l=o.readLine();if(null==l)break;if(0==(l=l.trim()).length)c=null;else if(c){var h=new r;h.name=l,h.page=c;var u=o.readValue();"true"==u.toLocaleLowerCase()?h.degrees=90:"false"==u.toLocaleLowerCase()?h.degrees=0:h.degrees=parseFloat(u),h.rotate=90==h.degrees,o.readTuple(s);var _=parseInt(s[0]),f=parseInt(s[1]);o.readTuple(s);var d=parseInt(s[0]),p=parseInt(s[1]);h.u=_/c.width,h.v=f/c.height,h.rotate?(h.u2=(_+p)/c.width,h.v2=(f+d)/c.height):(h.u2=(_+d)/c.width,h.v2=(f+p)/c.height),h.x=_,h.y=f,h.width=Math.abs(d),h.height=Math.abs(p),4==o.readTuple(s)&&4==o.readTuple(s)&&o.readTuple(s),h.originalWidth=parseInt(s[0]),h.originalHeight=parseInt(s[1]),o.readTuple(s),h.offsetX=parseInt(s[0]),h.offsetY=parseInt(s[1]),h.index=parseInt(o.readValue()),h.texture=c.texture,this.regions.push(h)}else{(c=new i).name=l,2==o.readTuple(s)&&(c.width=parseInt(s[0]),c.height=parseInt(s[1]),o.readTuple(s)),o.readTuple(s),c.minFilter=t.Texture.filterFromString(s[0]),c.magFilter=t.Texture.filterFromString(s[1]);var m=o.readValue();c.uWrap=t.TextureWrap.ClampToEdge,c.vWrap=t.TextureWrap.ClampToEdge,"x"==m?c.uWrap=t.TextureWrap.Repeat:"y"==m?c.vWrap=t.TextureWrap.Repeat:"xy"==m&&(c.uWrap=c.vWrap=t.TextureWrap.Repeat),c.texture=a(l),c.texture.setFilters(c.minFilter,c.magFilter),c.texture.setWraps(c.uWrap,c.vWrap),c.width=c.texture.getImage().width,c.height=c.texture.getImage().height,this.pages.push(c)}}},e.prototype.findRegion=function(t){for(var e=0;e<this.regions.length;e++)if(this.regions[e].name==t)return this.regions[e];return null},e.prototype.dispose=function(){for(var t=0;t<this.pages.length;t++)this.pages[t].texture.dispose()},e}();t.TextureAtlas=e;var n=function(){function t(t){this.index=0,this.lines=t.split(/\r\n|\r|\n/)}return t.prototype.readLine=function(){return this.index>=this.lines.length?null:this.lines[this.index++]},t.prototype.readValue=function(){var t=this.readLine(),e=t.indexOf(":");if(-1==e)throw new Error("Invalid line: "+t);return t.substring(e+1).trim()},t.prototype.readTuple=function(t){var e=this.readLine(),n=e.indexOf(":");if(-1==n)throw new Error("Invalid line: "+e);for(var i=0,r=n+1;i<3;i++){var a=e.indexOf(",",r);if(-1==a)break;t[i]=e.substr(r,a-r).trim(),r=a+1}return t[i]=e.substring(r).trim(),i+1},t}(),i=function(){};t.TextureAtlasPage=i;var r=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return klt(e,t),e}(t.TextureRegion);t.TextureAtlasRegion=r}(zlt||(zlt={})),function(t){var e=function(){function e(e,n){if(this.rotateMix=0,this.translateMix=0,this.scaleMix=0,this.shearMix=0,this.temp=new t.Vector2,this.active=!1,null==e)throw new Error("data cannot be null.");if(null==n)throw new Error("skeleton cannot be null.");this.data=e,this.rotateMix=e.rotateMix,this.translateMix=e.translateMix,this.scaleMix=e.scaleMix,this.shearMix=e.shearMix,this.bones=new Array;for(var i=0;i<e.bones.length;i++)this.bones.push(n.findBone(e.bones[i].name));this.target=n.findBone(e.target.name)}return e.prototype.isActive=function(){return this.active},e.prototype.apply=function(){this.update()},e.prototype.update=function(){this.data.local?this.data.relative?this.applyRelativeLocal():this.applyAbsoluteLocal():this.data.relative?this.applyRelativeWorld():this.applyAbsoluteWorld()},e.prototype.applyAbsoluteWorld=function(){for(var e=this.rotateMix,n=this.translateMix,i=this.scaleMix,r=this.shearMix,a=this.target,o=a.a,s=a.b,c=a.c,l=a.d,h=o*l-s*c>0?t.MathUtils.degRad:-t.MathUtils.degRad,u=this.data.offsetRotation*h,_=this.data.offsetShearY*h,f=this.bones,d=0,p=f.length;d<p;d++){var m=f[d],v=!1;if(0!=e){var g=m.a,y=m.b,x=m.c,S=m.d;(w=Math.atan2(c,o)-Math.atan2(x,g)+u)>t.MathUtils.PI?w-=t.MathUtils.PI2:w<-t.MathUtils.PI&&(w+=t.MathUtils.PI2),w*=e;var A=Math.cos(w),b=Math.sin(w);m.a=A*g-b*x,m.b=A*y-b*S,m.c=b*g+A*x,m.d=b*y+A*S,v=!0}if(0!=n){var C=this.temp;a.localToWorld(C.set(this.data.offsetX,this.data.offsetY)),m.worldX+=(C.x-m.worldX)*n,m.worldY+=(C.y-m.worldY)*n,v=!0}if(i>0){var T=Math.sqrt(m.a*m.a+m.c*m.c),E=Math.sqrt(o*o+c*c);T>1e-5&&(T=(T+(E-T+this.data.offsetScaleX)*i)/T),m.a*=T,m.c*=T,T=Math.sqrt(m.b*m.b+m.d*m.d),E=Math.sqrt(s*s+l*l),T>1e-5&&(T=(T+(E-T+this.data.offsetScaleY)*i)/T),m.b*=T,m.d*=T,v=!0}if(r>0){y=m.b,S=m.d;var w,I=Math.atan2(S,y);(w=Math.atan2(l,s)-Math.atan2(c,o)-(I-Math.atan2(m.c,m.a)))>t.MathUtils.PI?w-=t.MathUtils.PI2:w<-t.MathUtils.PI&&(w+=t.MathUtils.PI2),w=I+(w+_)*r,T=Math.sqrt(y*y+S*S),m.b=Math.cos(w)*T,m.d=Math.sin(w)*T,v=!0}v&&(m.appliedValid=!1)}},e.prototype.applyRelativeWorld=function(){for(var e=this.rotateMix,n=this.translateMix,i=this.scaleMix,r=this.shearMix,a=this.target,o=a.a,s=a.b,c=a.c,l=a.d,h=o*l-s*c>0?t.MathUtils.degRad:-t.MathUtils.degRad,u=this.data.offsetRotation*h,_=this.data.offsetShearY*h,f=this.bones,d=0,p=f.length;d<p;d++){var m,v=f[d],g=!1;if(0!=e){var y=v.a,x=v.b,S=v.c,A=v.d;(m=Math.atan2(c,o)+u)>t.MathUtils.PI?m-=t.MathUtils.PI2:m<-t.MathUtils.PI&&(m+=t.MathUtils.PI2),m*=e;var b=Math.cos(m),C=Math.sin(m);v.a=b*y-C*S,v.b=b*x-C*A,v.c=C*y+b*S,v.d=C*x+b*A,g=!0}if(0!=n){var T=this.temp;a.localToWorld(T.set(this.data.offsetX,this.data.offsetY)),v.worldX+=T.x*n,v.worldY+=T.y*n,g=!0}if(i>0){var E=(Math.sqrt(o*o+c*c)-1+this.data.offsetScaleX)*i+1;v.a*=E,v.c*=E,E=(Math.sqrt(s*s+l*l)-1+this.data.offsetScaleY)*i+1,v.b*=E,v.d*=E,g=!0}if(r>0)(m=Math.atan2(l,s)-Math.atan2(c,o))>t.MathUtils.PI?m-=t.MathUtils.PI2:m<-t.MathUtils.PI&&(m+=t.MathUtils.PI2),x=v.b,A=v.d,m=Math.atan2(A,x)+(m-t.MathUtils.PI/2+_)*r,E=Math.sqrt(x*x+A*A),v.b=Math.cos(m)*E,v.d=Math.sin(m)*E,g=!0;g&&(v.appliedValid=!1)}},e.prototype.applyAbsoluteLocal=function(){var t=this.rotateMix,e=this.translateMix,n=this.scaleMix,i=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();for(var a=this.bones,o=0,s=a.length;o<s;o++){var c=a[o];c.appliedValid||c.updateAppliedTransform();var l=c.arotation;if(0!=t){var h=r.arotation-l+this.data.offsetRotation;l+=(h-=360*(16384-(16384.499999999996-h/360|0)))*t}var u=c.ax,_=c.ay;0!=e&&(u+=(r.ax-u+this.data.offsetX)*e,_+=(r.ay-_+this.data.offsetY)*e);var f=c.ascaleX,d=c.ascaleY;0!=n&&(f>1e-5&&(f=(f+(r.ascaleX-f+this.data.offsetScaleX)*n)/f),d>1e-5&&(d=(d+(r.ascaleY-d+this.data.offsetScaleY)*n)/d));var p=c.ashearY;0!=i&&(h=r.ashearY-p+this.data.offsetShearY,h-=360*(16384-(16384.499999999996-h/360|0)),c.shearY+=h*i),c.updateWorldTransformWith(u,_,l,f,d,c.ashearX,p)}},e.prototype.applyRelativeLocal=function(){var t=this.rotateMix,e=this.translateMix,n=this.scaleMix,i=this.shearMix,r=this.target;r.appliedValid||r.updateAppliedTransform();for(var a=this.bones,o=0,s=a.length;o<s;o++){var c=a[o];c.appliedValid||c.updateAppliedTransform();var l=c.arotation;0!=t&&(l+=(r.arotation+this.data.offsetRotation)*t);var h=c.ax,u=c.ay;0!=e&&(h+=(r.ax+this.data.offsetX)*e,u+=(r.ay+this.data.offsetY)*e);var _=c.ascaleX,f=c.ascaleY;0!=n&&(_>1e-5&&(_*=(r.ascaleX-1+this.data.offsetScaleX)*n+1),f>1e-5&&(f*=(r.ascaleY-1+this.data.offsetScaleY)*n+1));var d=c.ashearY;0!=i&&(d+=(r.ashearY+this.data.offsetShearY)*i),c.updateWorldTransformWith(h,u,l,_,f,c.ashearX,d)}},e}();t.TransformConstraint=e}(zlt||(zlt={})),function(t){var e=function(t){function e(e){var n=t.call(this,e,0,!1)||this;return n.bones=new Array,n.rotateMix=0,n.translateMix=0,n.scaleMix=0,n.shearMix=0,n.offsetRotation=0,n.offsetX=0,n.offsetY=0,n.offsetScaleX=0,n.offsetScaleY=0,n.offsetShearY=0,n.relative=!1,n.local=!1,n}return klt(e,t),e}(t.ConstraintData);t.TransformConstraintData=e}(zlt||(zlt={})),function(t){var e=function(){function e(){this.convexPolygons=new Array,this.convexPolygonsIndices=new Array,this.indicesArray=new Array,this.isConcaveArray=new Array,this.triangles=new Array,this.polygonPool=new t.Pool((function(){return new Array})),this.polygonIndicesPool=new t.Pool((function(){return new Array}))}return e.prototype.triangulate=function(t){var n=t,i=t.length>>1,r=this.indicesArray;r.length=0;for(var a=0;a<i;a++)r[a]=a;var o=this.isConcaveArray;o.length=0,a=0;for(var s=i;a<s;++a)o[a]=e.isConcave(a,i,n,r);var c=this.triangles;for(c.length=0;i>3;){for(var l=i-1,h=(a=0,1);;){t:if(!o[a]){for(var u=r[l]<<1,_=r[a]<<1,f=r[h]<<1,d=n[u],p=n[u+1],m=n[_],v=n[_+1],g=n[f],y=n[f+1],x=(h+1)%i;x!=l;x=(x+1)%i)if(o[x]){var S=r[x]<<1,A=n[S],b=n[S+1];if(e.positiveArea(g,y,d,p,A,b)&&e.positiveArea(d,p,m,v,A,b)&&e.positiveArea(m,v,g,y,A,b))break t}break}if(0==h){do{if(!o[a])break;a--}while(a>0);break}l=a,a=h,h=(h+1)%i}c.push(r[(i+a-1)%i]),c.push(r[a]),c.push(r[(a+1)%i]),r.splice(a,1),o.splice(a,1);var C=(--i+a-1)%i,T=a==i?0:a;o[C]=e.isConcave(C,i,n,r),o[T]=e.isConcave(T,i,n,r)}return 3==i&&(c.push(r[2]),c.push(r[0]),c.push(r[1])),c},e.prototype.decompose=function(t,n){var i=t,r=this.convexPolygons;this.polygonPool.freeAll(r),r.length=0;var a=this.convexPolygonsIndices;this.polygonIndicesPool.freeAll(a),a.length=0;var o=this.polygonIndicesPool.obtain();o.length=0;var s=this.polygonPool.obtain();s.length=0;for(var c=-1,l=0,h=0,u=n.length;h<u;h+=3){var _=n[h]<<1,f=n[h+1]<<1,d=n[h+2]<<1,p=i[_],m=i[_+1],v=i[f],g=i[f+1],y=i[d],x=i[d+1],S=!1;if(c==_){var A=s.length-4,b=e.winding(s[A],s[A+1],s[A+2],s[A+3],y,x),C=e.winding(y,x,s[0],s[1],s[2],s[3]);b==l&&C==l&&(s.push(y),s.push(x),o.push(d),S=!0)}S||(s.length>0?(r.push(s),a.push(o)):(this.polygonPool.free(s),this.polygonIndicesPool.free(o)),(s=this.polygonPool.obtain()).length=0,s.push(p),s.push(m),s.push(v),s.push(g),s.push(y),s.push(x),(o=this.polygonIndicesPool.obtain()).length=0,o.push(_),o.push(f),o.push(d),l=e.winding(p,m,v,g,y,x),c=_)}for(s.length>0&&(r.push(s),a.push(o)),h=0,u=r.length;h<u;h++)if(0!=(o=a[h]).length)for(var T=o[0],E=o[o.length-1],w=(s=r[h])[A=s.length-4],I=s[A+1],P=s[A+2],D=s[A+3],R=s[0],M=s[1],O=s[2],N=s[3],B=e.winding(w,I,P,D,R,M),L=0;L<u;L++)if(L!=h){var F=a[L];if(3==F.length){var V=F[0],z=F[1],k=F[2],U=r[L];y=U[U.length-2],x=U[U.length-1],V==T&&z==E&&(b=e.winding(w,I,P,D,y,x),C=e.winding(y,x,R,M,O,N),b==B&&C==B&&(U.length=0,F.length=0,s.push(y),s.push(x),o.push(k),w=P,I=D,P=y,D=x,L=0))}}for(h=r.length-1;h>=0;h--)0==(s=r[h]).length&&(r.splice(h,1),this.polygonPool.free(s),o=a[h],a.splice(h,1),this.polygonIndicesPool.free(o));return r},e.isConcave=function(t,e,n,i){var r=i[(e+t-1)%e]<<1,a=i[t]<<1,o=i[(t+1)%e]<<1;return!this.positiveArea(n[r],n[r+1],n[a],n[a+1],n[o],n[o+1])},e.positiveArea=function(t,e,n,i,r,a){return t*(a-i)+n*(e-a)+r*(i-e)>=0},e.winding=function(t,e,n,i,r,a){var o=n-t,s=i-e;return r*s-a*o+o*e-t*s>=0?1:-1},e}();t.Triangulator=e}(zlt||(zlt={})),function(t){var e=function(){function t(){this.array=new Array}return t.prototype.add=function(t){var e=this.contains(t);return this.array[0|t]=0|t,!e},t.prototype.contains=function(t){return null!=this.array[0|t]},t.prototype.remove=function(t){this.array[0|t]=void 0},t.prototype.clear=function(){this.array.length=0},t}();t.IntSet=e;var n=function(){function t(t,e,n,i){void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===i&&(i=0),this.r=t,this.g=e,this.b=n,this.a=i}return t.prototype.set=function(t,e,n,i){return this.r=t,this.g=e,this.b=n,this.a=i,this.clamp(),this},t.prototype.setFromColor=function(t){return this.r=t.r,this.g=t.g,this.b=t.b,this.a=t.a,this},t.prototype.setFromString=function(t){return t="#"==t.charAt(0)?t.substr(1):t,this.r=parseInt(t.substr(0,2),16)/255,this.g=parseInt(t.substr(2,2),16)/255,this.b=parseInt(t.substr(4,2),16)/255,this.a=(8!=t.length?255:parseInt(t.substr(6,2),16))/255,this},t.prototype.add=function(t,e,n,i){return this.r+=t,this.g+=e,this.b+=n,this.a+=i,this.clamp(),this},t.prototype.clamp=function(){return this.r<0?this.r=0:this.r>1&&(this.r=1),this.g<0?this.g=0:this.g>1&&(this.g=1),this.b<0?this.b=0:this.b>1&&(this.b=1),this.a<0?this.a=0:this.a>1&&(this.a=1),this},t.rgba8888ToColor=function(t,e){t.r=((4278190080&e)>>>24)/255,t.g=((16711680&e)>>>16)/255,t.b=((65280&e)>>>8)/255,t.a=(255&e)/255},t.rgb888ToColor=function(t,e){t.r=((16711680&e)>>>16)/255,t.g=((65280&e)>>>8)/255,t.b=(255&e)/255},t.WHITE=new t(1,1,1,1),t.RED=new t(1,0,0,1),t.GREEN=new t(0,1,0,1),t.BLUE=new t(0,0,1,1),t.MAGENTA=new t(1,0,1,1),t}();t.Color=n;var i=function(){function t(){}return t.clamp=function(t,e,n){return t<e?e:t>n?n:t},t.cosDeg=function(e){return Math.cos(e*t.degRad)},t.sinDeg=function(e){return Math.sin(e*t.degRad)},t.signum=function(t){return t>0?1:t<0?-1:0},t.toInt=function(t){return t>0?Math.floor(t):Math.ceil(t)},t.cbrt=function(t){var e=Math.pow(Math.abs(t),1/3);return t<0?-e:e},t.randomTriangular=function(e,n){return t.randomTriangularWith(e,n,.5*(e+n))},t.randomTriangularWith=function(t,e,n){var i=Math.random(),r=e-t;return i<=(n-t)/r?t+Math.sqrt(i*r*(n-t)):e-Math.sqrt((1-i)*r*(e-n))},t.PI=3.1415927,t.PI2=2*t.PI,t.radiansToDegrees=180/t.PI,t.radDeg=t.radiansToDegrees,t.degreesToRadians=t.PI/180,t.degRad=t.degreesToRadians,t}();t.MathUtils=i;var r=function(){function t(){}return t.prototype.apply=function(t,e,n){return t+(e-t)*this.applyInternal(n)},t}();t.Interpolation=r;var a=function(t){function e(e){var n=t.call(this)||this;return n.power=2,n.power=e,n}return klt(e,t),e.prototype.applyInternal=function(t){return t<=.5?Math.pow(2*t,this.power)/2:Math.pow(2*(t-1),this.power)/(this.power%2==0?-2:2)+1},e}(r);t.Pow=a;var o=function(t){function e(e){return t.call(this,e)||this}return klt(e,t),e.prototype.applyInternal=function(t){return Math.pow(t-1,this.power)*(this.power%2==0?-1:1)+1},e}(a);t.PowOut=o;var s=function(){function t(){}return t.arrayCopy=function(t,e,n,i,r){for(var a=e,o=i;a<e+r;a++,o++)n[o]=t[a]},t.setArraySize=function(t,e,n){void 0===n&&(n=0);var i=t.length;if(i==e)return t;if(t.length=e,i<e)for(var r=i;r<e;r++)t[r]=n;return t},t.ensureArrayCapacity=function(e,n,i){return void 0===i&&(i=0),e.length>=n?e:t.setArraySize(e,n,i)},t.newArray=function(t,e){for(var n=new Array(t),i=0;i<t;i++)n[i]=e;return n},t.newFloatArray=function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Float32Array(e);for(var n=new Array(e),i=0;i<n.length;i++)n[i]=0;return n},t.newShortArray=function(e){if(t.SUPPORTS_TYPED_ARRAYS)return new Int16Array(e);for(var n=new Array(e),i=0;i<n.length;i++)n[i]=0;return n},t.toFloatArray=function(e){return t.SUPPORTS_TYPED_ARRAYS?new Float32Array(e):e},t.toSinglePrecision=function(e){return t.SUPPORTS_TYPED_ARRAYS?Math.fround(e):e},t.webkit602BugfixHelper=function(){},t.contains=function(t,e){for(var n=0;n<t.length;n++)if(t[n]==e)return!0;return!1},t.SUPPORTS_TYPED_ARRAYS="undefined"!=typeof Float32Array,t}();t.Utils=s;var c=function(){function t(){}return t.logBones=function(t){for(var e=0;e<t.bones.length;e++){var n=t.bones[e];console.log(n.data.name+", "+n.a+", "+n.b+", "+n.c+", "+n.d+", "+n.worldX+", "+n.worldY)}},t}();t.DebugUtils=c;var l=function(){function t(t){this.items=new Array,this.instantiator=t}return t.prototype.obtain=function(){return this.items.length>0?this.items.pop():this.instantiator()},t.prototype.free=function(t){t.reset&&t.reset(),this.items.push(t)},t.prototype.freeAll=function(t){for(var e=0;e<t.length;e++)t[e].reset&&t[e].reset(),this.items[e]=t[e]},t.prototype.clear=function(){this.items.length=0},t}();t.Pool=l;var h=function(){function t(t,e){void 0===t&&(t=0),void 0===e&&(e=0),this.x=t,this.y=e}return t.prototype.set=function(t,e){return this.x=t,this.y=e,this},t.prototype.length=function(){var t=this.x,e=this.y;return Math.sqrt(t*t+e*e)},t.prototype.normalize=function(){var t=this.length();return 0!=t&&(this.x/=t,this.y/=t),this},t}();t.Vector2=h;var u=function(){function t(){this.maxDelta=.064,this.framesPerSecond=0,this.delta=0,this.totalTime=0,this.lastTime=Date.now()/1e3,this.frameCount=0,this.frameTime=0}return t.prototype.update=function(){var t=Date.now()/1e3;this.delta=t-this.lastTime,this.frameTime+=this.delta,this.totalTime+=this.delta,this.delta>this.maxDelta&&(this.delta=this.maxDelta),this.lastTime=t,this.frameCount++,this.frameTime>1&&(this.framesPerSecond=this.frameCount/this.frameTime,this.frameTime=0,this.frameCount=0)},t}();t.TimeKeeper=u;var _=function(){function t(t){void 0===t&&(t=32),this.addedValues=0,this.lastValue=0,this.mean=0,this.dirty=!0,this.values=new Array(t)}return t.prototype.hasEnoughData=function(){return this.addedValues>=this.values.length},t.prototype.addValue=function(t){this.addedValues<this.values.length&&this.addedValues++,this.values[this.lastValue++]=t,this.lastValue>this.values.length-1&&(this.lastValue=0),this.dirty=!0},t.prototype.getMean=function(){if(this.hasEnoughData()){if(this.dirty){for(var t=0,e=0;e<this.values.length;e++)t+=this.values[e];this.mean=t/this.values.length,this.dirty=!1}return this.mean}return 0},t}();t.WindowedMean=_}(zlt||(zlt={})),Math.fround||(Math.fround=function(t){return function(e){return t[0]=e,t[0]}}(new Float32Array(1))),function(t){var e=function(t){if(null==t)throw new Error("name cannot be null.");this.name=t};t.Attachment=e;var n=function(e){function n(t){var i=e.call(this,t)||this;return i.id=(65535&n.nextID++)<<11,i.worldVerticesLength=0,i.deformAttachment=i,i}return klt(n,e),n.prototype.computeWorldVertices=function(t,e,n,i,r,a){n=r+(n>>1)*a;var o=t.bone.skeleton,s=t.deform,c=this.vertices,l=this.bones;if(null!=l){for(var h=0,u=0,_=0;_<e;_+=2)h+=(m=l[h])+1,u+=m;var f=o.bones;if(0==s.length)for(I=r,C=3*u;I<n;I+=a){var d=0,p=0,m=l[h++];for(m+=h;h<m;h++,C+=3){x=f[l[h]],P=c[C],D=c[C+1];var v=c[C+2];d+=(P*x.a+D*x.b+x.worldX)*v,p+=(P*x.c+D*x.d+x.worldY)*v}i[I]=d,i[I+1]=p}else for(var g=s,y=(I=r,C=3*u,u<<1);I<n;I+=a){for(d=0,p=0,m=l[h++],m+=h;h<m;h++,C+=3,y+=2)x=f[l[h]],P=c[C]+g[y],D=c[C+1]+g[y+1],v=c[C+2],d+=(P*x.a+D*x.b+x.worldX)*v,p+=(P*x.c+D*x.d+x.worldY)*v;i[I]=d,i[I+1]=p}}else{s.length>0&&(c=s);for(var x,S=(x=t.bone).worldX,A=x.worldY,b=x.a,C=x.b,T=x.c,E=x.d,w=e,I=r;I<n;w+=2,I+=a){var P=c[w],D=c[w+1];i[I]=P*b+D*C+S,i[I+1]=P*T+D*E+A}}},n.prototype.copyTo=function(e){null!=this.bones?(e.bones=new Array(this.bones.length),t.Utils.arrayCopy(this.bones,0,e.bones,0,this.bones.length)):e.bones=null,null!=this.vertices?(e.vertices=t.Utils.newFloatArray(this.vertices.length),t.Utils.arrayCopy(this.vertices,0,e.vertices,0,this.vertices.length)):e.vertices=null,e.worldVerticesLength=this.worldVerticesLength,e.deformAttachment=this.deformAttachment},n.nextID=0,n}(e);t.VertexAttachment=n}(zlt||(zlt={})),function(t){var e;(e=t.AttachmentType||(t.AttachmentType={}))[e.Region=0]="Region",e[e.BoundingBox=1]="BoundingBox",e[e.Mesh=2]="Mesh",e[e.LinkedMesh=3]="LinkedMesh",e[e.Path=4]="Path",e[e.Point=5]="Point",e[e.Clipping=6]="Clipping"}(zlt||(zlt={})),function(t){var e=function(e){function n(n){var i=e.call(this,n)||this;return i.color=new t.Color(1,1,1,1),i}return klt(n,e),n.prototype.copy=function(){var t=new n(name);return this.copyTo(t),t.color.setFromColor(this.color),t},n}(t.VertexAttachment);t.BoundingBoxAttachment=e}(zlt||(zlt={})),function(t){var e=function(e){function n(n){var i=e.call(this,n)||this;return i.color=new t.Color(.2275,.2275,.8078,1),i}return klt(n,e),n.prototype.copy=function(){var t=new n(name);return this.copyTo(t),t.endSlot=this.endSlot,t.color.setFromColor(this.color),t},n}(t.VertexAttachment);t.ClippingAttachment=e}(zlt||(zlt={})),function(t){var e=function(e){function n(n){var i=e.call(this,n)||this;return i.color=new t.Color(1,1,1,1),i.tempColor=new t.Color(0,0,0,0),i}return klt(n,e),n.prototype.updateUVs=function(){var e=this.regionUVs;null!=this.uvs&&this.uvs.length==e.length||(this.uvs=t.Utils.newFloatArray(e.length));var n=this.uvs,i=this.uvs.length,r=this.region.u,a=this.region.v,o=0,s=0;if(this.region instanceof t.TextureAtlasRegion){var c=this.region,l=c.texture.getImage().width,h=c.texture.getImage().height;switch(c.degrees){case 90:r-=(c.originalHeight-c.offsetY-c.height)/l,a-=(c.originalWidth-c.offsetX-c.width)/h,o=c.originalHeight/l,s=c.originalWidth/h;for(var u=0;u<i;u+=2)n[u]=r+e[u+1]*o,n[u+1]=a+(1-e[u])*s;return;case 180:for(r-=(c.originalWidth-c.offsetX-c.width)/l,a-=c.offsetY/h,o=c.originalWidth/l,s=c.originalHeight/h,u=0;u<i;u+=2)n[u]=r+(1-e[u])*o,n[u+1]=a+(1-e[u+1])*s;return;case 270:for(r-=c.offsetY/l,a-=c.offsetX/h,o=c.originalHeight/l,s=c.originalWidth/h,u=0;u<i;u+=2)n[u]=r+(1-e[u+1])*o,n[u+1]=a+e[u]*s;return}r-=c.offsetX/l,a-=(c.originalHeight-c.offsetY-c.height)/h,o=c.originalWidth/l,s=c.originalHeight/h}else null==this.region?(r=a=0,o=s=1):(o=this.region.u2-r,s=this.region.v2-a);for(u=0;u<i;u+=2)n[u]=r+e[u]*o,n[u+1]=a+e[u+1]*s},n.prototype.getParentMesh=function(){return this.parentMesh},n.prototype.setParentMesh=function(t){this.parentMesh=t,null!=t&&(this.bones=t.bones,this.vertices=t.vertices,this.worldVerticesLength=t.worldVerticesLength,this.regionUVs=t.regionUVs,this.triangles=t.triangles,this.hullLength=t.hullLength,this.worldVerticesLength=t.worldVerticesLength)},n.prototype.copy=function(){if(null!=this.parentMesh)return this.newLinkedMesh();var e=new n(this.name);return e.region=this.region,e.path=this.path,e.color.setFromColor(this.color),this.copyTo(e),e.regionUVs=new Array(this.regionUVs.length),t.Utils.arrayCopy(this.regionUVs,0,e.regionUVs,0,this.regionUVs.length),e.uvs=new Array(this.uvs.length),t.Utils.arrayCopy(this.uvs,0,e.uvs,0,this.uvs.length),e.triangles=new Array(this.triangles.length),t.Utils.arrayCopy(this.triangles,0,e.triangles,0,this.triangles.length),e.hullLength=this.hullLength,null!=this.edges&&(e.edges=new Array(this.edges.length),t.Utils.arrayCopy(this.edges,0,e.edges,0,this.edges.length)),e.width=this.width,e.height=this.height,e},n.prototype.newLinkedMesh=function(){var t=new n(this.name);return t.region=this.region,t.path=this.path,t.color.setFromColor(this.color),t.deformAttachment=this.deformAttachment,t.setParentMesh(null!=this.parentMesh?this.parentMesh:this),t.updateUVs(),t},n}(t.VertexAttachment);t.MeshAttachment=e}(zlt||(zlt={})),function(t){var e=function(e){function n(n){var i=e.call(this,n)||this;return i.closed=!1,i.constantSpeed=!1,i.color=new t.Color(1,1,1,1),i}return klt(n,e),n.prototype.copy=function(){var e=new n(name);return this.copyTo(e),e.lengths=new Array(this.lengths.length),t.Utils.arrayCopy(this.lengths,0,e.lengths,0,this.lengths.length),e.closed=closed,e.constantSpeed=this.constantSpeed,e.color.setFromColor(this.color),e},n}(t.VertexAttachment);t.PathAttachment=e}(zlt||(zlt={})),function(t){var e=function(e){function n(n){var i=e.call(this,n)||this;return i.color=new t.Color(.38,.94,0,1),i}return klt(n,e),n.prototype.computeWorldPosition=function(t,e){return e.x=this.x*t.a+this.y*t.b+t.worldX,e.y=this.x*t.c+this.y*t.d+t.worldY,e},n.prototype.computeWorldRotation=function(e){var n=t.MathUtils.cosDeg(this.rotation),i=t.MathUtils.sinDeg(this.rotation),r=n*e.a+i*e.b,a=n*e.c+i*e.d;return Math.atan2(a,r)*t.MathUtils.radDeg},n.prototype.copy=function(){var t=new n(name);return t.x=this.x,t.y=this.y,t.rotation=this.rotation,t.color.setFromColor(this.color),t},n}(t.VertexAttachment);t.PointAttachment=e}(zlt||(zlt={})),function(t){var e=function(e){function n(n){var i=e.call(this,n)||this;return i.x=0,i.y=0,i.scaleX=1,i.scaleY=1,i.rotation=0,i.width=0,i.height=0,i.color=new t.Color(1,1,1,1),i.offset=t.Utils.newFloatArray(8),i.uvs=t.Utils.newFloatArray(8),i.tempColor=new t.Color(1,1,1,1),i}return klt(n,e),n.prototype.updateOffset=function(){var t=this.width/this.region.originalWidth*this.scaleX,e=this.height/this.region.originalHeight*this.scaleY,i=-this.width/2*this.scaleX+this.region.offsetX*t,r=-this.height/2*this.scaleY+this.region.offsetY*e,a=i+this.region.width*t,o=r+this.region.height*e,s=this.rotation*Math.PI/180,c=Math.cos(s),l=Math.sin(s),h=i*c+this.x,u=i*l,_=r*c+this.y,f=r*l,d=a*c+this.x,p=a*l,m=o*c+this.y,v=o*l,g=this.offset;g[n.OX1]=h-f,g[n.OY1]=_+u,g[n.OX2]=h-v,g[n.OY2]=m+u,g[n.OX3]=d-v,g[n.OY3]=m+p,g[n.OX4]=d-f,g[n.OY4]=_+p},n.prototype.setRegion=function(t){this.region=t;var e=this.uvs;t.rotate?(e[2]=t.u,e[3]=t.v2,e[4]=t.u,e[5]=t.v,e[6]=t.u2,e[7]=t.v,e[0]=t.u2,e[1]=t.v2):(e[0]=t.u,e[1]=t.v2,e[2]=t.u,e[3]=t.v,e[4]=t.u2,e[5]=t.v,e[6]=t.u2,e[7]=t.v2)},n.prototype.computeWorldVertices=function(t,e,i,r){var a=this.offset,o=t.worldX,s=t.worldY,c=t.a,l=t.b,h=t.c,u=t.d,_=0,f=0;_=a[n.OX1],f=a[n.OY1],e[i]=_*c+f*l+o,e[i+1]=_*h+f*u+s,i+=r,_=a[n.OX2],f=a[n.OY2],e[i]=_*c+f*l+o,e[i+1]=_*h+f*u+s,i+=r,_=a[n.OX3],f=a[n.OY3],e[i]=_*c+f*l+o,e[i+1]=_*h+f*u+s,i+=r,_=a[n.OX4],f=a[n.OY4],e[i]=_*c+f*l+o,e[i+1]=_*h+f*u+s},n.prototype.copy=function(){var e=new n(name);return e.region=this.region,e.rendererObject=this.rendererObject,e.path=this.path,e.x=this.x,e.y=this.y,e.scaleX=this.scaleX,e.scaleY=this.scaleY,e.rotation=this.rotation,e.width=this.width,e.height=this.height,t.Utils.arrayCopy(this.uvs,0,e.uvs,0,8),t.Utils.arrayCopy(this.offset,0,e.offset,0,8),e.color.setFromColor(this.color),e},n.OX1=0,n.OY1=1,n.OX2=2,n.OY2=3,n.OX3=4,n.OY3=5,n.OX4=6,n.OY4=7,n.X1=0,n.Y1=1,n.C1R=2,n.C1G=3,n.C1B=4,n.C1A=5,n.U1=6,n.V1=7,n.X2=8,n.Y2=9,n.C2R=10,n.C2G=11,n.C2B=12,n.C2A=13,n.U2=14,n.V2=15,n.X3=16,n.Y3=17,n.C3R=18,n.C3G=19,n.C3B=20,n.C3A=21,n.U3=22,n.V3=23,n.X4=24,n.Y4=25,n.C4R=26,n.C4G=27,n.C4B=28,n.C4A=29,n.U4=30,n.V4=31,n}(t.Attachment);t.RegionAttachment=e}(zlt||(zlt={})),function(t){var e=function(){function e(t,e){this.jitterX=0,this.jitterY=0,this.jitterX=t,this.jitterY=e}return e.prototype.begin=function(){},e.prototype.transform=function(e){e.x+=t.MathUtils.randomTriangular(-this.jitterX,this.jitterY),e.y+=t.MathUtils.randomTriangular(-this.jitterX,this.jitterY)},e.prototype.end=function(){},e}();t.JitterEffect=e}(zlt||(zlt={})),function(t){var e=function(){function e(t,e){this.centerX=0,this.centerY=0,this.radius=0,this.angle=0,this.worldX=0,this.worldY=0,this.radius=t,this.interpolation=e}return e.prototype.begin=function(t){this.worldX=t.x+this.centerX,this.worldY=t.y+this.centerY},e.prototype.transform=function(e){var n=this.angle*t.MathUtils.degreesToRadians,i=e.x-this.worldX,r=e.y-this.worldY,a=Math.sqrt(i*i+r*r);if(a<this.radius){var o=this.interpolation.apply(0,n,(this.radius-a)/this.radius),s=Math.cos(o),c=Math.sin(o);e.x=s*i-c*r+this.worldX,e.y=c*i+s*r+this.worldY}},e.prototype.end=function(){},e.interpolation=new t.PowOut(2),e}();t.SwirlEffect=e}(zlt||(zlt={}));var Ult,Glt,Hlt,jlt,Wlt,qlt,Xlt=zlt,Ylt=function(){function t(){this.start=void 0,this.interrupt=void 0,this.end=void 0,this.dispose=void 0,this.complete=void 0,this.event=void 0}return t.getListeners=function(e){return e.listener||(e.listener=new t),e.listener},t}(),Klt=1/60,Jlt=[],Qlt=[],Zlt=0,$lt=0,tht=0,eht=null,nht=null,iht=0,rht=0,aht=0,oht=0,sht=null,cht=null,lht=0,hht=0,uht=new Xlt.Color(1,1,1,1),_ht=new Xlt.Color(1,1,1,1),fht=[0,1,2,2,3,0],dht=function(){function t(){this.frames=[],this.totalTime=0,this.isCompleted=!1,this.maxVertexCount=0,this.maxIndexCount=0,this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this._frameIdx=-1,this._skeletonInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null,this._privateMode=!1,this._inited=!1,this._invalid=!0,this._enableCacheAttachedInfo=!1,this.frames=[],this.totalTime=0,this._frameIdx=-1,this.isCompleted=!1,this._skeletonInfo=null,this._animationName=null,this._tempSegments=null,this._tempColors=null,this._tempBoneInfos=null}var e=t.prototype;return e.init=function(t,e){this._inited=!0,this._animationName=e,this._skeletonInfo=t},e.clear=function(){this._inited=!1;for(var t=0,e=this.frames.length;t<e;t++)this.frames[t].segments.length=0;this.invalidAllFrame()},e.bind=function(t){var e=this;t.complete=function(t){t&&t.animation.name===e._animationName&&(e.isCompleted=!0)}},e.unbind=function(t){t.complete=null},e.begin=function(){if(this._invalid){var t=this._skeletonInfo,e=null==t?void 0:t.curAnimationCache;e&&e!==this&&(this._privateMode?e.invalidAllFrame():e.updateToFrame());var n=null==t?void 0:t.skeleton,i=null==t?void 0:t.listener,r=null==t?void 0:t.state,a=null==n?void 0:n.data.findAnimation(this._animationName);null==r||r.setAnimationWith(0,a,!1),this.bind(i),t.curAnimationCache=this,this._frameIdx=-1,this.isCompleted=!1,this.totalTime=0,this._invalid=!1}},e.end=function(){this.needToUpdate()||(this._skeletonInfo.curAnimationCache=null,this.frames.length=this._frameIdx+1,this.isCompleted=!0,this.unbind(this._skeletonInfo.listener))},e.updateToFrame=function(t){if(this._inited&&(this.begin(),this.needToUpdate(t))){var e=this._skeletonInfo,n=null==e?void 0:e.skeleton,i=null==e?void 0:e.clipper,r=null==e?void 0:e.state;do{null==n||n.update(Klt),null==r||r.update(Klt),null==r||r.apply(n),null==n||n.updateWorldTransform(),this._frameIdx++,this.updateFrame(n,i,this._frameIdx),this.totalTime+=Klt}while(this.needToUpdate(t));this.end()}},e.isInited=function(){return this._inited},e.isInvalid=function(){return this._invalid},e.invalidAllFrame=function(){this.isCompleted=!1,this._invalid=!0},e.updateAllFrame=function(){this.invalidAllFrame(),this.updateToFrame()},e.enableCacheAttachedInfo=function(){this._enableCacheAttachedInfo||(this._enableCacheAttachedInfo=!0,this.invalidAllFrame())},e.fillVertices=function(t,e,n,i,r){if(jlt=n.a*e.a*t.a*255,Ult=e.r*t.r*255,Glt=e.g*t.g*255,Hlt=e.b*t.b*255,uht.r=Ult*n.r,uht.g=Glt*n.g,uht.b=Hlt*n.b,uht.a=jlt,null==r.darkColor?_ht.set(0,0,0,1):(_ht.r=r.darkColor.r*Ult,_ht.g=r.darkColor.g*Glt,_ht.b=r.darkColor.b*Hlt),_ht.a=0,Wlt=(uht.a<<24>>>0)+(uht.b<<16)+(uht.g<<8)+uht.r,qlt=(_ht.a<<24>>>0)+(_ht.b<<16)+(_ht.g<<8)+_ht.r,sht!==Wlt||cht!==qlt){var a=this._tempColors;sht=Wlt,cht=qlt,oht>0&&(a[oht-1].vfOffset=tht),a[oht++]={fr:uht.r,fg:uht.g,fb:uht.b,fa:uht.a,dr:_ht.r,dg:_ht.g,db:_ht.b,da:_ht.a,vfOffset:0}}if(i.isClipping()){i.clipTriangles(Jlt,lht,Qlt,hht,Jlt,uht,_ht,!0,6,tht,tht+2);var o=i.clippedVertices,s=i.clippedTriangles;hht=s.length,lht=o.length/12*6;for(var c=0,l=$lt,h=s.length;c<h;)Qlt[l++]=s[c++];for(var u=0,_=o.length,f=tht;u<_;u+=12,f+=6)Jlt[f]=o[u],Jlt[f+1]=o[u+1],Jlt[f+2]=o[u+6],Jlt[f+3]=o[u+7],Jlt[f+4]=Wlt,Jlt[f+5]=qlt}else for(var d=tht,p=tht+lht;d<p;d+=6)Jlt[d+4]=Wlt,Jlt[d+5]=qlt},e.updateFrame=function(t,e,n){tht=0,Zlt=0,$lt=0,eht=null,nht=null,iht=0,rht=0,aht=0,oht=0,sht=null,cht=null,this.frames[n]=this.frames[n]||{segments:[],colors:[],boneInfos:[],vertices:null,uintVert:null,indices:null};var i=this.frames[n],r=this._tempSegments=i.segments,a=this._tempColors=i.colors,o=this._tempBoneInfos=i.boneInfos;this.traverseSkeleton(t,e),oht>0&&(a[oht-1].vfOffset=tht),a.length=oht,o.length=Zlt;var s=aht-1;if(s>=0)if(rht>0){var c=r[s];c.indexCount=rht,c.vfCount=13*iht,c.vertexCount=iht,r.length=aht}else r.length=aht-1;if(0!==r.length){var l=i.vertices,h=tht/6,u=13*h;(!l||l.length<u)&&(l=i.vertices=new Float32Array(u));for(var _=0,f=0;_<u;)l[_]=Jlt[f++],l[_+1]=Jlt[f++],l[_+3]=Jlt[f++],l[_+4]=Jlt[f++],this._setVerticeColor(Jlt[f++],l,_+5),this._setVerticeColor(Jlt[f++],l,_+9),_+=13;var d=i.indices;(!d||d.length<$lt)&&(d=i.indices=new Uint16Array($lt));for(var p=0;p<$lt;p++)d[p]=Qlt[p];i.vertices=l,i.indices=d,this.maxVertexCount=h>this.maxVertexCount?h:this.maxVertexCount,this.maxIndexCount=d.length>this.maxIndexCount?d.length:this.maxIndexCount}},e.needToUpdate=function(t){return!this.isCompleted&&this.totalTime<30&&(void 0===t||this._frameIdx<t)},e.traverseSkeleton=function(t,e){var n,i,r,a,o,s,c,l,h,u,_,f,d=this._tempSegments,p=this._tempBoneInfos,m=t.color,v=t.bones;if(this._enableCacheAttachedInfo)for(var g=0,y=v.length;g<y;g++,Zlt++){var x=v[g],S=p[Zlt];S||(S=p[Zlt]={}),S.a=x.a,S.b=x.b,S.c=x.c,S.d=x.d,S.worldX=x.worldX,S.worldY=x.worldY}for(var A=0,b=t.drawOrder.length;A<b;A++)if((f=t.drawOrder[A]).bone.active)if(lht=0,hht=0,n=f.getAttachment())if(s=n instanceof Xlt.RegionAttachment,c=n instanceof Xlt.MeshAttachment,n instanceof Xlt.ClippingAttachment)e.clipStart(f,n);else if(s||c)if(l=n.region.texture.getRealTexture()){if(_=f.data.blendMode,eht===l.getId()&&nht===_||(eht=l.getId(),nht=_,(h=aht-1)>=0&&(rht>0?((u=d[h]).indexCount=rht,u.vertexCount=iht,u.vfCount=13*iht):aht--),d[aht]={tex:l,blendMode:_,indexCount:0,vertexCount:0,vfCount:0},aht++,rht=0,iht=0),s)o=fht,lht=24,hht=6,n.computeWorldVertices(f.bone,Jlt,tht,6);else if(c){var C=n;o=C.triangles,lht=6*(C.worldVerticesLength>>1),hht=o.length,C.computeWorldVertices(f,0,C.worldVerticesLength,Jlt,tht,6)}if(0!==lht&&0!==hht){for(var T=0,E=$lt,w=o.length;T<w;)Qlt[E++]=o[T++];a=n.uvs;for(var I=tht,P=tht+lht,D=0;I<P;I+=6,D+=2)Jlt[I+2]=a[D],Jlt[I+3]=a[D+1];if(i=n.color,r=f.color,this.fillVertices(m,i,r,e,f),hht>0){for(var R=$lt,M=$lt+hht;R<M;R++)Qlt[R]+=iht;$lt+=hht,tht+=lht,rht+=hht,iht+=lht/6}e.clipEndWithSlot(f)}else e.clipEndWithSlot(f)}else e.clipEndWithSlot(f);else e.clipEndWithSlot(f);else e.clipEndWithSlot(f);e.clipEnd()},e._setVerticeColor=function(t,e,n){e[n]=(255&t)/255,e[n+1]=(t>>8&255)/255,e[n+2]=(t>>16&255)/255,e[n+3]=(t>>24&255)/255},t}(),pht=function(){function t(){this._privateMode=void 0,this._skeletonCache=void 0,this._animationPool=void 0,this._privateMode=!1,this._animationPool={},this._skeletonCache={}}var e=t.prototype;return e.enablePrivateMode=function(){this._privateMode=!0},e.clear=function(){this._animationPool={},this._skeletonCache={}},e.removeSkeleton=function(t){var e=this._skeletonCache[t];if(e){var n=e.animationsCache;for(var i in n){var r=n[i];r&&(this._animationPool[t+"#"+i]=r,r.clear())}delete this._skeletonCache[t]}},e.getSkeletonCache=function(t,e){var n=this._skeletonCache[t];if(!n){var i=new Xlt.Skeleton(e),r=new Xlt.SkeletonClipping,a=new Xlt.AnimationStateData(i.data),o=new Xlt.AnimationState(a),s=new Ylt;o.addListener(s),this._skeletonCache[t]=n={skeleton:i,clipper:r,state:o,listener:s,animationsCache:{},curAnimationCache:null}}return n},e.getAnimationCache=function(t,e){var n=this._skeletonCache[t];return n?n.animationsCache[e]:null},e.invalidAnimationCache=function(t){var e=this._skeletonCache[t];if(e&&e.skeleton){var n=e.animationsCache;for(var i in n)n[i].invalidAllFrame()}},e.initAnimationCache=function(t,e){if(!e)return null;var n=this._skeletonCache[t],i=n&&n.skeleton;if(!i)return null;if(!i.data.findAnimation(e))return null;var r=n.animationsCache,a=r[e];if(!a){var o=t+"#"+e;(a=this._animationPool[o])?delete this._animationPool[o]:(a=new dht)._privateMode=this._privateMode,a.init(n,e),r[e]=a}return a},e.updateAnimationCache=function(t,e){if(e){var n=this.initAnimationCache(t,e);if(!n)return;n.updateAllFrame()}else{var i=this._skeletonCache[t];if(!i||!i.skeleton)return;var r=i.animationsCache;for(var a in r)r[a].updateAllFrame()}},t}();pht.FrameTime=Klt,pht.sharedCache=new pht;var mht,vht,ght,yht,xht,Sht,Aht,bht,Cht,Tht,Eht,wht=new Xn,Iht=function(){function t(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null,this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null}var e=t.prototype;return e.init=function(t){this._inited=!0,this._skeleton=t._skeleton,this._skeletonNode=t.node,this._skeletonComp=t},e.reset=function(){this._inited=!1,this._skeleton=null,this._skeletonNode=null,this._skeletonComp=null},e._syncAttachedNode=function(){if(this._inited){var t=this._skeletonComp.socketNodes;if(0!==t.size){var e;if(e=this._skeletonComp.isAnimationCached()?this._skeletonComp._curFrame&&this._skeletonComp._curFrame.boneInfos:this._skeleton.bones)for(var n,i=function(t,e){var n=wht;n.m00=e.a,n.m01=e.c,n.m04=e.b,n.m05=e.d,n.m12=e.worldX,n.m13=e.worldY,t.matrix=wht},r=st(t.keys());!(n=r()).done;){var a=n.value,o=t.get(a);if(o&&o.isValid){var s=e[a];s?i(o,s):(o.removeFromParent(),o.destroy(),t.delete(a))}else t.delete(a)}}}},t}(),Pht=function(t){function e(e){var n;return(n=t.call(this,e)||this).name="sp.SkeletonTexture",n._texture=null,n._material=null,n}$(e,t);var n=e.prototype;return n.setRealTexture=function(t){this._texture=t},n.getRealTexture=function(){return this._texture},n.setFilters=function(t,e){this._texture&&this.getRealTexture().setFilters(Dht(t),Dht(e))},n.setWraps=function(t,e){this._texture&&this.getRealTexture().setWrapMode(Rht(t),Rht(e))},n.dispose=function(){},e}(Xlt.Texture);function Dht(t){switch(t){case Xlt.TextureFilter.Nearest:case Xlt.TextureFilter.MipMapNearestNearest:case Xlt.TextureFilter.MipMapLinearNearest:return Gm.NEAREST;case Xlt.TextureFilter.MipMap:case Xlt.TextureFilter.MipMapNearestLinear:case Xlt.TextureFilter.MipMapLinearLinear:case Xlt.TextureFilter.Linear:default:return Gm.LINEAR}}function Rht(t){switch(t){case Xlt.TextureWrap.MirroredRepeat:return Um.MIRRORED_REPEAT;case Xlt.TextureWrap.ClampToEdge:return Um.CLAMP_TO_EDGE;case Xlt.TextureWrap.Repeat:default:return Um.REPEAT}}var Mht=(mht=Ec("sp.SkeletonData"),vht=cl([Mv]),ght=cl([Fe]),mht((Eht=function(t){function e(){var e;return ct(e=t.call(this)||this,"_skeletonJson",Sht,at(e)),ct(e,"textures",Aht,at(e)),ct(e,"textureNames",bht,at(e)),ct(e,"scale",Cht,at(e)),ct(e,"_atlasText",Tht,at(e)),e._buffer=void 0,e._skeletonCache=null,e._atlasCache=null,e._skinsEnum=null,e._animsEnum=null,e.reset(),e}$(e,t);var n=e.prototype;return n.createNode=function(t){var e=new TE(this.name);return e.addComponent("cc.Skeleton").skeletonData=this,t(null,e)},n.reset=function(){this._skeletonCache=null,this._atlasCache=null},n.resetEnums=function(){},n.getRuntimeData=function(t){if(this._skeletonCache)return this._skeletonCache;if(!(this.textures&&this.textures.length>0)&&this.textureNames&&this.textureNames.length>0)return t||console.error(this.name+" no textures found!"),null;var e=this._getAtlas(t);if(!e)return null;var n=new Xlt.AtlasAttachmentLoader(e),i=null,r=null;return this.skeletonJson?(r=new Xlt.SkeletonJson(n),i=this.skeletonJson):(r=new Xlt.SkeletonBinary(n),i=new Uint8Array(this._nativeAsset)),r.scale=this.scale,this._skeletonCache=r.readSkeletonData(i),e.dispose(),this._skeletonCache},n.getSkinsEnum=function(){if(this._skinsEnum)return this._skinsEnum;var t=this.getRuntimeData(!0);if(t){for(var e=t.skins,n={},i=0;i<e.length;i++)n[e[i].name]=i;return this._skinsEnum=se(n)}return null},n.getAnimsEnum=function(){if(this._animsEnum&&Object.keys(this._animsEnum).length>1)return this._animsEnum;var t=this.getRuntimeData(!0);if(t){for(var e={"<None>":0},n=t.animations,i=0;i<n.length;i++)e[n[i].name]=i+1;return this._animsEnum=se(e)}return null},n.destroy=function(){return pht.sharedCache.removeSkeleton(this._uuid),t.prototype.destroy.call(this)},n._getTexture=function(t){for(var e=this.textureNames,n=0;n<e.length;n++)if(e[n]===t){var i=this.textures[n],r=new Pht({width:i.width,height:i.height});return r.setRealTexture(i),r}return console.error(this.name+" no textures found!"),null},n._getAtlas=function(t){return this._atlasCache?this._atlasCache:this.atlasText?this._atlasCache=new Xlt.TextureAtlas(this.atlasText,this._getTexture.bind(this)):(t||console.error(this.name+" no atlas found!"),null)},Q(e,[{key:"skeletonJsonStr",get:function(){return this._skeletonJson?JSON.stringify(this._skeletonJson):""}},{key:"skeletonJson",get:function(){return this._skeletonJson},set:function(t){this.reset(),this._skeletonJson="string"==typeof t?JSON.parse(t):t,!this._uuid&&t.skeleton&&(this._uuid=t.skeleton.hash)}},{key:"atlasText",get:function(){return this._atlasText},set:function(t){this._atlasText=t,this.reset()}},{key:"_nativeAsset",get:function(){return this._buffer},set:function(t){this._buffer=t,this.reset()}}]),e}($h),Sht=lt((xht=Eht).prototype,"_skeletonJson",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Aht=lt(xht.prototype,"textures",[Nc,vht],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),bht=lt(xht.prototype,"textureNames",[Nc,ght],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Cht=lt(xht.prototype,"scale",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Tht=lt(xht.prototype,"_atlasText",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),yht=xht))||yht);h.internal.SpineSkeletonData=Mht;var Oht,Nht,Bht,Lht,Fht,Vht,zht,kht,Uht,Ght,Hht,jht,Wht,qht,Xht,Yht,Kht,Jht,Qht,Zht,$ht,tut,eut,nut,iut,rut,aut,out,sut,cut,lut,hut,uut,_ut,fut,dut,put,mut,vut,gut,yut,xut,Sut,Aut,but,Cut,Tut,Eut,wut,Iut,Put,Dut,Rut,Mut,Out,Nut=function(t){function e(){var e;return(e=t.call(this)||this)._skeletons=new Set,e}$(e,t),e.getInstance=function(){return e._instance||(e._instance=new e,TO.registerSystem(e.ID,e._instance,uO.Priority.HIGH)),e._instance};var n=e.prototype;return n.add=function(t){t&&(this._skeletons.has(t)||this._skeletons.add(t))},n.remove=function(t){t&&this._skeletons.has(t)&&this._skeletons.delete(t)},n.postUpdate=function(t){this._skeletons&&this._skeletons.forEach((function(e){e.updateAnimation(t)}))},e}(uO);function But(t,e,n){en.Attr.setClassAttr(t,e,"type","Enum"),en.Attr.setClassAttr(t,e,"enumList",se.getList(n))}Nut.ID="SKELETON",Nut._instance=void 0,function(t){t[t.default=0]="default"}(Dut||(Dut={})),he(Dut),function(t){t[t["<None>"]=0]="<None>"}(Rut||(Rut={})),he(Rut),function(t){t[t.REALTIME=0]="REALTIME",t[t.SHARED_CACHE=1]="SHARED_CACHE",t[t.PRIVATE_CACHE=2]="PRIVATE_CACHE"}(Mut||(Mut={})),he(Mut),function(t){t[t.COLORED_TEXTURED=0]="COLORED_TEXTURED",t[t.TWO_COLORED=1]="TWO_COLORED"}(Out||(Out={}));var Lut=(Oht=Ec("sp.Skeleton.SpineSocket"),Nht=cl(TE),Oht((Fht=lt((Lht=function(t,e){void 0===t&&(t=""),void 0===e&&(e=null),ct(this,"path",Fht,this),ct(this,"target",Vht,this),this.path=t,this.target=e}).prototype,"path",[Nc,Wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Vht=lt(Lht.prototype,"target",[Nht,Wc,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Bht=Lht))||Bht);re.setClassAlias(Lut,"sp.Skeleton.SpineSocket");var Fut=(zht=Ec("sp.Skeleton"),kht=jc(),Uht=kc(),Ght=cl(vg),Hht=el(),jht=Yc(),Wht=cl(Mht),qht=Yc(),Xht=cl(Dut),Yht=Kc(),Kht=Yc(),Jht=cl(Rut),Qht=Kc(),Zht=Yc(),$ht=Kc(),tut=cl(Mut),eut=Kc(),nut=Kc(),iut=Kc(),rut=Kc(),aut=Kc(),out=Kc(),sut=Kc(),cut=cl([Lut]),lut=Kc(),hut=qc(),uut=qc(),zht(_ut=kht(_ut=Uht(_ut=zc((Put=Iut=function(t){function e(){var e;return ct(e=t.call(this)||this,"loop",dut,at(e)),e._frameCache=null,e._curFrame=null,e._effectDelegate=null,e._skeleton=void 0,e._clipper=void 0,e._debugRenderer=void 0,e._startSlotIndex=void 0,e._endSlotIndex=void 0,e._startEntry=void 0,e._endEntry=void 0,e.attachUtil=void 0,e.maxVertexCount=0,e.maxIndexCount=0,e._materialCache={},e._enumSkins=se({}),e._enumAnimations=se({}),e._playTimes=0,ct(e,"_timeScale",put,at(e)),e._paused=!1,e._accTime=0,e._playCount=0,e._skeletonCache=null,e._animationName="",e._animationQueue=[],e._headAniInfo=null,e._isAniComplete=!0,e._needUpdateSkeltonData=!0,ct(e,"_useTint",mut,at(e)),ct(e,"_preCacheMode",vut,at(e)),ct(e,"_cacheMode",gut,at(e)),ct(e,"_defaultCacheMode",yut,at(e)),ct(e,"_debugBones",xut,at(e)),ct(e,"_debugSlots",Sut,at(e)),ct(e,"_skeletonData",Aut,at(e)),ct(e,"_premultipliedAlpha",but,at(e)),ct(e,"defaultSkin",Cut,at(e)),ct(e,"defaultAnimation",Tut,at(e)),ct(e,"_sockets",Eut,at(e)),e._drawIdx=0,e._drawList=new Xl((function(){return{material:null,texture:null,indexOffset:0,indexCount:0}}),1),ct(e,"_debugMesh",wut,at(e)),e._rootBone=void 0,e._state=void 0,e._listener=void 0,e._socketNodes=new Map,e._cachedSockets=new Map,e._effectDelegate=null,e._skeleton=null,e._rootBone=null,e._listener=null,e._debugRenderer=null,e._startSlotIndex=-1,e._endSlotIndex=-1,e._startEntry={animation:{name:""},trackIndex:0},e._endEntry={animation:{name:""},trackIndex:0},e.attachUtil=new Iht,But(at(e),"_defaultSkinIndex",e._enumSkins),But(at(e),"_animationIndex",e._enumAnimations),e._useVertexOpacity=!0,e}$(e,t);var n=e.prototype;return n.setSkeletonData=function(t){var e=this.node._uiProps.uiTransformComp;if(null!=t.width&&null!=t.height&&e.setContentSize(t.width,t.height),this._cacheMode===Mut.SHARED_CACHE?this._skeletonCache=pht.sharedCache:this._cacheMode===Mut.PRIVATE_CACHE&&(this._skeletonCache=new pht,this._skeletonCache.enablePrivateMode()),this.isAnimationCached()){(this.debugBones||this.debugSlots)&&S("Debug bones or slots is invalid in cached mode");var n=this._skeletonCache.getSkeletonCache(this.skeletonData._uuid,t);this._skeleton=n.skeleton,this._clipper=n.clipper,this._rootBone=this._skeleton.getRootBone()}else this._skeleton=new Xlt.Skeleton(t),this._clipper=new Xlt.SkeletonClipping,this._rootBone=this._skeleton.getRootBone();this._flushAssembler()},n.setSlotsRange=function(t,e){this.isAnimationCached()?S("Slots visible range can not be modified in cached mode."):(this._startSlotIndex=t,this._endSlotIndex=e)},n.setAnimationStateData=function(t){if(this.isAnimationCached())S("'setAnimationStateData' interface can not be invoked in cached mode.");else{var e=new Xlt.AnimationState(t);this._listener&&(this._state&&this._state.removeListener(this._listener),e.addListener(this._listener)),this._state=e}},n.__preload=function(){t.prototype.__preload.call(this);for(var e=this.node.children,n=0,i=e.length;n<i;n++){var r=e[n];r&&"DEBUG_DRAW_NODE"===r.name&&r.destroy()}this._updateSkeletonData(),this._updateDebugDraw(),this._updateUseTint(),this._indexBoneSockets(),this._updateSocketBindings()},n.setAnimationCacheMode=function(t){this._preCacheMode!==t&&(this._cacheMode=t,this._needUpdateSkeltonData=!0,this._updateSkeletonData(),this._updateUseTint(),this._updateSocketBindings(),this.markForUpdateRenderData())},n.isAnimationCached=function(){return this._cacheMode!==Mut.REALTIME},n.updateAnimation=function(t){if(this.markForUpdateRenderData(),!this.paused)if(t*=1*this._timeScale,this.isAnimationCached()){if(this._isAniComplete){if(0===this._animationQueue.length&&!this._headAniInfo){var e=this._frameCache;if(e&&e.isInvalid()){e.updateToFrame();var n=e.frames;this._curFrame=n[n.length-1]}return}if(this._headAniInfo||(this._headAniInfo=this._animationQueue.shift()),this._accTime+=t,this._accTime>this._headAniInfo.delay){var i=this._headAniInfo;this._headAniInfo=null,this.setAnimation(0,i.animationName,i.loop)}return}this._updateCache(t)}else this._updateRealtime(t)},n.setVertexEffectDelegate=function(t){this._effectDelegate=t},n.setToSetupPose=function(){this._skeleton&&this._skeleton.setToSetupPose()},n.setBonesToSetupPose=function(){this._skeleton&&this._skeleton.setBonesToSetupPose()},n.setSlotsToSetupPose=function(){this._skeleton&&this._skeleton.setSlotsToSetupPose()},n.updateAnimationCache=function(t){if(this.isAnimationCached()){var e=this._skeletonData._uuid;this._skeletonCache&&this._skeletonCache.updateAnimationCache(e,t)}},n.invalidAnimationCache=function(){this.isAnimationCached()&&this._skeletonCache&&this._skeletonCache.invalidAnimationCache(this._skeletonData._uuid)},n.findBone=function(t){return this._skeleton?this._skeleton.findBone(t):null},n.findSlot=function(t){return this._skeleton?this._skeleton.findSlot(t):null},n.setSkin=function(t){this._skeleton&&(this._skeleton.setSkinByName(t),this._skeleton.setSlotsToSetupPose()),this.invalidAnimationCache()},n.getAttachment=function(t,e){return this._skeleton?this._skeleton.getAttachmentByName(t,e):null},n.setAttachment=function(t,e){this._skeleton&&this._skeleton.setAttachment(t,e),this.invalidAnimationCache()},n.getTextureAtlas=function(t){return t.region},n.setMix=function(t,e,n){this._state&&this._state.data.setMix(t,e,n)},n.setAnimation=function(t,e,n){if(this._playTimes=n?0:1,this._animationName=e,this.isAnimationCached()){if(0!==t&&S("Track index can not greater than 0 in cached mode."),!this._skeletonCache)return null;var i=this._skeletonCache.getAnimationCache(this._skeletonData._uuid,e);i||(i=this._skeletonCache.initAnimationCache(this._skeletonData._uuid,e)),i&&(this._isAniComplete=!1,this._accTime=0,this._playCount=0,this._frameCache=i,this._socketNodes.size>0&&this._frameCache.enableCacheAttachedInfo(),this._frameCache.updateToFrame(0),this._curFrame=this._frameCache.frames[0])}else if(this._skeleton){var r=this._skeleton.data.findAnimation(e);if(!r)return P(7509,e),null;var a=this._state.setAnimationWith(t,r,n);return this._state.apply(this._skeleton),a}return null},n.addAnimation=function(t,e,n,i){if(i=i||0,this.isAnimationCached())0!==t&&S("Track index can not greater than 0 in cached mode."),this._animationQueue.push({animationName:e,loop:n,delay:i});else if(this._skeleton){var r,a=this._skeleton.data.findAnimation(e);return a?null===(r=this._state)||void 0===r?void 0:r.addAnimationWith(t,a,n,i):(P(7510,e),null)}return null},n.findAnimation=function(t){return this._skeleton?this._skeleton.data.findAnimation(t):null},n.getCurrent=function(t){if(this.isAnimationCached())S("'getCurrent' interface can not be invoked in cached mode.");else if(this._state)return this._state.getCurrent(t);return null},n.clearTracks=function(){this.isAnimationCached()?S("'clearTracks' interface can not be invoked in cached mode."):this._state&&(this._state.clearTracks(),this.setToSetupPose())},n.clearTrack=function(t){this.isAnimationCached()?S("'clearTrack' interface can not be invoked in cached mode."):this._state&&this._state.clearTrack(t)},n.setStartListener=function(t){this._ensureListener(),this._listener.start=t},n.setInterruptListener=function(t){this._ensureListener(),this._listener.interrupt=t},n.setEndListener=function(t){this._ensureListener(),this._listener.end=t},n.setDisposeListener=function(t){this._ensureListener(),this._listener.dispose=t},n.setCompleteListener=function(t){this._ensureListener(),this._listener.complete=t},n.setEventListener=function(t){this._ensureListener(),this._listener.event=t},n.setTrackStartListener=function(t,e){Ylt.getListeners(t).start=e},n.setTrackInterruptListener=function(t,e){Ylt.getListeners(t).interrupt=e},n.setTrackEndListener=function(t,e){Ylt.getListeners(t).end=e},n.setTrackDisposeListener=function(t,e){Ylt.getListeners(t).dispose=e},n.setTrackCompleteListener=function(t,e){Ylt.getListeners(t).complete=function(t){var n=Math.floor(t.trackTime/t.animationEnd);e(t,n)}},n.setTrackEventListener=function(t,e){Ylt.getListeners(t).event=e},n.getState=function(){return this._state},n.onEnable=function(){t.prototype.onEnable.call(this),this._flushAssembler(),Nut.getInstance().add(this)},n.onDisable=function(){t.prototype.onDisable.call(this),Nut.getInstance().remove(this)},n.onDestroy=function(){this._cleanMaterialCache(),this._drawList.destroy(),t.prototype.onDestroy.call(this)},n.destroyRenderData=function(){this._drawList.reset(),t.prototype.destroyRenderData.call(this)},n.getMaterialForBlendAndTint=function(t,e,n){var i=n+"/"+t+"/"+e,r=this._materialCache[i];if(r)return r;var a=this.customMaterial;null===a&&(a=Uv.get("default-spine-material"));var o=!1;switch(n){case Out.TWO_COLORED:o=!0;break;case Out.COLORED_TEXTURED:}return r=new wy({parent:a,subModelIdx:0,owner:this}),this._materialCache[i]=r,r.overridePipelineStates({blendState:{blendColor:Dn.WHITE,targets:[{blendEq:Ni.ADD,blendAlphaEq:Ni.ADD,blendSrc:t,blendDst:e,blendSrcAlpha:t,blendDstAlpha:e}]}}),r.recompileShaders({TWO_COLORED:o,USE_LOCAL:!0}),r},n.onRestore=function(){this.updateMaterial(),this._renderFlag=this._canRender(),this.markForUpdateRenderData()},n.updateMaterial=function(){if(this._customMaterial)return this.setMaterial(this._customMaterial,0),void(this._blendHash=-1);var t=this._updateBuiltinMaterial();this.setMaterial(t,0),this._updateBlendFunc(),this._blendHash=-1},n.querySockets=function(){return this._skeleton?(0===this._cachedSockets.size&&this._indexBoneSockets(),this._cachedSockets.size>0?Array.from(this._cachedSockets.keys()).sort():[]):[]},n._requestDrawData=function(t,e,n,i){var r=this._drawList.add();return r.material=t,r.texture=e,r.indexOffset=n,r.indexCount=i,r},n._render=function(t){if(this._renderData&&this._drawList){var e=this._renderData,n=e.chunk,i=n.vertexAccessor,r=e.getMeshBuffer(),a=r.indexOffset;i.appendIndices(n.bufferId,e.indices);for(var o=0;o<this._drawList.length;o++){this._drawIdx=o;var s=this._drawList.data[o];if(s.texture){var c=r.requireFreeIA(t.device);c.firstIndex=a+s.indexOffset,c.indexCount=s.indexCount,t.commitIA(this,c,s.texture,s.material,this.node)}}}},n.updateWorldTransform=function(){this.isAnimationCached()&&this._skeleton&&this._skeleton.updateWorldTransform()},n._emitCacheCompleteEvent=function(){this._listener&&(this._endEntry.animation.name=this._animationName,this._listener.complete&&this._listener.complete(this._endEntry),this._listener.end&&this._listener.end(this._endEntry))},n._updateCache=function(t){var e=this._frameCache;if(e.isInited()){var n=e.frames,i=pht.FrameTime;0===this._accTime&&0===this._playCount&&(this._startEntry.animation.name=this._animationName,this._listener&&this._listener.start&&this._listener.start(this._startEntry)),this._accTime+=t;var r=Math.floor(this._accTime/i);if(e.isCompleted||(e.updateToFrame(r),this._renderData&&(this._renderData.vertexCount<e.maxVertexCount||this._renderData.indexCount<e.maxIndexCount)&&(this.maxVertexCount=e.maxVertexCount>this.maxVertexCount?e.maxVertexCount:this.maxVertexCount,this.maxIndexCount=e.maxIndexCount>this.maxIndexCount?e.maxIndexCount:this.maxIndexCount,this._renderData.resize(this.maxVertexCount,this.maxIndexCount),(!this._renderData.indices||this.maxIndexCount>this._renderData.indices.length)&&(this._renderData.indices=new Uint16Array(this.maxIndexCount)))),e.isCompleted&&r>=n.length){if(this._playCount++,this._playTimes>0&&this._playCount>=this._playTimes)return this._curFrame=n[n.length-1],this._accTime=0,this._playCount=0,this._isAniComplete=!0,void this._emitCacheCompleteEvent();this._accTime=0,r=0,this._emitCacheCompleteEvent()}this._curFrame=n[r]}},n._updateRealtime=function(t){var e=this._skeleton,n=this._state;e&&(e.update(t),n&&(n.update(t),n.apply(e)))},n._indexBoneSockets=function(){if(this._skeleton){this._cachedSockets.clear();for(var t=this._skeleton.bones,e=function e(n){return null==n.parent?n.data.name||"<Unamed>":e(t[n.parent.data.index])+"/"+n.data.name},n=0,i=t.length;n<i;n++){var r=t[n].data,a=e(t[n]);this._cachedSockets.set(a,r.index)}}},n._updateUseTint=function(){this._cleanMaterialCache(),this.destroyRenderData(),this._assembler&&this._skeleton&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData())},n._updateBatch=function(){this.markForUpdateRenderData()},n._updateAnimEnum=function(){var t;t=this.skeletonData?this.skeletonData.getAnimsEnum():Rut,this._enumAnimations=se({}),Object.assign(this._enumAnimations,t),se.update(this._enumAnimations),But(this,"_animationIndex",this._enumAnimations)},n._updateSkinEnum=function(){var t;t=this.skeletonData?this.skeletonData.getSkinsEnum():Dut,this._enumSkins=se({}),Object.assign(this._enumSkins,t),se.update(this._enumSkins),But(this,"_defaultSkinIndex",this._enumSkins)},n._ensureListener=function(){this._listener||(this._listener=new Ylt,this._state&&this._state.addListener(this._listener))},n._updateSkeletonData=function(){if(this.skeletonData&&!1!==this._needUpdateSkeltonData){this._needUpdateSkeltonData=!1;var t=this.skeletonData.getRuntimeData();if(t){try{this.setSkeletonData(t),this.isAnimationCached()||this.setAnimationStateData(new Xlt.AnimationStateData(this._skeleton.data)),this.defaultSkin&&this.setSkin(this.defaultSkin)}catch(t){S(t)}this._indexBoneSockets(),this.attachUtil.init(this),this._preCacheMode=this._cacheMode,this.animation=this.defaultAnimation}}},n._refreshInspector=function(){this._updateAnimEnum(),this._updateSkinEnum()},n._updateDebugDraw=function(){if(this.debugBones||this.debugSlots||this.debugMesh){if(!this._debugRenderer){var t=new TE("DEBUG_DRAW_NODE");t.hideFlags|=ml.Flags.DontSave|ml.Flags.HideInHierarchy;var e=t.addComponent(NU);e.lineWidth=1,e.strokeColor=new Dn(255,0,0,255),this._debugRenderer=e,t.parent=this.node}this.isAnimationCached()&&S("Debug bones or slots is invalid in cached mode")}else this._debugRenderer&&(this._debugRenderer.node.destroy(),this._debugRenderer=null)},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._skeleton&&this._assembler&&(this._renderData=this._assembler.createData(this),this.markForUpdateRenderData(),this._updateColor())},n._updateSocketBindings=function(){if(this._skeleton){this._socketNodes.clear();for(var t=0,e=this._sockets.length;t<e;t++){var n=this._sockets[t];if(n.path&&n.target){var i=this._cachedSockets.get(n.path);if(!i){console.error("Skeleton data does not contain path "+n.path);continue}this._socketNodes.set(i,n.target)}}}},n._verifySockets=function(t){for(var e=0,n=t.length;e<n;e++){var i=t[e].target;!i||i.parent&&i.parent===this.node||console.error("Target node "+i.name+" is expected to be a direct child of "+this.node.name)}var r=new Map;t.forEach((function(t){t.target&&(r.get(t.target)?console.error("Target node "+t.target.name+" has existed."):r.set(t.target,!0))}))},n._cleanMaterialCache=function(){for(var t in this._materialCache)this._materialCache[t].destroy();this._materialCache={}},Q(e,[{key:"drawList",get:function(){return this._drawList}},{key:"customMaterial",get:function(){return this._customMaterial},set:function(t){this._customMaterial=t,this._cleanMaterialCache()}},{key:"paused",get:function(){return this._paused},set:function(t){this._paused=t}},{key:"skeletonData",get:function(){return this._skeletonData},set:function(t){t&&t.resetEnums(),this._skeletonData!==t&&(this.destroyRenderData(),this._skeletonData=t,this._needUpdateSkeltonData=!0,this.defaultSkin="",this.defaultAnimation="",this._updateSkeletonData())}},{key:"animation",get:function(){if(this.isAnimationCached())return this._animationName;var t=this.getCurrent(0);return t&&t.animation.name||""},set:function(t){t?(this.setAnimation(0,t,this.loop),this.markForUpdateRenderData()):this.isAnimationCached()||(this.clearTrack(0),this.setToSetupPose())}},{key:"_defaultSkinIndex",get:function(){if(this.skeletonData){var t=this.skeletonData.getSkinsEnum();if(t)if(""===this.defaultSkin){if(t.hasOwnProperty(0))return this._defaultSkinIndex=0,0}else{var e=t[this.defaultSkin];if(void 0!==e)return e}}return 0},set:function(t){var e;if(this.skeletonData&&(e=this.skeletonData.getSkinsEnum()),e){var n=e[t];void 0!==n?(this.defaultSkin=n,this.setSkin(this.defaultSkin)):console.error(this.name+" skin enums are invalid")}else console.error(this.name+" skin enums are invalid")}},{key:"_animationIndex",get:function(){var t=this.animation;if(this.skeletonData)if(t){var e=this.skeletonData.getAnimsEnum();if(e){var n=e[t];if(void 0!==n)return n}}else this._refreshInspector();return 0},set:function(t){var e;if(this.skeletonData&&(e=this.skeletonData.getAnimsEnum()),e){var n=e[t];void 0!==n?(this.animation=n,this.animation=n):console.error(this.name+" animation enums are invalid")}else console.error(this.name+" animation enums are invalid")}},{key:"defaultCacheMode",get:function(){return this._defaultCacheMode},set:function(t){this._defaultCacheMode=t,this.setAnimationCacheMode(this._defaultCacheMode)}},{key:"premultipliedAlpha",get:function(){return this._premultipliedAlpha},set:function(t){t!==this._premultipliedAlpha&&(this._premultipliedAlpha=t,this.markForUpdateRenderData())}},{key:"timeScale",get:function(){return this._timeScale},set:function(t){t!==this._timeScale&&(this._timeScale=t)}},{key:"debugSlots",get:function(){return this._debugSlots},set:function(t){t!==this._debugSlots&&(this._debugSlots=t,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"debugBones",get:function(){return this._debugBones},set:function(t){t!==this._debugBones&&(this._debugBones=t,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"debugMesh",get:function(){return this._debugMesh},set:function(t){t!==this._debugMesh&&(this._debugMesh=t,this._updateDebugDraw(),this.markForUpdateRenderData())}},{key:"useTint",get:function(){return this._useTint},set:function(t){t!==this._useTint&&(this._useTint=t,this._updateUseTint())}},{key:"sockets",get:function(){return this._sockets},set:function(t){this._sockets=t,this._updateSocketBindings(),this.attachUtil._syncAttachedNode()}},{key:"socketNodes",get:function(){return this._socketNodes}}]),e}(xk),Iut.SpineSocket=Lut,Iut.AnimationCacheMode=Mut,lt((fut=Put).prototype,"customMaterial",[hl,Ght,Hht,jht],Object.getOwnPropertyDescriptor(fut.prototype,"customMaterial"),fut.prototype),lt(fut.prototype,"skeletonData",[Wc,Wht],Object.getOwnPropertyDescriptor(fut.prototype,"skeletonData"),fut.prototype),lt(fut.prototype,"_defaultSkinIndex",[qht,Xht,Yht],Object.getOwnPropertyDescriptor(fut.prototype,"_defaultSkinIndex"),fut.prototype),lt(fut.prototype,"_animationIndex",[Kht,Jht,Qht],Object.getOwnPropertyDescriptor(fut.prototype,"_animationIndex"),fut.prototype),lt(fut.prototype,"defaultCacheMode",[Zht,$ht,Wc,tut],Object.getOwnPropertyDescriptor(fut.prototype,"defaultCacheMode"),fut.prototype),dut=lt(fut.prototype,"loop",[Nc,eut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),lt(fut.prototype,"premultipliedAlpha",[Wc,nut],Object.getOwnPropertyDescriptor(fut.prototype,"premultipliedAlpha"),fut.prototype),lt(fut.prototype,"timeScale",[iut,Wc],Object.getOwnPropertyDescriptor(fut.prototype,"timeScale"),fut.prototype),lt(fut.prototype,"debugSlots",[Wc,rut],Object.getOwnPropertyDescriptor(fut.prototype,"debugSlots"),fut.prototype),lt(fut.prototype,"debugBones",[Wc,aut],Object.getOwnPropertyDescriptor(fut.prototype,"debugBones"),fut.prototype),lt(fut.prototype,"debugMesh",[Wc,out],Object.getOwnPropertyDescriptor(fut.prototype,"debugMesh"),fut.prototype),lt(fut.prototype,"useTint",[Wc,sut],Object.getOwnPropertyDescriptor(fut.prototype,"useTint"),fut.prototype),lt(fut.prototype,"sockets",[cut,lut],Object.getOwnPropertyDescriptor(fut.prototype,"sockets"),fut.prototype),put=lt(fut.prototype,"_timeScale",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),mut=lt(fut.prototype,"_useTint",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),vut=lt(fut.prototype,"_preCacheMode",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1}}),gut=lt(fut.prototype,"_cacheMode",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Mut.REALTIME}}),yut=lt(fut.prototype,"_defaultCacheMode",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Mut.REALTIME}}),xut=lt(fut.prototype,"_debugBones",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Sut=lt(fut.prototype,"_debugSlots",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Aut=lt(fut.prototype,"_skeletonData",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),but=lt(fut.prototype,"_premultipliedAlpha",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Cut=lt(fut.prototype,"defaultSkin",[Nc,hut],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Tut=lt(fut.prototype,"defaultAnimation",[uut,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Eut=lt(fut.prototype,"_sockets",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),wut=lt(fut.prototype,"_debugMesh",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),_ut=fut))||_ut)||_ut)||_ut)||_ut);h.internal.SpineSkeleton=Fut;var Vut,zut,kut,Uut,Gut,Hut,jut,Wut,qut,Xut,Yut,Kut,Jut,Qut,Zut,$ut,t_t,e_t,n_t,i_t,r_t,a_t,o_t,s_t,c_t,l_t,h_t,u_t,__t,f_t,d_t,p_t,m_t,v_t,g_t,y_t=function(){function t(){this.name="sp.VertexEffectDelegate",this._vertexEffect=null,this._interpolation=null,this._effectType=void 0,this._vertexEffect=null,this._interpolation=null,this._effectType="none"}var e=t.prototype;return e.clear=function(){this._vertexEffect=null,this._interpolation=null,this._effectType="none"},e.initJitter=function(t,e){return this._effectType="jitter",this._vertexEffect=new Xlt.JitterEffect(t,e),this._vertexEffect},e.initSwirlWithPow=function(t,e){return this._interpolation=new Xlt.Pow(e),this._vertexEffect=new Xlt.SwirlEffect(t,this._interpolation),this._vertexEffect},e.initSwirlWithPowOut=function(t,e){return this._interpolation=new Xlt.PowOut(e),this._vertexEffect=new Xlt.SwirlEffect(t,this._interpolation),this._vertexEffect},e.getJitterVertexEffect=function(){return this._vertexEffect},e.getSwirlVertexEffect=function(){return this._vertexEffect},e.getVertexEffect=function(){return this._vertexEffect},e.getEffectType=function(){return this._effectType},t}(),x_t=[0,1,2,2,3,0],S_t=new Dn(0,0,255,255),A_t=new Dn(255,0,0,255),b_t=new Dn(0,255,0,255),C_t=new Dn(255,255,0,255),T_t=new Xlt.Color(1,1,1,1),E_t=new Xlt.Color(1,1,1,1),w_t=new Xlt.Vector2,I_t=new Xlt.Vector2,P_t=new Float32Array(4),D_t=new Float32Array(4),R_t=0,M_t=0,O_t=0,N_t=0,B_t=0,L_t=0,F_t=0,V_t=0,z_t=null,k_t=null,U_t=null;function G_t(t){var e,n;switch(t){case Xlt.BlendMode.Additive:e=Vut?Oi.ONE:Oi.SRC_ALPHA,n=Oi.ONE;break;case Xlt.BlendMode.Multiply:e=Oi.DST_COLOR,n=Oi.ONE_MINUS_SRC_ALPHA;break;case Xlt.BlendMode.Screen:e=Oi.ONE,n=Oi.ONE_MINUS_SRC_COLOR;break;case Xlt.BlendMode.Normal:default:e=Vut?Oi.ONE:Oi.SRC_ALPHA,n=Oi.ONE_MINUS_SRC_ALPHA}return d_t.getMaterialForBlendAndTint(e,n,Gut?Out.TWO_COLORED:Out.COLORED_TEXTURED)}function H_t(t){l_t=t.fa*Kut,i_t=qut*(zut=Vut?l_t/255:1),r_t=Xut*zut,a_t=Yut*zut,o_t=t.fr*i_t,s_t=t.fg*r_t,c_t=t.fb*a_t,P_t[0]=o_t/255,P_t[1]=s_t/255,P_t[2]=c_t/255,P_t[3]=l_t/255,h_t=t.dr*i_t,u_t=t.dg*r_t,__t=t.db*a_t,f_t=Vut?255:0,D_t[0]=h_t/255,D_t[1]=u_t/255,D_t[2]=__t/255,D_t[3]=f_t/255}var j_t=new Float32Array(4);function W_t(t){return j_t[0]=t.r/255,j_t[1]=t.g/255,j_t[2]=t.b/255,j_t[3]=t.a/255,j_t}var q_t=null,X_t=null,Y_t={vCount:32767,ensureAccessor:function(t){var e=t?X_t:q_t;if(!e){var n=TO.root.device,i=TO.root.batcher2D,r=t?iV:nV;t?(e=X_t=new GX(n,r,this.vCount),i.registerBufferAccessor(Number.parseInt("SPINETINT",36),X_t)):(e=q_t=new GX(n,r,this.vCount),i.registerBufferAccessor(Number.parseInt("SPINE",36),q_t))}return e},createData:function(t){var e=t.renderData;if(!e){for(var n=t.useTint||t.isAnimationCached(),i=this.ensureAccessor(n),r=t._skeleton.data.skins,a=0,o=0,s=0;s<r.length;++s)for(var c=r[s].attachments,l=0;l<c.length;l++){var h=c[l];for(var u in h){var _=h[u];_ instanceof Xlt.RegionAttachment?(a+=4,o+=6):_ instanceof Xlt.MeshAttachment&&(a+=_.worldVerticesLength>>1,o+=_.triangles.length)}}(e=TV.add(n?iV:nV,i)).resize(a,o),e.indices&&o===e.indices.length||(e.indices=new Uint16Array(o)),t.maxVertexCount=a,t.maxIndexCount=o}return e},updateRenderData:function(t){d_t=t;var e=t._skeleton;!t.isAnimationCached()&&e&&e.updateWorldTransform(),e&&function(t){if(t._skeleton){var e=t.color;qut=e.r/255,Xut=e.g/255,Yut=e.b/255,Kut=t.node._uiProps.opacity,Gut=t.useTint||t.isAnimationCached(),Jut=Gut?13:9,t.drawList.reset(),d_t=t,t.node,p_t=t.renderData,k_t=null,n_t=!0,Vut=t.premultipliedAlpha,zut=1,g_t=!1,z_t=t._effectDelegate&&t._effectDelegate._vertexEffect,(4294967295!==e._val||Vut)&&(g_t=!0),t.isAnimationCached()?function(){var t=d_t._curFrame;if(t){var e=t.segments;if(0!==e.length){Qut=12,N_t=0,B_t=0,O_t=0,L_t=0;var n=null,i=t.vertices,r=t.indices,a=0,o=0,s=0,c=0,l=t.colors,h=0,u=l[h++],_=u.vfOffset;H_t(u);for(var f=0,d=p_t,p=d.chunk.vb,m=d.indices,v=0,g=e.length;v<g;v++){var y=e[v];if(n=G_t(y.blendMode)){if(k_t||(k_t=n),n_t||n.hash!==k_t.hash||y.tex&&y.tex!==U_t){n_t=!1;var x=L_t-f;x>0&&(d_t._requestDrawData(k_t,U_t,f,x),f=L_t),k_t=n,U_t=y.tex}M_t=y.vertexCount,B_t=y.indexCount,a=d.chunk.vertexOffset;for(var S=L_t,A=L_t+B_t;S<A;S++)m[S]=a+O_t+r[s++];if(c=y.vfCount,p.set(i.subarray(o,o+c),o),g_t)for(var b=o/13*6,C=o,T=o+c;C<T;C+=Jut,b+=6)b>=_&&(H_t(u=l[h++]),_=u.vfOffset),p.set(P_t,C+5),p.set(D_t,C+9);o+=c,O_t+=M_t,L_t+=B_t,M_t=0,B_t=0}}var E=L_t-f;U_t&&E>0&&d_t._requestDrawData(k_t,U_t,f,E)}}}():(z_t&&z_t.begin(t._skeleton),function(){var t=p_t;v_t=t.chunk.vb,m_t=t.indices,F_t=d_t.maxVertexCount,V_t=d_t.maxIndexCount;var e,n,i,r,a,o,s=d_t._skeleton,c=s.color,l=d_t._debugRenderer,h=d_t._clipper,u=null;kut=d_t._startSlotIndex,Uut=d_t._endSlotIndex,e_t=!1,-1===kut&&(e_t=!0),Hut=d_t.debugSlots,jut=d_t.debugBones,Wut=d_t.debugMesh,l&&(jut||Hut||Wut)&&(l.clear(),l.lineWidth=5),Qut=12,R_t=0,O_t=0,N_t=0,B_t=0,L_t=0;for(var _=0,f=0,d=s.drawOrder.length;f<d;f++)if(void 0!==(o=s.drawOrder[f])&&o.bone.active)if(kut>=0&&kut===o.data.index&&(e_t=!0),e_t)if(Uut>=0&&Uut===o.data.index&&(e_t=!1),R_t=0,B_t=0,e=o.getAttachment())if(r=e instanceof Xlt.RegionAttachment,a=e instanceof Xlt.MeshAttachment,e instanceof Xlt.ClippingAttachment)h.clipStart(o,e);else if(r||a){var p=e.region.texture.getRealTexture();if(u=G_t(o.data.blendMode)){if(k_t||(k_t=u),n_t||u.hash!==k_t.hash||p&&U_t!==p){n_t=!1;var m=L_t-_;m>0&&(d_t._requestDrawData(k_t,U_t,_,m),_=L_t),U_t=p,k_t=u}if(r){if(i=x_t,R_t=(M_t=4)*Jut,B_t=6,e.computeWorldVertices(o.bone,v_t,N_t,Jut),l&&Hut){l.strokeColor=S_t,l.moveTo(v_t[N_t],v_t[N_t+1]);for(var v=N_t+Jut,g=N_t+R_t;v<g;v+=Jut)l.lineTo(v_t[v],v_t[v+1]);l.close(),l.stroke()}}else if(a){var y=e;if(i=y.triangles,M_t=y.worldVerticesLength>>1,R_t=M_t*Jut,B_t=i.length,y.computeWorldVertices(o,0,y.worldVerticesLength,v_t,N_t,Jut),l&&Wut){l.strokeColor=C_t;for(var x=0,S=i.length;x<S;x+=3){var A=i[x]*Jut+N_t,b=i[x+1]*Jut+N_t,C=i[x+2]*Jut+N_t;l.moveTo(v_t[A],v_t[A+1]),l.lineTo(v_t[b],v_t[b+1]),l.lineTo(v_t[C],v_t[C+1]),l.close(),l.stroke()}}}if(0!==R_t&&0!==B_t){var T=e;(m_t=t.indices).set(i,L_t),n=T.uvs;for(var E=N_t,w=N_t+R_t,I=0;E<w;E+=Jut,I+=2)v_t[E+3]=n[I],v_t[E+4]=n[I+1];if(K_t(c,T.color,o.color,h,o),B_t>0)for(var P=t.chunk.vertexOffset,D=L_t,R=L_t+B_t;D<R;D++)m_t[D]+=O_t+P;N_t+=R_t,O_t+=M_t,L_t+=B_t,M_t=0,B_t=0,h.clipEndWithSlot(o)}else h.clipEndWithSlot(o)}else h.clipEndWithSlot(o)}else h.clipEndWithSlot(o);else h.clipEndWithSlot(o);else h.clipEndWithSlot(o);var M=L_t-_;if(U_t&&M>0&&d_t._requestDrawData(k_t,U_t,_,M),h.clipEnd(),l&&jut){var O;l.strokeColor=A_t,l.fillColor=S_t;for(var N=0,B=s.bones.length;N<B;N++){var L=(O=s.bones[N]).data.length*O.a+O.worldX,F=O.data.length*O.c+O.worldY;l.moveTo(O.worldX,O.worldY),l.lineTo(L,F),l.stroke(),l.circle(O.worldX,O.worldY,1.5*Math.PI),l.fill(),0===N&&(l.fillColor=b_t)}}}(),z_t&&z_t.end()),(Gut?X_t:q_t).getMeshBuffer(p_t.chunk.bufferId).setDirty(),t.attachUtil._syncAttachedNode(),d_t=void 0,z_t=null}}(t)},updateColor:function(t){t&&(d_t=t).markForUpdateRenderData()},fillBuffers:function(){}};function K_t(t,e,n,i,r){if(T_t.a=n.a*e.a*t.a*Kut*255,zut=Vut?T_t.a:255,Zut=qut*e.r*t.r*zut,$ut=Xut*e.g*t.g*zut,t_t=Yut*e.b*t.b*zut,T_t.r=Zut*n.r,T_t.g=$ut*n.g,T_t.b=t_t*n.b,null==r.darkColor?E_t.set(0,0,0,1):(E_t.r=r.darkColor.r*Zut,E_t.g=r.darkColor.g*$ut,E_t.b=r.darkColor.b*t_t),E_t.a=Vut?255:0,i.isClipping()){Qut=Gut?12:8;var a=v_t.subarray(N_t),o=v_t.subarray(N_t+3);i.clipTriangles(a,R_t,m_t.subarray(L_t),B_t,o,T_t,E_t,Gut,Jut);var s=i.clippedVertices,c=i.clippedTriangles;if(function(t,e){var n=M_t,i=B_t,r=p_t;B_t=e.length,M_t=t.length/Qut,R_t=M_t*Jut,F_t+=M_t-n,V_t+=B_t-i;var a=m_t,o=r.chunk.vertexOffset,s=!1;if(F_t>r.vertexCount&&(r.resizeAndCopy(F_t,V_t>r.indexCount?V_t:r.indexCount),v_t=r.chunk.vb,s=!0),V_t>m_t.length&&(m_t=r.indices=new Uint16Array(V_t),s=!0),s)for(var c=r.chunk.vertexOffset-o,l=0;l<L_t;++l)m_t[l]=a[l]+c}(s,c),c.length>0&&m_t.set(c,L_t),z_t)for(var l=0,h=s.length,u=N_t;l<h;l+=Qut,u+=Jut)w_t.x=s[l],w_t.y=s[l+1],T_t.set(s[l+2],s[l+3],s[l+4],s[l+5]),I_t.x=s[l+6],I_t.y=s[l+7],Gut?E_t.set(s[l+8],s[l+9],s[l+10],s[l+11]):E_t.set(0,0,0,0),z_t.transform(w_t,I_t,T_t,E_t),v_t[u]=w_t.x,v_t[u+1]=w_t.y,v_t[u+3]=I_t.x,v_t[u+4]=I_t.y,v_t.set(W_t(T_t),u+5),Gut&&v_t.set(W_t(E_t),u+9);else for(var _=0,f=s.length,d=N_t;_<f;_+=Qut,d+=Jut)v_t[d]=s[_],v_t[d+1]=s[_+1],v_t[d+3]=s[_+6],v_t[d+4]=s[_+7],v_t[d+5]=s[_+2]/255,v_t[d+6]=s[_+3]/255,v_t[d+7]=s[_+4]/255,v_t[d+8]=s[_+5]/255,Gut&&(v_t[d+9]=s[_+8]/255,v_t[d+10]=s[_+9]/255,v_t[d+11]=s[_+10]/255,v_t[d+12]=s[_+11]/255)}else if(z_t)for(var p=N_t,m=N_t+R_t;p<m;p+=Jut)w_t.x=v_t[p],w_t.y=v_t[p+1],I_t.x=v_t[p+3],I_t.y=v_t[p+4],z_t.transform(w_t,I_t,T_t,E_t),v_t[p]=w_t.x,v_t[p+1]=w_t.y,v_t[p+3]=I_t.x,v_t[p+4]=I_t.y,v_t.set(W_t(T_t),p+5),Gut&&v_t.set(W_t(E_t),p+9);else{P_t.set(W_t(T_t)),D_t.set(W_t(E_t));for(var v=N_t,g=N_t+R_t;v<g;v+=Jut)v_t.set(P_t,v+5),Gut&&v_t.set(D_t,v+9)}}h.internal.SpineAssembler=Y_t;var J_t,Q_t,Z_t,$_t,tft,eft,nft,ift,rft,aft={getAssembler:function(){return Y_t}};Fut.Assembler=aft,U(Fut.prototype,"Skeleton",[{name:"enableBatch",suggest:"Not support batch render mode"}]),function(t){t[t.REGION=0]="REGION",t[t.BOUNDING_BOX=1]="BOUNDING_BOX",t[t.MESH=2]="MESH",t[t.SKINNED_MESH=3]="SKINNED_MESH"}(J_t||(J_t={})),he(J_t),function(t){t[t.START=0]="START",t[t.INTERRUPT=1]="INTERRUPT",t[t.END=2]="END",t[t.DISPOSE=3]="DISPOSE",t[t.COMPLETE=4]="COMPLETE",t[t.EVENT=5]="EVENT"}(Q_t||(Q_t={})),he(Q_t),t("sp",Object.freeze({__proto__:null,spine:Xlt,get ATTACHMENT_TYPE(){return J_t},get AnimationEventType(){return Q_t},timeScale:1,get DefaultSkinsEnum(){return Dut},get DefaultAnimsEnum(){return Rut},get AnimationCacheMode(){return Mut},get SpineMaterialType(){return Out},SpineSocket:Lut,Skeleton:Fut,SkeletonData:Mht,SkeletonTexture:Pht,convertFilter:Dht,convertWraps:Rht,VertexEffectDelegate:y_t,simpleSpineAssembler:aft})),function(t){t[t.ORTHO=0]="ORTHO",t[t.HEX=1]="HEX",t[t.ISO=2]="ISO"}(Z_t||(Z_t={})),he(Z_t),function(t){t[t.NONE=0]="NONE",t[t.MAP=1]="MAP",t[t.LAYER=2]="LAYER",t[t.OBJECTGROUP=3]="OBJECTGROUP",t[t.OBJECT=4]="OBJECT",t[t.TILE=5]="TILE"}($_t||($_t={})),he($_t),function(t){t[t.HORIZONTAL=2147483648]="HORIZONTAL",t[t.VERTICAL=1073741824]="VERTICAL",t[t.DIAGONAL=536870912]="DIAGONAL",t[t.FLIPPED_ALL=4026531840]="FLIPPED_ALL",t[t.FLIPPED_MASK=268435455]="FLIPPED_MASK"}(tft||(tft={})),he(tft),function(t){t[t.STAGGERAXIS_X=0]="STAGGERAXIS_X",t[t.STAGGERAXIS_Y=1]="STAGGERAXIS_Y"}(eft||(eft={})),he(eft),function(t){t[t.STAGGERINDEX_ODD=0]="STAGGERINDEX_ODD",t[t.STAGGERINDEX_EVEN=1]="STAGGERINDEX_EVEN"}(nft||(nft={})),he(nft),function(t){t[t.RightDown=0]="RightDown",t[t.RightUp=1]="RightUp",t[t.LeftDown=2]="LeftDown",t[t.LeftUp=3]="LeftUp"}(ift||(ift={})),he(ift),function(t){t[t.RECT=0]="RECT",t[t.ELLIPSE=1]="ELLIPSE",t[t.POLYGON=2]="POLYGON",t[t.POLYLINE=3]="POLYLINE",t[t.IMAGE=4]="IMAGE",t[t.TEXT=5]="TEXT"}(rft||(rft={})),he(rft);var oft=function(){function t(){this.name="",this.firstGid=0,this.spacing=0,this.margin=0,this.sourceImage=void 0,this.imageName=null,this.imageSize=new ri(0,0),this.tileOffset=new Qn(0,0),this._tileSize=new ri(0,0),this.collection=!1}return t.prototype.rectForGID=function(t,e){var n=e||new oi(0,0,0,0);n.width=this._tileSize.width,n.height=this._tileSize.height;var i=t;i&=tft.FLIPPED_MASK,i-=this.firstGid;var r=Math.floor((this.imageSize.width-2*this.margin+this.spacing)/(this._tileSize.width+this.spacing));return n.x=Math.round(i%r*(this._tileSize.width+this.spacing)+this.margin),n.y=Math.round(Math.floor(i/r)*(this._tileSize.height+this.spacing)+this.margin),n},t}(),sft=function(){function t(){this.properties={},this.name="",this.objects=[],this.visible=!0,this.opacity=0,this.color=new Dn(255,255,255,255),this.offset=new Qn(0,0),this.draworder="topdown",this.tintColor=null}var e=t.prototype;return e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},t}(),cft=function(){function t(){this.properties={},this.name="",this.layerSize=null,this.tiles=[],this.visible=!0,this.opacity=0,this.ownTiles=!0,this.minGID=1e5,this.maxGID=0,this.offset=new Qn(0,0),this.tintColor=null}var e=t.prototype;return e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},t}();cft.ATTRIB_NONE=1,cft.ATTRIB_BASE64=2,cft.ATTRIB_GZIP=4,cft.ATTRIB_ZLIB=8;var lft=function(){this.name="",this.visible=!0,this.width=0,this.height=0,this.offset=new Qn(0,0),this.opacity=0,this.trans=new Dn(255,255,255,255),this.sourceImage=void 0,this.tintColor=null};function hft(t){var e=Ck.HorizontalAlign;switch(t){case"center":return e.CENTER;case"right":return e.RIGHT;default:return e.LEFT}}function uft(t){var e=Ck.VerticalAlign;switch(t){case"center":return e.CENTER;case"bottom":return e.BOTTOM;default:return e.TOP}}function _ft(t){if(!t)return new Dn(0,0,0,255);if(8===(t=-1!==t.indexOf("#")?t.substring(1):t).length){var e=parseInt(t.substr(0,2),16)||255,n=parseInt(t.substr(2,2),16)||0,i=parseInt(t.substr(4,2),16)||0,r=parseInt(t.substr(6,2),16)||0;return new Dn(n,i,r,e)}var a=parseInt(t.substr(0,2),16)||0,o=parseInt(t.substr(2,2),16)||0,s=parseInt(t.substr(4,2),16)||0;return new Dn(a,o,s,255)}function fft(t,e){for(var n=[],i=t.getElementsByTagName("properties"),r=0;r<i.length;++r)for(var a=i[r].getElementsByTagName("property"),o=0;o<a.length;++o)n.push(a[o]);e=e||{};for(var s=0;s<n.length;s++){var c=n[s],l=c.getAttribute("name"),h=c.getAttribute("type")||"string",u=c.getAttribute("value");"int"===h?u=parseInt(u):"float"===h?u=parseFloat(u):"bool"===h?u="true"===u:"color"===h&&(u=_ft(u)),e[l]=u}return e}var dft,pft,mft,vft,gft,yft,xft,Sft,Aft,bft,Cft,Tft,Eft,wft,Ift,Pft,Dft=function(){function t(t,e,n,i,r){this.properties={},this.orientation=null,this.parentElement=null,this.parentGID=0,this.layerAttrs=0,this.storingCharacters=!1,this.currentString=null,this.renderOrder=ift.RightDown,this._supportVersion=[1,4,0],this._objectGroups=[],this._allChildren=[],this._mapSize=new ri(0,0),this._tileSize=new ri(0,0),this._layers=[],this._tilesets=[],this._imageLayers=[],this._tileProperties=new Map,this._tileAnimations={},this._tsxContentMap=null,this._spriteFrameMap=null,this._spfSizeMap={},this._staggerAxis=null,this._staggerIndex=null,this._hexSideLength=0,this._imageLayerSPF=null,this.initWithXML(t,e,n,i,r)}var e=t.prototype;return e.getOrientation=function(){return this.orientation},e.setOrientation=function(t){this.orientation=t},e.getStaggerAxis=function(){return this._staggerAxis},e.setStaggerAxis=function(t){this._staggerAxis=t},e.getStaggerIndex=function(){return this._staggerIndex},e.setStaggerIndex=function(t){this._staggerIndex=t},e.getHexSideLength=function(){return this._hexSideLength},e.setHexSideLength=function(t){this._hexSideLength=t},e.getMapSize=function(){return new ri(this._mapSize.width,this._mapSize.height)},e.setMapSize=function(t){this._mapSize.width=t.width,this._mapSize.height=t.height},e.getTileSize=function(){return new ri(this._tileSize.width,this._tileSize.height)},e.setTileSize=function(t){this._tileSize.width=t.width,this._tileSize.height=t.height},e.getLayers=function(){return this._layers},e.setLayers=function(t){this._allChildren.push(t),this._layers.push(t)},e.getImageLayers=function(){return this._imageLayers},e.setImageLayers=function(t){this._allChildren.push(t),this._imageLayers.push(t)},e.getTilesets=function(){return this._tilesets},e.setTilesets=function(t){this._tilesets.push(t)},e.getObjectGroups=function(){return this._objectGroups},e.setObjectGroups=function(t){this._allChildren.push(t),this._objectGroups.push(t)},e.getAllChildren=function(){return this._allChildren},e.getParentElement=function(){return this.parentElement},e.setParentElement=function(t){this.parentElement=t},e.getParentGID=function(){return this.parentGID},e.setParentGID=function(t){this.parentGID=t},e.getLayerAttribs=function(){return this.layerAttrs},e.setLayerAttribs=function(t){this.layerAttrs=t},e.getStoringCharacters=function(){return this.storingCharacters},e.setStoringCharacters=function(t){this.storingCharacters=t},e.getProperties=function(){return this.properties},e.setProperties=function(t){this.properties=t},e.initWithXML=function(t,e,n,i,r){return this._tilesets.length=0,this._layers.length=0,this._imageLayers.length=0,this._tsxContentMap=e,this._spriteFrameMap=n,this._imageLayerSPF=r,this._spfSizeMap=i,this._objectGroups.length=0,this._allChildren.length=0,this.properties={},this._tileProperties=new Map,this._tileAnimations=new Map,this.currentString="",this.storingCharacters=!1,this.layerAttrs=cft.ATTRIB_NONE,this.parentElement=null,this.parseXMLString(t)},e.parseXMLString=function(e,n){var i,r=(new EN).parse(e).documentElement,a=r.getAttribute("orientation"),o=r.getAttribute("staggeraxis"),s=r.getAttribute("staggerindex"),c=r.getAttribute("hexsidelength"),l=r.getAttribute("renderorder"),h=r.getAttribute("version")||"1.0.0";if("map"===r.nodeName){var u=h.split("."),_=this._supportVersion;for(i=0;i<_.length;i++){var f=parseInt(u[i])||0;if(_[i]<f){P(7216,h);break}}"orthogonal"===a?this.orientation=Z_t.ORTHO:"isometric"===a?this.orientation=Z_t.ISO:"hexagonal"===a?this.orientation=Z_t.HEX:null!==a&&P(7217,a),this.renderOrder="right-up"===l?ift.RightUp:"left-up"===l?ift.LeftUp:"left-down"===l?ift.LeftDown:ift.RightDown,"x"===o?this.setStaggerAxis(eft.STAGGERAXIS_X):"y"===o&&this.setStaggerAxis(eft.STAGGERAXIS_Y),"odd"===s?this.setStaggerIndex(nft.STAGGERINDEX_ODD):"even"===s&&this.setStaggerIndex(nft.STAGGERINDEX_EVEN),c&&this.setHexSideLength(parseFloat(c));var d=new ri(0,0);d.width=parseFloat(r.getAttribute("width")),d.height=parseFloat(r.getAttribute("height")),this.setMapSize(d),(d=new ri(0,0)).width=parseFloat(r.getAttribute("tilewidth")),d.height=parseFloat(r.getAttribute("tileheight")),this.setTileSize(d),this.properties=fft(r)}var p=r.getElementsByTagName("tileset");for("map"!==r.nodeName&&(p=[]).push(r),i=0;i<p.length;i++){var m=p[i],v=m.getAttribute("source");if(v){var g=parseInt(m.getAttribute("firstgid")),y=this._tsxContentMap[v];y&&this.parseXMLString(y,g)}else{var x=m.getElementsByTagName("image"),S=x.length>1,A=x[0],b=A.getAttribute("source");b=b.replace(/\\/g,"/");var C=m.getElementsByTagName("tile"),T=C&&C.length||1,E=null,w=m.getAttribute("name")||"",I=parseInt(m.getAttribute("spacing"))||0,D=parseInt(m.getAttribute("margin"))||0,R=n||parseInt(m.getAttribute("firstgid"))||0,M=new ri(0,0);M.width=parseFloat(m.getAttribute("tilewidth")),M.height=parseFloat(m.getAttribute("tileheight"));var N=m.getElementsByTagName("tileoffset")[0],B=0,L=0;N&&(B=parseFloat(N.getAttribute("x"))||0,L=parseFloat(N.getAttribute("y"))||0);for(var F=null,V=0;V<T;V++){var z=x[V]?x[V]:A;if(z){var k=z.getAttribute("source");if(k=k.replace(/\\/g,"/"),!F||S){if((F=new oft).name=w,F.firstGid=R&tft.FLIPPED_MASK,F.tileOffset.x=B,F.tileOffset.y=L,F.collection=S,!S&&(F.imageName=k,F.imageSize.width=parseFloat(z.getAttribute("width"))||0,F.imageSize.height=parseFloat(z.getAttribute("height"))||0,F.sourceImage=this._spriteFrameMap[k],!F.sourceImage)){var U=t.getNameWithPostfix(k);if(F.imageName=U,F.sourceImage=this._spriteFrameMap[U],!F.sourceImage){var G=t.getShortName(k);F.imageName=G,F.sourceImage=this._spriteFrameMap[G],F.sourceImage||(console.error("[error]: "+G+" not find in ["+Object.keys(this._spriteFrameMap).join(", ")+"]"),O(7221,k),console.warn("Please try asset type of "+k+" to 'sprite-frame'"))}}F.spacing=I,F.margin=D,F._tileSize.width=M.width,F._tileSize.height=M.height,this.setTilesets(F)}if(E=C&&C[V]){this.parentGID=R+(parseInt(E.getAttribute("id"))||0);var H=E.getElementsByTagName("image");if(H&&H.length>0){var j=H[0],W=j.getAttribute("source");if(W=W.replace(/\\/g,"/"),F.imageName=W,F.imageSize.width=parseFloat(j.getAttribute("width"))||0,F.imageSize.height=parseFloat(j.getAttribute("height"))||0,F._tileSize.width=F.imageSize.width,F._tileSize.height=F.imageSize.height,F.sourceImage=this._spriteFrameMap[W],!F.sourceImage){var q=t.getNameWithPostfix(W);if(F.imageName=q,F.sourceImage=this._spriteFrameMap[q],!F.sourceImage){var X=t.getShortName(W);F.imageName=X,F.sourceImage=this._spriteFrameMap[X],F.sourceImage||(O(7221,W),console.warn("Please try asset type of "+W+" to 'sprite-frame'"))}}F.firstGid=this.parentGID&tft.FLIPPED_MASK}var Y=(tft.FLIPPED_MASK&this.parentGID)>>>0;this._tileProperties.set(Y,fft(E));var K=E.getElementsByTagName("animation");if(K&&K.length>0){var J=K[0].getElementsByTagName("frame"),Q={frames:[],dt:0,frameIdx:0};this._tileAnimations.set(Y,Q);for(var Z=Q.frames,$=0;$<J.length;$++){var tt=J[$],et=R+(parseInt(tt.getAttribute("tileid"))||0),nt=parseFloat(tt.getAttribute("duration"))||0;Z.push({tileid:et,duration:nt/1e3,grid:null})}}}}}}}var it=r.childNodes;for(i=0;i<it.length;i++){var rt=it[i];if(!this._shouldIgnoreNode(rt)){if("imagelayer"===rt.nodeName){var at=this._parseImageLayer(rt);at&&this.setImageLayers(at)}if("layer"===rt.nodeName){var ot=this._parseLayer(rt);this.setLayers(ot)}if("objectgroup"===rt.nodeName){var st=this._parseObjectGroup(rt);this.setObjectGroups(st)}}}return r},e._shouldIgnoreNode=function(t){return 3===t.nodeType||8===t.nodeType||4===t.nodeType},e._parseImageLayer=function(t){var e=t.getElementsByTagName("image");if(!e||0===e.length)return null;var n=new lft;n.name=t.getAttribute("name"),n.offset.x=parseFloat(t.getAttribute("offsetx"))||0,n.offset.y=parseFloat(t.getAttribute("offsety"))||0;var i=t.getAttribute("visible");n.visible=!("0"===i);var r=t.getAttribute("opacity");n.opacity=r?Math.round(255*parseFloat(r)):255;var a=t.getAttribute("tintcolor");n.tintColor=a?_ft(a):null;var o=e[0],s=o.getAttribute("source");return n.sourceImage=this._imageLayerSPF[s],n.width=parseInt(o.getAttribute("width"))||0,n.height=parseInt(o.getAttribute("height"))||0,n.trans=_ft(o.getAttribute("trans")),n.sourceImage?n:(O(7221,s),console.warn("Please try asset type of "+s+" to 'sprite-frame'"),null)},e._parseLayer=function(t){var e=t.getElementsByTagName("data")[0],n=new cft;n.name=t.getAttribute("name");var i=new ri(0,0);i.width=parseFloat(t.getAttribute("width")),i.height=parseFloat(t.getAttribute("height")),n.layerSize=i;var r=t.getAttribute("visible");n.visible=!("0"===r);var a=t.getAttribute("opacity");n.opacity=a?Math.round(255*parseFloat(a)):255,n.offset=new Qn(parseFloat(t.getAttribute("offsetx"))||0,parseFloat(t.getAttribute("offsety"))||0);var o=t.getAttribute("tintcolor");n.tintColor=o?_ft(o):null;for(var s="",c=0;c<e.childNodes.length;c++)s+=e.childNodes[c].nodeValue;s=s.trim();var l,h=e.getAttribute("compression"),u=e.getAttribute("encoding");if(h&&"gzip"!==h&&"zlib"!==h)return P(7218),null;switch(h){case"gzip":l=qet.unzipBase64AsArray(s,4);break;case"zlib":l=function(t){if(t.length%4!=0)return null;for(var e=t.length/4,n=window.Uint32Array?new Uint32Array(e):[],i=0;i<e;i++){var r=4*i;n[i]=t[r]+256*t[r+1]+65536*t[r+2]+t[r+3]*(1<<24)}return n}(new z9.Inflate(qet.Base64.decodeAsArray(s,1)).decompress());break;case null:case"":if("base64"===u)l=qet.Base64.decodeAsArray(s,4);else if("csv"===u){l=[];for(var _=s.split(","),f=0;f<_.length;f++)l.push(parseInt(_[f]))}else{var d=e.getElementsByTagName("tile");l=[];for(var p=0;p<d.length;p++)l.push(parseInt(d[p].getAttribute("gid")))}break;default:this.layerAttrs===cft.ATTRIB_NONE&&P(7219)}return l&&(n.tiles=new Uint32Array(l)),n.properties=fft(t),n},e._parseObjectGroup=function(t){var e=new sft;e.name=t.getAttribute("name")||"",e.offset=new Qn(parseFloat(t.getAttribute("offsetx")),parseFloat(t.getAttribute("offsety")));var n=t.getAttribute("opacity");e.opacity=n?Math.round(255*parseFloat(n)):255;var i=t.getAttribute("tintcolor");e.tintColor=i?_ft(i):null;var r=t.getAttribute("visible");r&&0===parseInt(r)&&(e.visible=!1);var a=t.getAttribute("color");a&&e.color.fromHEX(a);var o=t.getAttribute("draworder");o&&(e.draworder=o),e.setProperties(fft(t));var s=t.getElementsByTagName("object");if(s){for(var c=0;c<s.length;c++){var l=s[c],h={};h.id=l.getAttribute("id")||c,h.name=l.getAttribute("name")||"",h.width=parseFloat(l.getAttribute("width"))||0,h.height=parseFloat(l.getAttribute("height"))||0,h.x=parseFloat(l.getAttribute("x"))||0,h.y=parseFloat(l.getAttribute("y"))||0,h.rotation=parseFloat(l.getAttribute("rotation"))||0,fft(l,h);var u=l.getAttribute("visible");h.visible=!(u&&0===parseInt(u));var _=l.getElementsByTagName("text");if(_&&_.length>0){var f=_[0];h.type=rft.TEXT,h.wrap="1"===f.getAttribute("wrap"),h.color=_ft(f.getAttribute("color")),h.halign=hft(f.getAttribute("halign")),h.valign=uft(f.getAttribute("valign")),h.pixelsize=parseInt(f.getAttribute("pixelsize"))||16,h.text=f.childNodes[0].nodeValue}var d=l.getAttribute("gid");d&&(h.gid=parseInt(d),h.type=rft.IMAGE);var p=l.getElementsByTagName("ellipse");p&&p.length>0&&(h.type=rft.ELLIPSE);var m=l.getElementsByTagName("polygon");if(m&&m.length>0){h.type=rft.POLYGON;var v=m[0].getAttribute("points");v&&(h.points=this._parsePointsString(v))}var g=l.getElementsByTagName("polyline");if(g&&g.length>0){h.type=rft.POLYLINE;var y=g[0].getAttribute("points");y&&(h.polylinePoints=this._parsePointsString(y))}h.type||(h.type=rft.RECT),e.objects.push(h)}"index"!==o&&e.objects.sort((function(t,e){return t.y-e.y}))}return e},e._parsePointsString=function(t){if(!t)return null;for(var e=[],n=t.split(" "),i=0;i<n.length;i++){var r=n[i].split(",");e.push({x:parseFloat(r[0]),y:parseFloat(r[1])})}return e},e.setTileAnimations=function(t){this._tileAnimations=t},e.getTileAnimations=function(){return this._tileAnimations},e.getTileProperties=function(){return this._tileProperties},e.setTileProperties=function(t){this._tileProperties=t},e.getCurrentString=function(){return this.currentString},e.setCurrentString=function(t){this.currentString=t},t.getNameWithPostfix=function(t){var e=(t=t.replace(/\\/g,"/")).lastIndexOf("/")+1,n=t.length;return t.substring(e,n)},t.getShortName=function(t){var e=(t=t.replace(/\\/g,"/")).lastIndexOf("/")+1,n=t.lastIndexOf(".");return n=n<0?t.length:n,t.substring(e,n)},Q(t,[{key:"mapSize",get:function(){return this._mapSize}},{key:"tileSize",get:function(){return this._tileSize}},{key:"mapWidth",get:function(){return this._mapSize.width},set:function(t){this._mapSize.width=t}},{key:"mapHeight",get:function(){return this._mapSize.height},set:function(t){this._mapSize.height=t}},{key:"tileWidth",get:function(){return this._tileSize.width},set:function(t){this._tileSize.width=t}},{key:"tileHeight",get:function(){return this._tileSize.height},set:function(t){this._tileSize.height=t}}]),t}(),Rft=t("TiledTile",(dft=Ec("cc.TiledTile"),pft=jc(),mft=kc(),vft=wc(LV),gft=cl(Ne),yft=cl(Ne),xft=cl(Ne),Sft=cl(Ne),Aft=cl(Ne),dft(bft=pft(bft=mft(bft=vft(bft=zc((wft=function(t){function e(){var e;return(e=t.call(this)||this)._layer=null,ct(e,"_x",Tft,at(e)),ct(e,"_y",Eft,at(e)),e}$(e,t);var n=e.prototype;return n.onEnable=function(){var t=this.node.parent;this._layer=t.getComponent("cc.TiledLayer"),this._resetTile(),this.updateInfo()},n.onDisable=function(){this._resetTile()},n._resetTile=function(){this._layer&&this._layer.getTiledTileAt(this._x,this._y)===this&&this._layer.setTiledTileAt(this._x,this._y,null)},n.updateInfo=function(){if(this._layer){var t=this._x,e=this._y;if(this._layer.getTiledTileAt(t,e))S("There is already a TiledTile at [%s, %s]",t,e);else{var n=this._layer.getPositionAt(t,e);this.node.setPosition(n.x,n.y),this._layer.setTiledTileAt(t,e,this)}}},Q(e,[{key:"x",get:function(){return this._x},set:function(t){t!==this._x&&(this._layer&&this._layer.isInvalidPosition(t,this._y)?S("Invalid x, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.width):(this._resetTile(),this._x=t,this.updateInfo()))}},{key:"y",get:function(){return this._y},set:function(t){t!==this._y&&(this._layer&&this._layer.isInvalidPosition(this._x,t)?S("Invalid y, the valid value is between [%s] ~ [%s]",0,this._layer.layerSize.height):(this._resetTile(),this._y=t,this.updateInfo()))}},{key:"grid",get:function(){return this._layer?this._layer.getTileGIDAt(this._x,this._y):0},set:function(t){this._layer&&this._layer.setTileGIDAt(t,this._x,this._y)}}]),e}(xu),Tft=lt((Cft=wft).prototype,"_x",[gft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Eft=lt(Cft.prototype,"_y",[yft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),lt(Cft.prototype,"x",[xft],Object.getOwnPropertyDescriptor(Cft.prototype,"x"),Cft.prototype),lt(Cft.prototype,"y",[Sft],Object.getOwnPropertyDescriptor(Cft.prototype,"y"),Cft.prototype),lt(Cft.prototype,"grid",[Aft],Object.getOwnPropertyDescriptor(Cft.prototype,"grid"),Cft.prototype),bft=Cft))||bft)||bft)||bft)||bft)||bft));function Mft(t,e,n){var i=n||t.sourceImage,r=i.texture,a=t.collection;if(!t.imageSize.width||!t.imageSize.height){var o=t.sourceImage;t.imageSize.width=o.width,t.imageSize.height=o.height}var s=t.imageSize.width,c=t.imageSize.height,l=t._tileSize.width,h=t._tileSize.height,u=i.width,_=i.height,f=t.spacing,d=t.margin,p=1;if(!a){var m=Math.floor((s-2*d+f)/(l+f)),v=Math.floor((c-2*d+f)/(h+f));p=Math.max(1,v*m)}for(var g=t.firstGid,y=null,x=!!e.get(g),S=t.firstGid+p,A=g;A<S&&(x&&!e.get(A)&&(x=!1),x||!e.get(A));++A){if(y={tileset:t,x:0,y:0,width:l,height:h,t:0,l:0,r:0,b:0,cx:0,cy:0,offsetX:0,offsetY:0,rotated:!1,gid:A,spriteFrame:i,texture:r},t.rectForGID(A,y),!n||p>1)if(n){y._name=n.name;var b=n.unbiasUV[0],C=n.rotated?n.unbiasUV[1]:n.unbiasUV[5];y.l=b+(y.x+.5)/u,y.t=C+(y.y+.5)/_,y.r=b+(y.x+y.width-.5)/u,y.b=C+(y.y+y.height-.5)/_,y._rect=new oi(y.x,y.y,y.width,y.height)}else y.l=y.x/u,y.t=y.y/_,y.r=(y.x+y.width)/u,y.b=(y.y+y.height)/_,y._rect=new oi(y.x,y.y,y.width,y.height);else n.rotated?(y._rotated=!0,y._name=n.name,y._rect=n.getRect(),y.l=n.unbiasUV[0],y.t=n.unbiasUV[1],y.r=n.unbiasUV[4],y.b=n.unbiasUV[3]):(y._name=n.name,y._rect=n.getRect(),y.l=n.unbiasUV[0],y.t=n.unbiasUV[5],y.r=n.unbiasUV[2],y.b=n.unbiasUV[1]);y.cx=(y.l+y.r)/2,y.cy=(y.t+y.b)/2,e.set(A,y)}}for(var Oft,Nft,Bft,Lft,Fft,Vft,zft,kft,Uft,Gft,Hft,jft,Wft,qft,Xft,Yft,Kft,Jft,Qft,Zft,$ft,tdt,edt,ndt,idt,rdt,adt,odt,sdt,cdt,ldt,hdt,udt,_dt,fdt,ddt,pdt,mdt,vdt=new Xn,gdt=new Qn,ydt=new Mn,xdt=new Mn,Sdt={row:0,col:0},Adt=t("TiledUserNodeData",Ec("cc.TiledUserNodeData")(Ift=function(t){function e(){var e;return(e=t.call(this)||this)._index=-1,e._row=-1,e._col=-1,e._tiledLayer=null,e}return $(e,t),e}(xu))||Ift),bdt=t("TiledLayer",Ec("cc.TiledLayer")(Pft=function(t){function e(){var e;return(e=t.call(this)||this)._userNodeGrid={},e._userNodeMap={},e._userNodeDirty=!1,e.tiledTiles=[],e._viewPort={x:-1,y:-1,width:-1,height:-1},e._cullingRect={leftDown:{row:-1,col:-1},rightTop:{row:-1,col:-1}},e._cullingDirty=!0,e._rightTop={row:-1,col:-1},e._layerInfo=null,e._mapInfo=null,e._topOffset=0,e._downOffset=0,e._leftOffset=0,e._rightOffset=0,e.tiles=[],e.vertices=[],e._verticesDirty=!0,e._layerName="",e._layerSize=void 0,e._minGID=void 0,e._maxGID=void 0,e._layerOrientation=null,e._opacity=void 0,e._tintColor=void 0,e.texGrids=null,e._textures=[],e._tilesets=[],e._leftDownToCenterX=0,e._leftDownToCenterY=0,e._hasTiledNodeGrid=!1,e._hasAniGrid=!1,e._animations=null,e._enableCulling=void 0,e.colorChanged=!1,e._properties=void 0,e.renderOrder=void 0,e._staggerAxis=void 0,e._staggerIndex=void 0,e._hexSideLength=void 0,e._mapTileSize=void 0,e._odd_even=void 0,e._diffX1=void 0,e._diffY1=void 0,e._useAutomaticVertexZ=void 0,e._vertexZvalue=void 0,e._offset=void 0,e._meshRenderDataArray=null,e._meshRenderDataArrayIdx=0,e}$(e,t);var n=e.prototype;return n.hasTiledNode=function(){return this._hasTiledNodeGrid},n.hasAnimation=function(){return this._hasAniGrid},n.addUserNode=function(t){var e=t.getComponent(Adt);return e?(S("CCTiledLayer:addUserNode node has been added"),!1):(e=t.addComponent(Adt),t.parent=this.node,this._userNodeMap[t.uuid]=e,e._row=-1,e._col=-1,e._tiledLayer=this,this._nodeLocalPosToLayerPos(t.getPosition(),gdt),this._positionToRowCol(gdt.x,gdt.y,Sdt),this._addUserNodeToGrid(e,Sdt),this._updateCullingOffsetByUserNode(t),t.on(bC.TRANSFORM_CHANGED,this._userNodePosChange,e),t.on(bC.SIZE_CHANGED,this._userNodeSizeChange,e),!0)},n.removeUserNode=function(t){var e=t.getComponent(Adt);return e?(t.off(bC.TRANSFORM_CHANGED,this._userNodePosChange,e),t.off(bC.SIZE_CHANGED,this._userNodeSizeChange,e),this._removeUserNodeFromGrid(e),delete this._userNodeMap[t.uuid],t._removeComponent(e),e.destroy(),t.removeFromParent(),!0):(S("CCTiledLayer:removeUserNode node is not exist"),!1)},n.destroyUserNode=function(t){this.removeUserNode(t),t.destroy()},n._nodeLocalPosToLayerPos=function(t,e){e.x=t.x+this._leftDownToCenterX,e.y=t.y+this._leftDownToCenterY},n.getNodesByRowCol=function(t,e){var n=this._userNodeGrid[t];return n?n[e]:null},n.getNodesCountByRow=function(t){var e=this._userNodeGrid[t];return e?e.count:0},n._updateAllUserNode=function(){for(var t in this._userNodeGrid={},this._userNodeMap){var e=this._userNodeMap[t];this._nodeLocalPosToLayerPos(e.node.getPosition(),gdt),this._positionToRowCol(gdt.x,gdt.y,Sdt),this._addUserNodeToGrid(e,Sdt),this._updateCullingOffsetByUserNode(e.node)}},n._updateCullingOffsetByUserNode=function(t){var e=t._uiProps.uiTransformComp.contentSize;this._topOffset<e.height&&(this._topOffset=e.height),this._downOffset<e.height&&(this._downOffset=e.height),this._leftOffset<e.width&&(this._leftOffset=e.width),this._rightOffset<e.width&&(this._rightOffset=e.width)},n._userNodeSizeChange=function(){var t=this.node,e=this._tiledLayer;e._updateCullingOffsetByUserNode(t),e._userNodeDirty=!0,e.markForUpdateRenderData()},n._userNodePosChange=function(){var t=this,e=t.node,n=t._tiledLayer;n._nodeLocalPosToLayerPos(e.getPosition(),gdt),n._positionToRowCol(gdt.x,gdt.y,Sdt),n._limitInLayer(Sdt),Sdt.row===t._row&&Sdt.col===t._col||(n._removeUserNodeFromGrid(t),n._addUserNodeToGrid(t,Sdt))},n._removeUserNodeFromGrid=function(t){var e=t._row,n=t._col,i=t._index,r=this._userNodeGrid[e],a=r&&r[n];a&&(r.count--,a.count--,a.list[i]=null,a.count<=0&&(a.list.length=0,a.count=0)),t._row=-1,t._col=-1,t._index=-1,this._userNodeDirty=!0,this.markForUpdateRenderData()},n._limitInLayer=function(t){var e=t.row,n=t.col;e<0&&(t.row=0),e>this._rightTop.row&&(t.row=this._rightTop.row),n<0&&(t.col=0),n>this._rightTop.col&&(t.col=this._rightTop.col)},n._addUserNodeToGrid=function(t,e){var n=e.row,i=e.col,r=this._userNodeGrid[n]=this._userNodeGrid[n]||{count:0},a=r[i]=r[i]||{count:0,list:[]};t._row=n,t._col=i,t._index=a.list.length,r.count++,a.count++,a.list.push(t),this._userNodeDirty=!0},n.isUserNodeDirty=function(){return this._userNodeDirty},n.setUserNodeDirty=function(t){this._userNodeDirty=t},n.onEnable=function(){t.prototype.onEnable.call(this),this.node.on(bC.ANCHOR_CHANGED,this._syncAnchorPoint,this),this.node.on(bC.TRANSFORM_CHANGED,this.updateCulling,this),this.node.on(bC.SIZE_CHANGED,this.updateCulling,this),this.node.parent.on(bC.TRANSFORM_CHANGED,this.updateCulling,this),this.node.parent.on(bC.SIZE_CHANGED,this.updateCulling,this),this.markForUpdateRenderData(),this.scheduleOnce(this.updateCulling.bind(this))},n.onDisable=function(){var e,n;t.prototype.onDisable.call(this),null===(e=this.node.parent)||void 0===e||e.off(bC.SIZE_CHANGED,this.updateCulling,this),null===(n=this.node.parent)||void 0===n||n.off(bC.TRANSFORM_CHANGED,this.updateCulling,this),this.node.off(bC.SIZE_CHANGED,this.updateCulling,this),this.node.off(bC.TRANSFORM_CHANGED,this.updateCulling,this),this.node.off(bC.ANCHOR_CHANGED,this._syncAnchorPoint,this)},n._syncAnchorPoint=function(){var t=this.node,e=t._uiProps.uiTransformComp,n=t.getScale();this._leftDownToCenterX=e.width*e.anchorX*n.x,this._leftDownToCenterY=e.height*e.anchorY*n.y,this._cullingDirty=!0,this.markForUpdateRenderData()},n.getLayerName=function(){return this._layerName},n.setLayerName=function(t){this._layerName=t},n.getProperty=function(t){return this._properties[t]},n.getPositionAt=function(t,e){var n;switch(void 0!==e?(n=Math.floor(t),e=Math.floor(e)):(n=Math.floor(t.x),e=Math.floor(t.y)),this._layerOrientation){case Z_t.ORTHO:return this._positionForOrthoAt(n,e);case Z_t.ISO:return this._positionForIsoAt(n,e);case Z_t.HEX:return this._positionForHexAt(n,e)}return null},n.isInvalidPosition=function(t,e){return t>=this._layerSize.width||e>=this._layerSize.height||t<0||e<0},n._positionForIsoAt=function(t,e){var n=0,i=0,r=Math.floor(t)+Math.floor(e)*this._layerSize.width,a=this.tiles[r];if(a){var o=(a&tft.FLIPPED_MASK)>>>0,s=this.texGrids.get(o).tileset.tileOffset;n=s.x,i=s.y}return new Qn(.5*this._mapTileSize.width*(this._layerSize.height+t-e-1)+n,.5*this._mapTileSize.height*(this._layerSize.width-t+this._layerSize.height-e-2)-i)},n._positionForOrthoAt=function(t,e){var n=0,i=0,r=Math.floor(t)+Math.floor(e)*this._layerSize.width,a=this.tiles[r];if(a){var o=(a&tft.FLIPPED_MASK)>>>0,s=this.texGrids.get(o).tileset.tileOffset;n=s.x,i=s.y}return new Qn(t*this._mapTileSize.width+n,(this._layerSize.height-e-1)*this._mapTileSize.height-i)},n._positionForHexAt=function(t,e){var n,i=this._mapTileSize.width,r=this._mapTileSize.height,a=this._layerSize.height,o=Math.floor(t)+Math.floor(e)*this._layerSize.width,s=(this.tiles[o]&tft.FLIPPED_MASK)>>>0;n=this.texGrids.get(s)?this.texGrids.get(s).tileset.tileOffset:{x:0,y:0};var c=this._staggerIndex===nft.STAGGERINDEX_ODD?1:-1,l=0,h=0,u=0,_=0;switch(this._staggerAxis){case eft.STAGGERAXIS_Y:u=0,e%2==1&&(u=i/2*c),l=t*i+u+n.x,h=(a-e-1)*(r-(r-this._hexSideLength)/2)-n.y;break;case eft.STAGGERAXIS_X:_=0,t%2==1&&(_=r/2*-c),l=t*(i-(i-this._hexSideLength)/2)+n.x,h=(a-e-1)*r+_-n.y}return new Qn(l,h)},n.setTilesGIDAt=function(t,e,n,i){if(t&&0!==t.length&&!(i<=0)){n<0&&(n=0),e<0&&(e=0);for(var r=0,a=e+i,o=n;;o++)for(var s=e;s<a;s++){if(r>=t.length)return;this._updateTileForGID(t[r],s,o),r++}}},n.setTileGIDAt=function(t,e,n,i){var r=(t&tft.FLIPPED_MASK)>>>0;if(e=Math.floor(e),n=Math.floor(n),this.isInvalidPosition(e,n))throw new Error("cc.TiledLayer.setTileGIDAt(): invalid position");this.tiles&&this._tilesets&&0!==this._tilesets.length?0!==r&&r<this._tilesets[0].firstGid?P(7239,t):(i=i||0,this._updateTileForGID((r|i)>>>0,e,n)):P(7238)},n._updateTileForGID=function(t,e,n){var i=0|e+n*this._layerSize.width;if(!(i>=this.tiles.length)&&t!==this.tiles[i]){var r=(t&tft.FLIPPED_MASK)>>>0;this.texGrids.get(r)?(this.tiles[i]=t,this._updateVertex(e,n)):this.tiles[i]=0,this._cullingDirty=!0}},n.getTileGIDAt=function(t,e){if(this.isInvalidPosition(t,e))throw new Error("cc.TiledLayer.getTileGIDAt(): invalid position");if(!this.tiles)return P(7237),null;var n=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(this.tiles[n]&tft.FLIPPED_MASK)>>>0},n.getTileFlagsAt=function(t,e){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTileFlagsAt: invalid position");if(!this.tiles)return P(7240),null;var n=Math.floor(t)+Math.floor(e)*this._layerSize.width;return(this.tiles[n]&tft.FLIPPED_ALL)>>>0},n.setCullingDirty=function(t){this._cullingDirty=t},n.isCullingDirty=function(){return this._cullingDirty},n.updateViewPort=function(t,e,n,i){if(this._viewPort.width!==n||this._viewPort.height!==i||this._viewPort.x!==t||this._viewPort.y!==e){this._viewPort.x=t,this._viewPort.y=e,this._viewPort.width=n,this._viewPort.height=i;var r=1;this._layerOrientation===Z_t.ISO&&(r=2);var a=this._viewPort.x-this._offset.x+this._leftDownToCenterX,o=this._viewPort.y-this._offset.y+this._leftDownToCenterY,s=a-this._leftOffset,c=o-this._downOffset,l=a+n+this._rightOffset,h=o+i+this._topOffset,u=this._cullingRect.leftDown,_=this._cullingRect.rightTop;s<0&&(s=0),c<0&&(c=0),this._positionToRowCol(s,c,Sdt),Sdt.row-=r,Sdt.col-=r,Sdt.row=Sdt.row>0?Sdt.row:0,Sdt.col=Sdt.col>0?Sdt.col:0,Sdt.row===u.row&&Sdt.col===u.col||(u.row=Sdt.row,u.col=Sdt.col,this._cullingDirty=!0),l<0||h<0?(Sdt.row=-1,Sdt.col=-1):(this._positionToRowCol(l,h,Sdt),Sdt.row++,Sdt.col++),Sdt.row>this._rightTop.row&&(Sdt.row=this._rightTop.row),Sdt.col>this._rightTop.col&&(Sdt.col=this._rightTop.col),Sdt.row===_.row&&Sdt.col===_.col||(_.row=Sdt.row,_.col=Sdt.col,this._cullingDirty=!0,this.markForUpdateRenderData())}},n._positionToRowCol=function(t,e,n){var i=this._mapTileSize.width,r=this._mapTileSize.height,a=.5*i,o=.5*r,s=0,c=0,l=0,h=0,u=this._staggerAxis;switch(this._layerOrientation){case Z_t.ORTHO:c=Math.floor(t/i),s=Math.floor(e/r);break;case Z_t.ISO:c=Math.floor(t/a),s=Math.floor(e/o);break;case Z_t.HEX:u===eft.STAGGERAXIS_Y?(l=(s=Math.floor(e/(r-this._diffY1)))%2==1?a*this._odd_even:0,c=Math.floor((t-l)/i)):(h=(c=Math.floor(t/(i-this._diffX1)))%2==1?o*-this._odd_even:0,s=Math.floor((e-h)/r))}return n.row=s,n.col=c,n},n.updateCulling=function(){if(this._enableCulling){this.node.updateWorldTransform(),Xn.invert(vdt,this.node.getWorldMatrix());var t=TO.root.batcher2D.getFirstRenderCamera(this.node);t&&(ydt.x=0,ydt.y=0,ydt.z=0,xdt.x=t.width,xdt.y=t.height,xdt.z=0,t.screenToWorld(ydt,ydt),t.screenToWorld(xdt,xdt),Mn.transformMat4(ydt,ydt,vdt),Mn.transformMat4(xdt,xdt,vdt),this.updateViewPort(ydt.x,ydt.y,xdt.x-ydt.x,xdt.y-ydt.y))}},n.getLayerOrientation=function(){return this._layerOrientation},n.getProperties=function(){return this._properties},n._updateVertex=function(t,e){var n=tft.FLIPPED_MASK,i=this.vertices,r=this._layerOrientation,a=this.tiles;if(a){var o,s,c,l,h=this._rightTop,u=this._mapTileSize.width,_=this._mapTileSize.height,f=.5*u,d=.5*_,p=this._layerSize.height,m=this._layerSize.width,v=this.texGrids,g=0,y=0;r===Z_t.HEX&&(o=this._staggerAxis,s=this._diffX1,c=this._diffY1,l=this._odd_even);var x,S,A,b=0,C=0,T=0,E=0,w=e*m+t;x=(a[w]&n)>>>0;var I=v.get(x);if(I){switch(this._animations.get(x)&&(this._hasAniGrid=this._hasAniGrid||!0),r){case Z_t.ORTHO:g=(b=t)*u,y=(C=p-e-1)*_;break;case Z_t.ISO:g=f*(b=p+t-e-1),y=d*(C=p+m-t-e-2);break;case Z_t.HEX:g=t*(u-s)+(o===eft.STAGGERAXIS_Y&&e%2==1?f*l:0),y=(p-e-1)*(_-c)+(o===eft.STAGGERAXIS_X&&t%2==1?d*-l:0),b=t,C=p-e-1}var P=i[C]=i[C]||{minCol:0,maxCol:0},D=P[b]=P[b]||{};P.minCol>b&&(P.minCol=b),P.maxCol<b&&(P.maxCol=b),h.row<C&&(h.row=C,r===Z_t.ISO&&(h.row+=1)),h.col<b&&(h.col=b,r===Z_t.ISO&&(h.col+=1));var R=I.tileset.tileOffset;g+=this._offset.x+R.x+I.offsetX,y+=this._offset.y-R.y-I.offsetY,T=(T=-R.y+I.tileset._tileSize.height-_)<0?0:T,S=R.y<0?0:R.y,A=-R.x<0?0:-R.x,E=(E=R.x+I.tileset._tileSize.width-u)<0?0:E,this._rightOffset<A&&(this._rightOffset=A),this._leftOffset<E&&(this._leftOffset=E),this._topOffset<S&&(this._topOffset=S),this._downOffset<T&&(this._downOffset=T),D.left=g,D.bottom=y,D.index=w,this._cullingDirty=!0}}},n._updateVertices=function(){if(this.vertices.length=0,this.tiles){var t=this._rightTop;t.row=-1,t.col=-1;var e=this._layerSize.height,n=this._layerSize.width;this._topOffset=0,this._downOffset=0,this._leftOffset=0,this._rightOffset=0,this._hasAniGrid=!1;for(var i=0;i<e;++i)for(var r=0;r<n;++r)this._updateVertex(r,i);this._verticesDirty=!1}},n.getTiledTileAt=function(t,e,n){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.getTiledTileAt: invalid position");if(!this.tiles)return P(7236),null;var i=Math.floor(t)+Math.floor(e)*this._layerSize.width,r=this.tiledTiles[i];if(!r&&n){var a=new TE;return(r=a.addComponent(Rft))._x=t,r._y=e,r._layer=this,r.updateInfo(),a.parent=this.node,r}return r},n.setTiledTileAt=function(t,e,n){if(this.isInvalidPosition(t,e))throw new Error("TiledLayer.setTiledTileAt: invalid position");if(!this.tiles)return P(7236),null;var i=Math.floor(t)+Math.floor(e)*this._layerSize.width;return this.tiledTiles[i]=n,this._cullingDirty=!0,this._hasTiledNodeGrid=!!n||this.tiledTiles.some((function(t){return!!t})),n},n.getTexture=function(t){return t=t||0,this._textures&&t>=0&&this._textures.length>t?this._textures[t]:null},n.getTextures=function(){return this._textures},n.setTexture=function(t){this.setTextures([t])},n.setTextures=function(t){this._textures=t,this.markForUpdateRenderData()},n.getLayerSize=function(){return this._layerSize},n.getMapTileSize=function(){return this._mapTileSize},n.getTileSet=function(t){return t=t||0,this._tilesets&&t>=0&&this._tilesets.length>t?this._tilesets[t]:null},n.getTileSets=function(){return this._tilesets},n.setTileSet=function(t){this.setTileSets([t])},n.setTileSets=function(t){this._tilesets=t;var e=this._textures=[],n=this.texGrids;n.clear();for(var i=0;i<t.length;i++){var r=t[i];r&&(e[i]=r.sourceImage)}for(var a=0,o=t.length;a<o;++a){var s=t[a];s&&Mft(s,n,s.sourceImage)}this._prepareToRender()},n.init=function(t,e,n,i,r){this._cullingDirty=!0,this._layerInfo=t,this._mapInfo=e;var a=t.layerSize;this._layerName=t.name,this.tiles=t.tiles,this._properties=t.properties,this._layerSize=a,this._minGID=t.minGID,this._maxGID=t.maxGID,this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this.renderOrder=e.renderOrder,this._staggerAxis=e.getStaggerAxis(),this._staggerIndex=e.getStaggerIndex(),this._hexSideLength=e.getHexSideLength(),this._animations=e.getTileAnimations(),this._tilesets=n,this._textures=i,this.texGrids=r,this._layerOrientation=e.orientation,this._mapTileSize=e.getTileSize();var o=this._mapTileSize.width,s=this._mapTileSize.height,c=this._layerSize.width,l=this._layerSize.height;if(this._layerOrientation===Z_t.HEX){var h=0,u=0;this._odd_even=this._staggerIndex===nft.STAGGERINDEX_ODD?1:-1,this._staggerAxis===eft.STAGGERAXIS_X?(this._diffX1=(o-this._hexSideLength)/2,this._diffY1=0,u=s*(l+.5),h=(o+this._hexSideLength)*Math.floor(c/2)+o*(c%2)):(this._diffX1=0,this._diffY1=(s-this._hexSideLength)/2,h=o*(c+.5),u=(s+this._hexSideLength)*Math.floor(l/2)+s*(l%2)),this.node._uiProps.uiTransformComp.setContentSize(h,u)}else if(this._layerOrientation===Z_t.ISO){var _=c+l;this.node._uiProps.uiTransformComp.setContentSize(.5*o*_,.5*s*_)}else this.node._uiProps.uiTransformComp.setContentSize(c*o,l*s);this._offset=new Qn(t.offset.x,-t.offset.y),this._useAutomaticVertexZ=!1,this._vertexZvalue=0,this._syncAnchorPoint(),this._prepareToRender()},n._prepareToRender=function(){this._updateVertices(),this._updateAllUserNode()},n.requestMeshRenderData=function(){this._meshRenderDataArray||(this._meshRenderDataArray=[]);for(var t=this._meshRenderDataArray;t.length>0&&t[t.length-1].subNodes&&0===t[t.length-1].subNodes.length;)t.pop();if(t.length>0){var e=t[t.length-1];if(e.renderData&&0===e.renderData.vertexCount)return e}var n=EV.add(),i={renderData:n,texture:null};return n.material=this.getRenderMaterial(0),this._meshRenderDataArray.push(i),i},n.requestSubNodesData=function(){this._meshRenderDataArray||(this._meshRenderDataArray=[]);var t=this._meshRenderDataArray;if(t.length>0&&t[t.length-1].subNodes&&0===t[t.length-1].subNodes.length)return t[t.length-1];var e={subNodes:[]};return this._meshRenderDataArray.push(e),e},n.destroyRenderData=function(){this._meshRenderDataArray&&(this._meshRenderDataArray.forEach((function(t){var e=t.renderData;e&&EV.remove(e)})),this._meshRenderDataArray.length=0),t.prototype.destroyRenderData.call(this)},n._flushAssembler=function(){var t=e.Assembler.getAssembler(this);this._assembler!==t&&(this._assembler=t),this._meshRenderDataArray||this._assembler&&this._assembler.createData&&(this._assembler.createData(this),this.markForUpdateRenderData(),this._updateColor())},n._render=function(t){if(this._meshRenderDataArray){for(var e=0;e<this._meshRenderDataArray.length;e++){this._meshRenderDataArrayIdx=e;var n=this._meshRenderDataArray[e];n.subNodes?n.subNodes.forEach((function(e){e&&t.walk(e.node)})):n.texture&&t.commitComp(this,n.renderData,n.texture,this._assembler,null)}this.node._static=!0}},Q(e,[{key:"cullingRect",get:function(){return this._cullingRect}},{key:"rightTop",get:function(){return this._rightTop}},{key:"layerSize",get:function(){return this._layerSize}},{key:"meshRenderDataArray",get:function(){return this._meshRenderDataArray}},{key:"leftDownToCenterX",get:function(){return this._leftDownToCenterX}},{key:"leftDownToCenterY",get:function(){return this._leftDownToCenterY}},{key:"enableCulling",get:function(){return this._enableCulling},set:function(t){this._enableCulling!==t&&(this._enableCulling=t,this._cullingDirty=!0,this.markForUpdateRenderData())}}]),e}(xk))||Pft),Cdt=t("TiledObjectGroup",(Oft=Ec("cc.TiledObjectGroup"),Nft=jc(),Bft=wc(LV),Lft=cl(Le),Oft(Fft=Nft(Fft=Bft((lt((Vft=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._premultiplyAlpha=!1,e._groupName=void 0,e._positionOffset=void 0,e._mapInfo=void 0,e._properties=void 0,e._offset=void 0,e._opacity=void 0,e._tintColor=null,e._animations=void 0,e._hasAniObj=void 0,e._texGrids=void 0,e.aniObjects=void 0,e._objects=[],e}$(e,t);var n=e.prototype;return n.getPositionOffset=function(){return this._positionOffset},n.getProperties=function(){return this._properties},n.getGroupName=function(){return this._groupName},n.getProperty=function(t){return this._properties[t.toString()]},n.getObject=function(t){for(var e=0,n=this._objects.length;e<n;e++){var i=this._objects[e];if(i&&i.name===t)return i}return null},n.getObjects=function(){return this._objects},n._init=function(t,e,n){var i=tft.FLIPPED_MASK,r=tft.HORIZONTAL,a=tft.VERTICAL;this._groupName=t.name,this._positionOffset=t.offset,this._mapInfo=e,this._properties=t.getProperties(),this._offset=new Qn(t.offset.x,-t.offset.y),this._opacity=t.opacity,t.tintColor&&(this._tintColor=t.tintColor),this._texGrids=n,this._animations=e.getTileAnimations(),this.aniObjects=[],this._hasAniObj=!1;var o=e.mapSize,s=e.tileSize,c=0,l=0,h=new Dn,u=Z_t.ISO===e.orientation;if(e.orientation===Z_t.HEX)e.getStaggerAxis()===eft.STAGGERAXIS_X?(l=s.height*(o.height+.5),c=(s.width+e.getHexSideLength())*Math.floor(o.width/2)+s.width*(o.width%2)):(c=s.width*(o.width+.5),l=(s.height+e.getHexSideLength())*Math.floor(o.height/2)+s.height*(o.height%2));else if(u){var _=o.width+o.height;c=.5*s.width*_,l=.5*s.height*_}else c=o.width*s.width,l=o.height*s.height;var f=this.node._uiProps.uiTransformComp;f.setContentSize(c,l);for(var d=c*f.anchorX,p=l*(1-f.anchorY),m=t.objects,v={},g=0,y=m.length;g<y;g++){var x=m[g],S=x.type;x.offset=new Qn(x.x,x.y);var A=x.points||x.polylinePoints;if(A)for(var b=0;b<A.length;b++)A[b].y*=-1;if(u){var C=x.x/s.height,T=x.y/s.height;x.x=.5*s.width*(o.height+C-T),x.y=.5*s.height*(o.width+o.height-C-T)}else x.y=l-x.y;if(S===rft.TEXT){var E="text"+x.id;v[E]=!0;var w=this.node.getChildByName(E);w||(w=new TE),w.setRotationFromEuler(0,0,-x.rotation),w.setPosition(x.x-d,x.y-p),w.name=E,w.parent=this.node,w.setSiblingIndex(g);var I=w.getComponent(Ck);I||(I=w.addComponent(Ck));var P=w._uiProps.uiTransformComp;w.active=x.visible,P.anchorX=0,P.anchorY=1,this._tintColor?(h.set(this._tintColor),h.a*=this._opacity/255,I.color.set(h)):I.color.a*=this._opacity/255,I.overflow=Ck.Overflow.SHRINK,I.lineHeight=x.height,I.string=x.text,I.horizontalAlign=x.halign,I.verticalAlign=x.valign,I.fontSize=x.pixelsize,P.setContentSize(x.width,x.height)}else if(S===rft.IMAGE){var D=x.gid,R=(D&i)>>>0,M=n.get(R);if(!M)continue;var O=M.tileset,N="img"+x.id;v[N]=!0;var B=this.node.getChildByName(N);x.width=x.width||M.width,x.height=x.height||M.height,B&&B._objFlags&ml.Flags.HideInHierarchy&&(B.removeFromParent(),B.hideFlags|=ml.Flags.DontSave,B.destroy(),B=null),B||(B=new TE),this._animations.get(R)&&(this.aniObjects.push({object:x,imgNode:B,gridGID:R}),this._hasAniObj=!0);var L=O.tileOffset.x,F=O.tileOffset.y;B.active=x.visible,B.setRotationFromEuler(0,0,-x.rotation),B.setPosition(x.x-d,x.y-p),B.name=N,B.parent=this.node,B.setSiblingIndex(g);var V=B.getComponent(tH);V||(V=B.addComponent(tH));var z=B._uiProps.uiTransformComp;u?(z.anchorX=.5+L/x.width,z.anchorY=F/x.height):(z.anchorX=L/x.width,z.anchorY=F/x.height),this._tintColor?(h.set(this._tintColor),h.a*=this._opacity/255,V.color.set(h)):V.color.a*=this._opacity/255,V.sizeMode=tH.SizeMode.CUSTOM,V._srcBlendFactor=this._premultiplyAlpha?Oi.ONE:Oi.SRC_ALPHA,V._dstBlendFactor=Oi.ONE_MINUS_SRC_ALPHA,V._updateBlendFunc();var k=M.spriteFrame;k=k?k.clone():new oF,(D&r)>>>0&&(k.flipUVX=!k.flipUVX),(D&a)>>>0&&(k.flipUVY=!k.flipUVY),k.rotated=M._rotated,k.rect=M._rect,V.spriteFrame=k,z.setContentSize(x.width,x.height),V.markForUpdateRenderData()}}this._objects=m;for(var U=this.node.children,G=/^(?:img|text)\d+$/,H=0,j=U.length;H<j;H++){var W=U[H],q=W.name;G.test(q)&&!v[q]&&W.destroy()}},n.update=function(){if(this._hasAniObj)for(var t=this.aniObjects,e=this._texGrids,n=Z_t.ISO===this._mapInfo.orientation,i=0,r=t.length;i<r;i++){var a=t[i],o=a.gridGID,s=e.get(o);if(s){var c=s.tileset,l=a.object,h=a.imgNode,u=c.tileOffset.x,_=c.tileOffset.y,f=h._uiProps.uiTransformComp;n?(f.anchorX=.5+u/l.width,f.anchorY=_/l.height):(f.anchorX=u/l.width,f.anchorY=_/l.height);var d=h.getComponent(tH),p=d.spriteFrame;p.rotated=s._rotated,p.rect=s._rect,d.spriteFrame=p,d.markForUpdateRenderData()}}},Q(e,[{key:"premultiplyAlpha",get:function(){return this._premultiplyAlpha},set:function(t){this._premultiplyAlpha=t}},{key:"offset",get:function(){return this._offset}}]),e}(xu)).prototype,"premultiplyAlpha",[Lft],Object.getOwnPropertyDescriptor(Vft.prototype,"premultiplyAlpha"),Vft.prototype),Fft=Vft))||Fft)||Fft)||Fft)),Tdt=t("TiledMapAsset",(zft=Ec("cc.TiledMapAsset"),kft=cl([HR]),Uft=cl([Fe]),Gft=cl([oF]),Hft=cl([oF]),jft=cl([Fe]),Wft=cl([Fe]),qft=cl([ri]),zft((idt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"tmxXmlStr",Kft,at(e)),ct(e,"tsxFiles",Jft,at(e)),ct(e,"tsxFileNames",Qft,at(e)),ct(e,"spriteFrames",Zft,at(e)),ct(e,"imageLayerSpriteFrame",$ft,at(e)),ct(e,"imageLayerSpriteFrameNames",tdt,at(e)),ct(e,"spriteFrameNames",edt,at(e)),ct(e,"spriteFrameSizes",ndt,at(e)),e}return $(e,t),e}($h),Kft=lt((Yft=idt).prototype,"tmxXmlStr",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Jft=lt(Yft.prototype,"tsxFiles",[Nc,kft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Qft=lt(Yft.prototype,"tsxFileNames",[Nc,Uft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Zft=lt(Yft.prototype,"spriteFrames",[Nc,Gft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$ft=lt(Yft.prototype,"imageLayerSpriteFrame",[Nc,Hft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tdt=lt(Yft.prototype,"imageLayerSpriteFrameNames",[Nc,jft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),edt=lt(Yft.prototype,"spriteFrameNames",[Nc,Wft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ndt=lt(Yft.prototype,"spriteFrameSizes",[Nc,qft],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xft=Yft))||Xft)),Edt=(t("TiledMap",(rdt=Ec("cc.TiledMap"),adt=jc(),odt=kc(),sdt=wc(LV),cdt=cl(Tdt),ldt=el(),rdt(hdt=adt(hdt=odt(hdt=sdt(hdt=zc((mdt=pdt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._texGrids=new Map,e._textures=[],e._tilesets=[],e._animations=new Map,e._imageLayers=[],e._layers=[],e._groups=[],e._images=[],e._properties={},e._tileProperties=new Map,e._mapInfo=null,e._mapSize=new ri(0,0),e._tileSize=new ri(0,0),e._mapOrientation=Z_t.ORTHO,e._isApplied=!1,ct(e,"_tmxFile",_dt,at(e)),ct(e,"_enableCulling",fdt,at(e)),ct(e,"cleanupImageCache",ddt,at(e)),e}$(e,t);var n=e.prototype;return n.getMapSize=function(){return this._mapSize},n.getTileSize=function(){return this._tileSize},n.getMapOrientation=function(){return this._mapOrientation},n.getObjectGroups=function(){return this._groups},n.getObjectGroup=function(t){for(var e=this._groups,n=0,i=e.length;n<i;n++){var r=e[n];if(r&&r.getGroupName()===t)return r}return null},n.getProperties=function(){return this._properties},n.getLayers=function(){return this._layers},n.getLayer=function(t){for(var e=this._layers,n=0,i=e.length;n<i;n++){var r=e[n];if(r&&r.getLayerName()===t)return r}return null},n._changeLayer=function(t,e){for(var n=this._layers,i=0,r=n.length;i<r;i++){var a=n[i];if(a&&a.getLayerName()===t)return void(n[i]=e)}},n.getProperty=function(t){return this._properties[t.toString()]},n.getPropertiesForGID=function(t){return this._tileProperties.get(t)},n.__preload=function(){this._tmxFile&&!1===this._isApplied&&(this._applyFile(),this._isApplied=!0)},n.onEnable=function(){this.node.on(bC.ANCHOR_CHANGED,this._syncAnchorPoint,this)},n.onDisable=function(){this.node.off(bC.ANCHOR_CHANGED,this._syncAnchorPoint,this)},n._applyFile=function(){var t=[],e={},n=this._tmxFile;if(n){for(var i=n.spriteFrameNames,r=n.spriteFrameSizes,a=n.spriteFrames,o={},s={},c=0;c<i.length;++c){var l=i[c];s[l]=r[c],t[c]=a[c];var h=t[c];h&&(e[h.name]=h,o[l]=h)}var u={},_=n.imageLayerSpriteFrame;i=n.imageLayerSpriteFrameNames;for(var f=0;f<_.length;++f)u[i[f]]=_[f];for(var d=n.tsxFileNames,p=n.tsxFiles,m={},v=0;v<d.length;++v)d[v].length>0&&(m[d[v]]=p[v].text);var g=new Dft(n.tmxXmlStr,m,o,s,u),y=g.getTilesets();y&&0!==y.length||P(7241),this._buildWithMapInfo(g)}else this._releaseMapInfo()},n._releaseMapInfo=function(){for(var t=this._layers,e=0,n=t.length;e<n;e++){var i,r;null===(i=t[e].node.parent)||void 0===i||i.off(bC.SIZE_CHANGED,t[e].updateCulling,t[e]),null===(r=t[e].node.parent)||void 0===r||r.off(bC.TRANSFORM_CHANGED,t[e].updateCulling,t[e]),t[e].node.removeFromParent(),t[e].node.destroy()}t.length=0;for(var a=this._groups,o=0,s=a.length;o<s;o++)a[o].node.removeFromParent(),a[o].node.destroy();a.length=0;for(var c=this._images,l=0,h=c.length;l<h;l++)c[l].removeFromParent(),c[l].destroy();c.length=0},n._syncAnchorPoint=function(){var t,e,n=this.node._uiProps.uiTransformComp.anchorPoint,i=this.node._uiProps.uiTransformComp.width*n.x,r=this.node._uiProps.uiTransformComp.height*(1-n.y);for(t=0,e=this._layers.length;t<e;t++)this._layers[t].node._uiProps.uiTransformComp.setAnchorPoint(n);for(t=0,e=this._groups.length;t<e;t++){var a=this._groups[t],o=a.node._uiProps.uiTransformComp;o.anchorX=.5,o.anchorY=.5;var s=a.offset.x-i+o.width*o.anchorX,c=a.offset.y+r-o.height*o.anchorY;a.node.setPosition(s,c)}for(t=0,e=this._images.length;t<e;t++){var l=this._images[t]._uiProps.uiTransformComp;l.anchorX=.5,l.anchorY=.5;var h=this._images[t]._offset.x-i+l.width*l.anchorX,u=this._images[t]._offset.y+r-l.height*l.anchorY;this._images[t].setPosition(h,u)}},n._fillAniGrids=function(t,e){for(var n,i=st(e.keys());!(n=i()).done;){var r=n.value,a=e.get(r);if(a)for(var o=a.frames,s=0;s<o.length;s++){var c=o[s];c.grid=t.get(c.tileid)}}},n._buildLayerAndGroup=function(){var t=this._tilesets,e=this._texGrids,n=this._animations;e.clear();for(var i=0,r=t.length;i<r;++i){var a=t[i];a&&(a.sourceImage?Mft(a,e,a.sourceImage):console.warn("Can't find the spriteFrame of tilesets "+i))}this._fillAniGrids(e,n);for(var o=this._layers,s=this._groups,c=this._images,l={},h=0,u=o.length;h<u;h++)l[o[h].node.name]=!0;for(var _=0,f=s.length;_<f;_++)l[s[_].node.name]=!0;for(var d=0,p=c.length;d<p;d++)l[c[d].name]=!0;o=this._layers=[],s=this._groups=[],c=this._images=[];var m=this._mapInfo,v=this.node,g=m.getAllChildren(),y=this._textures,x=0,S=0;if(g&&g.length>0)for(var A=0,b=g.length;A<b;A++){var C=g[A],T=C.name,E=this.node.getChildByName(T);if(l[T]=!1,E||((E=new TE).name=T,E.layer=v.layer,v.addChild(E)),E.setSiblingIndex(A),E.active=C.visible,C instanceof cft){var w=E.getComponent(bdt);w||(w=E.addComponent(bdt)),w.init(C,m,t,y,e),w.enableCulling=this._enableCulling,C.ownTiles=!1,o.push(w)}else if(C instanceof sft){var I=E.getComponent(Cdt);I||(I=E.addComponent(Cdt)),I._init(C,m,e),s.push(I)}else if(C instanceof lft){var P=C.sourceImage;E.layerInfo=C,E._offset=new Qn(C.offset.x,-C.offset.y);var D=E.getComponent(tH);D||(D=E.addComponent(tH)),D.color.a*=C.opacity,D.spriteFrame=P;var R=P.width,M=P.height;P.original&&(R=P.originalSize.width,M=P.originalSize.height),E._uiProps.uiTransformComp.setContentSize(R,M),c.push(E)}x=Math.max(x,E._uiProps.uiTransformComp.width),S=Math.max(S,E._uiProps.uiTransformComp.height)}for(var O=v.children,N=0,B=O.length;N<B;N++){var L=O[N];l[L.name]&&L.destroy()}this.node._uiProps.uiTransformComp.setContentSize(x,S),this._syncAnchorPoint()},n._buildWithMapInfo=function(t){var e=this;this._mapInfo=t,this._mapSize=t.getMapSize(),this._tileSize=t.getTileSize(),this._mapOrientation=t.orientation,this._properties=t.properties,this._tileProperties=t.getTileProperties(),this._imageLayers=t.getImageLayers(),this._animations=t.getTileAnimations(),this._tilesets=t.getTilesets();var n=this._tilesets;this._textures.length=0;for(var i=[],r=0,a=n.length;r<a;++r){var o=n[r];o&&o.sourceImage&&(this._textures[r]=o.sourceImage,i.push(o.sourceImage))}for(var s=0;s<this._imageLayers.length;s++){var c=this._imageLayers[s];c&&c.sourceImage&&i.push(c.sourceImage)}this._buildLayerAndGroup(),this.cleanupImageCache&&this._textures.forEach((function(t){e.doCleanupImageCache(t)}))},n.doCleanupImageCache=function(t){t._image instanceof HTMLImageElement?t._image.src="":wu.hasFeature(wu.Feature.IMAGE_BITMAP)&&t._image instanceof ImageBitmap&&t._image.close&&t._image.close(),t._image=null},n.lateUpdate=function(t){for(var e,n=this._animations,i=this._texGrids,r=st(n.keys());!(e=r()).done;){var a=e.value,o=n.get(a),s=o.frames,c=s[o.frameIdx];o.dt+=t,c.duration<o.dt&&(o.dt=0,o.frameIdx++,o.frameIdx>=s.length&&(o.frameIdx=0),c=s[o.frameIdx]),i.set(a,c.grid)}for(var l=this.getLayers(),h=0,u=l.length;h<u;h++){var _=l[h];(_.hasAnimation()||_.node.hasChangedFlags)&&_.markForUpdateRenderData()}},Q(e,[{key:"tmxAsset",get:function(){return this._tmxFile},set:function(t){this._tmxFile!==t&&(this._tmxFile=t,this._applyFile(),this._isApplied=!0)}},{key:"enableCulling",get:function(){return this._enableCulling},set:function(t){this._enableCulling=t;for(var e=this._layers,n=0;n<e.length;++n)e[n].enableCulling=t}}]),e}(xu),pdt.Orientation=Z_t,pdt.Property=$_t,pdt.TileFlag=tft,pdt.StaggerAxis=eft,pdt.StaggerIndex=nft,pdt.TMXObjectType=rft,pdt.RenderOrder=ift,_dt=lt((udt=mdt).prototype,"_tmxFile",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lt(udt.prototype,"tmxAsset",[cdt,ldt],Object.getOwnPropertyDescriptor(udt.prototype,"tmxAsset"),udt.prototype),fdt=lt(udt.prototype,"_enableCulling",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),lt(udt.prototype,"enableCulling",[Wc],Object.getOwnPropertyDescriptor(udt.prototype,"enableCulling"),udt.prototype),ddt=lt(udt.prototype,"cleanupImageCache",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),hdt=udt))||hdt)||hdt)||hdt)||hdt)||hdt)),Math.ceil(10922.5)),wdt=[],Idt=0;Idt<4;Idt++)wdt.push(new Mn);var Pdt,Ddt,Rdt=new Xn,Mdt=new Mn,Odt={row:0,col:0},Ndt={x:0,y:0},Bdt={x:0,y:0},Ldt={x:0,y:0},Fdt={x:0,y:0},Vdt=0,zdt=0,kdt=0,Udt=0,Gdt={createData:function(t){var e=t.requestMeshRenderData();return t.rightTop.col*t.rightTop.row*4>65535&&console.error("Vertex count exceeds 65535"),e},updateRenderData:function(t){t.updateCulling();var e=t.requestMeshRenderData();if(kdt=t.leftDownToCenterX,Udt=t.leftDownToCenterY,Pdt=e,t.colorChanged||t.isCullingDirty()||t.isUserNodeDirty()||t.hasAnimation()||t.hasTiledNode()||t.node.hasChangedFlags){var n,i;if(t.colorChanged=!1,t.destroyRenderData(),t.enableCulling){var r=t.cullingRect;n=r.leftDown,i=r.rightTop}else n=Odt,i=t.rightTop;switch(t.renderOrder){case ift.RightDown:Wdt(n,i,-1,1,t);break;case ift.LeftDown:Wdt(n,i,-1,-1,t);break;case ift.RightUp:Wdt(n,i,1,1,t);break;case ift.LeftUp:default:Wdt(n,i,1,-1,t)}t.setCullingDirty(!1),t.setUserNodeDirty(!1)}Pdt=null},updateColor:function(t){var e=t.color,n=new Float32Array(4);n[0]=e.r/255,n[1]=e.g/255,n[2]=e.b/255,n[3]=e.a/255;var i=t.meshRenderDataArray;if(i)for(var r,a=st(i);!(r=a()).done;){var o=r.value;if(o.renderData)for(var s=o.renderData,c=s.vData,l=s.vertexStart,h=s.vertexCount;l<h;l++)c.set(n,9*l+5)}},fillBuffers:function(t){if(t&&t.meshRenderDataArray)for(var e=t.meshRenderDataArray[t._meshRenderDataArrayIdx].renderData,n=e.iData,i=0,r=0,a=e.vertexCount/4,o=0;o<a;o+=1)n[i]=r,n[i+1]=r+1,n[i+2]=r+2,n[i+3]=r+2,n[i+4]=r+1,n[i+5]=r+3,i+=6,r+=4}};function Hdt(t,e){var n;t._rotated?(Ndt.x=t.r,Ndt.y=t.t,Bdt.x=t.l,Bdt.y=t.t,Ldt.x=t.r,Ldt.y=t.b,Fdt.x=t.l,Fdt.y=t.b):(Ndt.x=t.l,Ndt.y=t.t,Bdt.x=t.l,Bdt.y=t.b,Ldt.x=t.r,Ldt.y=t.t,Fdt.x=t.r,Fdt.y=t.b),(e&tft.DIAGONAL)>>>0&&(n=Bdt,Bdt=Ldt,Ldt=n),(e&tft.HORIZONTAL)>>>0&&(n=Ndt,Ndt=Ldt,Ldt=n,n=Bdt,Bdt=Fdt,Fdt=n),(e&tft.VERTICAL)>>>0&&(n=Ndt,Ndt=Bdt,Bdt=n,n=Ldt,Ldt=Fdt,Fdt=n)}function jdt(t,e,n){t||(t=e.texture),Pdt.texture||(Pdt.texture=t),(Pdt=n.requestMeshRenderData()).texture=e.texture}function Wdt(t,e,n,i,r){if(!(!Pdt||e.row<0||e.col<0)){Pdt.renderData||(Pdt=r.requestMeshRenderData());var a=Pdt.renderData.vData,o=r.node.worldMatrix;Vdt=0,zdt=0;var s,c,l,h,u,_,f,d,p,m=r.tiledTiles,v=r.texGrids,g=r.tiles,y=18,x=27,S=r.vertices,A=0,b=0,C=0,T=0,E=0,w=null,I=0,P=!0;Ddt=Hdt;var D=new Float32Array(4);for(D[0]=r.color.r/255,D[1]=r.color.g/255,D[2]=r.color.b/255,D[3]=r.color.a/255,-1===n?(h=e.row,u=t.row):(h=t.row,u=e.row);(u-h)*n>=0;h+=n)for(s=S[h],I=r.getNodesCountByRow(h),P=s&&0===I,1===i?(c=P&&t.col<s.minCol?s.minCol:t.col,l=P&&e.col>s.maxCol?s.maxCol:e.col):(c=P&&e.col>s.maxCol?s.maxCol:e.col,l=P&&t.col<s.minCol?s.minCol:t.col);(l-c)*i>=0;c+=i){if(_=s&&s[c],I>0){var R=r.requestSubNodesData(),M=r.getNodesByRowCol(h,c);M&&M.count>0&&(R.subNodes=r.getNodesByRowCol(h,c).list,w=null,Pdt=r.requestMeshRenderData())}if(_&&(A=g[_.index],d=v.get((A&tft.FLIPPED_MASK)>>>0))){w!==d.texture&&(jdt(w,d,r),w=d.texture),f=d.tileset._tileSize,b=_.left-kdt,C=_.bottom-Udt,T=b+f.width,E=C+f.height,p=m[_.index];var O=Pdt.renderData;O.reserve(4,0),zdt=9*O.vertexCount,a=O.vData,p?p.node.active&&qdt(p.node,D,a,b,T,E,C,!1):(wdt[0].x=b,wdt[0].y=E,wdt[1].x=b,wdt[1].y=C,wdt[2].x=T,wdt[2].y=E,wdt[3].x=T,wdt[3].y=C,wdt[0].transformMat4(o),a[zdt]=wdt[0].x,a[zdt+1]=wdt[0].y,a[zdt+2]=wdt[0].z,wdt[1].transformMat4(o),a[zdt+9]=wdt[1].x,a[zdt+9+1]=wdt[1].y,a[zdt+9+2]=wdt[1].z,wdt[2].transformMat4(o),a[zdt+y]=wdt[2].x,a[zdt+y+1]=wdt[2].y,a[zdt+y+2]=wdt[2].z,wdt[3].transformMat4(o),a[zdt+x]=wdt[3].x,a[zdt+x+1]=wdt[3].y,a[zdt+x+2]=wdt[3].z,a.set(D,zdt+5),a.set(D,zdt+9+5),a.set(D,zdt+y+5),a.set(D,zdt+x+5)),Ddt(d,A),a[zdt+3]=Ndt.x,a[zdt+4]=Ndt.y,a[zdt+9+3]=Bdt.x,a[zdt+9+4]=Bdt.y,a[zdt+y+3]=Ldt.x,a[zdt+y+4]=Ldt.y,a[zdt+x+3]=Fdt.x,a[zdt+x+4]=Fdt.y,Vdt++,O.request(4,6),O.resize(O.vertexCount,O.indexCount),Vdt>=Edt&&(jdt(w,d,r),w=d.texture)}}}}function qdt(t,e,n,i,r,a,o,s){var c=18,l=27;t.updateWorldTransform(),Xn.fromRTS(Rdt,t.rotation,t.position,t.scale),Mn.set(Mdt,-(i+kdt),-(o+Udt),0),Xn.transform(Rdt,Rdt,Mdt),Xn.multiply(Rdt,t.parent.worldMatrix,Rdt);var h=Rdt,u=h.m12,_=h.m13,f=h.m00,d=h.m01,p=h.m04,m=h.m05,v=1===f&&0===d&&0===p&&1===m;if(s){var g=(i+r)/2,y=(a+o)/2;v?(n[zdt]=g+u,n[zdt+1]=a+_,n[zdt+9]=i+u,n[zdt+9+1]=y+_,n[zdt+c]=r+u,n[zdt+c+1]=y+_,n[zdt+l]=g+u,n[zdt+l+1]=o+_):(n[zdt]=g*f+a*p+u,n[zdt+1]=g*d+a*m+_,n[zdt+9]=i*f+y*p+u,n[zdt+9+1]=i*d+y*m+_,n[zdt+c]=r*f+y*p+u,n[zdt+c+1]=r*d+y*m+_,n[zdt+l]=g*f+o*p+u,n[zdt+l+1]=g*d+o*m+_)}else v?(n[zdt]=i+u,n[zdt+1]=a+_,n[zdt+9]=i+u,n[zdt+9+1]=o+_,n[zdt+c]=r+u,n[zdt+c+1]=a+_,n[zdt+l]=r+u,n[zdt+l+1]=o+_):(n[zdt]=i*f+a*p+u,n[zdt+1]=i*d+a*m+_,n[zdt+9]=i*f+o*p+u,n[zdt+9+1]=i*d+o*m+_,n[zdt+c]=r*f+a*p+u,n[zdt+c+1]=r*d+a*m+_,n[zdt+l]=r*f+o*p+u,n[zdt+l+1]=r*d+o*m+_);n.set(e,zdt+5),n.set(e,zdt+9+5),n.set(e,zdt+c+5),n.set(e,zdt+l+5)}var Xdt=t("tiledLayerAssembler",{getAssembler:function(){return Gdt}});bdt.Assembler=Xdt;var Ydt=function(){function t(){this.originalTarget=null,this.target=null,this.tag=t.TAG_INVALID}var e=t.prototype;return e.clone=function(){var e=new t;return e.originalTarget=null,e.target=null,e.tag=this.tag,e},e.isDone=function(){return!0},e.startWithTarget=function(t){this.originalTarget=t,this.target=t},e.stop=function(){this.target=null},e.step=function(){P(1006)},e.update=function(){P(1007)},e.getTarget=function(){return this.target},e.setTarget=function(t){this.target=t},e.getOriginalTarget=function(){return this.originalTarget},e.setOriginalTarget=function(t){this.originalTarget=t},e.getTag=function(){return this.tag},e.setTag=function(t){this.tag=t},e.reverse=function(){return P(1008),null},e.retain=function(){},e.release=function(){},t}();Ydt.TAG_INVALID=-1;var Kdt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._duration=0,e._timesForRepeat=1,e}$(e,t);var n=e.prototype;return n.getDuration=function(){return this._duration*(this._timesForRepeat||1)},n.setDuration=function(t){this._duration=t},n.clone=function(){return new e},e}(Ydt),Jdt=(function(t){function e(e,n){var i;return void 0===n&&(n=1),(i=t.call(this)||this)._speed=0,i._innerAction=null,e&&i.initWithAction(e,n),i}$(e,t);var n=e.prototype;n.getSpeed=function(){return this._speed},n.setSpeed=function(t){this._speed=t},n.initWithAction=function(t,e){return t?(this._innerAction=t,this._speed=e,!0):(O(1021),!1)},n.clone=function(){var t=new e;return t.initWithAction(this._innerAction.clone(),this._speed),t},n.startWithTarget=function(t){Ydt.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},n.stop=function(){this._innerAction.stop(),Ydt.prototype.stop.call(this)},n.step=function(t){this._innerAction.step(t*this._speed)},n.isDone=function(){return this._innerAction.isDone()},n.reverse=function(){return new e(this._innerAction.reverse(),this._speed)},n.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},n.getInnerAction=function(){return this._innerAction}}(Ydt),0),Qdt=function(){this.actions=[],this.target=null,this.actionIndex=0,this.currentAction=null,this.paused=!1,this.lock=!1},Zdt=function(){function t(){this._hashTargets=new Map,this._arrayTargets=[],this._elementPool=[]}var e=t.prototype;return e._searchElementByTarget=function(t,e){for(var n=0;n<t.length;n++)if(e===t[n].target)return t[n];return null},e._getElement=function(t,e){var n=this._elementPool.pop();return n||(n=new Qdt),n.target=t,n.paused=!!e,n},e._putElement=function(t){t.actions.length=0,t.actionIndex=0,t.currentAction=null,t.paused=!1,t.target=null,t.lock=!1,this._elementPool.push(t)},e.addAction=function(t,e,n){if(t&&e){null==e.uuid&&(e.uuid="_TWEEN_UUID_"+Jdt++);var i=this._hashTargets.get(e);i?i.actions||(i.actions=[]):(i=this._getElement(e,n),this._hashTargets.set(e,i),this._arrayTargets.push(i)),i.target=e,i.actions.push(t),t.startWithTarget(e)}else O(1e3)},e.removeAllActions=function(){for(var t=this._arrayTargets,e=0;e<t.length;e++){var n=t[e];n&&this._putElement(n)}this._arrayTargets.length=0,this._hashTargets=new Map},e.removeAllActionsFromTarget=function(t){if(null!=t){var e=this._hashTargets.get(t);e&&(e.actions.length=0,this._deleteHashElement(e))}},e.removeAction=function(t){if(null!=t){var e=t.getOriginalTarget(),n=this._hashTargets.get(e);if(n)for(var i=0;i<n.actions.length;i++)if(n.actions[i]===t){n.actions.splice(i,1),n.actionIndex>=i&&n.actionIndex--;break}}},e._removeActionByTag=function(t,e,n){for(var i=0,r=e.actions.length;i<r;++i){var a=e.actions[i];if(a&&a.getTag()===t){if(n&&a.getOriginalTarget()!==n)continue;this._removeActionAtIndex(i,e);break}}},e._removeAllActionsByTag=function(t,e,n){for(var i=e.actions.length-1;i>=0;--i){var r=e.actions[i];if(r&&r.getTag()===t){if(n&&r.getOriginalTarget()!==n)continue;this._removeActionAtIndex(i,e)}}},e.removeActionByTag=function(t,e){var n=this;t===Ydt.TAG_INVALID&&P(1002);var i=this._hashTargets;if(e){var r=i.get(e);r&&this._removeActionByTag(t,r,e)}else i.forEach((function(e){n._removeActionByTag(t,e)}))},e.removeAllActionsByTag=function(t,e){var n=this;t===Ydt.TAG_INVALID&&P(1002);var i=this._hashTargets;if(e){var r=i.get(e);r&&this._removeAllActionsByTag(t,r,e)}else i.forEach((function(e){n._removeAllActionsByTag(t,e)}))},e.getActionByTag=function(t,e){t===Ydt.TAG_INVALID&&P(1004);var n=this._hashTargets.get(e);if(n){if(null!=n.actions)for(var i=0;i<n.actions.length;++i){var r=n.actions[i];if(r&&r.getTag()===t)return r}P(1005,t)}return null},e.getNumberOfRunningActionsInTarget=function(t){var e=this._hashTargets.get(t);return e&&e.actions?e.actions.length:0},e.pauseTarget=function(t){var e=this._hashTargets.get(t);e&&(e.paused=!0)},e.resumeTarget=function(t){var e=this._hashTargets.get(t);e&&(e.paused=!1)},e.pauseAllRunningActions=function(){for(var t=[],e=this._arrayTargets,n=0;n<e.length;n++){var i=e[n];i&&!i.paused&&(i.paused=!0,t.push(i.target))}return t},e.resumeTargets=function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.resumeTarget(t[e])},e.pauseTargets=function(t){if(t)for(var e=0;e<t.length;e++)t[e]&&this.pauseTarget(t[e])},e.purgeSharedManager=function(){h.director.getScheduler().unscheduleUpdate(this)},e._removeActionAtIndex=function(t,e){e.actions[t],e.actions.splice(t,1),e.actionIndex>=t&&e.actionIndex--,0===e.actions.length&&this._deleteHashElement(e)},e._deleteHashElement=function(t){var e=!1;if(t&&!t.lock&&this._hashTargets.get(t.target)){this._hashTargets.delete(t.target);for(var n=this._arrayTargets,i=0,r=n.length;i<r;i++)if(n[i]===t){n.splice(i,1);break}this._putElement(t),e=!0}return e},e.update=function(t){for(var e,n=this._arrayTargets,i=0;i<n.length;i++){this._currentTarget=n[i];var r=(e=this._currentTarget).target;if(r instanceof ml&&!r.isValid)this.removeAllActionsFromTarget(r),i--;else{if(!e.paused&&e.actions){for(e.lock=!0,e.actionIndex=0;e.actionIndex<e.actions.length;e.actionIndex++)if(e.currentAction=e.actions[e.actionIndex],e.currentAction){if(e.currentAction.step(t*(e.currentAction._speedMethod?e.currentAction._speed:1)),e.currentAction&&e.currentAction.isDone()){e.currentAction.stop();var a=e.currentAction;e.currentAction=null,this.removeAction(a)}e.currentAction=null}e.lock=!1}0===e.actions.length&&this._deleteHashElement(e)&&i--}}},t}(),$dt=t("TweenSystem",function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this).actionMgr=new Zdt,e}return $(e,t),e.prototype.update=function(t){this.actionMgr.update(t)},Q(e,[{key:"ActionManager",get:function(){return this.actionMgr}}]),e}(uO));$dt.ID="TWEEN",$dt.instance=void 0,TO.on(CO.EVENT_INIT,(function(){var t=new $dt;$dt.instance=t,TO.registerSystem($dt.ID,t,uO.Priority.MEDIUM)}));var tpt=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.isDone=function(){return!0},n.step=function(){this.update(1)},n.update=function(){},n.reverse=function(){return this.clone()},n.clone=function(){return new e},e}(Kdt),ept=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.update=function(){for(var t=this.target.getComponentsInChildren(jL),e=0;e<t.length;++e)t[e].enabled=!0},n.reverse=function(){return new npt},n.clone=function(){return new e},e}(tpt),npt=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.update=function(){for(var t=this.target.getComponentsInChildren(jL),e=0;e<t.length;++e)t[e].enabled=!1},n.reverse=function(){return new ept},n.clone=function(){return new e},e}(tpt);!function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;n.update=function(){for(var t=this.target.getComponentsInChildren(jL),e=0;e<t.length;++e){var n=t[e];n.enabled=!n.enabled}},n.reverse=function(){return new e},n.clone=function(){return new e}}(tpt);var ipt=function(t){function e(e){var n;return(n=t.call(this)||this)._isNeedCleanUp=!0,void 0!==e&&n.init(e),n}$(e,t);var n=e.prototype;return n.update=function(){this.target.removeFromParent(),this._isNeedCleanUp&&this.target.destroy()},n.init=function(t){return this._isNeedCleanUp=t,!0},n.reverse=function(){return new e(this._isNeedCleanUp)},n.clone=function(){return new e(this._isNeedCleanUp)},e}(tpt),rpt=function(t){function e(e,n,i){var r;return(r=t.call(this)||this)._selectorTarget=null,r._function=null,r._data=null,r.initWithFunction(e,n,i),r}$(e,t);var n=e.prototype;return n.initWithFunction=function(t,e,n){return t&&(this._function=t),e&&(this._selectorTarget=e),void 0!==n&&(this._data=n),!0},n.execute=function(){this._function&&this._function.call(this._selectorTarget,this.target,this._data)},n.update=function(){this.execute()},n.getTargetCallback=function(){return this._selectorTarget},n.setTargetCallback=function(t){t!==this._selectorTarget&&(this._selectorTarget&&(this._selectorTarget=null),this._selectorTarget=t)},n.clone=function(){var t=new e;return t.initWithFunction(this._function,this._selectorTarget,this._data),t},e}(tpt),apt=function(t){function e(e){var n;return(n=t.call(this)||this).MAX_VALUE=2,n._elapsed=0,n._firstTick=!1,n._easeList=[],n._speed=1,n._repeatForever=!1,n._repeatMethod=!1,n._speedMethod=!1,void 0===e||isNaN(e)||n.initWithDuration(e),n}$(e,t);var n=e.prototype;return n.getElapsed=function(){return this._elapsed},n.initWithDuration=function(t){return this._duration=0===t?_e.FLT_EPSILON:t,this._elapsed=0,this._firstTick=!0,!0},n.isDone=function(){return this._elapsed>=this._duration},n._cloneDecoration=function(t){t._repeatForever=this._repeatForever,t._speed=this._speed,t._timesForRepeat=this._timesForRepeat,t._easeList=this._easeList,t._speedMethod=this._speedMethod,t._repeatMethod=this._repeatMethod},n._reverseEaseList=function(t){if(this._easeList){t._easeList=[];for(var e=0;e<this._easeList.length;e++)t._easeList.push(this._easeList[e])}},n.clone=function(){var t=new e(this._duration);return this._cloneDecoration(t),t},n.easing=function(t){this._easeList?this._easeList.length=0:this._easeList=[];for(var e=0;e<arguments.length;e++)this._easeList.push(arguments[e]);return this},n._computeEaseTime=function(t){return t},n.step=function(t){this._firstTick?(this._firstTick=!1,this._elapsed=0):this._elapsed+=t;var e=this._elapsed/(this._duration>1.192092896e-7?this._duration:1.192092896e-7);e=e<1?e:1,this.update(e>0?e:0),this._repeatMethod&&this._timesForRepeat>1&&this.isDone()&&(this._repeatForever||this._timesForRepeat--,this.startWithTarget(this.target),this.step(this._elapsed-this._duration))},n.startWithTarget=function(t){Ydt.prototype.startWithTarget.call(this,t),this._elapsed=0,this._firstTick=!0},n.reverse=function(){return P(1010),this},n.setAmplitudeRate=function(){P(1011)},n.getAmplitudeRate=function(){return P(1012),0},n.speed=function(t){return t<=0?(P(1013),this):(this._speedMethod=!0,this._speed*=t,this)},n.getSpeed=function(){return this._speed},n.setSpeed=function(t){return this._speed=t,this},n.repeat=function(t){return t=Math.round(t),isNaN(t)||t<1?(P(1014),this):(this._repeatMethod=!0,this._timesForRepeat*=t,this)},n.repeatForever=function(){return this._repeatMethod=!0,this._timesForRepeat=this.MAX_VALUE,this._repeatForever=!0,this},e}(Kdt),opt=function(t){function e(n){var i;(i=t.call(this)||this)._actions=[],i._split=0,i._last=0,i._reversed=!1;var r=n instanceof Array?n:arguments;if(1===r.length)return O(1019),at(i);var a=r.length-1;if(a>=0&&null==r[a]&&P(1015),a>=0){for(var o,s=r[0],c=1;c<a;c++)r[c]&&(o=s,s=e._actionOneTwo(o,r[c]));i.initWithTwoActions(s,r[a])}return i}$(e,t);var n=e.prototype;return n.initWithTwoActions=function(t,e){if(!t||!e)return O(1025),!1;var n=t._duration,i=e._duration,r=(n*=t._repeatMethod?t._timesForRepeat:1)+(i*=e._repeatMethod?e._timesForRepeat:1);return this.initWithDuration(r),this._actions[0]=t,this._actions[1]=e,!0},n.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithTwoActions(this._actions[0].clone(),this._actions[1].clone()),t},n.startWithTarget=function(t){apt.prototype.startWithTarget.call(this,t),this._split=this._actions[0]._duration/this._duration,this._split*=this._actions[0]._repeatMethod?this._actions[0]._timesForRepeat:1,this._last=-1},n.stop=function(){-1!==this._last&&this._actions[this._last].stop(),Ydt.prototype.stop.call(this)},n.update=function(t){var e,n,i=0,r=this._split,a=this._actions,o=this._last;(t=this._computeEaseTime(t))<r?(e=0!==r?t/r:1,0===i&&1===o&&this._reversed&&(a[1].update(0),a[1].stop())):(i=1,e=1===r?1:(t-r)/(1-r),-1===o&&(a[0].startWithTarget(this.target),a[0].update(1),a[0].stop()),0===o&&(a[0].update(1),a[0].stop())),n=a[i],o===i&&n.isDone()||(o!==i&&n.startWithTarget(this.target),e*=n._timesForRepeat,n.update(e>1?e%1:e),this._last=i)},n.reverse=function(){var t=e._actionOneTwo(this._actions[1].reverse(),this._actions[0].reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t._reversed=!0,t},e}(apt);function spt(t){var e=t instanceof Array?t:arguments;if(1===e.length)return O(1019),null;var n=e.length-1;n>=0&&null==e[n]&&P(1015);var i=null;if(n>=0){i=e[0];for(var r=1;r<=n;r++)e[r]&&(i=opt._actionOneTwo(i,e[r]))}return i}opt._actionOneTwo=function(t,e){var n=new opt;return n.initWithTwoActions(t,e),n};var cpt=function(t){function e(e,n){var i;return(i=t.call(this)||this)._times=0,i._total=0,i._nextDt=0,i._actionInstant=!1,i._innerAction=null,void 0!==n&&i.initWithAction(e,n),i}$(e,t);var n=e.prototype;return n.initWithAction=function(t,e){var n=t._duration*e;return!!this.initWithDuration(n)&&(this._times=e,this._innerAction=t,t instanceof tpt&&(this._actionInstant=!0,this._times-=1),this._total=0,!0)},n.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone(),this._times),t},n.startWithTarget=function(t){this._total=0,this._nextDt=this._innerAction._duration/this._duration,apt.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},n.stop=function(){this._innerAction.stop(),Ydt.prototype.stop.call(this)},n.update=function(t){t=this._computeEaseTime(t);var e=this._innerAction,n=this._duration,i=this._times,r=this._nextDt;if(t>=r){for(;t>r&&this._total<i;)e.update(1),this._total++,e.stop(),e.startWithTarget(this.target),r+=e._duration/n,this._nextDt=r>1?1:r;t>=1&&this._total<i&&(e.update(1),this._total++),this._actionInstant||(this._total===i?e.stop():e.update(t-(r-e._duration/n)))}else e.update(t*i%1)},n.isDone=function(){return this._total===this._times},n.reverse=function(){var t=new e(this._innerAction.reverse(),this._times);return this._cloneDecoration(t),this._reverseEaseList(t),t},n.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},n.getInnerAction=function(){return this._innerAction},e}(apt),lpt=function(t){function e(e){var n;return(n=t.call(this)||this)._innerAction=null,e&&n.initWithAction(e),n}$(e,t);var n=e.prototype;return n.initWithAction=function(t){return t?(this._innerAction=t,!0):(O(1026),!1)},n.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._innerAction.clone()),t},n.startWithTarget=function(t){apt.prototype.startWithTarget.call(this,t),this._innerAction.startWithTarget(t)},n.step=function(t){var e=this._innerAction;e.step(t),e.isDone()&&(e.startWithTarget(this.target),e.step(e.getElapsed()-e._duration))},n.isDone=function(){return!1},n.reverse=function(){var t=new e(this._innerAction.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},n.setInnerAction=function(t){this._innerAction!==t&&(this._innerAction=t)},n.getInnerAction=function(){return this._innerAction},e}(apt),hpt=function(t){function e(n){var i;(i=t.call(this)||this)._one=null,i._two=null;var r=n instanceof Array?n:arguments;if(1===r.length)return O(1020),at(i);var a=r.length-1;if(a>=0&&null==r[a]&&P(1015),a>=0){for(var o,s=r[0],c=1;c<a;c++)r[c]&&(o=s,s=e._actionOneTwo(o,r[c]));i.initWithTwoActions(s,r[a])}return i}$(e,t);var n=e.prototype;return n.initWithTwoActions=function(t,e){if(!t||!e)return O(1027),!1;var n=!1,i=t._duration,r=e._duration;return this.initWithDuration(Math.max(i,r))&&(this._one=t,this._two=e,i>r?this._two=opt._actionOneTwo(e,fpt(i-r)):i<r&&(this._one=opt._actionOneTwo(t,fpt(r-i))),n=!0),n},n.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithTwoActions(this._one.clone(),this._two.clone()),t},n.startWithTarget=function(t){apt.prototype.startWithTarget.call(this,t),this._one.startWithTarget(t),this._two.startWithTarget(t)},n.stop=function(){this._one.stop(),this._two.stop(),Ydt.prototype.stop.call(this)},n.update=function(t){t=this._computeEaseTime(t),this._one&&this._one.update(t),this._two&&this._two.update(t)},n.reverse=function(){var t=e._actionOneTwo(this._one.reverse(),this._two.reverse());return this._cloneDecoration(t),this._reverseEaseList(t),t},e}(apt);function upt(t){var e=t instanceof Array?t:arguments;if(1===e.length)return O(1020),null;e.length>0&&null==e[e.length-1]&&P(1015);for(var n=e[0],i=1;i<e.length;i++)null!=e[i]&&(n=hpt._actionOneTwo(n,e[i]));return n}hpt._actionOneTwo=function(t,e){var n=new hpt;return n.initWithTwoActions(t,e),n};var _pt=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.update=function(){},n.reverse=function(){var t=new e(this._duration);return this._cloneDecoration(t),this._reverseEaseList(t),t},n.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithDuration(this._duration),t},e}(apt);function fpt(t){return new _pt(t)}var dpt,ppt,mpt,vpt,gpt,ypt,xpt,Spt,Apt,bpt,Cpt,Tpt,Ept,wpt,Ipt,Ppt,Dpt,Rpt,Mpt,Opt,Npt,Bpt,Lpt,Fpt,Vpt,zpt,kpt,Upt,Gpt,Hpt,jpt,Wpt,qpt,Xpt,Ypt,Kpt,Jpt,Qpt,Zpt,$pt,tmt,emt,nmt,imt,rmt,amt,omt,smt,cmt,lmt,hmt,umt,_mt,fmt,dmt,pmt,mmt,vmt,gmt,ymt,xmt=function(t){function e(e){var n;return(n=t.call(this)||this)._other=null,e&&n.initWithAction(e),n}$(e,t);var n=e.prototype;return n.initWithAction=function(t){return t?t===this._other?(O(1029),!1):!!apt.prototype.initWithDuration.call(this,t._duration)&&(this._other=t,!0):(O(1028),!1)},n.clone=function(){var t=new e;return this._cloneDecoration(t),t.initWithAction(this._other.clone()),t},n.startWithTarget=function(t){apt.prototype.startWithTarget.call(this,t),this._other.startWithTarget(t)},n.update=function(t){t=this._computeEaseTime(t),this._other&&this._other.update(1-t)},n.reverse=function(){return this._other.clone()},n.stop=function(){this._other.stop(),Ydt.prototype.stop.call(this)},e}(apt),Smt=t("TweenAction",function(t){function e(e,n,i){var r;if((r=t.call(this)||this)._opts=void 0,r._props=void 0,r._originProps=void 0,null==i)i=Object.create(null);else if(function(t){var e=" [Tween:] ",n=" option is not support in v + "+u,i=t;i.delay&&S(e+"delay"+n),i.repeat&&S(e+"repeat"+n),i.repeatDelay&&S(e+"repeatDelay"+n),i.interpolation&&S(e+"interpolation"+n),i.onStop&&S(e+"onStop"+n)}(i),i.easing&&"string"==typeof i.easing&&(i.easing=function(t){var e=t.charAt(0);if(/[A-Z]/.test(e)){var n=(t=t.replace(e,e.toLowerCase())).split("-");if(2===n.length){var i=n[0];if("linear"===i)t="linear";else{var r=n[1];switch(i){case"quadratic":t="quad"+r;break;case"quartic":t="quart"+r;break;case"quintic":t="quint"+r;break;case"sinusoidal":t="sine"+r;break;case"exponential":t="expo"+r;break;case"circular":t="circ"+r;break;default:t=i+r}}}}return t}(i.easing)),i.progress||(i.progress=r.progress),i.easing&&"string"==typeof i.easing){var a=i.easing;i.easing=gf[a],i.easing||R(1031,a)}for(var o in r._opts=i,r._props=Object.create(null),n)if(n.hasOwnProperty(o)){var s=n[o];if("function"==typeof s&&(s=s()),null!=s&&"string"!=typeof s){var c=void 0,l=void 0;void 0!==s.value&&(s.easing||s.progress)&&("string"==typeof s.easing?(c=gf[s.easing])||R(1031,s.easing):c=s.easing,l=s.progress,s=s.value);var h=Object.create(null);h.value=s,h.easing=c,h.progress=l,r._props[o]=h}}return r._originProps=n,r.initWithDuration(e),r}$(e,t);var n=e.prototype;return n.clone=function(){var t=new e(this._duration,this._originProps,this._opts);return this._cloneDecoration(t),t},n.startWithTarget=function(t){apt.prototype.startWithTarget.call(this,t);var e=!!this._opts.relative,n=this._props;for(var i in n){var r=t[i];if(void 0!==r){var a=n[i],o=a.value;if("number"==typeof r)a.start=r,a.current=r,a.end=e?r+o:o;else if("object"==typeof r)for(var s in null==a.start&&(a.start={},a.current={},a.end={}),o)isNaN(r[s])||(a.start[s]=r[s],a.current[s]=r[s],a.end[s]=e?r[s]+o[s]:o[s])}}this._opts.onStart&&this._opts.onStart(this.target)},n.update=function(t){var e=this.target;if(e){var n=this._props,i=this._opts,r=t;i.easing&&(r=i.easing(t));var a=i.progress;for(var o in n){var s=n[o],c=s.easing?s.easing(t):r,l=s.progress?s.progress:a,h=s.start,u=s.end;if("number"==typeof h)s.current=l(h,u,s.current,c);else if("object"==typeof h)for(var _ in h)s.current[_]=l(h[_],u[_],s.current[_],c);e[o]=s.current}i.onUpdate&&i.onUpdate(this.target,t),1===t&&i.onComplete&&i.onComplete(this.target)}},n.progress=function(t,e,n,i){return t+(e-t)*i},e}(apt)),Amt=function(t){function e(e){var n;return(n=t.call(this)||this)._props=void 0,n._props={},void 0!==e&&n.init(e),n}$(e,t);var n=e.prototype;return n.init=function(t){for(var e in t)this._props[e]=t[e];return!0},n.update=function(){var t=this._props,e=this.target;for(var n in t)e[n]=t[n]},n.clone=function(){var t=new e;return t.init(this._props),t},e}(tpt),bmt=t("Tween",function(){function t(t){this._actions=[],this._finalAction=null,this._target=null,this._tag=Ydt.TAG_INVALID,this._target=void 0===t?null:t}var e=t.prototype;return e.tag=function(t){return this._tag=t,this},e.then=function(t){return t instanceof Ydt?this._actions.push(t.clone()):this._actions.push(t._union()),this},e.target=function(t){return this._target=t,this},e.start=function(){return this._target?(this._finalAction&&$dt.instance.ActionManager.removeAction(this._finalAction),this._finalAction=this._union(),this._finalAction.setTag(this._tag),$dt.instance.ActionManager.addAction(this._finalAction,this._target,!1),this):(S("Please set target to tween first"),this)},e.stop=function(){return this._finalAction&&$dt.instance.ActionManager.removeAction(this._finalAction),this},e.clone=function(t){var e=this._union();return Cmt(t).then(e.clone())},e.union=function(){var t=this._union();return this._actions.length=0,this._actions.push(t),this},e.to=function(t,e,n){(n=n||Object.create(null)).relative=!1;var i=new Smt(t,e,n);return this._actions.push(i),this},e.by=function(t,e,n){(n=n||Object.create(null)).relative=!0;var i=new Smt(t,e,n);return this._actions.push(i),this},e.set=function(t){var e=new Amt(t);return this._actions.push(e),this},e.delay=function(t){var e=fpt(t);return this._actions.push(e),this},e.call=function(t){var e=new rpt(t,undefined,undefined);return this._actions.push(e),this},e.sequence=function(){var e=t._wrappedSequence.apply(t,arguments);return this._actions.push(e),this},e.parallel=function(){var e=t._wrappedParallel.apply(t,arguments);return this._actions.push(e),this},e.repeat=function(e,n){if(e===1/0)return this.repeatForever(n);var i,r=this._actions;return i=n instanceof t?n._union():r.pop(),r.push(function(t,e){return new cpt(t,e)}(i,e)),this},e.repeatForever=function(e){var n,i=this._actions;return n=e instanceof t?e._union():i.pop(),i.push(function(t){return new lpt(t)}(n)),this},e.reverseTime=function(e){var n,i=this._actions;return n=e instanceof t?e._union():i.pop(),i.push(function(t){return new xmt(t)}(n)),this},e.hide=function(){var t=new npt;return this._actions.push(t),this},e.show=function(){var t=new ept;return this._actions.push(t),this},e.removeSelf=function(){var t=new ipt(!1);return this._actions.push(t),this},t.stopAll=function(){$dt.instance.ActionManager.removeAllActions()},t.stopAllByTag=function(t,e){$dt.instance.ActionManager.removeAllActionsByTag(t,e)},t.stopAllByTarget=function(t){$dt.instance.ActionManager.removeAllActionsFromTarget(t)},e._union=function(){var t=this._actions;return 1===t.length?t[0]:spt(t)},e._destroy=function(){this.stop()},t._wrappedSequence=function(){var e=t._tmp_args;e.length=0;for(var n=arguments.length,i=0;i<n;i++){var r=e[i]=i<0||arguments.length<=i?void 0:arguments[i];r instanceof t&&(e[i]=r._union())}return spt.apply(spt,e)},t._wrappedParallel=function(){var e=t._tmp_args;e.length=0;for(var n=arguments.length,i=0;i<n;i++){var r=e[i]=i<0||arguments.length<=i?void 0:arguments[i];r instanceof t&&(e[i]=r._union())}return upt.apply(upt,e)},t}());function Cmt(t){return new bmt(t)}function Tmt(t){return S("tweenUtil' is deprecated, please use 'tween' instead "),new bmt(t)}bmt._tmp_args=[],h.Tween=bmt,h.tween=Cmt,h.tweenUtil=Tmt;var Emt,wmt,Imt,Pmt=new Dn;!function(t){t[t.NONE=0]="NONE",t[t.COLOR=1]="COLOR",t[t.SPRITE=2]="SPRITE",t[t.SCALE=3]="SCALE"}(Emt||(Emt={})),he(Emt),function(t){t.NORMAL="normal",t.HOVER="hover",t.PRESSED="pressed",t.DISABLED="disabled"}(wmt||(wmt={})),function(t){t.CLICK="click"}(Imt||(Imt={}));var Dmt=function(e){return t({Button:e,ButtonComponent:e}),e}((dpt=Ec("cc.Button"),ppt=jc(),mpt=Ic(110),vpt=kc(),gpt=wc(LV),ypt=cl(TE),xpt=el(),Spt=Kc(),Apt=el(),bpt=Kc(),Cpt=cl(Emt),Tpt=el(),Ept=Kc(),wpt=el(),Ipt=Kc(),Ppt=el(),Dpt=Kc(),Rpt=el(),Mpt=Kc(),Opt=el(),Npt=Kc(),Bpt=Qc(),Lpt=Zc(),Fpt=el(),Vpt=Kc(),zpt=el(),kpt=Kc(),Upt=cl(oF),Gpt=el(),Hpt=Kc(),jpt=cl(oF),Wpt=el(),qpt=Kc(),Xpt=cl(oF),Ypt=el(),Kpt=Kc(),Jpt=cl(oF),Qpt=el(),Zpt=Kc(),$pt=cl([CL]),tmt=el(),emt=Kc(),dpt(nmt=ppt(nmt=mpt(nmt=vpt(nmt=gpt(nmt=zc((ymt=gmt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"clickEvents",rmt,at(e)),ct(e,"_interactable",amt,at(e)),ct(e,"_transition",omt,at(e)),ct(e,"_normalColor",smt,at(e)),ct(e,"_hoverColor",cmt,at(e)),ct(e,"_pressedColor",lmt,at(e)),ct(e,"_disabledColor",hmt,at(e)),ct(e,"_normalSprite",umt,at(e)),ct(e,"_hoverSprite",_mt,at(e)),ct(e,"_pressedSprite",fmt,at(e)),ct(e,"_disabledSprite",dmt,at(e)),ct(e,"_duration",pmt,at(e)),ct(e,"_zoomScale",mmt,at(e)),ct(e,"_target",vmt,at(e)),e._pressed=!1,e._hovered=!1,e._fromColor=new Dn,e._toColor=new Dn,e._time=0,e._transitionFinished=!0,e._fromScale=new Mn,e._toScale=new Mn,e._originalScale=null,e._sprite=null,e._targetScale=new Mn,e}$(e,t);var n=e.prototype;return n.__preload=function(){this.target||(this.target=this.node);var t=this.node.getComponent(tH);t&&(this._normalSprite=t.spriteFrame),this._applyTarget(),this._resetState()},n.onEnable=function(){this._registerNodeEvent()},n.onDisable=function(){this._resetState(),this._unregisterNodeEvent()},n.onDestroy=function(){this.target.isValid&&this._unregisterTargetEvent(this.target)},n.update=function(t){var e=this.target;if(!this._transitionFinished&&e&&(this._transition===Emt.COLOR||this._transition===Emt.SCALE)){this._time+=t;var n=1;if(this._duration>0&&(n=this._time/this._duration),n>=1&&(n=1),this._transition===Emt.COLOR){var i=e._uiProps.uiComp;Dn.lerp(Pmt,this._fromColor,this._toColor,n),i&&(i.color=Pmt)}else this.transition===Emt.SCALE&&(e.getScale(this._targetScale),this._targetScale.x=fn(this._fromScale.x,this._toScale.x,n),this._targetScale.y=fn(this._fromScale.y,this._toScale.y,n),e.setScale(this._targetScale));1===n&&(this._transitionFinished=!0)}},n._resizeNodeToTargetNode=function(){this.target&&this.target._uiProps.uiTransformComp},n._resetState=function(){this._pressed=!1,this._hovered=!1;var t=this.target;if(t){var e=this._transition;if(e===Emt.COLOR&&this._interactable){var n=t.getComponent(xk);n&&(n.color=this._normalColor)}else e===Emt.SCALE&&this._originalScale&&t.setScale(this._originalScale);this._transitionFinished=!0}},n._registerNodeEvent=function(){this.node.on(bC.TOUCH_START,this._onTouchBegan,this),this.node.on(bC.TOUCH_MOVE,this._onTouchMove,this),this.node.on(bC.TOUCH_END,this._onTouchEnded,this),this.node.on(bC.TOUCH_CANCEL,this._onTouchCancel,this),this.node.on(bC.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.on(bC.MOUSE_LEAVE,this._onMouseMoveOut,this)},n._registerTargetEvent=function(t){t.on(bC.TRANSFORM_CHANGED,this._onTargetTransformChanged,this)},n._unregisterNodeEvent=function(){this.node.off(bC.TOUCH_START,this._onTouchBegan,this),this.node.off(bC.TOUCH_MOVE,this._onTouchMove,this),this.node.off(bC.TOUCH_END,this._onTouchEnded,this),this.node.off(bC.TOUCH_CANCEL,this._onTouchCancel,this),this.node.off(bC.MOUSE_ENTER,this._onMouseMoveIn,this),this.node.off(bC.MOUSE_LEAVE,this._onMouseMoveOut,this)},n._unregisterTargetEvent=function(t){t.off(bC.TRANSFORM_CHANGED)},n._getTargetSprite=function(t){var e=null;return t&&(e=t.getComponent(tH)),e},n._applyTarget=function(){this.target&&(this._sprite=this._getTargetSprite(this.target),this._originalScale||(this._originalScale=new Mn),Mn.copy(this._originalScale,this.target.getScale()),this._registerTargetEvent(this.target))},n._onTargetSpriteFrameChanged=function(t){this._transition===Emt.SPRITE&&this._setCurrentStateSpriteFrame(t.spriteFrame)},n._setCurrentStateSpriteFrame=function(t){if(t)switch(this._getButtonState()){case wmt.NORMAL:this._normalSprite=t;break;case wmt.HOVER:this._hoverSprite=t;break;case wmt.PRESSED:this._pressedSprite=t;break;case wmt.DISABLED:this._disabledSprite=t}},n._onTargetColorChanged=function(t){this._transition===Emt.COLOR&&this._setCurrentStateColor(t)},n._setCurrentStateColor=function(t){switch(this._getButtonState()){case wmt.NORMAL:this._normalColor=t;break;case wmt.HOVER:this._hoverColor=t;break;case wmt.PRESSED:this._pressedColor=t;break;case wmt.DISABLED:this._disabledColor=t}},n._onTargetTransformChanged=function(t){t&Fy.SCALE&&this._originalScale&&this._transition===Emt.SCALE&&this._transitionFinished&&Mn.copy(this._originalScale,this.target.getScale())},n._onTouchBegan=function(t){this._interactable&&this.enabledInHierarchy&&(this._pressed=!0,this._updateState(),t&&(t.propagationStopped=!0))},n._onTouchMove=function(t){if(this._interactable&&this.enabledInHierarchy&&this._pressed&&t){var e=t.touch;if(e){var n,i=this.node._uiProps.uiTransformComp.hitTest(e.getLocation());this._transition===Emt.SCALE&&this.target&&this._originalScale?i?(Mn.copy(this._fromScale,this._originalScale),Mn.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._transitionFinished=!1):(this._time=0,this._transitionFinished=!0,this.target.setScale(this._originalScale)):(n=i?wmt.PRESSED:wmt.NORMAL,this._applyTransition(n)),t&&(t.propagationStopped=!0)}}},n._onTouchEnded=function(t){this._interactable&&this.enabledInHierarchy&&(this._pressed&&(CL.emitEvents(this.clickEvents,t),this.node.emit(Imt.CLICK,this)),this._pressed=!1,this._updateState(),t&&(t.propagationStopped=!0))},n._onTouchCancel=function(){this._interactable&&this.enabledInHierarchy&&(this._pressed=!1,this._updateState())},n._onMouseMoveIn=function(){!this._pressed&&this.interactable&&this.enabledInHierarchy&&(this._transition!==Emt.SPRITE||this._hoverSprite)&&(this._hovered||(this._hovered=!0,this._updateState()))},n._onMouseMoveOut=function(){this._hovered&&(this._hovered=!1,this._updateState())},n._updateState=function(){var t=this._getButtonState();this._applyTransition(t)},n._getButtonState=function(){var t=wmt.NORMAL;return this._interactable?this._pressed?t=wmt.PRESSED:this._hovered&&(t=wmt.HOVER):t=wmt.DISABLED,t.toString()},n._updateColorTransition=function(t){var e,n=this[t+"Color"],i=null===(e=this.target)||void 0===e?void 0:e.getComponent(xk);i&&(t===wmt.DISABLED?i.color=n:(this._fromColor=i.color.clone(),this._toColor=n,this._time=0,this._transitionFinished=!1))},n._updateSpriteTransition=function(t){var e=this[t+"Sprite"];this._sprite&&e&&(this._sprite.spriteFrame=e)},n._updateScaleTransition=function(t){this._interactable&&(t===wmt.PRESSED?this._zoomUp():this._zoomBack())},n._zoomUp=function(){this._originalScale&&(Mn.copy(this._fromScale,this._originalScale),Mn.multiplyScalar(this._toScale,this._originalScale,this._zoomScale),this._time=0,this._transitionFinished=!1)},n._zoomBack=function(){this.target&&this._originalScale&&(Mn.copy(this._fromScale,this.target.getScale()),Mn.copy(this._toScale,this._originalScale),this._time=0,this._transitionFinished=!1)},n._applyTransition=function(t){var e=this._transition;e===Emt.COLOR?this._updateColorTransition(t):e===Emt.SPRITE?this._updateSpriteTransition(t):e===Emt.SCALE&&this._updateScaleTransition(t)},Q(e,[{key:"target",get:function(){return this._target||this.node},set:function(t){this._target!==t&&(this._target&&this._unregisterTargetEvent(this._target),this._target=t,this._applyTarget())}},{key:"interactable",get:function(){return this._interactable},set:function(t){this._interactable!==t&&(this._interactable=t,this._updateState(),this._interactable||this._resetState())}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"transition",get:function(){return this._transition},set:function(t){this._transition!==t&&(this._transition===Emt.COLOR?this._updateColorTransition(wmt.NORMAL):this._transition===Emt.SPRITE&&this._updateSpriteTransition(wmt.NORMAL),this._transition=t,this._updateState())}},{key:"normalColor",get:function(){return this._normalColor},set:function(t){this._normalColor!==t&&(this._normalColor.set(t),this._updateState())}},{key:"pressedColor",get:function(){return this._pressedColor},set:function(t){this._pressedColor!==t&&this._pressedColor.set(t)}},{key:"hoverColor",get:function(){return this._hoverColor},set:function(t){this._hoverColor!==t&&this._hoverColor.set(t)}},{key:"disabledColor",get:function(){return this._disabledColor},set:function(t){this._disabledColor!==t&&(this._disabledColor.set(t),this._updateState())}},{key:"duration",get:function(){return this._duration},set:function(t){this._duration!==t&&(this._duration=t)}},{key:"zoomScale",get:function(){return this._zoomScale},set:function(t){this._zoomScale!==t&&(this._zoomScale=t)}},{key:"normalSprite",get:function(){return this._normalSprite},set:function(t){if(this._normalSprite!==t){this._normalSprite=t;var e=this.node.getComponent(tH);e&&(e.spriteFrame=t),this._updateState()}}},{key:"pressedSprite",get:function(){return this._pressedSprite},set:function(t){this._pressedSprite!==t&&(this._pressedSprite=t,this._updateState())}},{key:"hoverSprite",get:function(){return this._hoverSprite},set:function(t){this._hoverSprite!==t&&(this._hoverSprite=t,this._updateState())}},{key:"disabledSprite",get:function(){return this._disabledSprite},set:function(t){this._disabledSprite!==t&&(this._disabledSprite=t,this._updateState())}}]),e}(xu),gmt.Transition=Emt,gmt.EventType=Imt,lt((imt=ymt).prototype,"target",[ypt,xpt,Spt],Object.getOwnPropertyDescriptor(imt.prototype,"target"),imt.prototype),lt(imt.prototype,"interactable",[Apt,bpt],Object.getOwnPropertyDescriptor(imt.prototype,"interactable"),imt.prototype),lt(imt.prototype,"transition",[Cpt,Tpt,Ept],Object.getOwnPropertyDescriptor(imt.prototype,"transition"),imt.prototype),lt(imt.prototype,"normalColor",[wpt,Ipt],Object.getOwnPropertyDescriptor(imt.prototype,"normalColor"),imt.prototype),lt(imt.prototype,"pressedColor",[Ppt,Dpt],Object.getOwnPropertyDescriptor(imt.prototype,"pressedColor"),imt.prototype),lt(imt.prototype,"hoverColor",[Rpt,Mpt],Object.getOwnPropertyDescriptor(imt.prototype,"hoverColor"),imt.prototype),lt(imt.prototype,"disabledColor",[Opt,Npt],Object.getOwnPropertyDescriptor(imt.prototype,"disabledColor"),imt.prototype),lt(imt.prototype,"duration",[Bpt,Lpt,Fpt,Vpt],Object.getOwnPropertyDescriptor(imt.prototype,"duration"),imt.prototype),lt(imt.prototype,"zoomScale",[zpt,kpt],Object.getOwnPropertyDescriptor(imt.prototype,"zoomScale"),imt.prototype),lt(imt.prototype,"normalSprite",[Upt,Gpt,Hpt],Object.getOwnPropertyDescriptor(imt.prototype,"normalSprite"),imt.prototype),lt(imt.prototype,"pressedSprite",[jpt,Wpt,qpt],Object.getOwnPropertyDescriptor(imt.prototype,"pressedSprite"),imt.prototype),lt(imt.prototype,"hoverSprite",[Xpt,Ypt,Kpt],Object.getOwnPropertyDescriptor(imt.prototype,"hoverSprite"),imt.prototype),lt(imt.prototype,"disabledSprite",[Jpt,Qpt,Zpt],Object.getOwnPropertyDescriptor(imt.prototype,"disabledSprite"),imt.prototype),rmt=lt(imt.prototype,"clickEvents",[$pt,Nc,tmt,emt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),amt=lt(imt.prototype,"_interactable",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),omt=lt(imt.prototype,"_transition",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Emt.NONE}}),smt=lt(imt.prototype,"_normalColor",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Dn.WHITE.clone()}}),cmt=lt(imt.prototype,"_hoverColor",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn(211,211,211,255)}}),lmt=lt(imt.prototype,"_pressedColor",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Dn.WHITE.clone()}}),hmt=lt(imt.prototype,"_disabledColor",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Dn(124,124,124,255)}}),umt=lt(imt.prototype,"_normalSprite",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_mt=lt(imt.prototype,"_hoverSprite",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fmt=lt(imt.prototype,"_pressedSprite",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dmt=lt(imt.prototype,"_disabledSprite",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pmt=lt(imt.prototype,"_duration",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),mmt=lt(imt.prototype,"_zoomScale",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.2}}),vmt=lt(imt.prototype,"_target",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nmt=imt))||nmt)||nmt)||nmt)||nmt)||nmt)||nmt));h.Button=Dmt;var Rmt,Mmt,Omt,Nmt=function(){function t(){}return t.add=function(t){var e=this._tabIndexList;-1===e.indexOf(t)&&e.push(t)},t.remove=function(t){var e=this._tabIndexList,n=e.indexOf(t);-1!==n&&e.splice(n,1)},t.resort=function(){this._tabIndexList.sort((function(t,e){return t._delegate.tabIndex-e._delegate.tabIndex}))},t.next=function(t){var e=this._tabIndexList,n=e.indexOf(t);if(t.setFocus(!1),-1!==n){var i=e[n+1];i&&i._delegate.tabIndex>=0&&i.setFocus(!0)}},t}();Nmt._tabIndexList=[],function(t){t[t.DEFAULT=0]="DEFAULT",t[t.DONE=1]="DONE",t[t.SEND=2]="SEND",t[t.SEARCH=3]="SEARCH",t[t.GO=4]="GO",t[t.NEXT=5]="NEXT"}(Rmt||(Rmt={})),se(Rmt),function(t){t[t.ANY=0]="ANY",t[t.EMAIL_ADDR=1]="EMAIL_ADDR",t[t.NUMERIC=2]="NUMERIC",t[t.PHONE_NUMBER=3]="PHONE_NUMBER",t[t.URL=4]="URL",t[t.DECIMAL=5]="DECIMAL",t[t.SINGLE_LINE=6]="SINGLE_LINE"}(Mmt||(Mmt={})),se(Mmt),function(t){t[t.PASSWORD=0]="PASSWORD",t[t.SENSITIVE=1]="SENSITIVE",t[t.INITIAL_CAPS_WORD=2]="INITIAL_CAPS_WORD",t[t.INITIAL_CAPS_SENTENCE=3]="INITIAL_CAPS_SENTENCE",t[t.INITIAL_CAPS_ALL_CHARACTERS=4]="INITIAL_CAPS_ALL_CHARACTERS",t[t.DEFAULT=5]="DEFAULT"}(Omt||(Omt={})),se(Omt);var Bmt,Lmt,Fmt,Vmt,zmt,kmt,Umt,Gmt,Hmt,jmt,Wmt,qmt,Xmt,Ymt,Kmt,Jmt,Qmt,Zmt,$mt,tvt,evt,nvt,ivt,rvt,avt,ovt,svt,cvt,lvt,hvt,uvt,_vt,fvt,dvt,pvt,mvt,vvt,gvt,yvt,xvt,Svt,Avt,bvt,Cvt,Tvt,Evt,wvt,Ivt,Pvt,Dvt,Rvt,Mvt,Ovt,Nvt,Bvt,Lvt,Fvt,Vvt,zvt,kvt,Uvt,Gvt=function(){function t(){this._editing=!1,this._delegate=null}var e=t.prototype;return e.init=function(){},e.onEnable=function(){},e.update=function(){},e.onDisable=function(){this._editing&&this.endEditing()},e.clear=function(){this._delegate=null},e.setTabIndex=function(){},e.setSize=function(){},e.setFocus=function(t){t?this.beginEditing():this.endEditing()},e.isFocused=function(){return this._editing},e.beginEditing=function(){},e.endEditing=function(){},t}(),Hvt=new Xn,jvt=new Xn,Wvt=new Mn,qvt=null,Xvt=0;!function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._delegate=null,e._inputMode=-1,e._inputFlag=-1,e._returnType=-1,e.__eventListeners={},e.__autoResize=!1,e.__orientationChanged=void 0,e._edTxt=null,e._isTextArea=!1,e._textLabelFont=null,e._textLabelFontSize=null,e._textLabelFontColor=null,e._textLabelAlign=null,e._placeholderLabelFont=null,e._placeholderLabelFontSize=null,e._placeholderLabelFontColor=null,e._placeholderLabelAlign=null,e._placeholderLineHeight=null,e._placeholderStyleSheet=null,e._domId="EditBoxId_"+ ++Xvt,e}$(e,t);var n=e.prototype;n.init=function(t){t&&(this._delegate=t,t.inputMode===Mmt.ANY?this._createTextArea():this._createInput(),Nmt.add(this),this.setTabIndex(t.tabIndex),this._initStyleSheet(),this._registerEventListeners(),this._addDomToGameContainer())},n.clear=function(){this._removeEventListeners(),this._removeDomFromGameContainer(),Nmt.remove(this),qvt===this&&(qvt=null),this._delegate=null},n.update=function(){this._updateMatrix()},n.setTabIndex=function(t){this._edTxt.tabIndex=t,Nmt.resort()},n.setSize=function(t,e){var n=this._edTxt;n&&(n.style.width=t+"px",n.style.height=e+"px")},n.beginEditing=function(){qvt&&qvt!==this&&qvt.setFocus(!1),this._editing=!0,qvt=this,this._delegate._editBoxEditingDidBegan(),this._showDom(),this._edTxt.focus()},n.endEditing=function(){this._edTxt.blur()},n._createInput=function(){this._isTextArea=!1,this._edTxt=document.createElement("input")},n._createTextArea=function(){this._isTextArea=!0,this._edTxt=document.createElement("textarea")},n._addDomToGameContainer=function(){h.GAME_VIEW&&this._edTxt?(h.gameView.container.appendChild(this._edTxt),h.gameView.head.appendChild(this._placeholderStyleSheet)):bO.container&&this._edTxt&&(bO.container.appendChild(this._edTxt),document.head.appendChild(this._placeholderStyleSheet))},n._removeDomFromGameContainer=function(){(h.GAME_VIEW?xe(h.gameView.container,this._edTxt):xe(bO.container,this._edTxt))&&this._edTxt&&(h.GAME_VIEW?h.gameView.container.removeChild(this._edTxt):bO.container.removeChild(this._edTxt)),(h.GAME_VIEW?xe(h.gameView.head,this._placeholderStyleSheet):xe(document.head,this._placeholderStyleSheet))&&(h.GAME_VIEW?h.gameView.head.removeChild(this._placeholderStyleSheet):document.head.removeChild(this._placeholderStyleSheet)),this._edTxt=null,this._placeholderStyleSheet=null},n._showDom=function(){this._updateMaxLength(),this._updateInputType(),this._updateStyleSheet(),this._edTxt&&this._delegate&&(this._edTxt.style.display="",this._delegate._hideLabels()),wu.isMobile&&this._showDomOnMobile()},n._hideDom=function(){var t=this._edTxt;t&&this._delegate&&(t.style.display="none",this._delegate._showLabels()),wu.isMobile&&this._hideDomOnMobile()},n._showDomOnMobile=function(){wu.os!==Ch.ANDROID&&wu.os!==Ch.OHOS||(Cu.handleResizeEvent=!1,this._adjustWindowScroll())},n._hideDomOnMobile=function(){wu.os!==Ch.ANDROID&&wu.os!==Ch.OHOS||(Cu.handleResizeEvent=!0),this._scrollBackWindow()},n._adjustWindowScroll=function(){var t=this;setTimeout((function(){window.scrollY<40&&t._edTxt.scrollIntoView({block:"start",inline:"nearest",behavior:"smooth"})}),400)},n._scrollBackWindow=function(){setTimeout((function(){wu.browserType!==Sh.WECHAT||wu.os!==Ch.IOS?window.scrollTo(0,0):window.top&&window.top.scrollTo(0,0)}),400)},n._updateMatrix=function(){if(this._edTxt){var t=this._delegate.node,e=BO.getScaleX(),n=BO.getScaleY(),i=1,r=1;h.GAME_VIEW&&(i=h.gameView.canvas.width/h.game.canvas.width,r=h.gameView.canvas.height/h.game.canvas.height),e*=i,n*=r;var a=BO.getViewportRect(),o=Cu.devicePixelRatio;t.getWorldMatrix(Hvt);var s=t._uiProps.uiTransformComp;if(s&&Mn.set(Wvt,-s.anchorX*s.width,-s.anchorY*s.height,Wvt.z),Xn.transform(Hvt,Hvt,Wvt),t._uiProps.uiTransformComp){var c=TO.root.batcher2D.getFirstRenderCamera(t);if(c){c.node.getWorldRT(jvt);var l=jvt.m12,u=jvt.m13,_=IO.center;jvt.m12=_.x-(jvt.m00*l+jvt.m04*u),jvt.m13=_.y-(jvt.m01*l+jvt.m05*u),Xn.multiply(jvt,jvt,Hvt),e/=o,n/=o;var f=h.GAME_VIEW?h.gameView.container:bO.container,d=jvt.m00*e,p=Hvt.m01,m=Hvt.m04,v=jvt.m05*n,g=parseInt(f&&f.style.paddingLeft||"0");g+=a.x*i/o;var y=parseInt(f&&f.style.paddingBottom||"0");y+=a.y/o;var x="matrix("+d+","+-p+","+-m+","+v+","+(jvt.m12*e+g)+","+-(jvt.m13*n+y)+")";this._edTxt.style.transform=x,this._edTxt.style["-webkit-transform"]=x,this._edTxt.style["transform-origin"]="0px 100% 0px",this._edTxt.style["-webkit-transform-origin"]="0px 100% 0px"}}}},n._updateInputType=function(){var t=this._delegate,e=t.inputMode,n=t.inputFlag,i=t.returnType,r=this._edTxt;if(this._inputMode!==e||this._inputFlag!==n||this._returnType!==i){if(this._inputMode=e,this._inputFlag=n,this._returnType=i,this._isTextArea){var a="none";return n===Omt.INITIAL_CAPS_ALL_CHARACTERS?a="uppercase":n===Omt.INITIAL_CAPS_WORD&&(a="capitalize"),void(r.style.textTransform=a)}if(r=r,n===Omt.PASSWORD)return r.type="password",void(r.style.textTransform="none");var o=r.type;e===Mmt.EMAIL_ADDR?o="email":e===Mmt.NUMERIC||e===Mmt.DECIMAL?o="number":e===Mmt.PHONE_NUMBER?(o="number",r.pattern="[0-9]*",r.addEventListener("wheel",(function(){return!1}))):e===Mmt.URL?o="url":(o="text",i===Rmt.SEARCH&&(o="search")),r.type=o;var s="none";n===Omt.INITIAL_CAPS_ALL_CHARACTERS?s="uppercase":n===Omt.INITIAL_CAPS_WORD&&(s="capitalize"),r.style.textTransform=s}},n._updateMaxLength=function(){var t=this._delegate.maxLength;t<0&&(t=65535),this._edTxt.maxLength=t},n._initStyleSheet=function(){if(this._edTxt){var t=this._edTxt;t.style.color="#000000",t.style.border="0px",t.style.background="transparent",t.style.width="100%",t.style.height="100%",t.style.outline="medium",t.style.padding="0",t.style.textTransform="none",t.style.display="none",t.style.position="absolute",t.style.bottom="0px",t.style.left="2px",t.className="cocosEditBox",t.style.fontFamily="Arial",t.id=this._domId,this._isTextArea?(t.style.resize="none",t.style.overflowY="scroll"):((t=t).type="text",t.style["-moz-appearance"]="textfield"),this._placeholderStyleSheet=document.createElement("style")}},n._updateStyleSheet=function(){var t=this._delegate,e=this._edTxt;e&&t&&(e.value=t.string,this._updateTextLabel(t.textLabel))},n._updateTextLabel=function(t){if(t){var e=t.font;e=!e||e instanceof wF?t.fontFamily:e._fontFamily;var n=t.fontSize*t.node.scale.y;if((this._textLabelFont!==e||this._textLabelFontSize!==n||this._textLabelFontColor!==t.fontColor||this._textLabelAlign!==t.horizontalAlign)&&(this._textLabelFont=e,this._textLabelFontSize=n,this._textLabelFontColor=t.fontColor,this._textLabelAlign=t.horizontalAlign,this._edTxt)){var i=this._edTxt;switch(i.style.fontSize=n+"px",i.style.color=t.color.toCSS(),i.style.fontFamily=e,t.horizontalAlign){case Ck.HorizontalAlign.LEFT:i.style.textAlign="left";break;case Ck.HorizontalAlign.CENTER:i.style.textAlign="center";break;case Ck.HorizontalAlign.RIGHT:i.style.textAlign="right"}}}},n._updatePlaceholderLabel=function(t){if(t){var e=t.font;e=!e||e instanceof wF?t.fontFamily:t.font._fontFamily;var n=t.fontSize*t.node.scale.y;if(this._placeholderLabelFont!==e||this._placeholderLabelFontSize!==n||this._placeholderLabelFontColor!==t.fontColor||this._placeholderLabelAlign!==t.horizontalAlign||this._placeholderLineHeight!==t.fontSize){this._placeholderLabelFont=e,this._placeholderLabelFontSize=n,this._placeholderLabelFontColor=t.fontColor,this._placeholderLabelAlign=t.horizontalAlign,this._placeholderLineHeight=t.fontSize;var i=this._placeholderStyleSheet,r=t.color.toCSS(),a=t.fontSize,o="";switch(t.horizontalAlign){case Ck.HorizontalAlign.LEFT:o="left";break;case Ck.HorizontalAlign.CENTER:o="center";break;case Ck.HorizontalAlign.RIGHT:o="right"}i.innerHTML="#"+this._domId+"::-webkit-input-placeholder{text-transform: initial;-family: "+e+";font-size: "+n+"px;color: "+r+";line-height: "+a+"px;text-align: "+o+";}#"+this._domId+"::-moz-placeholder{text-transform: initial;-family: "+e+";font-size: "+n+"px;color: "+r+";line-height: "+a+"px;text-align: "+o+";}#"+this._domId+"::-ms-input-placeholder{text-transform: initial;-family: "+e+";font-size: "+n+"px;color: "+r+";line-height: "+a+"px;text-align: "+o+";}",wu.browserType===Sh.EDGE&&(i.innerHTML+="#"+this._domId+"::-ms-clear{display: none;}")}}},n._registerEventListeners=function(){var t=this;if(this._edTxt){var e=this._edTxt,n=!1,i=this.__eventListeners;i.compositionStart=function(){n=!0},i.compositionEnd=function(){n=!1,t._delegate._editBoxTextChanged(e.value)},i.onInput=function(){if(!n){var i=t._delegate,r=i.maxLength;r>=0&&(e.value=e.value.slice(0,r)),i._editBoxTextChanged(e.value)}},i.onClick=function(){t._editing&&wu.isMobile&&t._adjustWindowScroll()},i.onKeydown=function(n){n.keyCode===PD.ENTER?(n.propagationStopped=!0,t._delegate._editBoxEditingReturn(),t._isTextArea||e.blur()):n.keyCode===PD.TAB&&(n.propagationStopped=!0,n.preventDefault(),Nmt.next(t))},i.onBlur=function(){wu.isMobile&&n&&i.compositionEnd(),t._editing=!1,qvt=null,t._hideDom(),t._delegate._editBoxEditingDidEnded()},e.addEventListener("compositionstart",i.compositionStart),e.addEventListener("compositionend",i.compositionEnd),e.addEventListener("input",i.onInput),e.addEventListener("keydown",i.onKeydown),e.addEventListener("blur",i.onBlur),e.addEventListener("touchstart",i.onClick)}},n._removeEventListeners=function(){if(this._edTxt){var t=this._edTxt,e=this.__eventListeners;t.removeEventListener("compositionstart",e.compositionStart),t.removeEventListener("compositionend",e.compositionEnd),t.removeEventListener("input",e.onInput),t.removeEventListener("keydown",e.onKeydown),t.removeEventListener("blur",e.onBlur),t.removeEventListener("touchstart",e.onClick),e.compositionStart=null,e.compositionEnd=null,e.onInput=null,e.onKeydown=null,e.onBlur=null,e.onClick=null}}}(Gvt),function(t){t.EDITING_DID_BEGAN="editing-did-began",t.EDITING_DID_ENDED="editing-did-ended",t.TEXT_CHANGED="text-changed",t.EDITING_RETURN="editing-return"}(Uvt||(Uvt={}));var Yvt,Kvt,Jvt,Qvt,Zvt,$vt,tgt,egt,ngt,igt,rgt,agt,ogt,sgt,cgt,lgt,hgt,ugt,_gt,fgt,dgt,pgt,mgt,vgt,ggt,ygt,xgt,Sgt,Agt,bgt,Cgt,Tgt,Egt,wgt,Igt,Pgt,Dgt,Rgt,Mgt,Ogt,Ngt,Bgt,Lgt,Fgt,Vgt,zgt,kgt,Ugt,Ggt,Hgt,jgt,Wgt,qgt,Xgt,Ygt,Kgt,Jgt,Qgt,Zgt,$gt,tyt,eyt=function(e){return t({EditBox:e,EditBoxComponent:e}),e}((Bmt=Ec("cc.EditBox"),Lmt=jc(),Fmt=Ic(110),Vmt=kc(),zmt=wc(LV),kmt=el(),Umt=Kc(),Gmt=el(),Hmt=Kc(),jmt=cl(Ck),Wmt=el(),qmt=Kc(),Xmt=cl(Ck),Ymt=el(),Kmt=Kc(),Jmt=cl(oF),Qmt=el(),Zmt=Kc(),$mt=cl(Omt),tvt=el(),evt=Kc(),nvt=cl(Mmt),ivt=el(),rvt=Kc(),avt=cl(Rmt),ovt=el(),svt=Kc(),cvt=el(),lvt=Kc(),hvt=el(),uvt=Kc(),_vt=cl([CL]),fvt=el(),dvt=Kc(),pvt=cl([CL]),mvt=el(),vvt=Kc(),gvt=cl([CL]),yvt=el(),xvt=Kc(),Svt=cl([CL]),Avt=el(),bvt=Kc(),Bmt(Cvt=Lmt(Cvt=Fmt(Cvt=Vmt(Cvt=zmt(Cvt=zc((kvt=zvt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"editingDidBegan",Evt,at(e)),ct(e,"textChanged",wvt,at(e)),ct(e,"editingDidEnded",Ivt,at(e)),ct(e,"editingReturn",Pvt,at(e)),e._impl=null,e._background=null,ct(e,"_textLabel",Dvt,at(e)),ct(e,"_placeholderLabel",Rvt,at(e)),ct(e,"_returnType",Mvt,at(e)),ct(e,"_string",Ovt,at(e)),ct(e,"_tabIndex",Nvt,at(e)),ct(e,"_backgroundImage",Bvt,at(e)),ct(e,"_inputFlag",Lvt,at(e)),ct(e,"_inputMode",Fvt,at(e)),ct(e,"_maxLength",Vvt,at(e)),e._isLabelVisible=!1,e}$(e,t);var n=e.prototype;return n.__preload=function(){this._init()},n.onEnable=function(){this._registerEvent(),this._ensureBackgroundSprite(),this._impl&&this._impl.onEnable()},n.update=function(){this._impl&&this._impl.update()},n.onDisable=function(){this._unregisterEvent(),this._unregisterBackgroundEvent(),this._impl&&this._impl.onDisable()},n.onDestroy=function(){this._impl&&this._impl.clear()},n.setFocus=function(){this._impl&&this._impl.setFocus(!0)},n.focus=function(){this._impl&&this._impl.setFocus(!0)},n.blur=function(){this._impl&&this._impl.setFocus(!1)},n.isFocused=function(){return!!this._impl&&this._impl.isFocused()},n._editBoxEditingDidBegan=function(){CL.emitEvents(this.editingDidBegan,this),this.node.emit(Uvt.EDITING_DID_BEGAN,this)},n._editBoxEditingDidEnded=function(){CL.emitEvents(this.editingDidEnded,this),this.node.emit(Uvt.EDITING_DID_ENDED,this)},n._editBoxTextChanged=function(t){t=this._updateLabelStringStyle(t,!0),this.string=t,CL.emitEvents(this.textChanged,t,this),this.node.emit(Uvt.TEXT_CHANGED,this)},n._editBoxEditingReturn=function(){CL.emitEvents(this.editingReturn,this),this.node.emit(Uvt.EDITING_RETURN,this)},n._showLabels=function(){this._isLabelVisible=!0,this._updateLabels()},n._hideLabels=function(){this._isLabelVisible=!1,this._textLabel&&(this._textLabel.node.active=!1),this._placeholderLabel&&(this._placeholderLabel.node.active=!1)},n._onTouchBegan=function(t){t.propagationStopped=!0},n._onTouchCancel=function(t){t.propagationStopped=!0},n._onTouchEnded=function(t){this._impl&&this._impl.beginEditing(),t.propagationStopped=!0},n._init=function(){this._updatePlaceholderLabel(),this._updateTextLabel(),this._isLabelVisible=!0,this.node.on(bC.SIZE_CHANGED,this._resizeChildNodes,this),(this._impl=new e._EditBoxImpl).init(this),this._updateString(this._string),this._syncSize()},n._ensureBackgroundSprite=function(){if(!this._background){var t=this.node.getComponent(tH);t||(t=this.node.addComponent(tH)),t!==this._background&&(t.type=tH.Type.SLICED,t.spriteFrame=this._backgroundImage,this._background=t,this._registerBackgroundEvent())}},n._updateTextLabel=function(){var t=this._textLabel;if(!t){var e=this.node.getChildByName("TEXT_LABEL");e||((e=new TE("TEXT_LABEL")).layer=this.node.layer),(t=e.getComponent(Ck))||(t=e.addComponent(Ck)),e.parent=this.node,this._textLabel=t}this._textLabel.node._uiProps.uiTransformComp.setAnchorPoint(0,1),t.overflow=Ck.Overflow.CLAMP,this._inputMode===Mmt.ANY?(t.verticalAlign=vk.TOP,t.enableWrapText=!0):t.enableWrapText=!1,t.string=this._updateLabelStringStyle(this._string)},n._updatePlaceholderLabel=function(){var t=this._placeholderLabel;if(!t){var e=this.node.getChildByName("PLACEHOLDER_LABEL");e||((e=new TE("PLACEHOLDER_LABEL")).layer=this.node.layer),(t=e.getComponent(Ck))||(t=e.addComponent(Ck)),e.parent=this.node,this._placeholderLabel=t}this._placeholderLabel.node._uiProps.uiTransformComp.setAnchorPoint(0,1),this._inputMode===Mmt.ANY?t.enableWrapText=!0:t.enableWrapText=!1,t.string=this.placeholder},n._syncSize=function(){var t=this.node._uiProps.uiTransformComp,e=t.contentSize;if(this._background){var n=this._background.node._uiProps.uiTransformComp;n.anchorPoint=t.anchorPoint,n.setContentSize(e)}this._updateLabelPosition(e),this._impl&&this._impl.setSize(e.width,e.height)},n._updateLabels=function(){if(this._isLabelVisible){var t=this._string;this._textLabel&&(this._textLabel.node.active=""!==t),this._placeholderLabel&&(this._placeholderLabel.node.active=""===t)}},n._updateString=function(t){var e=this._textLabel;if(e){var n=t;n&&(n=this._updateLabelStringStyle(n)),e.string=n,this._updateLabels()}},n._updateLabelStringStyle=function(t,e){void 0===e&&(e=!1);var n,i=this._inputFlag;if(e||i!==Omt.PASSWORD)i===Omt.INITIAL_CAPS_ALL_CHARACTERS?t=t.toUpperCase():i===Omt.INITIAL_CAPS_WORD?t=t.replace(/(?:^|\s)\S/g,(function(t){return t.toUpperCase()})):i===Omt.INITIAL_CAPS_SENTENCE&&(t=(n=t).charAt(0).toUpperCase()+n.slice(1));else{for(var r="",a=t.length,o=0;o<a;++o)r+="";t=r}return t},n._registerEvent=function(){this.node.on(bC.TOUCH_START,this._onTouchBegan,this),this.node.on(bC.TOUCH_END,this._onTouchEnded,this)},n._unregisterEvent=function(){this.node.off(bC.TOUCH_START,this._onTouchBegan,this),this.node.off(bC.TOUCH_END,this._onTouchEnded,this)},n._onBackgroundSpriteFrameChanged=function(){this._background&&(this.backgroundImage=this._background.spriteFrame)},n._registerBackgroundEvent=function(){var t=this._background&&this._background.node;null==t||t.on(tH.EventType.SPRITE_FRAME_CHANGED,this._onBackgroundSpriteFrameChanged,this)},n._unregisterBackgroundEvent=function(){var t=this._background&&this._background.node;null==t||t.off(tH.EventType.SPRITE_FRAME_CHANGED,this._onBackgroundSpriteFrameChanged,this)},n._updateLabelPosition=function(t){var e=this.node._uiProps.uiTransformComp,n=-e.anchorX*e.width,i=-e.anchorY*e.height,r=this._placeholderLabel,a=this._textLabel;a&&(a.node._uiProps.uiTransformComp.setContentSize(t.width-2,t.height),a.node.setPosition(n+2,i+t.height,a.node.position.z),this._inputMode===Mmt.ANY&&(a.verticalAlign=vk.TOP),a.enableWrapText=this._inputMode===Mmt.ANY),r&&(r.node._uiProps.uiTransformComp.setContentSize(t.width-2,t.height),r.lineHeight=t.height,r.node.setPosition(n+2,i+t.height,r.node.position.z),r.enableWrapText=this._inputMode===Mmt.ANY)},n._resizeChildNodes=function(){var t=this.node._uiProps.uiTransformComp,e=this._textLabel&&this._textLabel.node;e&&(e.setPosition(-t.width/2,t.height/2,e.position.z),e._uiProps.uiTransformComp.setContentSize(t.contentSize));var n=this._placeholderLabel&&this._placeholderLabel.node;n&&(n.setPosition(-t.width/2,t.height/2,n.position.z),n._uiProps.uiTransformComp.setContentSize(t.contentSize));var i=this._background&&this._background.node;i&&i._uiProps.uiTransformComp.setContentSize(t.contentSize),this._syncSize()},Q(e,[{key:"string",get:function(){return this._string},set:function(t){this._maxLength>=0&&t.length>=this._maxLength&&(t=t.slice(0,this._maxLength)),this._string!==t&&(this._string=t,this._updateString(t))}},{key:"placeholder",get:function(){return this._placeholderLabel?this._placeholderLabel.string:""},set:function(t){this._placeholderLabel&&(this._placeholderLabel.string=t)}},{key:"textLabel",get:function(){return this._textLabel},set:function(t){this._textLabel!==t&&(this._textLabel=t,this._textLabel&&(this._updateTextLabel(),this._updateLabels()))}},{key:"placeholderLabel",get:function(){return this._placeholderLabel},set:function(t){this._placeholderLabel!==t&&(this._placeholderLabel=t,this._placeholderLabel&&(this._updatePlaceholderLabel(),this._updateLabels()))}},{key:"backgroundImage",get:function(){return this._backgroundImage},set:function(t){this._backgroundImage!==t&&(this._backgroundImage=t,this._ensureBackgroundSprite(),this._background.spriteFrame=t)}},{key:"inputFlag",get:function(){return this._inputFlag},set:function(t){this._inputFlag!==t&&(this._inputFlag=t,this._updateString(this._string))}},{key:"inputMode",get:function(){return this._inputMode},set:function(t){this._inputMode!==t&&(this._inputMode=t,this._updateTextLabel(),this._updatePlaceholderLabel())}},{key:"returnType",get:function(){return this._returnType},set:function(t){this._returnType=t}},{key:"maxLength",get:function(){return this._maxLength},set:function(t){this._maxLength=t}},{key:"tabIndex",get:function(){return this._tabIndex},set:function(t){this._tabIndex!==t&&(this._tabIndex=t,this._impl&&this._impl.setTabIndex(t))}}]),e}(xu),zvt._EditBoxImpl=Gvt,zvt.KeyboardReturnType=Rmt,zvt.InputFlag=Omt,zvt.InputMode=Mmt,zvt.EventType=Uvt,lt((Tvt=kvt).prototype,"string",[kmt,Umt],Object.getOwnPropertyDescriptor(Tvt.prototype,"string"),Tvt.prototype),lt(Tvt.prototype,"placeholder",[Gmt,Hmt],Object.getOwnPropertyDescriptor(Tvt.prototype,"placeholder"),Tvt.prototype),lt(Tvt.prototype,"textLabel",[jmt,Wmt,qmt],Object.getOwnPropertyDescriptor(Tvt.prototype,"textLabel"),Tvt.prototype),lt(Tvt.prototype,"placeholderLabel",[Xmt,Ymt,Kmt],Object.getOwnPropertyDescriptor(Tvt.prototype,"placeholderLabel"),Tvt.prototype),lt(Tvt.prototype,"backgroundImage",[Jmt,Qmt,Zmt],Object.getOwnPropertyDescriptor(Tvt.prototype,"backgroundImage"),Tvt.prototype),lt(Tvt.prototype,"inputFlag",[$mt,tvt,evt],Object.getOwnPropertyDescriptor(Tvt.prototype,"inputFlag"),Tvt.prototype),lt(Tvt.prototype,"inputMode",[nvt,ivt,rvt],Object.getOwnPropertyDescriptor(Tvt.prototype,"inputMode"),Tvt.prototype),lt(Tvt.prototype,"returnType",[avt,ovt,svt],Object.getOwnPropertyDescriptor(Tvt.prototype,"returnType"),Tvt.prototype),lt(Tvt.prototype,"maxLength",[cvt,lvt],Object.getOwnPropertyDescriptor(Tvt.prototype,"maxLength"),Tvt.prototype),lt(Tvt.prototype,"tabIndex",[hvt,uvt],Object.getOwnPropertyDescriptor(Tvt.prototype,"tabIndex"),Tvt.prototype),Evt=lt(Tvt.prototype,"editingDidBegan",[_vt,Nc,fvt,dvt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),wvt=lt(Tvt.prototype,"textChanged",[pvt,Nc,mvt,vvt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ivt=lt(Tvt.prototype,"editingDidEnded",[gvt,Nc,yvt,xvt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Pvt=lt(Tvt.prototype,"editingReturn",[Svt,Nc,Avt,bvt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Dvt=lt(Tvt.prototype,"_textLabel",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Rvt=lt(Tvt.prototype,"_placeholderLabel",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Mvt=lt(Tvt.prototype,"_returnType",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Rmt.DEFAULT}}),Ovt=lt(Tvt.prototype,"_string",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Nvt=lt(Tvt.prototype,"_tabIndex",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Bvt=lt(Tvt.prototype,"_backgroundImage",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Lvt=lt(Tvt.prototype,"_inputFlag",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Omt.DEFAULT}}),Fvt=lt(Tvt.prototype,"_inputMode",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Mmt.ANY}}),Vvt=lt(Tvt.prototype,"_maxLength",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),Cvt=Tvt))||Cvt)||Cvt)||Cvt)||Cvt)||Cvt)||Cvt));h.internal.EditBox=eyt,function(t){t[t.NONE=0]="NONE",t[t.HORIZONTAL=1]="HORIZONTAL",t[t.VERTICAL=2]="VERTICAL",t[t.GRID=3]="GRID"}(Kgt||(Kgt={})),he(Kgt),function(t){t[t.NONE=0]="NONE",t[t.CONTAINER=1]="CONTAINER",t[t.CHILDREN=2]="CHILDREN"}(Jgt||(Jgt={})),he(Jgt),function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(Qgt||(Qgt={})),he(Qgt),function(t){t[t.BOTTOM_TO_TOP=0]="BOTTOM_TO_TOP",t[t.TOP_TO_BOTTOM=1]="TOP_TO_BOTTOM"}(Zgt||(Zgt={})),he(Zgt),function(t){t[t.LEFT_TO_RIGHT=0]="LEFT_TO_RIGHT",t[t.RIGHT_TO_LEFT=1]="RIGHT_TO_LEFT"}($gt||($gt={})),he($gt),function(t){t[t.NONE=0]="NONE",t[t.FIXED_ROW=1]="FIXED_ROW",t[t.FIXED_COL=2]="FIXED_COL"}(tyt||(tyt={})),he(tyt);var nyt,iyt,ryt,ayt,oyt,syt,cyt,lyt,hyt,uyt,_yt,fyt,dyt,pyt,myt,vyt,gyt,yyt,xyt,Syt,Ayt,byt,Cyt,Tyt=new Mn,Eyt=function(e){return t({Layout:e,LayoutComponent:e}),e}((Yvt=Ec("cc.Layout"),Kvt=jc(),Jvt=Ic(110),Qvt=kc(),Zvt=wc(LV),$vt=qc(),tgt=Kc(),egt=qc(),ngt=Kc(),igt=cl(Kgt),rgt=el(),agt=Kc(),ogt=cl(Jgt),sgt=qc(),cgt=Kc(),lgt=qc(),hgt=Kc(),ugt=cl(Qgt),_gt=Kc(),fgt=Kc(),dgt=Kc(),pgt=Kc(),mgt=Kc(),vgt=Kc(),ggt=Kc(),ygt=cl(Zgt),xgt=Kc(),Sgt=cl($gt),Agt=Kc(),bgt=cl(tyt),Cgt=qc(),Tgt=Kc(),Egt=qc(),wgt=Kc(),Igt=Kc(),Yvt(Pgt=Kvt(Pgt=Jvt(Pgt=Qvt(Pgt=Zvt(Pgt=zc((Ygt=Xgt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_resizeMode",Rgt,at(e)),ct(e,"_layoutType",Mgt,at(e)),ct(e,"_cellSize",Ogt,at(e)),ct(e,"_startAxis",Ngt,at(e)),ct(e,"_paddingLeft",Bgt,at(e)),ct(e,"_paddingRight",Lgt,at(e)),ct(e,"_paddingTop",Fgt,at(e)),ct(e,"_paddingBottom",Vgt,at(e)),ct(e,"_spacingX",zgt,at(e)),ct(e,"_spacingY",kgt,at(e)),ct(e,"_verticalDirection",Ugt,at(e)),ct(e,"_horizontalDirection",Ggt,at(e)),ct(e,"_constraint",Hgt,at(e)),ct(e,"_constraintNum",jgt,at(e)),ct(e,"_affectedByScale",Wgt,at(e)),ct(e,"_isAlign",qgt,at(e)),e._layoutSize=new ri(300,200),e._layoutDirty=!0,e._childrenDirty=!1,e._usefulLayoutObj=[],e._init=!1,e}$(e,t);var n=e.prototype;return n.updateLayout=function(t){void 0===t&&(t=!1),(this._layoutDirty||t)&&this.node.children.length>0&&(this._doLayout(),this._layoutDirty=!1)},n.onEnable=function(){this._addEventListeners();var t=this.node._uiProps.uiTransformComp;t.contentSize.equals(ri.ZERO)&&t.setContentSize(this._layoutSize),this._childrenChanged()},n.onDisable=function(){this._usefulLayoutObj.length=0,this._removeEventListeners()},n._checkUsefulObj=function(){this._usefulLayoutObj.length=0;for(var t=this.node.children,e=0;e<t.length;++e){var n=t[e],i=n._uiProps.uiTransformComp;n.activeInHierarchy&&i&&this._usefulLayoutObj.push(i)}},n._addEventListeners=function(){TO.on(CO.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.on(bC.SIZE_CHANGED,this._resized,this),this.node.on(bC.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.on(bC.CHILD_ADDED,this._childAdded,this),this.node.on(bC.CHILD_REMOVED,this._childRemoved,this),this.node.on(bC.SIBLING_ORDER_CHANGED,this._childrenChanged,this),this.node.on("childrenSiblingOrderChanged",this.updateLayout,this),this._addChildrenEventListeners()},n._removeEventListeners=function(){TO.off(CO.EVENT_AFTER_UPDATE,this.updateLayout,this),this.node.off(bC.SIZE_CHANGED,this._resized,this),this.node.off(bC.ANCHOR_CHANGED,this._doLayoutDirty,this),this.node.off(bC.CHILD_ADDED,this._childAdded,this),this.node.off(bC.CHILD_REMOVED,this._childRemoved,this),this.node.off(bC.SIBLING_ORDER_CHANGED,this._childrenChanged,this),this.node.off("childrenSiblingOrderChanged",this.updateLayout,this),this._removeChildrenEventListeners()},n._addChildrenEventListeners=function(){for(var t=this.node.children,e=0;e<t.length;++e){var n=t[e];n.on(bC.SIZE_CHANGED,this._doLayoutDirty,this),n.on(bC.TRANSFORM_CHANGED,this._transformDirty,this),n.on(bC.ANCHOR_CHANGED,this._doLayoutDirty,this),n.on(bC.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this)}},n._removeChildrenEventListeners=function(){for(var t=this.node.children,e=0;e<t.length;++e){var n=t[e];n.off(bC.SIZE_CHANGED,this._doLayoutDirty,this),n.off(bC.TRANSFORM_CHANGED,this._transformDirty,this),n.off(bC.ANCHOR_CHANGED,this._doLayoutDirty,this),n.off(bC.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this)}},n._childAdded=function(t){t.on(bC.SIZE_CHANGED,this._doLayoutDirty,this),t.on(bC.TRANSFORM_CHANGED,this._transformDirty,this),t.on(bC.ANCHOR_CHANGED,this._doLayoutDirty,this),t.on(bC.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this),this._childrenChanged()},n._childRemoved=function(t){t.off(bC.SIZE_CHANGED,this._doLayoutDirty,this),t.off(bC.TRANSFORM_CHANGED,this._transformDirty,this),t.off(bC.ANCHOR_CHANGED,this._doLayoutDirty,this),t.off(bC.ACTIVE_IN_HIERARCHY_CHANGED,this._childrenChanged,this),this._childrenChanged()},n._resized=function(){this._layoutSize.set(this.node._uiProps.uiTransformComp.contentSize),this._doLayoutDirty()},n._doLayoutHorizontally=function(t,e,n,i){var r=this.node._uiProps.uiTransformComp.anchorPoint,a=this._getFixedBreakingNum(),o=1,s=this._paddingLeft;this._horizontalDirection===$gt.RIGHT_TO_LEFT&&(o=-1,s=this._paddingRight);var c=(this._horizontalDirection-r.x)*t+o*s,l=c-o*this._spacingX,h=0,u=0,_=0,f=0,d=!1,p=this._usefulLayoutObj.length,m=this._cellSize.width,v=this._getPaddingH();this._layoutType!==Kgt.GRID&&this._resizeMode===Jgt.CHILDREN&&(m=(t-v-(p-1)*this._spacingX)/p);for(var g=this._usefulLayoutObj,y=0;y<g.length;++y){var x=g[y],S=x.node,A=S.scale,b=this._getUsedScaleValue(A.x),C=this._getUsedScaleValue(A.y);this._resizeMode===Jgt.CHILDREN&&(x.width=m/b,this._layoutType===Kgt.GRID&&(x.height=this._cellSize.height/C));var T=Math.abs(this._horizontalDirection-x.anchorX),E=x.width*b,w=x.height*C;w>_&&(f=Math.max(_,f),u=_||w,_=w),l+=o*(T*E+this._spacingX);var I=o*(1-T)*E;if(e){if(a>0)(d=y/a>0&&y%a==0)&&(u=_>w?_:u);else if(E>t-v)l>c+o*T*E&&(d=!0);else{var P=(1-this._horizontalDirection-r.x)*t,D=l+I+o*(o>0?this._paddingRight:this._paddingLeft);d=Math.abs(D)>Math.abs(P)}d&&(l=c+o*T*E,w!==_&&(u=_),h+=u+this._spacingY,u=_=w)}var R=n(S,x,h);i&&S.setPosition(l,R),l+=I}return u=Math.max(u,_),Math.max(f,h+u)+this._getPaddingV()},n._doLayoutVertically=function(t,e,n,i){var r=this.node._uiProps.uiTransformComp.anchorPoint,a=this._getFixedBreakingNum(),o=1,s=this._paddingBottom;this._verticalDirection===Zgt.TOP_TO_BOTTOM&&(o=-1,s=this._paddingTop);var c=(this._verticalDirection-r.y)*t+o*s,l=c-o*this._spacingY,h=0,u=0,_=0,f=0,d=!1,p=this._usefulLayoutObj.length,m=this._cellSize.height,v=this._getPaddingV();this._layoutType!==Kgt.GRID&&this._resizeMode===Jgt.CHILDREN&&(m=(t-v-(p-1)*this._spacingY)/p);for(var g=this._usefulLayoutObj,y=0;y<g.length;++y){var x=g[y],S=x.node,A=S.scale,b=this._getUsedScaleValue(A.x),C=this._getUsedScaleValue(A.y);this._resizeMode===Jgt.CHILDREN&&(x.height=m/C,this._layoutType===Kgt.GRID&&(x.width=this._cellSize.width/b));var T=Math.abs(this._verticalDirection-x.anchorY),E=x.width*b,w=x.height*C;E>h&&(u=Math.max(h,u),_=h||E,h=E),l+=o*(T*w+this._spacingY);var I=o*(1-T)*w;if(e){if(a>0)(d=y/a>0&&y%a==0)&&(_=h>w?h:_);else if(w>t-v)l>c+o*T*w&&(d=!0);else{var P=(1-this._verticalDirection-r.y)*t,D=l+I+o*(o>0?this._paddingTop:this._paddingBottom);d=Math.abs(D)>Math.abs(P)}d&&(l=c+o*T*w,E!==h&&(_=h),f+=_+this._spacingX,_=h=E)}var R=n(S,x,f);i&&(S.getPosition(Tyt),S.setPosition(R,l,Tyt.z)),l+=I}return _=Math.max(_,h),Math.max(u,f+_)+this._getPaddingH()},n._doLayoutGridAxisHorizontal=function(t,e){var n=this,i=e.width,r=1,a=-t.y*e.height,o=this._paddingBottom;this._verticalDirection===Zgt.TOP_TO_BOTTOM&&(r=-1,a=(1-t.y)*e.height,o=this._paddingTop);var s=function(t,e,i){return a+r*(i+(1-e.anchorY)*e.height*n._getUsedScaleValue(t.scale.y)+o)},c=0;this._resizeMode===Jgt.CONTAINER&&(c=this._doLayoutHorizontally(i,!0,s,!1),a=-t.y*c,this._verticalDirection===Zgt.TOP_TO_BOTTOM&&(r=-1,a=(1-t.y)*c)),this._doLayoutHorizontally(i,!0,s,!0),this._resizeMode===Jgt.CONTAINER&&this.node._uiProps.uiTransformComp.setContentSize(i,c)},n._doLayoutGridAxisVertical=function(t,e){var n=this,i=e.height,r=1,a=-t.x*e.width,o=this._paddingLeft;this._horizontalDirection===$gt.RIGHT_TO_LEFT&&(r=-1,a=(1-t.x)*e.width,o=this._paddingRight);var s=function(t,e,i){return a+r*(i+(1-e.anchorX)*e.width*n._getUsedScaleValue(t.scale.x)+o)},c=0;this._resizeMode===Jgt.CONTAINER&&(c=this._doLayoutVertically(i,!0,s,!1),a=-t.x*c,this._horizontalDirection===$gt.RIGHT_TO_LEFT&&(r=-1,a=(1-t.x)*c)),this._doLayoutVertically(i,!0,s,!0),this._resizeMode===Jgt.CONTAINER&&this.node._uiProps.uiTransformComp.setContentSize(c,i)},n._doLayoutGrid=function(){var t=this.node._uiProps.uiTransformComp,e=t.anchorPoint,n=t.contentSize;this.startAxis===Qgt.HORIZONTAL?this._doLayoutGridAxisHorizontal(e,n):this.startAxis===Qgt.VERTICAL&&this._doLayoutGridAxisVertical(e,n)},n._getHorizontalBaseWidth=function(){var t=this._usefulLayoutObj,e=0,n=t.length;if(this._resizeMode===Jgt.CONTAINER){for(var i=0;i<t.length;++i){var r=t[i],a=r.node.scale;e+=r.width*this._getUsedScaleValue(a.x)}e+=(n-1)*this._spacingX+this._getPaddingH()}else e=this.node._uiProps.uiTransformComp.width;return e},n._getVerticalBaseHeight=function(){var t=this._usefulLayoutObj,e=0,n=t.length;if(this._resizeMode===Jgt.CONTAINER){for(var i=0;i<t.length;++i){var r=t[i],a=r.node.scale;e+=r.height*this._getUsedScaleValue(a.y)}e+=(n-1)*this._spacingY+this._getPaddingV()}else e=this.node._uiProps.uiTransformComp.height;return e},n._doLayout=function(){var t=this;if(this._init&&!this._childrenDirty||(this._checkUsefulObj(),this._init=!0,this._childrenDirty=!1),this._layoutType===Kgt.HORIZONTAL){var e=this._getHorizontalBaseWidth();this._doLayoutHorizontally(e,!1,(function(e){return(t._isAlign?Mn.ZERO:e.position).y}),!0),this.node._uiProps.uiTransformComp.width=e}else if(this._layoutType===Kgt.VERTICAL){var n=this._getVerticalBaseHeight();this._doLayoutVertically(n,!1,(function(e){return(t._isAlign?Mn.ZERO:e.position).x}),!0),this.node._uiProps.uiTransformComp.height=n}else this._layoutType===Kgt.GRID&&this._doLayoutGrid()},n._getUsedScaleValue=function(t){return this._affectedByScale?Math.abs(t):1},n._transformDirty=function(t){t&Fy.SCALE&&t&Fy.POSITION&&this._affectedByScale&&this._doLayoutDirty()},n._doLayoutDirty=function(){this._layoutDirty=!0},n._childrenChanged=function(){this._childrenDirty=!0,this._doLayoutDirty()},n._getPaddingH=function(){return this._paddingLeft+this._paddingRight},n._getPaddingV=function(){return this._paddingTop+this._paddingBottom},n._getFixedBreakingNum=function(){if(this._layoutType!==Kgt.GRID||this._constraint===tyt.NONE||this._constraintNum<=0)return 0;var t=this._constraint===tyt.FIXED_ROW?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum;return this._startAxis===Qgt.VERTICAL&&(t=this._constraint===tyt.FIXED_COL?Math.ceil(this._usefulLayoutObj.length/this._constraintNum):this._constraintNum),t},Q(e,[{key:"alignHorizontal",get:function(){return this._isAlign},set:function(t){this._layoutType===Kgt.HORIZONTAL&&(this._isAlign=t,this._doLayoutDirty())}},{key:"alignVertical",get:function(){return this._isAlign},set:function(t){this._layoutType===Kgt.VERTICAL&&(this._isAlign=t,this._doLayoutDirty())}},{key:"type",get:function(){return this._layoutType},set:function(t){this._layoutType=t,this._doLayoutDirty()}},{key:"resizeMode",get:function(){return this._resizeMode},set:function(t){this._layoutType!==Kgt.NONE&&(this._resizeMode=t,this._doLayoutDirty())}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize.set(t),this._doLayoutDirty())}},{key:"startAxis",get:function(){return this._startAxis},set:function(t){this._startAxis!==t&&(this._startAxis=t,this._doLayoutDirty())}},{key:"paddingLeft",get:function(){return this._paddingLeft},set:function(t){this._paddingLeft!==t&&(this._paddingLeft=t,this._doLayoutDirty())}},{key:"paddingRight",get:function(){return this._paddingRight},set:function(t){this._paddingRight!==t&&(this._paddingRight=t,this._doLayoutDirty())}},{key:"paddingTop",get:function(){return this._paddingTop},set:function(t){this._paddingTop!==t&&(this._paddingTop=t,this._doLayoutDirty())}},{key:"paddingBottom",get:function(){return this._paddingBottom},set:function(t){this._paddingBottom!==t&&(this._paddingBottom=t,this._doLayoutDirty())}},{key:"spacingX",get:function(){return this._spacingX},set:function(t){this._spacingX!==t&&(this._spacingX=t,this._doLayoutDirty())}},{key:"spacingY",get:function(){return this._spacingY},set:function(t){this._spacingY!==t&&(this._spacingY=t,this._doLayoutDirty())}},{key:"verticalDirection",get:function(){return this._verticalDirection},set:function(t){this._verticalDirection!==t&&(this._verticalDirection=t,this._doLayoutDirty())}},{key:"horizontalDirection",get:function(){return this._horizontalDirection},set:function(t){this._horizontalDirection!==t&&(this._horizontalDirection=t,this._doLayoutDirty())}},{key:"padding",get:function(){return this._paddingLeft},set:function(t){this.paddingLeft===t&&this._paddingRight===t&&this._paddingTop===t&&this._paddingBottom===t||(this._paddingLeft=this._paddingRight=this._paddingTop=this._paddingBottom=t,this._doLayoutDirty())}},{key:"constraint",get:function(){return this._constraint},set:function(t){this._layoutType!==Kgt.NONE&&this._constraint!==t&&(this._constraint=t,this._doLayoutDirty())}},{key:"constraintNum",get:function(){return this._constraintNum},set:function(t){this._constraint!==tyt.NONE&&this._constraintNum!==t&&(t<=0&&S("Limit values to be greater than 0"),this._constraintNum=t,this._doLayoutDirty())}},{key:"affectedByScale",get:function(){return this._affectedByScale},set:function(t){this._affectedByScale=t,this._doLayoutDirty()}}]),e}(xu),Xgt.Type=Kgt,Xgt.VerticalDirection=Zgt,Xgt.HorizontalDirection=$gt,Xgt.ResizeMode=Jgt,Xgt.AxisDirection=Qgt,Xgt.Constraint=tyt,lt((Dgt=Ygt).prototype,"alignHorizontal",[$vt,tgt],Object.getOwnPropertyDescriptor(Dgt.prototype,"alignHorizontal"),Dgt.prototype),lt(Dgt.prototype,"alignVertical",[egt,ngt],Object.getOwnPropertyDescriptor(Dgt.prototype,"alignVertical"),Dgt.prototype),lt(Dgt.prototype,"type",[igt,rgt,agt],Object.getOwnPropertyDescriptor(Dgt.prototype,"type"),Dgt.prototype),lt(Dgt.prototype,"resizeMode",[ogt,sgt,cgt],Object.getOwnPropertyDescriptor(Dgt.prototype,"resizeMode"),Dgt.prototype),lt(Dgt.prototype,"cellSize",[lgt,hgt],Object.getOwnPropertyDescriptor(Dgt.prototype,"cellSize"),Dgt.prototype),lt(Dgt.prototype,"startAxis",[ugt,_gt],Object.getOwnPropertyDescriptor(Dgt.prototype,"startAxis"),Dgt.prototype),lt(Dgt.prototype,"paddingLeft",[fgt],Object.getOwnPropertyDescriptor(Dgt.prototype,"paddingLeft"),Dgt.prototype),lt(Dgt.prototype,"paddingRight",[dgt],Object.getOwnPropertyDescriptor(Dgt.prototype,"paddingRight"),Dgt.prototype),lt(Dgt.prototype,"paddingTop",[pgt],Object.getOwnPropertyDescriptor(Dgt.prototype,"paddingTop"),Dgt.prototype),lt(Dgt.prototype,"paddingBottom",[mgt],Object.getOwnPropertyDescriptor(Dgt.prototype,"paddingBottom"),Dgt.prototype),lt(Dgt.prototype,"spacingX",[vgt],Object.getOwnPropertyDescriptor(Dgt.prototype,"spacingX"),Dgt.prototype),lt(Dgt.prototype,"spacingY",[ggt],Object.getOwnPropertyDescriptor(Dgt.prototype,"spacingY"),Dgt.prototype),lt(Dgt.prototype,"verticalDirection",[ygt,xgt],Object.getOwnPropertyDescriptor(Dgt.prototype,"verticalDirection"),Dgt.prototype),lt(Dgt.prototype,"horizontalDirection",[Sgt,Agt],Object.getOwnPropertyDescriptor(Dgt.prototype,"horizontalDirection"),Dgt.prototype),lt(Dgt.prototype,"constraint",[bgt,Cgt,Tgt],Object.getOwnPropertyDescriptor(Dgt.prototype,"constraint"),Dgt.prototype),lt(Dgt.prototype,"constraintNum",[Egt,wgt],Object.getOwnPropertyDescriptor(Dgt.prototype,"constraintNum"),Dgt.prototype),lt(Dgt.prototype,"affectedByScale",[Igt],Object.getOwnPropertyDescriptor(Dgt.prototype,"affectedByScale"),Dgt.prototype),Rgt=lt(Dgt.prototype,"_resizeMode",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Jgt.NONE}}),Mgt=lt(Dgt.prototype,"_layoutType",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Kgt.NONE}}),Ogt=lt(Dgt.prototype,"_cellSize",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ri(40,40)}}),Ngt=lt(Dgt.prototype,"_startAxis",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Qgt.HORIZONTAL}}),Bgt=lt(Dgt.prototype,"_paddingLeft",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Lgt=lt(Dgt.prototype,"_paddingRight",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Fgt=lt(Dgt.prototype,"_paddingTop",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Vgt=lt(Dgt.prototype,"_paddingBottom",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),zgt=lt(Dgt.prototype,"_spacingX",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),kgt=lt(Dgt.prototype,"_spacingY",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ugt=lt(Dgt.prototype,"_verticalDirection",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Zgt.TOP_TO_BOTTOM}}),Ggt=lt(Dgt.prototype,"_horizontalDirection",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return $gt.LEFT_TO_RIGHT}}),Hgt=lt(Dgt.prototype,"_constraint",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return tyt.NONE}}),jgt=lt(Dgt.prototype,"_constraintNum",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),Wgt=lt(Dgt.prototype,"_affectedByScale",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),qgt=lt(Dgt.prototype,"_isAlign",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Pgt=Dgt))||Pgt)||Pgt)||Pgt)||Pgt)||Pgt)||Pgt));h.Layout=Eyt,function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t[t.FILLED=2]="FILLED"}(Cyt||(Cyt={})),se(Cyt);var wyt,Iyt,Pyt,Dyt,Ryt,Myt,Oyt,Nyt,Byt,Lyt,Fyt,Vyt,zyt,kyt,Uyt,Gyt,Hyt,jyt,Wyt,qyt,Xyt,Yyt,Kyt,Jyt,Qyt=function(e){return t({ProgressBar:e,ProgressBarComponent:e}),e}((nyt=Ec("cc.ProgressBar"),iyt=jc(),ryt=Ic(110),ayt=kc(),oyt=wc(LV),syt=cl(tH),cyt=Kc(),lyt=cl(Cyt),hyt=Kc(),uyt=Kc(),_yt=Jc(),fyt=Kc(),dyt=Kc(),nyt(pyt=iyt(pyt=ryt(pyt=ayt(pyt=oyt((byt=Ayt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_barSprite",vyt,at(e)),ct(e,"_mode",gyt,at(e)),ct(e,"_totalLength",yyt,at(e)),ct(e,"_progress",xyt,at(e)),ct(e,"_reverse",Syt,at(e)),e}$(e,t);var n=e.prototype;return n._initBarSprite=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var e=this.node._uiProps.uiTransformComp,n=e.contentSize,i=e.anchorPoint,r=t._uiProps.uiTransformComp.contentSize;if(this._barSprite.fillType===tH.FillType.RADIAL&&(this._mode=Cyt.FILLED),this._mode===Cyt.HORIZONTAL?this.totalLength=r.width:this._mode===Cyt.VERTICAL?this.totalLength=r.height:this.totalLength=this._barSprite.fillRange,t.parent===this.node){var a=-n.width*i.x;t.setPosition(a,0,0)}}},n._updateBarStatus=function(){if(this._barSprite){var t=this._barSprite.node;if(!t)return;var e=t._uiProps.uiTransformComp,n=e.anchorPoint,i=e.contentSize,r=t.getPosition(),a=new Qn(0,.5),o=_n(this._progress),s=this._totalLength*o,c=i,l=0,h=0;switch(this._mode){case Cyt.HORIZONTAL:this._reverse&&(a=new Qn(1,.5)),c=new ri(s,i.height),l=this._totalLength,h=i.height;break;case Cyt.VERTICAL:a=this._reverse?new Qn(.5,1):new Qn(.5,0),c=new ri(i.width,s),l=i.width,h=this._totalLength}if(this._mode===Cyt.FILLED)this._barSprite.type!==tH.Type.FILLED?S("ProgressBar FILLED mode only works when barSprite's Type is FILLED!"):(this._reverse&&(s*=-1),this._barSprite.fillRange=s);else if(this._barSprite.type!==tH.Type.FILLED){var u=a.x-n.x,_=a.y-n.y,f=new Mn(l*u,h*_,0);t.setPosition(r.x+f.x,r.y+f.y,r.z),e.setAnchorPoint(a),e.setContentSize(c)}else S("ProgressBar non-FILLED mode only works when barSprite's Type is non-FILLED!")}},Q(e,[{key:"barSprite",get:function(){return this._barSprite},set:function(t){this._barSprite!==t&&(this._barSprite=t,this._initBarSprite())}},{key:"mode",get:function(){return this._mode},set:function(t){if(this._mode!==t&&(this._mode=t,this._barSprite)){var e=this._barSprite.node;if(!e)return;var n=e._uiProps.uiTransformComp.contentSize;this._mode===Cyt.HORIZONTAL?this.totalLength=n.width:this._mode===Cyt.VERTICAL?this.totalLength=n.height:this._mode===Cyt.FILLED&&(this.totalLength=this._barSprite.fillRange)}}},{key:"totalLength",get:function(){return this._totalLength},set:function(t){this._mode===Cyt.FILLED&&(t=_n(t)),this._totalLength!==t&&(this._totalLength=t,this._updateBarStatus())}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateBarStatus())}},{key:"reverse",get:function(){return this._reverse},set:function(t){this._reverse!==t&&(this._reverse=t,this._barSprite&&(this._barSprite.fillStart=1-this._barSprite.fillStart),this._updateBarStatus())}}]),e}(xu),Ayt.Mode=Cyt,lt((myt=byt).prototype,"barSprite",[syt,cyt],Object.getOwnPropertyDescriptor(myt.prototype,"barSprite"),myt.prototype),lt(myt.prototype,"mode",[lyt,hyt],Object.getOwnPropertyDescriptor(myt.prototype,"mode"),myt.prototype),lt(myt.prototype,"totalLength",[uyt],Object.getOwnPropertyDescriptor(myt.prototype,"totalLength"),myt.prototype),lt(myt.prototype,"progress",[_yt,tl,fyt],Object.getOwnPropertyDescriptor(myt.prototype,"progress"),myt.prototype),lt(myt.prototype,"reverse",[dyt],Object.getOwnPropertyDescriptor(myt.prototype,"reverse"),myt.prototype),vyt=lt(myt.prototype,"_barSprite",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gyt=lt(myt.prototype,"_mode",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Cyt.HORIZONTAL}}),yyt=lt(myt.prototype,"_totalLength",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),xyt=lt(myt.prototype,"_progress",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),Syt=lt(myt.prototype,"_reverse",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),pyt=myt))||pyt)||pyt)||pyt)||pyt)||pyt));h.ProgressBar=Qyt;var Zyt,$yt=new Mn,txt=new Mn,ext=new Mn,nxt=new Qn,ixt=new Dn,rxt=new Qn;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(Zyt||(Zyt={})),he(Zyt);var axt,oxt=function(e){return t({ScrollBar:e,ScrollBarComponent:e}),e}((wyt=Ec("cc.ScrollBar"),Iyt=jc(),Pyt=Ic(110),Dyt=kc(),Ryt=wc(LV),Myt=cl(tH),Oyt=el(),Nyt=Kc(),Byt=cl(Zyt),Lyt=el(),Fyt=Kc(),Vyt=el(),zyt=Kc(),kyt=el(),Uyt=Kc(),wyt(Gyt=Iyt(Gyt=Pyt(Gyt=Dyt(Gyt=Ryt((Jyt=Kyt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_scrollView",jyt,at(e)),ct(e,"_handle",Wyt,at(e)),ct(e,"_direction",qyt,at(e)),ct(e,"_enableAutoHide",Xyt,at(e)),ct(e,"_autoHideTime",Yyt,at(e)),e._touching=!1,e._opacity=255,e._autoHideRemainingTime=0,e}$(e,t);var n=e.prototype;return n.hide=function(){this._autoHideRemainingTime=0,this._setOpacity(0)},n.show=function(){this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity)},n.onScroll=function(t){if(this._scrollView){var e=this._scrollView.content;if(e){var n=e._uiProps.uiTransformComp.contentSize,i=this._scrollView.node._uiProps.uiTransformComp.contentSize,r=this.node._uiProps.uiTransformComp.contentSize;if(!this._conditionalDisableScrollBar(n,i)){this._enableAutoHide&&(this._autoHideRemainingTime=this._autoHideTime,this._setOpacity(this._opacity));var a=0,o=0,s=0,c=0,l=0,h=rxt;h.set(0,0),this._direction===Zyt.HORIZONTAL?(a=n.width,o=i.width,l=r.width,s=t.x,this._convertToScrollViewSpace(h,e),c=-h.x):this._direction===Zyt.VERTICAL&&(a=n.height,o=i.height,l=r.height,s=t.y,this._convertToScrollViewSpace(h,e),c=-h.y);var u=this._calculateLength(a,o,l,s),_=rxt;this._calculatePosition(_,a,o,l,c,s,u),this._updateLength(u),this._updateHandlerPosition(_)}}}},n.setScrollView=function(t){this._scrollView=t},n.onTouchBegan=function(){this._enableAutoHide&&(this._touching=!0)},n.onTouchEnded=function(){if(this._enableAutoHide&&(this._touching=!1,!(this._autoHideTime<=0))){if(this._scrollView){var t=this._scrollView.content;if(t){var e=t._uiProps.uiTransformComp.contentSize,n=this._scrollView.node._uiProps.uiTransformComp.contentSize;if(this._conditionalDisableScrollBar(e,n))return}}this._autoHideRemainingTime=this._autoHideTime}},n.onEnable=function(){var t=this.node.getComponent(tH);t&&(this._opacity=t.color.a)},n.start=function(){this._enableAutoHide&&this._setOpacity(0)},n.update=function(t){this._processAutoHide(t)},n._convertToScrollViewSpace=function(t,e){var n=this._scrollView&&this._scrollView.node._uiProps.uiTransformComp,i=e._uiProps.uiTransformComp;if(n&&i){$yt.set(-i.anchorX*i.width,-i.anchorY*i.height,0),i.convertToWorldSpaceAR($yt,txt);var r=n.convertToNodeSpaceAR(txt);r.x+=n.anchorX*n.width,r.y+=n.anchorY*n.height,t.set(r.x,r.y)}else t.set(Qn.ZERO)},n._setOpacity=function(t){if(this._handle){var e=this.node.getComponent(tH);e&&(ixt.set(e.color),ixt.a=t,e.color=ixt),(e=this._handle.getComponent(tH))&&(ixt.set(e.color),ixt.a=t,e.color=ixt)}},n._updateHandlerPosition=function(t){if(this._handle){var e=ext;this._fixupHandlerPosition(e),this._handle.node.setPosition(t.x+e.x,t.y+e.y,e.z)}},n._fixupHandlerPosition=function(t){var e=this.node._uiProps.uiTransformComp,n=e.contentSize,i=e.anchorPoint,r=this.handle.node._uiProps.uiTransformComp.contentSize,a=this.handle.node.parent;Mn.set($yt,-n.width*i.x,-n.height*i.y,0);var o=this.node._uiProps.uiTransformComp.convertToWorldSpaceAR($yt,txt),s=t;s.set(0,0,0),a._uiProps.uiTransformComp.convertToNodeSpaceAR(o,s),this.direction===Zyt.HORIZONTAL?s.set(s.x,s.y+(n.height-r.height)/2,s.z):this.direction===Zyt.VERTICAL&&s.set(s.x+(n.width-r.width)/2,s.y,s.z),this.handle.node.setPosition(s)},n._conditionalDisableScrollBar=function(t,e){return t.width<=e.width&&this._direction===Zyt.HORIZONTAL||t.height<=e.height&&this._direction===Zyt.VERTICAL},n._calculateLength=function(t,e,n,i){var r=t;return i&&(r+=20*(i>0?i:-i)),n*(e/r)},n._calculatePosition=function(t,e,n,i,r,a,o){var s=e-n;a&&(s+=Math.abs(a));var c=0;s&&(c=_n(c=r/s));var l=(i-o)*c;this._direction===Zyt.VERTICAL?t.set(0,l):t.set(l,0)},n._updateLength=function(t){if(this._handle){var e=this._handle.node._uiProps.uiTransformComp,n=e.contentSize,i=e.anchorPoint;i.x===nxt.x&&i.y===nxt.y||e.setAnchorPoint(nxt),this._direction===Zyt.HORIZONTAL?e.setContentSize(t,n.height):e.setContentSize(n.width,t)}},n._processAutoHide=function(t){if(this._enableAutoHide&&!(this._autoHideRemainingTime<=0)&&!this._touching&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this._autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var e=this._opacity*(this._autoHideRemainingTime/this._autoHideTime);this._setOpacity(e)}},Q(e,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t,this.onScroll(Qn.ZERO))}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this.onScroll(Qn.ZERO))}},{key:"enableAutoHide",get:function(){return this._enableAutoHide},set:function(t){this._enableAutoHide!==t&&(this._enableAutoHide=t,this._enableAutoHide&&this._setOpacity(0))}},{key:"autoHideTime",get:function(){return this._autoHideTime},set:function(t){this._autoHideTime!==t&&(this._autoHideTime=t)}}]),e}(xu),Kyt.Direction=Zyt,lt((Hyt=Jyt).prototype,"handle",[Myt,Oyt,Nyt],Object.getOwnPropertyDescriptor(Hyt.prototype,"handle"),Hyt.prototype),lt(Hyt.prototype,"direction",[Byt,Lyt,Fyt],Object.getOwnPropertyDescriptor(Hyt.prototype,"direction"),Hyt.prototype),lt(Hyt.prototype,"enableAutoHide",[Vyt,zyt],Object.getOwnPropertyDescriptor(Hyt.prototype,"enableAutoHide"),Hyt.prototype),lt(Hyt.prototype,"autoHideTime",[kyt,Uyt],Object.getOwnPropertyDescriptor(Hyt.prototype,"autoHideTime"),Hyt.prototype),jyt=lt(Hyt.prototype,"_scrollView",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wyt=lt(Hyt.prototype,"_handle",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qyt=lt(Hyt.prototype,"_direction",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Zyt.HORIZONTAL}}),Xyt=lt(Hyt.prototype,"_enableAutoHide",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Yyt=lt(Hyt.prototype,"_autoHideTime",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Gyt=Hyt))||Gyt)||Gyt)||Gyt)||Gyt)||Gyt));h.ScrollBar=oxt;var sxt,cxt,lxt,hxt,uxt,_xt,fxt,dxt,pxt,mxt,vxt,gxt,yxt,xxt,Sxt,Axt,bxt,Cxt,Txt,Ext,wxt,Ixt,Pxt,Dxt,Rxt,Mxt,Oxt,Nxt,Bxt,Lxt,Fxt,Vxt,zxt,kxt,Uxt,Gxt,Hxt,jxt,Wxt,qxt,Xxt,Yxt,Kxt,Jxt,Qxt,Zxt,$xt,tSt,eSt=t("ViewGroup",Ec("cc.ViewGroup")(axt=Ic(110)(axt=function(t){function e(){return t.apply(this,arguments)||this}return $(e,t),e}(xu))||axt)||axt);h.ViewGroup=eSt;var nSt,iSt=1e-4,rSt=new Mn,aSt=new Mn,oSt=new Qn,sSt=new Qn,cSt=function(){return(new Date).getMilliseconds()},lSt={"scroll-to-top":0,"scroll-to-bottom":1,"scroll-to-left":2,"scroll-to-right":3,scrolling:4,"bounce-bottom":6,"bounce-left":7,"bounce-right":8,"bounce-top":5,"scroll-ended":9,"touch-up":10,"scroll-ended-with-threshold":11,"scroll-began":12};!function(t){t.SCROLL_TO_TOP="scroll-to-top",t.SCROLL_TO_BOTTOM="scroll-to-bottom",t.SCROLL_TO_LEFT="scroll-to-left",t.SCROLL_TO_RIGHT="scroll-to-right",t.SCROLL_BEGAN="scroll-began",t.SCROLL_ENDED="scroll-ended",t.BOUNCE_TOP="bounce-top",t.BOUNCE_BOTTOM="bounce-bottom",t.BOUNCE_LEFT="bounce-left",t.BOUNCE_RIGHT="bounce-right",t.SCROLLING="scrolling",t.SCROLL_ENG_WITH_THRESHOLD="scroll-ended-with-threshold",t.TOUCH_UP="touch-up"}(nSt||(nSt={}));var hSt,uSt,_St,fSt,dSt,pSt,mSt,vSt,gSt,ySt,xSt,SSt,ASt,bSt,CSt,TSt,ESt,wSt,ISt,PSt,DSt,RSt=function(e){return t({ScrollView:e,ScrollViewComponent:e}),e}((sxt=Ec("cc.ScrollView"),cxt=jc(),lxt=Ic(110),hxt=kc(),uxt=wc(LV),_xt=Jc(),fxt=el(),dxt=Kc(),pxt=Jc(),mxt=el(),vxt=Kc(),gxt=el(),yxt=Kc(),xxt=el(),Sxt=Kc(),Axt=cl(TE),bxt=el(),Cxt=Kc(),Txt=el(),Ext=Kc(),wxt=cl(oxt),Ixt=el(),Pxt=Kc(),Dxt=el(),Rxt=Kc(),Mxt=cl(oxt),Oxt=el(),Nxt=Kc(),Bxt=el(),Lxt=Kc(),Fxt=cl([CL]),Vxt=el(),zxt=Kc(),sxt(kxt=cxt(kxt=lxt(kxt=hxt(kxt=uxt((tSt=$xt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"bounceDuration",Gxt,at(e)),ct(e,"brake",Hxt,at(e)),ct(e,"elastic",jxt,at(e)),ct(e,"inertia",Wxt,at(e)),ct(e,"horizontal",qxt,at(e)),ct(e,"vertical",Xxt,at(e)),ct(e,"cancelInnerEvents",Yxt,at(e)),ct(e,"scrollEvents",Kxt,at(e)),e._autoScrolling=!1,e._scrolling=!1,ct(e,"_content",Jxt,at(e)),ct(e,"_horizontalScrollBar",Qxt,at(e)),ct(e,"_verticalScrollBar",Zxt,at(e)),e._topBoundary=0,e._bottomBoundary=0,e._leftBoundary=0,e._rightBoundary=0,e._touchMoveDisplacements=[],e._touchMoveTimeDeltas=[],e._touchMovePreviousTimestamp=0,e._touchMoved=!1,e._autoScrollAttenuate=!1,e._autoScrollStartPosition=new Mn,e._autoScrollTargetDelta=new Mn,e._autoScrollTotalTime=0,e._autoScrollAccumulatedTime=0,e._autoScrollCurrentlyOutOfBoundary=!1,e._autoScrollBraking=!1,e._autoScrollBrakingStartPosition=new Mn,e._outOfBoundaryAmount=new Mn,e._outOfBoundaryAmountDirty=!0,e._stopMouseWheel=!1,e._mouseWheelEventElapsedTime=0,e._isScrollEndedWithThresholdEventFired=!1,e._scrollEventEmitMask=0,e._isBouncing=!1,e._contentPos=new Mn,e._deltaPos=new Mn,e}$(e,t);var n=e.prototype;return n.scrollToBottom=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Qn(0,0),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n,!0)},n.scrollToTop=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Qn(0,1),applyToHorizontal:!1,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToLeft=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Qn(0,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToRight=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Qn(1,0),applyToHorizontal:!0,applyToVertical:!1});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToTopLeft=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Qn(0,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToTopRight=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Qn(1,1),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToBottomLeft=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Qn(0,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToBottomRight=function(t,e){void 0===e&&(e=!0);var n=this._calculateMovePercentDelta({anchor:new Qn(1,0),applyToHorizontal:!0,applyToVertical:!0});t?this._startAutoScroll(n,t,!1!==e):this._moveContent(n)},n.scrollToOffset=function(t,e,n){void 0===n&&(n=!0);var i=this.getMaxScrollOffset(),r=new Qn(0,0);0===i.x?r.x=0:r.x=t.x/i.x,0===i.y?r.y=1:r.y=(i.y-t.y)/i.y,this.scrollTo(r,e,n)},n.getScrollOffset=function(){var t=this._getContentTopBoundary()-this._topBoundary,e=this._getContentLeftBoundary()-this._leftBoundary;return new Qn(e,t)},n.getMaxScrollOffset=function(){if(!this._content||!this.view)return Qn.ZERO;var t=this._content._uiProps.uiTransformComp.contentSize,e=t.width-this.view.width,n=t.height-this.view.height;return new Qn(e=e>=0?e:0,n=n>=0?n:0)},n.scrollToPercentHorizontal=function(t,e,n){var i=this._calculateMovePercentDelta({anchor:new Qn(t,0),applyToHorizontal:!0,applyToVertical:!1});e?this._startAutoScroll(i,e,!1!==n):this._moveContent(i)},n.scrollTo=function(t,e,n){var i=this._calculateMovePercentDelta({anchor:new Qn(t),applyToHorizontal:!0,applyToVertical:!0});e?this._startAutoScroll(i,e,n):this._moveContent(i)},n.scrollToPercentVertical=function(t,e,n){var i=this._calculateMovePercentDelta({anchor:new Qn(0,t),applyToHorizontal:!1,applyToVertical:!0});e?this._startAutoScroll(i,e,n):this._moveContent(i)},n.stopAutoScroll=function(){this._autoScrolling=!1,this._autoScrollAccumulatedTime=this._autoScrollTotalTime},n.setContentPosition=function(t){this._setContentPosition(t)},n._setContentPosition=function(t){if(this._content){var e=this._getContentPosition();Math.abs(t.x-e.x)<iSt&&Math.abs(t.y-e.y)<iSt||(this._content.setPosition(t),this._outOfBoundaryAmountDirty=!0)}},n.getContentPosition=function(){return this._getContentPosition()},n._getContentPosition=function(){return this._content?(this._contentPos.set(this._content.position),this._contentPos):Mn.ZERO.clone()},n.isScrolling=function(){return this._scrolling},n.isAutoScrolling=function(){return this._autoScrolling},n.getScrollEndedEventTiming=function(){return iSt},n.start=function(){this._calculateBoundary(),this._content&&TO.once(CO.EVENT_BEFORE_DRAW,this._adjustContentOutOfBoundary,this)},n.onEnable=function(){this._registerEvent(),this._content&&(this._content.on(bC.SIZE_CHANGED,this._calculateBoundary,this),this._content.on(bC.TRANSFORM_CHANGED,this._scaleChanged,this),this.view&&(this.view.node.on(bC.TRANSFORM_CHANGED,this._scaleChanged,this),this.view.node.on(bC.SIZE_CHANGED,this._calculateBoundary,this))),this._calculateBoundary(),this._updateScrollBarState()},n.update=function(t){this._autoScrolling&&this._processAutoScrolling(t)},n.onDisable=function(){this._unregisterEvent(),this._content&&(this._content.off(bC.SIZE_CHANGED,this._calculateBoundary,this),this._content.off(bC.TRANSFORM_CHANGED,this._scaleChanged,this),this.view&&(this.view.node.off(bC.TRANSFORM_CHANGED,this._scaleChanged,this),this.view.node.off(bC.SIZE_CHANGED,this._calculateBoundary,this))),this._hideScrollBar(),this.stopAutoScroll()},n._registerEvent=function(){this.node.on(bC.TOUCH_START,this._onTouchBegan,this,!0),this.node.on(bC.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.on(bC.TOUCH_END,this._onTouchEnded,this,!0),this.node.on(bC.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.on(bC.MOUSE_WHEEL,this._onMouseWheel,this,!0)},n._unregisterEvent=function(){this.node.off(bC.TOUCH_START,this._onTouchBegan,this,!0),this.node.off(bC.TOUCH_MOVE,this._onTouchMoved,this,!0),this.node.off(bC.TOUCH_END,this._onTouchEnded,this,!0),this.node.off(bC.TOUCH_CANCEL,this._onTouchCancelled,this,!0),this.node.off(bC.MOUSE_WHEEL,this._onMouseWheel,this,!0)},n._onMouseWheel=function(t,e){if(this.enabledInHierarchy&&!this._hasNestedViewGroup(t,e)){var n=new Mn,i=t.getScrollY();this.vertical?n.set(0,-.1*i,0):this.horizontal&&n.set(-.1*i,0,0),this._mouseWheelEventElapsedTime=0,this._processDeltaMove(n),this._stopMouseWheel||(this._handlePressLogic(),this.schedule(this._checkMouseWheel,1/60,NaN,0),this._stopMouseWheel=!0),this._stopPropagationIfTargetIsMe(t)}},n._onTouchBegan=function(t,e){this.enabledInHierarchy&&this._content&&(this._hasNestedViewGroup(t,e)||(this._handlePressLogic(),this._touchMoved=!1,this._stopPropagationIfTargetIsMe(t)))},n._onTouchMoved=function(t,e){if(this.enabledInHierarchy&&this._content&&!this._hasNestedViewGroup(t,e)){var n=t.touch;if(this._handleMoveLogic(n),this.cancelInnerEvents){var i=n.getUILocation(oSt);if(i.subtract(n.getUIStartLocation(sSt)),i.length()>7&&!this._touchMoved&&t.target!==this.node){var r=new ID(t.getTouches(),t.bubbles,xw.TOUCH_CANCEL);r.touch=t.touch,r.simulate=!0,t.target.dispatchEvent(r),this._touchMoved=!0}this._stopPropagationIfTargetIsMe(t)}}},n._onTouchEnded=function(t,e){if(this.enabledInHierarchy&&this._content&&t&&!this._hasNestedViewGroup(t,e)){this._dispatchEvent(nSt.TOUCH_UP);var n=t.touch;this._handleReleaseLogic(n),this._touchMoved?t.propagationStopped=!0:this._stopPropagationIfTargetIsMe(t)}},n._onTouchCancelled=function(t,e){if(this.enabledInHierarchy&&this._content&&!this._hasNestedViewGroup(t,e)){if(t&&!t.simulate){var n=t.touch;this._handleReleaseLogic(n)}this._stopPropagationIfTargetIsMe(t)}},n._calculateBoundary=function(){if(this._content&&this.view){var t=this._content.getComponent(Eyt);t&&t.enabledInHierarchy&&t.updateLayout();var e=this.view,n=e.width*e.anchorX,i=e.height*e.anchorY;this._leftBoundary=-n,this._bottomBoundary=-i,this._rightBoundary=this._leftBoundary+e.width,this._topBoundary=this._bottomBoundary+e.height,this._moveContentToTopLeft(e.contentSize)}},n._hasNestedViewGroup=function(t,e){if(!t||t.eventPhase!==bD.CAPTURING_PHASE)return!1;if(e)for(var n,i=st(e);!(n=i()).done;){var r=n.value;if(this.node===r)return!(!t.target||!t.target.getComponent(eSt));if(r.getComponent(eSt))return!0}return!1},n._startInertiaScroll=function(t){var e=new Mn(t);e.multiplyScalar(.7),this._startAttenuatingAutoScroll(e,t)},n._calculateAttenuatedFactor=function(t){return this.brake<=0?1-this.brake:(1-this.brake)*(1/(1+14e-6*t+t*t*8e-9))},n._startAttenuatingAutoScroll=function(t,e){var n=t.clone();if(n.normalize(),this._content&&this.view){var i=this._content._uiProps.uiTransformComp.contentSize,r=this.view.contentSize,a=i.width-r.width,o=i.height-r.height,s=this._calculateAttenuatedFactor(a),c=this._calculateAttenuatedFactor(o);n.x=n.x*a*(1-this.brake)*s,n.y=n.y*o*c*(1-this.brake),n.z=0}var l=t.length(),h=n.length()/l;if(n.add(t),this.brake>0&&h>7){h=Math.sqrt(h);var u=t.clone();u.multiplyScalar(h),n.set(u),n.add(t)}var _=this._calculateAutoScrollTimeByInitialSpeed(e.length());this.brake>0&&h>3&&(_*=h=3),0===this.brake&&h>1&&(_*=h),this._startAutoScroll(n,_,!0)},n._calculateAutoScrollTimeByInitialSpeed=function(t){return Math.sqrt(Math.sqrt(t/5))},n._startAutoScroll=function(t,e,n){void 0===n&&(n=!1);var i=this._flattenVectorByDirection(t);this._autoScrolling=!0,this._autoScrollTargetDelta=i,this._autoScrollAttenuate=n,Mn.copy(this._autoScrollStartPosition,this._getContentPosition()),this._autoScrollTotalTime=e,this._autoScrollAccumulatedTime=0,this._autoScrollBraking=!1,this._isScrollEndedWithThresholdEventFired=!1,this._autoScrollBrakingStartPosition.set(0,0,0),this._getHowMuchOutOfBoundary().equals(Mn.ZERO,iSt)||(this._autoScrollCurrentlyOutOfBoundary=!0)},n._calculateTouchMoveVelocity=function(){var t=new Mn,e=0;if((e=this._touchMoveTimeDeltas.reduce((function(t,e){return t+e}),e))<=0||e>=.5)t.set(Mn.ZERO);else{var n=new Mn;n=this._touchMoveDisplacements.reduce((function(t,e){return t.add(e),t}),n),t.set(n.x*(1-this.brake)/e,n.y*(1-this.brake)/e,n.z)}return t},n._flattenVectorByDirection=function(t){var e=t;return e.x=this.horizontal?e.x:0,e.y=this.vertical?e.y:0,e},n._moveContent=function(t,e){var n=this._flattenVectorByDirection(t);rSt.set(this._getContentPosition()),rSt.add(n),rSt.set(Math.round(1e4*rSt.x)*iSt,Math.round(1e4*rSt.y)*iSt,rSt.z),this._setContentPosition(rSt);var i=this._getHowMuchOutOfBoundary();oSt.set(i.x,i.y),this._updateScrollBar(oSt),this.elastic&&e&&this._startBounceBackIfNeeded()},n._getContentLeftBoundary=function(){if(!this._content)return-1;var t=this._getContentPosition(),e=this._content._uiProps.uiTransformComp;return t.x-e.anchorX*e.width},n._getContentRightBoundary=function(){if(!this._content)return-1;var t=this._content._uiProps.uiTransformComp;return this._getContentLeftBoundary()+t.width},n._getContentTopBoundary=function(){if(!this._content)return-1;var t=this._content._uiProps.uiTransformComp;return this._getContentBottomBoundary()+t.height},n._getContentBottomBoundary=function(){if(!this._content)return-1;var t=this._getContentPosition(),e=this._content._uiProps.uiTransformComp;return t.y-e.anchorY*e.height},n._getHowMuchOutOfBoundary=function(t){if((t=t||new Mn).equals(Mn.ZERO,iSt)&&!this._outOfBoundaryAmountDirty)return this._outOfBoundaryAmount;var e=new Mn,n=this._getContentLeftBoundary(),i=this._getContentRightBoundary();n+t.x>this._leftBoundary?e.x=this._leftBoundary-(n+t.x):i+t.x<this._rightBoundary&&(e.x=this._rightBoundary-(i+t.x));var r=this._getContentTopBoundary(),a=this._getContentBottomBoundary();return r+t.y<this._topBoundary?e.y=this._topBoundary-(r+t.y):a+t.y>this._bottomBoundary&&(e.y=this._bottomBoundary-(a+t.y)),t.equals(Mn.ZERO,iSt)&&(this._outOfBoundaryAmount=e,this._outOfBoundaryAmountDirty=!1),this._clampDelta(e),e},n._updateScrollBar=function(t){this._horizontalScrollBar&&this._horizontalScrollBar.onScroll(t),this.verticalScrollBar&&this.verticalScrollBar.onScroll(t)},n._onScrollBarTouchBegan=function(){this._horizontalScrollBar&&this._horizontalScrollBar.onTouchBegan(),this.verticalScrollBar&&this.verticalScrollBar.onTouchBegan()},n._onScrollBarTouchEnded=function(){this._horizontalScrollBar&&this._horizontalScrollBar.onTouchEnded(),this.verticalScrollBar&&this.verticalScrollBar.onTouchEnded()},n._dispatchEvent=function(t){if(t===nSt.SCROLL_ENDED)this._scrollEventEmitMask=0;else if(t===nSt.SCROLL_TO_TOP||t===nSt.SCROLL_TO_BOTTOM||t===nSt.SCROLL_TO_LEFT||t===nSt.SCROLL_TO_RIGHT){var e=1<<lSt[t];if(this._scrollEventEmitMask&e)return;this._scrollEventEmitMask|=e}CL.emitEvents(this.scrollEvents,this,lSt[t]),this.node.emit(t,this)},n._adjustContentOutOfBoundary=function(){if(this._content&&(this._outOfBoundaryAmountDirty=!0,this._isOutOfBoundary())){var t=this._getHowMuchOutOfBoundary();rSt.set(this._getContentPosition()),rSt.add(t),this._content.setPosition(rSt),this._updateScrollBar(Qn.ZERO)}},n._hideScrollBar=function(){this._horizontalScrollBar&&this._horizontalScrollBar.hide(),this._verticalScrollBar&&this._verticalScrollBar.hide()},n._updateScrollBarState=function(){if(this._content&&this.view){var t=this.view,e=this._content._uiProps.uiTransformComp;this.verticalScrollBar&&(e.height<t.height?this.verticalScrollBar.hide():this.verticalScrollBar.show()),this.horizontalScrollBar&&(e.width<t.width?this.horizontalScrollBar.hide():this.horizontalScrollBar.show())}},n._stopPropagationIfTargetIsMe=function(t){t.eventPhase===bD.AT_TARGET&&t.target===this.node&&(t.propagationStopped=!0)},n._processDeltaMove=function(t){this._scrollChildren(t),this._gatherTouchMove(t)},n._handleMoveLogic=function(t){this._getLocalAxisAlignDelta(this._deltaPos,t),this._processDeltaMove(this._deltaPos)},n._handleReleaseLogic=function(t){this._getLocalAxisAlignDelta(this._deltaPos,t),this._gatherTouchMove(this._deltaPos),this._processInertiaScroll(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(nSt.SCROLL_ENDED))},n._getLocalAxisAlignDelta=function(t,e){var n=this.node._uiProps.uiTransformComp,i=new Mn;n&&(e.getUILocation(oSt),e.getUIPreviousLocation(sSt),rSt.set(oSt.x,oSt.y,0),aSt.set(sSt.x,sSt.y,0),n.convertToNodeSpaceAR(rSt,rSt),n.convertToNodeSpaceAR(aSt,aSt),Mn.subtract(i,rSt,aSt)),t.set(i)},n._scrollChildren=function(t){this._clampDelta(t);var e,n=t;this.elastic&&(e=this._getHowMuchOutOfBoundary(),n.x*=0===e.x?1:.5,n.y*=0===e.y?1:.5),this.elastic||(e=this._getHowMuchOutOfBoundary(n),n.add(e));var i="",r="";if(this._content){var a=this._content._uiProps.uiTransformComp,o=a.anchorX,s=a.anchorY,c=a.width,l=a.height,h=this._content.position||Mn.ZERO;this.vertical&&(n.y>0?h.y-s*l+n.y>=this._bottomBoundary&&(i=nSt.SCROLL_TO_BOTTOM):n.y<0&&h.y-s*l+l+n.y<=this._topBoundary&&(i=nSt.SCROLL_TO_TOP)),this.horizontal&&(n.x<0?h.x-o*c+c+n.x<=this._rightBoundary&&(r=nSt.SCROLL_TO_RIGHT):n.x>0&&h.x-o*c+n.x>=this._leftBoundary&&(r=nSt.SCROLL_TO_LEFT))}this._moveContent(n,!1),(this.horizontal&&0!==n.x||this.vertical&&0!==n.y)&&(this._scrolling||(this._scrolling=!0,this._dispatchEvent(nSt.SCROLL_BEGAN)),this._dispatchEvent(nSt.SCROLLING)),""!==i&&this._dispatchEvent(i),""!==r&&this._dispatchEvent(r)},n._handlePressLogic=function(){this._autoScrolling&&this._dispatchEvent(nSt.SCROLL_ENDED),this._autoScrolling=!1,this._isBouncing=!1,this._touchMovePreviousTimestamp=cSt(),this._touchMoveDisplacements.length=0,this._touchMoveTimeDeltas.length=0,this._onScrollBarTouchBegan()},n._clampDelta=function(t){if(this._content&&this.view){var e=this.view.contentSize,n=this._content._uiProps.uiTransformComp;n.width<e.width&&(t.x=0),n.height<e.height&&(t.y=0)}},n._gatherTouchMove=function(t){var e=t.clone();for(this._clampDelta(e);this._touchMoveDisplacements.length>=5;)this._touchMoveDisplacements.shift(),this._touchMoveTimeDeltas.shift();this._touchMoveDisplacements.push(e);var n=cSt();this._touchMoveTimeDeltas.push((n-this._touchMovePreviousTimestamp)/1e3),this._touchMovePreviousTimestamp=n},n._startBounceBackIfNeeded=function(){if(!this.elastic)return!1;var t=this._getHowMuchOutOfBoundary();if(this._clampDelta(t),t.equals(Mn.ZERO,iSt))return!1;var e=Math.max(this.bounceDuration,0);return this._startAutoScroll(t,e,!0),this._isBouncing||(t.y>0&&this._dispatchEvent(nSt.BOUNCE_TOP),t.y<0&&this._dispatchEvent(nSt.BOUNCE_BOTTOM),t.x>0&&this._dispatchEvent(nSt.BOUNCE_RIGHT),t.x<0&&this._dispatchEvent(nSt.BOUNCE_LEFT),this._isBouncing=!0),!0},n._processInertiaScroll=function(){if(!this._startBounceBackIfNeeded()&&this.inertia){var t=this._calculateTouchMoveVelocity();!t.equals(rSt,iSt)&&this.brake<1&&this._startInertiaScroll(t)}this._onScrollBarTouchEnded()},n._isOutOfBoundary=function(){return!this._getHowMuchOutOfBoundary().equals(Mn.ZERO,iSt)},n._isNecessaryAutoScrollBrake=function(){if(this._autoScrollBraking)return!0;if(this._isOutOfBoundary()){if(!this._autoScrollCurrentlyOutOfBoundary)return this._autoScrollCurrentlyOutOfBoundary=!0,this._autoScrollBraking=!0,Mn.copy(this._autoScrollBrakingStartPosition,this._getContentPosition()),!0}else this._autoScrollCurrentlyOutOfBoundary=!1;return!1},n._processAutoScrolling=function(t){var e=this._isNecessaryAutoScrollBrake(),n=e?.05:1;this._autoScrollAccumulatedTime+=t*(1/n);var i,r=Math.min(1,this._autoScrollAccumulatedTime/this._autoScrollTotalTime);this._autoScrollAttenuate&&(i=r,r=(i-=1)*i*i*i*i+1);var a=this._autoScrollTargetDelta.clone();a.multiplyScalar(r);var o=this._autoScrollStartPosition.clone();o.add(a);var s=Math.abs(r-1)<=iSt;if(Math.abs(r-1)<=this.getScrollEndedEventTiming()&&!this._isScrollEndedWithThresholdEventFired&&(this._dispatchEvent(nSt.SCROLL_ENG_WITH_THRESHOLD),this._isScrollEndedWithThresholdEventFired=!0),this.elastic){var c=o.clone();c.subtract(this._autoScrollBrakingStartPosition),e&&c.multiplyScalar(n),o.set(this._autoScrollBrakingStartPosition),o.add(c)}else{var l=o.clone();l.subtract(this.getContentPosition());var h=this._getHowMuchOutOfBoundary(l);h.equals(Mn.ZERO,iSt)||(o.add(h),s=!0)}s&&(this._autoScrolling=!1);var u=o.clone();u.subtract(this._getContentPosition()),this._clampDelta(u),this._moveContent(u,s),this._dispatchEvent(nSt.SCROLLING),this._autoScrolling||(this._isBouncing=!1,this._scrolling=!1,this._dispatchEvent(nSt.SCROLL_ENDED))},n._checkMouseWheel=function(t){if(!this._getHowMuchOutOfBoundary().equals(Mn.ZERO,iSt))return this._processInertiaScroll(),this.unschedule(this._checkMouseWheel),this._dispatchEvent(nSt.SCROLL_ENDED),void(this._stopMouseWheel=!1);this._mouseWheelEventElapsedTime+=t,this._mouseWheelEventElapsedTime>.1&&(this._onScrollBarTouchEnded(),this.unschedule(this._checkMouseWheel),this._dispatchEvent(nSt.SCROLL_ENDED),this._stopMouseWheel=!1)},n._calculateMovePercentDelta=function(t){var e=t.anchor,n=t.applyToHorizontal,i=t.applyToVertical;this._calculateBoundary(),e.clampf(Qn.ZERO,Qn.ONE);var r=this._getContentBottomBoundary()-this._bottomBoundary;r=-r;var a=this._getContentLeftBoundary()-this._leftBoundary;a=-a;var o=new Mn;if(this._content&&this.view){var s=0,c=this._content._uiProps.uiTransformComp.contentSize,l=this.view.contentSize;n&&(s=c.width-l.width,o.x=a-s*e.x),i&&(s=c.height-l.height,o.y=r-s*e.y)}return o},n._moveContentToTopLeft=function(t){var e=this._getContentBottomBoundary()-this._bottomBoundary;e=-e;var n=new Mn,i=0,r=this._getContentLeftBoundary()-this._leftBoundary;if(r=-r,this._content){var a=this._content._uiProps.uiTransformComp.contentSize;a.height<t.height&&(i=a.height-t.height,n.y=e-i),a.width<t.width&&(i=a.width-t.width,n.x=r)}this._updateScrollBarState(),this._moveContent(n),this._adjustContentOutOfBoundary()},n._scaleChanged=function(t){t===Fy.SCALE&&this._calculateBoundary()},Q(e,[{key:"content",get:function(){return this._content},set:function(t){if(this._content!==t){var e=t&&t.parent&&t.parent._uiProps.uiTransformComp;!t||t&&e?(this._content=t,this._calculateBoundary()):P(4302)}}},{key:"horizontalScrollBar",get:function(){return this._horizontalScrollBar},set:function(t){this._horizontalScrollBar!==t&&(this._horizontalScrollBar=t,this._horizontalScrollBar&&(this._horizontalScrollBar.setScrollView(this),this._updateScrollBar(Qn.ZERO)))}},{key:"verticalScrollBar",get:function(){return this._verticalScrollBar},set:function(t){this._verticalScrollBar!==t&&(this._verticalScrollBar=t,this._verticalScrollBar&&(this._verticalScrollBar.setScrollView(this),this._updateScrollBar(Qn.ZERO)))}},{key:"view",get:function(){var t=this._content&&this._content.parent;return t?t._uiProps.uiTransformComp:null}}]),e}(eSt),$xt.EventType=nSt,Gxt=lt((Uxt=tSt).prototype,"bounceDuration",[Nc,_xt,fxt,dxt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Hxt=lt(Uxt.prototype,"brake",[Nc,pxt,mxt,vxt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),jxt=lt(Uxt.prototype,"elastic",[Nc,gxt,yxt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Wxt=lt(Uxt.prototype,"inertia",[Nc,xxt,Sxt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),lt(Uxt.prototype,"content",[Axt,bxt,Cxt],Object.getOwnPropertyDescriptor(Uxt.prototype,"content"),Uxt.prototype),qxt=lt(Uxt.prototype,"horizontal",[Nc,Txt,Ext],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),lt(Uxt.prototype,"horizontalScrollBar",[wxt,Ixt,Pxt],Object.getOwnPropertyDescriptor(Uxt.prototype,"horizontalScrollBar"),Uxt.prototype),Xxt=lt(Uxt.prototype,"vertical",[Nc,Dxt,Rxt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),lt(Uxt.prototype,"verticalScrollBar",[Mxt,Oxt,Nxt],Object.getOwnPropertyDescriptor(Uxt.prototype,"verticalScrollBar"),Uxt.prototype),Yxt=lt(Uxt.prototype,"cancelInnerEvents",[Nc,Bxt,Lxt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Kxt=lt(Uxt.prototype,"scrollEvents",[Fxt,Nc,Vxt,zxt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Jxt=lt(Uxt.prototype,"_content",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qxt=lt(Uxt.prototype,"_horizontalScrollBar",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zxt=lt(Uxt.prototype,"_verticalScrollBar",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kxt=Uxt))||kxt)||kxt)||kxt)||kxt)||kxt));h.ScrollView=RSt;var MSt,OSt=new Mn;!function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(MSt||(MSt={})),he(MSt);var NSt,BSt,LSt,FSt,VSt,zSt,kSt,USt,GSt,HSt,jSt,WSt,qSt,XSt,YSt,KSt,JSt,QSt,ZSt,$St,tAt=function(e){return t({Slider:e,SliderComponent:e}),e}((hSt=Ec("cc.Slider"),uSt=jc(),_St=Ic(110),fSt=kc(),dSt=wc(LV),pSt=cl(tH),mSt=Kc(),vSt=cl(MSt),gSt=Kc(),ySt=Jc(),xSt=Kc(),SSt=cl([CL]),ASt=Kc(),hSt(bSt=uSt(bSt=_St(bSt=fSt(bSt=dSt((DSt=PSt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"slideEvents",TSt,at(e)),ct(e,"_handle",ESt,at(e)),ct(e,"_direction",wSt,at(e)),ct(e,"_progress",ISt,at(e)),e._offset=new Mn,e._dragging=!1,e._touchHandle=!1,e._handleLocalPos=new Mn,e._touchPos=new Mn,e}$(e,t);var n=e.prototype;return n.__preload=function(){this._updateHandlePosition()},n.onEnable=function(){this._updateHandlePosition(),this.node.on(bC.TOUCH_START,this._onTouchBegan,this),this.node.on(bC.TOUCH_MOVE,this._onTouchMoved,this),this.node.on(bC.TOUCH_END,this._onTouchEnded,this),this.node.on(bC.TOUCH_CANCEL,this._onTouchCancelled,this),this._handle&&this._handle.isValid&&(this._handle.node.on(bC.TOUCH_START,this._onHandleDragStart,this),this._handle.node.on(bC.TOUCH_MOVE,this._onTouchMoved,this),this._handle.node.on(bC.TOUCH_END,this._onTouchEnded,this))},n.onDisable=function(){this.node.off(bC.TOUCH_START,this._onTouchBegan,this),this.node.off(bC.TOUCH_MOVE,this._onTouchMoved,this),this.node.off(bC.TOUCH_END,this._onTouchEnded,this),this.node.off(bC.TOUCH_CANCEL,this._onTouchCancelled,this),this._handle&&this._handle.isValid&&(this._handle.node.off(bC.TOUCH_START,this._onHandleDragStart,this),this._handle.node.off(bC.TOUCH_MOVE,this._onTouchMoved,this),this._handle.node.off(bC.TOUCH_END,this._onTouchEnded,this))},n._onHandleDragStart=function(t){if(t&&this._handle&&this._handle.node._uiProps.uiTransformComp){this._dragging=!0,this._touchHandle=!0;var e=t.touch.getUILocation();Mn.set(this._touchPos,e.x,e.y,0),this._handle.node._uiProps.uiTransformComp.convertToNodeSpaceAR(this._touchPos,this._offset),t.propagationStopped=!0}},n._onTouchBegan=function(t){this._handle&&t&&(this._dragging=!0,this._touchHandle||this._handleSliderLogic(t.touch),t.propagationStopped=!0)},n._onTouchMoved=function(t){this._dragging&&t&&(this._handleSliderLogic(t.touch),t.propagationStopped=!0)},n._onTouchEnded=function(t){this._dragging=!1,this._touchHandle=!1,this._offset=new Mn,t&&(t.propagationStopped=!0)},n._onTouchCancelled=function(t){this._dragging=!1,t&&(t.propagationStopped=!0)},n._handleSliderLogic=function(t){this._updateProgress(t),this._emitSlideEvent()},n._emitSlideEvent=function(){CL.emitEvents(this.slideEvents,this),this.node.emit("slide",this)},n._updateProgress=function(t){if(this._handle&&t){var e=t.getUILocation();Mn.set(this._touchPos,e.x,e.y,0);var n=this.node._uiProps.uiTransformComp,i=n.convertToNodeSpaceAR(this._touchPos,OSt);this.direction===MSt.Horizontal?this.progress=_n(.5+(i.x-this._offset.x)/n.width):this.progress=_n(.5+(i.y-this._offset.y)/n.height)}},n._updateHandlePosition=function(){if(this._handle){this._handleLocalPos.set(this._handle.node.getPosition());var t=this.node._uiProps.uiTransformComp;this._direction===MSt.Horizontal?this._handleLocalPos.x=-t.width*t.anchorX+this.progress*t.width:this._handleLocalPos.y=-t.height*t.anchorY+this.progress*t.height,this._handle.node.setPosition(this._handleLocalPos)}},n._changeLayout=function(){var t=this.node._uiProps.uiTransformComp,e=t.contentSize;if(t.setContentSize(e.height,e.width),this._handle){var n=this._handle.node.position;this._direction===MSt.Horizontal?this._handle.node.setPosition(n.x,0,n.z):this._handle.node.setPosition(0,n.y,n.z),this._updateHandlePosition()}},Q(e,[{key:"handle",get:function(){return this._handle},set:function(t){this._handle!==t&&(this._handle=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this._changeLayout())}},{key:"progress",get:function(){return this._progress},set:function(t){this._progress!==t&&(this._progress=t,this._updateHandlePosition())}}]),e}(xu),PSt.Direction=MSt,lt((CSt=DSt).prototype,"handle",[pSt,mSt],Object.getOwnPropertyDescriptor(CSt.prototype,"handle"),CSt.prototype),lt(CSt.prototype,"direction",[vSt,gSt],Object.getOwnPropertyDescriptor(CSt.prototype,"direction"),CSt.prototype),lt(CSt.prototype,"progress",[tl,ySt,xSt],Object.getOwnPropertyDescriptor(CSt.prototype,"progress"),CSt.prototype),TSt=lt(CSt.prototype,"slideEvents",[SSt,Nc,ASt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ESt=lt(CSt.prototype,"_handle",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wSt=lt(CSt.prototype,"_direction",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return MSt.Horizontal}}),ISt=lt(CSt.prototype,"_progress",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),bSt=CSt))||bSt)||bSt)||bSt)||bSt)||bSt));function eAt(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return Object.assign.apply(Object,[{}].concat(e))}h.Slider=tAt,function(t){t.TOGGLE="toggle"}($St||($St={}));var nAt,iAt,rAt,aAt,oAt,sAt,cAt,lAt,hAt,uAt,_At,fAt,dAt=function(e){return t({Toggle:e,ToggleComponent:e}),e}((NSt=Ec("cc.Toggle"),BSt=jc(),LSt=Ic(110),FSt=kc(),VSt=wc(LV),zSt=el(),kSt=Kc(),USt=cl(tH),GSt=el(),HSt=Kc(),jSt=cl([CL]),WSt=Kc(),NSt(qSt=BSt(qSt=LSt(qSt=FSt(qSt=VSt((ZSt=QSt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"checkEvents",YSt,at(e)),ct(e,"_isChecked",KSt,at(e)),ct(e,"_checkMark",JSt,at(e)),e}$(e,t);var n=e.prototype;return n._internalToggle=function(){this.isChecked=!this.isChecked},n._set=function(t,e){if(void 0===e&&(e=!0),this._isChecked!=t){this._isChecked=t;var n=this._toggleContainer;n&&n.enabled&&this.enabled&&(t||!n.anyTogglesChecked()&&!n.allowSwitchOff)&&(this._isChecked=!0,n.notifyToggleCheck(this,e)),this.playEffect(),e&&this._emitToggleEvents()}},n.playEffect=function(){this._checkMark&&(this._checkMark.node.active=this._isChecked)},n.setIsCheckedWithoutNotify=function(t){this._set(t,!1)},n.onEnable=function(){t.prototype.onEnable.call(this),this.playEffect(),this.node.on(e.EventType.CLICK,this._internalToggle,this)},n.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(e.EventType.CLICK,this._internalToggle,this)},n.OnDestroy=function(){var t=this._toggleContainer;t&&t.ensureValidState()},n._emitToggleEvents=function(){this.node.emit(e.EventType.TOGGLE,this),this.checkEvents&&CL.emitEvents(this.checkEvents,this)},Q(e,[{key:"isChecked",get:function(){return this._isChecked},set:function(t){this._set(t)}},{key:"checkMark",get:function(){return this._checkMark},set:function(t){this._checkMark!==t&&(this._checkMark=t)}},{key:"_resizeToTarget",set:function(t){t&&this._resizeNodeToTargetNode()}},{key:"_toggleContainer",get:function(){var t=this.node.parent;return h.Node.isNode(t)?t.getComponent("cc.ToggleContainer"):null}}]),e}(Dmt),QSt.EventType=eAt($St,Imt),lt((XSt=ZSt).prototype,"isChecked",[zSt,kSt],Object.getOwnPropertyDescriptor(XSt.prototype,"isChecked"),XSt.prototype),lt(XSt.prototype,"checkMark",[USt,GSt,HSt],Object.getOwnPropertyDescriptor(XSt.prototype,"checkMark"),XSt.prototype),YSt=lt(XSt.prototype,"checkEvents",[jSt,Nc,WSt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),KSt=lt(XSt.prototype,"_isChecked",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),JSt=lt(XSt.prototype,"_checkMark",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qSt=XSt))||qSt)||qSt)||qSt)||qSt)||qSt));h.Toggle=dAt;var pAt,mAt,vAt,gAt,yAt,xAt,SAt,AAt,bAt,CAt,TAt,EAt,wAt,IAt,PAt,DAt,RAt,MAt,OAt,NAt,BAt,LAt,FAt,VAt,zAt,kAt,UAt,GAt,HAt,jAt,WAt,qAt,XAt,YAt,KAt,JAt,QAt,ZAt,$At,tbt,ebt,nbt,ibt,rbt,abt,obt=function(e){return t({ToggleContainer:e,ToggleContainerComponent:e}),e}((nAt=Ec("cc.ToggleContainer"),iAt=jc(),rAt=Ic(110),aAt=kc(),oAt=Kc(),sAt=cl([CL]),cAt=Kc(),nAt(lAt=iAt(lAt=rAt(lAt=aAt(lAt=zc((fAt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_allowSwitchOff",uAt,at(e)),ct(e,"checkEvents",_At,at(e)),e}$(e,t);var n=e.prototype;return n.onEnable=function(){this.ensureValidState(),this.node.on(bC.CHILD_ADDED,this.ensureValidState,this),this.node.on(bC.CHILD_REMOVED,this.ensureValidState,this)},n.onDisable=function(){this.node.off(bC.CHILD_ADDED,this.ensureValidState,this),this.node.off(bC.CHILD_REMOVED,this.ensureValidState,this)},n.activeToggles=function(){return this.toggleItems.filter((function(t){return t.isChecked}))},n.anyTogglesChecked=function(){return!!this.toggleItems.find((function(t){return t.isChecked}))},n.notifyToggleCheck=function(t,e){if(void 0===e&&(e=!0),this.enabledInHierarchy){for(var n=0;n<this.toggleItems.length;n++){var i=this.toggleItems[n];i!==t&&(e?i.isChecked=!1:i.setIsCheckedWithoutNotify(!1))}this.checkEvents&&h.Component.EventHandler.emitEvents(this.checkEvents,t)}},n.ensureValidState=function(){var t=this.toggleItems;if(!this._allowSwitchOff&&!this.anyTogglesChecked()&&0!==t.length){var e=t[0];e.isChecked=!0,this.notifyToggleCheck(e)}var n=this.activeToggles();if(n.length>1)for(var i=n[0],r=0;r<n.length;++r){var a=n[r];a!==i&&(a.isChecked=!1)}},Q(e,[{key:"allowSwitchOff",get:function(){return this._allowSwitchOff},set:function(t){this._allowSwitchOff=t}},{key:"toggleItems",get:function(){return this.node.children.map((function(t){var e=t.getComponent("cc.Toggle");return e&&e.enabled?e:null})).filter(Boolean)}}]),e}(xu),uAt=lt((hAt=fAt).prototype,"_allowSwitchOff",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),lt(hAt.prototype,"allowSwitchOff",[oAt],Object.getOwnPropertyDescriptor(hAt.prototype,"allowSwitchOff"),hAt.prototype),_At=lt(hAt.prototype,"checkEvents",[sAt,Nc,cAt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lAt=hAt))||lAt)||lAt)||lAt)||lAt)||lAt));h.ToggleContainer=obt;var sbt,cbt,lbt=new Qn;function hbt(t){return t instanceof iR?IO:t._uiProps.uiTransformComp?t._uiProps.uiTransformComp.contentSize:ri.ZERO}function ubt(t,e,n,i){t.parent?lbt.set(t.parent.getScale().x,t.parent.getScale().y):lbt.set(0,0);for(var r=lbt.x,a=lbt.y,o=0,s=0,c=t.parent;;){if(!c)return n.x=n.y=0,void(i.x=i.y=1);var l=c.getPosition();if(o+=l.x,s+=l.y,(c=c.parent)===e)break;c?lbt.set(c.getScale().x,c.getScale().y):lbt.set(0,0);var h=lbt.x,u=lbt.y;o*=h,s*=u,r*=h,a*=u}i.x=0!==r?1/r:1,i.y=0!==a?1/a:1,n.x=-o,n.y=-s}!function(t){t[t.ONCE=0]="ONCE",t[t.ALWAYS=1]="ALWAYS",t[t.ON_WINDOW_RESIZE=2]="ON_WINDOW_RESIZE"}(sbt||(sbt={})),he(sbt),function(t){t[t.TOP=1]="TOP",t[t.MID=2]="MID",t[t.BOT=4]="BOT",t[t.LEFT=8]="LEFT",t[t.CENTER=16]="CENTER",t[t.RIGHT=32]="RIGHT",t[t.HORIZONTAL=56]="HORIZONTAL",t[t.VERTICAL=7]="VERTICAL"}(cbt||(cbt={}));var _bt,fbt,dbt,pbt,mbt,vbt,gbt,ybt,xbt,Sbt,Abt,bbt,Cbt,Tbt,Ebt,wbt,Ibt,Pbt,Dbt,Rbt=cbt.TOP|cbt.BOT,Mbt=cbt.LEFT|cbt.RIGHT,Obt=function(e){return t({Widget:e,WidgetComponent:e}),e}((pAt=Ec("cc.Widget"),mAt=jc(),vAt=Ic(110),gAt=kc(),yAt=wc(LV),xAt=cl(TE),SAt=Kc(),AAt=Kc(),bAt=Kc(),CAt=Kc(),TAt=Kc(),EAt=Kc(),wAt=Kc(),IAt=qc(),PAt=qc(),DAt=Kc(),RAt=Kc(),MAt=Kc(),OAt=Kc(),NAt=Kc(),BAt=Kc(),LAt=cl(sbt),FAt=Kc(),pAt(VAt=mAt(VAt=vAt(VAt=gAt(VAt=yAt(VAt=zc((abt=rbt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return(e=t.call.apply(t,[this].concat(i))||this)._lastPos=new Mn,e._lastSize=new ri,e._dirty=!0,e._hadAlignOnce=!1,ct(e,"_alignFlags",kAt,at(e)),ct(e,"_target",UAt,at(e)),ct(e,"_left",GAt,at(e)),ct(e,"_right",HAt,at(e)),ct(e,"_top",jAt,at(e)),ct(e,"_bottom",WAt,at(e)),ct(e,"_horizontalCenter",qAt,at(e)),ct(e,"_verticalCenter",XAt,at(e)),ct(e,"_isAbsLeft",YAt,at(e)),ct(e,"_isAbsRight",KAt,at(e)),ct(e,"_isAbsTop",JAt,at(e)),ct(e,"_isAbsBottom",QAt,at(e)),ct(e,"_isAbsHorizontalCenter",ZAt,at(e)),ct(e,"_isAbsVerticalCenter",$At,at(e)),ct(e,"_originalWidth",tbt,at(e)),ct(e,"_originalHeight",ebt,at(e)),ct(e,"_alignMode",nbt,at(e)),ct(e,"_lockFlags",ibt,at(e)),e}$(e,t);var n=e.prototype;return n.updateAlignment=function(){h._widgetManager.updateAlignment(this.node)},n._validateTargetInDEV=function(){},n.setDirty=function(){this._recursiveDirty()},n.onEnable=function(){this.node.getPosition(this._lastPos),this._lastSize.set(this.node._uiProps.uiTransformComp.contentSize),h._widgetManager.add(this),this._hadAlignOnce=!1,this._registerEvent(),this._registerTargetEvents()},n.onDisable=function(){h._widgetManager.remove(this),this._unregisterEvent(),this._unregisterTargetEvents()},n.onDestroy=function(){this._removeParentEvent()},n._adjustWidgetToAllowMovingInEditor=function(){},n._adjustWidgetToAllowResizingInEditor=function(){},n._adjustWidgetToAnchorChanged=function(){this.setDirty()},n._adjustTargetToParentChanged=function(t){t&&this._unregisterOldParentEvents(t),this.node.getParent()&&this._registerTargetEvents(),this._setDirtyByMode()},n._registerEvent=function(){this.node.on(bC.TRANSFORM_CHANGED,this._setDirtyByMode,this),this.node.on(bC.SIZE_CHANGED,this._setDirtyByMode,this),this.node.on(bC.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this),this.node.on(bC.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},n._unregisterEvent=function(){this.node.off(bC.TRANSFORM_CHANGED,this._setDirtyByMode,this),this.node.off(bC.SIZE_CHANGED,this._setDirtyByMode,this),this.node.off(bC.ANCHOR_CHANGED,this._adjustWidgetToAnchorChanged,this)},n._removeParentEvent=function(){this.node.off(bC.PARENT_CHANGED,this._adjustTargetToParentChanged,this)},n._autoChangedValue=function(t,e){if((this._alignFlags&t)>0){var n=this.node.parent&&this.node.parent._uiProps,i=n&&n.uiTransformComp,r=i?i.contentSize:IO;this.isAlignLeft&&t===cbt.LEFT?this._left=e?this._left*r.width:this._left/r.width:this.isAlignRight&&t===cbt.RIGHT?this._right=e?this._right*r.width:this._right/r.width:this.isAlignHorizontalCenter&&t===cbt.CENTER?this._horizontalCenter=e?this._horizontalCenter*r.width:this._horizontalCenter/r.width:this.isAlignTop&&t===cbt.TOP?this._top=e?this._top*r.height:this._top/r.height:this.isAlignBottom&&t===cbt.BOT?this._bottom=e?this._bottom*r.height:this._bottom/r.height:this.isAbsoluteVerticalCenter&&t===cbt.MID&&(this._verticalCenter=this._verticalCenter/r.height),this._recursiveDirty()}},n._registerTargetEvents=function(){var t=this._target||this.node.parent;t&&t.getComponent(LV)&&(t.on(bC.TRANSFORM_CHANGED,this._setDirtyByMode,this),t.on(bC.SIZE_CHANGED,this._setDirtyByMode,this),t.on(bC.ANCHOR_CHANGED,this._setDirtyByMode,this))},n._unregisterTargetEvents=function(){var t=this._target||this.node.parent;t&&(t.off(bC.TRANSFORM_CHANGED,this._setDirtyByMode,this),t.off(bC.SIZE_CHANGED,this._setDirtyByMode,this),t.off(bC.ANCHOR_CHANGED,this._setDirtyByMode,this))},n._unregisterOldParentEvents=function(t){var e=this._target||t;e&&(e.off(bC.TRANSFORM_CHANGED,this._setDirtyByMode,this),e.off(bC.SIZE_CHANGED,this._setDirtyByMode,this))},n._setDirtyByMode=function(){this.alignMode===sbt.ALWAYS&&this._recursiveDirty()},n._setAlign=function(t,e){if(e!==(this._alignFlags&t)>0){var n=(t&Mbt)>0,i=this.node._uiProps.uiTransformComp;e?(this._alignFlags|=t,n?(this.isAlignHorizontalCenter=!1,this.isStretchWidth&&(this._originalWidth=i.width)):(this.isAlignVerticalCenter=!1,this.isStretchHeight&&(this._originalHeight=i.height))):(n?this.isStretchWidth&&(i.width=this._originalWidth):this.isStretchHeight&&(i.height=this._originalHeight),this._alignFlags&=~t)}},n._recursiveDirty=function(){this._dirty||(this._dirty=!0)},Q(e,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._unregisterTargetEvents(),this._target=t,this._registerTargetEvents(),this._validateTargetInDEV(),this._recursiveDirty())}},{key:"isAlignTop",get:function(){return(this._alignFlags&cbt.TOP)>0},set:function(t){this._setAlign(cbt.TOP,t),this._recursiveDirty()}},{key:"isAlignBottom",get:function(){return(this._alignFlags&cbt.BOT)>0},set:function(t){this._setAlign(cbt.BOT,t),this._recursiveDirty()}},{key:"isAlignLeft",get:function(){return(this._alignFlags&cbt.LEFT)>0},set:function(t){this._setAlign(cbt.LEFT,t),this._recursiveDirty()}},{key:"isAlignRight",get:function(){return(this._alignFlags&cbt.RIGHT)>0},set:function(t){this._setAlign(cbt.RIGHT,t),this._recursiveDirty()}},{key:"isAlignVerticalCenter",get:function(){return(this._alignFlags&cbt.MID)>0},set:function(t){t?(this.isAlignTop=!1,this.isAlignBottom=!1,this._alignFlags|=cbt.MID):this._alignFlags&=~cbt.MID,this._recursiveDirty()}},{key:"isAlignHorizontalCenter",get:function(){return(this._alignFlags&cbt.CENTER)>0},set:function(t){t?(this.isAlignLeft=!1,this.isAlignRight=!1,this._alignFlags|=cbt.CENTER):this._alignFlags&=~cbt.CENTER,this._recursiveDirty()}},{key:"isStretchWidth",get:function(){return(this._alignFlags&Mbt)===Mbt}},{key:"isStretchHeight",get:function(){return(this._alignFlags&Rbt)===Rbt}},{key:"top",get:function(){return this._top},set:function(t){this._top=t,this._recursiveDirty()}},{key:"editorTop",get:function(){return this._isAbsTop?this._top:100*this._top},set:function(t){this._top=this._isAbsTop?t:t/100,this._recursiveDirty()}},{key:"bottom",get:function(){return this._bottom},set:function(t){this._bottom=t,this._recursiveDirty()}},{key:"editorBottom",get:function(){return this._isAbsBottom?this._bottom:100*this._bottom},set:function(t){this._bottom=this._isAbsBottom?t:t/100,this._recursiveDirty()}},{key:"left",get:function(){return this._left},set:function(t){this._left=t,this._recursiveDirty()}},{key:"editorLeft",get:function(){return this._isAbsLeft?this._left:100*this._left},set:function(t){this._left=this._isAbsLeft?t:t/100,this._recursiveDirty()}},{key:"right",get:function(){return this._right},set:function(t){this._right=t,this._recursiveDirty()}},{key:"editorRight",get:function(){return this._isAbsRight?this._right:100*this._right},set:function(t){this._right=this._isAbsRight?t:t/100,this._recursiveDirty()}},{key:"horizontalCenter",get:function(){return this._horizontalCenter},set:function(t){this._horizontalCenter=t,this._recursiveDirty()}},{key:"editorHorizontalCenter",get:function(){return this._isAbsHorizontalCenter?this._horizontalCenter:100*this._horizontalCenter},set:function(t){this._horizontalCenter=this._isAbsHorizontalCenter?t:t/100,this._recursiveDirty()}},{key:"verticalCenter",get:function(){return this._verticalCenter},set:function(t){this._verticalCenter=t,this._recursiveDirty()}},{key:"editorVerticalCenter",get:function(){return this._isAbsVerticalCenter?this._verticalCenter:100*this._verticalCenter},set:function(t){this._verticalCenter=this._isAbsVerticalCenter?t:t/100,this._recursiveDirty()}},{key:"isAbsoluteTop",get:function(){return this._isAbsTop},set:function(t){this._isAbsTop!==t&&(this._isAbsTop=t,this._autoChangedValue(cbt.TOP,this._isAbsTop))}},{key:"isAbsoluteBottom",get:function(){return this._isAbsBottom},set:function(t){this._isAbsBottom!==t&&(this._isAbsBottom=t,this._autoChangedValue(cbt.BOT,this._isAbsBottom))}},{key:"isAbsoluteLeft",get:function(){return this._isAbsLeft},set:function(t){this._isAbsLeft!==t&&(this._isAbsLeft=t,this._autoChangedValue(cbt.LEFT,this._isAbsLeft))}},{key:"isAbsoluteRight",get:function(){return this._isAbsRight},set:function(t){this._isAbsRight!==t&&(this._isAbsRight=t,this._autoChangedValue(cbt.RIGHT,this._isAbsRight))}},{key:"isAbsoluteHorizontalCenter",get:function(){return this._isAbsHorizontalCenter},set:function(t){this._isAbsHorizontalCenter!==t&&(this._isAbsHorizontalCenter=t,this._autoChangedValue(cbt.CENTER,this._isAbsHorizontalCenter))}},{key:"isAbsoluteVerticalCenter",get:function(){return this._isAbsVerticalCenter},set:function(t){this._isAbsVerticalCenter!==t&&(this._isAbsVerticalCenter=t,this._autoChangedValue(cbt.MID,this._isAbsVerticalCenter))}},{key:"alignMode",get:function(){return this._alignMode},set:function(t){this._alignMode=t,this._recursiveDirty()}},{key:"alignFlags",get:function(){return this._alignFlags},set:function(t){this._alignFlags!==t&&(this._alignFlags=t,this._recursiveDirty())}}]),e}(xu),rbt.AlignMode=sbt,lt((zAt=abt).prototype,"target",[xAt,SAt],Object.getOwnPropertyDescriptor(zAt.prototype,"target"),zAt.prototype),lt(zAt.prototype,"isAlignTop",[AAt],Object.getOwnPropertyDescriptor(zAt.prototype,"isAlignTop"),zAt.prototype),lt(zAt.prototype,"isAlignBottom",[bAt],Object.getOwnPropertyDescriptor(zAt.prototype,"isAlignBottom"),zAt.prototype),lt(zAt.prototype,"isAlignLeft",[CAt],Object.getOwnPropertyDescriptor(zAt.prototype,"isAlignLeft"),zAt.prototype),lt(zAt.prototype,"isAlignRight",[TAt],Object.getOwnPropertyDescriptor(zAt.prototype,"isAlignRight"),zAt.prototype),lt(zAt.prototype,"isAlignVerticalCenter",[EAt],Object.getOwnPropertyDescriptor(zAt.prototype,"isAlignVerticalCenter"),zAt.prototype),lt(zAt.prototype,"isAlignHorizontalCenter",[wAt],Object.getOwnPropertyDescriptor(zAt.prototype,"isAlignHorizontalCenter"),zAt.prototype),lt(zAt.prototype,"isStretchWidth",[IAt],Object.getOwnPropertyDescriptor(zAt.prototype,"isStretchWidth"),zAt.prototype),lt(zAt.prototype,"isStretchHeight",[PAt],Object.getOwnPropertyDescriptor(zAt.prototype,"isStretchHeight"),zAt.prototype),lt(zAt.prototype,"top",[DAt],Object.getOwnPropertyDescriptor(zAt.prototype,"top"),zAt.prototype),lt(zAt.prototype,"editorTop",[Wc],Object.getOwnPropertyDescriptor(zAt.prototype,"editorTop"),zAt.prototype),lt(zAt.prototype,"bottom",[RAt],Object.getOwnPropertyDescriptor(zAt.prototype,"bottom"),zAt.prototype),lt(zAt.prototype,"editorBottom",[Wc],Object.getOwnPropertyDescriptor(zAt.prototype,"editorBottom"),zAt.prototype),lt(zAt.prototype,"left",[MAt],Object.getOwnPropertyDescriptor(zAt.prototype,"left"),zAt.prototype),lt(zAt.prototype,"editorLeft",[Wc],Object.getOwnPropertyDescriptor(zAt.prototype,"editorLeft"),zAt.prototype),lt(zAt.prototype,"right",[OAt],Object.getOwnPropertyDescriptor(zAt.prototype,"right"),zAt.prototype),lt(zAt.prototype,"editorRight",[Wc],Object.getOwnPropertyDescriptor(zAt.prototype,"editorRight"),zAt.prototype),lt(zAt.prototype,"horizontalCenter",[NAt],Object.getOwnPropertyDescriptor(zAt.prototype,"horizontalCenter"),zAt.prototype),lt(zAt.prototype,"editorHorizontalCenter",[Wc],Object.getOwnPropertyDescriptor(zAt.prototype,"editorHorizontalCenter"),zAt.prototype),lt(zAt.prototype,"verticalCenter",[BAt],Object.getOwnPropertyDescriptor(zAt.prototype,"verticalCenter"),zAt.prototype),lt(zAt.prototype,"editorVerticalCenter",[Wc],Object.getOwnPropertyDescriptor(zAt.prototype,"editorVerticalCenter"),zAt.prototype),lt(zAt.prototype,"isAbsoluteTop",[Wc],Object.getOwnPropertyDescriptor(zAt.prototype,"isAbsoluteTop"),zAt.prototype),lt(zAt.prototype,"isAbsoluteBottom",[Wc],Object.getOwnPropertyDescriptor(zAt.prototype,"isAbsoluteBottom"),zAt.prototype),lt(zAt.prototype,"isAbsoluteLeft",[Wc],Object.getOwnPropertyDescriptor(zAt.prototype,"isAbsoluteLeft"),zAt.prototype),lt(zAt.prototype,"isAbsoluteRight",[Wc],Object.getOwnPropertyDescriptor(zAt.prototype,"isAbsoluteRight"),zAt.prototype),lt(zAt.prototype,"isAbsoluteHorizontalCenter",[Wc],Object.getOwnPropertyDescriptor(zAt.prototype,"isAbsoluteHorizontalCenter"),zAt.prototype),lt(zAt.prototype,"isAbsoluteVerticalCenter",[Wc],Object.getOwnPropertyDescriptor(zAt.prototype,"isAbsoluteVerticalCenter"),zAt.prototype),lt(zAt.prototype,"alignMode",[LAt,FAt],Object.getOwnPropertyDescriptor(zAt.prototype,"alignMode"),zAt.prototype),lt(zAt.prototype,"alignFlags",[Wc],Object.getOwnPropertyDescriptor(zAt.prototype,"alignFlags"),zAt.prototype),kAt=lt(zAt.prototype,"_alignFlags",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),UAt=lt(zAt.prototype,"_target",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),GAt=lt(zAt.prototype,"_left",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),HAt=lt(zAt.prototype,"_right",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jAt=lt(zAt.prototype,"_top",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),WAt=lt(zAt.prototype,"_bottom",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),qAt=lt(zAt.prototype,"_horizontalCenter",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),XAt=lt(zAt.prototype,"_verticalCenter",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),YAt=lt(zAt.prototype,"_isAbsLeft",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),KAt=lt(zAt.prototype,"_isAbsRight",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),JAt=lt(zAt.prototype,"_isAbsTop",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),QAt=lt(zAt.prototype,"_isAbsBottom",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),ZAt=lt(zAt.prototype,"_isAbsHorizontalCenter",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),$At=lt(zAt.prototype,"_isAbsVerticalCenter",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),tbt=lt(zAt.prototype,"_originalWidth",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ebt=lt(zAt.prototype,"_originalHeight",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),nbt=lt(zAt.prototype,"_alignMode",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return sbt.ON_WINDOW_RESIZE}}),ibt=lt(zAt.prototype,"_lockFlags",[Nc,Lc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),VAt=zAt))||VAt)||VAt)||VAt)||VAt)||VAt)||VAt));h.internal.computeInverseTransForTarget=ubt,h.internal.getReadonlyNodeSize=hbt,h.Widget=Obt;var Nbt,Bbt=new Dn;!function(t){t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL"}(Nbt||(Nbt={})),he(Nbt);var Lbt,Fbt,Vbt,zbt,kbt,Ubt,Gbt,Hbt,jbt,Wbt,qbt,Xbt,Ybt,Kbt,Jbt,Qbt,Zbt,$bt,tCt,eCt,nCt,iCt,rCt,aCt,oCt,sCt,cCt,lCt,hCt,uCt,_Ct,fCt,dCt,pCt,mCt,vCt,gCt,yCt,xCt,SCt,ACt,bCt,CCt,TCt=function(e){return t({PageViewIndicator:e,PageViewIndicatorComponent:e}),e}((_bt=Ec("cc.PageViewIndicator"),fbt=jc(),dbt=Ic(110),pbt=kc(),mbt=cl(oF),vbt=Kc(),gbt=cl(Nbt),ybt=Kc(),xbt=cl(ri),Sbt=Kc(),Abt=Kc(),_bt(bbt=fbt(bbt=dbt(bbt=pbt((Dbt=Pbt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"spacing",Tbt,at(e)),ct(e,"_spriteFrame",Ebt,at(e)),ct(e,"_direction",wbt,at(e)),ct(e,"_cellSize",Ibt,at(e)),e._layout=null,e._pageView=null,e._indicators=[],e}$(e,t);var n=e.prototype;return n.onLoad=function(){this._updateLayout()},n.setPageView=function(t){this._pageView=t,this._refresh()},n._updateLayout=function(){this._layout=this.getComponent(Eyt),this._layout||(this._layout=this.addComponent(Eyt));var t=this._layout;this.direction===Nbt.HORIZONTAL?(t.type=Eyt.Type.HORIZONTAL,t.spacingX=this.spacing):this.direction===Nbt.VERTICAL&&(t.type=Eyt.Type.VERTICAL,t.spacingY=this.spacing),t.resizeMode=Eyt.ResizeMode.CONTAINER},n._createIndicator=function(){var t=new TE;t.layer=this.node.layer;var e=t.addComponent(tH);return e.spriteFrame=this.spriteFrame,e.sizeMode=tH.SizeMode.CUSTOM,t.parent=this.node,t._uiProps.uiTransformComp.setContentSize(this._cellSize),t},n._changedState=function(){var t=this._indicators;if(0!==t.length&&this._pageView){var e=this._pageView.curPageIdx;if(!(e>=t.length)){for(var n=0;n<t.length;++n){var i=t[n];if(i._uiProps.uiComp){var r=i._uiProps.uiComp;Bbt.set(r.color),Bbt.a=127.5,r.color=Bbt}}if(t[e]._uiProps.uiComp){var a=t[e]._uiProps.uiComp;Bbt.set(a.color),Bbt.a=255,a.color=Bbt}}}},n._refresh=function(){if(this._pageView){var t=this._indicators,e=this._pageView.getPages();if(e.length!==t.length){var n=0;if(e.length>t.length)for(n=0;n<e.length;++n)t[n]||(t[n]=this._createIndicator());else for(n=t.length-e.length;n>0;--n){var i=t[n-1];this.node.removeChild(i),t.splice(n-1,1)}this._layout&&this._layout.enabledInHierarchy&&this._layout.updateLayout(),this._changedState()}}},Q(e,[{key:"spriteFrame",get:function(){return this._spriteFrame},set:function(t){this._spriteFrame!==t&&(this._spriteFrame=t)}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t)}},{key:"cellSize",get:function(){return this._cellSize},set:function(t){this._cellSize!==t&&(this._cellSize=t)}}]),e}(xu),Pbt.Direction=Nbt,lt((Cbt=Dbt).prototype,"spriteFrame",[mbt,vbt],Object.getOwnPropertyDescriptor(Cbt.prototype,"spriteFrame"),Cbt.prototype),lt(Cbt.prototype,"direction",[gbt,ybt],Object.getOwnPropertyDescriptor(Cbt.prototype,"direction"),Cbt.prototype),lt(Cbt.prototype,"cellSize",[xbt,Sbt],Object.getOwnPropertyDescriptor(Cbt.prototype,"cellSize"),Cbt.prototype),Tbt=lt(Cbt.prototype,"spacing",[Nc,Abt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ebt=lt(Cbt.prototype,"_spriteFrame",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wbt=lt(Cbt.prototype,"_direction",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Nbt.HORIZONTAL}}),Ibt=lt(Cbt.prototype,"_cellSize",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ri(20,20)}}),bbt=Cbt))||bbt)||bbt)||bbt)||bbt));h.PageViewIndicator=TCt;var ECt,wCt,ICt,PCt=new Qn;!function(t){t[t.Unified=0]="Unified",t[t.Free=1]="Free"}(ECt||(ECt={})),he(ECt),function(t){t[t.Horizontal=0]="Horizontal",t[t.Vertical=1]="Vertical"}(wCt||(wCt={})),he(wCt),function(t){t.PAGE_TURNING="page-turning"}(ICt||(ICt={}));var DCt=function(e){return t({PageView:e,PageViewComponent:e}),e}((Lbt=Ec("cc.PageView"),Fbt=jc(),Vbt=Ic(110),zbt=kc(),kbt=cl(ECt),Ubt=Kc(),Gbt=cl(wCt),Hbt=Kc(),jbt=Jc(),Wbt=Kc(),qbt=Jc(),Xbt=Kc(),Ybt=cl(TCt),Kbt=Kc(),Jbt=Kc(),Qbt=cl(oxt),Zbt=qc(),$bt=cl(oxt),tCt=qc(),eCt=qc(),nCt=qc(),iCt=qc(),rCt=cl([CL]),aCt=qc(),oCt=Kc(),sCt=cl([CL]),cCt=Kc(),Lbt(lCt=Fbt(lCt=Vbt(lCt=zbt((CCt=bCt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"autoPageTurningThreshold",uCt,at(e)),ct(e,"horizontal",_Ct,at(e)),ct(e,"vertical",fCt,at(e)),ct(e,"cancelInnerEvents",dCt,at(e)),ct(e,"scrollEvents",pCt,at(e)),ct(e,"pageTurningSpeed",mCt,at(e)),ct(e,"pageEvents",vCt,at(e)),ct(e,"_sizeMode",gCt,at(e)),ct(e,"_direction",yCt,at(e)),ct(e,"_scrollThreshold",xCt,at(e)),ct(e,"_pageTurningEventTiming",SCt,at(e)),ct(e,"_indicator",ACt,at(e)),e._curPageIdx=0,e._lastPageIdx=0,e._pages=[],e._initContentPos=new Mn,e._scrollCenterOffsetX=[],e._scrollCenterOffsetY=[],e._touchBeganPosition=new Qn,e._touchEndPosition=new Qn,e}$(e,t);var n=e.prototype;return n.onEnable=function(){t.prototype.onEnable.call(this),this.node.on(bC.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.on(e.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},n.onDisable=function(){t.prototype.onDisable.call(this),this.node.off(bC.SIZE_CHANGED,this._updateAllPagesSize,this),this.node.off(e.EventType.SCROLL_ENG_WITH_THRESHOLD,this._dispatchPageTurningEvent,this)},n.onLoad=function(){this._initPages(),this.indicator&&this.indicator.setPageView(this)},n.getCurrentPageIndex=function(){return this._curPageIdx},n.setCurrentPageIndex=function(t){this.scrollToPage(t,1)},n.getPages=function(){return this._pages},n.addPage=function(t){t&&-1===this._pages.indexOf(t)&&this.content&&(t._uiProps.uiTransformComp?(this.content.addChild(t),this._pages.push(t),this._updatePageView()):P(4301))},n.insertPage=function(t,e){if(!(e<0)&&t&&-1===this._pages.indexOf(t)&&this.content)if(e>=this._pages.length)this.addPage(t);else{if(!t._uiProps.uiTransformComp)return void P(4301);this._pages.splice(e,0,t),this.content.insertChild(t,e),this._updatePageView()}},n.removePage=function(t){if(t&&this.content){var e=this._pages.indexOf(t);-1!==e?this.removePageAtIndex(e):R(4300,t.name)}},n.removePageAtIndex=function(t){var e=this._pages;if(!(t<0||t>=e.length)){var n=e[t];n&&this.content&&(this.content.removeChild(n),e.splice(t,1),this._updatePageView())}},n.removeAllPages=function(){if(this.content){for(var t=this._pages,e=0,n=t.length;e<n;e++)this.content.removeChild(t[e]);this._pages.length=0,this._updatePageView()}},n.scrollToPage=function(t,e){void 0===e&&(e=.3),t<0||t>=this._pages.length||(this._curPageIdx=t,this.scrollToOffset(this._moveOffsetValue(t),e,!0),this.indicator&&this.indicator._changedState())},n.getScrollEndedEventTiming=function(){return this.pageTurningEventTiming},n._updatePageView=function(){if(this.content){var t=this.content.getComponent(Eyt);t&&t.enabled&&t.updateLayout();var e=this._pages.length;this._curPageIdx>=e&&(this._curPageIdx=0===e?0:e-1,this._lastPageIdx=this._curPageIdx);for(var n=this._initContentPos,i=0;i<e;++i){var r=this._pages[i].position;this.direction===wCt.Horizontal?this._scrollCenterOffsetX[i]=Math.abs(n.x+r.x):this._scrollCenterOffsetY[i]=Math.abs(n.y+r.y)}this.indicator&&this.indicator._refresh()}},n._updateAllPagesSize=function(){var t=this.view;if(this.content&&t&&this._sizeMode===ECt.Unified)for(var e=this._pages,n=t.contentSize,i=0,r=e.length;i<r;i++)e[i]._uiProps.uiTransformComp.setContentSize(n)},n._handleReleaseLogic=function(){this._autoScrollToPage(),this._scrolling&&(this._scrolling=!1,this._autoScrolling||this._dispatchEvent(e.EventType.SCROLL_ENDED))},n._onTouchBegan=function(e,n){e.touch.getUILocation(PCt),Qn.set(this._touchBeganPosition,PCt.x,PCt.y),t.prototype._onTouchBegan.call(this,e,n)},n._onTouchMoved=function(e,n){t.prototype._onTouchMoved.call(this,e,n)},n._onTouchEnded=function(e,n){e.touch.getUILocation(PCt),Qn.set(this._touchEndPosition,PCt.x,PCt.y),t.prototype._onTouchEnded.call(this,e,n)},n._onTouchCancelled=function(e,n){e.touch.getUILocation(PCt),Qn.set(this._touchEndPosition,PCt.x,PCt.y),t.prototype._onTouchCancelled.call(this,e,n)},n._onMouseWheel=function(){},n._syncScrollDirection=function(){this.horizontal=this.direction===wCt.Horizontal,this.vertical=this.direction===wCt.Vertical},n._syncSizeMode=function(){var t=this.view;if(this.content&&t){var e=this.content.getComponent(Eyt);if(e){if(this._sizeMode===ECt.Free&&this._pages.length>0){var n=this._pages[0]._uiProps.uiTransformComp,i=this._pages[this._pages.length-1]._uiProps.uiTransformComp;this.direction===wCt.Horizontal?(e.paddingLeft=(t.width-n.width)/2,e.paddingRight=(t.width-i.width)/2):this.direction===wCt.Vertical&&(e.paddingTop=(t.height-n.height)/2,e.paddingBottom=(t.height-i.height)/2)}e.updateLayout()}}},n._initPages=function(){if(this.content){this._initContentPos=this.content.position;for(var t=this.content.children,e=0;e<t.length;++e){var n=t[e];this._pages.indexOf(n)>=0||this._pages.push(n)}this._syncScrollDirection(),this._syncSizeMode(),this._updatePageView()}},n._dispatchPageTurningEvent=function(){this._lastPageIdx!==this._curPageIdx&&(this._lastPageIdx=this._curPageIdx,CL.emitEvents(this.pageEvents,this,ICt.PAGE_TURNING),this.node.emit(ICt.PAGE_TURNING,this))},n._isQuicklyScrollable=function(t){if(this.direction===wCt.Horizontal){if(Math.abs(t.x)>this.autoPageTurningThreshold)return!0}else if(this.direction===wCt.Vertical&&Math.abs(t.y)>this.autoPageTurningThreshold)return!0;return!1},n._moveOffsetValue=function(t){var e=new Qn;if(this._sizeMode===ECt.Free)this.direction===wCt.Horizontal?e.x=this._scrollCenterOffsetX[t]:this.direction===wCt.Vertical&&(e.y=this._scrollCenterOffsetY[t]);else{var n=this.view;if(!n)return e;this.direction===wCt.Horizontal?e.x=t*n.width:this.direction===wCt.Vertical&&(e.y=t*n.height)}return e},n._getDragDirection=function(t){return this._direction===wCt.Horizontal?0===t.x?0:t.x>0?1:-1:0===t.y?0:t.y<0?1:-1},n._isScrollable=function(t,e,n){if(this._sizeMode===ECt.Free){var i=0,r=0;if(this.direction===wCt.Horizontal)return i=this._scrollCenterOffsetX[e],r=this._scrollCenterOffsetX[n],Math.abs(t.x)>=Math.abs(i-r)*this.scrollThreshold;if(this.direction===wCt.Vertical)return i=this._scrollCenterOffsetY[e],r=this._scrollCenterOffsetY[n],Math.abs(t.y)>=Math.abs(i-r)*this.scrollThreshold}else{var a=this.view;if(!a)return!1;if(this.direction===wCt.Horizontal)return Math.abs(t.x)>=a.width*this.scrollThreshold;if(this.direction===wCt.Vertical)return Math.abs(t.y)>=a.height*this.scrollThreshold}return!1},n._autoScrollToPage=function(){if(this._startBounceBackIfNeeded()){var t=this._getHowMuchOutOfBoundary();this._clampDelta(t),(t.x>0||t.y<0)&&(this._curPageIdx=0===this._pages.length?0:this._pages.length-1),(t.x<0||t.y>0)&&(this._curPageIdx=0),this.indicator&&this.indicator._changedState()}else{var e=new Qn;Qn.subtract(e,this._touchBeganPosition,this._touchEndPosition);var n=this._curPageIdx,i=n+this._getDragDirection(e),r=this.pageTurningSpeed*Math.abs(n-i);if(i<this._pages.length){if(this._isScrollable(e,n,i))return void this.scrollToPage(i,r);var a=this._calculateTouchMoveVelocity();if(this._isQuicklyScrollable(a))return void this.scrollToPage(i,r)}this.scrollToPage(n,r)}},Q(e,[{key:"sizeMode",get:function(){return this._sizeMode},set:function(t){this._sizeMode!==t&&(this._sizeMode=t,this._syncSizeMode())}},{key:"direction",get:function(){return this._direction},set:function(t){this._direction!==t&&(this._direction=t,this._syncScrollDirection())}},{key:"scrollThreshold",get:function(){return this._scrollThreshold},set:function(t){this._scrollThreshold!==t&&(this._scrollThreshold=t)}},{key:"pageTurningEventTiming",get:function(){return this._pageTurningEventTiming},set:function(t){this._pageTurningEventTiming!==t&&(this._pageTurningEventTiming=t)}},{key:"indicator",get:function(){return this._indicator},set:function(t){this._indicator!==t&&(this._indicator=t,this.indicator&&this.indicator.setPageView(this))}},{key:"curPageIdx",get:function(){return this._curPageIdx}},{key:"verticalScrollBar",get:function(){return t.prototype.verticalScrollBar},set:function(t){this.verticalScrollBar=t}},{key:"horizontalScrollBar",get:function(){return t.prototype.horizontalScrollBar},set:function(t){this.horizontalScrollBar=t}}]),e}(RSt),bCt.SizeMode=ECt,bCt.Direction=wCt,bCt.EventType=eAt(ICt,nSt),lt((hCt=CCt).prototype,"sizeMode",[kbt,Ubt],Object.getOwnPropertyDescriptor(hCt.prototype,"sizeMode"),hCt.prototype),lt(hCt.prototype,"direction",[Gbt,Hbt],Object.getOwnPropertyDescriptor(hCt.prototype,"direction"),hCt.prototype),lt(hCt.prototype,"scrollThreshold",[tl,jbt,Wbt],Object.getOwnPropertyDescriptor(hCt.prototype,"scrollThreshold"),hCt.prototype),lt(hCt.prototype,"pageTurningEventTiming",[tl,qbt,Xbt],Object.getOwnPropertyDescriptor(hCt.prototype,"pageTurningEventTiming"),hCt.prototype),lt(hCt.prototype,"indicator",[Ybt,Kbt],Object.getOwnPropertyDescriptor(hCt.prototype,"indicator"),hCt.prototype),uCt=lt(hCt.prototype,"autoPageTurningThreshold",[Nc,Jbt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),lt(hCt.prototype,"verticalScrollBar",[Qbt,hl,Zbt],Object.getOwnPropertyDescriptor(hCt.prototype,"verticalScrollBar"),hCt.prototype),lt(hCt.prototype,"horizontalScrollBar",[$bt,hl,tCt],Object.getOwnPropertyDescriptor(hCt.prototype,"horizontalScrollBar"),hCt.prototype),_Ct=lt(hCt.prototype,"horizontal",[hl,Nc,eCt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),fCt=lt(hCt.prototype,"vertical",[hl,Nc,nCt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),dCt=lt(hCt.prototype,"cancelInnerEvents",[hl,Nc,iCt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),pCt=lt(hCt.prototype,"scrollEvents",[rCt,Nc,hl,aCt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mCt=lt(hCt.prototype,"pageTurningSpeed",[Nc,Wc,oCt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),vCt=lt(hCt.prototype,"pageEvents",[sCt,Nc,cCt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gCt=lt(hCt.prototype,"_sizeMode",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ECt.Unified}}),yCt=lt(hCt.prototype,"_direction",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return wCt.Horizontal}}),xCt=lt(hCt.prototype,"_scrollThreshold",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),SCt=lt(hCt.prototype,"_pageTurningEventTiming",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),ACt=lt(hCt.prototype,"_indicator",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lCt=hCt))||lCt)||lCt)||lCt)||lCt));h.PageView=DCt;var RCt=new Mn,MCt=new Qn,OCt=new Qn,NCt=new Qn(1,1),BCt=new Qn,LCt=new Qn;function FCt(t,e){if(!e._hadAlignOnce){e.alignMode===sbt.ONCE&&(e._hadAlignOnce=!0);var n,i=e.target,r=OCt,a=NCt;i?ubt(t,n=i,r,a):n=t.parent;var o=hbt(n),s=n instanceof iR||!n.getComponent(LV),c=s?MCt:n.getComponent(LV).anchorPoint,l=s;t.getPosition(RCt);var h=t._uiProps.uiTransformComp,u=RCt.x,_=RCt.y,f=h.anchorPoint,d=t.getScale();if(e.alignFlags&cbt.HORIZONTAL){var p=0,m=0,v=o.width;l?(p=IO.left.x,m=IO.right.x):m=(p=-c.x*v)+v,p+=e.isAbsoluteLeft?e.left:e.left*v,m-=e.isAbsoluteRight?e.right:e.right*v,i&&(p+=r.x,p*=a.x,m+=r.x,m*=a.x);var g=0,y=f.x,x=d.x;if(x<0&&(y=1-y,x=-x),e.isStretchWidth)g=m-p,0!==x&&(h.width=g/x),u=p+y*g;else if(g=h.width*x,e.isAlignHorizontalCenter){var S=e.isAbsoluteHorizontalCenter?e.horizontalCenter:e.horizontalCenter*v,A=(.5-c.x)*o.width;i&&(S*=a.x,A+=r.x,A*=a.x),u=A+(y-.5)*g+S}else u=e.isAlignLeft?p+y*g:m+(y-1)*g;e._lastSize.width=g}if(e.alignFlags&cbt.VERTICAL){var b=0,C=0,T=o.height;l?(C=IO.bottom.y,b=IO.top.y):b=(C=-c.y*T)+T,C+=e.isAbsoluteBottom?e.bottom:e.bottom*T,b-=e.isAbsoluteTop?e.top:e.top*T,i&&(C+=r.y,C*=a.y,b+=r.y,b*=a.y);var E=0,w=f.y,I=d.y;if(I<0&&(w=1-w,I=-I),e.isStretchHeight)E=b-C,0!==I&&(h.height=E/I),_=C+w*E;else if(E=h.height*I,e.isAlignVerticalCenter){var P=e.isAbsoluteVerticalCenter?e.verticalCenter:e.verticalCenter*T,D=(.5-c.y)*o.height;i&&(P*=a.y,D+=r.y,D*=a.y),_=D+(w-.5)*E+P}else _=e.isAlignBottom?C+w*E:b+(w-1)*E;e._lastSize.height=E}t.setPosition(u,_,RCt.z),Mn.set(e._lastPos,u,_,RCt.z)}}function VCt(t){var e=t.getComponent(Obt);if(e&&e.enabled){if(!h.isValid(t,!0))return;UCt.push(e)}for(var n,i=st(t.children);!(n=i()).done;){var r=n.value;r.active&&VCt(r)}}function zCt(){var t=TO.getScene();if(t){GCt.isAligning=!0,GCt._nodesOrderDirty&&(UCt.length=0,VCt(t),GCt._nodesOrderDirty=!1);var e=null,n=GCt._activeWidgetsIterator;for(n.i=0;n.i<UCt.length;++n.i)(e=UCt[n.i])._dirty&&(FCt(e.node,e),e._dirty=!1);GCt.isAligning=!1}}var kCt,UCt=[],GCt=t("widgetManager",h._widgetManager={isAligning:!1,_nodesOrderDirty:!1,_activeWidgetsIterator:new ie.MutableForwardIterator(UCt),animationState:null,init:function(){TO.on(CO.EVENT_AFTER_SCENE_LAUNCH,zCt),TO.on(CO.EVENT_AFTER_UPDATE,zCt),RO.instance.on("design-resolution-changed",this.onResized,this);var t=this.onResized.bind(this);RO.instance.on("canvas-resize",t),Cu.on("orientation-change",t)},add:function(){this._nodesOrderDirty=!0},remove:function(t){this._activeWidgetsIterator.remove(t)},onResized:function(){var t=TO.getScene();t&&this.refreshWidgetOnResized(t)},refreshWidgetOnResized:function(t){var e=TE.isNode(t)&&t.getComponent(Obt);e&&e.enabled&&(e.alignMode===sbt.ON_WINDOW_RESIZE||e.alignMode===sbt.ALWAYS)&&e.setDirty();for(var n,i=st(t.children);!(n=i()).done;){var r=n.value;this.refreshWidgetOnResized(r)}},updateOffsetsToStayPut:function(t,e){function n(t,e){return Math.abs(t-e)>1e-10?e:t}var i=t.node,r=i.parent;if(r){var a=BCt;a.set(0,0);var o=LCt;if(o.set(1,1),t.target&&ubt(i,r=t.target,a,o),!e)return;var s=r._uiProps&&r._uiProps.uiTransformComp,c=s?s.anchorPoint:MCt,l=i._uiProps.uiTransformComp,h=hbt(r),u=l.anchorPoint,_=i.getPosition(),f=cbt,d=i.getScale(),p=0;if(e&f.LEFT){var m=-c.x*h.width;m+=a.x,m*=o.x,p=_.x-u.x*l.width*Math.abs(d.x)-m,t.isAbsoluteLeft||(p/=h.width),p/=o.x,t.left=n(t.left,p)}if(e&f.RIGHT){var v=(1-c.x)*h.width;v+=a.x,p=(v*=o.x)-(_.x+(1-u.x)*l.width*Math.abs(d.x)),t.isAbsoluteRight||(p/=h.width),p/=o.x,t.right=n(t.right,p)}if(e&f.TOP){var g=(1-c.y)*h.height;g+=a.y,p=(g*=o.y)-(_.y+(1-u.y)*l.height*Math.abs(d.y)),t.isAbsoluteTop||(p/=h.height),p/=o.y,t.top=n(t.top,p)}if(e&f.BOT){var y=-c.y*h.height;y+=a.y,y*=o.y,p=_.y-u.y*l.height*Math.abs(d.y)-y,t.isAbsoluteBottom||(p/=h.height),p/=o.y,t.bottom=n(t.bottom,p)}}},updateAlignment:function t(e){var n=e.parent;n&&TE.isNode(n)&&t(n);var i=e.getComponent(Obt);i&&n&&FCt(e,i)},AlignMode:sbt,AlignFlags:cbt});TO.on(CO.EVENT_INIT,(function(){GCt.init()}));var HCt,jCt,WCt,qCt,XCt,YCt,KCt,JCt,QCt,ZCt,$Ct,tTt,eTt,nTt,iTt,rTt,aTt,oTt,sTt,cTt=function(e){return t({SafeArea:e,SafeAreaComponent:e}),e}(Ec("cc.SafeArea")(kCt=jc()(kCt=Ic(110)(kCt=zc(kCt=kc()(kCt=wc(Obt)(kCt=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.onEnable=function(){this.updateArea(),Cu.on("window-resize",this.updateArea,this),Cu.on("orientation-change",this.updateArea,this)},n.onDisable=function(){Cu.off("window-resize",this.updateArea,this),Cu.off("orientation-change",this.updateArea,this)},n.updateArea=function(){var t=this.node.getComponent(Obt),e=this.node.getComponent(LV);if(t&&e){t.updateAlignment();var n=this.node.position.clone(),i=e.anchorPoint.clone();t.isAlignTop=t.isAlignBottom=t.isAlignLeft=t.isAlignRight=!0;var r=BO.getVisibleSize(),a=r.width,o=r.height,s=wu.getSafeAreaRect();t.top=o-s.y-s.height,t.bottom=s.y,t.left=s.x,t.right=a-s.x-s.width,t.updateAlignment();var c=this.node.position.clone(),l=i.x-(c.x-n.x)/e.width,h=i.y-(c.y-n.y)/e.height;e.setAnchorPoint(l,h),GCt.add(t)}},e}(xu))||kCt)||kCt)||kCt)||kCt)||kCt)||kCt);h.SafeArea=cTt;var lTt,hTt=function(e){return t({UICoordinateTracker:e,UICoordinateTrackerComponent:e}),e}((HCt=Ec("cc.UICoordinateTracker"),jCt=jc(),WCt=kc(),qCt=Ic(110),XCt=cl(TE),YCt=Kc(),KCt=cl(GL),JCt=Kc(),QCt=Kc(),ZCt=Kc(),$Ct=cl([CL]),tTt=Kc(),HCt(eTt=jCt(eTt=WCt(eTt=qCt((lt((nTt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"syncEvents",iTt,at(e)),ct(e,"_target",rTt,at(e)),ct(e,"_camera",aTt,at(e)),ct(e,"_useScale",oTt,at(e)),ct(e,"_distance",sTt,at(e)),e._transformPos=new Mn,e._viewPos=new Mn,e._canMove=!0,e._lastWPos=new Mn,e._lastCameraPos=new Mn,e}$(e,t);var n=e.prototype;return n.onEnable=function(){this._checkCanMove()},n.update=function(){var t=this.node.worldPosition,e=this._camera;if(this._canMove&&e&&e.camera&&(!this._lastWPos.equals(t)||!this._lastCameraPos.equals(e.node.worldPosition))&&(this._lastWPos.set(t),this._lastCameraPos.set(e.node.worldPosition),e.camera.update(),e.convertToUINode(t,this._target,this._transformPos),this._useScale&&Mn.transformMat4(this._viewPos,this.node.worldPosition,e.camera.matView),this.syncEvents.length>0)){var n=this._distance/Math.abs(this._viewPos.z);CL.emitEvents(this.syncEvents,this._transformPos,n)}},n._checkCanMove=function(){this._canMove=!(!this._camera||!this._target)},Q(e,[{key:"target",get:function(){return this._target},set:function(t){this._target!==t&&(this._target=t,this._checkCanMove())}},{key:"camera",get:function(){return this._camera},set:function(t){this._camera!==t&&(this._camera=t,this._checkCanMove())}},{key:"useScale",get:function(){return this._useScale},set:function(t){this._useScale!==t&&(this._useScale=t)}},{key:"distance",get:function(){return this._distance},set:function(t){this._distance!==t&&(this._distance=t)}}]),e}(xu)).prototype,"target",[XCt,YCt],Object.getOwnPropertyDescriptor(nTt.prototype,"target"),nTt.prototype),lt(nTt.prototype,"camera",[KCt,JCt],Object.getOwnPropertyDescriptor(nTt.prototype,"camera"),nTt.prototype),lt(nTt.prototype,"useScale",[QCt],Object.getOwnPropertyDescriptor(nTt.prototype,"useScale"),nTt.prototype),lt(nTt.prototype,"distance",[ZCt],Object.getOwnPropertyDescriptor(nTt.prototype,"distance"),nTt.prototype),iTt=lt(nTt.prototype,"syncEvents",[$Ct,Nc,tTt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),rTt=lt(nTt.prototype,"_target",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),aTt=lt(nTt.prototype,"_camera",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oTt=lt(nTt.prototype,"_useScale",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),sTt=lt(nTt.prototype,"_distance",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),eTt=nTt))||eTt)||eTt)||eTt)||eTt)),uTt=[bC.TOUCH_START,bC.TOUCH_END,bC.TOUCH_MOVE,bC.MOUSE_DOWN,bC.MOUSE_MOVE,bC.MOUSE_UP,bC.MOUSE_ENTER,bC.MOUSE_LEAVE,bC.MOUSE_WHEEL];function _Tt(t){t.propagationStopped=!0}var fTt,dTt,pTt,mTt,vTt,gTt,yTt,xTt,STt,ATt,bTt,CTt,TTt=function(e){return t({BlockInputEvents:e,BlockInputEventsComponent:e}),e}(Ec("cc.BlockInputEvents")(lTt=jc()(lTt=kc()(lTt=function(t){function e(){return t.apply(this,arguments)||this}$(e,t);var n=e.prototype;return n.onEnable=function(){for(var t=0;t<uTt.length;t++)this.node.on(uTt[t],_Tt,this)},n.onDisable=function(){for(var t=0;t<uTt.length;t++)this.node.off(uTt[t],_Tt,this)},e}(xu))||lTt)||lTt)||lTt),ETt=t("SubContextView",(fTt=Ec("cc.SubContextView"),dTt=jc(),pTt=Ic(110),mTt=wc(LV),vTt=kc(),gTt=Kc(),yTt=Kc(),fTt(xTt=dTt(xTt=pTt(xTt=mTt(xTt=vTt((lt((STt=function(t){function e(){var e;return ct(e=t.call(this)||this,"_fps",ATt,at(e)),e._sprite=void 0,e._imageAsset=void 0,e._texture=void 0,e._updatedTime=0,e._updateInterval=0,e._openDataContext=void 0,e._content=void 0,ct(e,"_designResolutionSize",bTt,at(e)),e._content=new TE("content"),e._content.hideFlags|=ml.Flags.DontSave|ml.Flags.HideInHierarchy,e._sprite=null,e._imageAsset=new lv,e._openDataContext=null,e._updatedTime=performance.now(),e._texture=new Mv,e}$(e,t);var n=e.prototype;return n.onLoad=function(){dh.getOpenDataContext?(this._updateInterval=1e3/this._fps,this._openDataContext=dh.getOpenDataContext(),this._initSharedCanvas(),this._initContentNode(),this._updateSubContextView(),this._updateContentLayer()):this.enabled=!1},n.onEnable=function(){this._registerNodeEvent()},n.onDisable=function(){this._unregisterNodeEvent()},n._initSharedCanvas=function(){if(this._openDataContext){var t=this._openDataContext.canvas,e=this._designResolutionSize.width,n=this._designResolutionSize.height,i=513;if(e<=i&&n<=i){var r=i/e,a=i/n,o=r<a?r:a;e*=o,n*=o}t.width=e,t.height=n}},n._initContentNode=function(){if(this._openDataContext){var t=this._openDataContext.canvas,e=this._imageAsset;if(e.reset(t),this._texture.image=e,this._texture.create(t.width,t.height),this._sprite=this._content.getComponent(tH),this._sprite||(this._sprite=this._content.addComponent(tH)),this._sprite.spriteFrame)this._sprite.spriteFrame.texture=this._texture;else{var n=new oF;n.texture=this._texture,this._sprite.spriteFrame=n}this._content.parent=this.node}},n._updateSubContextView=function(){if(this._openDataContext){var t=this.node.getComponent(LV),e=this._content.getComponent(LV),n=t.width/e.width,i=t.height/e.height,r=n>i?i:n;e.width*=r,e.height*=r;var a=BO.getViewportRect(),o=e.getBoundingBoxToWorld(),s=BO.getVisibleSize(),c=Cu.devicePixelRatio,l=(a.width*(o.x/s.width)+a.x)/c,h=(a.height*(o.y/s.height)+a.y)/c,u=a.width*(o.width/s.width)/c,_=a.height*(o.height/s.height)/c;this._openDataContext.postMessage({fromEngine:!0,type:"engine",event:"viewport",x:l,y:h,width:u,height:_})}},n._updateSubContextTexture=function(){var t=this._imageAsset;if(t&&this._openDataContext&&!(t.width<=0||t.height<=0)){var e=this._openDataContext.canvas;t.reset(e),(e.width>t.width||e.height>t.height)&&this._texture.create(e.width,e.height),this._texture.uploadData(e)}},n._registerNodeEvent=function(){this.node.on(bC.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.on(bC.SIZE_CHANGED,this._updateSubContextView,this),this.node.on(bC.LAYER_CHANGED,this._updateContentLayer,this)},n._unregisterNodeEvent=function(){this.node.off(bC.TRANSFORM_CHANGED,this._updateSubContextView,this),this.node.off(bC.SIZE_CHANGED,this._updateSubContextView,this),this.node.off(bC.LAYER_CHANGED,this._updateContentLayer,this)},n._updateContentLayer=function(){this._content.layer=this.node.layer},n.update=function(t){void 0===t?this._updateSubContextTexture():performance.now()-this._updatedTime>=this._updateInterval&&(this._updatedTime+=this._updateInterval,this._updateSubContextTexture())},n.onDestroy=function(){this._content.destroy(),this._texture.destroy(),this._sprite&&this._sprite.destroy(),this._imageAsset.destroy(),this._openDataContext=null},Q(e,[{key:"designResolutionSize",get:function(){return this._designResolutionSize},set:function(){}},{key:"fps",get:function(){return this._fps},set:function(t){this._fps!==t&&(this._fps=t,this._updateInterval=1e3/t)}}]),e}(xu)).prototype,"designResolutionSize",[gTt],Object.getOwnPropertyDescriptor(STt.prototype,"designResolutionSize"),STt.prototype),lt(STt.prototype,"fps",[yTt],Object.getOwnPropertyDescriptor(STt.prototype,"fps"),STt.prototype),ATt=lt(STt.prototype,"_fps",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 60}}),bTt=lt(STt.prototype,"_designResolutionSize",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ri(640,960)}}),xTt=STt))||xTt)||xTt)||xTt)||xTt)||xTt));h.SubContextView=ETt;var wTt,ITt,PTt,DTt,RTt=t("UIReorderComponent",Ec("cc.UIReorderComponent")(CTt=function(){R(1408,"UIReorderComponent")})||CTt);h.UIReorderComponent=RTt,h.ButtonComponent=Dmt,re.setClassAlias(Dmt,"cc.ButtonComponent"),h.EditBoxComponent=eyt,re.setClassAlias(eyt,"cc.EditBoxComponent"),h.LayoutComponent=Eyt,re.setClassAlias(Eyt,"cc.LayoutComponent"),h.ProgressBarComponent=Qyt,re.setClassAlias(Qyt,"cc.ProgressBarComponent"),h.ScrollViewComponent=RSt,re.setClassAlias(RSt,"cc.ScrollViewComponent"),h.ScrollBarComponent=oxt,re.setClassAlias(oxt,"cc.ScrollBarComponent"),h.SliderComponent=tAt,re.setClassAlias(tAt,"cc.SliderComponent"),h.ToggleComponent=dAt,re.setClassAlias(dAt,"cc.ToggleComponent"),h.ToggleContainerComponent=obt,re.setClassAlias(obt,"cc.ToggleContainerComponent"),h.WidgetComponent=Obt,re.setClassAlias(Obt,"cc.WidgetComponent"),h.PageViewComponent=DCt,re.setClassAlias(DCt,"cc.PageViewComponent"),h.PageViewIndicatorComponent=TCt,re.setClassAlias(TCt,"cc.PageViewIndicatorComponent"),h.SafeAreaComponent=cTt,re.setClassAlias(cTt,"cc.SafeAreaComponent"),re.setClassAlias(hTt,"cc.UICoordinateTrackerComponent"),h.BlockInputEventsComponent=TTt,re.setClassAlias(TTt,"cc.BlockInputEventsComponent");var MTt=t("VideoClip",Ec("cc.VideoClip")((DTt=function(t){function e(){var e;return ct(e=t.call(this)||this,"_duration",PTt,at(e)),e._video=null,e}return $(e,t),Q(e,[{key:"_nativeAsset",get:function(){return this._video},set:function(t){this._video=t,this._duration=t?t.duration:0}}]),e}($h),PTt=lt((ITt=DTt).prototype,"_duration",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),wTt=ITt))||wTt);function OTt(t,e,n){var i=document.createElement("video"),r=document.createElement("source");i.appendChild(r);var a=new XMLHttpRequest;a.open("GET",t,!0),a.responseType="blob",a.onload=function(){200===this.status||0===this.status?(r.src=URL.createObjectURL(this.response),n(null,i)):n(new Error(a.status+"(no response)"))},a.onerror=function(){var e="load video failure - "+t;x(e),n(new Error(e))},a.send()}function NTt(t,e,n,i){var r=new MTt;r._nativeUrl=t,r._nativeAsset=e,i(null,r)}pN.register({".mp4":OTt,".avi":OTt,".mov":OTt,".mpg":OTt,".mpeg":OTt,".rm":OTt,".rmvb":OTt}),AN.register({".mp4":NTt,".avi":NTt,".mov":NTt,".mpg":NTt,".mpeg":NTt,".rm":NTt,".rmvb":NTt});var BTt,LTt,FTt=se({REMOTE:0,LOCAL:1});!function(t){t.NONE="none",t.PLAYING="playing",t.PAUSED="paused",t.STOPPED="stopped",t.COMPLETED="completed",t.META_LOADED="meta-loaded",t.READY_TO_PLAY="ready-to-play",t.ERROR="error",t.CLICKED="clicked"}(BTt||(BTt={})),function(t){t[t.HAVE_NOTHING=0]="HAVE_NOTHING",t[t.HAVE_METADATA=1]="HAVE_METADATA",t[t.HAVE_CURRENT_DATA=2]="HAVE_CURRENT_DATA",t[t.HAVE_FUTURE_DATA=3]="HAVE_FUTURE_DATA",t[t.HAVE_ENOUGH_DATA=4]="HAVE_ENOUGH_DATA"}(LTt||(LTt={}));var VTt=function(){function t(t){var e=this;this._componentEventList=new Map,this._state=BTt.NONE,this._video=null,this._onHide=void 0,this._onShow=void 0,this._interrupted=!1,this._loaded=!1,this._loadedMeta=!1,this._ignorePause=!1,this._fullScreenOnAwake=!1,this._visible=!0,this._playing=!1,this._cachedCurrentTime=-1,this._waitingFullscreen=!1,this._waitingPlay=!1,this._keepAspectRatio=!1,this._component=null,this._uiTrans=null,this._node=null,this._stayOnBottom=!1,this._dirty=!1,this._forceUpdate=!1,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._component=t,this._node=t.node,this._uiTrans=t.node.getComponent(LV),this._onHide=function(){e.video&&e._state===BTt.PLAYING&&(e.video.pause(),e._interrupted=!0)},this._onShow=function(){e._interrupted&&e.video&&(e.video.play(),e._interrupted=!1)},h.game.on(h.Game.EVENT_HIDE,this._onHide),h.game.on(h.Game.EVENT_SHOW,this._onShow)}var e=t.prototype;return e.onLoadedMetadata=function(t){this._loadedMeta=!0,this._forceUpdate=!0,this._visible?this.enable():this.disable(),this.dispatchEvent(BTt.META_LOADED);var e=t.target;this._keepAspectRatio&&e&&this.syncUITransform(e.videoWidth,e.videoHeight),this.delayedFullScreen(),this.delayedPlay()},e.onCanPlay=function(){this._loaded=!0,this.dispatchEvent(BTt.READY_TO_PLAY)},e.onPlay=function(){this._playing=!0,this.dispatchEvent(BTt.PLAYING)},e.onPlaying=function(){this.dispatchEvent(BTt.PLAYING)},e.onPause=function(){this._ignorePause?this._ignorePause=!1:(this._playing=!1,this.dispatchEvent(BTt.PAUSED))},e.onStoped=function(){this._playing=!1,this._ignorePause=!1,this.dispatchEvent(BTt.STOPPED)},e.onEnded=function(){this.dispatchEvent(BTt.COMPLETED)},e.onClick=function(){this.dispatchEvent(BTt.CLICKED)},e.onError=function(t){this.dispatchEvent(BTt.ERROR);var e=t.target;e&&e.error&&A("Error "+e.error.code+"; details: "+e.error.message)},e.play=function(){this._loadedMeta||this._loaded?this.canPlay():this._waitingPlay=!0},e.delayedPlay=function(){this._waitingPlay&&(this.canPlay(),this._waitingPlay=!1)},e.syncFullScreenOnAwake=function(t){this._fullScreenOnAwake=t,this._loadedMeta||this._loaded?this.canFullScreen(t):this._waitingFullscreen=!0},e.delayedFullScreen=function(){this._waitingFullscreen&&(this.canFullScreen(this._fullScreenOnAwake),this._waitingFullscreen=!1)},e.dispatchEvent=function(t){var e=this._componentEventList.get(t);e&&(this._state=t,e.call(this))},e.syncUITransform=function(t,e){this._uiTrans&&(this._uiTrans.width=t,this._uiTrans.height=e)},e.syncCurrentTime=function(){this.video&&-1!==this._cachedCurrentTime&&this.video.currentTime!==this._cachedCurrentTime&&(this.seekTo(this._cachedCurrentTime),this._cachedCurrentTime=-1)},e.destroy=function(){this.removeVideoPlayer(),this._componentEventList.clear(),h.game.off(h.Game.EVENT_HIDE,this._onHide),h.game.off(h.Game.EVENT_SHOW,this._onShow)},Q(t,[{key:"fullScreenOnAwake",get:function(){return this._fullScreenOnAwake}},{key:"loaded",get:function(){return this._loaded}},{key:"componentEventList",get:function(){return this._componentEventList}},{key:"video",get:function(){return this._video}},{key:"state",get:function(){return this._state}},{key:"isPlaying",get:function(){return this._playing}},{key:"UICamera",get:function(){return TO.root.batcher2D.getFirstRenderCamera(this._node)}}]),t}();h.internal.VideoPlayerImpl=VTt;var zTt,kTt,UTt,GTt,HTt,jTt,WTt,qTt,XTt,YTt,KTt,JTt,QTt,ZTt,$Tt,tEt,eEt,nEt,iEt,rEt,aEt,oEt,sEt,cEt,lEt,hEt,uEt,_Et,fEt,dEt,pEt,mEt,vEt,gEt,yEt,xEt,SEt,AEt,bEt,CEt=-Math.pow(2,15),TEt=Jn(),EEt=function(t){function e(e){var n;return(n=t.call(this,e)||this)._eventList=new Map,n._clearColorA=-1,n._clearFlag=void 0,n}$(e,t);var n=e.prototype;return n.addListener=function(t,e){this._video&&(this._eventList.set(t,e),this._video.addEventListener(t,e))},n.removeAllListeners=function(){var t=this;this._eventList.forEach((function(e,n){t._video&&t._video.removeEventListener(n,e)})),this._eventList.clear()},n.canPlay=function(){var t=this;if(this.video){var e=this.video.play();window.Promise&&e instanceof Promise&&e.catch((function(){})).then((function(){t.syncCurrentTime()}))}},n.pause=function(){this.video&&(this.video.pause(),this._cachedCurrentTime=this.video.currentTime)},n.resume=function(){this.play()},n.stop=function(){var t=this;this.video&&(this._ignorePause=!0,this.video.currentTime=0,this.video.pause(),this._cachedCurrentTime=0,setTimeout((function(){t._ignorePause=!1,t.dispatchEvent(BTt.STOPPED)}),0))},n.syncClip=function(t){this.removeVideoPlayer(),t&&this.createVideoPlayer(t.nativeUrl)},n.syncURL=function(t){this.removeVideoPlayer(),t&&this.createVideoPlayer(t)},n.syncPlaybackRate=function(t){wu.browserType!==Sh.UC?this.video&&(this.video.playbackRate=t):S("playbackRate is not supported by the uc mobile browser.")},n.syncVolume=function(t){this.video&&(this.video.volume=t)},n.syncMute=function(t){this.video&&(this.video.muted=t)},n.syncLoop=function(t){this.video&&(this.video.loop=t)},n.getDuration=function(){return this.video?this.video.duration:0},n.getCurrentTime=function(){return this.video?this.video.currentTime:-1},n.seekTo=function(t){this.video&&(this.video.currentTime=t)},n.canFullScreen=function(t){var e=this,n=this._video;if(n&&n.readyState===LTt.HAVE_ENOUGH_DATA)return wu.os===Ch.IOS&&wu.isBrowser?(t?n.webkitEnterFullscreen&&n.webkitEnterFullscreen():n.webkitExitFullscreen&&n.webkitExitFullscreen(),void(this._fullScreenOnAwake=n.webkitDisplayingFullscreen)):Eu.supportsFullScreen?void(t?(wu.browserType===Sh.IE&&(n.style.transform=""),n.setAttribute("x5-video-player-fullscreen","true"),Eu.requestFullScreen(n,(function(t){var i=wu.browserType===Sh.IE?t.msFullscreenElement:t.fullscreenElement;e._fullScreenOnAwake=i===n}),(function(){e._fullScreenOnAwake=!1}))):(n.removeAttribute("x5-video-player-fullscreen"),Eu.exitFullScreen())):(this._fullScreenOnAwake=t,this._forceUpdate=!0,void this.syncMatrix())},n.syncStayOnBottom=function(t){this._video&&(this._video.style["z-index"]=t?CEt:0,this._stayOnBottom=t),this._dirty=!0},n.syncKeepAspectRatio=function(t){this._keepAspectRatio=t,t&&this._loadedMeta&&this._video&&this.syncUITransform(this._video.videoWidth,this._video.videoHeight)},n.removeVideoPlayer=function(){var t=this._video;t&&xe(bO.container,t)&&(bO.container.removeChild(t),this.removeAllListeners()),this._cachedCurrentTime=0,this._playing=!1,this._loaded=!1,this._loadedMeta=!1,this._video=null},n.createVideoPlayer=function(t){var e=this._video=document.createElement("video");e.className="cocosVideo",e.style.visibility="hidden",e.style.position="absolute",e.style.bottom="0px",e.style.left="0px",e.style["transform-origin"]="0px 100% 0px",e.style["-webkit-transform-origin"]="0px 100% 0px",e.setAttribute("preload","auto"),e.setAttribute("webkit-playsinline",""),e.setAttribute("x5-playsinline",""),e.setAttribute("playsinline",""),this._bindDomEvent(),bO.container.appendChild(e);var n=document.createElement("source");e.appendChild(n),n.src=t},n._bindDomEvent=function(){this._video,this.addListener("loadedmetadata",this.onLoadedMetadata.bind(this)),this.addListener("canplay",this.onCanPlay.bind(this)),this.addListener("canplaythrough",this.onCanPlay.bind(this)),this.addListener("play",this.onPlay.bind(this)),this.addListener("playing",this.onPlaying.bind(this)),this.addListener("pause",this.onPause.bind(this)),this.addListener("click",this.onClick.bind(this)),this.addListener("ended",this.onEnded.bind(this)),this.addListener("error",this.onError.bind(this))},n.onCanPlay=function(e){var n=e.target;if(!this._loaded||!n)switch(n.readyState){case LTt.HAVE_METADATA:case LTt.HAVE_ENOUGH_DATA:t.prototype.onCanPlay.call(this,e)}},n.enable=function(){if(this._video){if(this._visible=!0,"visible"===this._video.style.visibility)return;this._video.style.visibility="visible"}},n.disable=function(t){if(this._video){if(!t&&this._playing&&this._video.pause(),this._visible=!1,"hidden"===this._video.style.visibility)return;this._video.style.visibility="hidden"}},n.syncMatrix=function(){if(this._video&&this._visible&&this._component){var t=this.UICamera;if(t&&!Eu.fullScreen()){this._dirty&&(this._dirty=!1,this._stayOnBottom?(this._clearColorA=t.clearColor.w,this._clearFlag=t.clearFlag,t.clearColor.w=0,t.clearFlag=Zi.ALL):this._clearFlag&&(t.clearColor.w=this._clearColorA,t.clearFlag=this._clearFlag,this._clearColorA=-1,this._clearFlag=null)),this._component.node.getWorldMatrix(TEt),t.update(!0),t.worldMatrixToScreen(TEt,TEt,bO.canvas.width,bO.canvas.height);var e=0,n=0;if(this._fullScreenOnAwake?(e=IO.width,n=IO.height):(e=this._uiTrans.contentSize.width,n=this._uiTrans.contentSize.height),this._forceUpdate||this._m00!==TEt.m00||this._m01!==TEt.m01||this._m04!==TEt.m04||this._m05!==TEt.m05||this._m12!==TEt.m12||this._m13!==TEt.m13||this._w!==e||this._h!==n){this._m00=TEt.m00,this._m01=TEt.m01,this._m04=TEt.m04,this._m05=TEt.m05,this._m12=TEt.m12,this._m13=TEt.m13,this._w=e,this._h=n;var i=Cu.devicePixelRatio,r=1/i,a=1/i,o=bO.container,s=TEt.m00*r,c=TEt.m01,l=TEt.m04,h=TEt.m05*a;this._video.style.width=this._w+"px",this._video.style.height=this._h+"px",wu.browserType!==Sh.MOBILE_QQ?this._video.style.objectFit=this._keepAspectRatio?"none":"fill":S("keepAspectRatio is not supported by the qq mobile browser.");var u=this._w*r,_=this._h*a,f=this._uiTrans.anchorPoint,d=f.x,p=f.y,m=u*TEt.m00*d,v=_*TEt.m05*p,g=o&&o.style.paddingLeft?parseInt(o.style.paddingLeft):0,y=o&&o.style.paddingBottom?parseInt(o.style.paddingBottom):0,x="matrix("+s+","+-c+","+-l+","+h+","+(TEt.m12*r-m+g)+","+-(TEt.m13*a-v+y)+")";this._video.style.transform=x,this._video.style["-webkit-transform"]=x,wu.browserType!==Sh.IE&&(this._forceUpdate=!1)}}}},e}(VTt),wEt=function(){function t(){}return t.getImpl=function(t){return new EEt(t)},t}();h.internal.VideoPlayerImplManager=wEt;var IEt,PEt=t("VideoPlayer",(zTt=Ec("cc.VideoPlayer"),kTt=jc(),UTt=kc(),GTt=wc(LV),HTt=cl(MTt),jTt=cl(FTt),WTt=Kc(),qTt=Kc(),XTt=cl(MTt),YTt=Kc(),KTt=Kc(),JTt=Jc(),QTt=Kc(),ZTt=Jc(),$Tt=Kc(),tEt=Kc(),eEt=Kc(),nEt=Kc(),iEt=Kc(),rEt=Kc(),aEt=cl([CL]),oEt=el(),sEt=Kc(),zTt(cEt=kTt(cEt=UTt(cEt=GTt(cEt=zc((bEt=AEt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_resourceType",hEt,at(e)),ct(e,"_remoteURL",uEt,at(e)),ct(e,"_clip",_Et,at(e)),ct(e,"_playOnAwake",fEt,at(e)),ct(e,"_volume",dEt,at(e)),ct(e,"_mute",pEt,at(e)),ct(e,"_playbackRate",mEt,at(e)),ct(e,"_loop",vEt,at(e)),ct(e,"_fullScreenOnAwake",gEt,at(e)),ct(e,"_stayOnBottom",yEt,at(e)),ct(e,"_keepAspectRatio",xEt,at(e)),e._impl=null,e._cachedCurrentTime=0,ct(e,"videoPlayerEvent",SEt,at(e)),e}$(e,t);var n=e.prototype;return n.syncSource=function(){this._impl&&(this._resourceType===FTt.REMOTE?this._impl.syncURL(this._remoteURL):this._impl.syncClip(this._clip))},n.__preload=function(){this._impl=wEt.getImpl(this),this.syncSource(),this._impl.syncLoop(this._loop),this._impl.syncVolume(this._volume),this._impl.syncMute(this._mute),this._impl.seekTo(this._cachedCurrentTime),this._impl.syncPlaybackRate(this._playbackRate),this._impl.syncStayOnBottom(this._stayOnBottom),this._impl.syncKeepAspectRatio(this._keepAspectRatio),this._impl.syncFullScreenOnAwake(this._fullScreenOnAwake),this._impl.componentEventList.set(BTt.META_LOADED,this.onMetaLoaded.bind(this)),this._impl.componentEventList.set(BTt.READY_TO_PLAY,this.onReadyToPlay.bind(this)),this._impl.componentEventList.set(BTt.PLAYING,this.onPlaying.bind(this)),this._impl.componentEventList.set(BTt.PAUSED,this.onPaused.bind(this)),this._impl.componentEventList.set(BTt.STOPPED,this.onStopped.bind(this)),this._impl.componentEventList.set(BTt.COMPLETED,this.onCompleted.bind(this)),this._impl.componentEventList.set(BTt.ERROR,this.onError.bind(this)),this._playOnAwake&&this._impl.loaded&&this.play()},n.onEnable=function(){this._impl&&this._impl.enable()},n.onDisable=function(){this._impl&&this._impl.disable()},n.onDestroy=function(){this._impl&&(this._impl.destroy(),this._impl=null)},n.update=function(){this._impl&&this._impl.syncMatrix()},n.onMetaLoaded=function(){CL.emitEvents(this.videoPlayerEvent,this,BTt.META_LOADED),this.node.emit("meta-loaded",this)},n.onReadyToPlay=function(){this._playOnAwake&&!this.isPlaying&&this.play(),CL.emitEvents(this.videoPlayerEvent,this,BTt.READY_TO_PLAY),this.node.emit(BTt.READY_TO_PLAY,this)},n.onPlaying=function(){CL.emitEvents(this.videoPlayerEvent,this,BTt.PLAYING),this.node.emit(BTt.PLAYING,this)},n.onPaused=function(){CL.emitEvents(this.videoPlayerEvent,this,BTt.PAUSED),this.node.emit(BTt.PAUSED,this)},n.onStopped=function(){CL.emitEvents(this.videoPlayerEvent,this,BTt.STOPPED),this.node.emit(BTt.STOPPED,this)},n.onCompleted=function(){CL.emitEvents(this.videoPlayerEvent,this,BTt.COMPLETED),this.node.emit(BTt.COMPLETED,this)},n.onError=function(){CL.emitEvents(this.videoPlayerEvent,this,BTt.ERROR),this.node.emit(BTt.ERROR,this)},n.play=function(){this._impl&&this._impl.play()},n.resume=function(){this._impl&&this._impl.resume()},n.pause=function(){this._impl&&this._impl.pause()},n.stop=function(){this._impl&&this._impl.stop()},Q(e,[{key:"resourceType",get:function(){return this._resourceType},set:function(t){this._resourceType!==t&&(this._resourceType=t,this.syncSource())}},{key:"remoteURL",get:function(){return this._remoteURL},set:function(t){this._remoteURL!==t&&(this._remoteURL=t,this.syncSource())}},{key:"clip",get:function(){return this._clip},set:function(t){this._clip!==t&&(this._clip=t,this.syncSource())}},{key:"playOnAwake",get:function(){return this._playOnAwake},set:function(t){this._playOnAwake=t}},{key:"playbackRate",get:function(){return this._playbackRate},set:function(t){this._playbackRate=t,this._impl&&this._impl.syncPlaybackRate(t)}},{key:"volume",get:function(){return this._volume},set:function(t){this._volume=t,this._impl&&this._impl.syncVolume(t)}},{key:"mute",get:function(){return this._mute},set:function(t){this._mute=t,this._impl&&this._impl.syncMute(t)}},{key:"loop",get:function(){return this._loop},set:function(t){this._loop=t,this._impl&&this._impl.syncLoop(t)}},{key:"keepAspectRatio",get:function(){return this._keepAspectRatio},set:function(t){this._keepAspectRatio!==t&&(this._keepAspectRatio=t,this._impl&&this._impl.syncKeepAspectRatio(t))}},{key:"fullScreenOnAwake",get:function(){return this._impl?(this._fullScreenOnAwake=this._impl.fullScreenOnAwake,this._fullScreenOnAwake):this._fullScreenOnAwake},set:function(t){this._fullScreenOnAwake!==t&&(this._fullScreenOnAwake=t,this._impl&&this._impl.syncFullScreenOnAwake(t))}},{key:"stayOnBottom",get:function(){return this._stayOnBottom},set:function(t){this._stayOnBottom!==t&&(this._stayOnBottom=t,this._impl&&this._impl.syncStayOnBottom(t))}},{key:"nativeVideo",get:function(){return this._impl&&this._impl.video||null}},{key:"currentTime",get:function(){return this._impl?this._impl.getCurrentTime():this._cachedCurrentTime},set:function(t){Number.isNaN(t)?S("illegal video time! value:"+t):(t=un(t,0,this.duration),this._cachedCurrentTime=t,this._impl&&this._impl.seekTo(t))}},{key:"duration",get:function(){return this._impl?this._impl.getDuration():0}},{key:"state",get:function(){return this._impl?this._impl.state:BTt.NONE}},{key:"isPlaying",get:function(){return!!this._impl&&this._impl.isPlaying}}]),e}(xu),AEt.EventType=BTt,AEt.ResourceType=FTt,hEt=lt((lEt=bEt).prototype,"_resourceType",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return FTt.LOCAL}}),uEt=lt(lEt.prototype,"_remoteURL",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),_Et=lt(lEt.prototype,"_clip",[HTt,Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fEt=lt(lEt.prototype,"_playOnAwake",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),dEt=lt(lEt.prototype,"_volume",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),pEt=lt(lEt.prototype,"_mute",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),mEt=lt(lEt.prototype,"_playbackRate",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),vEt=lt(lEt.prototype,"_loop",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),gEt=lt(lEt.prototype,"_fullScreenOnAwake",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),yEt=lt(lEt.prototype,"_stayOnBottom",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),xEt=lt(lEt.prototype,"_keepAspectRatio",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),lt(lEt.prototype,"resourceType",[jTt,WTt],Object.getOwnPropertyDescriptor(lEt.prototype,"resourceType"),lEt.prototype),lt(lEt.prototype,"remoteURL",[qTt],Object.getOwnPropertyDescriptor(lEt.prototype,"remoteURL"),lEt.prototype),lt(lEt.prototype,"clip",[XTt,YTt],Object.getOwnPropertyDescriptor(lEt.prototype,"clip"),lEt.prototype),lt(lEt.prototype,"playOnAwake",[KTt],Object.getOwnPropertyDescriptor(lEt.prototype,"playOnAwake"),lEt.prototype),lt(lEt.prototype,"playbackRate",[tl,JTt,QTt],Object.getOwnPropertyDescriptor(lEt.prototype,"playbackRate"),lEt.prototype),lt(lEt.prototype,"volume",[tl,ZTt,$Tt],Object.getOwnPropertyDescriptor(lEt.prototype,"volume"),lEt.prototype),lt(lEt.prototype,"mute",[tEt],Object.getOwnPropertyDescriptor(lEt.prototype,"mute"),lEt.prototype),lt(lEt.prototype,"loop",[eEt],Object.getOwnPropertyDescriptor(lEt.prototype,"loop"),lEt.prototype),lt(lEt.prototype,"keepAspectRatio",[nEt],Object.getOwnPropertyDescriptor(lEt.prototype,"keepAspectRatio"),lEt.prototype),lt(lEt.prototype,"fullScreenOnAwake",[iEt],Object.getOwnPropertyDescriptor(lEt.prototype,"fullScreenOnAwake"),lEt.prototype),lt(lEt.prototype,"stayOnBottom",[rEt],Object.getOwnPropertyDescriptor(lEt.prototype,"stayOnBottom"),lEt.prototype),SEt=lt(lEt.prototype,"videoPlayerEvent",[Nc,aEt,oEt,sEt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cEt=lEt))||cEt)||cEt)||cEt)||cEt)||cEt));h.internal.VideoPlayer=PEt,k(PEt.prototype,"VideoPlayer.prototype",[{name:"onPasued",newName:"onPaused"}]),function(t){t.NONE="none",t.LOADING="loading",t.LOADED="loaded",t.ERROR="error"}(IEt||(IEt={}));var DEt=function(){function t(t){this._componentEventList=new Map,this._state=IEt.NONE,this._wrapper=void 0,this._webview=null,this._loaded=!1,this._forceUpdate=!1,this._component=null,this._uiTrans=null,this._node=null,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._component=t,this._node=t.node,this._uiTrans=t.node.getComponent(LV),this.reset(),this.createWebView()}var e=t.prototype;return e.reset=function(){this._wrapper=null,this._webview=null,this._loaded=!1,this._w=0,this._h=0,this._m00=0,this._m01=0,this._m04=0,this._m05=0,this._m12=0,this._m13=0,this._state=IEt.NONE,this._forceUpdate=!1},e.dispatchEvent=function(t){var e=this._componentEventList.get(t);if(e){this._state=t;for(var n=arguments.length,i=new Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];e.call(this,i)}},e.destroy=function(){this.removeWebView(),this._wrapper=null,this._webview=null,this._loaded=!1,this._component=null,this._uiTrans=null,this._forceUpdate=!1,this._componentEventList.clear()},Q(t,[{key:"loaded",get:function(){return this._loaded}},{key:"componentEventList",get:function(){return this._componentEventList}},{key:"webview",get:function(){return this._webview}},{key:"state",get:function(){return this._state}},{key:"UICamera",get:function(){return TO.root.batcher2D.getFirstRenderCamera(this._node)}}]),t}();h.internal.WebViewImpl=DEt;var REt,MEt,OEt,NEt,BEt,LEt,FEt,VEt,zEt,kEt,UEt,GEt,HEt,jEt,WEt=Jn(),qEt=function(t){function e(e){return t.call(this,e)||this}$(e,t);var n=e.prototype;return n._bindDomEvent=function(){var t=this;this.webview&&this.webview.addEventListener("load",(function(e){t._forceUpdate=!0,t.dispatchEvent(IEt.LOADED);var n=e.target,i=n.contentDocument&&n.contentDocument.body;i&&i.innerHTML.includes("404")&&t.dispatchEvent(IEt.ERROR,i.innerHTML)}))},n.loadURL=function(t){this.webview&&(this.webview.src=t,this.dispatchEvent(IEt.LOADING))},n.createWebView=function(){var t=document.createElement("div");this._wrapper=t,t.id="webview-wrapper",t.style["-webkit-overflow"]="auto",t.style["-webkit-overflow-scrolling"]="touch",t.style.position="absolute",t.style.bottom="0px",t.style.left="0px",t.style.transformOrigin="0px 100% 0px",t.style["-webkit-transform-origin"]="0px 100% 0px",bO.container.appendChild(t);var e=document.createElement("iframe");this._webview=e,e.id="webview",e.style.border="none",e.style.width="100%",e.style.height="100%",t.appendChild(e),this._bindDomEvent()},n.removeWebView=function(){var t=this._wrapper;xe(bO.container,t)&&bO.container.removeChild(t),this.reset()},n.enable=function(){this._wrapper&&(this._wrapper.style.visibility="visible")},n.disable=function(){this._wrapper&&(this._wrapper.style.visibility="hidden")},n.evaluateJS=function(t){if(this.webview){var e=this.webview.contentWindow;if(e)try{e.eval(t)}catch(t){this.dispatchEvent(IEt.ERROR,t),A(t)}}},n.setOnJSCallback=function(){S("The platform does not support")},n.setJavascriptInterfaceScheme=function(){S("The platform does not support")},n.syncMatrix=function(){if(this._wrapper&&this._uiTrans&&this._component&&"hidden"!==this._wrapper.style.visibility){var t=this.UICamera;if(t){this._component.node.getWorldMatrix(WEt),t.update(!0),t.worldMatrixToScreen(WEt,WEt,bO.canvas.width,bO.canvas.height);var e=this._uiTrans.contentSize,n=e.width,i=e.height;if(this._forceUpdate||this._m00!==WEt.m00||this._m01!==WEt.m01||this._m04!==WEt.m04||this._m05!==WEt.m05||this._m12!==WEt.m12||this._m13!==WEt.m13||this._w!==n||this._h!==i){this._m00=WEt.m00,this._m01=WEt.m01,this._m04=WEt.m04,this._m05=WEt.m05,this._m12=WEt.m12,this._m13=WEt.m13,this._w=n,this._h=i;var r=Cu.devicePixelRatio,a=1/r,o=1/r,s=bO.container,c=WEt.m00*a,l=WEt.m01,h=WEt.m04,u=WEt.m05*o;this._wrapper.style.width=n+"px",this._wrapper.style.height=i+"px";var _=this._w*a,f=this._h*o,d=_*WEt.m00*this._uiTrans.anchorX,p=f*WEt.m05*this._uiTrans.anchorY,m=s&&s.style.paddingLeft?parseInt(s.style.paddingLeft):0,v=s&&s.style.paddingBottom?parseInt(s.style.paddingBottom):0,g="matrix("+c+","+-l+","+-h+","+u+","+(WEt.m12*a-d+m)+","+-(WEt.m13*o-p+v)+")";this._wrapper.style.transform=g,this._wrapper.style["-webkit-transform"]=g,this._forceUpdate=!1}}}},e}(DEt),XEt=function(){function t(){}return t.getImpl=function(t){return new qEt(t)},t}();h.internal.WebViewImplManager=XEt;var YEt=t("WebView",(REt=Ec("cc.WebView"),MEt=jc(),OEt=kc(),NEt=wc(LV),BEt=Kc(),LEt=cl([CL]),FEt=el(),VEt=Kc(),REt(zEt=MEt(zEt=OEt(zEt=NEt(zEt=zc((jEt=HEt=function(t){function e(){for(var e,n=arguments.length,i=new Array(n),r=0;r<n;r++)i[r]=arguments[r];return ct(e=t.call.apply(t,[this].concat(i))||this,"_url",UEt,at(e)),e._impl=null,ct(e,"webviewEvents",GEt,at(e)),e}$(e,t);var n=e.prototype;return n.setJavascriptInterfaceScheme=function(t){this._impl&&this._impl.setJavascriptInterfaceScheme(t)},n.setOnJSCallback=function(t){this._impl&&this._impl.setOnJSCallback(t)},n.evaluateJS=function(t){this._impl&&this._impl.evaluateJS(t)},n.__preload=function(){this._impl=XEt.getImpl(this),this._impl.componentEventList.set(IEt.LOADING,this.onLoading.bind(this)),this._impl.componentEventList.set(IEt.LOADED,this.onLoaded.bind(this)),this._impl.componentEventList.set(IEt.ERROR,this.onError.bind(this)),this._impl.loadURL(this._url)},n.onLoading=function(){CL.emitEvents(this.webviewEvents,this,IEt.LOADING),this.node.emit(IEt.LOADING,this)},n.onLoaded=function(){CL.emitEvents(this.webviewEvents,this,IEt.LOADED),this.node.emit(IEt.LOADED,this)},n.onError=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];CL.emitEvents(this.webviewEvents,this,IEt.ERROR,e),this.node.emit(IEt.ERROR,this,e)},n.onEnable=function(){this._impl&&this._impl.enable()},n.onDisable=function(){this._impl&&this._impl.disable()},n.onDestroy=function(){this._impl&&(this._impl.destroy(),this._impl=null)},n.update=function(){this._impl&&this._impl.syncMatrix()},Q(e,[{key:"url",get:function(){return this._url},set:function(t){this._url=t,this._impl&&this._impl.loadURL(t)}},{key:"nativeWebView",get:function(){return this._impl&&this._impl.webview||null}},{key:"state",get:function(){return this._impl?this._impl.state:IEt.NONE}}]),e}(xu),HEt.EventType=IEt,UEt=lt((kEt=jEt).prototype,"_url",[Nc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"https://cocos.com"}}),lt(kEt.prototype,"url",[BEt],Object.getOwnPropertyDescriptor(kEt.prototype,"url"),kEt.prototype),GEt=lt(kEt.prototype,"webviewEvents",[Nc,LEt,FEt,VEt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zEt=kEt))||zEt)||zEt)||zEt)||zEt)||zEt));h.internal.WebView=YEt}}}));
